{
  "version": 3,
  "sources": ["../../src/main.ts", "../../src/license/gridLicenseManager.ts", "../../src/license/shared/md5.ts", "../../src/license/shared/licenseManager.ts", "../../src/license/watermark.ts", "../../src/license/watermark.css-GENERATED.ts", "../../src/excelExport/excelCreator.ts", "../../src/excelExport/excelSerializingSession.ts", "../../src/excelExport/assets/excelUtils.ts", "../../src/excelExport/assets/excelConstants.ts", "../../src/excelExport/assets/xmlFactory.ts", "../../src/excelExport/excelXlsxFactory.ts", "../../src/excelExport/files/ooxml/contentType.ts", "../../src/excelExport/files/ooxml/contentTypes.ts", "../../src/excelExport/files/ooxml/core.ts", "../../src/excelExport/files/ooxml/drawing.ts", "../../src/excelExport/files/ooxml/relationship.ts", "../../src/excelExport/files/ooxml/relationships.ts", "../../src/excelExport/files/ooxml/sharedStrings.ts", "../../src/excelExport/assets/excelLegacyConvert.ts", "../../src/excelExport/files/ooxml/styles/border.ts", "../../src/excelExport/files/ooxml/styles/borders.ts", "../../src/excelExport/files/ooxml/styles/alignment.ts", "../../src/excelExport/files/ooxml/styles/protection.ts", "../../src/excelExport/files/ooxml/styles/xf.ts", "../../src/excelExport/files/ooxml/styles/cellStyleXfs.ts", "../../src/excelExport/files/ooxml/styles/cellStyle.ts", "../../src/excelExport/files/ooxml/styles/cellStyles.ts", "../../src/excelExport/files/ooxml/styles/cellXfs.ts", "../../src/excelExport/files/ooxml/styles/fill.ts", "../../src/excelExport/files/ooxml/styles/fills.ts", "../../src/excelExport/files/ooxml/styles/font.ts", "../../src/excelExport/files/ooxml/styles/fonts.ts", "../../src/excelExport/files/ooxml/styles/numberFormat.ts", "../../src/excelExport/files/ooxml/styles/numberFormats.ts", "../../src/excelExport/files/ooxml/styles/stylesheet.ts", "../../src/excelExport/files/ooxml/table.ts", "../../src/excelExport/files/ooxml/themes/office/colorScheme.ts", "../../src/excelExport/files/ooxml/themes/office/fontScheme.ts", "../../src/excelExport/files/ooxml/themes/office/formatScheme.ts", "../../src/excelExport/files/ooxml/themes/office/themeElements.ts", "../../src/excelExport/files/ooxml/themes/office.ts", "../../src/excelExport/files/ooxml/vmlDrawing.ts", "../../src/excelExport/files/ooxml/sheet.ts", "../../src/excelExport/files/ooxml/sheets.ts", "../../src/excelExport/files/ooxml/workbook.ts", "../../src/excelExport/files/ooxml/worksheet.ts", "../../src/excelExport/files/ooxml/column.ts", "../../src/excelExport/files/ooxml/mergeCell.ts", "../../src/excelExport/files/ooxml/cell.ts", "../../src/excelExport/files/ooxml/row.ts", "../../src/excelExport/zipContainer/zipContainerHelper.ts", "../../src/excelExport/zipContainer/compress.ts", "../../src/excelExport/zipContainer/convert.ts", "../../src/excelExport/zipContainer/crcTable.ts", "../../src/excelExport/zipContainer/zipContainer.ts", "../../src/advancedFilter/advancedFilterModule.ts", "../../src/version.ts", "../../src/agGridEnterpriseModule.ts", "../../src/advancedFilter/advanced-filter.css-GENERATED.ts", "../../src/advancedFilter/advancedFilterApi.ts", "../../src/advancedFilter/advancedFilterExpressionService.ts", "../../src/advancedFilter/advancedFilterLocaleText.ts", "../../src/advancedFilter/filterExpressionUtils.ts", "../../src/advancedFilter/colFilterExpressionParser.ts", "../../src/advancedFilter/filterExpressionOperators.ts", "../../src/advancedFilter/advancedFilterService.ts", "../../src/advancedFilter/advancedFilterCtrl.ts", "../../src/widgets/agDialog.ts", "../../src/widgets/agPanel.ts", "../../src/widgets/agPanel.css-GENERATED.ts", "../../src/advancedFilter/advancedFilterComp.ts", "../../src/advancedFilter/autocomplete/agAutocomplete.ts", "../../src/advancedFilter/autocomplete/agAutocomplete.css-GENERATED.ts", "../../src/advancedFilter/autocomplete/agAutocompleteList.ts", "../../src/widgets/virtualList.ts", "../../src/advancedFilter/autocomplete/agAutocompleteRow.ts", "../../src/advancedFilter/advancedFilterHeaderComp.ts", "../../src/advancedFilter/builder/advancedFilterBuilderComp.ts", "../../src/advancedFilter/builder/advancedFilterBuilderDragFeature.ts", "../../src/features/virtualListDragFeature.ts", "../../src/advancedFilter/builder/advancedFilterBuilderItemAddComp.ts", "../../src/advancedFilter/builder/addDropdownComp.ts", "../../src/widgets/agRichSelect.ts", "../../src/widgets/AgPillContainer.ts", "../../src/widgets/agPill.ts", "../../src/widgets/agRichSelect.css-GENERATED.ts", "../../src/widgets/agRichSelectList.ts", "../../src/widgets/agRichSelectRow.ts", "../../src/advancedFilter/builder/advancedFilterBuilderItemNavigationFeature.ts", "../../src/advancedFilter/builder/advancedFilterBuilderUtils.ts", "../../src/advancedFilter/builder/advancedFilterBuilderItemComp.ts", "../../src/advancedFilter/builder/conditionPillWrapperComp.ts", "../../src/advancedFilter/builder/inputPillComp.ts", "../../src/advancedFilter/builder/joinPillWrapperComp.ts", "../../src/advancedFilter/builder/selectPillComp.ts", "../../src/advancedFilter/joinFilterExpressionParser.ts", "../../src/advancedFilter/filterExpressionParser.ts", "../../src/columnToolPanel/columnsToolPanelModule.ts", "../../src/sideBar/sideBarModule.ts", "../../src/sideBar/sideBarApi.ts", "../../src/sideBar/sideBarService.ts", "../../src/sideBar/agSideBar.ts", "../../src/misc/enterpriseFocusUtils.ts", "../../src/sideBar/agSideBar.css-GENERATED.ts", "../../src/sideBar/agSideBarButtons.ts", "../../src/sideBar/sideBarButtonComp.ts", "../../src/sideBar/sideBarDefParser.ts", "../../src/sideBar/toolPanelWrapper.ts", "../../src/sideBar/agHorizontalResize.ts", "../../src/widgets/agMenuItemRenderer.ts", "../../src/widgets/menu.css-GENERATED.ts", "../../src/widgets/menuItemModule.ts", "../../src/columnToolPanel/columnToolPanel.ts", "../../src/columnToolPanel/agPrimaryCols.ts", "../../src/columnToolPanel/agPrimaryCols.css-GENERATED.ts", "../../src/columnToolPanel/agPrimaryColsHeader.ts", "../../src/columnToolPanel/agPrimaryColsList.ts", "../../src/sideBar/common/toolPanelColDefService.ts", "../../src/sideBar/common/sideBarUtils.ts", "../../src/columnToolPanel/columnModelItem.ts", "../../src/columnToolPanel/modelItemUtils.ts", "../../src/columnToolPanel/primaryColsListPanelItemDragFeature.ts", "../../src/columnToolPanel/toolPanelColumnGroupComp.ts", "../../src/columnToolPanel/toolPanelContextMenu.ts", "../../src/rowGrouping/rowGroupingUtils.ts", "../../src/widgets/agMenuList.ts", "../../src/widgets/agMenuItemComponent.ts", "../../src/widgets/agMenuPanel.ts", "../../src/columnToolPanel/toolPanelColumnComp.ts", "../../src/columnToolPanel/columnToolPanel.css-GENERATED.ts", "../../src/columnToolPanel/columnToolPanelFactory.ts", "../../src/rowGrouping/columnDropZones/pivotDropZonePanel.ts", "../../src/rowGrouping/columnDropZones/baseDropZonePanel.ts", "../../src/widgets/pillDropZonePanel.ts", "../../src/widgets/pillDropZonePanel.css-GENERATED.ts", "../../src/rowGrouping/columnDropZones/dropZoneColumnComp.ts", "../../src/widgets/pillDragComp.ts", "../../src/rowGrouping/columnDropZones/rowGroupDropZonePanel.ts", "../../src/rowGrouping/columnDropZones/valueDropZonePanel.ts", "../../src/columnToolPanel/pivotModePanel.ts", "../../src/menu/menuModule.ts", "../../src/menu/chartMenuItemMapper.ts", "../../src/menu/columnChooserFactory.ts", "../../src/menu/columnMenuFactory.ts", "../../src/menu/menuItemMapper.ts", "../../src/menu/contextMenu.ts", "../../src/menu/enterpriseMenu.ts", "../../src/widgets/tabbedLayout.ts", "../../src/menu/menuApi.ts", "../../src/menu/menuUtils.ts", "../../src/richSelect/richSelectModule.ts", "../../src/richSelect/richSelectCellEditor.ts", "../../src/setFilter/setFilterModule.ts", "../../src/setFilter/setFilter.ts", "../../src/setFilter/iSetDisplayValueModel.ts", "../../src/setFilter/localeText.ts", "../../src/setFilter/setFilterListItem.ts", "../../src/setFilter/setFilterModelFormatter.ts", "../../src/setFilter/setFilterUtils.ts", "../../src/setFilter/setValueModel.ts", "../../src/setFilter/clientSideValueExtractor.ts", "../../src/setFilter/filteringKeys.ts", "../../src/setFilter/flatSetDisplayValueModel.ts", "../../src/setFilter/treeSetDisplayValueModel.ts", "../../src/setFilter/setFloatingFilter.ts", "../../src/statusBar/statusBarModule.ts", "../../src/statusBar/agStatusBar.ts", "../../src/statusBar/agStatusBar.css-GENERATED.ts", "../../src/statusBar/providedPanels/aggregationComp.ts", "../../src/statusBar/providedPanels/agNameValue.ts", "../../src/statusBar/providedPanels/filteredRowsComp.ts", "../../src/statusBar/providedPanels/selectedRowsComp.ts", "../../src/statusBar/providedPanels/totalAndFilteredRowsComp.ts", "../../src/statusBar/providedPanels/totalRowsComp.ts", "../../src/statusBar/statusBarApi.ts", "../../src/statusBar/statusBarService.ts", "../../src/excelExport/excelExportModule.ts", "../../src/excelExport/excelExportApi.ts", "../../src/multiFilter/multiFilterModule.ts", "../../src/multiFilter/multiFilter.ts", "../../src/widgets/agGroupComponent.ts", "../../src/multiFilter/multiFloatingFilter.ts", "../../src/rowGrouping/rowGroupingModule.ts", "../../src/aggregation/aggColumnNameService.ts", "../../src/aggregation/aggFuncService.ts", "../../src/aggregation/aggregationApi.ts", "../../src/aggregation/aggregationStage.ts", "../../src/aggregation/filterAggregatesStage.ts", "../../src/aggregation/footerService.ts", "../../src/aggregation/footerUtils.ts", "../../src/aggregation/valueColsSvc.ts", "../../src/aggregation/aggregationModule.ts", "../../src/pivot/pivotColsSvc.ts", "../../src/rowGrouping/rowGroupColsSvc.ts", "../../src/rowHierarchy/autoColService.ts", "../../src/rowHierarchy/clientSideExpansionService.ts", "../../src/rowHierarchy/baseExpansionService.ts", "../../src/rowHierarchy/flattenStage.ts", "../../src/rowHierarchy/rendering/groupCellRenderer.ts", "../../src/rowHierarchy/rendering/groupCellRendererCtrl.ts", "../../src/rowHierarchy/showRowGroupColsService.ts", "../../src/rowHierarchy/stickyRowService.ts", "../../src/rowHierarchy/stickyRowFeature.ts", "../../src/rowHierarchy/rowHierarchyModule.ts", "../../src/rowGrouping/columnDropZones/agGridHeaderDropZones.ts", "../../src/rowGrouping/groupFilter/groupFilter.ts", "../../src/rowGrouping/groupFilter/groupFloatingFilter.ts", "../../src/rowGrouping/groupHideOpenParentsService.ts", "../../src/rowGrouping/groupStage/groupStage.ts", "../../src/rowGrouping/groupStage/batchRemover.ts", "../../src/rowGrouping/groupStage/sortGroupChildren.ts", "../../src/rowGrouping/rowGroupingApi.ts", "../../src/viewportRowModel/viewportRowModel.ts", "../../src/viewportRowModel/viewportRowModelModule.ts", "../../src/clipboard/clipboardModule.ts", "../../src/clipboard/clipboardApi.ts", "../../src/clipboard/clipboardService.ts", "../../src/filterToolPanel/filtersToolPanelModule.ts", "../../src/filterToolPanel/filtersToolPanel.ts", "../../src/filterToolPanel/agFiltersToolPanelHeader.ts", "../../src/filterToolPanel/agFiltersToolPanelList.ts", "../../src/filterToolPanel/toolPanelFilterComp.ts", "../../src/filterToolPanel/toolPanelFilterGroupComp.ts", "../../src/filterToolPanel/filtersToolPanel.css-GENERATED.ts", "../../src/masterDetail/detailCellRenderer.ts", "../../src/masterDetail/detailCellRendererCtrl.ts", "../../src/masterDetail/detailFrameworkComponentWrapper.ts", "../../src/masterDetail/masterDetailApi.ts", "../../src/masterDetail/masterDetailModule.css-GENERATED.ts", "../../src/masterDetail/masterDetailService.ts", "../../src/masterDetail/masterDetailModule.ts", "../../src/rangeSelection/rangeSelectionModule.ts", "../../src/rangeSelection/agFillHandle.ts", "../../src/rangeSelection/abstractSelectionHandle.ts", "../../src/rangeSelection/utils.ts", "../../src/rangeSelection/agRangeHandle.ts", "../../src/rangeSelection/rangeSelection.css-GENERATED.ts", "../../src/rangeSelection/rangeSelectionApi.ts", "../../src/rangeSelection/rangeService.ts", "../../src/rangeSelection/cellRangeFeature.ts", "../../src/rangeSelection/dragListenerFeature.ts", "../../src/serverSideRowModel/serverSideRowModelModule.ts", "../../src/cellRenderers/loadingCellRenderer.ts", "../../src/cellRenderers/skeletonCellRenderer.ts", "../../src/cellRenderers/enterpriseCellRendererModule.ts", "../../src/pivot/pivotModule.ts", "../../src/pivot/pivotApi.ts", "../../src/pivot/pivotColDefService.ts", "../../src/pivot/pivotResultColsService.ts", "../../src/pivot/pivotStage.ts", "../../src/treeData/clientSideChildrenTreeNodeManager.ts", "../../src/treeData/abstractClientSideTreeNodeManager.ts", "../../src/treeData/treeNode.ts", "../../src/treeData/treeRow.ts", "../../src/treeData/fieldAccess.ts", "../../src/treeData/clientSidePathTreeNodeManager.ts", "../../src/treeData/treeDataModule.ts", "../../src/serverSideRowModel/blocks/blockUtils.ts", "../../src/serverSideRowModel/listeners/expandListener.ts", "../../src/serverSideRowModel/listeners/filterListener.ts", "../../src/serverSideRowModel/listeners/listenerUtils.ts", "../../src/serverSideRowModel/listeners/sortListener.ts", "../../src/serverSideRowModel/nodeManager.ts", "../../src/serverSideRowModel/serverSideRowModel.ts", "../../src/serverSideRowModel/serverSideRowModelApi.ts", "../../src/serverSideRowModel/services/serverSideExpansionService.ts", "../../src/serverSideRowModel/services/serverSideSelectionService.ts", "../../src/serverSideRowModel/services/selection/strategies/defaultStrategy.ts", "../../src/serverSideRowModel/services/selection/strategies/groupSelectsChildrenStrategy.ts", "../../src/serverSideRowModel/services/ssrmRowChildrenService.ts", "../../src/serverSideRowModel/stores/lazy/lazyBlockLoadingService.ts", "../../src/serverSideRowModel/stores/storeFactory.ts", "../../src/serverSideRowModel/stores/lazy/lazyStore.ts", "../../src/serverSideRowModel/stores/lazy/lazyCache.ts", "../../src/serverSideRowModel/stores/lazy/multiIndexMap.ts", "../../src/serverSideRowModel/stores/storeUtils.ts", "../../src/serverSideRowModel/transactionManager.ts", "../../src/sparkline/sparklinesModule.ts", "../../src/sparkline/sparkline.css-GENERATED.ts", "../../src/sparkline/sparklineCellRenderer.ts", "../../src/sparkline/sparklinesUtils.ts", "../../src/charts/integratedChartsModule.ts", "../../src/charts/agChartsExports.ts", "../../src/charts/chartComp/chartProxies/enterpriseChartProxyFactory.ts", "../../src/charts/chartComp/utils/integration.ts", "../../src/charts/chartComp/utils/object.ts", "../../src/charts/chartComp/utils/seriesTypeMapper.ts", "../../src/charts/chartComp/chartProxies/chartTheme.ts", "../../src/charts/chartComp/utils/axisTypeMapper.ts", "../../src/charts/chartComp/chartProxies/chartProxy.ts", "../../src/charts/chartComp/chartProxies/cartesian/cartesianChartProxy.ts", "../../src/charts/chartComp/chartProxies/cartesian/histogramChartProxy.ts", "../../src/charts/chartComp/chartProxies/cartesian/waterfallChartProxy.ts", "../../src/charts/chartComp/chartProxies/hierarchical/hierarchicalChartProxy.ts", "../../src/charts/chartComp/chartProxies/hierarchical/hierarchicalChartUtils.ts", "../../src/charts/chartComp/chartProxies/polar/polarChartProxy.ts", "../../src/charts/chartComp/utils/array.ts", "../../src/charts/chartComp/chartProxies/specialized/heatmapChartProxy.ts", "../../src/charts/chartComp/model/chartDataModel.ts", "../../src/charts/chartComp/datasource/chartDatasource.ts", "../../src/charts/chartComp/services/chartColumnService.ts", "../../src/charts/chartComp/model/comboChartModel.ts", "../../src/charts/chartComp/chartProxies/statistical/statisticalChartProxy.ts", "../../src/charts/chartComp/chartProxies/statistical/boxPlotChartProxy.ts", "../../src/charts/chartComp/chartProxies/statistical/rangeChartProxy.ts", "../../src/charts/chartComp/menu/advancedSettings/advancedSettingsMenuFactory.ts", "../../src/charts/chartComp/menu/advancedSettings/advancedSettingsPanel.ts", "../../src/charts/chartComp/menu/chartPanelFeature.ts", "../../src/charts/chartComp/menu/advancedSettings/interactivity/animationPanel.ts", "../../src/charts/chartComp/menu/advancedSettings/interactivity/crosshairPanel.ts", "../../src/charts/widgets/agColorPicker.ts", "../../src/charts/widgets/agColorPanel.ts", "../../src/charts/widgets/agColorInput.ts", "../../src/charts/chartComp/menu/advancedSettings/interactivity/navigatorPanel.ts", "../../src/charts/widgets/agSlider.ts", "../../src/charts/widgets/agInputRange.ts", "../../src/charts/chartComp/menu/advancedSettings/interactivity/zoomPanel.ts", "../../src/charts/chartComp/menu/chartMenuList.ts", "../../src/charts/chartComp/services/chartCrossFilterService.ts", "../../src/charts/chartComp/services/chartMenuService.ts", "../../src/charts/chartComp/services/chartTranslationService.ts", "../../src/charts/chartService.ts", "../../src/charts/chartComp/gridChartComp.ts", "../../src/charts/chartComp/chartController.ts", "../../src/charts/chartComp/utils/chartParamsValidator.ts", "../../src/charts/chartComp/chartProxies/cartesian/areaChartProxy.ts", "../../src/charts/chartComp/utils/color.ts", "../../src/charts/chartComp/chartProxies/cartesian/barChartProxy.ts", "../../src/charts/chartComp/chartProxies/cartesian/lineChartProxy.ts", "../../src/charts/chartComp/chartProxies/cartesian/scatterChartProxy.ts", "../../src/charts/chartComp/chartProxies/combo/comboChartProxy.ts", "../../src/charts/chartComp/chartProxies/pie/pieChartProxy.ts", "../../src/charts/chartComp/menu/chartMenu.ts", "../../src/charts/chartComp/menu/chartToolbar.ts", "../../src/charts/chartComp/menu/tabbedChartMenu.ts", "../../src/charts/chartComp/menu/data/chartDataPanel.ts", "../../src/charts/chartComp/menu/data/categoriesDataPanel.ts", "../../src/charts/chartComp/menu/data/dragDataPanel.ts", "../../src/charts/widgets/agPillSelect.ts", "../../src/charts/widgets/agPillSelect.css-GENERATED.ts", "../../src/charts/chartComp/menu/data/chartSpecificDataPanel.ts", "../../src/charts/chartComp/menu/chartMenuParamsFactory.ts", "../../src/charts/chartComp/menu/data/seriesChartTypePanel.ts", "../../src/charts/chartComp/menu/data/seriesDataPanel.ts", "../../src/charts/chartComp/menu/format/formatPanel.ts", "../../src/charts/chartComp/menu/format/axis/cartesianAxisPanel.ts", "../../src/charts/widgets/agAngleSelect.ts", "../../src/charts/chartComp/menu/format/fontPanel.ts", "../../src/charts/chartComp/menu/format/axis/axisTicksPanel.ts", "../../src/charts/chartComp/menu/format/axis/gridLinePanel.ts", "../../src/charts/chartComp/menu/format/axis/polarAxisPanel.ts", "../../src/charts/chartComp/menu/format/chart/chartPanel.ts", "../../src/charts/chartComp/menu/format/chart/backgroundPanel.ts", "../../src/charts/chartComp/menu/format/chart/paddingPanel.ts", "../../src/charts/chartComp/menu/format/groupExpansionFeature.ts", "../../src/charts/chartComp/menu/format/legend/legendPanel.ts", "../../src/charts/chartComp/menu/format/series/seriesPanel.ts", "../../src/charts/chartComp/menu/format/series/calloutPanel.ts", "../../src/charts/chartComp/menu/format/series/capsPanel.ts", "../../src/charts/chartComp/menu/format/series/connectorLinePanel.ts", "../../src/charts/chartComp/menu/format/series/markersPanel.ts", "../../src/charts/chartComp/menu/format/series/seriesUtils.ts", "../../src/charts/chartComp/menu/format/series/seriesItemsPanel.ts", "../../src/charts/chartComp/menu/format/series/shadowPanel.ts", "../../src/charts/chartComp/menu/format/series/tileSpacingPanel.ts", "../../src/charts/chartComp/menu/format/series/whiskersPanel.ts", "../../src/charts/chartComp/menu/format/titles/titlesPanel.ts", "../../src/charts/chartComp/menu/format/titles/titlePanel.ts", "../../src/charts/chartComp/menu/format/titles/chartTitlePanel.ts", "../../src/charts/chartComp/menu/settings/chartSettingsPanel.ts", "../../src/charts/chartComp/menu/settings/miniChartsContainer.ts", "../../src/charts/chartComp/menu/settings/miniCharts/miniChartHelpers.ts", "../../src/charts/chartComp/menu/settings/miniCharts/miniChart.ts", "../../src/charts/chartComp/menu/settings/miniCharts/miniChartWithAxes.ts", "../../src/charts/chartComp/menu/settings/miniCharts/column/miniColumn.ts", "../../src/charts/chartComp/menu/settings/miniCharts/column/miniStackedColumn.ts", "../../src/charts/chartComp/menu/settings/miniCharts/column/miniNormalizedColumn.ts", "../../src/charts/chartComp/menu/settings/miniCharts/bar/miniBar.ts", "../../src/charts/chartComp/menu/settings/miniCharts/bar/miniStackedBar.ts", "../../src/charts/chartComp/menu/settings/miniCharts/bar/miniNormalizedBar.ts", "../../src/charts/chartComp/menu/settings/miniCharts/pie/miniDonut.ts", "../../src/charts/chartComp/menu/settings/miniCharts/pie/miniPie.ts", "../../src/charts/chartComp/menu/settings/miniCharts/line/miniLine.ts", "../../src/charts/chartComp/menu/settings/miniCharts/line/miniStackedLine.ts", "../../src/charts/chartComp/menu/settings/miniCharts/line/miniNormalizedLine.ts", "../../src/charts/chartComp/menu/settings/miniCharts/scatter/miniScatter.ts", "../../src/charts/chartComp/menu/settings/miniCharts/scatter/miniBubble.ts", "../../src/charts/chartComp/menu/settings/miniCharts/area/miniArea.ts", "../../src/charts/chartComp/menu/settings/miniCharts/area/miniStackedArea.ts", "../../src/charts/chartComp/menu/settings/miniCharts/area/miniNormalizedArea.ts", "../../src/charts/chartComp/menu/settings/miniCharts/histogram/miniHistogram.ts", "../../src/charts/chartComp/menu/settings/miniCharts/miniChartWithPolarAxes.ts", "../../src/charts/chartComp/menu/settings/miniCharts/polar/miniRadialColumn.ts", "../../src/charts/chartComp/menu/settings/miniCharts/polar/miniRadialBar.ts", "../../src/charts/chartComp/menu/settings/miniCharts/polar/miniRadarLine.ts", "../../src/charts/chartComp/menu/settings/miniCharts/polar/miniRadarArea.ts", "../../src/charts/chartComp/menu/settings/miniCharts/polar/miniNightingale.ts", "../../src/charts/chartComp/menu/settings/miniCharts/statistical/miniRangeBar.ts", "../../src/charts/chartComp/menu/settings/miniCharts/statistical/miniRangeArea.ts", "../../src/charts/chartComp/menu/settings/miniCharts/statistical/miniBoxPlot.ts", "../../src/charts/chartComp/menu/settings/miniCharts/hierarchical/miniTreemap.ts", "../../src/charts/chartComp/menu/settings/miniCharts/hierarchical/miniSunburst.ts", "../../src/charts/chartComp/menu/settings/miniCharts/specialized/miniHeatmap.ts", "../../src/charts/chartComp/menu/settings/miniCharts/specialized/miniWaterfall.ts", "../../src/charts/chartComp/menu/settings/miniCharts/combo/miniColumnLineCombo.ts", "../../src/charts/chartComp/menu/settings/miniCharts/combo/miniAreaColumnCombo.ts", "../../src/charts/chartComp/menu/settings/miniCharts/combo/miniCustomCombo.ts", "../../src/charts/chartComp/services/chartOptionsService.ts", "../../src/charts/chartModelMigration.ts", "../../src/charts/chartsApi.ts", "../../src/charts/integratedChartsModule.css-GENERATED.ts", "../../src/charts/utils/validGridChartsVersion.ts", "../../src/allEnterpriseModule.ts"],
  "sourcesContent": ["export { GridLicenseManager as LicenseManager } from './license/gridLicenseManager';\r\n\r\nexport { getMultipleSheetsAsExcel, exportMultipleSheetsAsExcel } from './excelExport/excelCreator';\r\n\r\nexport type { MultiFilter } from './multiFilter/multiFilter';\r\n\r\nexport type { SetFilter } from './setFilter/setFilter';\r\n\r\nexport { AdvancedFilterModule } from './advancedFilter/advancedFilterModule';\r\nexport { ColumnsToolPanelModule } from './columnToolPanel/columnsToolPanelModule';\r\nexport { MenuModule, ColumnMenuModule, ContextMenuModule } from './menu/menuModule';\r\nexport { RichSelectModule } from './richSelect/richSelectModule';\r\nexport { SetFilterModule } from './setFilter/setFilterModule';\r\nexport { StatusBarModule } from './statusBar/statusBarModule';\r\nexport { ExcelExportModule } from './excelExport/excelExportModule';\r\nexport { MultiFilterModule } from './multiFilter/multiFilterModule';\r\nexport { GroupFilterModule, RowGroupingPanelModule, RowGroupingModule } from './rowGrouping/rowGroupingModule';\r\nexport { SideBarModule } from './sideBar/sideBarModule';\r\nexport { ViewportRowModelModule } from './viewportRowModel/viewportRowModelModule';\r\nexport { ClipboardModule } from './clipboard/clipboardModule';\r\nexport { FiltersToolPanelModule } from './filterToolPanel/filtersToolPanelModule';\r\nexport { MasterDetailModule } from './masterDetail/masterDetailModule';\r\nexport { CellSelectionModule, RangeSelectionModule } from './rangeSelection/rangeSelectionModule';\r\nexport { ServerSideRowModelModule, ServerSideRowModelApiModule } from './serverSideRowModel/serverSideRowModelModule';\r\nexport { SparklinesModule } from './sparkline/sparklinesModule';\r\nexport { TreeDataModule } from './treeData/treeDataModule';\r\nexport { AggregationModule } from './aggregation/aggregationModule';\r\nexport { PivotModule } from './pivot/pivotModule';\r\n\r\nexport { GridChartsModule, IntegratedChartsModule } from './charts/integratedChartsModule';\r\n\r\nexport { AllEnterpriseModule } from './allEnterpriseModule';\r\n\r\nexport * from 'ag-grid-community';\r\n", "import type { ComponentSelector, IWatermark, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub, _getDocument } from 'ag-grid-community';\r\n\r\nimport type { ILicenseManager } from './shared/licenseManager';\r\nimport { LicenseManager } from './shared/licenseManager';\r\nimport { AgWatermarkSelector } from './watermark';\r\n\r\nexport class GridLicenseManager extends BeanStub implements NamedBean, IWatermark {\r\n    beanName = 'licenseManager' as const;\r\n\r\n    private licenseManager: LicenseManager;\r\n\r\n    public postConstruct(): void {\r\n        this.validateLicense();\r\n    }\r\n\r\n    public validateLicense(): void {\r\n        this.licenseManager = new LicenseManager(_getDocument(this.beans));\r\n        this.licenseManager.validateLicense();\r\n    }\r\n\r\n    static getLicenseDetails(licenseKey: string) {\r\n        return new LicenseManager(null as any).getLicenseDetails(licenseKey);\r\n    }\r\n\r\n    public getWatermarkSelector(): ComponentSelector {\r\n        return AgWatermarkSelector;\r\n    }\r\n\r\n    public isDisplayWatermark(): boolean {\r\n        return this.licenseManager.isDisplayWatermark();\r\n    }\r\n\r\n    public getWatermarkMessage(): string {\r\n        return this.licenseManager.getWatermarkMessage();\r\n    }\r\n\r\n    static setLicenseKey(licenseKey: string): void {\r\n        LicenseManager.setLicenseKey(licenseKey);\r\n    }\r\n\r\n    static setChartsLicenseManager(chartsLicenseManager: ILicenseManager) {\r\n        LicenseManager.setChartsLicenseManager(chartsLicenseManager);\r\n    }\r\n}\r\n", "export class MD5 {\r\n    private ieCompatibility = false;\r\n\r\n    public init(): void {\r\n        this.ieCompatibility = this.md5('hello') != '5d41402abc4b2a76b9719d911017c592';\r\n    }\r\n\r\n    private md5cycle(x: any, k: any) {\r\n        let a: any = x[0],\r\n            b: any = x[1],\r\n            c: any = x[2],\r\n            d: any = x[3];\r\n\r\n        a = this.ff(a, b, c, d, k[0], 7, -680876936);\r\n        d = this.ff(d, a, b, c, k[1], 12, -389564586);\r\n        c = this.ff(c, d, a, b, k[2], 17, 606105819);\r\n        b = this.ff(b, c, d, a, k[3], 22, -1044525330);\r\n        a = this.ff(a, b, c, d, k[4], 7, -176418897);\r\n        d = this.ff(d, a, b, c, k[5], 12, 1200080426);\r\n        c = this.ff(c, d, a, b, k[6], 17, -1473231341);\r\n        b = this.ff(b, c, d, a, k[7], 22, -45705983);\r\n        a = this.ff(a, b, c, d, k[8], 7, 1770035416);\r\n        d = this.ff(d, a, b, c, k[9], 12, -1958414417);\r\n        c = this.ff(c, d, a, b, k[10], 17, -42063);\r\n        b = this.ff(b, c, d, a, k[11], 22, -1990404162);\r\n        a = this.ff(a, b, c, d, k[12], 7, 1804603682);\r\n        d = this.ff(d, a, b, c, k[13], 12, -40341101);\r\n        c = this.ff(c, d, a, b, k[14], 17, -1502002290);\r\n        b = this.ff(b, c, d, a, k[15], 22, 1236535329);\r\n\r\n        a = this.gg(a, b, c, d, k[1], 5, -165796510);\r\n        d = this.gg(d, a, b, c, k[6], 9, -1069501632);\r\n        c = this.gg(c, d, a, b, k[11], 14, 643717713);\r\n        b = this.gg(b, c, d, a, k[0], 20, -373897302);\r\n        a = this.gg(a, b, c, d, k[5], 5, -701558691);\r\n        d = this.gg(d, a, b, c, k[10], 9, 38016083);\r\n        c = this.gg(c, d, a, b, k[15], 14, -660478335);\r\n        b = this.gg(b, c, d, a, k[4], 20, -405537848);\r\n        a = this.gg(a, b, c, d, k[9], 5, 568446438);\r\n        d = this.gg(d, a, b, c, k[14], 9, -1019803690);\r\n        c = this.gg(c, d, a, b, k[3], 14, -187363961);\r\n        b = this.gg(b, c, d, a, k[8], 20, 1163531501);\r\n        a = this.gg(a, b, c, d, k[13], 5, -1444681467);\r\n        d = this.gg(d, a, b, c, k[2], 9, -51403784);\r\n        c = this.gg(c, d, a, b, k[7], 14, 1735328473);\r\n        b = this.gg(b, c, d, a, k[12], 20, -1926607734);\r\n\r\n        a = this.hh(a, b, c, d, k[5], 4, -378558);\r\n        d = this.hh(d, a, b, c, k[8], 11, -2022574463);\r\n        c = this.hh(c, d, a, b, k[11], 16, 1839030562);\r\n        b = this.hh(b, c, d, a, k[14], 23, -35309556);\r\n        a = this.hh(a, b, c, d, k[1], 4, -1530992060);\r\n        d = this.hh(d, a, b, c, k[4], 11, 1272893353);\r\n        c = this.hh(c, d, a, b, k[7], 16, -155497632);\r\n        b = this.hh(b, c, d, a, k[10], 23, -1094730640);\r\n        a = this.hh(a, b, c, d, k[13], 4, 681279174);\r\n        d = this.hh(d, a, b, c, k[0], 11, -358537222);\r\n        c = this.hh(c, d, a, b, k[3], 16, -722521979);\r\n        b = this.hh(b, c, d, a, k[6], 23, 76029189);\r\n        a = this.hh(a, b, c, d, k[9], 4, -640364487);\r\n        d = this.hh(d, a, b, c, k[12], 11, -421815835);\r\n        c = this.hh(c, d, a, b, k[15], 16, 530742520);\r\n        b = this.hh(b, c, d, a, k[2], 23, -995338651);\r\n\r\n        a = this.ii(a, b, c, d, k[0], 6, -198630844);\r\n        d = this.ii(d, a, b, c, k[7], 10, 1126891415);\r\n        c = this.ii(c, d, a, b, k[14], 15, -1416354905);\r\n        b = this.ii(b, c, d, a, k[5], 21, -57434055);\r\n        a = this.ii(a, b, c, d, k[12], 6, 1700485571);\r\n        d = this.ii(d, a, b, c, k[3], 10, -1894986606);\r\n        c = this.ii(c, d, a, b, k[10], 15, -1051523);\r\n        b = this.ii(b, c, d, a, k[1], 21, -2054922799);\r\n        a = this.ii(a, b, c, d, k[8], 6, 1873313359);\r\n        d = this.ii(d, a, b, c, k[15], 10, -30611744);\r\n        c = this.ii(c, d, a, b, k[6], 15, -1560198380);\r\n        b = this.ii(b, c, d, a, k[13], 21, 1309151649);\r\n        a = this.ii(a, b, c, d, k[4], 6, -145523070);\r\n        d = this.ii(d, a, b, c, k[11], 10, -1120210379);\r\n        c = this.ii(c, d, a, b, k[2], 15, 718787259);\r\n        b = this.ii(b, c, d, a, k[9], 21, -343485551);\r\n\r\n        x[0] = this.add32(a, x[0]);\r\n        x[1] = this.add32(b, x[1]);\r\n        x[2] = this.add32(c, x[2]);\r\n        x[3] = this.add32(d, x[3]);\r\n    }\r\n\r\n    private cmn(q: any, a: any, b: any, x: any, s: any, t: any) {\r\n        a = this.add32(this.add32(a, q), this.add32(x, t));\r\n        return this.add32((a << s) | (a >>> (32 - s)), b);\r\n    }\r\n\r\n    private ff(a: any, b: any, c: any, d: any, x: any, s: any, t: any) {\r\n        return this.cmn((b & c) | (~b & d), a, b, x, s, t);\r\n    }\r\n\r\n    private gg(a: any, b: any, c: any, d: any, x: any, s: any, t: any) {\r\n        return this.cmn((b & d) | (c & ~d), a, b, x, s, t);\r\n    }\r\n\r\n    private hh(a: any, b: any, c: any, d: any, x: any, s: any, t: any) {\r\n        return this.cmn(b ^ c ^ d, a, b, x, s, t);\r\n    }\r\n\r\n    private ii(a: any, b: any, c: any, d: any, x: any, s: any, t: any) {\r\n        return this.cmn(c ^ (b | ~d), a, b, x, s, t);\r\n    }\r\n\r\n    private md51(s: any) {\r\n        const n: any = s.length;\r\n        const state: any = [1732584193, -271733879, -1732584194, 271733878];\r\n        let i: any;\r\n        for (i = 64; i <= s.length; i += 64) {\r\n            this.md5cycle(state, this.md5blk(s.substring(i - 64, i)));\r\n        }\r\n        s = s.substring(i - 64);\r\n        const tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        for (i = 0; i < s.length; i++) {\r\n            tail[i >> 2] |= s.charCodeAt(i) << (i % 4 << 3);\r\n        }\r\n        tail[i >> 2] |= 0x80 << (i % 4 << 3);\r\n        if (i > 55) {\r\n            this.md5cycle(state, tail);\r\n            for (i = 0; i < 16; i++) {\r\n                tail[i] = 0;\r\n            }\r\n        }\r\n        tail[14] = n * 8;\r\n        this.md5cycle(state, tail);\r\n        return state;\r\n    }\r\n\r\n    /* there needs to be support for Unicode here, * unless we pretend that we can redefine the MD-5\r\n     * algorithm for multi-byte characters (perhaps by adding every four 16-bit characters and\r\n     * shortening the sum to 32 bits). Otherwise I suthis.ggest performing MD-5 as if every character\r\n     * was two bytes--e.g., 0040 0025 = @%--but then how will an ordinary MD-5 sum be matched?\r\n     * There is no way to standardize text to something like UTF-8 before transformation; speed cost is\r\n     * utterly prohibitive. The JavaScript standard itself needs to look at this: it should start\r\n     * providing access to strings as preformed UTF-8 8-bit unsigned value arrays.\r\n     */\r\n    private md5blk(s: any) {\r\n        /* I figured global was faster.   */\r\n        const md5blks: any = [];\r\n\r\n        /* Andy King said do it this way. */\r\n        for (let i = 0; i < 64; i += 4) {\r\n            md5blks[i >> 2] =\r\n                s.charCodeAt(i) +\r\n                (s.charCodeAt(i + 1) << 8) +\r\n                (s.charCodeAt(i + 2) << 16) +\r\n                (s.charCodeAt(i + 3) << 24);\r\n        }\r\n        return md5blks;\r\n    }\r\n\r\n    private rhex(n: any) {\r\n        const hex_chr: any = '0123456789abcdef'.split('');\r\n        let s: string = '',\r\n            j: any = 0;\r\n        for (; j < 4; j++) {\r\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0f] + hex_chr[(n >> (j * 8)) & 0x0f];\r\n        }\r\n        return s;\r\n    }\r\n\r\n    private hex(x: any) {\r\n        for (let i: any = 0; i < x.length; i++) {\r\n            x[i] = this.rhex(x[i]);\r\n        }\r\n        return x.join('');\r\n    }\r\n\r\n    public md5(s: any) {\r\n        return this.hex(this.md51(s));\r\n    }\r\n\r\n    private add32(a: any, b: any) {\r\n        return this.ieCompatibility ? this.add32Compat(a, b) : this.add32Std(a, b);\r\n    }\r\n\r\n    /* this function is much faster, so if possible we use it. Some IEs are the only ones I know of that\r\n     need the idiotic second function, generated by an if clause.  */\r\n    private add32Std(a: any, b: any) {\r\n        return (a + b) & 0xffffffff;\r\n    }\r\n\r\n    private add32Compat(x: any, y: any) {\r\n        const lsw = (x & 0xffff) + (y & 0xffff),\r\n            msw = (x >> 16) + (y >> 16) + (lsw >> 16);\r\n        return (msw << 16) | (lsw & 0xffff);\r\n    }\r\n}\r\n", "import { MD5 } from './md5';\r\n\r\nconst LICENSE_TYPES = {\r\n    '01': 'GRID',\r\n    '02': 'CHARTS',\r\n    '0102': 'BOTH',\r\n};\r\nconst LICENSING_HELP_URL = 'https://ag-grid.com/licensing/';\r\n\r\nexport interface ILicenseManager {\r\n    setLicenseKey: (key?: string, gridContext?: boolean) => void;\r\n}\r\n\r\nexport class LicenseManager {\r\n    private static RELEASE_INFORMATION: string = 'MTczMzc1NjY3OTc2Mw==';\r\n    private static licenseKey: string;\r\n    private static chartsLicenseManager?: ILicenseManager;\r\n    private watermarkMessage: string | undefined = undefined;\r\n\r\n    private md5: MD5;\r\n    private document: Document;\r\n\r\n    private totalMessageLength = 124;\r\n\r\n    constructor(document: Document) {\r\n        this.document = document;\r\n\r\n        this.md5 = new MD5();\r\n        this.md5.init();\r\n    }\r\n\r\n    public validateLicense(): void {\r\n        const licenseDetails = this.getLicenseDetails(LicenseManager.licenseKey);\r\n        const currentLicenseName = `AG Grid ${licenseDetails.currentLicenseType === 'BOTH' ? 'and AG Charts ' : ''}Enterprise`;\r\n        const suppliedLicenseName =\r\n            licenseDetails.suppliedLicenseType === undefined\r\n                ? ''\r\n                : `AG ${licenseDetails.suppliedLicenseType === 'BOTH' ? 'Grid and AG Charts' : licenseDetails.suppliedLicenseType === 'GRID' ? 'Grid' : 'Charts'} Enterprise`;\r\n\r\n        if (licenseDetails.missing) {\r\n            if (!this.isWebsiteUrl() || this.isForceWatermark()) {\r\n                this.outputMissingLicenseKey(currentLicenseName);\r\n            }\r\n        } else if (licenseDetails.expired) {\r\n            const gridReleaseDate = LicenseManager.getGridReleaseDate();\r\n            const formattedReleaseDate = LicenseManager.formatDate(gridReleaseDate);\r\n            this.outputExpiredKey(licenseDetails.expiry, formattedReleaseDate, currentLicenseName, suppliedLicenseName);\r\n        } else if (!licenseDetails.valid) {\r\n            this.outputInvalidLicenseKey(\r\n                !!licenseDetails.incorrectLicenseType,\r\n                currentLicenseName,\r\n                suppliedLicenseName\r\n            );\r\n        } else if (licenseDetails.isTrial && licenseDetails.trialExpired) {\r\n            this.outputExpiredTrialKey(licenseDetails.expiry, currentLicenseName, suppliedLicenseName);\r\n        }\r\n    }\r\n\r\n    private static extractExpiry(license: string) {\r\n        const restrictionHashed = license.substring(license.lastIndexOf('_') + 1, license.length);\r\n        return new Date(parseInt(LicenseManager.decode(restrictionHashed), 10));\r\n    }\r\n\r\n    private static extractLicenseComponents(licenseKey: string) {\r\n        // when users copy the license key from a PDF extra zero width characters are sometimes copied too\r\n        // carriage returns and line feeds are problematic too\r\n        // all of which causes license key validation to fail - strip these out\r\n        let cleanedLicenseKey = licenseKey.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\r\n        cleanedLicenseKey = cleanedLicenseKey.replace(/\\r?\\n|\\r/g, '');\r\n\r\n        // the hash that follows the key is 32 chars long\r\n        if (licenseKey.length <= 32) {\r\n            return { md5: null, license: licenseKey, version: null, isTrial: null };\r\n        }\r\n\r\n        const hashStart = cleanedLicenseKey.length - 32;\r\n        const md5 = cleanedLicenseKey.substring(hashStart);\r\n        const license = cleanedLicenseKey.substring(0, hashStart);\r\n        const [version, isTrial, type] = LicenseManager.extractBracketedInformation(cleanedLicenseKey);\r\n        return { md5, license, version, isTrial, type };\r\n    }\r\n\r\n    public getLicenseDetails(licenseKey: string) {\r\n        const currentLicenseType = LicenseManager.chartsLicenseManager ? 'BOTH' : 'GRID';\r\n        if (!licenseKey?.length) {\r\n            return {\r\n                licenseKey,\r\n                valid: false,\r\n                missing: true,\r\n                currentLicenseType,\r\n            };\r\n        }\r\n\r\n        const gridReleaseDate = LicenseManager.getGridReleaseDate();\r\n        const { md5, license, version, isTrial, type } = LicenseManager.extractLicenseComponents(licenseKey);\r\n        let valid = md5 === this.md5.md5(license) && licenseKey.indexOf('For_Trialing_ag-Grid_Only') === -1;\r\n        let trialExpired: undefined | boolean = undefined;\r\n        let expired: undefined | boolean = undefined;\r\n        let expiry: Date | null = null;\r\n        let incorrectLicenseType = false;\r\n        let suppliedLicenseType: undefined | string = undefined;\r\n\r\n        function handleTrial() {\r\n            const now = new Date();\r\n            trialExpired = expiry! < now;\r\n            expired = undefined;\r\n        }\r\n\r\n        if (valid) {\r\n            expiry = LicenseManager.extractExpiry(license);\r\n            valid = !isNaN(expiry.getTime());\r\n\r\n            if (valid) {\r\n                expired = gridReleaseDate > expiry;\r\n\r\n                switch (version) {\r\n                    case 'legacy':\r\n                    case '2': {\r\n                        if (isTrial) {\r\n                            handleTrial();\r\n                        }\r\n                        break;\r\n                    }\r\n                    case '3': {\r\n                        if (!type?.length) {\r\n                            valid = false;\r\n                        } else {\r\n                            suppliedLicenseType = type;\r\n                            if (\r\n                                (type !== LICENSE_TYPES['01'] && type !== LICENSE_TYPES['0102']) ||\r\n                                (currentLicenseType === 'BOTH' && suppliedLicenseType !== 'BOTH')\r\n                            ) {\r\n                                valid = false;\r\n                                incorrectLicenseType = true;\r\n                            } else if (isTrial) {\r\n                                handleTrial();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!valid) {\r\n            return {\r\n                licenseKey,\r\n                valid,\r\n                incorrectLicenseType,\r\n                currentLicenseType,\r\n                suppliedLicenseType,\r\n            };\r\n        }\r\n\r\n        return {\r\n            licenseKey,\r\n            valid,\r\n            expiry: LicenseManager.formatDate(expiry),\r\n            expired,\r\n            version,\r\n            isTrial,\r\n            trialExpired,\r\n            incorrectLicenseType,\r\n            currentLicenseType,\r\n            suppliedLicenseType,\r\n        };\r\n    }\r\n\r\n    public isDisplayWatermark(): boolean {\r\n        return (\r\n            this.isForceWatermark() || (!this.isLocalhost() && !this.isWebsiteUrl() && !!this.watermarkMessage?.length)\r\n        );\r\n    }\r\n\r\n    public getWatermarkMessage(): string {\r\n        return this.watermarkMessage || '';\r\n    }\r\n\r\n    private getHostname(): string {\r\n        const win = this.document.defaultView || window;\r\n        const loc = win.location;\r\n        const { hostname = '' } = loc;\r\n\r\n        return hostname;\r\n    }\r\n\r\n    private isForceWatermark(): boolean {\r\n        const win = this.document.defaultView || window;\r\n        const loc = win.location;\r\n        const { pathname } = loc;\r\n\r\n        return pathname ? pathname.indexOf('forceWatermark') !== -1 : false;\r\n    }\r\n\r\n    private isWebsiteUrl(): boolean {\r\n        const hostname = this.getHostname();\r\n        return hostname.match(/^((?:[\\w-]+\\.)?ag-grid\\.com)$/) !== null;\r\n    }\r\n\r\n    private isLocalhost(): boolean {\r\n        const hostname = this.getHostname();\r\n        return hostname.match(/^(?:127\\.0\\.0\\.1|localhost)$/) !== null;\r\n    }\r\n\r\n    private static formatDate(date: any): string {\r\n        const monthNames: string[] = [\r\n            'January',\r\n            'February',\r\n            'March',\r\n            'April',\r\n            'May',\r\n            'June',\r\n            'July',\r\n            'August',\r\n            'September',\r\n            'October',\r\n            'November',\r\n            'December',\r\n        ];\r\n\r\n        const day = date.getDate();\r\n        const monthIndex = date.getMonth();\r\n        const year = date.getFullYear();\r\n\r\n        return day + ' ' + monthNames[monthIndex] + ' ' + year;\r\n    }\r\n\r\n    private static getGridReleaseDate() {\r\n        return new Date(parseInt(LicenseManager.decode(LicenseManager.RELEASE_INFORMATION), 10));\r\n    }\r\n\r\n    private static decode(input: string): string {\r\n        const keystr: string = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\n        let t = '';\r\n        let n: any, r: any, i: any;\r\n        let s: any, o: any, u: any, a: any;\r\n        let f: number = 0;\r\n        const e: string = input.replace(/[^A-Za-z0-9+/=]/g, '');\r\n        while (f < e.length) {\r\n            s = keystr.indexOf(e.charAt(f++));\r\n            o = keystr.indexOf(e.charAt(f++));\r\n            u = keystr.indexOf(e.charAt(f++));\r\n            a = keystr.indexOf(e.charAt(f++));\r\n            n = (s << 2) | (o >> 4);\r\n            r = ((o & 15) << 4) | (u >> 2);\r\n            i = ((u & 3) << 6) | a;\r\n            t = t + String.fromCharCode(n);\r\n            if (u != 64) {\r\n                t = t + String.fromCharCode(r);\r\n            }\r\n            if (a != 64) {\r\n                t = t + String.fromCharCode(i);\r\n            }\r\n        }\r\n        t = LicenseManager.utf8_decode(t);\r\n        return t;\r\n    }\r\n\r\n    private static utf8_decode(input: string): string {\r\n        input = input.replace(/rn/g, 'n');\r\n        let t = '';\r\n        for (let n = 0; n < input.length; n++) {\r\n            const r = input.charCodeAt(n);\r\n            if (r < 128) {\r\n                t += String.fromCharCode(r);\r\n            } else if (r > 127 && r < 2048) {\r\n                t += String.fromCharCode((r >> 6) | 192);\r\n                t += String.fromCharCode((r & 63) | 128);\r\n            } else {\r\n                t += String.fromCharCode((r >> 12) | 224);\r\n                t += String.fromCharCode(((r >> 6) & 63) | 128);\r\n                t += String.fromCharCode((r & 63) | 128);\r\n            }\r\n        }\r\n        return t;\r\n    }\r\n\r\n    static setChartsLicenseManager(dependantLicenseManager: ILicenseManager): void {\r\n        this.chartsLicenseManager = dependantLicenseManager;\r\n    }\r\n\r\n    static setLicenseKey(licenseKey: string): void {\r\n        this.licenseKey = licenseKey;\r\n\r\n        this.chartsLicenseManager?.setLicenseKey(licenseKey, true);\r\n    }\r\n\r\n    private static extractBracketedInformation(licenseKey: string): [string | null, boolean | null, string?] {\r\n        // legacy no trial key\r\n        if (!licenseKey.includes('[')) {\r\n            return ['legacy', false, undefined];\r\n        }\r\n\r\n        const matches = licenseKey.match(/\\[(.*?)\\]/g)!.map((match) => match.replace('[', '').replace(']', ''));\r\n        if (!matches || matches.length === 0) {\r\n            return ['legacy', false, undefined];\r\n        }\r\n\r\n        const isTrial = matches.filter((match) => match === 'TRIAL').length === 1;\r\n        const rawVersion = matches.filter((match) => match.indexOf('v') === 0)[0];\r\n        const version = rawVersion ? rawVersion.replace('v', '') : 'legacy';\r\n        const type = (LICENSE_TYPES as any)[matches.filter((match) => (LICENSE_TYPES as any)[match])[0]];\r\n\r\n        return [version, isTrial, type];\r\n    }\r\n\r\n    private centerPadAndOutput(input: string) {\r\n        const paddingRequired = this.totalMessageLength - input.length;\r\n        // eslint-disable-next-line no-console\r\n        console.error(input.padStart(paddingRequired / 2 + input.length, '*').padEnd(this.totalMessageLength, '*'));\r\n    }\r\n\r\n    private padAndOutput(input: string, padding = '*', terminateWithPadding = '') {\r\n        // eslint-disable-next-line no-console\r\n        console.error(\r\n            input.padEnd(this.totalMessageLength - terminateWithPadding.length, padding) + terminateWithPadding\r\n        );\r\n    }\r\n\r\n    private outputInvalidLicenseKey(\r\n        incorrectLicenseType: boolean,\r\n        currentLicenseName: string,\r\n        suppliedLicenseName: string\r\n    ) {\r\n        if (incorrectLicenseType) {\r\n            // TC4, TC5,TC10\r\n            this.centerPadAndOutput('');\r\n            this.centerPadAndOutput(` ${currentLicenseName} License `);\r\n            this.centerPadAndOutput(' Incompatible License Key ');\r\n            this.padAndOutput(\r\n                `* Your license key is for ${suppliedLicenseName} only and does not cover you for ${currentLicenseName}.`,\r\n                ' ',\r\n                '*'\r\n            );\r\n            this.padAndOutput(`* To troubleshoot your license key visit ${LICENSING_HELP_URL}.`, ' ', '*');\r\n            this.centerPadAndOutput('');\r\n            this.centerPadAndOutput('');\r\n        } else {\r\n            // TC3, TC9\r\n            this.centerPadAndOutput('');\r\n            this.centerPadAndOutput(` ${currentLicenseName} License `);\r\n            this.centerPadAndOutput(' Invalid License Key ');\r\n            this.padAndOutput(`* Your license key is not valid.`, ' ', '*');\r\n            this.padAndOutput(`* To troubleshoot your license key visit ${LICENSING_HELP_URL}.`, ' ', '*');\r\n            this.centerPadAndOutput('');\r\n            this.centerPadAndOutput('');\r\n        }\r\n\r\n        this.watermarkMessage = 'Invalid License';\r\n    }\r\n\r\n    private outputExpiredTrialKey(\r\n        formattedExpiryDate: string,\r\n        currentLicenseName: string,\r\n        suppliedLicenseName: string\r\n    ) {\r\n        // TC14\r\n        this.centerPadAndOutput('');\r\n        this.centerPadAndOutput(` ${currentLicenseName} License `);\r\n        this.centerPadAndOutput(' Trial Period Expired. ');\r\n        this.padAndOutput(\r\n            `* Your trial only license for ${suppliedLicenseName} expired on ${formattedExpiryDate}.`,\r\n            ' ',\r\n            '*'\r\n        );\r\n        this.padAndOutput('* Please email info@ag-grid.com to purchase a license.', ' ', '*');\r\n        this.centerPadAndOutput('');\r\n        this.centerPadAndOutput('');\r\n\r\n        this.watermarkMessage = 'Trial Period Expired';\r\n    }\r\n\r\n    private outputMissingLicenseKey(currentLicenseName: string) {\r\n        // TC6, TC12\r\n        this.centerPadAndOutput('');\r\n        this.centerPadAndOutput(` ${currentLicenseName} License `);\r\n        this.centerPadAndOutput(' License Key Not Found ');\r\n        this.padAndOutput(`* All ${currentLicenseName} features are unlocked for trial.`, ' ', '*');\r\n        this.padAndOutput(\r\n            '* If you want to hide the watermark please email info@ag-grid.com for a trial license key.',\r\n            ' ',\r\n            '*'\r\n        );\r\n        this.centerPadAndOutput('');\r\n        this.centerPadAndOutput('');\r\n\r\n        this.watermarkMessage = 'For Trial Use Only';\r\n    }\r\n\r\n    private outputExpiredKey(\r\n        formattedExpiryDate: string,\r\n        formattedReleaseDate: string,\r\n        currentLicenseName: string,\r\n        suppliedLicenseName: string\r\n    ) {\r\n        // TC2\r\n        this.centerPadAndOutput('');\r\n        this.centerPadAndOutput(` ${currentLicenseName} License `);\r\n        this.centerPadAndOutput(' Incompatible Software Version ');\r\n        this.padAndOutput(\r\n            `* Your license key works with versions of ${suppliedLicenseName} released before ${formattedExpiryDate}.`,\r\n            ' ',\r\n            '*'\r\n        );\r\n        this.padAndOutput(`* The version you are trying to use was released on ${formattedReleaseDate}.`, ' ', '*');\r\n        this.padAndOutput('* Please contact info@ag-grid.com to renew your license key.', ' ', '*');\r\n        this.centerPadAndOutput('');\r\n        this.centerPadAndOutput('');\r\n\r\n        this.watermarkMessage = 'License Expired';\r\n    }\r\n}\r\n", "import type { BeanCollection, ComponentSelector } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { GridLicenseManager as LicenseManager } from './gridLicenseManager';\r\nimport { watermarkCSS } from './watermark.css-GENERATED';\r\n\r\nexport class AgWatermark extends Component {\r\n    licenseManager: LicenseManager;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.licenseManager = beans.licenseManager as LicenseManager;\r\n    }\r\n\r\n    private readonly eLicenseTextRef: HTMLElement = RefPlaceholder;\r\n\r\n    constructor() {\r\n        super(\r\n            /* html*/\r\n            `<div class=\"ag-watermark\">\r\n                <div data-ref=\"eLicenseTextRef\" class=\"ag-watermark-text\"></div>\r\n            </div>`\r\n        );\r\n        this.registerCSS(watermarkCSS);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const show = this.shouldDisplayWatermark();\r\n        this.setDisplayed(show);\r\n\r\n        if (show) {\r\n            this.eLicenseTextRef.innerText = this.licenseManager.getWatermarkMessage();\r\n\r\n            window.setTimeout(() => this.addCssClass('ag-opacity-zero'), 0);\r\n            window.setTimeout(() => this.setDisplayed(false), 5000);\r\n        }\r\n    }\r\n\r\n    private shouldDisplayWatermark(): boolean {\r\n        return this.licenseManager.isDisplayWatermark();\r\n    }\r\n}\r\n\r\nexport const AgWatermarkSelector: ComponentSelector = {\r\n    selector: 'AG-WATERMARK',\r\n    component: AgWatermark,\r\n};\r\n", "export const watermarkCSS = /*css*/ `.ag-watermark{bottom:20px;color:#9b9b9b;opacity:.7;position:absolute;transition:opacity 1s ease-out 3s;&:before{background-image:url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDkiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyMDkgMzYiPjxwYXRoIGZpbGw9IiM5QjlCOUIiIGQ9Ik0xOTIuOTkzIDIzLjY1OHYtNy45NDZoLTEzLjU0MWwtNy45NDcgNy45NDZ6TTIwOC4yNSAzLjk1aC0xNi45NzRsLTguMDEgNy45NDdoMjQuOTg0ek0xNjMuNjIyIDMxLjYwNWw0LjA2OS00LjA2OWgxMy43MzJ2Ny45NDdoLTE3LjgwMXoiLz48cGF0aCBmaWxsPSIjOUI5QjlCIiBkPSJNMTY2LjYxIDE5Ljc4aDguNzczbDguMDEtNy45NDZIMTY2LjYxek0xNTcuMDExIDMxLjYwNWg2LjYxMWw3Ljg4My03Ljk0N2gtMTQuNDk0ek0xOTEuMjc2IDMuOTVsLTQuMDY4IDQuMDdIMTYxLjI3Vi4wNzJoMzAuMDA2ek0yMC44NCAzMC4yMDZIOC4zNzhsLTIuMTYyIDUuMzRILjc1TDEyLjI1NyA4LjU5Mmg0Ljc2OEwyOC41MyAzNS41NDZoLTUuNTN6bS0xLjcxNy00LjI2TDE0LjYwOSAxNC45NWwtNC41MTQgMTAuOTk4ek0xMDQuNDM3IDE4LjUwOWMxLjU4OS0yLjM1MiA1LjU5NC0yLjYwNyA3LjI0Ny0yLjYwN3Y0LjU3OGMtMi4wMzQgMC00LjA2OS4wNjMtNS4yNzcuOTUzLTEuMjA3Ljg5LTEuODQzIDIuMDk4LTEuODQzIDMuNTZ2MTAuNTUzaC00Ljk1OVYxNS45MDJoNC43Njh6TTExOS4zNzYgMTUuOTAyaC00Ljk1OHYxOS42NDRoNC45NTh6TTExOS4zNzYgNy4xM2gtNC45NTh2NS44NDhoNC45NTh6TTE0My45NzkgNy4xM3YyOC40MTZoLTQuNzY4bC0uMTI3LTIuOTg4YTguMyA4LjMgMCAwIDEtMi42NyAyLjQ4Yy0xLjA4MS41NzItMi40MTYuODktMy45NDIuODktMS4zMzUgMC0yLjYwNi0uMjU1LTMuNjg3LS43LTEuMTQ0LS41MDgtMi4xNjItMS4xNDQtMi45ODgtMi4wMzRhOS42IDkuNiAwIDAgMS0xLjk3MS0zLjE3OWMtLjUwOC0xLjIwNy0uNjk5LTIuNjA2LS42OTktNC4xMzJzLjI1NC0yLjkyNC42OTktNC4xOTZjLjUwOS0xLjI3MSAxLjE0NS0yLjM1MiAxLjk3MS0zLjI0MnMxLjg0NC0xLjU4OSAyLjk4OC0yLjA5OCAyLjM1Mi0uNzYzIDMuNjg3LS43NjNjMS41MjYgMCAyLjc5Ny4yNTUgMy44NzguODI3czEuOTcxIDEuMzM1IDIuNjcgMi40MTZWNy4xOTNoNC45NTl6bS0xMC40MjYgMjQuNTM4YzEuNjUzIDAgMi45MjQtLjU3MiAzLjk0MS0xLjY1M3MxLjUyNi0yLjU0MyAxLjUyNi00LjMyMy0uNTA5LTMuMTc4LTEuNTI2LTQuMzIyYy0xLjAxNy0xLjA4MS0yLjI4OC0xLjY1My0zLjk0MS0xLjY1My0xLjU5IDAtMi45MjUuNTcyLTMuODc4IDEuNjUzLTEuMDE3IDEuMDgtMS41MjYgMi41NDMtMS41MjYgNC4zMjIgMCAxLjc4LjUwOSAzLjE4IDEuNTI2IDQuMjYgMS4wMTcgMS4xNDQgMi4yODggMS43MTYgMy44NzggMS43MTZNNTcuMjAyIDIwLjM1M0g0NC45MzN2NC4yNTloNi45OTNjLS4xOSAyLjE2MS0xLjAxNyAzLjgxNC0yLjQxNiA1LjE1LTEuMzk4IDEuMjctMy4xNzggMS45MDYtNS40NjcgMS45MDYtMS4yNzEgMC0yLjQ4LS4yNTQtMy40OTYtLjY5OWE3IDcgMCAwIDEtMi43MzQtMS45N2MtLjc2My0uODI3LTEuMzM1LTEuODQ0LTEuNzgtMy4wNTJzLS42MzYtMi40OC0uNjM2LTMuOTQyLjE5LTIuNzMzLjYzNi0zLjk0MWMuMzgxLTEuMjA4IDEuMDE3LTIuMTYyIDEuNzgtMy4wNTIuNzYzLS44MjYgMS42NTMtMS40NjIgMi43MzMtMS45N2E5LjEgOS4xIDAgMCAxIDMuNTYtLjdxNC4wMDUgMCA2LjEwMyAxLjkwN2wzLjMwNi0zLjMwNWMtMi40OC0xLjkwNy01LjY1OC0yLjkyNS05LjQwOS0yLjkyNS0yLjA5NyAwLTQuMDA0LjMxOC01LjcyMSAxLjAxOC0xLjcxNi42OTktMy4xNzkgMS41ODktNC4zODYgMi43OTdBMTIuMSAxMi4xIDAgMCAwIDMxLjIgMTYuMjJjLS42MzUgMS43MTctLjk1MyAzLjYyNC0uOTUzIDUuNjU4cy4zMTggMy45NDIgMS4wMTcgNS42NThjLjcgMS43MTcgMS41OSAzLjE3OSAyLjc5NyA0LjM4N2ExMi4xIDEyLjEgMCAwIDAgNC4zODcgMi43OTdjMS43MTYuNyAzLjYyMyAxLjAxNyA1LjY1NyAxLjAxNyAyLjAzNSAwIDMuODc4LS4zMTggNS41MzEtMS4wMTcgMS42NTMtLjcgMy4wNTItMS41OSA0LjE5Ni0yLjc5N3ExLjcxNi0xLjgxMiAyLjY3LTQuMzg3Yy42MzYtMS43MTYuOTU0LTMuNjIzLjk1NC01LjY1OHYtLjgyNmMtLjE5MS0uMTI3LS4yNTUtLjQ0NS0uMjU1LS43TTk1Ljk4MiAyMC4zNTNoLTEyLjI3djQuMjU5aDYuOTkzYy0uMTkgMi4xNjEtMS4wMTcgMy44MTQtMi40MTYgNS4xNS0xLjM5OCAxLjI3LTMuMTc4IDEuOTA2LTUuNDY3IDEuOTA2LTEuMjcxIDAtMi40OC0uMjU0LTMuNDk2LS42OTlhNyA3IDAgMCAxLTIuNzM0LTEuOTdjLS43NjMtLjgyNy0xLjMzNS0xLjg0NC0xLjc4LTMuMDUycy0uNjM2LTIuNDgtLjYzNi0zLjk0Mi4xOS0yLjczMy42MzYtMy45NDFjLjM4MS0xLjIwOCAxLjAxNy0yLjE2MiAxLjc4LTMuMDUyLjc2My0uODI2IDEuNjUzLTEuNDYyIDIuNzM0LTEuOTdhOS4xIDkuMSAwIDAgMSAzLjU2LS43cTQuMDA1IDAgNi4xMDMgMS45MDdsMy4zMDUtMy4zMDVjLTIuNDc5LTEuOTA3LTUuNjU4LTIuOTI1LTkuNDA4LTIuOTI1LTIuMDk4IDAtNC4wMDUuMzE4LTUuNzIyIDEuMDE4LTEuNzE2LjY5OS0zLjE3OCAxLjU4OS00LjM4NiAyLjc5N2ExMi4xIDEyLjEgMCAwIDAtMi43OTcgNC4zODZjLS42MzYgMS43MTctLjk1NCAzLjYyNC0uOTU0IDUuNjU4cy4zMTggMy45NDIgMS4wMTcgNS42NThjLjcgMS43MTcgMS41OSAzLjE3OSAyLjc5NyA0LjM4N2ExMi4xIDEyLjEgMCAwIDAgNC4zODcgMi43OTdjMS43MTYuNyAzLjYyMyAxLjAxNyA1LjY1OCAxLjAxNyAyLjAzNCAwIDMuODc4LS4zMTggNS41My0xLjAxNyAxLjY1My0uNyAzLjA1Mi0xLjU5IDQuMTk2LTIuNzk3cTEuNzE4LTEuODEyIDIuNjctNC4zODdjLjYzNi0xLjcxNi45NTQtMy42MjMuOTU0LTUuNjU4di0uODI2Yy0uMTktLjEyNy0uMjU1LS40NDUtLjI1NS0uNyIvPjwvc3ZnPg==\");background-repeat:no-repeat;background-size:170px 40px;content:\"\";display:block;height:40px;width:170px}}:where(.ag-ltr) .ag-watermark{right:25px}:where(.ag-rtl) .ag-watermark{left:25px}.ag-watermark-text{font-family:Impact,sans-serif;font-size:19px;font-weight:700;opacity:.5}:where(.ag-ltr) .ag-watermark-text{padding-left:.7rem}:where(.ag-rtl) .ag-watermark-text{padding-right:.7rem}`;\n", "import type {\r\n    AgColumn,\r\n    AgColumnGroup,\r\n    ExcelExportMultipleSheetParams,\r\n    ExcelExportParams,\r\n    ExcelFactoryMode,\r\n    ExcelRow,\r\n    ExcelStyle,\r\n    IExcelCreator,\r\n    NamedBean,\r\n} from 'ag-grid-community';\r\nimport { BaseCreator, _downloadFile, _getHeaderClassesFromColDef, _warn } from 'ag-grid-community';\r\n\r\nimport type { ExcelGridSerializingParams, StyleLinkerInterface } from './excelSerializingSession';\r\nimport { ExcelSerializingSession } from './excelSerializingSession';\r\nimport {\r\n    XLSX_IMAGES,\r\n    XLSX_WORKSHEET_DATA_TABLES,\r\n    XLSX_WORKSHEET_HEADER_FOOTER_IMAGES,\r\n    XLSX_WORKSHEET_IMAGES,\r\n    createXlsxContentTypes,\r\n    createXlsxCore,\r\n    createXlsxDrawing,\r\n    createXlsxDrawingRel,\r\n    createXlsxRelationships,\r\n    createXlsxRels,\r\n    createXlsxSharedStrings,\r\n    createXlsxStylesheet,\r\n    createXlsxTable,\r\n    createXlsxTheme,\r\n    createXlsxVmlDrawing,\r\n    createXlsxVmlDrawingRel,\r\n    createXlsxWorkbook,\r\n    createXlsxWorkbookRels,\r\n    getXlsxFactoryMode,\r\n    resetXlsxFactory,\r\n    setXlsxFactoryMode,\r\n} from './excelXlsxFactory';\r\nimport { _normaliseImageExtension } from './files/ooxml/contentTypes';\r\nimport { ZipContainer } from './zipContainer/zipContainer';\r\n\r\nconst createExcelXMLCoreFolderStructure = (zipContainer: ZipContainer): void => {\r\n    zipContainer.addFolders(['_rels/', 'docProps/', 'xl/', 'xl/theme/', 'xl/_rels/', 'xl/worksheets/']);\r\n\r\n    if (!XLSX_IMAGES.size) {\r\n        return;\r\n    }\r\n\r\n    zipContainer.addFolders(['xl/worksheets/_rels', 'xl/drawings/', 'xl/drawings/_rels', 'xl/media/']);\r\n\r\n    let imgCounter = 0;\r\n\r\n    XLSX_IMAGES.forEach((value) => {\r\n        const firstImage = value[0].image[0];\r\n        const { base64, imageType } = firstImage;\r\n\r\n        zipContainer.addFile(`xl/media/image${++imgCounter}.${_normaliseImageExtension(imageType)}`, base64, true);\r\n    });\r\n};\r\n\r\nconst createExcelXmlWorksheets = (zipContainer: ZipContainer, data: string[]): void => {\r\n    let imageRelationCounter = 0;\r\n    let headerFooterImageCounter = 0;\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n        const value = data[i];\r\n        zipContainer.addFile(`xl/worksheets/sheet${i + 1}.xml`, value, false);\r\n\r\n        const hasImages = XLSX_IMAGES.size > 0 && XLSX_WORKSHEET_IMAGES.has(i);\r\n        const tableData = XLSX_WORKSHEET_DATA_TABLES.size > 0 && XLSX_WORKSHEET_DATA_TABLES.get(i);\r\n        const hasHeaderFooterImages = XLSX_IMAGES.size && XLSX_WORKSHEET_HEADER_FOOTER_IMAGES.has(i);\r\n\r\n        if (!hasImages && !tableData && !hasHeaderFooterImages) {\r\n            continue;\r\n        }\r\n\r\n        let tableName: string | undefined;\r\n        let drawingIndex: number | undefined;\r\n        let vmlDrawingIndex: number | undefined;\r\n\r\n        if (hasImages) {\r\n            createExcelXmlDrawings(zipContainer, i, imageRelationCounter);\r\n            drawingIndex = imageRelationCounter;\r\n            imageRelationCounter++;\r\n        }\r\n\r\n        if (hasHeaderFooterImages) {\r\n            createExcelVmlDrawings(zipContainer, i, headerFooterImageCounter);\r\n            vmlDrawingIndex = headerFooterImageCounter;\r\n            headerFooterImageCounter++;\r\n        }\r\n\r\n        if (tableData) {\r\n            tableName = tableData.name;\r\n        }\r\n\r\n        const worksheetRelFile = `xl/worksheets/_rels/sheet${i + 1}.xml.rels`;\r\n\r\n        zipContainer.addFile(\r\n            worksheetRelFile,\r\n            createXlsxRelationships({\r\n                tableName,\r\n                drawingIndex,\r\n                vmlDrawingIndex,\r\n            })\r\n        );\r\n    }\r\n};\r\n\r\nconst createExcelXmlDrawings = (zipContainer: ZipContainer, sheetIndex: number, drawingIndex: number): void => {\r\n    const drawingFolder = 'xl/drawings';\r\n    const drawingFileName = `${drawingFolder}/drawing${drawingIndex + 1}.xml`;\r\n    const relFileName = `${drawingFolder}/_rels/drawing${drawingIndex + 1}.xml.rels`;\r\n\r\n    zipContainer.addFile(relFileName, createXlsxDrawingRel(sheetIndex));\r\n    zipContainer.addFile(drawingFileName, createXlsxDrawing(sheetIndex));\r\n};\r\n\r\nconst createExcelVmlDrawings = (zipContainer: ZipContainer, sheetIndex: number, drawingIndex: number): void => {\r\n    const drawingFolder = 'xl/drawings';\r\n    const drawingFileName = `${drawingFolder}/vmlDrawing${drawingIndex + 1}.vml`;\r\n    const relFileName = `${drawingFolder}/_rels/vmlDrawing${drawingIndex + 1}.vml.rels`;\r\n\r\n    zipContainer.addFile(drawingFileName, createXlsxVmlDrawing(sheetIndex));\r\n    zipContainer.addFile(relFileName, createXlsxVmlDrawingRel(sheetIndex));\r\n};\r\n\r\nconst createExcelXmlTables = (zipContainer: ZipContainer): void => {\r\n    const tablesDataByWorksheet = XLSX_WORKSHEET_DATA_TABLES;\r\n    const worksheetKeys = Array.from(tablesDataByWorksheet.keys());\r\n\r\n    for (let i = 0; i < worksheetKeys.length; i++) {\r\n        const sheetIndex = worksheetKeys[i];\r\n        const table = tablesDataByWorksheet.get(sheetIndex);\r\n\r\n        if (!table) {\r\n            continue;\r\n        }\r\n\r\n        zipContainer.addFile(`xl/tables/${table.name}.xml`, createXlsxTable(table, i));\r\n    }\r\n};\r\n\r\nconst createExcelXmlCoreSheets = (\r\n    zipContainer: ZipContainer,\r\n    fontSize: number,\r\n    author: string,\r\n    sheetLen: number,\r\n    activeTab: number\r\n): void => {\r\n    zipContainer.addFile('xl/workbook.xml', createXlsxWorkbook(activeTab));\r\n    zipContainer.addFile('xl/styles.xml', createXlsxStylesheet(fontSize));\r\n    zipContainer.addFile('xl/sharedStrings.xml', createXlsxSharedStrings());\r\n    zipContainer.addFile('xl/theme/theme1.xml', createXlsxTheme());\r\n    zipContainer.addFile('xl/_rels/workbook.xml.rels', createXlsxWorkbookRels(sheetLen));\r\n    zipContainer.addFile('docProps/core.xml', createXlsxCore(author));\r\n    zipContainer.addFile('[Content_Types].xml', createXlsxContentTypes(sheetLen));\r\n    zipContainer.addFile('_rels/.rels', createXlsxRels());\r\n};\r\n\r\nconst createExcelFileForExcel = (\r\n    zipContainer: ZipContainer,\r\n    data: string[],\r\n    options: {\r\n        columns?: string[];\r\n        rowCount?: number;\r\n        fontSize?: number;\r\n        author?: string;\r\n        activeTab?: number;\r\n    } = {}\r\n): boolean => {\r\n    if (!data || data.length === 0) {\r\n        _warn(159);\r\n        resetXlsxFactory();\r\n        return false;\r\n    }\r\n\r\n    const { fontSize = 11, author = 'AG Grid', activeTab = 0 } = options;\r\n\r\n    const len = data.length;\r\n    const activeTabWithinBounds = Math.max(Math.min(activeTab, len - 1), 0);\r\n\r\n    createExcelXMLCoreFolderStructure(zipContainer);\r\n    createExcelXmlTables(zipContainer);\r\n    createExcelXmlWorksheets(zipContainer, data);\r\n    createExcelXmlCoreSheets(zipContainer, fontSize, author, len, activeTabWithinBounds);\r\n\r\n    resetXlsxFactory();\r\n\r\n    return true;\r\n};\r\n\r\nconst getMultipleSheetsAsExcelCompressed = (params: ExcelExportMultipleSheetParams): Promise<Blob | undefined> => {\r\n    const { data, fontSize, author, activeSheetIndex } = params;\r\n    const mimeType = params.mimeType || 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';\r\n    const zipContainer = new ZipContainer();\r\n\r\n    if (\r\n        !createExcelFileForExcel(zipContainer, data, {\r\n            author,\r\n            fontSize,\r\n            activeTab: activeSheetIndex,\r\n        })\r\n    ) {\r\n        return Promise.resolve(undefined);\r\n    }\r\n\r\n    return zipContainer.getZipFile(mimeType);\r\n};\r\n\r\nexport const getMultipleSheetsAsExcel = (params: ExcelExportMultipleSheetParams): Blob | undefined => {\r\n    const { data, fontSize, author, activeSheetIndex } = params;\r\n    const mimeType = params.mimeType || 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';\r\n    const zipContainer = new ZipContainer();\r\n\r\n    if (\r\n        !createExcelFileForExcel(zipContainer, data, {\r\n            author,\r\n            fontSize,\r\n            activeTab: activeSheetIndex,\r\n        })\r\n    ) {\r\n        return;\r\n    }\r\n\r\n    return zipContainer.getUncompressedZipFile(mimeType);\r\n};\r\n\r\nexport const exportMultipleSheetsAsExcel = (params: ExcelExportMultipleSheetParams) => {\r\n    const { fileName = 'export.xlsx' } = params;\r\n\r\n    getMultipleSheetsAsExcelCompressed(params).then((contents) => {\r\n        if (contents) {\r\n            const downloadFileName = typeof fileName === 'function' ? fileName() : fileName;\r\n\r\n            _downloadFile(downloadFileName, contents);\r\n        }\r\n    });\r\n};\r\n\r\nexport class ExcelCreator\r\n    extends BaseCreator<ExcelRow[], ExcelSerializingSession, ExcelExportParams>\r\n    implements NamedBean, IExcelCreator\r\n{\r\n    beanName = 'excelCreator' as const;\r\n\r\n    protected getMergedParams(params?: ExcelExportParams): ExcelExportParams {\r\n        const baseParams = this.gos.get('defaultExcelExportParams');\r\n        return Object.assign({}, baseParams, params);\r\n    }\r\n\r\n    protected export(userParams?: ExcelExportParams): void {\r\n        if (this.isExportSuppressed()) {\r\n            _warn(160);\r\n            return;\r\n        }\r\n\r\n        const mergedParams = this.getMergedParams(userParams);\r\n        const data = this.getData(mergedParams);\r\n\r\n        const exportParams: ExcelExportMultipleSheetParams = {\r\n            data: [data],\r\n            fontSize: mergedParams.fontSize,\r\n            author: mergedParams.author,\r\n            mimeType: mergedParams.mimeType,\r\n        };\r\n\r\n        this.packageCompressedFile(exportParams).then((packageFile) => {\r\n            if (packageFile) {\r\n                const { fileName } = mergedParams;\r\n                const providedFileName =\r\n                    typeof fileName === 'function' ? fileName(this.gos.getGridCommonParams()) : fileName;\r\n\r\n                _downloadFile(this.getFileName(providedFileName), packageFile);\r\n            }\r\n        });\r\n    }\r\n\r\n    public exportDataAsExcel(params?: ExcelExportParams): void {\r\n        this.export(params);\r\n    }\r\n\r\n    public getDataAsExcel(params?: ExcelExportParams): Blob | string | undefined {\r\n        const mergedParams = this.getMergedParams(params);\r\n        const data = this.getData(mergedParams);\r\n\r\n        const exportParams: ExcelExportMultipleSheetParams = {\r\n            data: [data],\r\n            fontSize: mergedParams.fontSize,\r\n            author: mergedParams.author,\r\n            mimeType: mergedParams.mimeType,\r\n        };\r\n\r\n        return this.packageFile(exportParams);\r\n    }\r\n\r\n    public setFactoryMode(factoryMode: ExcelFactoryMode): void {\r\n        setXlsxFactoryMode(factoryMode);\r\n    }\r\n\r\n    public getFactoryMode(): ExcelFactoryMode {\r\n        return getXlsxFactoryMode();\r\n    }\r\n\r\n    public getSheetDataForExcel(params: ExcelExportParams): string {\r\n        const mergedParams = this.getMergedParams(params);\r\n        return this.getData(mergedParams);\r\n    }\r\n\r\n    public getMultipleSheetsAsExcel(params: ExcelExportMultipleSheetParams): Blob | undefined {\r\n        return getMultipleSheetsAsExcel(params);\r\n    }\r\n\r\n    public exportMultipleSheetsAsExcel(params: ExcelExportMultipleSheetParams): void {\r\n        exportMultipleSheetsAsExcel(params);\r\n    }\r\n\r\n    public getDefaultFileExtension(): 'xlsx' {\r\n        return 'xlsx';\r\n    }\r\n\r\n    public createSerializingSession(params: ExcelExportParams): ExcelSerializingSession {\r\n        const { colModel, colNames, rowGroupColsSvc, valueSvc, gos } = this.beans;\r\n\r\n        const config: ExcelGridSerializingParams = {\r\n            ...params,\r\n            colModel,\r\n            colNames,\r\n            rowGroupColsSvc,\r\n            valueSvc,\r\n            gos,\r\n            suppressRowOutline: params.suppressRowOutline || params.skipRowGroups,\r\n            headerRowHeight: params.headerRowHeight || params.rowHeight,\r\n            baseExcelStyles: gos.get('excelStyles') || [],\r\n            rightToLeft: params.rightToLeft ?? gos.get('enableRtl'),\r\n            styleLinker: this.styleLinker.bind(this),\r\n        };\r\n\r\n        return new ExcelSerializingSession(config);\r\n    }\r\n\r\n    private styleLinker(params: StyleLinkerInterface): string[] {\r\n        const { rowType, rowIndex, value, column, columnGroup, node } = params;\r\n        const isHeader = rowType === 'HEADER';\r\n        const isGroupHeader = rowType === 'HEADER_GROUPING';\r\n        const col = (isHeader ? column : columnGroup) as AgColumn | AgColumnGroup | null;\r\n        let headerClasses: string[] = [];\r\n        const { gos, cellStyles } = this.beans;\r\n\r\n        if (isHeader || isGroupHeader) {\r\n            headerClasses.push('header');\r\n            if (isGroupHeader) {\r\n                headerClasses.push('headerGroup');\r\n            }\r\n\r\n            if (col) {\r\n                headerClasses = headerClasses.concat(\r\n                    _getHeaderClassesFromColDef(\r\n                        col.getDefinition(),\r\n                        gos,\r\n                        (column as AgColumn) || null,\r\n                        (columnGroup as AgColumnGroup) || null\r\n                    )\r\n                );\r\n            }\r\n\r\n            return headerClasses;\r\n        }\r\n\r\n        const styles = gos.get('excelStyles');\r\n\r\n        const applicableStyles: string[] = ['cell'];\r\n\r\n        if (!styles || !styles.length) {\r\n            return applicableStyles;\r\n        }\r\n\r\n        const styleIds: string[] = styles.map((it: ExcelStyle) => {\r\n            return it.id;\r\n        });\r\n\r\n        const colDef = (column as AgColumn).getDefinition();\r\n        cellStyles?.processAllCellClasses(\r\n            colDef,\r\n            gos.addGridCommonParams({\r\n                value,\r\n                data: node!.data,\r\n                node: node!,\r\n                colDef,\r\n                column: column!,\r\n                rowIndex: rowIndex,\r\n            }),\r\n            (className: string) => {\r\n                if (styleIds.indexOf(className) > -1) {\r\n                    applicableStyles.push(className);\r\n                }\r\n            }\r\n        );\r\n\r\n        return applicableStyles.sort((left: string, right: string): number => {\r\n            return styleIds.indexOf(left) < styleIds.indexOf(right) ? -1 : 1;\r\n        });\r\n    }\r\n\r\n    public isExportSuppressed(): boolean {\r\n        return this.gos.get('suppressExcelExport');\r\n    }\r\n\r\n    private packageCompressedFile(params: ExcelExportMultipleSheetParams): Promise<Blob | undefined> {\r\n        return getMultipleSheetsAsExcelCompressed(params);\r\n    }\r\n\r\n    private packageFile(params: ExcelExportMultipleSheetParams): Blob | undefined {\r\n        return getMultipleSheetsAsExcel(params);\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AgColumnGroup,\r\n    Column,\r\n    ColumnGroup,\r\n    ExcelCell,\r\n    ExcelColumn,\r\n    ExcelExportParams,\r\n    ExcelImage,\r\n    ExcelOOXMLDataType,\r\n    ExcelRow,\r\n    ExcelStyle,\r\n    ExcelWorksheet,\r\n    ExcelWorksheetConfigParams,\r\n    GridSerializingParams,\r\n    RowAccumulator,\r\n    RowHeightCallbackParams,\r\n    RowNode,\r\n    RowSpanningAccumulator,\r\n} from 'ag-grid-community';\r\nimport { BaseGridSerializingSession, _last, _mergeDeep, _warn } from 'ag-grid-community';\r\n\r\nimport { getHeightFromProperty } from './assets/excelUtils';\r\nimport { addXlsxBodyImageToMap, createXlsxExcel, getXlsxStringPosition } from './excelXlsxFactory';\r\n\r\nexport interface StyleLinkerInterface {\r\n    rowType: 'HEADER_GROUPING' | 'HEADER' | 'BODY';\r\n    rowIndex: number;\r\n    value: string;\r\n    column?: Column;\r\n    columnGroup?: ColumnGroup;\r\n    node?: RowNode;\r\n}\r\n\r\ninterface ExcelMixedStyle {\r\n    key: string;\r\n    excelID: string;\r\n    result: ExcelStyle;\r\n}\r\n\r\nexport interface ExcelGridSerializingParams extends ExcelWorksheetConfigParams, GridSerializingParams {\r\n    baseExcelStyles: ExcelStyle[];\r\n    styleLinker: (params: StyleLinkerInterface) => string[];\r\n    frozenRowCount?: number;\r\n    frozenColumnCount?: number;\r\n}\r\n\r\nexport class ExcelSerializingSession extends BaseGridSerializingSession<ExcelRow[]> {\r\n    private readonly config: ExcelGridSerializingParams & ExcelExportParams;\r\n    private readonly stylesByIds: { [key: string]: ExcelStyle };\r\n\r\n    private mixedStyles: { [key: string]: ExcelMixedStyle } = {};\r\n    private mixedStyleCounter: number = 0;\r\n\r\n    private readonly excelStyles: (ExcelStyle & { quotePrefix?: 1 })[];\r\n\r\n    private rows: ExcelRow[] = [];\r\n    private cols: ExcelColumn[];\r\n    private columnsToExport: AgColumn[];\r\n    private frozenRowCount: number = 0;\r\n    private skipFrozenRows = false;\r\n    private frozenColumnCount: number = 0;\r\n    private skipFrozenColumns = false;\r\n\r\n    constructor(config: ExcelGridSerializingParams) {\r\n        super(config);\r\n        this.config = Object.assign({}, config);\r\n        this.stylesByIds = {};\r\n        this.config.baseExcelStyles.forEach((style) => {\r\n            this.stylesByIds[style.id] = style;\r\n        });\r\n        this.excelStyles = [...this.config.baseExcelStyles, { id: '_quotePrefix', quotePrefix: 1 }];\r\n    }\r\n\r\n    public addCustomContent(customContent: ExcelRow[]): void {\r\n        customContent.forEach((row) => {\r\n            const rowLen = this.rows.length + 1;\r\n            let outlineLevel: number | undefined;\r\n\r\n            if (!this.config.suppressRowOutline && row.outlineLevel != null) {\r\n                outlineLevel = row.outlineLevel;\r\n            }\r\n\r\n            const rowObj: ExcelRow = {\r\n                height: getHeightFromProperty(rowLen, row.height || this.config.rowHeight),\r\n                cells: (row.cells || []).map((cell, idx) => {\r\n                    const image = this.addImage(rowLen, this.columnsToExport[idx], cell.data?.value as string);\r\n\r\n                    let excelStyles: string[] | null = null;\r\n\r\n                    if (cell.styleId) {\r\n                        excelStyles = typeof cell.styleId === 'string' ? [cell.styleId] : cell.styleId;\r\n                    }\r\n\r\n                    const excelStyleId = this.getStyleId(excelStyles);\r\n\r\n                    if (image) {\r\n                        return this.createCell(\r\n                            excelStyleId,\r\n                            this.getDataTypeForValue(image.value),\r\n                            image.value == null ? '' : image.value\r\n                        );\r\n                    }\r\n\r\n                    const value = cell.data?.value ?? '';\r\n                    const type = this.getDataTypeForValue(value);\r\n\r\n                    if (cell.mergeAcross) {\r\n                        return this.createMergedCell(excelStyleId, type, value, cell.mergeAcross);\r\n                    }\r\n\r\n                    return this.createCell(excelStyleId, type, value);\r\n                }),\r\n                outlineLevel,\r\n            };\r\n\r\n            if (row.collapsed != null) {\r\n                rowObj.collapsed = row.collapsed;\r\n            }\r\n            if (row.hidden != null) {\r\n                rowObj.hidden = row.hidden;\r\n            }\r\n\r\n            this.rows.push(rowObj);\r\n        });\r\n    }\r\n\r\n    public onNewHeaderGroupingRow(): RowSpanningAccumulator {\r\n        const currentCells: ExcelCell[] = [];\r\n        const { freezeRows, headerRowHeight } = this.config;\r\n\r\n        this.rows.push({\r\n            cells: currentCells,\r\n            height: getHeightFromProperty(this.rows.length + 1, headerRowHeight),\r\n        });\r\n\r\n        if (freezeRows) {\r\n            this.frozenRowCount++;\r\n        }\r\n\r\n        return {\r\n            onColumn: (\r\n                columnGroup: AgColumnGroup,\r\n                header: string,\r\n                index: number,\r\n                span: number,\r\n                collapsibleRanges: number[][]\r\n            ) => {\r\n                const styleIds: string[] = this.config.styleLinker({\r\n                    rowType: 'HEADER_GROUPING',\r\n                    rowIndex: 1,\r\n                    value: `grouping-${header}`,\r\n                    columnGroup,\r\n                });\r\n                currentCells.push({\r\n                    ...this.createMergedCell(\r\n                        this.getStyleId(styleIds),\r\n                        this.getDataTypeForValue('string'),\r\n                        header,\r\n                        span\r\n                    ),\r\n                    collapsibleRanges,\r\n                });\r\n            },\r\n        };\r\n    }\r\n\r\n    public onNewHeaderRow(): RowAccumulator {\r\n        const { freezeRows, headerRowHeight } = this.config;\r\n\r\n        if (freezeRows) {\r\n            this.frozenRowCount++;\r\n        }\r\n\r\n        return this.onNewRow(this.onNewHeaderColumn, headerRowHeight);\r\n    }\r\n\r\n    public onNewBodyRow(node?: RowNode): RowAccumulator {\r\n        const { freezeRows, rowHeight } = this.config;\r\n\r\n        if (!this.skipFrozenRows) {\r\n            if (freezeRows === 'headersAndPinnedRows' && node?.rowPinned === 'top') {\r\n                this.frozenRowCount++;\r\n            } else if (typeof freezeRows === 'function') {\r\n                if (freezeRows({ ...this.gos.getGridCommonParams(), node: node! })) {\r\n                    this.frozenRowCount++;\r\n                } else {\r\n                    this.skipFrozenRows = true;\r\n                }\r\n            } else {\r\n                this.skipFrozenRows = true;\r\n            }\r\n        }\r\n\r\n        const rowAccumulator = this.onNewRow(this.onNewBodyColumn, rowHeight);\r\n\r\n        if (node) {\r\n            this.addRowOutlineIfNecessary(node);\r\n        }\r\n\r\n        return rowAccumulator;\r\n    }\r\n\r\n    public override prepare(columnsToExport: AgColumn[]): void {\r\n        super.prepare(columnsToExport);\r\n        this.columnsToExport = [...columnsToExport];\r\n        this.cols = columnsToExport.map((col, i) => this.convertColumnToExcel(col, i));\r\n    }\r\n\r\n    public parse(): string {\r\n        // adding custom content might have made some rows wider than the grid, so add new columns\r\n        const longestRow = this.rows.reduce((a, b) => Math.max(a, b.cells.length), 0);\r\n        while (this.cols.length < longestRow) {\r\n            this.cols.push(this.convertColumnToExcel(null, this.cols.length + 1));\r\n        }\r\n\r\n        const { config } = this;\r\n\r\n        let name: string;\r\n        if (config.sheetName != null) {\r\n            const { sheetName } = config;\r\n            const sheetNameValue =\r\n                typeof sheetName === 'function' ? sheetName(this.gos.getGridCommonParams()) : sheetName;\r\n\r\n            name = String(sheetNameValue).substring(0, 31);\r\n        } else {\r\n            name = 'ag-grid';\r\n        }\r\n\r\n        const data: ExcelWorksheet = {\r\n            name,\r\n            table: {\r\n                columns: this.cols,\r\n                rows: this.rows,\r\n            },\r\n        };\r\n\r\n        return this.createExcel(data);\r\n    }\r\n\r\n    private addRowOutlineIfNecessary(node: RowNode): void {\r\n        const { gos, suppressRowOutline, rowGroupExpandState = 'expanded' } = this.config;\r\n        const isGroupHideOpenParents = gos.get('groupHideOpenParents');\r\n\r\n        if (isGroupHideOpenParents || suppressRowOutline || node.level == null) {\r\n            return;\r\n        }\r\n\r\n        const padding = node.footer ? 1 : 0;\r\n        const currentRow = _last(this.rows);\r\n\r\n        // Excel only supports up to 7 levels of outline\r\n        const outlineLevel = Math.min(node.level + padding, 7);\r\n\r\n        currentRow.outlineLevel = outlineLevel;\r\n\r\n        if (rowGroupExpandState === 'expanded') {\r\n            return;\r\n        }\r\n\r\n        const collapseAll = rowGroupExpandState === 'collapsed';\r\n\r\n        if (node.isExpandable()) {\r\n            const isExpanded = !collapseAll && node.expanded;\r\n            currentRow.collapsed = !isExpanded;\r\n        }\r\n\r\n        currentRow.hidden =\r\n            // always show the node if there is no parent to be expanded\r\n            !!node.parent &&\r\n            // or if it is a child of the root node\r\n            node.parent.level !== -1 &&\r\n            (collapseAll || this.isAnyParentCollapsed(node.parent));\r\n    }\r\n\r\n    private isAnyParentCollapsed(node?: RowNode | null): boolean {\r\n        while (node && node.level !== -1) {\r\n            if (!node.expanded) {\r\n                return true;\r\n            }\r\n\r\n            node = node.parent;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private convertColumnToExcel(column: AgColumn | null, index: number): ExcelColumn {\r\n        const columnWidth = this.config.columnWidth;\r\n        const headerValue = column ? this.extractHeaderValue(column) : undefined;\r\n        const displayName = headerValue ?? '';\r\n        const filterAllowed = column ? column.isFilterAllowed() : false;\r\n        if (columnWidth) {\r\n            if (typeof columnWidth === 'number') {\r\n                return { width: columnWidth, displayName, filterAllowed };\r\n            }\r\n\r\n            return { width: columnWidth({ column, index }), displayName, filterAllowed };\r\n        }\r\n\r\n        if (column) {\r\n            const smallestUsefulWidth = 75;\r\n            return { width: Math.max(column.getActualWidth(), smallestUsefulWidth), displayName, filterAllowed };\r\n        }\r\n\r\n        return {\r\n            displayName,\r\n            filterAllowed,\r\n        };\r\n    }\r\n\r\n    private onNewHeaderColumn(\r\n        rowIndex: number,\r\n        currentCells: ExcelCell[]\r\n    ): (column: AgColumn, index: number, node: RowNode) => void {\r\n        return (column) => {\r\n            const nameForCol = this.extractHeaderValue(column);\r\n            const styleIds: string[] = this.config.styleLinker({\r\n                rowType: 'HEADER',\r\n                rowIndex,\r\n                value: nameForCol,\r\n                column,\r\n            });\r\n            currentCells.push(\r\n                this.createCell(this.getStyleId(styleIds), this.getDataTypeForValue('string'), nameForCol)\r\n            );\r\n        };\r\n    }\r\n\r\n    private onNewBodyColumn(\r\n        rowIndex: number,\r\n        currentCells: ExcelCell[]\r\n    ): (column: AgColumn, index: number, node: RowNode) => void {\r\n        let skipCols = 0;\r\n        const { freezeColumns, rightToLeft } = this.config;\r\n        return (column, index, node) => {\r\n            if (skipCols > 0) {\r\n                skipCols -= 1;\r\n                return;\r\n            }\r\n\r\n            if (!this.skipFrozenColumns) {\r\n                const pinned = column.getPinned();\r\n                const isPinnedLeft = pinned === true || pinned === 'left';\r\n\r\n                if (freezeColumns === 'pinned' && pinned && isPinnedLeft !== rightToLeft) {\r\n                    this.frozenColumnCount++;\r\n                } else if (\r\n                    typeof freezeColumns === 'function' &&\r\n                    freezeColumns({ ...this.gos.getGridCommonParams(), column })\r\n                ) {\r\n                    this.frozenColumnCount++;\r\n                } else {\r\n                    this.skipFrozenColumns = true;\r\n                }\r\n            }\r\n\r\n            const { value: valueForCell, valueFormatted } = this.extractRowCellValue(\r\n                column,\r\n                index,\r\n                rowIndex,\r\n                'excel',\r\n                node\r\n            );\r\n            const styleIds: string[] = this.config.styleLinker({\r\n                rowType: 'BODY',\r\n                rowIndex,\r\n                value: valueForCell,\r\n                column,\r\n                node,\r\n            });\r\n            const excelStyleId: string | null = this.getStyleId(styleIds);\r\n            const colSpan = column.getColSpan(node);\r\n            const addedImage = this.addImage(rowIndex, column, valueForCell);\r\n\r\n            if (addedImage) {\r\n                currentCells.push(\r\n                    this.createCell(\r\n                        excelStyleId,\r\n                        this.getDataTypeForValue(addedImage.value),\r\n                        addedImage.value == null ? '' : addedImage.value\r\n                    )\r\n                );\r\n            } else if (colSpan > 1) {\r\n                skipCols = colSpan - 1;\r\n                currentCells.push(\r\n                    this.createMergedCell(\r\n                        excelStyleId,\r\n                        this.getDataTypeForValue(valueForCell),\r\n                        valueForCell,\r\n                        colSpan - 1\r\n                    )\r\n                );\r\n            } else {\r\n                currentCells.push(\r\n                    this.createCell(excelStyleId, this.getDataTypeForValue(valueForCell), valueForCell, valueFormatted)\r\n                );\r\n            }\r\n        };\r\n    }\r\n\r\n    private onNewRow(\r\n        onNewColumnAccumulator: (\r\n            rowIndex: number,\r\n            currentCells: ExcelCell[]\r\n        ) => (column: AgColumn, index: number, node: RowNode) => void,\r\n        height?: number | ((params: RowHeightCallbackParams) => number)\r\n    ): RowAccumulator {\r\n        const currentCells: ExcelCell[] = [];\r\n        this.rows.push({\r\n            cells: currentCells,\r\n            height: getHeightFromProperty(this.rows.length + 1, height),\r\n        });\r\n        return {\r\n            onColumn: onNewColumnAccumulator.bind(this, this.rows.length, currentCells)(),\r\n        };\r\n    }\r\n\r\n    private createExcel(data: ExcelWorksheet): string {\r\n        const { excelStyles, config } = this;\r\n\r\n        if (this.frozenColumnCount) {\r\n            config.frozenColumnCount = this.frozenColumnCount;\r\n        }\r\n\r\n        if (this.frozenRowCount) {\r\n            config.frozenRowCount = this.frozenRowCount;\r\n        }\r\n\r\n        return createXlsxExcel(excelStyles, data, config);\r\n    }\r\n\r\n    private getDataTypeForValue(valueForCell?: string): ExcelOOXMLDataType {\r\n        if (valueForCell === undefined) {\r\n            return 'empty';\r\n        }\r\n        return this.isNumerical(valueForCell) ? 'n' : 's';\r\n    }\r\n\r\n    private getTypeFromStyle(style: ExcelStyle | null, value: string | null): ExcelOOXMLDataType | null {\r\n        if (this.isFormula(value)) {\r\n            return 'f';\r\n        }\r\n\r\n        if (style && style.dataType) {\r\n            switch (style.dataType.toLocaleLowerCase()) {\r\n                case 'formula':\r\n                    return 'f';\r\n                case 'string':\r\n                    return 's';\r\n                case 'number':\r\n                    return 'n';\r\n                case 'datetime':\r\n                    return 'd';\r\n                case 'error':\r\n                    return 'e';\r\n                case 'boolean':\r\n                    return 'b';\r\n                default:\r\n                    _warn(162, { id: style.id, dataType: style.dataType });\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private addImage(\r\n        rowIndex: number,\r\n        column: AgColumn,\r\n        value: string\r\n    ): { image: ExcelImage; value?: string } | undefined {\r\n        if (!this.config.addImageToCell) {\r\n            return;\r\n        }\r\n\r\n        const addedImage = this.config.addImageToCell(rowIndex, column, value);\r\n\r\n        if (!addedImage) {\r\n            return;\r\n        }\r\n\r\n        addXlsxBodyImageToMap(addedImage.image, rowIndex, column, this.columnsToExport, this.config.rowHeight);\r\n\r\n        return addedImage;\r\n    }\r\n\r\n    private createCell(\r\n        styleId: string | null | undefined,\r\n        type: ExcelOOXMLDataType,\r\n        value: string,\r\n        valueFormatted?: string | null\r\n    ): ExcelCell {\r\n        const actualStyle: ExcelStyle | null = this.getStyleById(styleId);\r\n        if (!actualStyle?.dataType && type === 's' && valueFormatted) {\r\n            value = valueFormatted;\r\n        }\r\n        const processedType = this.getTypeFromStyle(actualStyle, value) || type;\r\n\r\n        const { value: processedValue, escaped } = this.getCellValue(processedType, value);\r\n        const styles: string[] = [];\r\n\r\n        if (actualStyle) {\r\n            styles.push(styleId!);\r\n        }\r\n\r\n        if (escaped) {\r\n            styles.push('_quotePrefix');\r\n        }\r\n\r\n        styleId = this.getStyleId(styles) || undefined;\r\n\r\n        return {\r\n            styleId,\r\n            data: {\r\n                type: processedType,\r\n                value: processedValue,\r\n            },\r\n        };\r\n    }\r\n\r\n    private createMergedCell(\r\n        styleId: string | null,\r\n        type: ExcelOOXMLDataType,\r\n        value: string,\r\n        numOfCells: number\r\n    ): ExcelCell {\r\n        const valueToUse = value == null ? '' : value;\r\n        return {\r\n            styleId: this.getStyleById(styleId) ? styleId! : undefined,\r\n            data: {\r\n                type: type,\r\n                value: type === 's' ? getXlsxStringPosition(valueToUse).toString() : value,\r\n            },\r\n            mergeAcross: numOfCells,\r\n        };\r\n    }\r\n\r\n    private getCellValue(type: ExcelOOXMLDataType, value: string | null): { value: string | null; escaped?: boolean } {\r\n        let escaped = false;\r\n\r\n        if (value == null || (type === 's' && value === '')) {\r\n            return { value: '', escaped: false };\r\n        }\r\n\r\n        if (type === 's') {\r\n            if (value && value[0] === \"'\") {\r\n                escaped = true;\r\n                value = value.slice(1);\r\n            }\r\n\r\n            value = getXlsxStringPosition(value).toString();\r\n        } else if (type === 'f') {\r\n            value = value.slice(1);\r\n        } else if (type === 'n') {\r\n            const numberValue = Number(value);\r\n\r\n            if (isNaN(numberValue)) {\r\n                value = '';\r\n            } else if (value !== '') {\r\n                value = numberValue.toString();\r\n            }\r\n        }\r\n\r\n        return { value, escaped };\r\n    }\r\n\r\n    private getStyleId(styleIds?: string[] | null): string | null {\r\n        if (!styleIds || !styleIds.length) {\r\n            return null;\r\n        }\r\n        if (styleIds.length === 1) {\r\n            return styleIds[0];\r\n        }\r\n\r\n        const key: string = styleIds.join('-');\r\n        if (!this.mixedStyles[key]) {\r\n            this.addNewMixedStyle(styleIds);\r\n        }\r\n        return this.mixedStyles[key].excelID;\r\n    }\r\n\r\n    private deepCloneObject<T>(object: T): T {\r\n        return JSON.parse(JSON.stringify(object));\r\n    }\r\n\r\n    private addNewMixedStyle(styleIds: string[]): void {\r\n        this.mixedStyleCounter += 1;\r\n        const excelId = `mixedStyle${this.mixedStyleCounter}`;\r\n        const resultantStyle: ExcelStyle = {} as ExcelStyle;\r\n\r\n        for (const styleId of styleIds) {\r\n            for (const excelStyle of this.excelStyles) {\r\n                if (excelStyle.id === styleId) {\r\n                    _mergeDeep(resultantStyle, this.deepCloneObject(excelStyle));\r\n                }\r\n            }\r\n        }\r\n\r\n        resultantStyle.id = excelId;\r\n        const key: string = styleIds.join('-');\r\n        this.mixedStyles[key] = {\r\n            excelID: excelId,\r\n            key: key,\r\n            result: resultantStyle,\r\n        };\r\n        this.excelStyles.push(resultantStyle);\r\n        this.stylesByIds[excelId] = resultantStyle;\r\n    }\r\n\r\n    private isFormula(value: string | null) {\r\n        if (value == null) {\r\n            return false;\r\n        }\r\n        return this.config.autoConvertFormulas && value.toString().startsWith('=');\r\n    }\r\n\r\n    private isNumerical(value: any): boolean {\r\n        if (typeof value === 'bigint') {\r\n            return true;\r\n        }\r\n        return isFinite(value) && value !== '' && !isNaN(parseFloat(value));\r\n    }\r\n\r\n    private getStyleById(styleId?: string | null): ExcelStyle | null {\r\n        if (styleId == null) {\r\n            return null;\r\n        }\r\n        return this.stylesByIds[styleId] || null;\r\n    }\r\n}\r\n", "import type { AgColumn, RowHeightCallbackParams, XmlElement } from 'ag-grid-community';\r\nimport { _escapeString } from 'ag-grid-community';\r\n\r\nimport { INCH_TO_EMU } from './excelConstants';\r\nimport type { ExcelCalculatedImage } from './excelInterfaces';\r\nimport { createXml, createXmlHeader } from './xmlFactory';\r\n\r\nexport const pointsToPixel = (points: number): number => {\r\n    return Math.round((points * 96) / 72);\r\n};\r\n\r\nexport const pixelsToEMU = (value: number): number => {\r\n    return Math.ceil(value * INCH_TO_EMU);\r\n};\r\n\r\nexport const getFontFamilyId = (name?: string): number | undefined => {\r\n    if (name === undefined) {\r\n        return;\r\n    }\r\n\r\n    const families = ['Automatic', 'Roman', 'Swiss', 'Modern', 'Script', 'Decorative'];\r\n    const pos = families.indexOf(name || 'Automatic');\r\n\r\n    return Math.max(pos, 0);\r\n};\r\n\r\nexport const getHeightFromProperty = (\r\n    rowIndex: number,\r\n    height?: number | ((params: RowHeightCallbackParams) => number)\r\n): number | undefined => {\r\n    if (!height) {\r\n        return;\r\n    }\r\n\r\n    let finalHeight: number;\r\n\r\n    if (typeof height === 'number') {\r\n        finalHeight = height;\r\n    } else {\r\n        // eslint-disable-next-line @typescript-eslint/ban-types\r\n        const heightFunc = height as Function;\r\n        finalHeight = heightFunc({ rowIndex });\r\n    }\r\n\r\n    return finalHeight;\r\n};\r\n\r\nexport const setExcelImageTotalWidth = (image: ExcelCalculatedImage, columnsToExport: AgColumn[]): void => {\r\n    const { colSpan, column } = image.position!;\r\n\r\n    if (!image.width) {\r\n        return;\r\n    }\r\n\r\n    if (colSpan) {\r\n        const columnsInSpan = columnsToExport.slice(column! - 1, column! + colSpan - 1);\r\n        let totalWidth = 0;\r\n        for (let i = 0; i < columnsInSpan.length; i++) {\r\n            const colWidth = columnsInSpan[i].getActualWidth();\r\n            if (image.width < totalWidth + colWidth) {\r\n                image.position!.colSpan = i + 1;\r\n                image.totalWidth = image.width;\r\n                image.width = image.totalWidth - totalWidth;\r\n                break;\r\n            }\r\n            totalWidth += colWidth;\r\n        }\r\n    } else {\r\n        image.totalWidth = image.width;\r\n    }\r\n};\r\n\r\nexport const setExcelImageTotalHeight = (\r\n    image: ExcelCalculatedImage,\r\n    rowHeight?: number | ((params: RowHeightCallbackParams) => number)\r\n): void => {\r\n    const { rowSpan, row } = image.position!;\r\n\r\n    if (!image.height) {\r\n        return;\r\n    }\r\n\r\n    if (rowSpan) {\r\n        let totalHeight = 0;\r\n        let counter = 0;\r\n        for (let i = row!; i < row! + rowSpan; i++) {\r\n            const nextRowHeight = pointsToPixel(getHeightFromProperty(i, rowHeight) || 20);\r\n            if (image.height < totalHeight + nextRowHeight) {\r\n                image.position!.rowSpan = counter + 1;\r\n                image.totalHeight = image.height;\r\n                image.height = image.totalHeight - totalHeight;\r\n                break;\r\n            }\r\n            totalHeight += nextRowHeight;\r\n            counter++;\r\n        }\r\n    } else {\r\n        image.totalHeight = image.height;\r\n    }\r\n};\r\n\r\nexport const createXmlPart = (body: XmlElement, skipHeader?: boolean): string => {\r\n    const header = createXmlHeader({\r\n        encoding: 'UTF-8',\r\n        standalone: 'yes',\r\n    });\r\n\r\n    const xmlBody = createXml(body);\r\n\r\n    if (skipHeader) {\r\n        return xmlBody;\r\n    }\r\n\r\n    return `${header}${xmlBody}`;\r\n};\r\n\r\nexport const getExcelColumnName = (colIdx: number): string => {\r\n    const startCode = 65;\r\n    const tableWidth = 26;\r\n    const fromCharCode = String.fromCharCode;\r\n\r\n    const pos = Math.floor(colIdx / tableWidth);\r\n    const tableIdx = colIdx % tableWidth;\r\n\r\n    if (!pos || colIdx === tableWidth) {\r\n        return fromCharCode(startCode + colIdx - 1);\r\n    }\r\n    if (!tableIdx) {\r\n        return getExcelColumnName(pos - 1) + 'Z';\r\n    }\r\n    if (pos < tableWidth) {\r\n        return fromCharCode(startCode + pos - 1) + fromCharCode(startCode + tableIdx - 1);\r\n    }\r\n\r\n    return getExcelColumnName(pos) + fromCharCode(startCode + tableIdx - 1);\r\n};\r\n\r\nexport const replaceInvisibleCharacters = (str: string | null): string | null => {\r\n    if (str == null) {\r\n        return null;\r\n    }\r\n    // Excel breaks when characters with code below 30 are exported\r\n    // we use the loop below to wrap these characters between _x(code)_\r\n    let newString = '';\r\n    for (let i = 0; i < str.length; i++) {\r\n        const point = str.charCodeAt(i);\r\n\r\n        if (point >= 0 && point <= 31 && point !== 10) {\r\n            const convertedCode = point.toString(16).toUpperCase();\r\n            const paddedCode = convertedCode.padStart(4, '0');\r\n            const newValue = `_x${paddedCode}_`;\r\n\r\n            newString += newValue;\r\n        } else {\r\n            newString += str[i];\r\n        }\r\n    }\r\n    return newString;\r\n};\r\n\r\nexport const buildSharedString = (strMap: Map<string, number>): XmlElement[] => {\r\n    const ret: XmlElement[] = [];\r\n\r\n    for (const key of strMap.keys()) {\r\n        const textNode = key.toString();\r\n\r\n        const child: XmlElement = {\r\n            name: 't',\r\n            textNode: _escapeString(replaceInvisibleCharacters(textNode), false),\r\n        };\r\n\r\n        // if we have leading or trailing spaces, instruct Excel not to trim them\r\n        const preserveSpaces = textNode.trim().length !== textNode.length;\r\n\r\n        if (preserveSpaces) {\r\n            child.properties = {\r\n                rawMap: {\r\n                    'xml:space': 'preserve',\r\n                },\r\n            };\r\n        }\r\n        ret.push({\r\n            name: 'si',\r\n            children: [child],\r\n        });\r\n    }\r\n\r\n    return ret;\r\n};\r\n", "export const INCH_TO_EMU = 9525;\r\n\r\nexport const numberFormatMap: { [key: string]: number } = {\r\n    '0': 1,\r\n    '0.00': 2,\r\n    '#,##0': 3,\r\n    '#,##0.00': 4,\r\n    '0%': 9,\r\n    '0.00%': 10,\r\n    '0.00E+00': 11,\r\n    '# ?/?': 12,\r\n    '# ??/??': 13,\r\n    'mm-dd-yy': 14,\r\n    'd-mmm-yy': 15,\r\n    'd-mmm': 16,\r\n    'mmm-yy': 17,\r\n    'h:mm AM/PM': 18,\r\n    'h:mm:ss AM/PM': 19,\r\n    'h:mm': 20,\r\n    'h:mm:ss': 21,\r\n    'm/d/yy h:mm': 22,\r\n    '#,##0 ;(#,##0)': 37,\r\n    '#,##0 ;[Red](#,##0)': 38,\r\n    '#,##0.00;(#,##0.00)': 39,\r\n    '#,##0.00;[Red](#,##0.00)': 40,\r\n    'mm:ss': 45,\r\n    '[h]:mm:ss': 46,\r\n    'mmss.0': 47,\r\n    '##0.0E+0': 48,\r\n    '@': 49,\r\n};\r\n", "import type { HeaderElement, PrefixedXmlAttributes, XmlElement } from 'ag-grid-community';\r\n\r\nconst LINE_SEPARATOR = '\\r\\n';\r\n\r\nfunction returnAttributeIfPopulated(key: string, value: any, booleanTransformer?: (currentValue: boolean) => string) {\r\n    if (!value && value !== '' && value !== 0) {\r\n        return '';\r\n    }\r\n\r\n    let xmlValue: string = value;\r\n    if (typeof value === 'boolean') {\r\n        if (booleanTransformer) {\r\n            xmlValue = booleanTransformer(value);\r\n        }\r\n    }\r\n\r\n    return ` ${key}=\"${xmlValue}\"`;\r\n}\r\n\r\nexport function createXmlHeader(headerElement: HeaderElement = {}): string {\r\n    const headerStart = '<?';\r\n    const headerEnd = '?>';\r\n    const keys = ['version'];\r\n\r\n    if (!headerElement.version) {\r\n        headerElement.version = '1.0';\r\n    }\r\n    if (headerElement.encoding) {\r\n        keys.push('encoding');\r\n    }\r\n    if (headerElement.standalone) {\r\n        keys.push('standalone');\r\n    }\r\n\r\n    const att = keys.map((key: string): string => `${key}=\"${headerElement[key]}\"`).join(' ');\r\n    return `${headerStart}xml ${att} ${headerEnd}`;\r\n}\r\n\r\nexport function createXml(xmlElement: XmlElement, booleanTransformer?: (currentValue: boolean) => string): string {\r\n    let props: string = '';\r\n    if (xmlElement.properties) {\r\n        if (xmlElement.properties.prefixedAttributes) {\r\n            xmlElement.properties.prefixedAttributes.forEach((prefixedSet: PrefixedXmlAttributes) => {\r\n                Object.keys(prefixedSet.map).forEach((key) => {\r\n                    props += returnAttributeIfPopulated(\r\n                        prefixedSet.prefix + key,\r\n                        prefixedSet.map[key],\r\n                        booleanTransformer\r\n                    );\r\n                });\r\n            });\r\n        }\r\n\r\n        if (xmlElement.properties.rawMap) {\r\n            Object.keys(xmlElement.properties.rawMap).forEach((key) => {\r\n                props += returnAttributeIfPopulated(key, xmlElement.properties!.rawMap[key], booleanTransformer);\r\n            });\r\n        }\r\n    }\r\n    let result: string = '<' + xmlElement.name + props;\r\n\r\n    if (!xmlElement.children && xmlElement.textNode == null) {\r\n        return result + '/>' + LINE_SEPARATOR;\r\n    }\r\n\r\n    if (xmlElement.textNode != null) {\r\n        return result + '>' + xmlElement.textNode + '</' + xmlElement.name + '>' + LINE_SEPARATOR;\r\n    }\r\n\r\n    result += '>' + LINE_SEPARATOR;\r\n    if (xmlElement.children) {\r\n        xmlElement.children.forEach((it) => {\r\n            result += createXml(it, booleanTransformer);\r\n        });\r\n    }\r\n\r\n    return result + '</' + xmlElement.name + '>' + LINE_SEPARATOR;\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    ExcelExportParams,\r\n    ExcelFactoryMode,\r\n    ExcelHeaderFooterImage,\r\n    ExcelImage,\r\n    ExcelRelationship,\r\n    ExcelStyle,\r\n    ExcelTableConfig,\r\n    ExcelWorksheet,\r\n    RowHeightCallbackParams,\r\n} from 'ag-grid-community';\r\nimport { _escapeString, _getHeaderRowCount, _warn } from 'ag-grid-community';\r\n\r\nimport type {\r\n    ExcelCalculatedImage,\r\n    ExcelDataTable,\r\n    ExcelHeaderFooterCalculatedImage,\r\n    ExcelHeaderFooterPosition,\r\n    ImageIdMap,\r\n} from './assets/excelInterfaces';\r\nimport { createXmlPart, setExcelImageTotalHeight, setExcelImageTotalWidth } from './assets/excelUtils';\r\nimport type { ExcelGridSerializingParams } from './excelSerializingSession';\r\nimport contentTypesFactory, { _normaliseImageExtension } from './files/ooxml/contentTypes';\r\nimport coreFactory from './files/ooxml/core';\r\nimport drawingFactory from './files/ooxml/drawing';\r\nimport relationshipsFactory from './files/ooxml/relationships';\r\nimport sharedStringsFactory from './files/ooxml/sharedStrings';\r\nimport stylesheetFactory, { registerStyles } from './files/ooxml/styles/stylesheet';\r\nimport tableFactory from './files/ooxml/table';\r\nimport officeThemeFactory from './files/ooxml/themes/office';\r\nimport vmlDrawingFactory from './files/ooxml/vmlDrawing';\r\nimport workbookFactory from './files/ooxml/workbook';\r\nimport worksheetFactory from './files/ooxml/worksheet';\r\n\r\n/*\r\n * See links for more info on the Office Open XML format being used:\r\n * https://www.ecma-international.org/wp-content/uploads/Office-Open-XML-White-Paper.pdf\r\n * https://ecma-international.org/publications-and-standards/standards/ecma-376/\r\n */\r\n\r\nconst XLSX_SHARED_STRINGS: Map<string, number> = new Map();\r\nlet XLSX_SHEET_NAMES: string[] = [];\r\n\r\n/** Maps images to sheet */\r\nexport const XLSX_IMAGES: Map<\r\n    string,\r\n    { sheetId: number; image: (ExcelCalculatedImage | ExcelHeaderFooterCalculatedImage)[] }[]\r\n> = new Map();\r\n/** Maps sheets to images */\r\nexport const XLSX_WORKSHEET_IMAGES: Map<number, ExcelCalculatedImage[]> = new Map();\r\n/** Maps sheets to header/footer images */\r\nexport const XLSX_WORKSHEET_HEADER_FOOTER_IMAGES: Map<number, ExcelHeaderFooterCalculatedImage[]> = new Map();\r\n/** Maps all workbook images to a global Id */\r\nexport const XLSX_WORKBOOK_IMAGE_IDS: ImageIdMap = new Map();\r\n/** Maps all sheet images to unique Ids */\r\nexport const XLSX_WORKSHEET_IMAGE_IDS: Map<number, ImageIdMap> = new Map();\r\n/** Maps all sheet tables to unique Ids */\r\nexport const XLSX_WORKSHEET_DATA_TABLES: Map<number, ExcelDataTable> = new Map();\r\n/** Default name to be used for tables when no name is provided */\r\nexport const DEFAULT_TABLE_DISPLAY_NAME = 'AG-GRID-TABLE';\r\n\r\nlet XLSX_FACTORY_MODE: ExcelFactoryMode = 'SINGLE_SHEET';\r\n\r\nexport function getXlsxFactoryMode(): ExcelFactoryMode {\r\n    return XLSX_FACTORY_MODE;\r\n}\r\n\r\nexport function setXlsxFactoryMode(factoryMode: ExcelFactoryMode): void {\r\n    XLSX_FACTORY_MODE = factoryMode;\r\n}\r\n\r\nexport function createXlsxExcel(\r\n    styles: ExcelStyle[],\r\n    worksheet: ExcelWorksheet,\r\n    config: ExcelGridSerializingParams\r\n): string {\r\n    addSheetName(worksheet);\r\n    registerStyles(styles, XLSX_SHEET_NAMES.length);\r\n\r\n    const newConfig = Object.assign({}, config);\r\n\r\n    // Table export is not compatible with pivot mode nor master/detail features\r\n    if (config.exportAsExcelTable) {\r\n        if (config.colModel.isPivotActive()) {\r\n            showExcelTableNonCompatibleFeaturesWarning('pivot mode');\r\n            newConfig.exportAsExcelTable = false;\r\n        }\r\n\r\n        if (config.gos.get('masterDetail')) {\r\n            showExcelTableNonCompatibleFeaturesWarning('master/detail');\r\n            newConfig.exportAsExcelTable = false;\r\n        }\r\n    }\r\n\r\n    processTableConfig(worksheet, newConfig);\r\n    return createWorksheet(worksheet, newConfig);\r\n}\r\n\r\nexport function showExcelTableNonCompatibleFeaturesWarning(featureName: string) {\r\n    _warn(163, { featureName });\r\n}\r\n\r\nexport function getXlsxSanitizedTableName(name: string) {\r\n    return name\r\n        .replace(/^[^a-zA-Z_]+/, '_')\r\n        .replace(/\\s/g, '_')\r\n        .replace(/[^a-zA-Z0-9_]/g, '_');\r\n}\r\n\r\nexport function addXlsxTableToSheet(sheetIndex: number, table: ExcelDataTable): void {\r\n    if (XLSX_WORKSHEET_DATA_TABLES.has(sheetIndex)) {\r\n        _warn(164);\r\n        return;\r\n    }\r\n\r\n    XLSX_WORKSHEET_DATA_TABLES.set(sheetIndex, table);\r\n}\r\n\r\nfunction processTableConfig(worksheet: ExcelWorksheet, config: ExcelGridSerializingParams & ExcelExportParams) {\r\n    const { exportAsExcelTable, prependContent, appendContent, colModel } = config;\r\n    if (!exportAsExcelTable) {\r\n        return;\r\n    }\r\n\r\n    const tableConfig: Partial<ExcelTableConfig> = typeof exportAsExcelTable === 'boolean' ? {} : exportAsExcelTable;\r\n\r\n    const {\r\n        name: nameFromConfig,\r\n        showColumnStripes,\r\n        showRowStripes,\r\n        showFilterButton,\r\n        highlightFirstColumn,\r\n        highlightLastColumn,\r\n    } = tableConfig;\r\n\r\n    const tableName = getXlsxSanitizedTableName(nameFromConfig || DEFAULT_TABLE_DISPLAY_NAME);\r\n\r\n    const sheetIndex = XLSX_SHEET_NAMES.length - 1;\r\n    const { table } = worksheet;\r\n    const { rows, columns } = table;\r\n    const headerRowCount = _getHeaderRowCount(colModel);\r\n    const skipTopRows = prependContent ? prependContent.length : 0;\r\n    const removeFromBottom = appendContent ? appendContent.length : 0;\r\n    const tableRowCount = rows.length;\r\n    const tableColCount = columns.length;\r\n\r\n    const tableColumns: string[] = [];\r\n    const showFilterButtons: boolean[] = [];\r\n\r\n    for (let i = 0; i < tableColCount; i++) {\r\n        const col = columns[i];\r\n        tableColumns.push(col.displayName || '');\r\n        showFilterButtons.push(\r\n            showFilterButton === 'match' || showFilterButton === undefined\r\n                ? col.filterAllowed ?? false // We fall back to the column's filterAllowed property on match\r\n                : showFilterButton\r\n        );\r\n    }\r\n\r\n    if (!tableColumns || !tableColumns.length || !tableRowCount || !tableName) {\r\n        _warn(165);\r\n        return;\r\n    }\r\n\r\n    addXlsxTableToSheet(sheetIndex, {\r\n        name: `table${XLSX_WORKSHEET_DATA_TABLES.size + 1}`,\r\n        displayName: tableName,\r\n        columns: tableColumns,\r\n        showFilterButtons: showFilterButtons,\r\n        rowRange: [headerRowCount + skipTopRows, headerRowCount + (tableRowCount - headerRowCount) - removeFromBottom],\r\n        showRowStripes: showRowStripes ?? true,\r\n        showColumnStripes: showColumnStripes ?? false,\r\n        highlightFirstColumn: highlightFirstColumn ?? false,\r\n        highlightLastColumn: highlightLastColumn ?? false,\r\n    });\r\n}\r\n\r\nexport function addXlsxHeaderFooterImageToMap(\r\n    image: ExcelHeaderFooterImage,\r\n    position: ExcelHeaderFooterPosition\r\n): void {\r\n    const sheetIndex = XLSX_SHEET_NAMES.length - 1;\r\n    const headerFooterImage = image as ExcelHeaderFooterCalculatedImage;\r\n\r\n    headerFooterImage.headerFooterPosition = position;\r\n\r\n    buildImageMap({ imageToAdd: headerFooterImage, idx: sheetIndex });\r\n\r\n    let headerFooterImagesForSheet = XLSX_WORKSHEET_HEADER_FOOTER_IMAGES.get(sheetIndex);\r\n\r\n    if (!headerFooterImagesForSheet) {\r\n        headerFooterImagesForSheet = [];\r\n        XLSX_WORKSHEET_HEADER_FOOTER_IMAGES.set(sheetIndex, headerFooterImagesForSheet);\r\n    }\r\n\r\n    if (!headerFooterImagesForSheet.find((img) => img.id === image.id)) {\r\n        headerFooterImagesForSheet.push(image as ExcelHeaderFooterCalculatedImage);\r\n    }\r\n}\r\n\r\nexport function addXlsxBodyImageToMap(\r\n    image: ExcelImage,\r\n    rowIndex: number,\r\n    col: AgColumn,\r\n    columnsToExport?: AgColumn[],\r\n    rowHeight?: number | ((params: RowHeightCallbackParams) => number)\r\n): void {\r\n    const sheetIndex = XLSX_SHEET_NAMES.length;\r\n    const { row, column } = image.position || {};\r\n    const calculatedImage = image as ExcelCalculatedImage;\r\n\r\n    if (columnsToExport) {\r\n        if (rowIndex != null && col != null && (!row || !column)) {\r\n            if (!image.position) {\r\n                image.position = {};\r\n            }\r\n\r\n            image.position = Object.assign({}, image.position, {\r\n                row: rowIndex,\r\n                column: columnsToExport.indexOf(col) + 1,\r\n            });\r\n        }\r\n        setExcelImageTotalWidth(calculatedImage, columnsToExport);\r\n        setExcelImageTotalHeight(calculatedImage, rowHeight);\r\n    }\r\n\r\n    buildImageMap({ imageToAdd: calculatedImage, idx: sheetIndex });\r\n\r\n    let worksheetImageIdMap = XLSX_WORKSHEET_IMAGE_IDS.get(sheetIndex);\r\n\r\n    if (!worksheetImageIdMap) {\r\n        worksheetImageIdMap = new Map();\r\n        XLSX_WORKSHEET_IMAGE_IDS.set(sheetIndex, worksheetImageIdMap);\r\n    }\r\n\r\n    const sheetImages = XLSX_WORKSHEET_IMAGES.get(sheetIndex);\r\n\r\n    if (!sheetImages) {\r\n        XLSX_WORKSHEET_IMAGES.set(sheetIndex, [calculatedImage]);\r\n    } else {\r\n        sheetImages.push(calculatedImage);\r\n    }\r\n\r\n    if (!worksheetImageIdMap.get(image.id)) {\r\n        worksheetImageIdMap.set(image.id, { index: worksheetImageIdMap.size, type: image.imageType });\r\n    }\r\n}\r\n\r\nfunction buildImageMap(params: {\r\n    imageToAdd: ExcelCalculatedImage | ExcelHeaderFooterCalculatedImage;\r\n    idx: number;\r\n}): void {\r\n    const { imageToAdd, idx } = params;\r\n    const mappedImagesToSheet = XLSX_IMAGES.get(imageToAdd.id);\r\n\r\n    if (mappedImagesToSheet) {\r\n        const currentSheetImages = mappedImagesToSheet.find((currentImage) => currentImage.sheetId === idx);\r\n        if (currentSheetImages) {\r\n            currentSheetImages.image.push(imageToAdd);\r\n        } else {\r\n            mappedImagesToSheet.push({\r\n                sheetId: idx,\r\n                image: [imageToAdd],\r\n            });\r\n        }\r\n    } else {\r\n        XLSX_IMAGES.set(imageToAdd.id, [{ sheetId: idx, image: [imageToAdd] }]);\r\n        XLSX_WORKBOOK_IMAGE_IDS.set(imageToAdd.id, {\r\n            type: imageToAdd.imageType,\r\n            index: XLSX_WORKBOOK_IMAGE_IDS.size,\r\n        });\r\n    }\r\n}\r\n\r\nfunction addSheetName(worksheet: ExcelWorksheet): void {\r\n    const name = _escapeString(worksheet.name) || '';\r\n    let append = '';\r\n\r\n    while (XLSX_SHEET_NAMES.indexOf(`${name}${append}`) !== -1) {\r\n        if (append === '') {\r\n            append = '_1';\r\n        } else {\r\n            const curr = parseInt(append.slice(1), 10);\r\n            append = `_${curr + 1}`;\r\n        }\r\n    }\r\n\r\n    worksheet.name = `${name}${append}`;\r\n    XLSX_SHEET_NAMES.push(worksheet.name);\r\n}\r\n\r\nexport function getXlsxStringPosition(str: string): number {\r\n    if (XLSX_SHARED_STRINGS.has(str)) {\r\n        return XLSX_SHARED_STRINGS.get(str)!;\r\n    }\r\n\r\n    XLSX_SHARED_STRINGS.set(str, XLSX_SHARED_STRINGS.size);\r\n    return XLSX_SHARED_STRINGS.size - 1;\r\n}\r\n\r\nexport function resetXlsxFactory(): void {\r\n    XLSX_SHARED_STRINGS.clear();\r\n\r\n    XLSX_IMAGES.clear();\r\n    XLSX_WORKSHEET_IMAGES.clear();\r\n    XLSX_WORKSHEET_HEADER_FOOTER_IMAGES.clear();\r\n\r\n    XLSX_WORKBOOK_IMAGE_IDS.clear();\r\n    XLSX_WORKSHEET_IMAGE_IDS.clear();\r\n    XLSX_WORKSHEET_DATA_TABLES.clear();\r\n\r\n    XLSX_SHEET_NAMES = [];\r\n    XLSX_FACTORY_MODE = 'SINGLE_SHEET';\r\n}\r\n\r\nexport function createXlsxWorkbook(currentSheet: number): string {\r\n    return createXmlPart(workbookFactory.getTemplate(XLSX_SHEET_NAMES, currentSheet));\r\n}\r\n\r\nexport function createXlsxStylesheet(defaultFontSize: number): string {\r\n    return createXmlPart(stylesheetFactory.getTemplate(defaultFontSize));\r\n}\r\n\r\nexport function createXlsxSharedStrings(): string {\r\n    return createXmlPart(sharedStringsFactory.getTemplate(XLSX_SHARED_STRINGS));\r\n}\r\n\r\nexport function createXlsxCore(author: string): string {\r\n    return createXmlPart(coreFactory.getTemplate(author));\r\n}\r\n\r\nexport function createXlsxContentTypes(sheetLen: number): string {\r\n    return createXmlPart(contentTypesFactory.getTemplate(sheetLen));\r\n}\r\n\r\nexport function createXlsxRels(): string {\r\n    const rs = relationshipsFactory.getTemplate([\r\n        {\r\n            Id: 'rId1',\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument',\r\n            Target: 'xl/workbook.xml',\r\n        },\r\n        {\r\n            Id: 'rId2',\r\n            Type: 'http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties',\r\n            Target: 'docProps/core.xml',\r\n        },\r\n    ]);\r\n\r\n    return createXmlPart(rs);\r\n}\r\n\r\nexport function createXlsxTheme(): string {\r\n    return createXmlPart(officeThemeFactory.getTemplate());\r\n}\r\n\r\nexport function createXlsxTable(dataTable: ExcelDataTable, index?: number): string {\r\n    return createXmlPart(tableFactory.getTemplate(dataTable, index));\r\n}\r\n\r\nexport function createXlsxWorkbookRels(sheetLen: number): string {\r\n    const worksheets = new Array(sheetLen).fill(undefined).map((v, i) => ({\r\n        Id: `rId${i + 1}`,\r\n        Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet',\r\n        Target: `worksheets/sheet${i + 1}.xml`,\r\n    }));\r\n\r\n    const rs = relationshipsFactory.getTemplate([\r\n        ...worksheets,\r\n        {\r\n            Id: `rId${sheetLen + 1}`,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme',\r\n            Target: 'theme/theme1.xml',\r\n        },\r\n        {\r\n            Id: `rId${sheetLen + 2}`,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles',\r\n            Target: 'styles.xml',\r\n        },\r\n        {\r\n            Id: `rId${sheetLen + 3}`,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings',\r\n            Target: 'sharedStrings.xml',\r\n        },\r\n    ]);\r\n\r\n    return createXmlPart(rs);\r\n}\r\n\r\nexport function createXlsxDrawing(sheetIndex: number) {\r\n    return createXmlPart(drawingFactory.getTemplate({ sheetIndex }));\r\n}\r\n\r\nexport function createXlsxDrawingRel(sheetIndex: number) {\r\n    const worksheetImageIds = XLSX_WORKSHEET_IMAGE_IDS.get(sheetIndex) || [];\r\n    const XMLArr: ExcelRelationship[] = [];\r\n\r\n    for (const [key, value] of worksheetImageIds) {\r\n        const { index, type } = value;\r\n\r\n        XMLArr.push({\r\n            Id: `rId${index + 1}`,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\r\n            Target: `../media/image${XLSX_WORKBOOK_IMAGE_IDS.get(key)!.index + 1}.${_normaliseImageExtension(type)}`,\r\n        });\r\n    }\r\n\r\n    return createXmlPart(relationshipsFactory.getTemplate(XMLArr));\r\n}\r\n\r\nexport function createXlsxVmlDrawing(sheetIndex: number) {\r\n    return createXmlPart(vmlDrawingFactory.getTemplate({ sheetIndex }), true);\r\n}\r\n\r\nexport function createXlsxVmlDrawingRel(sheetIndex: number) {\r\n    const worksheetHeaderFooterImages = XLSX_WORKSHEET_HEADER_FOOTER_IMAGES.get(sheetIndex) || [];\r\n    const XMLArr: ExcelRelationship[] = [];\r\n\r\n    for (let i = 0; i < worksheetHeaderFooterImages.length; i++) {\r\n        const headerFooterImage = worksheetHeaderFooterImages[i];\r\n        const workbookImage = XLSX_WORKBOOK_IMAGE_IDS.get(headerFooterImage.id);\r\n\r\n        if (!workbookImage) {\r\n            continue;\r\n        }\r\n\r\n        const { index, type } = workbookImage;\r\n\r\n        XMLArr.push({\r\n            Id: `rId${i + 1}`,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\r\n            Target: `../media/image${index + 1}.${_normaliseImageExtension(type)}`,\r\n        });\r\n    }\r\n\r\n    return createXmlPart(relationshipsFactory.getTemplate(XMLArr));\r\n}\r\n\r\nexport function createXlsxRelationships({\r\n    drawingIndex,\r\n    vmlDrawingIndex,\r\n    tableName,\r\n}: {\r\n    drawingIndex?: number;\r\n    vmlDrawingIndex?: number;\r\n    tableName?: string;\r\n} = {}) {\r\n    if (drawingIndex === undefined && vmlDrawingIndex === undefined && tableName === undefined) {\r\n        return '';\r\n    }\r\n\r\n    const config = [];\r\n    if (drawingIndex != null) {\r\n        config.push({\r\n            Id: `rId${config.length + 1}`,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing',\r\n            Target: `../drawings/drawing${drawingIndex + 1}.xml`,\r\n        });\r\n    }\r\n\r\n    if (vmlDrawingIndex != null) {\r\n        config.push({\r\n            Id: `rId${config.length + 1}`,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing',\r\n            Target: `../drawings/vmlDrawing${vmlDrawingIndex + 1}.vml`,\r\n        });\r\n    }\r\n\r\n    if (tableName != null) {\r\n        config.push({\r\n            Id: `rId${config.length + 1}`,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/table',\r\n            Target: `../tables/${tableName}.xml`,\r\n        });\r\n    }\r\n\r\n    const rs = relationshipsFactory.getTemplate(config);\r\n    return createXmlPart(rs);\r\n}\r\n\r\nfunction createWorksheet(worksheet: ExcelWorksheet, config: ExcelGridSerializingParams): string {\r\n    return createXmlPart(\r\n        worksheetFactory.getTemplate({\r\n            worksheet,\r\n            currentSheet: XLSX_SHEET_NAMES.length - 1,\r\n            config,\r\n        })\r\n    );\r\n}\r\n", "import type { ExcelContentType, ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nconst contentTypeFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(config: ExcelContentType) {\r\n        const { name, ContentType, Extension, PartName } = config;\r\n\r\n        return {\r\n            name,\r\n            properties: {\r\n                rawMap: {\r\n                    Extension,\r\n                    PartName,\r\n                    ContentType,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default contentTypeFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\nimport type { XmlElement } from 'ag-grid-community';\r\n\r\nimport {\r\n    XLSX_WORKBOOK_IMAGE_IDS,\r\n    XLSX_WORKSHEET_DATA_TABLES,\r\n    XLSX_WORKSHEET_HEADER_FOOTER_IMAGES,\r\n    XLSX_WORKSHEET_IMAGES,\r\n} from '../../excelXlsxFactory';\r\nimport contentTypeFactory from './contentType';\r\n\r\ntype ImageExtension = 'jpeg' | 'png' | 'gif';\r\nexport const _normaliseImageExtension = (ext: 'jpg' | 'png' | 'gif'): ImageExtension => (ext === 'jpg' ? 'jpeg' : ext);\r\n\r\nconst contentTypesFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(sheetLen: number) {\r\n        const worksheets = new Array(sheetLen).fill(undefined).map((v, i) => ({\r\n            name: 'Override',\r\n            ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml',\r\n            PartName: `/xl/worksheets/sheet${i + 1}.xml`,\r\n        }));\r\n\r\n        const sheetsWithImages = XLSX_WORKSHEET_IMAGES.size;\r\n        const headerFooterImages = XLSX_WORKSHEET_HEADER_FOOTER_IMAGES.size;\r\n        const imageTypesObject: { [key in ImageExtension]?: boolean } = {};\r\n\r\n        XLSX_WORKBOOK_IMAGE_IDS.forEach((v) => {\r\n            imageTypesObject[_normaliseImageExtension(v.type)] = true;\r\n        });\r\n\r\n        const imageDocs = new Array(sheetsWithImages).fill(undefined).map((v, i) => ({\r\n            name: 'Override',\r\n            ContentType: 'application/vnd.openxmlformats-officedocument.drawing+xml',\r\n            PartName: `/xl/drawings/drawing${i + 1}.xml`,\r\n        }));\r\n\r\n        const tableDocs: { name: string; ContentType: string; PartName: string }[] = [];\r\n\r\n        XLSX_WORKSHEET_DATA_TABLES.forEach(({ name }) => {\r\n            tableDocs.push({\r\n                name: 'Override',\r\n                ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml',\r\n                PartName: `/xl/tables/${name}.xml`,\r\n            });\r\n        });\r\n\r\n        const imageTypes = Object.keys(imageTypesObject).map((ext) => ({\r\n            name: 'Default',\r\n            ContentType: `image/${ext}`,\r\n            Extension: ext,\r\n        }));\r\n\r\n        if (headerFooterImages) {\r\n            imageTypes.push({\r\n                name: 'Default',\r\n                Extension: 'vml',\r\n                ContentType: 'application/vnd.openxmlformats-officedocument.vmlDrawing',\r\n            });\r\n        }\r\n\r\n        const children: XmlElement[] = [\r\n            ...imageTypes,\r\n            {\r\n                name: 'Default',\r\n                Extension: 'rels',\r\n                ContentType: 'application/vnd.openxmlformats-package.relationships+xml',\r\n            },\r\n            {\r\n                name: 'Default',\r\n                ContentType: 'application/xml',\r\n                Extension: 'xml',\r\n            },\r\n            {\r\n                name: 'Override',\r\n                ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml',\r\n                PartName: '/xl/workbook.xml',\r\n            },\r\n            ...worksheets,\r\n            {\r\n                name: 'Override',\r\n                ContentType: 'application/vnd.openxmlformats-officedocument.theme+xml',\r\n                PartName: '/xl/theme/theme1.xml',\r\n            },\r\n            {\r\n                name: 'Override',\r\n                ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml',\r\n                PartName: '/xl/styles.xml',\r\n            },\r\n            {\r\n                name: 'Override',\r\n                ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml',\r\n                PartName: '/xl/sharedStrings.xml',\r\n            },\r\n            ...imageDocs,\r\n            ...tableDocs,\r\n            {\r\n                name: 'Override',\r\n                ContentType: 'application/vnd.openxmlformats-package.core-properties+xml',\r\n                PartName: '/docProps/core.xml',\r\n            },\r\n        ].map((contentType) => contentTypeFactory.getTemplate(contentType));\r\n\r\n        return {\r\n            name: 'Types',\r\n            properties: {\r\n                rawMap: {\r\n                    xmlns: 'http://schemas.openxmlformats.org/package/2006/content-types',\r\n                },\r\n            },\r\n            children,\r\n        };\r\n    },\r\n};\r\n\r\nexport default contentTypesFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nconst coreFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(author: string) {\r\n        const dt = new Date();\r\n        const jsonDate = dt.toJSON();\r\n\r\n        return {\r\n            name: 'cp:coreProperties',\r\n            properties: {\r\n                prefixedAttributes: [\r\n                    {\r\n                        prefix: 'xmlns:',\r\n                        map: {\r\n                            cp: 'http://schemas.openxmlformats.org/package/2006/metadata/core-properties',\r\n                            dc: 'http://purl.org/dc/elements/1.1/',\r\n                            dcterms: 'http://purl.org/dc/terms/',\r\n                            dcmitype: 'http://purl.org/dc/dcmitype/',\r\n                            xsi: 'http://www.w3.org/2001/XMLSchema-instance',\r\n                        },\r\n                    },\r\n                ],\r\n            },\r\n            children: [\r\n                {\r\n                    name: 'dc:creator',\r\n                    textNode: author,\r\n                },\r\n                {\r\n                    name: 'dc:title',\r\n                    textNode: 'Workbook',\r\n                },\r\n                {\r\n                    name: 'dcterms:created',\r\n                    properties: {\r\n                        rawMap: {\r\n                            'xsi:type': 'dcterms:W3CDTF',\r\n                        },\r\n                    },\r\n                    textNode: jsonDate,\r\n                },\r\n                {\r\n                    name: 'dcterms:modified',\r\n                    properties: {\r\n                        rawMap: {\r\n                            'xsi:type': 'dcterms:W3CDTF',\r\n                        },\r\n                    },\r\n                    textNode: jsonDate,\r\n                },\r\n            ],\r\n        };\r\n    },\r\n};\r\n\r\nexport default coreFactory;\r\n", "import type { ExcelImage, ExcelOOXMLTemplate, XmlElement } from 'ag-grid-community';\r\n\r\nimport type { ExcelCalculatedImage, ImageAnchor, ImageBoxSize, ImageColor } from '../../assets/excelInterfaces';\r\nimport { pixelsToEMU } from '../../assets/excelUtils';\r\nimport { XLSX_WORKSHEET_IMAGES, XLSX_WORKSHEET_IMAGE_IDS } from '../../excelXlsxFactory';\r\n\r\nconst getAnchor = (name: string, imageAnchor: ImageAnchor): XmlElement => ({\r\n    name: `xdr:${name}`,\r\n    children: [\r\n        {\r\n            name: 'xdr:col',\r\n            textNode: imageAnchor.col.toString(),\r\n        },\r\n        {\r\n            name: 'xdr:colOff',\r\n            textNode: imageAnchor.offsetX.toString(),\r\n        },\r\n        {\r\n            name: 'xdr:row',\r\n            textNode: imageAnchor.row.toString(),\r\n        },\r\n        {\r\n            name: 'xdr:rowOff',\r\n            textNode: imageAnchor.offsetY.toString(),\r\n        },\r\n    ],\r\n});\r\n\r\nconst getExt = (image: ExcelImage): XmlElement => {\r\n    const children: XmlElement[] = [\r\n        {\r\n            name: 'a:ext',\r\n            properties: {\r\n                rawMap: {\r\n                    uri: '{FF2B5EF4-FFF2-40B4-BE49-F238E27FC236}',\r\n                },\r\n            },\r\n            children: [\r\n                {\r\n                    name: 'a16:creationId',\r\n                    properties: {\r\n                        rawMap: {\r\n                            id: '{822E6D20-D7BC-2841-A643-D49A6EF008A2}',\r\n                            'xmlns:a16': 'http://schemas.microsoft.com/office/drawing/2014/main',\r\n                        },\r\n                    },\r\n                },\r\n            ],\r\n        },\r\n    ];\r\n    const recolor = image.recolor && image.recolor.toLowerCase();\r\n\r\n    switch (recolor) {\r\n        case 'grayscale':\r\n        case 'sepia':\r\n        case 'washout':\r\n            children.push({\r\n                name: 'a:ext',\r\n                properties: {\r\n                    rawMap: {\r\n                        uri: '{C183D7F6-B498-43B3-948B-1728B52AA6E4}',\r\n                    },\r\n                },\r\n                children: [\r\n                    {\r\n                        name: 'adec:decorative',\r\n                        properties: {\r\n                            rawMap: {\r\n                                val: '0',\r\n                                'xmlns:adec': 'http://schemas.microsoft.com/office/drawing/2017/decorative',\r\n                            },\r\n                        },\r\n                    },\r\n                ],\r\n            });\r\n    }\r\n\r\n    return {\r\n        name: 'a:extLst',\r\n        children,\r\n    };\r\n};\r\n\r\nconst getNvPicPr = (image: ExcelImage, index: number) => ({\r\n    name: 'xdr:nvPicPr',\r\n    children: [\r\n        {\r\n            name: 'xdr:cNvPr',\r\n            properties: {\r\n                rawMap: {\r\n                    id: index,\r\n                    name: image.id,\r\n                    descr: image.altText != null ? image.altText : undefined,\r\n                },\r\n            },\r\n            children: [getExt(image)],\r\n        },\r\n        {\r\n            name: 'xdr:cNvPicPr',\r\n            properties: {\r\n                rawMap: {\r\n                    preferRelativeResize: '0',\r\n                },\r\n            },\r\n            children: [\r\n                {\r\n                    name: 'a:picLocks',\r\n                },\r\n            ],\r\n        },\r\n    ],\r\n});\r\n\r\nconst getColorDetails = (color: ImageColor): XmlElement[] | undefined => {\r\n    if (!color.saturation && !color.tint) {\r\n        return;\r\n    }\r\n    const ret: XmlElement[] = [];\r\n\r\n    if (color.saturation) {\r\n        ret.push({\r\n            name: 'a:satMod',\r\n            properties: {\r\n                rawMap: {\r\n                    val: color.saturation * 1000,\r\n                },\r\n            },\r\n        });\r\n    }\r\n\r\n    if (color.tint) {\r\n        ret.push({\r\n            name: 'a:tint',\r\n            properties: {\r\n                rawMap: {\r\n                    val: color.tint * 1000,\r\n                },\r\n            },\r\n        });\r\n    }\r\n\r\n    return ret;\r\n};\r\n\r\nconst getDuoTone = (primaryColor: ImageColor, secondaryColor: ImageColor): XmlElement => {\r\n    return {\r\n        name: 'a:duotone',\r\n        children: [\r\n            {\r\n                name: 'a:prstClr',\r\n                properties: {\r\n                    rawMap: {\r\n                        val: primaryColor.color,\r\n                    },\r\n                },\r\n                children: getColorDetails(primaryColor),\r\n            },\r\n            {\r\n                name: 'a:srgbClr',\r\n                properties: {\r\n                    rawMap: {\r\n                        val: secondaryColor.color,\r\n                    },\r\n                },\r\n                children: getColorDetails(secondaryColor),\r\n            },\r\n        ],\r\n    };\r\n};\r\n\r\nconst getBlipFill = (image: ExcelImage, index: number) => {\r\n    let blipChildren: XmlElement[] | undefined;\r\n\r\n    if (image.transparency) {\r\n        const transparency = Math.min(Math.max(image.transparency, 0), 100);\r\n        blipChildren = [\r\n            {\r\n                name: 'a:alphaModFix',\r\n                properties: {\r\n                    rawMap: {\r\n                        amt: 100000 - Math.round(transparency * 1000),\r\n                    },\r\n                },\r\n            },\r\n        ];\r\n    }\r\n\r\n    if (image.recolor) {\r\n        if (!blipChildren) {\r\n            blipChildren = [];\r\n        }\r\n        switch (image.recolor.toLocaleLowerCase()) {\r\n            case 'grayscale':\r\n                blipChildren.push({ name: 'a:grayscl' });\r\n                break;\r\n            case 'sepia':\r\n                blipChildren.push(getDuoTone({ color: 'black' }, { color: 'D9C3A5', tint: 50, saturation: 180 }));\r\n                break;\r\n            case 'washout':\r\n                blipChildren.push({\r\n                    name: 'a:lum',\r\n                    properties: {\r\n                        rawMap: {\r\n                            bright: '70000',\r\n                            contrast: '-70000',\r\n                        },\r\n                    },\r\n                });\r\n                break;\r\n            default:\r\n        }\r\n    }\r\n\r\n    return {\r\n        name: 'xdr:blipFill',\r\n        children: [\r\n            {\r\n                name: 'a:blip',\r\n                properties: {\r\n                    rawMap: {\r\n                        cstate: 'print',\r\n                        'r:embed': `rId${index}`,\r\n                        'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\r\n                    },\r\n                },\r\n                children: blipChildren,\r\n            },\r\n            {\r\n                name: 'a:stretch',\r\n                children: [\r\n                    {\r\n                        name: 'a:fillRect',\r\n                    },\r\n                ],\r\n            },\r\n        ],\r\n    };\r\n};\r\n\r\nconst getSpPr = (image: ExcelImage, imageBoxSize: ImageBoxSize) => {\r\n    const xfrm: XmlElement = {\r\n        name: 'a:xfrm',\r\n        children: [\r\n            {\r\n                name: 'a:off',\r\n                properties: {\r\n                    rawMap: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                },\r\n            },\r\n            {\r\n                name: 'a:ext',\r\n                properties: {\r\n                    rawMap: {\r\n                        cx: imageBoxSize.width,\r\n                        cy: imageBoxSize.height,\r\n                    },\r\n                },\r\n            },\r\n        ],\r\n    };\r\n\r\n    if (image.rotation) {\r\n        const rotation = image.rotation;\r\n        xfrm.properties = {\r\n            rawMap: {\r\n                rot: Math.min(Math.max(rotation, 0), 360) * 60000,\r\n            },\r\n        };\r\n    }\r\n\r\n    const prstGeom: XmlElement = {\r\n        name: 'a:prstGeom',\r\n        properties: {\r\n            rawMap: {\r\n                prst: 'rect',\r\n            },\r\n        },\r\n        children: [{ name: 'a:avLst' }],\r\n    };\r\n\r\n    const ret = {\r\n        name: 'xdr:spPr',\r\n        children: [xfrm, prstGeom],\r\n    };\r\n\r\n    return ret;\r\n};\r\n\r\nconst getImageBoxSize = (image: ExcelCalculatedImage): ImageBoxSize => {\r\n    image.fitCell = !!image.fitCell || !image.width || !image.height;\r\n\r\n    const { position = {}, fitCell, width = 0, height = 0, totalHeight, totalWidth } = image;\r\n    const { offsetX = 0, offsetY = 0, row = 1, rowSpan = 1, column = 1, colSpan = 1 } = position;\r\n\r\n    return {\r\n        from: {\r\n            row: row - 1,\r\n            col: column - 1,\r\n            offsetX: pixelsToEMU(offsetX),\r\n            offsetY: pixelsToEMU(offsetY),\r\n        },\r\n        to: {\r\n            row: row - 1 + (fitCell ? 1 : rowSpan - 1),\r\n            col: column - 1 + (fitCell ? 1 : colSpan - 1),\r\n            offsetX: pixelsToEMU(width + offsetX),\r\n            offsetY: pixelsToEMU(height + offsetY),\r\n        },\r\n        height: pixelsToEMU(totalHeight || height),\r\n        width: pixelsToEMU(totalWidth || width),\r\n    };\r\n};\r\n\r\nconst getPicture = (\r\n    image: ExcelImage,\r\n    currentIndex: number,\r\n    worksheetImageIndex: number,\r\n    imageBoxSize: ImageBoxSize\r\n): XmlElement => {\r\n    return {\r\n        name: 'xdr:pic',\r\n        children: [\r\n            getNvPicPr(image, currentIndex + 1),\r\n            getBlipFill(image, worksheetImageIndex + 1),\r\n            getSpPr(image, imageBoxSize),\r\n        ],\r\n    };\r\n};\r\n\r\nconst drawingFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(config: { sheetIndex: number }) {\r\n        const { sheetIndex } = config;\r\n        const sheetImages = XLSX_WORKSHEET_IMAGES.get(sheetIndex);\r\n        const sheetImageIds = XLSX_WORKSHEET_IMAGE_IDS.get(sheetIndex);\r\n\r\n        const children = sheetImages!.map((image, idx) => {\r\n            const boxSize = getImageBoxSize(image);\r\n            return {\r\n                name: 'xdr:twoCellAnchor',\r\n                properties: {\r\n                    rawMap: {\r\n                        editAs: 'absolute',\r\n                    },\r\n                },\r\n                children: [\r\n                    getAnchor('from', boxSize.from),\r\n                    getAnchor('to', boxSize.to),\r\n                    getPicture(image, idx, sheetImageIds!.get(image.id)!.index, boxSize),\r\n                    { name: 'xdr:clientData' },\r\n                ],\r\n            };\r\n        });\r\n\r\n        return {\r\n            name: 'xdr:wsDr',\r\n            properties: {\r\n                rawMap: {\r\n                    'xmlns:a': 'http://schemas.openxmlformats.org/drawingml/2006/main',\r\n                    'xmlns:xdr': 'http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing',\r\n                },\r\n            },\r\n            children,\r\n        };\r\n    },\r\n};\r\n\r\nexport default drawingFactory;\r\n", "import type { ExcelOOXMLTemplate, ExcelRelationship } from 'ag-grid-community';\r\n\r\nconst relationshipFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(config: ExcelRelationship) {\r\n        const { Id, Type, Target } = config;\r\n        return {\r\n            name: 'Relationship',\r\n            properties: {\r\n                rawMap: {\r\n                    Id,\r\n                    Type,\r\n                    Target,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default relationshipFactory;\r\n", "import type { ExcelOOXMLTemplate, ExcelRelationship } from 'ag-grid-community';\r\n\r\nimport relationshipFactory from './relationship';\r\n\r\nconst relationshipsFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(c: ExcelRelationship[]) {\r\n        const children = c.map((relationship) => relationshipFactory.getTemplate(relationship));\r\n\r\n        return {\r\n            name: 'Relationships',\r\n            properties: {\r\n                rawMap: {\r\n                    xmlns: 'http://schemas.openxmlformats.org/package/2006/relationships',\r\n                },\r\n            },\r\n            children,\r\n        };\r\n    },\r\n};\r\n\r\nexport default relationshipsFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport { buildSharedString } from '../../assets/excelUtils';\r\n\r\nconst sharedStrings: ExcelOOXMLTemplate = {\r\n    getTemplate(strings: Map<string, number>) {\r\n        return {\r\n            name: 'sst',\r\n            properties: {\r\n                rawMap: {\r\n                    xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n                    count: strings.size,\r\n                    uniqueCount: strings.size,\r\n                },\r\n            },\r\n            children: buildSharedString(strings),\r\n        };\r\n    },\r\n};\r\n\r\nexport default sharedStrings;\r\n", "const getWeightName = (value?: number): 'thin' | 'medium' | 'thick' | 'hair' => {\r\n    switch (value) {\r\n        case 1:\r\n            return 'thin';\r\n        case 2:\r\n            return 'medium';\r\n        case 3:\r\n            return 'thick';\r\n        default:\r\n            return 'hair';\r\n    }\r\n};\r\n\r\ntype ColorKeyType =\r\n    | 'None'\r\n    | 'Solid'\r\n    | 'Gray50'\r\n    | 'Gray75'\r\n    | 'Gray25'\r\n    | 'Gray125'\r\n    | 'Gray0625'\r\n    | 'HorzStripe'\r\n    | 'VertStripe'\r\n    | 'ReverseDiagStripe'\r\n    | 'DiagStripe'\r\n    | 'DiagCross'\r\n    | 'ThickDiagCross'\r\n    | 'ThickDiagCross'\r\n    | 'ThinHorzStripe'\r\n    | 'ThinVertStripe'\r\n    | 'ThinReverseDiagStripe'\r\n    | 'ThinDiagStripe'\r\n    | 'ThinHorzCross'\r\n    | 'ThinDiagCross';\r\n\r\ntype ColorValueType =\r\n    | 'none'\r\n    | 'solid'\r\n    | 'mediumGray'\r\n    | 'darkGray'\r\n    | 'lightGray'\r\n    | 'gray125'\r\n    | 'gray0625'\r\n    | 'darkHorizontal'\r\n    | 'darkVertical'\r\n    | 'darkDown'\r\n    | 'darkUp'\r\n    | 'darkGrid'\r\n    | 'darkTrellis'\r\n    | 'lightHorizontal'\r\n    | 'lightVertical'\r\n    | 'lightDown'\r\n    | 'lightUp'\r\n    | 'lightGrid'\r\n    | 'lightTrellis';\r\n\r\ntype BorderKeyType = 'Dot' | 'Dash';\r\ntype BorderTransformedKeyType = 'Dotted' | 'Dashed';\r\ntype BorderFixedNames = 'None' | 'Double' | 'DashDot' | 'DashDotDot' | 'SlantDashDot' | 'Continuous';\r\ntype LegacyBorderType = BorderKeyType | BorderFixedNames;\r\ntype MediumBordersType = 'Dashed' | 'DashDot' | 'DashDotDot';\r\ntype BorderType =\r\n    | 'none'\r\n    | 'thin'\r\n    | 'medium'\r\n    | 'dashed'\r\n    | 'dotted'\r\n    | 'thick'\r\n    | 'double'\r\n    | 'hair'\r\n    | 'mediumDashed'\r\n    | 'dashDot'\r\n    | 'mediumDashDot'\r\n    | 'dashDotDot'\r\n    | 'mediumDashDotDot'\r\n    | 'slantDashDot';\r\n\r\ntype BaseAlignmentKeyType = 'Automatic' | 'Center' | 'Justify' | 'Distributed' | 'JustifyDistributed';\r\ntype HorizontalAlignmentKeyType = BaseAlignmentKeyType | 'Left' | 'Right' | 'Fill' | 'CenterAcrossSelection';\r\ntype VerticalAlignmentKeyType = BaseAlignmentKeyType | 'Top' | 'Bottom';\r\n\r\ntype BaseAlignmentType = 'center' | 'justify' | 'distributed';\r\ntype HorizontalAlignmentType = BaseAlignmentType | 'general' | 'left' | 'right' | 'fill' | 'centerContinuous';\r\ntype VerticalAlignmentType = BaseAlignmentType | 'top' | 'bottom' | undefined;\r\n\r\nconst mappedBorderNames: { [key in BorderKeyType | BorderFixedNames]: BorderTransformedKeyType | BorderFixedNames } = {\r\n    None: 'None',\r\n    Dot: 'Dotted',\r\n    Dash: 'Dashed',\r\n    Double: 'Double',\r\n    DashDot: 'DashDot',\r\n    DashDotDot: 'DashDotDot',\r\n    SlantDashDot: 'SlantDashDot',\r\n    Continuous: 'Continuous',\r\n};\r\n\r\nconst mediumBorders: MediumBordersType[] = ['Dashed', 'DashDot', 'DashDotDot'];\r\n\r\nconst colorMap: { [key in ColorKeyType]: ColorValueType } = {\r\n    None: 'none',\r\n    Solid: 'solid',\r\n    Gray50: 'mediumGray',\r\n    Gray75: 'darkGray',\r\n    Gray25: 'lightGray',\r\n    HorzStripe: 'darkHorizontal',\r\n    VertStripe: 'darkVertical',\r\n    ReverseDiagStripe: 'darkDown',\r\n    DiagStripe: 'darkUp',\r\n    DiagCross: 'darkGrid',\r\n    ThickDiagCross: 'darkTrellis',\r\n    ThinHorzStripe: 'lightHorizontal',\r\n    ThinVertStripe: 'lightVertical',\r\n    ThinReverseDiagStripe: 'lightDown',\r\n    ThinDiagStripe: 'lightUp',\r\n    ThinHorzCross: 'lightGrid',\r\n    ThinDiagCross: 'lightTrellis',\r\n    Gray125: 'gray125',\r\n    Gray0625: 'gray0625',\r\n};\r\n\r\nconst horizontalAlignmentMap: { [key in HorizontalAlignmentKeyType]: HorizontalAlignmentType } = {\r\n    Automatic: 'general',\r\n    Left: 'left',\r\n    Center: 'center',\r\n    Right: 'right',\r\n    Fill: 'fill',\r\n    Justify: 'justify',\r\n    CenterAcrossSelection: 'centerContinuous',\r\n    Distributed: 'distributed',\r\n    JustifyDistributed: 'justify',\r\n};\r\n\r\nconst verticalAlignmentMap: { [key in VerticalAlignmentKeyType]: VerticalAlignmentType } = {\r\n    Automatic: undefined,\r\n    Top: 'top',\r\n    Bottom: 'bottom',\r\n    Center: 'center',\r\n    Justify: 'justify',\r\n    Distributed: 'distributed',\r\n    JustifyDistributed: 'justify',\r\n};\r\n\r\nexport const convertLegacyPattern = (name: ColorKeyType | undefined): (typeof colorMap)[keyof typeof colorMap] => {\r\n    if (!name) {\r\n        return 'none';\r\n    }\r\n\r\n    return colorMap[name] || name;\r\n};\r\n\r\nexport const convertLegacyColor = (color?: string): string | undefined => {\r\n    if (color == undefined) {\r\n        return color;\r\n    }\r\n\r\n    if (color.charAt(0) === '#') {\r\n        color = color.substring(1);\r\n    }\r\n\r\n    return color.length === 6 ? 'FF' + color : color;\r\n};\r\n\r\nexport const convertLegacyBorder = (type?: LegacyBorderType, weight?: number): BorderType => {\r\n    if (!type) {\r\n        return 'thin';\r\n    }\r\n\r\n    // Legacy Types are: None, Continuous, Dash, Dot, DashDot, DashDotDot, SlantDashDot, and Double\r\n    // Weight represents: 0\u2014Hairline, 1\u2014Thin , 2\u2014Medium, 3\u2014Thick\r\n\r\n    // New types: none, thin, medium, dashed, dotted, thick, double, hair, mediumDashed, dashDot, mediumDashDot,\r\n    // dashDotDot, mediumDashDotDot, slantDashDot\r\n    const namedWeight = getWeightName(weight);\r\n\r\n    if (type === 'Continuous') {\r\n        return namedWeight;\r\n    }\r\n\r\n    const mappedName = mappedBorderNames[type];\r\n    if (namedWeight === 'medium' && mediumBorders.some((type) => type === mappedName)) {\r\n        return `medium${mappedName as 'Dashed' | 'DashDot' | 'DashDotDot'}`;\r\n    }\r\n\r\n    return `${mappedName.charAt(0).toLowerCase()}${mappedName.substring(1)}` as BorderType;\r\n};\r\n\r\nexport const convertLegacyHorizontalAlignment = (alignment: HorizontalAlignmentKeyType): HorizontalAlignmentType => {\r\n    return horizontalAlignmentMap[alignment] || 'general';\r\n};\r\n\r\nexport const convertLegacyVerticalAlignment = (alignment: VerticalAlignmentKeyType): VerticalAlignmentType => {\r\n    return verticalAlignmentMap[alignment] || undefined;\r\n};\r\n", "import type { ExcelOOXMLTemplate, XmlElement } from 'ag-grid-community';\r\n\r\nimport type { BorderSet } from '../../../assets/excelInterfaces';\r\nimport { convertLegacyColor } from '../../../assets/excelLegacyConvert';\r\n\r\nconst getBorderColor = (color?: string): XmlElement => {\r\n    return {\r\n        name: 'color',\r\n        properties: {\r\n            rawMap: {\r\n                rgb: convertLegacyColor(color || '#000000'),\r\n            },\r\n        },\r\n    };\r\n};\r\n\r\nconst borderFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(border: BorderSet) {\r\n        const { left, right, top, bottom, diagonal } = border;\r\n        const leftChildren = left ? [getBorderColor(left.color)] : undefined;\r\n        const rightChildren = right ? [getBorderColor(right.color)] : undefined;\r\n        const topChildren = top ? [getBorderColor(top.color)] : undefined;\r\n        const bottomChildren = bottom ? [getBorderColor(bottom.color)] : undefined;\r\n        const diagonalChildren = diagonal ? [getBorderColor(diagonal.color)] : undefined;\r\n        return {\r\n            name: 'border',\r\n            children: [\r\n                {\r\n                    name: 'left',\r\n                    properties: { rawMap: { style: left && left.style } },\r\n                    children: leftChildren,\r\n                },\r\n                {\r\n                    name: 'right',\r\n                    properties: { rawMap: { style: right && right.style } },\r\n                    children: rightChildren,\r\n                },\r\n                {\r\n                    name: 'top',\r\n                    properties: { rawMap: { style: top && top.style } },\r\n                    children: topChildren,\r\n                },\r\n                {\r\n                    name: 'bottom',\r\n                    properties: { rawMap: { style: bottom && bottom.style } },\r\n                    children: bottomChildren,\r\n                },\r\n                {\r\n                    name: 'diagonal',\r\n                    properties: { rawMap: { style: diagonal && diagonal.style } },\r\n                    children: diagonalChildren,\r\n                },\r\n            ],\r\n        };\r\n    },\r\n};\r\n\r\nexport default borderFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport type { BorderSet } from '../../../assets/excelInterfaces';\r\nimport borderFactory from './border';\r\n\r\nconst bordersFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(borders: BorderSet[]) {\r\n        return {\r\n            name: 'borders',\r\n            properties: {\r\n                rawMap: {\r\n                    count: borders.length,\r\n                },\r\n            },\r\n            children: borders.map((border) => borderFactory.getTemplate(border)),\r\n        };\r\n    },\r\n};\r\n\r\nexport default bordersFactory;\r\n", "import type { ExcelAlignment, ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport { convertLegacyHorizontalAlignment, convertLegacyVerticalAlignment } from '../../../assets/excelLegacyConvert';\r\n\r\nconst getReadingOrderId = (readingOrder: string): number => {\r\n    const order = ['Context', 'LeftToRight', 'RightToLeft'];\r\n    const pos = order.indexOf(readingOrder);\r\n    return Math.max(pos, 0);\r\n};\r\n\r\nconst alignmentFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(alignment: ExcelAlignment) {\r\n        const { horizontal, indent, readingOrder, rotate, shrinkToFit, vertical, wrapText } = alignment;\r\n\r\n        return {\r\n            name: 'alignment',\r\n            properties: {\r\n                rawMap: {\r\n                    horizontal: horizontal && convertLegacyHorizontalAlignment(horizontal),\r\n                    indent,\r\n                    readingOrder: readingOrder && getReadingOrderId(readingOrder),\r\n                    textRotation: rotate,\r\n                    shrinkToFit,\r\n                    vertical: vertical && convertLegacyVerticalAlignment(vertical),\r\n                    wrapText,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default alignmentFactory;\r\n", "import type { ExcelOOXMLTemplate, ExcelProtection } from 'ag-grid-community';\r\n\r\nconst protectionFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(protection: ExcelProtection) {\r\n        const locked = protection.protected === false ? 0 : 1;\r\n        const hidden = protection.hideFormula === true ? 1 : 0;\r\n        return {\r\n            name: 'protection',\r\n            properties: {\r\n                rawMap: {\r\n                    hidden,\r\n                    locked,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default protectionFactory;\r\n", "import type { ExcelAlignment, ExcelOOXMLTemplate, ExcelProtection, XmlElement } from 'ag-grid-community';\r\n\r\nimport alignmentFactory from './alignment';\r\nimport protectionFactory from './protection';\r\n\r\nconst xfFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(xf: Xf) {\r\n        const { alignment, borderId, fillId, fontId, numFmtId, protection, quotePrefix, xfId } = xf;\r\n        const children: XmlElement[] = [];\r\n        if (alignment) {\r\n            children.push(alignmentFactory.getTemplate(alignment));\r\n        }\r\n\r\n        if (protection) {\r\n            children.push(protectionFactory.getTemplate(protection));\r\n        }\r\n\r\n        return {\r\n            name: 'xf',\r\n            properties: {\r\n                rawMap: {\r\n                    applyAlignment: alignment ? 1 : undefined,\r\n                    applyProtection: protection ? 1 : undefined,\r\n                    applyBorder: borderId ? 1 : undefined,\r\n                    applyFill: fillId ? 1 : undefined,\r\n                    borderId,\r\n                    fillId,\r\n                    applyFont: fontId ? 1 : undefined,\r\n                    fontId,\r\n                    applyNumberFormat: numFmtId ? 1 : undefined,\r\n                    numFmtId,\r\n                    quotePrefix: quotePrefix ? 1 : undefined,\r\n                    xfId,\r\n                },\r\n            },\r\n            children: children.length ? children : undefined,\r\n        };\r\n    },\r\n};\r\n\r\nexport default xfFactory;\r\n\r\nexport interface Xf {\r\n    alignment?: ExcelAlignment;\r\n    borderId: number;\r\n    fillId: number;\r\n    fontId: number;\r\n    numFmtId: number;\r\n    quotePrefix?: number;\r\n    xfId?: number;\r\n    protection?: ExcelProtection;\r\n}\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport type { Xf } from './xf';\r\nimport xfFactory from './xf';\r\n\r\nconst cellStylesXfsFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(xfs: Xf[]) {\r\n        return {\r\n            name: 'cellStyleXfs',\r\n            properties: {\r\n                rawMap: {\r\n                    count: xfs.length,\r\n                },\r\n            },\r\n            children: xfs.map((xf) => xfFactory.getTemplate(xf)),\r\n        };\r\n    },\r\n};\r\n\r\nexport default cellStylesXfsFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nconst borderFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(cellStyle: CellStyle) {\r\n        const { builtinId, name, xfId } = cellStyle;\r\n\r\n        return {\r\n            name: 'cellStyle',\r\n            properties: {\r\n                rawMap: {\r\n                    builtinId,\r\n                    name,\r\n                    xfId,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default borderFactory;\r\n\r\nexport interface CellStyle {\r\n    builtinId: number;\r\n    name: string;\r\n    xfId: number;\r\n}\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport type { CellStyle } from './cellStyle';\r\nimport cellStyleFactory from './cellStyle';\r\n\r\nconst cellStylesFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(cellStyles: CellStyle[]) {\r\n        return {\r\n            name: 'cellStyles',\r\n            properties: {\r\n                rawMap: {\r\n                    count: cellStyles.length,\r\n                },\r\n            },\r\n            children: cellStyles.map((cellStyle) => cellStyleFactory.getTemplate(cellStyle)),\r\n        };\r\n    },\r\n};\r\n\r\nexport default cellStylesFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport type { Xf } from './xf';\r\nimport xfFactory from './xf';\r\n\r\nconst cellXfsFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(xfs: Xf[]) {\r\n        return {\r\n            name: 'cellXfs',\r\n            properties: {\r\n                rawMap: {\r\n                    count: xfs.length,\r\n                },\r\n            },\r\n            children: xfs.map((xf) => xfFactory.getTemplate(xf)),\r\n        };\r\n    },\r\n};\r\n\r\nexport default cellXfsFactory;\r\n", "import type { ExcelOOXMLTemplate, XmlElement } from 'ag-grid-community';\r\n\r\nimport type { Fill } from '../../../assets/excelInterfaces';\r\n\r\nconst fillFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(fill: Fill) {\r\n        const { patternType, fgTheme, fgTint, fgRgb, bgRgb, bgIndexed } = fill;\r\n        const pf: XmlElement = {\r\n            name: 'patternFill',\r\n            properties: {\r\n                rawMap: {\r\n                    patternType,\r\n                },\r\n            },\r\n        };\r\n\r\n        if (fgTheme || fgTint || fgRgb) {\r\n            pf.children = [\r\n                {\r\n                    name: 'fgColor',\r\n                    properties: {\r\n                        rawMap: {\r\n                            theme: fgTheme,\r\n                            tint: fgTint,\r\n                            rgb: fgRgb,\r\n                        },\r\n                    },\r\n                },\r\n            ];\r\n        }\r\n\r\n        if (bgIndexed || bgRgb) {\r\n            if (!pf.children) {\r\n                pf.children = [];\r\n            }\r\n            pf.children.push({\r\n                name: 'bgColor',\r\n                properties: {\r\n                    rawMap: {\r\n                        indexed: bgIndexed,\r\n                        rgb: bgRgb,\r\n                    },\r\n                },\r\n            });\r\n        }\r\n\r\n        return {\r\n            name: 'fill',\r\n            children: [pf],\r\n        };\r\n    },\r\n};\r\n\r\nexport default fillFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport type { Fill } from '../../../assets/excelInterfaces';\r\nimport fillFactory from './fill';\r\n\r\nconst fillsFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(fills: Fill[]) {\r\n        return {\r\n            name: 'fills',\r\n            properties: {\r\n                rawMap: {\r\n                    count: fills.length,\r\n                },\r\n            },\r\n            children: fills.map((fill) => fillFactory.getTemplate(fill)),\r\n        };\r\n    },\r\n};\r\n\r\nexport default fillsFactory;\r\n", "import type { ExcelOOXMLTemplate, XmlElement } from 'ag-grid-community';\r\n\r\nimport type { ExcelThemeFont } from '../../../assets/excelInterfaces';\r\n\r\nconst fontFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(font: ExcelThemeFont) {\r\n        const {\r\n            size,\r\n            colorTheme,\r\n            color = 'FF000000',\r\n            fontName = 'Calibri',\r\n            family,\r\n            scheme,\r\n            italic,\r\n            bold,\r\n            strikeThrough,\r\n            outline,\r\n            shadow,\r\n            underline,\r\n            verticalAlign,\r\n        } = font;\r\n\r\n        const children: XmlElement[] = [\r\n            { name: 'sz', properties: { rawMap: { val: size } } },\r\n            { name: 'color', properties: { rawMap: { theme: colorTheme, rgb: color } } },\r\n            { name: 'name', properties: { rawMap: { val: fontName } } },\r\n        ];\r\n\r\n        if (family) {\r\n            children.push({ name: 'family', properties: { rawMap: { val: family } } });\r\n        }\r\n\r\n        if (scheme) {\r\n            children.push({ name: 'scheme', properties: { rawMap: { val: scheme } } });\r\n        }\r\n\r\n        if (italic) {\r\n            children.push({ name: 'i' });\r\n        }\r\n        if (bold) {\r\n            children.push({ name: 'b' });\r\n        }\r\n        if (strikeThrough) {\r\n            children.push({ name: 'strike' });\r\n        }\r\n        if (outline) {\r\n            children.push({ name: 'outline' });\r\n        }\r\n        if (shadow) {\r\n            children.push({ name: 'shadow' });\r\n        }\r\n        if (underline) {\r\n            children.push({ name: 'u', properties: { rawMap: { val: underline } } });\r\n        }\r\n        if (verticalAlign) {\r\n            children.push({ name: 'vertAlign', properties: { rawMap: { val: verticalAlign } } });\r\n        }\r\n\r\n        return { name: 'font', children };\r\n    },\r\n};\r\n\r\nexport default fontFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport type { ExcelThemeFont } from '../../../assets/excelInterfaces';\r\nimport fontFactory from './font';\r\n\r\nconst fontsFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(fonts: ExcelThemeFont[]) {\r\n        return {\r\n            name: 'fonts',\r\n            properties: {\r\n                rawMap: {\r\n                    count: fonts.length,\r\n                },\r\n            },\r\n            children: fonts.map((font) => fontFactory.getTemplate(font)),\r\n        };\r\n    },\r\n};\r\n\r\nexport default fontsFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\nimport { _escapeString } from 'ag-grid-community';\r\n\r\nimport type { NumberFormat } from '../../../assets/excelInterfaces';\r\n\r\nfunction prepareString(str: string): string {\r\n    const split = str.split(/(\\[[^\\]]*\\])/);\r\n\r\n    for (let i = 0; i < split.length; i++) {\r\n        // excel formulas require symbols to be escaped. Excel also requires $ to be\r\n        // placed in quotes but only when the $ is not wrapped inside of square brackets.\r\n        let currentString = split[i];\r\n        if (!currentString.length) {\r\n            continue;\r\n        }\r\n        if (!currentString.startsWith('[')) {\r\n            currentString = currentString.replace(/\\$/g, '\"$\"');\r\n        }\r\n\r\n        split[i] = _escapeString(currentString) as string;\r\n    }\r\n\r\n    return split.join('');\r\n}\r\n\r\nconst numberFormatFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(numberFormat: NumberFormat) {\r\n        let { formatCode, numFmtId } = numberFormat;\r\n\r\n        if (formatCode.length) {\r\n            formatCode = prepareString(formatCode);\r\n        }\r\n\r\n        return {\r\n            name: 'numFmt',\r\n            properties: {\r\n                rawMap: {\r\n                    formatCode,\r\n                    numFmtId,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default numberFormatFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport type { NumberFormat } from '../../../assets/excelInterfaces';\r\nimport numberFormatFactory from './numberFormat';\r\n\r\nconst numberFormatsFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(numberFormats: NumberFormat[]) {\r\n        return {\r\n            name: 'numFmts',\r\n            properties: {\r\n                rawMap: {\r\n                    count: numberFormats.length,\r\n                },\r\n            },\r\n            children: numberFormats.map((numberFormat) => numberFormatFactory.getTemplate(numberFormat)),\r\n        };\r\n    },\r\n};\r\n\r\nexport default numberFormatsFactory;\r\n", "import type { ExcelBorders, ExcelFont, ExcelInterior, ExcelOOXMLTemplate, ExcelStyle } from 'ag-grid-community';\r\n\r\nimport { numberFormatMap } from '../../../assets/excelConstants';\r\nimport type {\r\n    Border,\r\n    BorderProperty,\r\n    BorderSet,\r\n    ExcelThemeFont,\r\n    Fill,\r\n    NumberFormat,\r\n} from '../../../assets/excelInterfaces';\r\nimport { convertLegacyBorder, convertLegacyColor, convertLegacyPattern } from '../../../assets/excelLegacyConvert';\r\nimport { getFontFamilyId } from '../../../assets/excelUtils';\r\nimport bordersFactory from './borders';\r\nimport type { CellStyle } from './cellStyle';\r\nimport cellStylesXfsFactory from './cellStyleXfs';\r\nimport cellStylesFactory from './cellStyles';\r\nimport cellXfsFactory from './cellXfs';\r\nimport fillsFactory from './fills';\r\nimport fontsFactory from './fonts';\r\nimport numberFormatsFactory from './numberFormats';\r\nimport type { Xf } from './xf';\r\n\r\nlet stylesMap: { [key: string]: number };\r\nlet registeredNumberFmts: NumberFormat[];\r\nlet registeredFonts: ExcelThemeFont[];\r\nlet registeredFills: Fill[];\r\nlet registeredBorders: BorderSet[];\r\nlet registeredCellStyleXfs: Xf[];\r\nlet registeredCellXfs: Xf[];\r\nlet registeredCellStyles: CellStyle[];\r\nlet currentSheet: number;\r\n\r\nconst getStyleName = (name: string, currentSheet: number): string => {\r\n    if (name.indexOf('mixedStyle') !== -1 && currentSheet > 1) {\r\n        name += `_${currentSheet}`;\r\n    }\r\n    return name;\r\n};\r\n\r\nconst resetStylesheetValues = (): void => {\r\n    stylesMap = { base: 0 };\r\n    registeredNumberFmts = [];\r\n    registeredFonts = [{ fontName: 'Calibri', colorTheme: '1', family: '2', scheme: 'minor' }];\r\n    registeredFills = [{ patternType: 'none' }, { patternType: 'gray125' }];\r\n    registeredBorders = [{ left: undefined, right: undefined, top: undefined, bottom: undefined, diagonal: undefined }];\r\n    registeredCellStyleXfs = [{ borderId: 0, fillId: 0, fontId: 0, numFmtId: 0 }];\r\n    registeredCellXfs = [{ borderId: 0, fillId: 0, fontId: 0, numFmtId: 0, xfId: 0 }];\r\n    registeredCellStyles = [{ builtinId: 0, name: 'Normal', xfId: 0 }];\r\n};\r\n\r\nconst registerFill = (fill: ExcelInterior): number => {\r\n    const convertedPattern = convertLegacyPattern(fill.pattern);\r\n    const convertedFillColor = convertLegacyColor(fill.color);\r\n    const convertedPatternColor = convertLegacyColor(fill.patternColor);\r\n\r\n    let pos = registeredFills.findIndex((currentFill) => {\r\n        const { patternType, fgRgb, bgRgb } = currentFill;\r\n\r\n        if (patternType != convertedPattern || fgRgb != convertedFillColor || bgRgb != convertedPatternColor) {\r\n            return false;\r\n        }\r\n        return true;\r\n    });\r\n\r\n    if (pos === -1) {\r\n        pos = registeredFills.length;\r\n        registeredFills.push({\r\n            patternType: convertedPattern,\r\n            fgRgb: convertedFillColor,\r\n            bgRgb: convertedPatternColor,\r\n        });\r\n    }\r\n\r\n    return pos;\r\n};\r\n\r\nconst registerNumberFmt = (format: string): number => {\r\n    if (numberFormatMap[format]) {\r\n        return numberFormatMap[format];\r\n    }\r\n\r\n    let pos = registeredNumberFmts.findIndex((currentFormat) => currentFormat.formatCode === format);\r\n\r\n    if (pos === -1) {\r\n        pos = registeredNumberFmts.length + 164;\r\n        registeredNumberFmts.push({ formatCode: format, numFmtId: pos });\r\n    } else {\r\n        pos = registeredNumberFmts[pos].numFmtId;\r\n    }\r\n\r\n    return pos;\r\n};\r\n\r\nconst registerBorders = (borders: ExcelBorders): number => {\r\n    const { borderBottom, borderTop, borderLeft, borderRight } = borders;\r\n    let bottomStyle: BorderProperty;\r\n    let topStyle: BorderProperty;\r\n    let leftStyle: BorderProperty;\r\n    let rightStyle: BorderProperty;\r\n    let bottomColor: BorderProperty;\r\n    let topColor: BorderProperty;\r\n    let leftColor: BorderProperty;\r\n    let rightColor: BorderProperty;\r\n\r\n    if (borderLeft) {\r\n        leftStyle = convertLegacyBorder(borderLeft.lineStyle, borderLeft.weight);\r\n        leftColor = convertLegacyColor(borderLeft.color);\r\n    }\r\n\r\n    if (borderRight) {\r\n        rightStyle = convertLegacyBorder(borderRight.lineStyle, borderRight.weight);\r\n        rightColor = convertLegacyColor(borderRight.color);\r\n    }\r\n\r\n    if (borderBottom) {\r\n        bottomStyle = convertLegacyBorder(borderBottom.lineStyle, borderBottom.weight);\r\n        bottomColor = convertLegacyColor(borderBottom.color);\r\n    }\r\n    if (borderTop) {\r\n        topStyle = convertLegacyBorder(borderTop.lineStyle, borderTop.weight);\r\n        topColor = convertLegacyColor(borderTop.color);\r\n    }\r\n\r\n    let pos = registeredBorders.findIndex((currentBorder) => {\r\n        const { left, right, top, bottom } = currentBorder;\r\n        if (!left && (leftStyle || leftColor)) {\r\n            return false;\r\n        }\r\n        if (!right && (rightStyle || rightColor)) {\r\n            return false;\r\n        }\r\n        if (!top && (topStyle || topColor)) {\r\n            return false;\r\n        }\r\n        if (!bottom && (bottomStyle || bottomColor)) {\r\n            return false;\r\n        }\r\n\r\n        const { style: clS, color: clC } = left || ({} as Border);\r\n        const { style: crS, color: crC } = right || ({} as Border);\r\n        const { style: ctS, color: ctC } = top || ({} as Border);\r\n        const { style: cbS, color: cbC } = bottom || ({} as Border);\r\n\r\n        if (clS != leftStyle || clC != leftColor) {\r\n            return false;\r\n        }\r\n        if (crS != rightStyle || crC != rightColor) {\r\n            return false;\r\n        }\r\n        if (ctS != topStyle || ctC != topColor) {\r\n            return false;\r\n        }\r\n        if (cbS != bottomStyle || cbC != bottomColor) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    });\r\n\r\n    if (pos === -1) {\r\n        pos = registeredBorders.length;\r\n        registeredBorders.push({\r\n            left: {\r\n                style: leftStyle,\r\n                color: leftColor,\r\n            },\r\n            right: {\r\n                style: rightStyle,\r\n                color: rightColor,\r\n            },\r\n            top: {\r\n                style: topStyle,\r\n                color: topColor,\r\n            },\r\n            bottom: {\r\n                style: bottomStyle,\r\n                color: bottomColor,\r\n            },\r\n            diagonal: {\r\n                style: undefined,\r\n                color: undefined,\r\n            },\r\n        });\r\n    }\r\n\r\n    return pos;\r\n};\r\n\r\nconst registerFont = (font: ExcelFont): number => {\r\n    const {\r\n        fontName: name = 'Calibri',\r\n        color,\r\n        size,\r\n        bold,\r\n        italic,\r\n        outline,\r\n        shadow,\r\n        strikeThrough,\r\n        underline,\r\n        family,\r\n        verticalAlign,\r\n    } = font;\r\n    const convertedColor = convertLegacyColor(color);\r\n    const familyId = getFontFamilyId(family);\r\n    const convertedUnderline = underline ? underline.toLocaleLowerCase() : undefined;\r\n    const convertedVerticalAlign = verticalAlign ? verticalAlign.toLocaleLowerCase() : undefined;\r\n\r\n    let pos = registeredFonts.findIndex((currentFont) => {\r\n        if (\r\n            currentFont.fontName != name ||\r\n            currentFont.color != convertedColor ||\r\n            currentFont.size != size ||\r\n            currentFont.bold != bold ||\r\n            currentFont.italic != italic ||\r\n            currentFont.outline != outline ||\r\n            currentFont.shadow != shadow ||\r\n            currentFont.strikeThrough != strikeThrough ||\r\n            currentFont.underline != convertedUnderline ||\r\n            currentFont.verticalAlign != convertedVerticalAlign ||\r\n            currentFont.family != familyId\r\n        ) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    });\r\n\r\n    if (pos === -1) {\r\n        pos = registeredFonts.length;\r\n        registeredFonts.push({\r\n            fontName: name,\r\n            color: convertedColor,\r\n            size,\r\n            bold,\r\n            italic,\r\n            outline,\r\n            shadow,\r\n            strikeThrough,\r\n            underline: convertedUnderline as any,\r\n            verticalAlign: convertedVerticalAlign as any,\r\n            family: familyId != null ? familyId.toString() : undefined,\r\n        });\r\n    }\r\n\r\n    return pos;\r\n};\r\n\r\nconst registerStyle = (config: ExcelStyle & { quotePrefix?: 1 }): void => {\r\n    const { alignment, borders, font, interior, numberFormat, protection, quotePrefix } = config;\r\n    let { id } = config;\r\n    let currentFill = 0;\r\n    let currentBorder = 0;\r\n    let currentFont = 0;\r\n    let currentNumberFmt = 0;\r\n\r\n    if (!id) {\r\n        return;\r\n    }\r\n\r\n    id = getStyleName(id, currentSheet);\r\n\r\n    if (stylesMap[id] != undefined) {\r\n        return;\r\n    }\r\n\r\n    if (interior) {\r\n        currentFill = registerFill(interior);\r\n    }\r\n\r\n    if (borders) {\r\n        currentBorder = registerBorders(borders);\r\n    }\r\n\r\n    if (font) {\r\n        currentFont = registerFont(font);\r\n    }\r\n\r\n    if (numberFormat) {\r\n        currentNumberFmt = registerNumberFmt(numberFormat.format);\r\n    }\r\n\r\n    stylesMap[id] = registeredCellXfs.length;\r\n\r\n    registeredCellXfs.push({\r\n        alignment,\r\n        borderId: currentBorder || 0,\r\n        fillId: currentFill || 0,\r\n        fontId: currentFont || 0,\r\n        numFmtId: currentNumberFmt || 0,\r\n        protection,\r\n        quotePrefix: quotePrefix,\r\n        xfId: 0,\r\n    });\r\n};\r\n\r\nconst stylesheetFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(defaultFontSize: number) {\r\n        const numberFormats = numberFormatsFactory.getTemplate(registeredNumberFmts);\r\n        const fonts = fontsFactory.getTemplate(\r\n            registeredFonts.map((font) => ({ ...font, size: font.size != null ? font.size : defaultFontSize }))\r\n        );\r\n        const fills = fillsFactory.getTemplate(registeredFills);\r\n        const borders = bordersFactory.getTemplate(registeredBorders);\r\n        const cellStylesXfs = cellStylesXfsFactory.getTemplate(registeredCellStyleXfs);\r\n        const cellXfs = cellXfsFactory.getTemplate(registeredCellXfs);\r\n        const cellStyles = cellStylesFactory.getTemplate(registeredCellStyles);\r\n\r\n        resetStylesheetValues();\r\n\r\n        return {\r\n            name: 'styleSheet',\r\n            properties: {\r\n                rawMap: {\r\n                    'mc:Ignorable': 'x14ac x16r2 xr',\r\n                    xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n                    'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\r\n                    'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac',\r\n                    'xmlns:x16r2': 'http://schemas.microsoft.com/office/spreadsheetml/2015/02/main',\r\n                    'xmlns:xr': 'http://schemas.microsoft.com/office/spreadsheetml/2014/revision',\r\n                },\r\n            },\r\n            children: [\r\n                numberFormats,\r\n                fonts,\r\n                fills,\r\n                borders,\r\n                cellStylesXfs,\r\n                cellXfs,\r\n                cellStyles,\r\n                {\r\n                    name: 'tableStyles',\r\n                    properties: {\r\n                        rawMap: {\r\n                            count: 0,\r\n                            defaultPivotStyle: 'PivotStyleLight16',\r\n                            defaultTableStyle: 'TableStyleMedium2',\r\n                        },\r\n                    },\r\n                },\r\n            ],\r\n        };\r\n    },\r\n};\r\n\r\nexport const getStyleId = (name: string, currentSheet: number): number => {\r\n    return stylesMap[getStyleName(name, currentSheet)] || 0;\r\n};\r\n\r\nexport const registerStyles = (styles: ExcelStyle[], _currentSheet: number): void => {\r\n    currentSheet = _currentSheet;\r\n\r\n    if (currentSheet === 1) {\r\n        resetStylesheetValues();\r\n    }\r\n\r\n    styles.forEach(registerStyle);\r\n};\r\n\r\nexport default stylesheetFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport type { ExcelDataTable } from '../../assets/excelInterfaces';\r\nimport { getExcelColumnName } from '../../assets/excelUtils';\r\n\r\nconst tableFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(dataTable: ExcelDataTable, idx: number) {\r\n        const {\r\n            name,\r\n            columns,\r\n            rowRange,\r\n            displayName,\r\n            showRowStripes,\r\n            showColumnStripes,\r\n            showFilterButtons,\r\n            highlightFirstColumn,\r\n            highlightLastColumn,\r\n        } = dataTable || {};\r\n\r\n        const noRows = !rowRange || rowRange[0] - rowRange[1] === 0;\r\n        if (!dataTable || !name || !Array.isArray(columns) || !columns.length || noRows) {\r\n            return { name: 'table' };\r\n        }\r\n\r\n        const filterColumns = columns.map((col: string, idx: number) => ({\r\n            name: 'filterColumn',\r\n            properties: {\r\n                rawMap: {\r\n                    colId: idx.toString(), // For filters, this should start with 0\r\n                    hiddenButton: showFilterButtons[idx] ? 0 : 1,\r\n                },\r\n            },\r\n        }));\r\n\r\n        const firstCell = `A${rowRange[0]}`;\r\n        const lastCell = `${getExcelColumnName(columns.length)}${rowRange[1]}`;\r\n        const ref = `${firstCell}:${lastCell}`;\r\n        const id: string = `${idx + 1}`;\r\n        const displayNameToUse = idx ? `${displayName}_${id}` : displayName;\r\n\r\n        return {\r\n            name: 'table',\r\n            properties: {\r\n                rawMap: {\r\n                    xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n                    'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\r\n                    'mc:Ignorable': 'xr xr3',\r\n                    'xmlns:xr': 'http://schemas.microsoft.com/office/spreadsheetml/2014/revision',\r\n                    'xmlns:xr3': 'http://schemas.microsoft.com/office/spreadsheetml/2016/revision3',\r\n                    name,\r\n                    displayName: displayNameToUse,\r\n                    ref,\r\n                    totalsRowShown: 0,\r\n                    id,\r\n                },\r\n            },\r\n            children: [\r\n                {\r\n                    name: 'autoFilter',\r\n                    properties: {\r\n                        rawMap: {\r\n                            ref,\r\n                        },\r\n                    },\r\n                    children: filterColumns,\r\n                },\r\n                {\r\n                    name: 'tableColumns',\r\n                    properties: {\r\n                        rawMap: {\r\n                            count: columns.length,\r\n                        },\r\n                    },\r\n                    children: columns.map((col: string, idx: number) => ({\r\n                        name: 'tableColumn',\r\n                        properties: {\r\n                            rawMap: {\r\n                                id: (idx + 1).toString(),\r\n                                name: col,\r\n                                dataCellStyle: 'Normal',\r\n                            },\r\n                        },\r\n                    })),\r\n                },\r\n                {\r\n                    name: 'tableStyleInfo',\r\n                    properties: {\r\n                        rawMap: {\r\n                            name: 'TableStyleLight1',\r\n                            showFirstColumn: highlightFirstColumn ? 1 : 0,\r\n                            showLastColumn: highlightLastColumn ? 1 : 0,\r\n                            showRowStripes: showRowStripes ? 1 : 0,\r\n                            showColumnStripes: showColumnStripes ? 1 : 0,\r\n                        },\r\n                    },\r\n                },\r\n            ],\r\n        };\r\n    },\r\n};\r\n\r\nexport default tableFactory;\r\n", "import type { ExcelOOXMLTemplate, XmlElement } from 'ag-grid-community';\r\n\r\nconst getColorChildren = (props: [string, string, string, string?]): XmlElement => {\r\n    const [type, innerType, val, lastClr] = props;\r\n\r\n    return {\r\n        name: `a:${type}`,\r\n        children: [\r\n            {\r\n                name: `a:${innerType}`,\r\n                properties: {\r\n                    rawMap: {\r\n                        val,\r\n                        lastClr,\r\n                    },\r\n                },\r\n            },\r\n        ],\r\n    };\r\n};\r\n\r\nconst colorScheme: ExcelOOXMLTemplate = {\r\n    getTemplate() {\r\n        return {\r\n            name: 'a:clrScheme',\r\n            properties: {\r\n                rawMap: {\r\n                    name: 'Office',\r\n                },\r\n            },\r\n            children: [\r\n                getColorChildren(['dk1', 'sysClr', 'windowText', '000000']),\r\n                getColorChildren(['lt1', 'sysClr', 'window', 'FFFFFF']),\r\n                getColorChildren(['dk2', 'srgbClr', '44546A']),\r\n                getColorChildren(['lt2', 'srgbClr', 'E7E6E6']),\r\n                getColorChildren(['accent1', 'srgbClr', '4472C4']),\r\n                getColorChildren(['accent2', 'srgbClr', 'ED7D31']),\r\n                getColorChildren(['accent3', 'srgbClr', 'A5A5A5']),\r\n                getColorChildren(['accent4', 'srgbClr', 'FFC000']),\r\n                getColorChildren(['accent5', 'srgbClr', '5B9BD5']),\r\n                getColorChildren(['accent6', 'srgbClr', '70AD47']),\r\n                getColorChildren(['hlink', 'srgbClr', '0563C1']),\r\n                getColorChildren(['folHlink', 'srgbClr', '954F72']),\r\n            ],\r\n        };\r\n    },\r\n};\r\n\r\nexport default colorScheme;\r\n", "import type { ExcelOOXMLTemplate, XmlElement } from 'ag-grid-community';\r\n\r\nconst getFont = (props: [string, string, string?, string?]): XmlElement => {\r\n    const [type, typeface, script, panose] = props;\r\n    return {\r\n        name: `a:${type}`,\r\n        properties: {\r\n            rawMap: {\r\n                script,\r\n                typeface,\r\n                panose,\r\n            },\r\n        },\r\n    };\r\n};\r\n\r\nconst fontScheme: ExcelOOXMLTemplate = {\r\n    getTemplate() {\r\n        return {\r\n            name: 'a:fontScheme',\r\n            properties: {\r\n                rawMap: {\r\n                    name: 'Office',\r\n                },\r\n            },\r\n            children: [\r\n                {\r\n                    name: 'a:majorFont',\r\n                    children: [\r\n                        getFont(['latin', 'Calibri Light', undefined, '020F0302020204030204']),\r\n                        getFont(['ea', '']),\r\n                        getFont(['cs', '']),\r\n                        getFont(['font', '\u6E38\u30B4\u30B7\u30C3\u30AF Light', 'Jpan']),\r\n                        getFont(['font', '\uB9D1\uC740 \uACE0\uB515', 'Hang']),\r\n                        getFont(['font', '\u7B49\u7EBF Light', 'Hans']),\r\n                        getFont(['font', '\u65B0\u7D30\u660E\u9AD4', 'Hant']),\r\n                        getFont(['font', 'Times New Roman', 'Arab']),\r\n                        getFont(['font', 'Times New Roman', 'Hebr']),\r\n                        getFont(['font', 'Tahoma', 'Thai']),\r\n                        getFont(['font', 'Nyala', 'Ethi']),\r\n                        getFont(['font', 'Vrinda', 'Beng']),\r\n                        getFont(['font', 'Shruti', 'Gujr']),\r\n                        getFont(['font', 'MoolBoran', 'Khmr']),\r\n                        getFont(['font', 'Tunga', 'Knda']),\r\n                        getFont(['font', 'Raavi', 'Guru']),\r\n                        getFont(['font', 'Euphemia', 'Cans']),\r\n                        getFont(['font', 'Plantagenet Cherokee', 'Cher']),\r\n                        getFont(['font', 'Microsoft Yi Baiti', 'Yiii']),\r\n                        getFont(['font', 'Microsoft Himalaya', 'Tibt']),\r\n                        getFont(['font', 'MV Boli', 'Thaa']),\r\n                        getFont(['font', 'Mangal', 'Deva']),\r\n                        getFont(['font', 'Gautami', 'Telu']),\r\n                        getFont(['font', 'Latha', 'Taml']),\r\n                        getFont(['font', 'Estrangelo Edessa', 'Syrc']),\r\n                        getFont(['font', 'Kalinga', 'Orya']),\r\n                        getFont(['font', 'Kartika', 'Mlym']),\r\n                        getFont(['font', 'DokChampa', 'Laoo']),\r\n                        getFont(['font', 'Iskoola Pota', 'Sinh']),\r\n                        getFont(['font', 'Mongolian Baiti', 'Mong']),\r\n                        getFont(['font', 'Times New Roman', 'Viet']),\r\n                        getFont(['font', 'Microsoft Uighur', 'Uigh']),\r\n                        getFont(['font', 'Sylfaen', 'Geor']),\r\n                        getFont(['font', 'Arial', 'Armn']),\r\n                        getFont(['font', 'Leelawadee UI', 'Bugi']),\r\n                        getFont(['font', 'Microsoft JhengHei', 'Bopo']),\r\n                        getFont(['font', 'Javanese Text', 'Java']),\r\n                        getFont(['font', 'Segoe UI', 'Lisu']),\r\n                        getFont(['font', 'Myanmar Text', 'Mymr']),\r\n                        getFont(['font', 'Ebrima', 'Nkoo']),\r\n                        getFont(['font', 'Nirmala UI', 'Olck']),\r\n                        getFont(['font', 'Ebrima', 'Osma']),\r\n                        getFont(['font', 'Phagspa', 'Phag']),\r\n                        getFont(['font', 'Estrangelo Edessa', 'Syrn']),\r\n                        getFont(['font', 'Estrangelo Edessa', 'Syrj']),\r\n                        getFont(['font', 'Estrangelo Edessa', 'Syre']),\r\n                        getFont(['font', 'Nirmala UI', 'Sora']),\r\n                        getFont(['font', 'Microsoft Tai Le', 'Tale']),\r\n                        getFont(['font', 'Microsoft New Tai Lue', 'Talu']),\r\n                        getFont(['font', 'Ebrima', 'Tfng']),\r\n                    ],\r\n                },\r\n                {\r\n                    name: 'a:minorFont',\r\n                    children: [\r\n                        getFont(['latin', 'Calibri', undefined, '020F0502020204030204']),\r\n                        getFont(['ea', '']),\r\n                        getFont(['cs', '']),\r\n                        getFont(['font', '\u6E38\u30B4\u30B7\u30C3\u30AF', 'Jpan']),\r\n                        getFont(['font', '\uB9D1\uC740 \uACE0\uB515', 'Hang']),\r\n                        getFont(['font', '\u7B49\u7EBF', 'Hans']),\r\n                        getFont(['font', '\u65B0\u7D30\u660E\u9AD4', 'Hant']),\r\n                        getFont(['font', 'Arial', 'Arab']),\r\n                        getFont(['font', 'Arial', 'Hebr']),\r\n                        getFont(['font', 'Tahoma', 'Thai']),\r\n                        getFont(['font', 'Nyala', 'Ethi']),\r\n                        getFont(['font', 'Vrinda', 'Beng']),\r\n                        getFont(['font', 'Shruti', 'Gujr']),\r\n                        getFont(['font', 'DaunPenh', 'Khmr']),\r\n                        getFont(['font', 'Tunga', 'Knda']),\r\n                        getFont(['font', 'Raavi', 'Guru']),\r\n                        getFont(['font', 'Euphemia', 'Cans']),\r\n                        getFont(['font', 'Plantagenet Cherokee', 'Cher']),\r\n                        getFont(['font', 'Microsoft Yi Baiti', 'Yiii']),\r\n                        getFont(['font', 'Microsoft Himalaya', 'Tibt']),\r\n                        getFont(['font', 'MV Boli', 'Thaa']),\r\n                        getFont(['font', 'Mangal', 'Deva']),\r\n                        getFont(['font', 'Gautami', 'Telu']),\r\n                        getFont(['font', 'Latha', 'Taml']),\r\n                        getFont(['font', 'Estrangelo Edessa', 'Syrc']),\r\n                        getFont(['font', 'Kalinga', 'Orya']),\r\n                        getFont(['font', 'Kartika', 'Mlym']),\r\n                        getFont(['font', 'DokChampa', 'Laoo']),\r\n                        getFont(['font', 'Iskoola Pota', 'Sinh']),\r\n                        getFont(['font', 'Mongolian Baiti', 'Mong']),\r\n                        getFont(['font', 'Arial', 'Viet']),\r\n                        getFont(['font', 'Microsoft Uighur', 'Uigh']),\r\n                        getFont(['font', 'Sylfaen', 'Geor']),\r\n                        getFont(['font', 'Arial', 'Armn']),\r\n                        getFont(['font', 'Leelawadee UI', 'Bugi']),\r\n                        getFont(['font', 'Microsoft JhengHei', 'Bopo']),\r\n                        getFont(['font', 'Javanese Text', 'Java']),\r\n                        getFont(['font', 'Segoe UI', 'Lisu']),\r\n                        getFont(['font', 'Myanmar Text', 'Mymr']),\r\n                        getFont(['font', 'Ebrima', 'Nkoo']),\r\n                        getFont(['font', 'Nirmala UI', 'Olck']),\r\n                        getFont(['font', 'Ebrima', 'Osma']),\r\n                        getFont(['font', 'Phagspa', 'Phag']),\r\n                        getFont(['font', 'Estrangelo Edessa', 'Syrn']),\r\n                        getFont(['font', 'Estrangelo Edessa', 'Syrj']),\r\n                        getFont(['font', 'Estrangelo Edessa', 'Syre']),\r\n                        getFont(['font', 'Nirmala UI', 'Sora']),\r\n                        getFont(['font', 'Microsoft Tai Le', 'Tale']),\r\n                        getFont(['font', 'Microsoft New Tai Lue', 'Talu']),\r\n                        getFont(['font', 'Ebrima', 'Tfng']),\r\n                    ],\r\n                },\r\n            ],\r\n        };\r\n    },\r\n};\r\n\r\nexport default fontScheme;\r\n", "import type { ExcelOOXMLTemplate, XmlElement } from 'ag-grid-community';\r\n\r\ntype GsType = [string, string, string, string?, string?, string?];\r\ntype LinType = [string, string];\r\n\r\nconst getPropertyVal = (name: string, val: string, children?: XmlElement[]): XmlElement => ({\r\n    name: `a:${name}`,\r\n    properties: {\r\n        rawMap: {\r\n            val,\r\n        },\r\n    },\r\n    children,\r\n});\r\n\r\nconst getGs = (props: GsType): XmlElement => {\r\n    const [pos, schemeColor, satMod, lumMod, tint, shade] = props;\r\n    const children: XmlElement[] = [];\r\n\r\n    children.push(getPropertyVal('satMod', satMod));\r\n    if (lumMod) {\r\n        children.push(getPropertyVal('lumMod', lumMod));\r\n    }\r\n    if (tint) {\r\n        children.push(getPropertyVal('tint', tint));\r\n    }\r\n    if (shade) {\r\n        children.push(getPropertyVal('shade', shade));\r\n    }\r\n\r\n    return {\r\n        name: 'a:gs',\r\n        properties: {\r\n            rawMap: {\r\n                pos,\r\n            },\r\n        },\r\n        children: [\r\n            {\r\n                name: 'a:schemeClr',\r\n                properties: {\r\n                    rawMap: {\r\n                        val: schemeColor,\r\n                    },\r\n                },\r\n                children,\r\n            },\r\n        ],\r\n    };\r\n};\r\n\r\nconst getSolidFill = (val: string, children?: XmlElement[]): XmlElement => ({\r\n    name: 'a:solidFill',\r\n    children: [getPropertyVal('schemeClr', val, children)],\r\n});\r\n\r\nconst getGradFill = (props: [string, GsType, GsType, GsType, LinType]): XmlElement => {\r\n    const [rotWithShape, gs1, gs2, gs3, lin] = props;\r\n    const [ang, scaled] = lin;\r\n    return {\r\n        name: 'a:gradFill',\r\n        properties: {\r\n            rawMap: {\r\n                rotWithShape,\r\n            },\r\n        },\r\n        children: [\r\n            {\r\n                name: 'a:gsLst',\r\n                children: [getGs(gs1), getGs(gs2), getGs(gs3)],\r\n            },\r\n            {\r\n                name: 'a:lin',\r\n                properties: {\r\n                    rawMap: {\r\n                        ang: ang,\r\n                        scaled: scaled,\r\n                    },\r\n                },\r\n            },\r\n        ],\r\n    };\r\n};\r\n\r\nconst getLine = (props: [string, string, string, string]): XmlElement => {\r\n    const [w, cap, cmpd, algn] = props;\r\n\r\n    return {\r\n        name: 'a:ln',\r\n        properties: {\r\n            rawMap: { w, cap, cmpd, algn },\r\n        },\r\n        children: [\r\n            getSolidFill('phClr'),\r\n            getPropertyVal('prstDash', 'solid'),\r\n            {\r\n                name: 'a:miter',\r\n                properties: {\r\n                    rawMap: {\r\n                        lim: '800000',\r\n                    },\r\n                },\r\n            },\r\n        ],\r\n    };\r\n};\r\n\r\nconst getEffectStyle = (shadow?: [string, string, string, string, string]): XmlElement => {\r\n    const children: XmlElement[] = [];\r\n\r\n    if (shadow) {\r\n        const [blurRad, dist, dir, algn, rotWithShape] = shadow;\r\n        children.push({\r\n            name: 'a:outerShdw',\r\n            properties: {\r\n                rawMap: { blurRad, dist, dir, algn, rotWithShape },\r\n            },\r\n            children: [getPropertyVal('srgbClr', '000000', [getPropertyVal('alpha', '63000')])],\r\n        });\r\n    }\r\n\r\n    return {\r\n        name: 'a:effectStyle',\r\n        children: [\r\n            Object.assign(\r\n                {},\r\n                {\r\n                    name: 'a:effectLst',\r\n                },\r\n                children.length ? { children } : {}\r\n            ),\r\n        ],\r\n    };\r\n};\r\n\r\nconst getFillStyleList = (): XmlElement => ({\r\n    name: 'a:fillStyleLst',\r\n    children: [\r\n        getSolidFill('phClr'),\r\n        getGradFill([\r\n            '1',\r\n            ['0', 'phClr', '105000', '110000', '67000'],\r\n            ['50000', 'phClr', '103000', '105000', '73000'],\r\n            ['100000', 'phClr', '109000', '105000', '81000'],\r\n            ['5400000', '0'],\r\n        ]),\r\n        getGradFill([\r\n            '1',\r\n            ['0', 'phClr', '103000', '102000', '94000'],\r\n            ['50000', 'phClr', '110000', '100000', undefined, '100000'],\r\n            ['100000', 'phClr', '120000', '99000', undefined, '78000'],\r\n            ['5400000', '0'],\r\n        ]),\r\n    ],\r\n});\r\n\r\nconst getLineStyleList = (): XmlElement => ({\r\n    name: 'a:lnStyleLst',\r\n    children: [\r\n        getLine(['6350', 'flat', 'sng', 'ctr']),\r\n        getLine(['12700', 'flat', 'sng', 'ctr']),\r\n        getLine(['19050', 'flat', 'sng', 'ctr']),\r\n    ],\r\n});\r\n\r\nconst getEffectStyleList = (): XmlElement => ({\r\n    name: 'a:effectStyleLst',\r\n    children: [getEffectStyle(), getEffectStyle(), getEffectStyle(['57150', '19050', '5400000', 'ctr', '0'])],\r\n});\r\n\r\nconst getBgFillStyleList = (): XmlElement => ({\r\n    name: 'a:bgFillStyleLst',\r\n    children: [\r\n        getSolidFill('phClr'),\r\n        getSolidFill('phClr', [getPropertyVal('tint', '95000'), getPropertyVal('satMod', '170000')]),\r\n        getGradFill([\r\n            '1',\r\n            ['0', 'phClr', '150000', '102000', '93000', '98000'],\r\n            ['50000', 'phClr', '130000', '103000', '98000', '90000'],\r\n            ['100000', 'phClr', '120000', undefined, undefined, '63000'],\r\n            ['5400000', '0'],\r\n        ]),\r\n    ],\r\n});\r\n\r\nconst formatScheme: ExcelOOXMLTemplate = {\r\n    getTemplate() {\r\n        return {\r\n            name: 'a:fmtScheme',\r\n            properties: {\r\n                rawMap: {\r\n                    name: 'Office',\r\n                },\r\n            },\r\n            children: [getFillStyleList(), getLineStyleList(), getEffectStyleList(), getBgFillStyleList()],\r\n        };\r\n    },\r\n};\r\n\r\nexport default formatScheme;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport colorScheme from './colorScheme';\r\nimport fontScheme from './fontScheme';\r\nimport formatScheme from './formatScheme';\r\n\r\nconst themeElements: ExcelOOXMLTemplate = {\r\n    getTemplate() {\r\n        return {\r\n            name: 'a:themeElements',\r\n            children: [colorScheme.getTemplate(), fontScheme.getTemplate(), formatScheme.getTemplate()],\r\n        };\r\n    },\r\n};\r\n\r\nexport default themeElements;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport themeElements from './office/themeElements';\r\n\r\nconst officeTheme: ExcelOOXMLTemplate = {\r\n    getTemplate() {\r\n        return {\r\n            name: 'a:theme',\r\n            properties: {\r\n                prefixedAttributes: [\r\n                    {\r\n                        prefix: 'xmlns:',\r\n                        map: {\r\n                            a: 'http://schemas.openxmlformats.org/drawingml/2006/main',\r\n                        },\r\n                    },\r\n                ],\r\n                rawMap: {\r\n                    name: 'Office Theme',\r\n                },\r\n            },\r\n            children: [\r\n                themeElements.getTemplate(),\r\n                {\r\n                    name: 'a:objectDefaults',\r\n                },\r\n                {\r\n                    name: 'a:extraClrSchemeLst',\r\n                },\r\n            ],\r\n        };\r\n    },\r\n};\r\n\r\nexport default officeTheme;\r\n", "import type { ExcelOOXMLTemplate, XmlElement } from 'ag-grid-community';\r\n\r\nimport type { ExcelHeaderFooterCalculatedImage } from '../../assets/excelInterfaces';\r\nimport { XLSX_WORKSHEET_HEADER_FOOTER_IMAGES } from '../../excelXlsxFactory';\r\n\r\nconst getShapeLayout = (): XmlElement => ({\r\n    name: 'o:shapelayout',\r\n    properties: {\r\n        prefixedAttributes: [\r\n            {\r\n                prefix: 'v:',\r\n                map: {\r\n                    ext: 'edit',\r\n                },\r\n            },\r\n        ],\r\n    },\r\n    children: [\r\n        {\r\n            name: 'o:idmap',\r\n            properties: {\r\n                prefixedAttributes: [\r\n                    {\r\n                        prefix: 'v:',\r\n                        map: {\r\n                            ext: 'edit',\r\n                        },\r\n                    },\r\n                ],\r\n                rawMap: {\r\n                    data: '1',\r\n                },\r\n            },\r\n        },\r\n    ],\r\n});\r\n\r\nconst getStroke = (): XmlElement => ({\r\n    name: 'v:stroke',\r\n    properties: {\r\n        rawMap: {\r\n            joinstyle: 'miter',\r\n        },\r\n    },\r\n});\r\n\r\nconst getFormulas = (formulas: string[]): XmlElement => ({\r\n    name: 'v:formulas',\r\n    children: formulas.map<XmlElement>((formula) => ({\r\n        name: 'v:f',\r\n        properties: {\r\n            rawMap: {\r\n                eqn: formula,\r\n            },\r\n        },\r\n    })),\r\n});\r\n\r\nconst getPath = (): XmlElement => ({\r\n    name: 'v:path',\r\n    properties: {\r\n        prefixedAttributes: [\r\n            {\r\n                prefix: 'o:',\r\n                map: {\r\n                    connecttype: 'rect',\r\n                    extrusionok: 'f',\r\n                },\r\n            },\r\n        ],\r\n        rawMap: {\r\n            gradientshapeok: 't',\r\n        },\r\n    },\r\n});\r\n\r\nconst getLock = (params?: { aspectratio?: boolean; rotation?: boolean }): XmlElement => {\r\n    const { aspectratio, rotation } = params || {};\r\n    const rawMap: { aspectratio?: 't'; rotation?: 't' } = {};\r\n\r\n    if (aspectratio) {\r\n        rawMap.aspectratio = 't';\r\n    }\r\n\r\n    if (rotation) {\r\n        rawMap.rotation = 't';\r\n    }\r\n\r\n    return {\r\n        name: 'o:lock',\r\n        properties: {\r\n            prefixedAttributes: [\r\n                {\r\n                    prefix: 'v:',\r\n                    map: {\r\n                        ext: 'edit',\r\n                    },\r\n                },\r\n            ],\r\n            rawMap,\r\n        },\r\n    };\r\n};\r\n\r\nfunction mapNumber(\r\n    value: number,\r\n    startSource: number,\r\n    endSource: number,\r\n    startTarget: number,\r\n    endTarget: number\r\n): number {\r\n    return ((value - startSource) / (endSource - startSource)) * (endTarget - startTarget) + startTarget;\r\n}\r\n\r\nconst getImageData = (image: ExcelHeaderFooterCalculatedImage, idx: number): XmlElement => {\r\n    let rawMap: any;\r\n\r\n    const { recolor, brightness, contrast, id } = image;\r\n\r\n    if (recolor) {\r\n        rawMap = {};\r\n        if (recolor === 'Washout' || recolor === 'Grayscale') {\r\n            rawMap.gain = '19661f';\r\n            rawMap.blacklevel = '22938f';\r\n        }\r\n\r\n        if (recolor === 'Black & White' || recolor === 'Grayscale') {\r\n            rawMap.grayscale = 't';\r\n            if (recolor === 'Black & White') {\r\n                rawMap.bilevel = 't';\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!recolor || recolor === 'Grayscale') {\r\n        if (!rawMap) {\r\n            rawMap = {};\r\n        }\r\n\r\n        if (contrast != null && contrast !== 50) {\r\n            let gain = '1';\r\n\r\n            if (contrast >= 0) {\r\n                if (contrast < 50) {\r\n                    gain = String(contrast / 50);\r\n                } else if (contrast < 100) {\r\n                    gain = String(50 / (100 - contrast));\r\n                } else if (contrast === 100) {\r\n                    gain = '2147483647f';\r\n                }\r\n            }\r\n\r\n            rawMap.gain = gain;\r\n        }\r\n\r\n        if (brightness != null && brightness !== 50) {\r\n            rawMap.blacklevel = mapNumber(brightness, 0, 100, -0.5, 0.5).toString();\r\n        }\r\n    }\r\n\r\n    return {\r\n        name: 'v:imagedata',\r\n        properties: {\r\n            prefixedAttributes: [\r\n                {\r\n                    prefix: 'o:',\r\n                    map: {\r\n                        relid: `rId${idx}`,\r\n                        title: id,\r\n                    },\r\n                },\r\n            ],\r\n            rawMap,\r\n        },\r\n    };\r\n};\r\n\r\nconst getShapeType = (): XmlElement => {\r\n    const formulas = [\r\n        'if lineDrawn pixelLineWidth 0',\r\n        'sum @0 1 0',\r\n        'sum 0 0 @1',\r\n        'prod @2 1 2',\r\n        'prod @3 21600 pixelWidth',\r\n        'prod @3 21600 pixelHeight',\r\n        'sum @0 0 1',\r\n        'prod @6 1 2',\r\n        'prod @7 21600 pixelWidth',\r\n        'sum @8 21600 0',\r\n        'prod @7 21600 pixelHeight',\r\n        'sum @10 21600 0',\r\n    ];\r\n\r\n    return {\r\n        name: 'v:shapetype',\r\n        properties: {\r\n            prefixedAttributes: [\r\n                {\r\n                    prefix: 'o:',\r\n                    map: {\r\n                        spt: '75',\r\n                        preferrelative: 't',\r\n                    },\r\n                },\r\n            ],\r\n            rawMap: {\r\n                coordsize: '21600,21600',\r\n                filled: 'f',\r\n                id: '_x0000_t75',\r\n                path: 'm@4@5l@4@11@9@11@9@5xe',\r\n                stroked: 'f',\r\n            },\r\n        },\r\n        children: [getStroke(), getFormulas(formulas), getPath(), getLock({ aspectratio: true })],\r\n    };\r\n};\r\n\r\nconst pixelToPoint = (value?: number) => Math.floor((value ?? 0) * 0.74999943307122);\r\n\r\nconst getShape = (image: ExcelHeaderFooterCalculatedImage, idx: number): XmlElement => {\r\n    const { width = 0, height = 0, altText } = image;\r\n\r\n    const imageWidth = pixelToPoint(width);\r\n    const imageHeight = pixelToPoint(height);\r\n\r\n    return {\r\n        name: 'v:shape',\r\n        properties: {\r\n            rawMap: {\r\n                id: image.headerFooterPosition,\r\n                'o:spid': '_x0000_s1025',\r\n                style: `position: absolute; margin-left: 0; margin-top: 10in; margin-bottom: 0; margin-right: 0; width: ${imageWidth}pt; height: ${imageHeight}pt; z-index: ${idx + 1}`,\r\n                type: '#_x0000_t75',\r\n                alt: altText,\r\n            },\r\n        },\r\n        children: [getImageData(image, idx + 1), getLock({ rotation: true })],\r\n    };\r\n};\r\n\r\nconst vmlDrawingFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(params: { sheetIndex: number }) {\r\n        const headerFooterImages = XLSX_WORKSHEET_HEADER_FOOTER_IMAGES.get(params.sheetIndex) || [];\r\n        const children: XmlElement[] = [\r\n            getShapeLayout(),\r\n            getShapeType(),\r\n            ...headerFooterImages.map((img, idx) => getShape(img, idx)),\r\n        ];\r\n\r\n        return {\r\n            name: 'xml',\r\n            properties: {\r\n                prefixedAttributes: [\r\n                    {\r\n                        prefix: 'xmlns:',\r\n                        map: {\r\n                            v: 'urn:schemas-microsoft-com:vml',\r\n                            o: 'urn:schemas-microsoft-com:office:office',\r\n                            x: 'urn:schemas-microsoft-com:office:excel',\r\n                        },\r\n                    },\r\n                ],\r\n            },\r\n            children,\r\n        };\r\n    },\r\n};\r\n\r\nexport default vmlDrawingFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nconst sheetFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(name: string, idx: number) {\r\n        const sheetId = (idx + 1).toString();\r\n        return {\r\n            name: 'sheet',\r\n            properties: {\r\n                rawMap: {\r\n                    name: name,\r\n                    sheetId: sheetId,\r\n                    'r:id': `rId${sheetId}`,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default sheetFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport sheetFactory from './sheet';\r\n\r\nconst sheetsFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(names: string[]) {\r\n        return {\r\n            name: 'sheets',\r\n            children: names.map((sheet, idx) => sheetFactory.getTemplate(sheet, idx)),\r\n        };\r\n    },\r\n};\r\n\r\nexport default sheetsFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nimport sheetsFactory from './sheets';\r\n\r\nconst workbookFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(names: string[], activeTab: number) {\r\n        return {\r\n            name: 'workbook',\r\n            properties: {\r\n                prefixedAttributes: [\r\n                    {\r\n                        prefix: 'xmlns:',\r\n                        map: {\r\n                            r: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\r\n                        },\r\n                    },\r\n                ],\r\n                rawMap: {\r\n                    xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n                },\r\n            },\r\n            children: [\r\n                {\r\n                    name: 'bookViews',\r\n                    children: [\r\n                        {\r\n                            name: 'workbookView',\r\n                            properties: {\r\n                                rawMap: {\r\n                                    activeTab,\r\n                                },\r\n                            },\r\n                        },\r\n                    ],\r\n                },\r\n                sheetsFactory.getTemplate(names),\r\n            ],\r\n        };\r\n    },\r\n};\r\n\r\nexport default workbookFactory;\r\n", "import type {\r\n    ExcelCell,\r\n    ExcelColumn,\r\n    ExcelFont,\r\n    ExcelHeaderFooterConfig,\r\n    ExcelHeaderFooterContent,\r\n    ExcelOOXMLTemplate,\r\n    ExcelRow,\r\n    ExcelSheetMargin,\r\n    ExcelSheetPageSetup,\r\n    ExcelWorksheet,\r\n    XmlElement,\r\n} from 'ag-grid-community';\r\nimport { _escapeString } from 'ag-grid-community';\r\n\r\nimport type { ExcelDataTable, ExcelHeaderFooterPosition } from '../../assets/excelInterfaces';\r\nimport { getExcelColumnName } from '../../assets/excelUtils';\r\nimport type { ExcelGridSerializingParams } from '../../excelSerializingSession';\r\nimport {\r\n    XLSX_WORKSHEET_DATA_TABLES,\r\n    XLSX_WORKSHEET_HEADER_FOOTER_IMAGES,\r\n    XLSX_WORKSHEET_IMAGES,\r\n    addXlsxHeaderFooterImageToMap,\r\n} from '../../excelXlsxFactory';\r\nimport colFactory from './column';\r\nimport mergeCellFactory from './mergeCell';\r\nimport rowFactory from './row';\r\n\r\nconst getMergedCellsAndAddColumnGroups = (\r\n    rows: ExcelRow[],\r\n    cols: ExcelColumn[],\r\n    suppressColumnOutline: boolean\r\n): string[] => {\r\n    const mergedCells: string[] = [];\r\n    const cellsWithCollapsibleGroups: number[][] = [];\r\n\r\n    rows.forEach((currentRow, rowIdx) => {\r\n        const cells = currentRow.cells;\r\n        let merges = 0;\r\n        let lastCol: ExcelColumn;\r\n\r\n        cells.forEach((currentCell: ExcelCell, cellIdx: number) => {\r\n            const min = cellIdx + merges + 1;\r\n            const start = getExcelColumnName(min);\r\n            const outputRow = rowIdx + 1;\r\n\r\n            if (currentCell.mergeAcross) {\r\n                merges += currentCell.mergeAcross;\r\n                const end = getExcelColumnName(cellIdx + merges + 1);\r\n\r\n                mergedCells.push(`${start}${outputRow}:${end}${outputRow}`);\r\n            }\r\n\r\n            if (!cols[min - 1]) {\r\n                cols[min - 1] = {} as ExcelColumn;\r\n            }\r\n\r\n            const { collapsibleRanges } = currentCell;\r\n\r\n            if (collapsibleRanges) {\r\n                collapsibleRanges.forEach((range) => {\r\n                    cellsWithCollapsibleGroups.push([min + range[0], min + range[1]]);\r\n                });\r\n            }\r\n\r\n            lastCol = cols[min - 1];\r\n            lastCol.min = min;\r\n            lastCol.max = min;\r\n            currentCell.ref = `${start}${outputRow}`;\r\n        });\r\n    });\r\n\r\n    cellsWithCollapsibleGroups.sort((a, b) => {\r\n        if (a[0] !== b[0]) {\r\n            return a[0] - b[0];\r\n        }\r\n        return b[1] - a[1];\r\n    });\r\n\r\n    const rangeMap = new Map<string, boolean>();\r\n    const outlineLevel = new Map<number, number>();\r\n\r\n    cellsWithCollapsibleGroups\r\n        .filter((currentRange) => {\r\n            const rangeString = currentRange.toString();\r\n            const inMap = rangeMap.get(rangeString);\r\n\r\n            if (inMap) {\r\n                return false;\r\n            }\r\n            rangeMap.set(rangeString, true);\r\n\r\n            return true;\r\n        })\r\n        .forEach((range) => {\r\n            const refCol = cols.find((col) => col.min == range[0] && col.max == range[1]);\r\n            const currentOutlineLevel = outlineLevel.get(range[0]);\r\n            cols.push({\r\n                min: range[0],\r\n                max: range[1],\r\n                outlineLevel: suppressColumnOutline ? undefined : currentOutlineLevel || 1,\r\n                width: (refCol || { width: 100 }).width,\r\n            });\r\n\r\n            outlineLevel.set(range[0], (currentOutlineLevel || 0) + 1);\r\n        });\r\n\r\n    return mergedCells;\r\n};\r\n\r\nconst getPageOrientation = (orientation?: 'Portrait' | 'Landscape'): 'portrait' | 'landscape' => {\r\n    if (!orientation || (orientation !== 'Portrait' && orientation !== 'Landscape')) {\r\n        return 'portrait';\r\n    }\r\n\r\n    return orientation.toLocaleLowerCase() as 'portrait' | 'landscape';\r\n};\r\n\r\nconst getPageSize = (pageSize?: string): number => {\r\n    if (pageSize == null) {\r\n        return 1;\r\n    }\r\n\r\n    const positions = [\r\n        'Letter',\r\n        'Letter Small',\r\n        'Tabloid',\r\n        'Ledger',\r\n        'Legal',\r\n        'Statement',\r\n        'Executive',\r\n        'A3',\r\n        'A4',\r\n        'A4 Small',\r\n        'A5',\r\n        'A6',\r\n        'B4',\r\n        'B5',\r\n        'Folio',\r\n        'Envelope',\r\n        'Envelope DL',\r\n        'Envelope C5',\r\n        'Envelope B5',\r\n        'Envelope C3',\r\n        'Envelope C4',\r\n        'Envelope C6',\r\n        'Envelope Monarch',\r\n        'Japanese Postcard',\r\n        'Japanese Double Postcard',\r\n    ];\r\n    const pos = positions.indexOf(pageSize);\r\n\r\n    return pos === -1 ? 1 : pos + 1;\r\n};\r\n\r\nconst replaceHeaderFooterTokens = (value: string): string => {\r\n    const map = {\r\n        '&[Page]': '&P',\r\n        '&[Pages]': '&N',\r\n        '&[Date]': '&D',\r\n        '&[Time]': '&T',\r\n        '&[Tab]': '&A',\r\n        '&[Path]': '&Z',\r\n        '&[File]': '&F',\r\n        '&[Picture]': '&G',\r\n    };\r\n\r\n    Object.entries(map).forEach(([key, val]) => {\r\n        value = value.replace(key, val);\r\n    });\r\n\r\n    return value;\r\n};\r\n\r\nconst getHeaderPosition = (position?: string): 'L' | 'C' | 'R' => {\r\n    if (position === 'Center') {\r\n        return 'C';\r\n    }\r\n    if (position === 'Right') {\r\n        return 'R';\r\n    }\r\n\r\n    return 'L';\r\n};\r\n\r\nconst applyHeaderFontStyle = (headerString: string, font?: ExcelFont): string => {\r\n    if (!font) {\r\n        return headerString;\r\n    }\r\n\r\n    headerString += '&amp;&quot;';\r\n    headerString += font.fontName || 'Calibri';\r\n\r\n    if (font.bold !== font.italic) {\r\n        headerString += font.bold ? ',Bold' : ',Italic';\r\n    } else if (font.bold) {\r\n        headerString += ',Bold Italic';\r\n    } else {\r\n        headerString += ',Regular';\r\n    }\r\n    headerString += '&quot;';\r\n\r\n    if (font.size) {\r\n        headerString += `&amp;${font.size}`;\r\n    }\r\n    if (font.strikeThrough) {\r\n        headerString += '&amp;S';\r\n    }\r\n    if (font.underline) {\r\n        headerString += `&amp;${font.underline === 'Double' ? 'E' : 'U'}`;\r\n    }\r\n    if (font.color) {\r\n        headerString += `&amp;K${font.color.replace('#', '').toUpperCase()}`;\r\n    }\r\n\r\n    return headerString;\r\n};\r\n\r\nconst processHeaderFooterContent = (\r\n    content: ExcelHeaderFooterContent[],\r\n    location: 'H' | 'F',\r\n    rule: 'EVEN' | 'FIRST' | ''\r\n): string =>\r\n    content.reduce((prev, curr, idx) => {\r\n        const pos = getHeaderPosition(curr.position);\r\n        const output = applyHeaderFontStyle(`${prev}&amp;${pos}`, curr.font);\r\n        const PositionMap: ['Left', 'Center', 'Right'] = ['Left', 'Center', 'Right'];\r\n\r\n        if (!curr.position) {\r\n            curr.position = PositionMap[idx];\r\n        }\r\n\r\n        const { image } = curr;\r\n        if (curr.value === '&[Picture]' && image) {\r\n            const imagePosition: ExcelHeaderFooterPosition = `${pos}${location}${rule}`;\r\n            addXlsxHeaderFooterImageToMap(image, imagePosition);\r\n        }\r\n\r\n        return `${output}${_escapeString(replaceHeaderFooterTokens(curr.value))}`;\r\n    }, '');\r\n\r\nconst buildHeaderFooter = (headerFooterConfig: ExcelHeaderFooterConfig): XmlElement[] => {\r\n    const rules: ['all', 'first', 'even'] = ['all', 'first', 'even'];\r\n    const headersAndFooters = [] as XmlElement[];\r\n\r\n    rules.forEach((rule) => {\r\n        const headerFooter = headerFooterConfig[rule];\r\n        const namePrefix = rule === 'all' ? 'odd' : rule;\r\n\r\n        if (!headerFooter) {\r\n            return;\r\n        }\r\n\r\n        for (const [key, value] of Object.entries<ExcelHeaderFooterContent[]>(headerFooter)) {\r\n            const nameSuffix = `${key.charAt(0).toUpperCase()}${key.slice(1)}`;\r\n            const location: 'H' | 'F' = key[0].toUpperCase() as 'H' | 'F';\r\n\r\n            if (value) {\r\n                const normalizedRule: 'FIRST' | 'EVEN' | '' =\r\n                    rule === 'all' ? '' : (rule.toUpperCase() as 'FIRST' | 'EVEN');\r\n                headersAndFooters.push({\r\n                    name: `${namePrefix}${nameSuffix}`,\r\n                    properties: {\r\n                        rawMap: { 'xml:space': 'preserve' },\r\n                    },\r\n                    textNode: processHeaderFooterContent(value, location, normalizedRule),\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    return headersAndFooters;\r\n};\r\n\r\nconst addColumns = (columns: ExcelColumn[]) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        if (columns.length) {\r\n            params.children.push({\r\n                name: 'cols',\r\n                children: columns.map((column) => colFactory.getTemplate(column)),\r\n            });\r\n        }\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addSheetData = (rows: ExcelRow[], sheetNumber: number) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        if (rows.length) {\r\n            params.children.push({\r\n                name: 'sheetData',\r\n                children: rows.map((row, idx) => rowFactory.getTemplate(row, idx, sheetNumber)),\r\n            });\r\n        }\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addMergeCells = (mergeCells: string[]) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        if (mergeCells.length) {\r\n            params.children.push({\r\n                name: 'mergeCells',\r\n                properties: {\r\n                    rawMap: {\r\n                        count: mergeCells.length,\r\n                    },\r\n                },\r\n                children: mergeCells.map((mergedCell) => mergeCellFactory.getTemplate(mergedCell)),\r\n            });\r\n        }\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addPageMargins = (margins: ExcelSheetMargin) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        const { top = 0.75, right = 0.7, bottom = 0.75, left = 0.7, header = 0.3, footer = 0.3 } = margins;\r\n\r\n        params.children.push({\r\n            name: 'pageMargins',\r\n            properties: {\r\n                rawMap: { bottom, footer, header, left, right, top },\r\n            },\r\n        });\r\n\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addPageSetup = (pageSetup?: ExcelSheetPageSetup) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        if (pageSetup) {\r\n            params.children.push({\r\n                name: 'pageSetup',\r\n                properties: {\r\n                    rawMap: {\r\n                        horizontalDpi: 0,\r\n                        verticalDpi: 0,\r\n                        orientation: getPageOrientation(pageSetup.orientation),\r\n                        paperSize: getPageSize(pageSetup.pageSize),\r\n                    },\r\n                },\r\n            });\r\n        }\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addHeaderFooter = (headerFooterConfig?: ExcelHeaderFooterConfig) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        if (!headerFooterConfig) {\r\n            return params;\r\n        }\r\n\r\n        const differentFirst = headerFooterConfig.first != null ? 1 : 0;\r\n        const differentOddEven = headerFooterConfig.even != null ? 1 : 0;\r\n\r\n        params.children.push({\r\n            name: 'headerFooter',\r\n            properties: {\r\n                rawMap: {\r\n                    differentFirst,\r\n                    differentOddEven,\r\n                },\r\n            },\r\n            children: buildHeaderFooter(headerFooterConfig),\r\n        });\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addExcelTableRel = (excelTable?: ExcelDataTable) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        if (excelTable) {\r\n            params.children.push({\r\n                name: 'tableParts',\r\n                properties: {\r\n                    rawMap: {\r\n                        count: '1',\r\n                    },\r\n                },\r\n                children: [\r\n                    {\r\n                        name: 'tablePart',\r\n                        properties: {\r\n                            rawMap: {\r\n                                'r:id': `rId${++params.rIdCounter}`,\r\n                            },\r\n                        },\r\n                    },\r\n                ],\r\n            });\r\n        }\r\n\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addDrawingRel = (currentSheet: number) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        const worksheetImages = XLSX_WORKSHEET_IMAGES.get(currentSheet);\r\n        if (worksheetImages?.length) {\r\n            params.children.push({\r\n                name: 'drawing',\r\n                properties: {\r\n                    rawMap: {\r\n                        'r:id': `rId${++params.rIdCounter}`,\r\n                    },\r\n                },\r\n            });\r\n        }\r\n\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addVmlDrawingRel = (currentSheet: number) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        if (XLSX_WORKSHEET_HEADER_FOOTER_IMAGES.get(currentSheet)) {\r\n            params.children.push({\r\n                name: 'legacyDrawingHF',\r\n                properties: {\r\n                    rawMap: {\r\n                        'r:id': `rId${++params.rIdCounter}`,\r\n                    },\r\n                },\r\n            });\r\n        }\r\n\r\n        return params;\r\n    };\r\n};\r\n\r\nconst getPane = (xSplit: number = 0, ySplit: number = 0) => {\r\n    const shouldSplit = xSplit > 0 || ySplit > 0;\r\n\r\n    return shouldSplit\r\n        ? [\r\n              {\r\n                  name: 'pane',\r\n                  properties: {\r\n                      rawMap: {\r\n                          state: shouldSplit ? 'frozen' : undefined,\r\n                          topLeftCell: shouldSplit ? `${getExcelColumnName(xSplit + 1)}${ySplit + 1}` : undefined,\r\n                          xSplit: xSplit === 0 ? undefined : xSplit,\r\n                          ySplit: ySplit === 0 ? undefined : ySplit,\r\n                      },\r\n                  },\r\n              },\r\n          ]\r\n        : undefined;\r\n};\r\n\r\nconst addSheetViews = (rtl: boolean = false, xSplit?: number, ySplit?: number) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        params.children.push({\r\n            name: 'sheetViews',\r\n            children: [\r\n                {\r\n                    name: 'sheetView',\r\n                    properties: {\r\n                        rawMap: {\r\n                            rightToLeft: rtl === true ? '1' : '0',\r\n                            workbookViewId: '0',\r\n                        },\r\n                    },\r\n                    children: getPane(xSplit, ySplit),\r\n                },\r\n            ],\r\n        });\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addSheetPr = () => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        params.children.push({\r\n            name: 'sheetPr',\r\n            children: [\r\n                {\r\n                    name: 'outlinePr',\r\n                    properties: {\r\n                        rawMap: {\r\n                            summaryBelow: 0,\r\n                        },\r\n                    },\r\n                },\r\n            ],\r\n        });\r\n        return params;\r\n    };\r\n};\r\n\r\nconst addSheetFormatPr = (rows: ExcelRow[]) => {\r\n    return (params: ComposedWorksheetParams) => {\r\n        const maxOutline = rows.reduce((prev: number, row: ExcelRow) => {\r\n            if (row.outlineLevel && row.outlineLevel > prev) {\r\n                return row.outlineLevel;\r\n            }\r\n            return prev;\r\n        }, 0);\r\n\r\n        params.children.push({\r\n            name: 'sheetFormatPr',\r\n            properties: {\r\n                rawMap: {\r\n                    baseColWidth: 10,\r\n                    defaultRowHeight: 16,\r\n                    outlineLevelRow: maxOutline ? maxOutline : undefined,\r\n                },\r\n            },\r\n        });\r\n        return params;\r\n    };\r\n};\r\n\r\ninterface ComposedWorksheetParams {\r\n    children: XmlElement[];\r\n    rIdCounter: number;\r\n}\r\n\r\nconst worksheetFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(params: { worksheet: ExcelWorksheet; currentSheet: number; config: ExcelGridSerializingParams }) {\r\n        const { worksheet, currentSheet, config } = params;\r\n        const {\r\n            margins = {},\r\n            pageSetup,\r\n            headerFooterConfig,\r\n            suppressColumnOutline,\r\n            rightToLeft,\r\n            frozenRowCount,\r\n            frozenColumnCount,\r\n        } = config;\r\n\r\n        const { table } = worksheet;\r\n        const { rows, columns } = table;\r\n        const mergedCells =\r\n            columns && columns.length ? getMergedCellsAndAddColumnGroups(rows, columns, !!suppressColumnOutline) : [];\r\n\r\n        const worksheetExcelTables = XLSX_WORKSHEET_DATA_TABLES.get(currentSheet);\r\n\r\n        const { children } = [\r\n            addSheetPr(),\r\n            addSheetViews(rightToLeft, frozenColumnCount, frozenRowCount),\r\n            addSheetFormatPr(rows),\r\n            addColumns(columns),\r\n            addSheetData(rows, currentSheet + 1),\r\n            addMergeCells(mergedCells),\r\n            addPageMargins(margins),\r\n            addPageSetup(pageSetup),\r\n            addHeaderFooter(headerFooterConfig),\r\n            addDrawingRel(currentSheet),\r\n            addVmlDrawingRel(currentSheet),\r\n            addExcelTableRel(worksheetExcelTables),\r\n        ].reduce((composed, f) => f(composed), { children: [], rIdCounter: 0 });\r\n\r\n        return {\r\n            name: 'worksheet',\r\n            properties: {\r\n                prefixedAttributes: [\r\n                    {\r\n                        prefix: 'xmlns:',\r\n                        map: {\r\n                            r: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\r\n                        },\r\n                    },\r\n                ],\r\n                rawMap: {\r\n                    xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n                },\r\n            },\r\n            children,\r\n        };\r\n    },\r\n};\r\n\r\nexport default worksheetFactory;\r\n", "import type { ExcelColumn, ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\n// https://docs.microsoft.com/en-us/office/troubleshoot/excel/determine-column-widths\r\nconst getExcelCellWidth = (width: number): number => Math.ceil((width - 12) / 7 + 1);\r\n\r\nconst colFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(config: ExcelColumn) {\r\n        const { min, max, outlineLevel, s, width, hidden, bestFit } = config;\r\n        let excelWidth = 1;\r\n        let customWidth = '0';\r\n\r\n        if (width! > 1) {\r\n            excelWidth = getExcelCellWidth(width!);\r\n            customWidth = '1';\r\n        }\r\n\r\n        return {\r\n            name: 'col',\r\n            properties: {\r\n                rawMap: {\r\n                    min: min,\r\n                    max: max,\r\n                    outlineLevel: outlineLevel != null ? outlineLevel : undefined,\r\n                    width: excelWidth,\r\n                    style: s,\r\n                    hidden: hidden ? '1' : '0',\r\n                    bestFit: bestFit ? '1' : '0',\r\n                    customWidth: customWidth,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default colFactory;\r\n", "import type { ExcelOOXMLTemplate } from 'ag-grid-community';\r\n\r\nconst mergeCellFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(ref: string) {\r\n        return {\r\n            name: 'mergeCell',\r\n            properties: {\r\n                rawMap: {\r\n                    ref: ref,\r\n                },\r\n            },\r\n        };\r\n    },\r\n};\r\n\r\nexport default mergeCellFactory;\r\n", "import type { ExcelCell, ExcelOOXMLTemplate } from 'ag-grid-community';\r\nimport { _escapeString } from 'ag-grid-community';\r\n\r\nimport { replaceInvisibleCharacters } from '../../assets/excelUtils';\r\nimport { getStyleId } from './styles/stylesheet';\r\n\r\nconst convertLegacyType = (type: string): string => {\r\n    const t = type.charAt(0).toLowerCase();\r\n\r\n    return t === 's' ? 'inlineStr' : t;\r\n};\r\n\r\nconst cellFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(config: ExcelCell, idx: number, currentSheet: number) {\r\n        const { ref, data, styleId } = config;\r\n        const { type, value } = data || { type: 'empty', value: null };\r\n        let convertedType: string = type;\r\n\r\n        if (type === 'f') {\r\n            convertedType = 'str';\r\n        } else if (type.charAt(0) === type.charAt(0).toUpperCase()) {\r\n            convertedType = convertLegacyType(type);\r\n        }\r\n\r\n        const obj = {\r\n            name: 'c',\r\n            properties: {\r\n                rawMap: {\r\n                    r: ref,\r\n                    t: convertedType === 'empty' ? undefined : convertedType,\r\n                    s: styleId ? getStyleId(styleId as string, currentSheet) : undefined,\r\n                },\r\n            },\r\n        };\r\n\r\n        if (convertedType === 'empty') {\r\n            return obj;\r\n        }\r\n\r\n        let children;\r\n\r\n        if (convertedType === 'str' && type === 'f') {\r\n            children = [\r\n                {\r\n                    name: 'f',\r\n                    textNode: _escapeString(replaceInvisibleCharacters(value), false),\r\n                },\r\n            ];\r\n        } else if (convertedType === 'inlineStr') {\r\n            children = [\r\n                {\r\n                    name: 'is',\r\n                    children: [\r\n                        {\r\n                            name: 't',\r\n                            textNode: _escapeString(replaceInvisibleCharacters(value), false),\r\n                        },\r\n                    ],\r\n                },\r\n            ];\r\n        } else {\r\n            children = [\r\n                {\r\n                    name: 'v',\r\n                    textNode: value,\r\n                },\r\n            ];\r\n        }\r\n\r\n        return Object.assign({}, obj, { children });\r\n    },\r\n};\r\n\r\nexport default cellFactory;\r\n", "import type { ExcelCell, ExcelOOXMLTemplate, ExcelRow } from 'ag-grid-community';\r\n\r\nimport { getExcelColumnName } from '../../assets/excelUtils';\r\nimport cellFactory from './cell';\r\n\r\nconst addEmptyCells = (cells: ExcelCell[], rowIdx: number): void => {\r\n    const mergeMap: { pos: number; excelPos: number }[] = [];\r\n    let posCounter = 0;\r\n    for (let i = 0; i < cells.length; i++) {\r\n        const cell = cells[i];\r\n        if (cell.mergeAcross) {\r\n            mergeMap.push({\r\n                pos: i,\r\n                excelPos: posCounter,\r\n            });\r\n            posCounter += cell.mergeAcross;\r\n        }\r\n        posCounter++;\r\n    }\r\n\r\n    if (mergeMap.length) {\r\n        for (let i = mergeMap.length - 1; i >= 0; i--) {\r\n            const mergedCells: ExcelCell[] = [];\r\n            const cell = cells[mergeMap[i].pos];\r\n            for (let j = 1; j <= cell.mergeAcross!; j++) {\r\n                mergedCells.push({\r\n                    ref: `${getExcelColumnName(mergeMap[i].excelPos + 1 + j)}${rowIdx + 1}`,\r\n                    styleId: cell.styleId,\r\n                    data: { type: 'empty', value: null },\r\n                });\r\n            }\r\n            if (mergedCells.length) {\r\n                cells.splice(mergeMap[i].pos + 1, 0, ...mergedCells);\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nconst shouldDisplayCell = (cell: ExcelCell) => cell.data?.value !== '' || cell.styleId !== undefined;\r\n\r\nconst rowFactory: ExcelOOXMLTemplate = {\r\n    getTemplate(config: ExcelRow, idx: number, currentSheet: number) {\r\n        const { collapsed, hidden, height, outlineLevel, cells = [] } = config;\r\n        addEmptyCells(cells, idx);\r\n        const children = cells\r\n            .filter(shouldDisplayCell)\r\n            .map((cell, idx) => cellFactory.getTemplate(cell, idx, currentSheet));\r\n\r\n        return {\r\n            name: 'row',\r\n            properties: {\r\n                rawMap: {\r\n                    r: idx + 1,\r\n                    collapsed: collapsed ? '1' : '0',\r\n                    hidden: hidden ? '1' : '0',\r\n                    ht: height,\r\n                    customHeight: height != null ? '1' : '0',\r\n                    spans: '1:1',\r\n                    outlineLevel: outlineLevel || undefined,\r\n                },\r\n            },\r\n            children,\r\n        };\r\n    },\r\n};\r\n\r\nexport default rowFactory;\r\n", "import { _errMsg } from 'ag-grid-community';\r\n\r\nimport { deflateLocalFile } from './compress';\r\nimport { convertDate, convertDecToHex, convertTime } from './convert';\r\nimport { getCrcFromCrc32Table } from './crcTable';\r\nimport type { ZipFile } from './zipContainer';\r\n\r\ninterface ZipFileHeader {\r\n    localFileHeader: Uint8Array;\r\n    centralDirectoryHeader: Uint8Array;\r\n}\r\n\r\nexport interface ProcessedZipFile extends ZipFileHeader {\r\n    content: Uint8Array;\r\n    isCompressed: boolean;\r\n}\r\n\r\n/**\r\n * It encodes any string in UTF-8 format\r\n * taken from https://github.com/mathiasbynens/utf8.js\r\n * @param {string} s\r\n * @returns {string}\r\n */\r\nfunction _utf8_encode(s: string | null): string {\r\n    const stringFromCharCode = String.fromCharCode;\r\n\r\n    function ucs2decode(string: string | null): number[] {\r\n        const output: number[] = [];\r\n\r\n        if (!string) {\r\n            return [];\r\n        }\r\n\r\n        const len = string.length;\r\n\r\n        let counter = 0;\r\n        let value;\r\n        let extra;\r\n\r\n        while (counter < len) {\r\n            value = string.charCodeAt(counter++);\r\n            if (value >= 0xd800 && value <= 0xdbff && counter < len) {\r\n                // high surrogate, and there is a next character\r\n                extra = string.charCodeAt(counter++);\r\n                if ((extra & 0xfc00) == 0xdc00) {\r\n                    // low surrogate\r\n                    output.push(((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000);\r\n                } else {\r\n                    // unmatched surrogate; only append this code unit, in case the next\r\n                    // code unit is the high surrogate of a surrogate pair\r\n                    output.push(value);\r\n                    counter--;\r\n                }\r\n            } else {\r\n                output.push(value);\r\n            }\r\n        }\r\n        return output;\r\n    }\r\n\r\n    function checkScalarValue(point: number) {\r\n        if (point >= 0xd800 && point <= 0xdfff) {\r\n            throw Error(_errMsg(255, { point }));\r\n        }\r\n    }\r\n\r\n    function createByte(point: number, shift: number) {\r\n        return stringFromCharCode(((point >> shift) & 0x3f) | 0x80);\r\n    }\r\n\r\n    function encodeCodePoint(point: number): string {\r\n        if ((point & 0xffffff80) == 0) {\r\n            // 1-byte sequence\r\n            return stringFromCharCode(point);\r\n        }\r\n\r\n        let symbol = '';\r\n\r\n        if ((point & 0xfffff800) == 0) {\r\n            // 2-byte sequence\r\n            symbol = stringFromCharCode(((point >> 6) & 0x1f) | 0xc0);\r\n        } else if ((point & 0xffff0000) == 0) {\r\n            // 3-byte sequence\r\n            checkScalarValue(point);\r\n            symbol = stringFromCharCode(((point >> 12) & 0x0f) | 0xe0);\r\n            symbol += createByte(point, 6);\r\n        } else if ((point & 0xffe00000) == 0) {\r\n            // 4-byte sequence\r\n            symbol = stringFromCharCode(((point >> 18) & 0x07) | 0xf0);\r\n            symbol += createByte(point, 12);\r\n            symbol += createByte(point, 6);\r\n        }\r\n        symbol += stringFromCharCode((point & 0x3f) | 0x80);\r\n        return symbol;\r\n    }\r\n\r\n    const codePoints = ucs2decode(s);\r\n    const length = codePoints.length;\r\n    let index = -1;\r\n    let codePoint;\r\n    let byteString = '';\r\n\r\n    while (++index < length) {\r\n        codePoint = codePoints[index];\r\n        byteString += encodeCodePoint(codePoint);\r\n    }\r\n\r\n    return byteString;\r\n}\r\n\r\nconst getHeaders = (\r\n    currentFile: ZipFile,\r\n    isCompressed: boolean,\r\n    offset: number,\r\n    rawSize: number,\r\n    rawContent: string | Uint8Array,\r\n    deflatedSize: number | undefined\r\n): ZipFileHeader => {\r\n    const { content, path, created: creationDate } = currentFile;\r\n\r\n    const time = convertTime(creationDate);\r\n    const dt = convertDate(creationDate);\r\n\r\n    const crcFlag = getCrcFromCrc32Table(rawContent);\r\n    const zipSize = deflatedSize !== undefined ? deflatedSize : rawSize;\r\n\r\n    const utfPath = _utf8_encode(path);\r\n    const isUTF8 = utfPath !== path;\r\n\r\n    let extraFields = '';\r\n    if (isUTF8) {\r\n        const uExtraFieldPath = convertDecToHex(1, 1) + convertDecToHex(getCrcFromCrc32Table(utfPath), 4) + utfPath;\r\n        extraFields = '\\x75\\x70' + convertDecToHex(uExtraFieldPath.length, 2) + uExtraFieldPath;\r\n    }\r\n\r\n    const commonHeader =\r\n        '\\x14\\x00' + // version needed to extract\r\n        (isUTF8 ? '\\x00\\x08' : '\\x00\\x00') + // Language encoding flag (EFS) (12th bit turned on)\r\n        convertDecToHex(isCompressed ? 8 : 0, 2) + // As per ECMA-376 Part 2 specs\r\n        convertDecToHex(time, 2) + // last modified time\r\n        convertDecToHex(dt, 2) + // last modified date\r\n        convertDecToHex(zipSize ? crcFlag : 0, 4) +\r\n        convertDecToHex(deflatedSize ?? rawSize, 4) + // compressed size\r\n        convertDecToHex(rawSize, 4) + // uncompressed size\r\n        convertDecToHex(utfPath.length, 2) + // file name length\r\n        convertDecToHex(extraFields.length, 2); // extra field length\r\n\r\n    const localFileHeader = 'PK\\x03\\x04' + commonHeader + utfPath + extraFields;\r\n    const centralDirectoryHeader =\r\n        'PK\\x01\\x02' + // central header\r\n        '\\x14\\x00' +\r\n        commonHeader + // file header\r\n        '\\x00\\x00' +\r\n        '\\x00\\x00' +\r\n        '\\x00\\x00' +\r\n        (content ? '\\x00\\x00\\x00\\x00' : '\\x10\\x00\\x00\\x00') + // external file attributes\r\n        convertDecToHex(offset, 4) + // relative offset of local header\r\n        utfPath + // file name\r\n        extraFields; // extra field\r\n\r\n    return {\r\n        localFileHeader: Uint8Array.from(localFileHeader, (c) => c.charCodeAt(0)),\r\n        centralDirectoryHeader: Uint8Array.from(centralDirectoryHeader, (c) => c.charCodeAt(0)),\r\n    };\r\n};\r\n\r\nconst getDecodedContent = (\r\n    content: string | Uint8Array\r\n): {\r\n    size: number;\r\n    content: Uint8Array;\r\n} => {\r\n    let contentToUse: Uint8Array;\r\n    // base64 content is passed as string\r\n    if (typeof content === 'string') {\r\n        const base64String = atob(content.split(';base64,')[1]);\r\n        contentToUse = Uint8Array.from(base64String, (c) => c.charCodeAt(0));\r\n    } else {\r\n        contentToUse = content;\r\n    }\r\n\r\n    return {\r\n        size: contentToUse.length,\r\n        content: contentToUse,\r\n    };\r\n};\r\n\r\nexport const getDeflatedHeaderAndContent = async (currentFile: ZipFile, offset: number): Promise<ProcessedZipFile> => {\r\n    const { content } = currentFile;\r\n\r\n    const { size, content: rawContent } = !content\r\n        ? { size: 0, content: Uint8Array.from([]) }\r\n        : getDecodedContent(content);\r\n\r\n    let deflatedContent: Uint8Array | undefined = undefined;\r\n    let deflatedSize: number | undefined = undefined;\r\n    let deflationPerformed = false;\r\n\r\n    const shouldDeflate = currentFile.type === 'file' && rawContent && size > 0;\r\n    if (shouldDeflate) {\r\n        const result = await deflateLocalFile(rawContent);\r\n        deflatedContent = result.content;\r\n        deflatedSize = result.size;\r\n        deflationPerformed = true;\r\n    }\r\n\r\n    const headers = getHeaders(currentFile, deflationPerformed, offset, size, rawContent, deflatedSize);\r\n\r\n    return {\r\n        ...headers,\r\n        content: deflatedContent || rawContent,\r\n        isCompressed: deflationPerformed,\r\n    };\r\n};\r\n\r\nexport const getHeaderAndContent = (currentFile: ZipFile, offset: number): ProcessedZipFile => {\r\n    const { content } = currentFile;\r\n\r\n    const { content: rawContent } = !content ? { content: Uint8Array.from([]) } : getDecodedContent(content);\r\n\r\n    const headers = getHeaders(currentFile, false, offset, rawContent.length, rawContent, undefined);\r\n\r\n    return {\r\n        ...headers,\r\n        content: rawContent,\r\n        isCompressed: false,\r\n    };\r\n};\r\n\r\nexport const buildCentralDirectoryEnd = (tLen: number, cLen: number, lLen: number): Uint8Array => {\r\n    const str =\r\n        'PK\\x05\\x06' + // central folder end\r\n        '\\x00\\x00' +\r\n        '\\x00\\x00' +\r\n        convertDecToHex(tLen, 2) + // total number of entries in the central folder\r\n        convertDecToHex(tLen, 2) + // total number of entries in the central folder\r\n        convertDecToHex(cLen, 4) + // size of the central folder\r\n        convertDecToHex(lLen, 4) + // central folder start offset\r\n        '\\x00\\x00';\r\n\r\n    return Uint8Array.from(str, (c) => c.charCodeAt(0));\r\n};\r\n", "const compressBlob = async (\r\n    data: Blob\r\n): Promise<{\r\n    size: number;\r\n    content: Blob;\r\n}> => {\r\n    // Callback to extract the compressed data\r\n    let chunksSize = 0;\r\n    const chunks: Uint8Array[] = [];\r\n    const writeCompressedData: WritableStream<Uint8Array> = new WritableStream({\r\n        write: (chunk: Uint8Array) => {\r\n            chunks.push(chunk);\r\n            chunksSize += chunk.length;\r\n        },\r\n    });\r\n\r\n    // Create readable stream from blob\r\n    const readable = new ReadableStream({\r\n        start: (controller) => {\r\n            const reader = new FileReader();\r\n            reader.onload = (e) => {\r\n                if (e.target?.result) {\r\n                    controller.enqueue(e.target.result);\r\n                }\r\n\r\n                controller.close();\r\n            };\r\n\r\n            reader.readAsArrayBuffer(data);\r\n        },\r\n    });\r\n\r\n    // Perform the compression using the browser's native CompressionStream API\r\n    // Ref https://developer.mozilla.org/en-US/docs/Web/API/CompressionStream for details\r\n    const compressStream = new (window as any).CompressionStream('deflate-raw');\r\n    await readable.pipeThrough(compressStream).pipeTo(writeCompressedData);\r\n\r\n    // Return the compressed data\r\n    return {\r\n        size: chunksSize,\r\n        content: new Blob(chunks),\r\n    };\r\n};\r\n\r\nexport const deflateLocalFile = async (\r\n    rawContent: string | Uint8Array\r\n): Promise<{\r\n    size: number;\r\n    content: Uint8Array;\r\n}> => {\r\n    const contentAsBlob = new Blob([rawContent]);\r\n    const { size: compressedSize, content: compressedContent } = await compressBlob(contentAsBlob);\r\n\r\n    const compressedContentAsUint8Array = new Uint8Array(await compressedContent.arrayBuffer());\r\n\r\n    return {\r\n        size: compressedSize,\r\n        content: compressedContentAsUint8Array,\r\n    };\r\n};\r\n", "export const convertTime = (date: Date): number => {\r\n    let time = date.getHours();\r\n    time <<= 6;\r\n    time = time | date.getMinutes();\r\n    time <<= 5;\r\n    time = time | (date.getSeconds() / 2);\r\n\r\n    return time;\r\n};\r\n\r\nexport const convertDate = (date: Date): number => {\r\n    let dt = date.getFullYear() - 1980;\r\n    dt <<= 4;\r\n    dt = dt | (date.getMonth() + 1);\r\n    dt <<= 5;\r\n    dt = dt | date.getDate();\r\n\r\n    return dt;\r\n};\r\n\r\nexport function convertDecToHex(number: number, bytes: number): string {\r\n    let hex = '';\r\n\r\n    for (let i = 0; i < bytes; i++) {\r\n        hex += String.fromCharCode(number & 0xff);\r\n        number >>>= 8;\r\n    }\r\n\r\n    return hex;\r\n}\r\n", "const getCrcFromCrc32TableAndByteArray = (content: Uint8Array): number => {\r\n    if (!content.length) {\r\n        return 0;\r\n    }\r\n\r\n    let crc = 0 ^ -1;\r\n\r\n    let j = 0;\r\n    let k = 0;\r\n    let l = 0;\r\n\r\n    for (let i = 0; i < content.length; i++) {\r\n        j = content[i];\r\n        k = (crc ^ j) & 0xff;\r\n        l = crcTable[k];\r\n        crc = (crc >>> 8) ^ l;\r\n    }\r\n\r\n    return crc ^ -1;\r\n};\r\n\r\nexport const getCrcFromCrc32Table = (content: string | Uint8Array): number => {\r\n    if (!content.length) {\r\n        return 0;\r\n    }\r\n\r\n    if (typeof content === 'string') {\r\n        return getCrcFromCrc32TableAndByteArray(new TextEncoder().encode(content));\r\n    }\r\n\r\n    return getCrcFromCrc32TableAndByteArray(content);\r\n};\r\n\r\n// Table for crc calculation from:\r\n// https://referencesource.microsoft.com/#System/sys/System/IO/compression/Crc32Helper.cs,3b31978c7d7f7246,references\r\nconst crcTable = /* #__PURE__ */ new Uint32Array([\r\n    0x00000000, 0x77073096, 0xee0e612c, 0x990951ba, 0x076dc419, 0x706af48f, 0xe963a535, 0x9e6495a3, 0x0edb8832,\r\n    0x79dcb8a4, 0xe0d5e91e, 0x97d2d988, 0x09b64c2b, 0x7eb17cbd, 0xe7b82d07, 0x90bf1d91, 0x1db71064, 0x6ab020f2,\r\n    0xf3b97148, 0x84be41de, 0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7, 0x136c9856, 0x646ba8c0, 0xfd62f97a,\r\n    0x8a65c9ec, 0x14015c4f, 0x63066cd9, 0xfa0f3d63, 0x8d080df5, 0x3b6e20c8, 0x4c69105e, 0xd56041e4, 0xa2677172,\r\n    0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b, 0x35b5a8fa, 0x42b2986c, 0xdbbbc9d6, 0xacbcf940, 0x32d86ce3,\r\n    0x45df5c75, 0xdcd60dcf, 0xabd13d59, 0x26d930ac, 0x51de003a, 0xc8d75180, 0xbfd06116, 0x21b4f4b5, 0x56b3c423,\r\n    0xcfba9599, 0xb8bda50f, 0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924, 0x2f6f7c87, 0x58684c11, 0xc1611dab,\r\n    0xb6662d3d, 0x76dc4190, 0x01db7106, 0x98d220bc, 0xefd5102a, 0x71b18589, 0x06b6b51f, 0x9fbfe4a5, 0xe8b8d433,\r\n    0x7807c9a2, 0x0f00f934, 0x9609a88e, 0xe10e9818, 0x7f6a0dbb, 0x086d3d2d, 0x91646c97, 0xe6635c01, 0x6b6b51f4,\r\n    0x1c6c6162, 0x856530d8, 0xf262004e, 0x6c0695ed, 0x1b01a57b, 0x8208f4c1, 0xf50fc457, 0x65b0d9c6, 0x12b7e950,\r\n    0x8bbeb8ea, 0xfcb9887c, 0x62dd1ddf, 0x15da2d49, 0x8cd37cf3, 0xfbd44c65, 0x4db26158, 0x3ab551ce, 0xa3bc0074,\r\n    0xd4bb30e2, 0x4adfa541, 0x3dd895d7, 0xa4d1c46d, 0xd3d6f4fb, 0x4369e96a, 0x346ed9fc, 0xad678846, 0xda60b8d0,\r\n    0x44042d73, 0x33031de5, 0xaa0a4c5f, 0xdd0d7cc9, 0x5005713c, 0x270241aa, 0xbe0b1010, 0xc90c2086, 0x5768b525,\r\n    0x206f85b3, 0xb966d409, 0xce61e49f, 0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4, 0x59b33d17, 0x2eb40d81,\r\n    0xb7bd5c3b, 0xc0ba6cad, 0xedb88320, 0x9abfb3b6, 0x03b6e20c, 0x74b1d29a, 0xead54739, 0x9dd277af, 0x04db2615,\r\n    0x73dc1683, 0xe3630b12, 0x94643b84, 0x0d6d6a3e, 0x7a6a5aa8, 0xe40ecf0b, 0x9309ff9d, 0x0a00ae27, 0x7d079eb1,\r\n    0xf00f9344, 0x8708a3d2, 0x1e01f268, 0x6906c2fe, 0xf762575d, 0x806567cb, 0x196c3671, 0x6e6b06e7, 0xfed41b76,\r\n    0x89d32be0, 0x10da7a5a, 0x67dd4acc, 0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5, 0xd6d6a3e8, 0xa1d1937e,\r\n    0x38d8c2c4, 0x4fdff252, 0xd1bb67f1, 0xa6bc5767, 0x3fb506dd, 0x48b2364b, 0xd80d2bda, 0xaf0a1b4c, 0x36034af6,\r\n    0x41047a60, 0xdf60efc3, 0xa867df55, 0x316e8eef, 0x4669be79, 0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236,\r\n    0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f, 0xc5ba3bbe, 0xb2bd0b28, 0x2bb45a92, 0x5cb36a04, 0xc2d7ffa7,\r\n    0xb5d0cf31, 0x2cd99e8b, 0x5bdeae1d, 0x9b64c2b0, 0xec63f226, 0x756aa39c, 0x026d930a, 0x9c0906a9, 0xeb0e363f,\r\n    0x72076785, 0x05005713, 0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0x0cb61b38, 0x92d28e9b, 0xe5d5be0d, 0x7cdcefb7,\r\n    0x0bdbdf21, 0x86d3d2d4, 0xf1d4e242, 0x68ddb3f8, 0x1fda836e, 0x81be16cd, 0xf6b9265b, 0x6fb077e1, 0x18b74777,\r\n    0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c, 0x8f659eff, 0xf862ae69, 0x616bffd3, 0x166ccf45, 0xa00ae278,\r\n    0xd70dd2ee, 0x4e048354, 0x3903b3c2, 0xa7672661, 0xd06016f7, 0x4969474d, 0x3e6e77db, 0xaed16a4a, 0xd9d65adc,\r\n    0x40df0b66, 0x37d83bf0, 0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9, 0xbdbdf21c, 0xcabac28a, 0x53b39330,\r\n    0x24b4a3a6, 0xbad03605, 0xcdd70693, 0x54de5729, 0x23d967bf, 0xb3667a2e, 0xc4614ab8, 0x5d681b02, 0x2a6f2b94,\r\n    0xb40bbe37, 0xc30c8ea1, 0x5a05df1b, 0x2d02ef8d,\r\n]);\r\n", "import type { ProcessedZipFile } from './zipContainerHelper';\r\nimport { buildCentralDirectoryEnd, getDeflatedHeaderAndContent, getHeaderAndContent } from './zipContainerHelper';\r\n\r\nexport interface ZipFile {\r\n    path: string;\r\n    created: Date;\r\n    isBase64: boolean;\r\n    type: 'file' | 'folder';\r\n    content?: string | Uint8Array;\r\n}\r\n\r\nexport class ZipContainer {\r\n    private folders: ZipFile[] = [];\r\n    private files: ZipFile[] = [];\r\n\r\n    public addFolders(paths: string[]): void {\r\n        paths.forEach(this.addFolder.bind(this));\r\n    }\r\n\r\n    private addFolder(path: string): void {\r\n        this.folders.push({\r\n            path,\r\n            created: new Date(),\r\n            isBase64: false,\r\n            type: 'folder',\r\n        });\r\n    }\r\n\r\n    public addFile(path: string, content: string, isBase64 = false): void {\r\n        this.files.push({\r\n            path,\r\n            created: new Date(),\r\n            content: isBase64 ? content : new TextEncoder().encode(content),\r\n            isBase64,\r\n            type: 'file',\r\n        });\r\n    }\r\n\r\n    public async getZipFile(mimeType: string = 'application/zip'): Promise<Blob> {\r\n        const textOutput = await this.buildCompressedFileStream();\r\n        this.clearStream();\r\n        return new Blob([textOutput], { type: mimeType });\r\n    }\r\n\r\n    public getUncompressedZipFile(mimeType: string = 'application/zip'): Blob {\r\n        const textOutput = this.buildFileStream();\r\n        this.clearStream();\r\n        return new Blob([textOutput], { type: mimeType });\r\n    }\r\n\r\n    private clearStream(): void {\r\n        this.folders = [];\r\n        this.files = [];\r\n    }\r\n\r\n    private packageFiles(files: ProcessedZipFile[]) {\r\n        let fileLen: number = 0;\r\n        let folderLen: number = 0;\r\n\r\n        for (const currentFile of files) {\r\n            const { localFileHeader, centralDirectoryHeader, content } = currentFile;\r\n            fileLen += localFileHeader.length + content.length;\r\n            folderLen += centralDirectoryHeader.length;\r\n        }\r\n\r\n        const fileData: Uint8Array = new Uint8Array(fileLen);\r\n        const folderData: Uint8Array = new Uint8Array(folderLen);\r\n\r\n        let fileOffset = 0;\r\n        let folderOffset = 0;\r\n        for (const currentFile of files) {\r\n            const { localFileHeader, centralDirectoryHeader, content } = currentFile;\r\n\r\n            // Append fileHeader to fData\r\n            fileData.set(localFileHeader, fileOffset);\r\n            fileOffset += localFileHeader.length;\r\n\r\n            // Append content to fData\r\n            fileData.set(content, fileOffset);\r\n            fileOffset += content.length;\r\n\r\n            // Append folder header to foData\r\n            folderData.set(centralDirectoryHeader, folderOffset);\r\n            folderOffset += centralDirectoryHeader.length;\r\n        }\r\n\r\n        const folderEnd = buildCentralDirectoryEnd(files.length, folderLen, fileLen);\r\n\r\n        // Append folder data and file data\r\n        const result = new Uint8Array(fileData.length + folderData.length + folderEnd.length);\r\n\r\n        result.set(fileData);\r\n        result.set(folderData, fileData.length);\r\n        result.set(folderEnd, fileData.length + folderData.length);\r\n\r\n        return result;\r\n    }\r\n\r\n    private async buildCompressedFileStream(): Promise<Uint8Array> {\r\n        const totalFiles: ZipFile[] = [...this.folders, ...this.files];\r\n        const readyFiles: ProcessedZipFile[] = [];\r\n        let lL = 0;\r\n\r\n        for (const currentFile of totalFiles) {\r\n            const output = await getDeflatedHeaderAndContent(currentFile, lL);\r\n            const { localFileHeader, content } = output;\r\n            readyFiles.push(output);\r\n            lL += localFileHeader.length + content.length;\r\n        }\r\n\r\n        return this.packageFiles(readyFiles);\r\n    }\r\n\r\n    private buildFileStream(): Uint8Array {\r\n        const totalFiles: ZipFile[] = [...this.folders, ...this.files];\r\n        const readyFiles: ProcessedZipFile[] = [];\r\n        let lL = 0;\r\n\r\n        for (const currentFile of totalFiles) {\r\n            const readyFile = getHeaderAndContent(currentFile, lL);\r\n            const { localFileHeader, content } = readyFile;\r\n            readyFiles.push(readyFile);\r\n            lL += localFileHeader.length + content.length;\r\n        }\r\n\r\n        return this.packageFiles(readyFiles);\r\n    }\r\n}\r\n", "import type { _AdvancedFilterGridApi, _ModuleWithApi } from 'ag-grid-community';\r\nimport { _FilterCoreModule, _FilterValueModule, _PopupModule, _SharedDragAndDropModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { advancedFilterCSS } from './advanced-filter.css-GENERATED';\r\nimport {\r\n    getAdvancedFilterModel,\r\n    hideAdvancedFilterBuilder,\r\n    setAdvancedFilterModel,\r\n    showAdvancedFilterBuilder,\r\n} from './advancedFilterApi';\r\nimport { AdvancedFilterExpressionService } from './advancedFilterExpressionService';\r\nimport { AdvancedFilterService } from './advancedFilterService';\r\n\r\n/**\r\n * @feature Filtering -> Advanced Filter\r\n * @gridOption enableAdvanced Filter\r\n */\r\nexport const AdvancedFilterModule: _ModuleWithApi<_AdvancedFilterGridApi> = {\r\n    moduleName: 'AdvancedFilter',\r\n    version: VERSION,\r\n    beans: [AdvancedFilterService, AdvancedFilterExpressionService],\r\n    icons: {\r\n        // Builder button in Advanced Filter\r\n        advancedFilterBuilder: 'group',\r\n        // drag handle used to pick up Advanced Filter Builder rows\r\n        advancedFilterBuilderDrag: 'grip',\r\n        // Advanced Filter Builder row validation error\r\n        advancedFilterBuilderInvalid: 'not-allowed',\r\n        // shown on Advanced Filter Builder rows to move them up\r\n        advancedFilterBuilderMoveUp: 'up',\r\n        // shown on Advanced Filter Builder rows to move them down\r\n        advancedFilterBuilderMoveDown: 'down',\r\n        // shown on Advanced Filter Builder rows to add new rows\r\n        advancedFilterBuilderAdd: 'plus',\r\n        // shown on Advanced Filter Builder rows to remove row\r\n        advancedFilterBuilderRemove: 'minus',\r\n        // shown on Advanced Filter Builder selection pills\r\n        advancedFilterBuilderSelectOpen: 'small-down',\r\n        // remove for rich select editor pills\r\n        richSelectRemove: 'cancel',\r\n    },\r\n    apiFunctions: {\r\n        getAdvancedFilterModel,\r\n        setAdvancedFilterModel,\r\n        showAdvancedFilterBuilder,\r\n        hideAdvancedFilterBuilder,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _FilterCoreModule, _SharedDragAndDropModule, _PopupModule, _FilterValueModule],\r\n    css: [advancedFilterCSS],\r\n};\r\n", "// DO NOT UPDATE MANUALLY: Generated from script during build time\r\nexport const VERSION = '33.0.1';\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\n\r\nimport { GridLicenseManager as LicenseManager } from './license/gridLicenseManager';\r\nimport { VERSION } from './version';\r\n\r\nexport { AgWatermark } from './license/watermark';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const EnterpriseCoreModule: _ModuleWithoutApi = {\r\n    moduleName: 'EnterpriseCore',\r\n    version: VERSION,\r\n    beans: [LicenseManager],\r\n    icons: {\r\n        // accordion open (filter tool panel group, charts group)\r\n        accordionOpen: 'tree-open',\r\n        // accordion closed (filter tool panel group, charts group)\r\n        accordionClosed: 'tree-closed',\r\n        // accordion indeterminate - shown when some children are expanded and\r\n        //     others are collapsed (filter tool panel group, charts group)\r\n        accordionIndeterminate: 'tree-indeterminate',\r\n        // dialog title bar\r\n        close: 'cross',\r\n        // X (remove) on column 'pill' after adding it to a drop zone list\r\n        cancel: 'cancel',\r\n        // button in chart regular size window title bar (click to maximise)\r\n        maximize: 'maximize',\r\n        // button in chart maximised window title bar (click to make regular size)\r\n        minimize: 'minimize',\r\n        // drag handle used to pick up draggable columns\r\n        columnDrag: 'grip',\r\n    },\r\n    dependsOn: [],\r\n};\r\n", "export const advancedFilterCSS = /*css*/ `.ag-advanced-filter-header{align-items:center;background-color:var(--ag-header-background-color);border-bottom:var(--ag-header-row-border);display:flex;padding-left:var(--ag-cell-horizontal-padding);padding-right:var(--ag-cell-horizontal-padding);position:relative}.ag-advanced-filter{align-items:center;display:flex;width:100%}.ag-advanced-filter-apply-button,.ag-advanced-filter-builder-button{line-height:normal;white-space:nowrap}:where(.ag-ltr) .ag-advanced-filter-apply-button,:where(.ag-ltr) .ag-advanced-filter-builder-button{margin-left:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-advanced-filter-apply-button,:where(.ag-rtl) .ag-advanced-filter-builder-button{margin-right:calc(var(--ag-spacing)*2)}.ag-advanced-filter-builder-button{align-items:center;background-color:unset;border:0;display:flex;font-size:var(--ag-font-size);font-weight:600;padding:var(--ag-spacing);&:where(:not(:disabled)){cursor:pointer;&:hover{background-color:var(--ag-row-hover-color)}}}:where(.ag-ltr) .ag-advanced-filter-builder-button-label{margin-left:var(--ag-spacing)}:where(.ag-rtl) .ag-advanced-filter-builder-button-label{margin-right:var(--ag-spacing)}.ag-advanced-filter-builder{display:flex;flex-direction:column;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%}.ag-advanced-filter-builder-list{flex:1;overflow:auto}.ag-advanced-filter-builder-button-panel{border-top:var(--ag-advanced-filter-builder-button-bar-border);display:flex;justify-content:flex-end;padding:var(--ag-widget-container-vertical-padding) var(--ag-widget-container-horizontal-padding)}:where(.ag-ltr) .ag-advanced-filter-builder-apply-button,:where(.ag-ltr) .ag-advanced-filter-builder-cancel-button{margin-left:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-advanced-filter-builder-apply-button,:where(.ag-rtl) .ag-advanced-filter-builder-cancel-button{margin-right:calc(var(--ag-spacing)*2)}.ag-advanced-filter-builder-item-wrapper{align-items:center;display:flex;flex:1 1 auto;justify-content:space-between;overflow:hidden}:where(.ag-ltr) .ag-advanced-filter-builder-item-wrapper{padding-left:calc(var(--ag-icon-size)/2);padding-right:var(--ag-icon-size)}:where(.ag-rtl) .ag-advanced-filter-builder-item-wrapper{padding-left:var(--ag-icon-size);padding-right:calc(var(--ag-icon-size)/2)}:where(.ag-virtual-list-viewport .ag-advanced-filter-builder-item-wrapper) .ag-tab-guard{position:absolute}.ag-advanced-filter-builder-item-tree-lines>*{width:var(--ag-advanced-filter-builder-indent-size)}.ag-advanced-filter-builder-item-tree-line-root{width:var(--ag-icon-size);&:before{height:50%;top:50%}}.ag-advanced-filter-builder-item-tree-line-horizontal,.ag-advanced-filter-builder-item-tree-line-vertical,.ag-advanced-filter-builder-item-tree-line-vertical-bottom,.ag-advanced-filter-builder-item-tree-line-vertical-top{align-items:center;display:flex;height:100%;position:relative;&:after,&:before{content:\"\";height:100%;position:absolute}}.ag-advanced-filter-builder-item-tree-line-horizontal:after{border-bottom:1px solid var(--ag-border-color);height:50%;top:0;width:calc(var(--ag-advanced-filter-builder-indent-size) - var(--ag-icon-size))}:where(.ag-ltr) .ag-advanced-filter-builder-item-tree-line-horizontal:after{left:calc(var(--ag-icon-size)/2)}:where(.ag-rtl) .ag-advanced-filter-builder-item-tree-line-horizontal:after{right:calc(var(--ag-icon-size)/2)}.ag-advanced-filter-builder-item-tree-line-vertical:before{top:0;width:calc(var(--ag-advanced-filter-builder-indent-size) - var(--ag-icon-size)/2)}:where(.ag-ltr) .ag-advanced-filter-builder-item-tree-line-vertical:before{border-left:1px solid var(--ag-border-color);left:calc(var(--ag-icon-size)/2)}:where(.ag-rtl) .ag-advanced-filter-builder-item-tree-line-vertical:before{border-right:1px solid var(--ag-border-color);right:calc(var(--ag-icon-size)/2)}.ag-advanced-filter-builder-item-tree-line-vertical-top:before{height:50%;top:0;width:calc(var(--ag-advanced-filter-builder-indent-size) - var(--ag-icon-size)/2)}:where(.ag-ltr) .ag-advanced-filter-builder-item-tree-line-vertical-top:before{border-left:1px solid var(--ag-border-color);left:calc(var(--ag-icon-size)/2)}:where(.ag-rtl) .ag-advanced-filter-builder-item-tree-line-vertical-top:before{border-right:1px solid var(--ag-border-color);right:calc(var(--ag-icon-size)/2)}.ag-advanced-filter-builder-item-tree-line-vertical-bottom:before{height:calc(50% - var(--ag-icon-size)*1.5/2);top:calc(50% + var(--ag-icon-size)*1.5/2);width:calc(var(--ag-icon-size)/2)}:where(.ag-ltr) .ag-advanced-filter-builder-item-tree-line-vertical-bottom:before{border-left:1px solid var(--ag-border-color);left:calc(var(--ag-icon-size)/2)}:where(.ag-rtl) .ag-advanced-filter-builder-item-tree-line-vertical-bottom:before{border-right:1px solid var(--ag-border-color);right:calc(var(--ag-icon-size)/2)}.ag-advanced-filter-builder-item-condition{padding-bottom:var(--ag-spacing);padding-top:var(--ag-spacing)}.ag-advanced-filter-builder-item,.ag-advanced-filter-builder-item-buttons,.ag-advanced-filter-builder-item-condition,.ag-advanced-filter-builder-item-tree-lines,.ag-advanced-filter-builder-pill,.ag-advanced-filter-builder-pill-wrapper{align-items:center;display:flex;height:100%}.ag-advanced-filter-builder-pill-wrapper{margin:0 var(--ag-spacing)}.ag-advanced-filter-builder-pill{border-radius:var(--ag-border-radius);min-height:calc(100% - var(--ag-spacing)*3);min-width:calc(var(--ag-spacing)*2);padding:var(--ag-spacing) calc(var(--ag-spacing)*2);position:relative}:where(.ag-advanced-filter-builder-pill){.ag-advanced-filter-builder-value-number{font-family:monospace;font-weight:700}.ag-advanced-filter-builder-value-empty{color:var(--ag-subtle-text-color)}}:where(.ag-ltr) :where(.ag-advanced-filter-builder-pill){.ag-picker-field-display{margin-right:var(--ag-spacing)}}:where(.ag-rtl) :where(.ag-advanced-filter-builder-pill){.ag-picker-field-display{margin-left:var(--ag-spacing)}}.ag-advanced-filter-builder-pill-display{font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ag-advanced-filter-builder-join-pill{background-color:var(--ag-advanced-filter-builder-join-pill-color);cursor:pointer}.ag-advanced-filter-builder-column-pill{background-color:var(--ag-advanced-filter-builder-column-pill-color);cursor:pointer}.ag-advanced-filter-builder-option-pill{background-color:var(--ag-advanced-filter-builder-option-pill-color);cursor:pointer}.ag-advanced-filter-builder-value-pill{background-color:var(--ag-advanced-filter-builder-value-pill-color);cursor:text;max-width:140px;:where(.ag-advanced-filter-builder-pill-display){display:block}}.ag-advanced-filter-builder-item-buttons>*{margin:0 calc(var(--ag-spacing)*.5)}.ag-advanced-filter-builder-item-button{color:var(--ag-subtle-text-color);cursor:pointer;position:relative}.ag-advanced-filter-builder-item-button,.ag-advanced-filter-builder-pill{&:focus-visible{box-shadow:var(--ag-focus-shadow)}}.ag-advanced-filter-builder-item-button-disabled{cursor:default;opacity:.5}.ag-advanced-filter-builder-virtual-list-container{top:var(--ag-spacing)}.ag-advanced-filter-builder-virtual-list-item{cursor:default;display:flex;height:var(--ag-list-item-height);&:hover{background-color:var(--ag-row-hover-color);:where(.ag-advanced-filter-builder-item-button){opacity:1}}}.ag-advanced-filter-builder-invalid{color:var(--ag-invalid-color);cursor:default;margin:0 var(--ag-spacing)}:where(.ag-advanced-filter-builder-validation) .ag-advanced-filter-builder-invalid,:where(.ag-advanced-filter-builder-virtual-list-item-highlight) .ag-advanced-filter-builder-item-button:focus-visible{opacity:1}`;\n", "import type { AdvancedFilterModel, BeanCollection } from 'ag-grid-community';\r\n\r\nexport function getAdvancedFilterModel(beans: BeanCollection): AdvancedFilterModel | null {\r\n    return beans.filterManager?.getAdvFilterModel() ?? null;\r\n}\r\n\r\nexport function setAdvancedFilterModel(beans: BeanCollection, advancedFilterModel: AdvancedFilterModel | null): void {\r\n    beans.filterManager?.setAdvFilterModel(advancedFilterModel);\r\n}\r\n\r\nexport function showAdvancedFilterBuilder(beans: BeanCollection): void {\r\n    beans.filterManager?.toggleAdvFilterBuilder(true, 'api');\r\n}\r\n\r\nexport function hideAdvancedFilterBuilder(beans: BeanCollection): void {\r\n    beans.filterManager?.toggleAdvFilterBuilder(false, 'api');\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BaseCellDataType,\r\n    BeanCollection,\r\n    ColumnAdvancedFilterModel,\r\n    ColumnModel,\r\n    ColumnNameService,\r\n    DataTypeService,\r\n    JoinAdvancedFilterModel,\r\n    NamedBean,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _exists, _parseDateTimeFromString, _serialiseDate, _toStringOrNull } from 'ag-grid-community';\r\n\r\nimport { ADVANCED_FILTER_LOCALE_TEXT } from './advancedFilterLocaleText';\r\nimport type { AutocompleteEntry, AutocompleteListParams } from './autocomplete/autocompleteParams';\r\nimport { COL_FILTER_EXPRESSION_END_CHAR, COL_FILTER_EXPRESSION_START_CHAR } from './colFilterExpressionParser';\r\nimport type {\r\n    DataTypeFilterExpressionOperators,\r\n    FilterExpressionEvaluatorParams,\r\n    FilterExpressionOperator,\r\n    FilterExpressionOperators,\r\n} from './filterExpressionOperators';\r\nimport {\r\n    BooleanFilterExpressionOperators,\r\n    ScalarFilterExpressionOperators,\r\n    TextFilterExpressionOperators,\r\n} from './filterExpressionOperators';\r\n\r\nexport class AdvancedFilterExpressionService extends BeanStub implements NamedBean {\r\n    beanName = 'advFilterExpSvc' as const;\r\n\r\n    private valueSvc: ValueService;\r\n    private colModel: ColumnModel;\r\n    private colNames: ColumnNameService;\r\n    private dataTypeSvc?: DataTypeService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.valueSvc = beans.valueSvc;\r\n        this.colModel = beans.colModel;\r\n        this.colNames = beans.colNames;\r\n        this.dataTypeSvc = beans.dataTypeSvc;\r\n    }\r\n\r\n    private columnNameToIdMap: { [columnNameUpperCase: string]: { colId: string; columnName: string } } = {};\r\n    private columnAutocompleteEntries: AutocompleteEntry[] | null = null;\r\n    private expressionOperators: FilterExpressionOperators;\r\n    private expressionJoinOperators: { AND: string; OR: string };\r\n    private expressionEvaluatorParams: { [colId: string]: FilterExpressionEvaluatorParams<any> } = {};\r\n\r\n    public postConstruct(): void {\r\n        this.expressionJoinOperators = this.generateExpressionJoinOperators();\r\n        this.expressionOperators = this.generateExpressionOperators();\r\n    }\r\n\r\n    public parseJoinOperator(model: JoinAdvancedFilterModel): string {\r\n        const { type } = model;\r\n        return this.expressionJoinOperators[type] ?? type;\r\n    }\r\n\r\n    public getColumnDisplayValue(model: ColumnAdvancedFilterModel): string | undefined {\r\n        const { colId } = model;\r\n        const columnEntries = this.getColumnAutocompleteEntries();\r\n        const columnEntry = columnEntries.find(({ key }) => key === colId);\r\n        let columnName;\r\n        if (columnEntry) {\r\n            columnName = columnEntry.displayValue!;\r\n            this.columnNameToIdMap[columnName.toLocaleUpperCase()] = { colId, columnName };\r\n        } else {\r\n            columnName = colId;\r\n        }\r\n        return columnName;\r\n    }\r\n\r\n    public getOperatorDisplayValue(model: ColumnAdvancedFilterModel): string | undefined {\r\n        return this.getExpressionOperator(model.filterType, model.type)?.displayValue ?? model.type;\r\n    }\r\n\r\n    public getOperandModelValue(\r\n        operand: string,\r\n        baseCellDataType: BaseCellDataType,\r\n        column: AgColumn\r\n    ): string | number | bigint | null {\r\n        switch (baseCellDataType) {\r\n            case 'number':\r\n                return _exists(operand) ? Number(operand) : null;\r\n            case 'bigint':\r\n                try {\r\n                    return _exists(operand) ? BigInt(operand) : null;\r\n                } catch {\r\n                    return null;\r\n                }\r\n            case 'date':\r\n                return _serialiseDate(this.valueSvc.parseValue(column, null, operand, undefined), false);\r\n            case 'dateString': {\r\n                // displayed string format may be different from data string format, so parse before converting to date\r\n                const parsedDateString = this.valueSvc.parseValue(column, null, operand, undefined);\r\n                return this.dataTypeSvc\r\n                    ? _serialiseDate(this.dataTypeSvc.getDateParserFunction(column)(parsedDateString) ?? null, false)\r\n                    : parsedDateString;\r\n            }\r\n        }\r\n        return operand;\r\n    }\r\n\r\n    public getOperandDisplayValue(model: ColumnAdvancedFilterModel, skipFormatting?: boolean): string {\r\n        const { colId, filter } = model as any;\r\n        const column = this.colModel.getColDefCol(colId);\r\n        let operand = '';\r\n        if (filter != null) {\r\n            let operand1: string | null | undefined;\r\n            switch (model.filterType) {\r\n                case 'number':\r\n                    operand1 = _toStringOrNull(filter) ?? '';\r\n                    break;\r\n                case 'bigint':\r\n                    operand1 = _toStringOrNull(filter) ?? '';\r\n                    break;\r\n                case 'date': {\r\n                    const dateValue = _parseDateTimeFromString(filter);\r\n                    operand1 = column ? this.valueSvc.formatValue(column, null, dateValue) : null;\r\n                    break;\r\n                }\r\n                case 'dateString': {\r\n                    let dateStringStringValue;\r\n                    if (this.dataTypeSvc) {\r\n                        // need to convert from ISO date string to Date to data string format to formatted string format\r\n                        const dateStringDateValue = _parseDateTimeFromString(filter);\r\n                        dateStringStringValue = column\r\n                            ? this.dataTypeSvc?.getDateFormatterFunction(column)(dateStringDateValue ?? undefined)\r\n                            : null;\r\n                    } else {\r\n                        dateStringStringValue = filter;\r\n                    }\r\n                    operand1 = column ? this.valueSvc.formatValue(column, null, dateStringStringValue) : null;\r\n                    break;\r\n                }\r\n            }\r\n            if (model.filterType !== 'number' && model.filterType !== 'bigint') {\r\n                operand1 = operand1 ?? _toStringOrNull(filter) ?? '';\r\n                if (!skipFormatting) {\r\n                    operand1 = `\"${operand1}\"`;\r\n                }\r\n            }\r\n            operand = skipFormatting ? operand1! : ` ${operand1}`;\r\n        }\r\n        return operand;\r\n    }\r\n\r\n    public parseColumnFilterModel(model: ColumnAdvancedFilterModel): string {\r\n        const columnName = this.getColumnDisplayValue(model) ?? '';\r\n        const operator = this.getOperatorDisplayValue(model) ?? '';\r\n        const operands = this.getOperandDisplayValue(model);\r\n        return `[${columnName}] ${operator}${operands}`;\r\n    }\r\n\r\n    public updateAutocompleteCache(updateEntry: AutocompleteEntry, type?: string): void {\r\n        if (type === 'column') {\r\n            const { key: colId, displayValue } = updateEntry;\r\n            this.columnNameToIdMap[updateEntry.displayValue!.toLocaleUpperCase()] = {\r\n                colId,\r\n                columnName: displayValue!,\r\n            };\r\n        }\r\n    }\r\n\r\n    public translate(key: keyof typeof ADVANCED_FILTER_LOCALE_TEXT, variableValues?: string[]): string {\r\n        let defaultValue = ADVANCED_FILTER_LOCALE_TEXT[key];\r\n        if (typeof defaultValue === 'function') {\r\n            defaultValue = defaultValue(variableValues!);\r\n        }\r\n        return this.getLocaleTextFunc()(key, defaultValue, variableValues);\r\n    }\r\n\r\n    public generateAutocompleteListParams(\r\n        entries: AutocompleteEntry[],\r\n        type: string,\r\n        searchString: string\r\n    ): AutocompleteListParams {\r\n        return {\r\n            enabled: true,\r\n            type,\r\n            searchString,\r\n            entries,\r\n        };\r\n    }\r\n\r\n    public getColumnAutocompleteEntries(): AutocompleteEntry[] {\r\n        if (this.columnAutocompleteEntries) {\r\n            return this.columnAutocompleteEntries;\r\n        }\r\n        const columns = this.colModel.getColDefCols() ?? [];\r\n        const entries: AutocompleteEntry[] = [];\r\n        const includeHiddenColumns = this.gos.get('includeHiddenColumnsInAdvancedFilter');\r\n        columns.forEach((column) => {\r\n            if (\r\n                column.getColDef().filter &&\r\n                (includeHiddenColumns || column.isVisible() || column.isRowGroupActive())\r\n            ) {\r\n                entries.push({\r\n                    key: column.getColId(),\r\n                    displayValue: this.colNames.getDisplayNameForColumn(column, 'advancedFilter')!,\r\n                });\r\n            }\r\n        });\r\n        entries.sort((a, b) => {\r\n            const aValue = a.displayValue ?? '';\r\n            const bValue = b.displayValue ?? '';\r\n            if (aValue < bValue) {\r\n                return -1;\r\n            } else if (bValue > aValue) {\r\n                return 1;\r\n            }\r\n            return 0;\r\n        });\r\n        return entries;\r\n    }\r\n\r\n    public getOperatorAutocompleteEntries(column: AgColumn, baseCellDataType: BaseCellDataType): AutocompleteEntry[] {\r\n        const activeOperators = this.getActiveOperators(column);\r\n        return this.getDataTypeExpressionOperator(baseCellDataType)!.getEntries(activeOperators);\r\n    }\r\n\r\n    public getJoinOperatorAutocompleteEntries(): AutocompleteEntry[] {\r\n        return Object.entries(this.expressionJoinOperators).map(([key, displayValue]) => ({ key, displayValue }));\r\n    }\r\n\r\n    public getDefaultAutocompleteListParams(searchString: string): AutocompleteListParams {\r\n        return this.generateAutocompleteListParams(this.getColumnAutocompleteEntries(), 'column', searchString);\r\n    }\r\n\r\n    public getDataTypeExpressionOperator(\r\n        baseCellDataType?: BaseCellDataType\r\n    ): DataTypeFilterExpressionOperators<any> | undefined {\r\n        return this.expressionOperators[baseCellDataType!];\r\n    }\r\n\r\n    public getExpressionOperator(\r\n        baseCellDataType?: BaseCellDataType,\r\n        operator?: string\r\n    ): FilterExpressionOperator<any> | undefined {\r\n        return this.getDataTypeExpressionOperator(baseCellDataType)?.operators?.[operator!];\r\n    }\r\n\r\n    public getExpressionJoinOperators(): { AND: string; OR: string } {\r\n        return this.expressionJoinOperators;\r\n    }\r\n\r\n    public getColId(columnName: string): { colId: string; columnName: string } | null {\r\n        const upperCaseColumnName = columnName.toLocaleUpperCase();\r\n        const cachedColId = this.columnNameToIdMap[upperCaseColumnName];\r\n        if (cachedColId) {\r\n            return cachedColId;\r\n        }\r\n\r\n        const columnAutocompleteEntries = this.getColumnAutocompleteEntries();\r\n        const colEntry = columnAutocompleteEntries.find(\r\n            ({ displayValue }) => displayValue!.toLocaleUpperCase() === upperCaseColumnName\r\n        );\r\n        if (colEntry) {\r\n            const { key: colId, displayValue } = colEntry;\r\n            const colValue = { colId, columnName: displayValue! };\r\n            // cache for faster lookup\r\n            this.columnNameToIdMap[upperCaseColumnName] = colValue;\r\n            return colValue;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public getExpressionEvaluatorParams<ConvertedTValue, TValue = ConvertedTValue>(\r\n        colId: string\r\n    ): FilterExpressionEvaluatorParams<ConvertedTValue, TValue> {\r\n        let params = this.expressionEvaluatorParams[colId];\r\n        if (params) {\r\n            return params;\r\n        }\r\n\r\n        const column = this.colModel.getColDefCol(colId);\r\n        if (!column) {\r\n            return { valueConverter: (v: any) => v };\r\n        }\r\n\r\n        const baseCellDataType = this.dataTypeSvc?.getBaseDataType(column);\r\n        switch (baseCellDataType) {\r\n            case 'dateString':\r\n                params = {\r\n                    valueConverter: this.dataTypeSvc?.getDateParserFunction(column) ?? ((v: any) => v),\r\n                };\r\n                break;\r\n            case 'object':\r\n                // If there's a filter value getter, assume the value is already a string. Otherwise we need to format it.\r\n                if (column.getColDef().filterValueGetter) {\r\n                    params = { valueConverter: (v: any) => v };\r\n                } else {\r\n                    params = {\r\n                        valueConverter: (value, node) =>\r\n                            this.valueSvc.formatValue(column, node, value) ??\r\n                            (typeof value.toString === 'function' ? value.toString() : ''),\r\n                    };\r\n                }\r\n                break;\r\n            case 'text':\r\n            case undefined:\r\n                params = { valueConverter: (v: any) => _toStringOrNull(v) };\r\n                break;\r\n            default:\r\n                params = { valueConverter: (v: any) => v };\r\n                break;\r\n        }\r\n        const { filterParams } = column.getColDef();\r\n        if (filterParams) {\r\n            ['caseSensitive', 'includeBlanksInEquals', 'includeBlanksInLessThan', 'includeBlanksInGreaterThan'].forEach(\r\n                (param: keyof FilterExpressionEvaluatorParams<ConvertedTValue, TValue>) => {\r\n                    const paramValue = filterParams[param];\r\n                    if (paramValue) {\r\n                        params[param] = paramValue;\r\n                    }\r\n                }\r\n            );\r\n        }\r\n        this.expressionEvaluatorParams[colId] = params;\r\n\r\n        return params;\r\n    }\r\n\r\n    public getColumnDetails(colId: string): { column?: AgColumn; baseCellDataType: BaseCellDataType } {\r\n        const column = this.colModel.getColDefCol(colId) ?? undefined;\r\n        const baseCellDataType = (column ? this.dataTypeSvc?.getBaseDataType(column) : undefined) ?? 'text';\r\n        return { column, baseCellDataType };\r\n    }\r\n\r\n    public generateExpressionOperators(): FilterExpressionOperators {\r\n        const translate = (key: keyof typeof ADVANCED_FILTER_LOCALE_TEXT, variableValues?: string[]) =>\r\n            this.translate(key, variableValues);\r\n        return {\r\n            text: new TextFilterExpressionOperators({ translate }),\r\n            boolean: new BooleanFilterExpressionOperators({ translate }),\r\n            object: new TextFilterExpressionOperators<any>({ translate }),\r\n            number: new ScalarFilterExpressionOperators<number>({ translate, equals: (v, o) => v === o }),\r\n            bigint: new ScalarFilterExpressionOperators<bigint>({ translate, equals: (v, o) => v === o }),\r\n            date: new ScalarFilterExpressionOperators<Date>({\r\n                translate,\r\n                equals: (v: Date, o: Date) => v.getTime() === o.getTime(),\r\n            }),\r\n            dateString: new ScalarFilterExpressionOperators<Date, string>({\r\n                translate,\r\n                equals: (v: Date, o: Date) => v.getTime() === o.getTime(),\r\n            }),\r\n        };\r\n    }\r\n\r\n    public getColumnValue({ displayValue }: AutocompleteEntry): string {\r\n        return `${COL_FILTER_EXPRESSION_START_CHAR}${displayValue}${COL_FILTER_EXPRESSION_END_CHAR}`;\r\n    }\r\n\r\n    private generateExpressionJoinOperators(): { AND: string; OR: string } {\r\n        return {\r\n            AND: this.translate('advancedFilterAnd'),\r\n            OR: this.translate('advancedFilterOr'),\r\n        };\r\n    }\r\n\r\n    private getActiveOperators(column: AgColumn): string[] | undefined {\r\n        const filterOptions = column.getColDef().filterParams?.filterOptions;\r\n        if (!filterOptions) {\r\n            return undefined;\r\n        }\r\n        const isValid = filterOptions.every((filterOption: any) => typeof filterOption === 'string');\r\n        return isValid ? filterOptions : undefined;\r\n    }\r\n\r\n    public resetColumnCaches(): void {\r\n        this.columnAutocompleteEntries = null;\r\n        this.columnNameToIdMap = {};\r\n        this.expressionEvaluatorParams = {};\r\n    }\r\n}\r\n", "export const ADVANCED_FILTER_LOCALE_TEXT = {\r\n    ariaAdvancedFilterBuilderItem: (variableValues: string[]) =>\r\n        `${variableValues[0]}. Level ${variableValues[1]}. Press ENTER to edit`,\r\n    ariaAdvancedFilterBuilderItemValidation: (variableValues: string[]) =>\r\n        `${variableValues[0]}. Level ${variableValues[1]}. ${variableValues[2]} Press ENTER to edit`,\r\n    ariaAdvancedFilterBuilderList: 'Advanced Filter Builder List',\r\n    ariaAdvancedFilterBuilderFilterItem: 'Filter Condition',\r\n    ariaAdvancedFilterBuilderGroupItem: 'Filter Group',\r\n    ariaAdvancedFilterBuilderColumn: 'Column',\r\n    ariaAdvancedFilterBuilderOption: 'Option',\r\n    ariaAdvancedFilterBuilderValue: 'Value',\r\n    ariaAdvancedFilterBuilderJoinOperator: 'Join Operator',\r\n\r\n    ariaAdvancedFilterInput: 'Advanced Filter Input',\r\n    ariaLabelAdvancedFilterAutocomplete: 'Advanced Filter Autocomplete',\r\n    advancedFilterContains: 'contains',\r\n    advancedFilterNotContains: 'does not contain',\r\n    advancedFilterTextEquals: 'equals',\r\n    advancedFilterTextNotEqual: 'does not equal',\r\n    advancedFilterStartsWith: 'begins with',\r\n    advancedFilterEndsWith: 'ends with',\r\n    advancedFilterBlank: 'is blank',\r\n    advancedFilterNotBlank: 'is not blank',\r\n    advancedFilterEquals: '=',\r\n    advancedFilterNotEqual: '!=',\r\n    advancedFilterGreaterThan: '>',\r\n    advancedFilterGreaterThanOrEqual: '>=',\r\n    advancedFilterLessThan: '<',\r\n    advancedFilterLessThanOrEqual: '<=',\r\n    advancedFilterTrue: 'is true',\r\n    advancedFilterFalse: 'is false',\r\n    advancedFilterAnd: 'AND',\r\n    advancedFilterOr: 'OR',\r\n    advancedFilterApply: 'Apply',\r\n    advancedFilterBuilder: 'Builder',\r\n    advancedFilterValidationMissingColumn: 'Column is missing',\r\n    advancedFilterValidationMissingOption: 'Option is missing',\r\n    advancedFilterValidationMissingValue: 'Value is missing',\r\n    advancedFilterValidationInvalidColumn: 'Column not found',\r\n    advancedFilterValidationInvalidOption: 'Option not found',\r\n    advancedFilterValidationMissingQuote: 'Value is missing an end quote',\r\n    advancedFilterValidationNotANumber: 'Value is not a number',\r\n    advancedFilterValidationInvalidDate: 'Value is not a valid date',\r\n    advancedFilterValidationMissingCondition: 'Condition is missing',\r\n    advancedFilterValidationJoinOperatorMismatch: 'Join operators within a condition must be the same',\r\n    advancedFilterValidationInvalidJoinOperator: 'Join operator not found',\r\n    advancedFilterValidationMissingEndBracket: 'Missing end bracket',\r\n    advancedFilterValidationExtraEndBracket: 'Too many end brackets',\r\n    advancedFilterValidationMessage: (variableValues: string[]) =>\r\n        `Expression has an error. ${variableValues[0]} - ${variableValues[1]}.`,\r\n    advancedFilterValidationMessageAtEnd: (variableValues: string[]) =>\r\n        `Expression has an error. ${variableValues[0]} at end of expression.`,\r\n    advancedFilterBuilderTitle: 'Advanced Filter',\r\n    advancedFilterBuilderApply: 'Apply',\r\n    advancedFilterBuilderCancel: 'Cancel',\r\n    advancedFilterBuilderAddButtonTooltip: 'Add Filter or Group',\r\n    advancedFilterBuilderRemoveButtonTooltip: 'Remove',\r\n    advancedFilterBuilderMoveUpButtonTooltip: 'Move Up',\r\n    advancedFilterBuilderMoveDownButtonTooltip: 'Move Down',\r\n    advancedFilterBuilderAddJoin: 'Add Group',\r\n    advancedFilterBuilderAddCondition: 'Add Filter',\r\n    advancedFilterBuilderSelectColumn: 'Select a column',\r\n    advancedFilterBuilderSelectOption: 'Select an option',\r\n    advancedFilterBuilderEnterValue: 'Enter a value...',\r\n    advancedFilterBuilderValidationAlreadyApplied: 'Current filter already applied.',\r\n    advancedFilterBuilderValidationIncomplete: 'Not all conditions are complete.',\r\n    advancedFilterBuilderValidationSelectColumn: 'Must select a column.',\r\n    advancedFilterBuilderValidationSelectOption: 'Must select an option.',\r\n    advancedFilterBuilderValidationEnterValue: 'Must enter a value.',\r\n};\r\n", "import type { ColumnModel, DataTypeService, IRowNode, ValueService } from 'ag-grid-community';\r\n\r\nimport type { AdvancedFilterExpressionService } from './advancedFilterExpressionService';\r\nimport type { FilterExpressionEvaluatorParams, FilterExpressionOperator } from './filterExpressionOperators';\r\n\r\nexport interface FilterExpressionParserParams {\r\n    expression: string;\r\n    colModel: ColumnModel;\r\n    dataTypeSvc?: DataTypeService;\r\n    valueSvc: ValueService;\r\n    advFilterExpSvc: AdvancedFilterExpressionService;\r\n}\r\n\r\nexport interface AutocompleteUpdate {\r\n    updatedValue: string;\r\n    updatedPosition: number;\r\n    hideAutocomplete?: boolean;\r\n}\r\n\r\nexport interface FilterExpressionValidationError {\r\n    message: string;\r\n    startPosition: number;\r\n    endPosition: number;\r\n}\r\n\r\nexport interface FilterExpressionFunctionParams {\r\n    operands: any[];\r\n    operators: FilterExpressionOperator<any>[];\r\n    evaluatorParams: FilterExpressionEvaluatorParams<any, any>[];\r\n}\r\n\r\nexport interface ExpressionProxy {\r\n    getValue<T = any>(colId: string, node: IRowNode): T;\r\n}\r\n\r\nexport type FilterExpressionFunction = (\r\n    expressionProxy: ExpressionProxy,\r\n    node: IRowNode,\r\n    params: FilterExpressionFunctionParams\r\n) => boolean;\r\n\r\nexport function getSearchString(value: string, position: number, endPosition: number): string {\r\n    if (!value) {\r\n        return '';\r\n    }\r\n    const numChars = endPosition - position;\r\n    return numChars ? value.slice(0, value.length - numChars) : value;\r\n}\r\n\r\nexport function updateExpression(\r\n    expression: string,\r\n    startPosition: number,\r\n    endPosition: number,\r\n    updatedValuePart: string,\r\n    appendSpace?: boolean,\r\n    appendQuote?: boolean,\r\n    empty?: boolean\r\n): AutocompleteUpdate {\r\n    const secondPartStartPosition = endPosition + (!expression.length || empty ? 0 : 1);\r\n    let positionOffset = 0;\r\n    if (appendSpace) {\r\n        if (expression[secondPartStartPosition] === ' ') {\r\n            // already a space, just move the position\r\n            positionOffset = 1;\r\n        } else {\r\n            updatedValuePart += ' ';\r\n            if (appendQuote) {\r\n                updatedValuePart += `\"`;\r\n            }\r\n        }\r\n    }\r\n    const updatedValue =\r\n        expression.slice(0, startPosition) + updatedValuePart + expression.slice(secondPartStartPosition);\r\n    return { updatedValue, updatedPosition: startPosition + updatedValuePart.length + positionOffset };\r\n}\r\n\r\nexport function findStartPosition(expression: string, position: number, endPosition: number) {\r\n    let startPosition = position;\r\n    while (startPosition < endPosition) {\r\n        const char = expression[startPosition];\r\n        if (char !== ' ') {\r\n            break;\r\n        }\r\n        startPosition++;\r\n    }\r\n    return startPosition;\r\n}\r\n\r\nexport function findEndPosition(\r\n    expression: string,\r\n    position: number,\r\n    includeCloseBracket?: boolean,\r\n    isStartPositionUnknown?: boolean\r\n): { endPosition: number; isEmpty: boolean } {\r\n    let endPosition = position;\r\n    let isEmpty = false;\r\n    while (endPosition < expression.length) {\r\n        const char = expression[endPosition];\r\n        if (char === '(') {\r\n            if (isStartPositionUnknown && expression[endPosition - 1] === ' ') {\r\n                isEmpty = true;\r\n            } else {\r\n                endPosition = endPosition - 1;\r\n            }\r\n            break;\r\n        } else if (char === ' ' || (includeCloseBracket && char === ')')) {\r\n            endPosition = endPosition - 1;\r\n            break;\r\n        }\r\n        endPosition++;\r\n    }\r\n    return { endPosition, isEmpty };\r\n}\r\n\r\nexport function checkAndUpdateExpression(\r\n    params: FilterExpressionParserParams,\r\n    userValue: string,\r\n    displayValue: string,\r\n    endPosition: number\r\n): void {\r\n    if (displayValue !== userValue) {\r\n        params.expression = updateExpression(\r\n            params.expression,\r\n            endPosition - userValue.length + 1,\r\n            endPosition,\r\n            displayValue\r\n        ).updatedValue;\r\n    }\r\n}\r\n\r\nexport function escapeQuotes(value: string): string {\r\n    return value.replace(/(['\"])/, '\\\\$1');\r\n}\r\n", "import type { AdvancedFilterModel, AgColumn, BaseCellDataType } from 'ag-grid-community';\r\n\r\nimport type { ADVANCED_FILTER_LOCALE_TEXT } from './advancedFilterLocaleText';\r\nimport type { AutocompleteEntry, AutocompleteListParams } from './autocomplete/autocompleteParams';\r\nimport type {\r\n    AutocompleteUpdate,\r\n    FilterExpressionFunction,\r\n    FilterExpressionFunctionParams,\r\n    FilterExpressionParserParams,\r\n    FilterExpressionValidationError,\r\n} from './filterExpressionUtils';\r\nimport {\r\n    checkAndUpdateExpression,\r\n    escapeQuotes,\r\n    findEndPosition,\r\n    findStartPosition,\r\n    getSearchString,\r\n    updateExpression,\r\n} from './filterExpressionUtils';\r\n\r\ninterface Parser {\r\n    type: string;\r\n    parse(char: string, position: number): boolean | undefined;\r\n    complete(position: number): void;\r\n    getValidationError(): FilterExpressionValidationError | null;\r\n}\r\n\r\nclass ColumnParser implements Parser {\r\n    public readonly type = 'column';\r\n\r\n    public valid = true;\r\n    public endPosition: number | undefined;\r\n    public baseCellDataType: BaseCellDataType;\r\n    public column: AgColumn | null | undefined;\r\n    public hasStartChar = false;\r\n    public hasEndChar = false;\r\n    private colName: string = '';\r\n    private colId: string;\r\n\r\n    constructor(\r\n        private params: FilterExpressionParserParams,\r\n        public readonly startPosition: number\r\n    ) {}\r\n\r\n    public parse(char: string, position: number): boolean | undefined {\r\n        if (char === COL_FILTER_EXPRESSION_START_CHAR && !this.colName) {\r\n            this.hasStartChar = true;\r\n        } else if (char === COL_FILTER_EXPRESSION_END_CHAR && this.hasStartChar) {\r\n            const isMatch = this.parseColumn(false, position);\r\n            if (isMatch) {\r\n                this.hasEndChar = true;\r\n                return false;\r\n            } else {\r\n                this.colName += char;\r\n            }\r\n        } else {\r\n            this.colName += char;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    public getDisplayValue(): string {\r\n        return (\r\n            (this.hasStartChar ? COL_FILTER_EXPRESSION_START_CHAR : '') +\r\n            this.colName +\r\n            (this.hasEndChar ? COL_FILTER_EXPRESSION_END_CHAR : '')\r\n        );\r\n    }\r\n\r\n    public getColId(): string {\r\n        return this.colId;\r\n    }\r\n\r\n    public complete(position: number): void {\r\n        this.parseColumn(true, position);\r\n    }\r\n\r\n    public getValidationError(): FilterExpressionValidationError | null {\r\n        return this.valid\r\n            ? null\r\n            : {\r\n                  message: this.params.advFilterExpSvc.translate('advancedFilterValidationInvalidColumn'),\r\n                  startPosition: this.startPosition,\r\n                  endPosition: this.endPosition ?? this.params.expression.length - 1,\r\n              };\r\n    }\r\n\r\n    private parseColumn(fromComplete: boolean, endPosition: number): boolean {\r\n        this.endPosition = endPosition;\r\n        const colValue = this.params.advFilterExpSvc.getColId(this.colName);\r\n        if (colValue && this.hasStartChar) {\r\n            this.colId = colValue.colId;\r\n            checkAndUpdateExpression(this.params, this.colName, colValue.columnName, endPosition - 1);\r\n            this.colName = colValue.columnName;\r\n            this.column = this.params.colModel.getColDefCol(this.colId);\r\n            if (this.column) {\r\n                this.baseCellDataType = this.params.dataTypeSvc?.getBaseDataType(this.column) ?? 'text';\r\n                return true;\r\n            }\r\n        }\r\n        if (fromComplete) {\r\n            this.valid = false;\r\n        }\r\n        this.baseCellDataType = 'text';\r\n        return false;\r\n    }\r\n}\r\n\r\nclass OperatorParser implements Parser {\r\n    public readonly type = 'operator';\r\n\r\n    public valid = true;\r\n    public endPosition: number | undefined;\r\n    public expectedNumOperands: number = 0;\r\n    private operator: string = '';\r\n    private parsedOperator: string;\r\n\r\n    constructor(\r\n        private params: FilterExpressionParserParams,\r\n        public readonly startPosition: number,\r\n        private readonly baseCellDataType: BaseCellDataType\r\n    ) {}\r\n\r\n    public parse(char: string, position: number): boolean | undefined {\r\n        if (char === ' ' || char === ')') {\r\n            const isMatch = this.parseOperator(false, position - 1);\r\n            if (isMatch) {\r\n                return true;\r\n            } else {\r\n                this.operator += char;\r\n            }\r\n        } else {\r\n            this.operator += char;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    public complete(position: number): void {\r\n        this.parseOperator(true, position);\r\n    }\r\n\r\n    public getValidationError(): FilterExpressionValidationError | null {\r\n        return this.valid\r\n            ? null\r\n            : {\r\n                  message: this.params.advFilterExpSvc.translate('advancedFilterValidationInvalidOption'),\r\n                  startPosition: this.startPosition,\r\n                  endPosition: this.endPosition ?? this.params.expression.length - 1,\r\n              };\r\n    }\r\n\r\n    public getDisplayValue(): string {\r\n        return this.operator;\r\n    }\r\n\r\n    public getOperatorKey(): string {\r\n        return this.parsedOperator;\r\n    }\r\n\r\n    private parseOperator(fromComplete: boolean, endPosition: number): boolean {\r\n        const operatorForType = this.params.advFilterExpSvc.getDataTypeExpressionOperator(this.baseCellDataType)!;\r\n        const parsedOperator = operatorForType.findOperator(this.operator);\r\n        this.endPosition = endPosition;\r\n        if (parsedOperator) {\r\n            this.parsedOperator = parsedOperator;\r\n            const operator = operatorForType.operators[parsedOperator];\r\n            this.expectedNumOperands = operator.numOperands;\r\n            const operatorDisplayValue = operator.displayValue;\r\n            checkAndUpdateExpression(this.params, this.operator, operatorDisplayValue, endPosition);\r\n            this.operator = operatorDisplayValue;\r\n            return true;\r\n        }\r\n        const isPartialMatch = parsedOperator === null;\r\n        if (fromComplete || !isPartialMatch) {\r\n            this.valid = false;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\nclass OperandParser implements Parser {\r\n    public readonly type = 'operand';\r\n\r\n    public valid = true;\r\n    public endPosition: number | undefined;\r\n    private quotes: `'` | `\"` | undefined;\r\n    private operand = '';\r\n    private modelValue: bigint | number | string;\r\n    private validationMessage: string | null = null;\r\n\r\n    constructor(\r\n        private params: FilterExpressionParserParams,\r\n        public readonly startPosition: number,\r\n        private readonly baseCellDataType: BaseCellDataType,\r\n        private readonly column: AgColumn | null | undefined\r\n    ) {}\r\n\r\n    public parse(char: string, position: number): boolean | undefined {\r\n        if (char === ' ') {\r\n            if (this.quotes) {\r\n                this.operand += char;\r\n            } else {\r\n                this.parseOperand(false, position);\r\n                return true;\r\n            }\r\n        } else if (char === ')') {\r\n            if (this.baseCellDataType === 'number' || this.baseCellDataType === 'bigint' || !this.quotes) {\r\n                this.parseOperand(false, position - 1);\r\n                return true;\r\n            } else {\r\n                this.operand += char;\r\n            }\r\n        } else if (!this.operand && !this.quotes && (char === `'` || char === `\"`)) {\r\n            this.quotes = char;\r\n        } else if (this.quotes && char === this.quotes) {\r\n            this.parseOperand(false, position);\r\n            return false;\r\n        } else {\r\n            this.operand += char;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    public complete(position: number): void {\r\n        this.parseOperand(true, position);\r\n    }\r\n\r\n    public getValidationError(): FilterExpressionValidationError | null {\r\n        return this.validationMessage\r\n            ? {\r\n                  message: this.validationMessage,\r\n                  startPosition: this.startPosition,\r\n                  endPosition: this.endPosition ?? this.params.expression.length - 1,\r\n              }\r\n            : null;\r\n    }\r\n\r\n    public getRawValue(): string {\r\n        return this.operand;\r\n    }\r\n\r\n    public getModelValue(): string | number | bigint {\r\n        return this.modelValue;\r\n    }\r\n\r\n    private parseOperand(fromComplete: boolean, position: number): void {\r\n        const { advFilterExpSvc } = this.params;\r\n        this.endPosition = position;\r\n        this.modelValue = this.operand;\r\n        if (fromComplete && this.quotes) {\r\n            // missing end quote\r\n            this.valid = false;\r\n            this.validationMessage = advFilterExpSvc.translate('advancedFilterValidationMissingQuote');\r\n        } else if (this.modelValue === '') {\r\n            this.valid = false;\r\n            this.validationMessage = advFilterExpSvc.translate('advancedFilterValidationMissingValue');\r\n        } else {\r\n            const modelValue = advFilterExpSvc.getOperandModelValue(this.operand, this.baseCellDataType, this.column!);\r\n            if (modelValue != null) {\r\n                this.modelValue = modelValue;\r\n            }\r\n            switch (this.baseCellDataType) {\r\n                case 'number':\r\n                    if (this.quotes || isNaN(this.modelValue as number)) {\r\n                        this.valid = false;\r\n                        this.validationMessage = advFilterExpSvc.translate('advancedFilterValidationNotANumber');\r\n                    }\r\n                    break;\r\n                case 'bigint':\r\n                    if (this.quotes || isNaN(Number(this.modelValue))) {\r\n                        this.valid = false;\r\n                        this.validationMessage = advFilterExpSvc.translate('advancedFilterValidationNotANumber');\r\n                    }\r\n                    break;\r\n                case 'date':\r\n                case 'dateString':\r\n                    if (modelValue == null) {\r\n                        this.valid = false;\r\n                        this.validationMessage = advFilterExpSvc.translate('advancedFilterValidationInvalidDate');\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport const COL_FILTER_EXPRESSION_START_CHAR = '[';\r\nexport const COL_FILTER_EXPRESSION_END_CHAR = ']';\r\n\r\nexport class ColFilterExpressionParser {\r\n    private endPosition: number | undefined;\r\n    private isAwaiting = true;\r\n    private parser: Parser | undefined;\r\n    private columnParser: ColumnParser | undefined;\r\n    private operatorParser: OperatorParser | undefined;\r\n    private operandParser: OperandParser | undefined;\r\n\r\n    constructor(\r\n        private params: FilterExpressionParserParams,\r\n        public readonly startPosition: number\r\n    ) {}\r\n\r\n    public parseExpression(): number {\r\n        let i = this.startPosition;\r\n        const { expression } = this.params;\r\n        while (i < expression.length) {\r\n            const char = expression[i];\r\n            if (char === ' ' && this.isAwaiting) {\r\n                // ignore duplicate spaces\r\n            } else {\r\n                this.isAwaiting = false;\r\n                if (!this.parser) {\r\n                    let parser: Parser;\r\n                    if (!this.columnParser) {\r\n                        this.columnParser = new ColumnParser(this.params, i);\r\n                        parser = this.columnParser;\r\n                    } else if (!this.operatorParser) {\r\n                        this.operatorParser = new OperatorParser(this.params, i, this.columnParser!.baseCellDataType);\r\n                        parser = this.operatorParser;\r\n                    } else {\r\n                        this.operandParser = new OperandParser(\r\n                            this.params,\r\n                            i,\r\n                            this.columnParser!.baseCellDataType,\r\n                            this.columnParser!.column\r\n                        );\r\n                        parser = this.operandParser;\r\n                    }\r\n                    this.parser = parser;\r\n                }\r\n                const hasCompletedOnPrevChar = this.parser.parse(char, i);\r\n                if (hasCompletedOnPrevChar != null) {\r\n                    if (this.isComplete()) {\r\n                        return this.returnEndPosition(hasCompletedOnPrevChar ? i - 1 : i, true);\r\n                    }\r\n                    this.parser = undefined;\r\n                    this.isAwaiting = true;\r\n                }\r\n            }\r\n            i++;\r\n        }\r\n        this.parser?.complete?.(i - 1);\r\n        return this.returnEndPosition(i);\r\n    }\r\n\r\n    public isValid(): boolean {\r\n        return (\r\n            this.isComplete() &&\r\n            this.columnParser!.valid &&\r\n            this.operatorParser!.valid &&\r\n            (!this.operandParser || this.operandParser!.valid)\r\n        );\r\n    }\r\n\r\n    public getValidationError(): FilterExpressionValidationError | null {\r\n        const validationError =\r\n            this.columnParser?.getValidationError() ??\r\n            this.operatorParser?.getValidationError() ??\r\n            this.operandParser?.getValidationError();\r\n        if (validationError) {\r\n            return validationError;\r\n        }\r\n        const endPosition = this.params.expression.length;\r\n        let translateKey: keyof typeof ADVANCED_FILTER_LOCALE_TEXT | undefined;\r\n        if (!this.columnParser) {\r\n            translateKey = 'advancedFilterValidationMissingColumn';\r\n        } else if (!this.operatorParser) {\r\n            translateKey = 'advancedFilterValidationMissingOption';\r\n        } else if (this.operatorParser.expectedNumOperands && !this.operandParser) {\r\n            translateKey = 'advancedFilterValidationMissingValue';\r\n        }\r\n        if (translateKey) {\r\n            return {\r\n                message: this.params.advFilterExpSvc.translate(translateKey),\r\n                startPosition: endPosition,\r\n                endPosition,\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public getFunctionString(params: FilterExpressionFunctionParams): string {\r\n        return this.getFunctionCommon(params, (operandIndex, operatorIndex, colId, evaluatorParamsIndex) => {\r\n            const escapedColId = escapeQuotes(colId);\r\n            const operand = operandIndex == null ? '' : `, params.operands[${operandIndex}]`;\r\n            return `params.operators[${operatorIndex}].evaluator(expressionProxy.getValue('${escapedColId}', node), node, params.evaluatorParams[${evaluatorParamsIndex}]${operand})`;\r\n        });\r\n    }\r\n\r\n    public getFunctionParsed(params: FilterExpressionFunctionParams): FilterExpressionFunction {\r\n        return this.getFunctionCommon(params, (operandIndex, operatorIndex, colId, evaluatorParamsIndex) => {\r\n            return (expressionProxy, node, p) =>\r\n                p.operators[operatorIndex].evaluator(\r\n                    expressionProxy.getValue(colId, node),\r\n                    node,\r\n                    p.evaluatorParams[evaluatorParamsIndex],\r\n                    operandIndex == null ? undefined : p.operands[operandIndex]\r\n                );\r\n        });\r\n    }\r\n\r\n    public getAutocompleteListParams(position: number): AutocompleteListParams | undefined {\r\n        if (this.isColumnPosition(position)) {\r\n            return this.getColumnAutocompleteListParams(position);\r\n        }\r\n        if (this.isOperatorPosition(position)) {\r\n            return this.getOperatorAutocompleteListParams(position);\r\n        }\r\n        if (this.isBeyondEndPosition(position)) {\r\n            return undefined;\r\n        }\r\n        return { enabled: false };\r\n    }\r\n\r\n    public updateExpression(\r\n        position: number,\r\n        updateEntry: AutocompleteEntry,\r\n        type?: string\r\n    ): AutocompleteUpdate | null {\r\n        const { expression } = this.params;\r\n        if (this.isColumnPosition(position)) {\r\n            return updateExpression(\r\n                this.params.expression,\r\n                this.startPosition,\r\n                this.columnParser?.getColId()\r\n                    ? this.columnParser!.endPosition!\r\n                    : findEndPosition(expression, position).endPosition,\r\n                this.params.advFilterExpSvc.getColumnValue(updateEntry),\r\n                true\r\n            );\r\n        } else if (this.isOperatorPosition(position)) {\r\n            const baseCellDataType = this.getBaseCellDataTypeFromOperatorAutocompleteType(type);\r\n            const hasOperand = this.hasOperand(baseCellDataType, updateEntry.key);\r\n            const doesOperandNeedQuotes = hasOperand && this.doesOperandNeedQuotes(baseCellDataType);\r\n            let update: AutocompleteUpdate;\r\n            if (this.operatorParser?.startPosition != null && position < this.operatorParser.startPosition) {\r\n                // in between multiple spaces, just insert direct\r\n                update = updateExpression(\r\n                    expression,\r\n                    position,\r\n                    position,\r\n                    updateEntry.displayValue ?? updateEntry.key,\r\n                    hasOperand,\r\n                    doesOperandNeedQuotes\r\n                );\r\n            } else {\r\n                let endPosition: number;\r\n                let empty = false;\r\n                if (this.operatorParser?.getOperatorKey()) {\r\n                    endPosition = this.operatorParser!.endPosition!;\r\n                } else {\r\n                    const { endPosition: calculatedEndPosition, isEmpty } = findEndPosition(\r\n                        expression,\r\n                        position,\r\n                        true,\r\n                        true\r\n                    );\r\n                    endPosition = calculatedEndPosition;\r\n                    empty = isEmpty;\r\n                }\r\n                update = updateExpression(\r\n                    expression,\r\n                    findStartPosition(expression, this.columnParser!.endPosition! + 1, endPosition),\r\n                    endPosition,\r\n                    updateEntry.displayValue ?? updateEntry.key,\r\n                    hasOperand,\r\n                    doesOperandNeedQuotes,\r\n                    empty\r\n                );\r\n            }\r\n            return { ...update, hideAutocomplete: !hasOperand };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public getModel(): AdvancedFilterModel {\r\n        const colId = this.columnParser!.getColId();\r\n        const model = {\r\n            filterType: this.columnParser!.baseCellDataType,\r\n            colId,\r\n            type: this.operatorParser!.getOperatorKey(),\r\n        };\r\n        if (this.operatorParser!.expectedNumOperands) {\r\n            (model as any).filter = this.operandParser!.getModelValue();\r\n        }\r\n        return model as AdvancedFilterModel;\r\n    }\r\n\r\n    private getFunctionCommon<T>(\r\n        params: FilterExpressionFunctionParams,\r\n        processFunc: (\r\n            operandIndex: number | undefined,\r\n            operatorIndex: number,\r\n            colId: string,\r\n            evaluatorParamsIndex: number\r\n        ) => T\r\n    ) {\r\n        const colId = this.columnParser!.getColId();\r\n        const operator = this.operatorParser?.getOperatorKey();\r\n        const { operators, evaluatorParams, operands } = params;\r\n        const operatorForColumn = this.params.advFilterExpSvc.getExpressionOperator(\r\n            this.columnParser!.baseCellDataType,\r\n            operator\r\n        );\r\n        const operatorIndex = this.addToListAndGetIndex(operators, operatorForColumn);\r\n        const evaluatorParamsForColumn = this.params.advFilterExpSvc.getExpressionEvaluatorParams(colId);\r\n        const evaluatorParamsIndex = this.addToListAndGetIndex(evaluatorParams, evaluatorParamsForColumn);\r\n        const operandIndex =\r\n            this.operatorParser?.expectedNumOperands === 0\r\n                ? undefined\r\n                : this.addToListAndGetIndex(operands, this.getOperandValue());\r\n        return processFunc(operandIndex, operatorIndex, colId, evaluatorParamsIndex);\r\n    }\r\n\r\n    private getOperandValue(): any {\r\n        let operand: any = this.operandParser!.getRawValue();\r\n        const { baseCellDataType, column } = this.columnParser!;\r\n        switch (baseCellDataType) {\r\n            case 'number':\r\n                operand = Number(operand);\r\n                break;\r\n            case 'bigint':\r\n                try {\r\n                    operand = BigInt(operand);\r\n                } catch {\r\n                    operand = null;\r\n                }\r\n                break;\r\n            case 'date':\r\n            case 'dateString':\r\n                operand = this.params.valueSvc.parseValue(column!, null, operand, undefined);\r\n                break;\r\n        }\r\n        if (baseCellDataType === 'dateString') {\r\n            const { dataTypeSvc } = this.params;\r\n            return dataTypeSvc ? dataTypeSvc.getDateParserFunction(column)(operand as string) : operand;\r\n        }\r\n        return operand;\r\n    }\r\n\r\n    private isComplete(): boolean {\r\n        return !!(\r\n            this.operatorParser &&\r\n            (!this.operatorParser.expectedNumOperands ||\r\n                (this.operatorParser.expectedNumOperands && this.operandParser))\r\n        );\r\n    }\r\n\r\n    private isColumnPosition(position: number): boolean {\r\n        return (\r\n            !this.columnParser || this.columnParser.endPosition == null || position <= this.columnParser.endPosition + 1\r\n        );\r\n    }\r\n\r\n    private isOperatorPosition(position: number): boolean {\r\n        return (\r\n            !this.operatorParser ||\r\n            this.operatorParser.endPosition == null ||\r\n            position <= this.operatorParser.endPosition + 1\r\n        );\r\n    }\r\n\r\n    private isBeyondEndPosition(position: number): boolean {\r\n        return (\r\n            this.isComplete() &&\r\n            this.endPosition != null &&\r\n            position > this.endPosition + 1 &&\r\n            this.endPosition + 1 < this.params.expression.length\r\n        );\r\n    }\r\n\r\n    private returnEndPosition(returnPosition: number, treatAsEnd?: boolean): number {\r\n        this.endPosition = treatAsEnd ? returnPosition : returnPosition - 1;\r\n        return returnPosition;\r\n    }\r\n\r\n    private getColumnAutocompleteListParams(position: number): AutocompleteListParams {\r\n        return this.params.advFilterExpSvc.generateAutocompleteListParams(\r\n            this.params.advFilterExpSvc.getColumnAutocompleteEntries(),\r\n            'column',\r\n            this.getColumnSearchString(position)\r\n        );\r\n    }\r\n\r\n    private getColumnSearchString(position: number): string {\r\n        const columnName = this.columnParser?.getDisplayValue() ?? '';\r\n        const searchString = getSearchString(\r\n            columnName,\r\n            position,\r\n            this.columnParser?.endPosition == null ? this.params.expression.length : this.columnParser.endPosition + 1\r\n        );\r\n        const containsStartChar = this.columnParser?.hasStartChar && searchString.length > 0;\r\n        const containsEndChar = this.columnParser?.hasEndChar && searchString.length === columnName.length + 2;\r\n        if (containsStartChar) {\r\n            return searchString.slice(1, containsEndChar ? -1 : undefined);\r\n        }\r\n        return searchString;\r\n    }\r\n\r\n    private getOperatorAutocompleteListParams(position: number): AutocompleteListParams {\r\n        const column = this.columnParser?.column;\r\n        if (!column) {\r\n            return { enabled: false };\r\n        }\r\n\r\n        const baseCellDataType = this.columnParser!.baseCellDataType;\r\n        const searchString =\r\n            this.operatorParser?.startPosition != null && position < this.operatorParser.startPosition\r\n                ? ''\r\n                : getSearchString(\r\n                      this.operatorParser?.getDisplayValue() ?? '',\r\n                      position,\r\n                      this.operatorParser?.endPosition == null\r\n                          ? this.params.expression.length\r\n                          : this.operatorParser.endPosition + 1\r\n                  );\r\n        return this.params.advFilterExpSvc.generateAutocompleteListParams(\r\n            this.params.advFilterExpSvc.getOperatorAutocompleteEntries(column, baseCellDataType),\r\n            `operator-${baseCellDataType}`,\r\n            searchString\r\n        );\r\n    }\r\n\r\n    private getBaseCellDataTypeFromOperatorAutocompleteType(type?: string): BaseCellDataType | undefined {\r\n        return type?.replace('operator-', '') as BaseCellDataType;\r\n    }\r\n\r\n    private hasOperand(baseCellDataType?: BaseCellDataType, operator?: string): boolean {\r\n        return (\r\n            !baseCellDataType ||\r\n            !operator ||\r\n            (this.params.advFilterExpSvc.getExpressionOperator(baseCellDataType, operator)?.numOperands ?? 0) > 0\r\n        );\r\n    }\r\n\r\n    private doesOperandNeedQuotes(baseCellDataType?: BaseCellDataType): boolean {\r\n        return baseCellDataType !== 'number' && baseCellDataType !== 'bigint';\r\n    }\r\n\r\n    private addToListAndGetIndex<T>(list: T[], value: T): number {\r\n        const index = list.length;\r\n        list.push(value);\r\n        return index;\r\n    }\r\n}\r\n", "import type { IRowNode } from 'ag-grid-community';\r\n\r\nimport type { ADVANCED_FILTER_LOCALE_TEXT } from './advancedFilterLocaleText';\r\nimport type { AutocompleteEntry } from './autocomplete/autocompleteParams';\r\n\r\nexport interface FilterExpressionEvaluatorParams<ConvertedTValue, TValue = ConvertedTValue> {\r\n    caseSensitive?: boolean;\r\n    includeBlanksInEquals?: boolean;\r\n    includeBlanksInLessThan?: boolean;\r\n    includeBlanksInGreaterThan?: boolean;\r\n    valueConverter: (value: TValue, node: IRowNode) => ConvertedTValue;\r\n}\r\n\r\nexport type FilterExpressionEvaluator<ConvertedTValue, TValue = ConvertedTValue> = (\r\n    value: TValue | null | undefined,\r\n    node: IRowNode,\r\n    params: FilterExpressionEvaluatorParams<ConvertedTValue, TValue>,\r\n    operand1?: ConvertedTValue,\r\n    operand2?: ConvertedTValue\r\n) => boolean;\r\n\r\nexport interface FilterExpressionOperator<ConvertedTValue, TValue = ConvertedTValue> {\r\n    displayValue: string;\r\n    evaluator: FilterExpressionEvaluator<ConvertedTValue, TValue>;\r\n    numOperands: number;\r\n}\r\n\r\nexport interface DataTypeFilterExpressionOperators<ConvertedTValue, TValue = ConvertedTValue> {\r\n    operators: {\r\n        [operator: string]: FilterExpressionOperator<ConvertedTValue, TValue>;\r\n    };\r\n    getEntries(activeOperators?: string[]): AutocompleteEntry[];\r\n    findOperator(displayValue: string): string | null | undefined;\r\n}\r\n\r\nexport interface FilterExpressionOperators {\r\n    text: DataTypeFilterExpressionOperators<string>;\r\n    number: DataTypeFilterExpressionOperators<number>;\r\n    bigint: DataTypeFilterExpressionOperators<bigint>;\r\n    boolean: DataTypeFilterExpressionOperators<boolean>;\r\n    date: DataTypeFilterExpressionOperators<Date>;\r\n    dateString: DataTypeFilterExpressionOperators<Date, string>;\r\n    object: DataTypeFilterExpressionOperators<string, any>;\r\n}\r\n\r\n// null = partial match, undefined = no match\r\nexport function findMatch<T>(\r\n    searchValue: string,\r\n    values: { [key: string]: T },\r\n    getDisplayValue: (value: T) => string\r\n): string | null | undefined {\r\n    let partialMatch = false;\r\n    const searchValueLowerCase = searchValue.toLocaleLowerCase();\r\n    const partialSearchValue = searchValueLowerCase + ' ';\r\n    const parsedValue = Object.entries(values).find(([, value]) => {\r\n        const displayValueLowerCase = getDisplayValue(value).toLocaleLowerCase();\r\n        if (displayValueLowerCase.startsWith(partialSearchValue)) {\r\n            partialMatch = true;\r\n        }\r\n        return displayValueLowerCase === searchValueLowerCase;\r\n    });\r\n    if (parsedValue) {\r\n        return parsedValue[0];\r\n    } else if (partialMatch) {\r\n        return null;\r\n    } else {\r\n        return undefined;\r\n    }\r\n}\r\n\r\nfunction getEntries<ConvertedTValue, TValue = ConvertedTValue>(\r\n    operators: { [operator: string]: FilterExpressionOperator<ConvertedTValue, TValue> },\r\n    activeOperatorKeys?: string[]\r\n): AutocompleteEntry[] {\r\n    const keys = activeOperatorKeys ?? Object.keys(operators);\r\n    return keys.map((key) => ({\r\n        key,\r\n        displayValue: operators[key].displayValue,\r\n    }));\r\n}\r\n\r\nexport interface FilterExpressionOperatorsParams {\r\n    translate: (key: keyof typeof ADVANCED_FILTER_LOCALE_TEXT, variableValues?: string[]) => string;\r\n}\r\n\r\nexport class TextFilterExpressionOperators<TValue = string>\r\n    implements DataTypeFilterExpressionOperators<string, TValue>\r\n{\r\n    public operators: { [operator: string]: FilterExpressionOperator<string, TValue> };\r\n\r\n    constructor(private params: FilterExpressionOperatorsParams) {\r\n        this.initOperators();\r\n    }\r\n\r\n    public getEntries(activeOperators?: string[]): AutocompleteEntry[] {\r\n        return getEntries(this.operators, activeOperators);\r\n    }\r\n\r\n    public findOperator(displayValue: string): string | null | undefined {\r\n        return findMatch(displayValue, this.operators, ({ displayValue }) => displayValue);\r\n    }\r\n\r\n    private initOperators(): void {\r\n        const { translate } = this.params;\r\n        this.operators = {\r\n            contains: {\r\n                displayValue: translate('advancedFilterContains'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateExpression(value, node, params, operand1!, false, (v, o) => v.includes(o)),\r\n                numOperands: 1,\r\n            },\r\n            notContains: {\r\n                displayValue: translate('advancedFilterNotContains'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateExpression(value, node, params, operand1!, true, (v, o) => !v.includes(o)),\r\n                numOperands: 1,\r\n            },\r\n            equals: {\r\n                displayValue: translate('advancedFilterTextEquals'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateExpression(value, node, params, operand1!, false, (v, o) => v === o),\r\n                numOperands: 1,\r\n            },\r\n            notEqual: {\r\n                displayValue: translate('advancedFilterTextNotEqual'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateExpression(value, node, params, operand1!, true, (v, o) => v != o),\r\n                numOperands: 1,\r\n            },\r\n            startsWith: {\r\n                displayValue: translate('advancedFilterStartsWith'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateExpression(value, node, params, operand1!, false, (v, o) => v.startsWith(o)),\r\n                numOperands: 1,\r\n            },\r\n            endsWith: {\r\n                displayValue: translate('advancedFilterEndsWith'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateExpression(value, node, params, operand1!, false, (v, o) => v.endsWith(o)),\r\n                numOperands: 1,\r\n            },\r\n            blank: {\r\n                displayValue: translate('advancedFilterBlank'),\r\n                evaluator: (value) => value == null || (typeof value === 'string' && value.trim().length === 0),\r\n                numOperands: 0,\r\n            },\r\n            notBlank: {\r\n                displayValue: translate('advancedFilterNotBlank'),\r\n                evaluator: (value) => value != null && (typeof value !== 'string' || value.trim().length > 0),\r\n                numOperands: 0,\r\n            },\r\n        };\r\n    }\r\n\r\n    private evaluateExpression(\r\n        value: TValue | null | undefined,\r\n        node: IRowNode,\r\n        params: FilterExpressionEvaluatorParams<string, TValue>,\r\n        operand: string,\r\n        nullsMatch: boolean,\r\n        expression: (value: string, operand: string) => boolean\r\n    ): boolean {\r\n        if (value == null) {\r\n            return nullsMatch;\r\n        }\r\n        return params.caseSensitive\r\n            ? expression(params.valueConverter(value, node), operand)\r\n            : expression(params.valueConverter(value, node).toLocaleLowerCase(), operand.toLocaleLowerCase());\r\n    }\r\n}\r\n\r\nexport interface ScalarFilterExpressionOperatorsParams<ConvertedTValue> extends FilterExpressionOperatorsParams {\r\n    equals: (value: ConvertedTValue, operand: ConvertedTValue) => boolean;\r\n}\r\n\r\nexport class ScalarFilterExpressionOperators<ConvertedTValue extends number | bigint | Date, TValue = ConvertedTValue>\r\n    implements DataTypeFilterExpressionOperators<ConvertedTValue, TValue>\r\n{\r\n    public operators: { [operator: string]: FilterExpressionOperator<ConvertedTValue, TValue> };\r\n\r\n    constructor(private params: ScalarFilterExpressionOperatorsParams<ConvertedTValue>) {\r\n        this.initOperators();\r\n    }\r\n\r\n    public getEntries(activeOperators?: string[]): AutocompleteEntry[] {\r\n        return getEntries(this.operators, activeOperators);\r\n    }\r\n\r\n    public findOperator(displayValue: string): string | null | undefined {\r\n        return findMatch(displayValue, this.operators, ({ displayValue }) => displayValue);\r\n    }\r\n\r\n    private initOperators(): void {\r\n        const { translate, equals } = this.params;\r\n        this.operators = {\r\n            equals: {\r\n                displayValue: translate('advancedFilterEquals'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateSingleOperandExpression(\r\n                        value,\r\n                        node,\r\n                        params,\r\n                        operand1!,\r\n                        !!params.includeBlanksInEquals,\r\n                        equals!\r\n                    ),\r\n                numOperands: 1,\r\n            },\r\n            notEqual: {\r\n                displayValue: translate('advancedFilterNotEqual'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateSingleOperandExpression(\r\n                        value,\r\n                        node,\r\n                        params,\r\n                        operand1!,\r\n                        !!params.includeBlanksInEquals,\r\n                        (v, o) => !equals!(v, o)\r\n                    ),\r\n                numOperands: 1,\r\n            },\r\n            greaterThan: {\r\n                displayValue: translate('advancedFilterGreaterThan'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateSingleOperandExpression(\r\n                        value,\r\n                        node,\r\n                        params,\r\n                        operand1!,\r\n                        !!params.includeBlanksInGreaterThan,\r\n                        (v, o) => v > o\r\n                    ),\r\n                numOperands: 1,\r\n            },\r\n            greaterThanOrEqual: {\r\n                displayValue: translate('advancedFilterGreaterThanOrEqual'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateSingleOperandExpression(\r\n                        value,\r\n                        node,\r\n                        params,\r\n                        operand1!,\r\n                        !!params.includeBlanksInGreaterThan,\r\n                        (v, o) => v >= o\r\n                    ),\r\n                numOperands: 1,\r\n            },\r\n            lessThan: {\r\n                displayValue: translate('advancedFilterLessThan'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateSingleOperandExpression(\r\n                        value,\r\n                        node,\r\n                        params,\r\n                        operand1!,\r\n                        !!params.includeBlanksInLessThan,\r\n                        (v, o) => v < o\r\n                    ),\r\n                numOperands: 1,\r\n            },\r\n            lessThanOrEqual: {\r\n                displayValue: translate('advancedFilterLessThanOrEqual'),\r\n                evaluator: (value, node, params, operand1) =>\r\n                    this.evaluateSingleOperandExpression(\r\n                        value,\r\n                        node,\r\n                        params,\r\n                        operand1!,\r\n                        !!params.includeBlanksInLessThan,\r\n                        (v, o) => v <= o\r\n                    ),\r\n                numOperands: 1,\r\n            },\r\n            blank: {\r\n                displayValue: translate('advancedFilterBlank'),\r\n                evaluator: (value) => value == null,\r\n                numOperands: 0,\r\n            },\r\n            notBlank: {\r\n                displayValue: translate('advancedFilterNotBlank'),\r\n                evaluator: (value) => value != null,\r\n                numOperands: 0,\r\n            },\r\n        };\r\n    }\r\n\r\n    private evaluateSingleOperandExpression(\r\n        value: TValue | null | undefined,\r\n        node: IRowNode,\r\n        params: FilterExpressionEvaluatorParams<ConvertedTValue, TValue>,\r\n        operand: ConvertedTValue,\r\n        nullsMatch: boolean,\r\n        expression: (value: ConvertedTValue, operand: ConvertedTValue) => boolean\r\n    ): boolean {\r\n        if (value == null) {\r\n            return nullsMatch;\r\n        }\r\n        return expression(params.valueConverter(value, node), operand);\r\n    }\r\n}\r\n\r\nexport class BooleanFilterExpressionOperators implements DataTypeFilterExpressionOperators<boolean> {\r\n    public operators: { [operator: string]: FilterExpressionOperator<boolean> };\r\n\r\n    constructor(private params: FilterExpressionOperatorsParams) {\r\n        this.initOperators();\r\n    }\r\n\r\n    public getEntries(activeOperators?: string[]): AutocompleteEntry[] {\r\n        return getEntries(this.operators, activeOperators);\r\n    }\r\n\r\n    public findOperator(displayValue: string): string | null | undefined {\r\n        return findMatch(displayValue, this.operators, ({ displayValue }) => displayValue);\r\n    }\r\n\r\n    private initOperators(): void {\r\n        const { translate } = this.params;\r\n        this.operators = {\r\n            true: {\r\n                displayValue: translate('advancedFilterTrue'),\r\n                evaluator: (value) => !!value,\r\n                numOperands: 0,\r\n            },\r\n            false: {\r\n                displayValue: translate('advancedFilterFalse'),\r\n                evaluator: (value) => value === false,\r\n                numOperands: 0,\r\n            },\r\n            blank: {\r\n                displayValue: translate('advancedFilterBlank'),\r\n                evaluator: (value) => value == null,\r\n                numOperands: 0,\r\n            },\r\n            notBlank: {\r\n                displayValue: translate('advancedFilterNotBlank'),\r\n                evaluator: (value) => value != null,\r\n                numOperands: 0,\r\n            },\r\n        };\r\n    }\r\n}\r\n", "import type {\r\n    AdvancedFilterModel,\r\n    BeanCollection,\r\n    ColumnModel,\r\n    DataTypeService,\r\n    FilterValueService,\r\n    IAdvancedFilterService,\r\n    IRowNode,\r\n    NamedBean,\r\n    NewColumnsLoadedEvent,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _exists, _isClientSideRowModel, _isServerSideRowModel, _warn } from 'ag-grid-community';\r\n\r\nimport { AdvancedFilterCtrl } from './advancedFilterCtrl';\r\nimport type { AdvancedFilterExpressionService } from './advancedFilterExpressionService';\r\nimport type { AutocompleteEntry } from './autocomplete/autocompleteParams';\r\nimport { FilterExpressionParser } from './filterExpressionParser';\r\nimport type {\r\n    ExpressionProxy,\r\n    FilterExpressionFunction,\r\n    FilterExpressionFunctionParams,\r\n} from './filterExpressionUtils';\r\n\r\nexport class AdvancedFilterService extends BeanStub implements NamedBean, IAdvancedFilterService {\r\n    beanName = 'advancedFilter' as const;\r\n\r\n    private valueSvc: ValueService;\r\n    private colModel: ColumnModel;\r\n    private dataTypeSvc?: DataTypeService;\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n    private filterValueSvc: FilterValueService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.valueSvc = beans.valueSvc;\r\n        this.colModel = beans.colModel;\r\n        this.dataTypeSvc = beans.dataTypeSvc;\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n        this.filterValueSvc = beans.filterValueSvc!;\r\n    }\r\n\r\n    private enabled: boolean;\r\n    private ctrl: AdvancedFilterCtrl;\r\n\r\n    private expressionProxy: ExpressionProxy;\r\n    private appliedExpression: string | null = null;\r\n    /** The value displayed in the input, which may be invalid */\r\n    private expression: string | null = null;\r\n    private expressionFunction: FilterExpressionFunction | null;\r\n    private expressionParams: FilterExpressionFunctionParams | null;\r\n    private isValid: boolean = true;\r\n\r\n    public postConstruct(): void {\r\n        this.setEnabled(this.gos.get('enableAdvancedFilter'), true);\r\n\r\n        this.ctrl = this.createManagedBean(new AdvancedFilterCtrl(this.enabled));\r\n\r\n        this.expressionProxy = {\r\n            getValue: (colId, node) => {\r\n                const column = this.colModel.getColDefCol(colId);\r\n                return column ? this.filterValueSvc.getValue(column, node) : undefined;\r\n            },\r\n        };\r\n\r\n        this.addManagedPropertyListener('enableAdvancedFilter', (event) => this.setEnabled(!!event.currentValue));\r\n        this.addManagedEventListeners({\r\n            newColumnsLoaded: (event) => this.onNewColumnsLoaded(event),\r\n        });\r\n        this.addManagedPropertyListener('includeHiddenColumnsInAdvancedFilter', () => this.updateValidity());\r\n    }\r\n\r\n    public isEnabled(): boolean {\r\n        return this.enabled;\r\n    }\r\n\r\n    public isFilterPresent(): boolean {\r\n        return !!this.expressionFunction;\r\n    }\r\n\r\n    public doesFilterPass(node: IRowNode): boolean {\r\n        return this.expressionFunction!(this.expressionProxy, node, this.expressionParams!);\r\n    }\r\n\r\n    public getModel(): AdvancedFilterModel | null {\r\n        const expressionParser = this.createExpressionParser(this.appliedExpression);\r\n        expressionParser?.parseExpression();\r\n        return expressionParser?.getModel() ?? null;\r\n    }\r\n\r\n    public setModel(model: AdvancedFilterModel | null): void {\r\n        const parseModel = (model: AdvancedFilterModel, isFirstParent?: boolean): string | null => {\r\n            if (model.filterType === 'join') {\r\n                const operator = this.advFilterExpSvc.parseJoinOperator(model);\r\n                const expression = model.conditions\r\n                    .map((condition) => parseModel(condition))\r\n                    .filter((condition) => _exists(condition))\r\n                    .join(` ${operator} `);\r\n                return isFirstParent || model.conditions.length <= 1 ? expression : `(${expression})`;\r\n            } else {\r\n                return this.advFilterExpSvc.parseColumnFilterModel(model);\r\n            }\r\n        };\r\n\r\n        const expression = model ? parseModel(model, true) : null;\r\n\r\n        this.setExpressionDisplayValue(expression);\r\n        this.applyExpression();\r\n        this.ctrl.refreshComp();\r\n        this.ctrl.refreshBuilderComp();\r\n    }\r\n\r\n    public getExpressionDisplayValue(): string | null {\r\n        return this.expression;\r\n    }\r\n\r\n    public setExpressionDisplayValue(expression: string | null): void {\r\n        this.expression = expression;\r\n    }\r\n\r\n    public isCurrentExpressionApplied(): boolean {\r\n        return this.appliedExpression === this.expression;\r\n    }\r\n\r\n    public createExpressionParser(expression: string | null): FilterExpressionParser | null {\r\n        if (!expression) {\r\n            return null;\r\n        }\r\n\r\n        return new FilterExpressionParser({\r\n            expression,\r\n            colModel: this.colModel,\r\n            dataTypeSvc: this.dataTypeSvc,\r\n            valueSvc: this.valueSvc,\r\n            advFilterExpSvc: this.advFilterExpSvc,\r\n        });\r\n    }\r\n\r\n    public getDefaultExpression(updateEntry: AutocompleteEntry): {\r\n        updatedValue: string;\r\n        updatedPosition: number;\r\n    } {\r\n        const updatedValue = this.advFilterExpSvc.getColumnValue(updateEntry) + ' ';\r\n        return {\r\n            updatedValue,\r\n            updatedPosition: updatedValue.length,\r\n        };\r\n    }\r\n\r\n    public isHeaderActive(): boolean {\r\n        return !this.gos.get('advancedFilterParent');\r\n    }\r\n\r\n    public getCtrl(): AdvancedFilterCtrl {\r\n        return this.ctrl;\r\n    }\r\n\r\n    private setEnabled(enabled: boolean, silent?: boolean): void {\r\n        const previousValue = this.enabled;\r\n        const isValidRowModel = _isClientSideRowModel(this.gos) || _isServerSideRowModel(this.gos);\r\n        if (enabled && !isValidRowModel) {\r\n            _warn(123);\r\n        }\r\n        this.enabled = enabled && isValidRowModel;\r\n        if (!silent && this.enabled !== previousValue) {\r\n            this.eventSvc.dispatchEvent({\r\n                type: 'advancedFilterEnabledChanged',\r\n                enabled: this.enabled,\r\n            });\r\n        }\r\n    }\r\n\r\n    public applyExpression(): void {\r\n        const expressionParser = this.createExpressionParser(this.expression);\r\n        expressionParser?.parseExpression();\r\n        this.applyExpressionFromParser(expressionParser);\r\n    }\r\n\r\n    private applyExpressionFromParser(expressionParser: FilterExpressionParser | null): void {\r\n        this.isValid = !expressionParser || expressionParser.isValid();\r\n        if (!expressionParser || !this.isValid) {\r\n            this.expressionFunction = null;\r\n            this.expressionParams = null;\r\n            this.appliedExpression = null;\r\n            return;\r\n        }\r\n\r\n        const { expressionFunction, params } = this.getFunction(expressionParser);\r\n\r\n        this.expressionFunction = expressionFunction;\r\n        this.expressionParams = params;\r\n        this.appliedExpression = this.expression;\r\n    }\r\n\r\n    private getFunction(expressionParser: FilterExpressionParser): {\r\n        expressionFunction: FilterExpressionFunction;\r\n        params: FilterExpressionFunctionParams;\r\n    } {\r\n        if (this.gos.get('suppressAdvancedFilterEval')) {\r\n            return expressionParser.getFunctionParsed();\r\n        } else {\r\n            const { functionString, params } = expressionParser.getFunctionString();\r\n            return {\r\n                expressionFunction: new Function(\r\n                    'expressionProxy',\r\n                    'node',\r\n                    'params',\r\n                    functionString\r\n                ) as FilterExpressionFunction,\r\n                params,\r\n            };\r\n        }\r\n    }\r\n\r\n    public updateValidity(): boolean {\r\n        this.advFilterExpSvc.resetColumnCaches();\r\n        const expressionParser = this.createExpressionParser(this.expression);\r\n        expressionParser?.parseExpression();\r\n        const isValid = !expressionParser || expressionParser.isValid();\r\n\r\n        const updatedValidity = isValid !== this.isValid;\r\n\r\n        this.applyExpressionFromParser(expressionParser);\r\n        this.ctrl.refreshComp();\r\n        this.ctrl.refreshBuilderComp();\r\n        return updatedValidity;\r\n    }\r\n\r\n    private onNewColumnsLoaded(event: NewColumnsLoadedEvent): void {\r\n        if (event.source !== 'gridInitializing' || !this.dataTypeSvc?.isPendingInference) {\r\n            return;\r\n        }\r\n\r\n        this.ctrl.setInputDisabled(true);\r\n        const [destroyFunc] = this.addManagedEventListeners({\r\n            dataTypesInferred: () => {\r\n                destroyFunc?.();\r\n                this.ctrl.setInputDisabled(false);\r\n            },\r\n        });\r\n    }\r\n}\r\n", "import type { BeanCollection, CtrlsService, Environment, IAdvancedFilterCtrl, PopupService } from 'ag-grid-community';\r\nimport { BeanStub, _getAbsoluteHeight, _getAbsoluteWidth, _removeFromParent } from 'ag-grid-community';\r\n\r\nimport { AgDialog } from '../widgets/agDialog';\r\nimport { AdvancedFilterComp } from './advancedFilterComp';\r\nimport type { AdvancedFilterExpressionService } from './advancedFilterExpressionService';\r\nimport { AdvancedFilterHeaderComp } from './advancedFilterHeaderComp';\r\nimport { AdvancedFilterBuilderComp } from './builder/advancedFilterBuilderComp';\r\n\r\nexport type AdvancedFilterCtrlEvent = 'advancedFilterBuilderClosed';\r\nexport class AdvancedFilterCtrl extends BeanStub<AdvancedFilterCtrlEvent> implements IAdvancedFilterCtrl {\r\n    private ctrlsSvc: CtrlsService;\r\n    private popupSvc: PopupService;\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n    private environment: Environment;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.ctrlsSvc = beans.ctrlsSvc;\r\n        this.popupSvc = beans.popupSvc!;\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n        this.environment = beans.environment;\r\n    }\r\n\r\n    private eHeaderComp: AdvancedFilterHeaderComp | undefined;\r\n    private eFilterComp: AdvancedFilterComp | undefined;\r\n    private hasAdvancedFilterParent: boolean;\r\n    private eBuilderComp: AdvancedFilterBuilderComp | undefined;\r\n    private eBuilderDialog: AgDialog | undefined;\r\n    private builderDestroySource?: 'api' | 'ui';\r\n\r\n    constructor(private enabled: boolean) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.hasAdvancedFilterParent = !!this.gos.get('advancedFilterParent');\r\n\r\n        this.ctrlsSvc.whenReady(this, () => this.setAdvancedFilterComp());\r\n\r\n        this.addManagedEventListeners({\r\n            advancedFilterEnabledChanged: ({ enabled }) => this.onEnabledChanged(enabled),\r\n        });\r\n\r\n        this.addManagedPropertyListener('advancedFilterParent', () => this.updateComps());\r\n\r\n        this.addDestroyFunc(() => {\r\n            this.destroyAdvancedFilterComp();\r\n            this.destroyBean(this.eBuilderComp);\r\n            if (this.eBuilderDialog && this.eBuilderDialog.isAlive()) {\r\n                this.destroyBean(this.eBuilderDialog);\r\n            }\r\n        });\r\n    }\r\n\r\n    public setupHeaderComp(eCompToInsertBefore: HTMLElement): void {\r\n        if (this.eHeaderComp) {\r\n            this.eHeaderComp?.getGui().remove();\r\n            this.destroyBean(this.eHeaderComp);\r\n        }\r\n\r\n        this.eHeaderComp = this.createManagedBean(\r\n            new AdvancedFilterHeaderComp(this.enabled && !this.hasAdvancedFilterParent)\r\n        );\r\n        eCompToInsertBefore.insertAdjacentElement('beforebegin', this.eHeaderComp.getGui());\r\n    }\r\n\r\n    public focusHeaderComp(): boolean {\r\n        if (this.eHeaderComp) {\r\n            this.eHeaderComp.getFocusableElement().focus();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public refreshComp(): void {\r\n        this.eFilterComp?.refresh();\r\n        this.eHeaderComp?.refresh();\r\n    }\r\n\r\n    public refreshBuilderComp(): void {\r\n        this.eBuilderComp?.refresh();\r\n    }\r\n\r\n    public getHeaderHeight(): number {\r\n        return this.eHeaderComp?.getHeight() ?? 0;\r\n    }\r\n\r\n    public setInputDisabled(disabled: boolean): void {\r\n        this.eFilterComp?.setInputDisabled(disabled);\r\n        this.eHeaderComp?.setInputDisabled(disabled);\r\n    }\r\n\r\n    public toggleFilterBuilder(params: { source: 'api' | 'ui'; force?: boolean; eventSource?: HTMLElement }): void {\r\n        const { source, force, eventSource } = params;\r\n        if ((force && this.eBuilderDialog) || (force === false && !this.eBuilderDialog)) {\r\n            // state requested is already active\r\n            return;\r\n        }\r\n        if (this.eBuilderDialog) {\r\n            this.builderDestroySource = source;\r\n            this.destroyBean(this.eBuilderDialog);\r\n            return;\r\n        }\r\n\r\n        this.setInputDisabled(true);\r\n\r\n        const { width, height, minWidth } = this.getBuilderDialogSize();\r\n\r\n        this.eBuilderComp = this.createBean(new AdvancedFilterBuilderComp());\r\n        this.eBuilderDialog = this.createBean(\r\n            new AgDialog({\r\n                title: this.advFilterExpSvc.translate('advancedFilterBuilderTitle'),\r\n                component: this.eBuilderComp,\r\n                width,\r\n                height,\r\n                resizable: true,\r\n                movable: true,\r\n                maximizable: true,\r\n                centered: true,\r\n                closable: true,\r\n                minWidth,\r\n                afterGuiAttached: () => this.eBuilderComp?.afterGuiAttached(),\r\n                postProcessPopupParams: {\r\n                    type: 'advancedFilterBuilder',\r\n                    eventSource,\r\n                },\r\n            })\r\n        );\r\n\r\n        this.dispatchFilterBuilderVisibleChangedEvent(source, true);\r\n\r\n        this.eBuilderDialog.addEventListener('destroyed', () => {\r\n            this.destroyBean(this.eBuilderComp);\r\n            this.eBuilderComp = undefined;\r\n            this.eBuilderDialog = undefined;\r\n            this.setInputDisabled(false);\r\n            this.dispatchLocalEvent({\r\n                type: 'advancedFilterBuilderClosed',\r\n            });\r\n            this.dispatchFilterBuilderVisibleChangedEvent(this.builderDestroySource ?? 'ui', false);\r\n            this.builderDestroySource = undefined;\r\n        });\r\n    }\r\n\r\n    private dispatchFilterBuilderVisibleChangedEvent(source: 'api' | 'ui', visible: boolean): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'advancedFilterBuilderVisibleChanged',\r\n            source,\r\n            visible,\r\n        });\r\n    }\r\n\r\n    private getBuilderDialogSize(): { width: number; height: number; minWidth: number } {\r\n        const minWidth = this.gos.get('advancedFilterBuilderParams')?.minWidth ?? 500;\r\n        const popupParent = this.popupSvc.getPopupParent();\r\n        const maxWidth = Math.round(_getAbsoluteWidth(popupParent)) - 2; // assume 1 pixel border\r\n        const maxHeight = Math.round(_getAbsoluteHeight(popupParent) * 0.75) - 2;\r\n\r\n        const width = Math.min(Math.max(600, minWidth), maxWidth);\r\n        const height = Math.min(600, maxHeight);\r\n\r\n        return { width, height, minWidth };\r\n    }\r\n\r\n    private onEnabledChanged(enabled: boolean): void {\r\n        this.enabled = enabled;\r\n        this.updateComps();\r\n    }\r\n\r\n    private updateComps(): void {\r\n        this.setAdvancedFilterComp();\r\n        this.setHeaderCompEnabled();\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'headerHeightChanged',\r\n        });\r\n    }\r\n\r\n    private setAdvancedFilterComp(): void {\r\n        this.destroyAdvancedFilterComp();\r\n        if (!this.enabled) {\r\n            return;\r\n        }\r\n\r\n        const advancedFilterParent = this.gos.get('advancedFilterParent');\r\n        this.hasAdvancedFilterParent = !!advancedFilterParent;\r\n        if (advancedFilterParent) {\r\n            // unmanaged as can be recreated\r\n            const eAdvancedFilterComp = this.createBean(new AdvancedFilterComp());\r\n            const eAdvancedFilterCompGui = eAdvancedFilterComp.getGui();\r\n\r\n            this.environment.applyThemeClasses(eAdvancedFilterCompGui);\r\n\r\n            eAdvancedFilterCompGui.classList.add(this.gos.get('enableRtl') ? 'ag-rtl' : 'ag-ltr');\r\n\r\n            advancedFilterParent.appendChild(eAdvancedFilterCompGui);\r\n\r\n            this.eFilterComp = eAdvancedFilterComp;\r\n        }\r\n    }\r\n\r\n    private setHeaderCompEnabled(): void {\r\n        this.eHeaderComp?.setEnabled(this.enabled && !this.hasAdvancedFilterParent);\r\n    }\r\n\r\n    private destroyAdvancedFilterComp(): void {\r\n        if (this.eFilterComp) {\r\n            _removeFromParent(this.eFilterComp.getGui());\r\n            this.destroyBean(this.eFilterComp);\r\n        }\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    FocusableContainer,\r\n    IRowNode,\r\n    PopupService,\r\n    ResizableStructure,\r\n} from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    TabGuardFeature,\r\n    _createIconNoSpan,\r\n    _findNextFocusableElement,\r\n    _focusNextGridCoreContainer,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport type { PanelOptions } from './agPanel';\r\nimport { AgPanel } from './agPanel';\r\n\r\nexport type ResizableSides =\r\n    | 'topLeft'\r\n    | 'top'\r\n    | 'topRight'\r\n    | 'right'\r\n    | 'bottomRight'\r\n    | 'bottom'\r\n    | 'bottomLeft'\r\n    | 'left';\r\n\r\nexport interface DialogPostProcessPopupParams {\r\n    type: string;\r\n    eventSource?: HTMLElement | null;\r\n    mouseEvent?: MouseEvent | Touch | null;\r\n    column?: AgColumn | null;\r\n    rowNode?: IRowNode | null;\r\n}\r\n\r\nexport interface DialogOptions extends PanelOptions {\r\n    eWrapper?: HTMLElement;\r\n    modal?: boolean;\r\n    movable?: boolean;\r\n    alwaysOnTop?: boolean;\r\n    maximizable?: boolean;\r\n    afterGuiAttached?: () => void;\r\n    closedCallback?: (event?: MouseEvent | TouchEvent | KeyboardEvent) => void;\r\n    postProcessPopupParams?: DialogPostProcessPopupParams;\r\n}\r\n\r\nexport class AgDialog extends AgPanel<DialogOptions> implements FocusableContainer {\r\n    private popupSvc?: PopupService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.popupSvc = beans.popupSvc;\r\n    }\r\n\r\n    private tabGuardFeature: TabGuardFeature;\r\n    private isMaximizable: boolean = false;\r\n    private isMaximized: boolean = false;\r\n    private maximizeListeners: (() => void)[] = [];\r\n    private maximizeButtonComp: Component | undefined;\r\n    private maximizeIcon: Element | undefined;\r\n    private minimizeIcon: Element | undefined;\r\n    private resizeListenerDestroy: (() => void) | null | undefined = null;\r\n\r\n    private lastPosition = {\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n    };\r\n\r\n    constructor(config: DialogOptions) {\r\n        super({ ...config, popup: true });\r\n    }\r\n\r\n    public override postConstruct() {\r\n        const eGui = this.getGui();\r\n        const { movable, resizable, maximizable, modal, postProcessPopupParams } = this.config;\r\n\r\n        this.addCssClass('ag-dialog');\r\n\r\n        super.postConstruct();\r\n\r\n        if (postProcessPopupParams) {\r\n            const { type, eventSource, column, mouseEvent, rowNode } = postProcessPopupParams;\r\n            this.popupSvc?.callPostProcessPopup(type, eGui, eventSource, mouseEvent, column, rowNode);\r\n        }\r\n\r\n        this.tabGuardFeature = this.createManagedBean(new TabGuardFeature(this));\r\n        this.tabGuardFeature.initialiseTabGuard({\r\n            isFocusableContainer: true,\r\n            onFocusIn: () => {\r\n                this.popupSvc?.bringPopupToFront(eGui);\r\n            },\r\n            onTabKeyDown: (e) => {\r\n                if (modal) {\r\n                    return;\r\n                }\r\n                const backwards = e.shiftKey;\r\n                const nextFocusableElement = _findNextFocusableElement(this.beans, eGui, false, backwards);\r\n                if (!nextFocusableElement || this.tabGuardFeature.getTabGuardCtrl().isTabGuard(nextFocusableElement)) {\r\n                    if (_focusNextGridCoreContainer(this.beans, backwards)) {\r\n                        e.preventDefault();\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        if (movable) {\r\n            this.setMovable(movable);\r\n        }\r\n        if (maximizable) {\r\n            this.setMaximizable(maximizable);\r\n        }\r\n        if (resizable) {\r\n            this.setResizable(resizable);\r\n        }\r\n\r\n        if (!this.config.modal) {\r\n            const gridCtrl = this.beans.ctrlsSvc.get('gridCtrl');\r\n            gridCtrl.addFocusableContainer(this);\r\n            this.addDestroyFunc(() => gridCtrl.removeFocusableContainer(this));\r\n        }\r\n    }\r\n\r\n    public setAllowFocus(allowFocus: boolean): void {\r\n        this.tabGuardFeature.getTabGuardCtrl().setAllowFocus(allowFocus);\r\n    }\r\n\r\n    protected override renderComponent() {\r\n        const eGui = this.getGui();\r\n        const { alwaysOnTop, modal, title, afterGuiAttached } = this.config;\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        const addPopupRes = this.popupSvc?.addPopup({\r\n            modal,\r\n            eChild: eGui,\r\n            closeOnEsc: true,\r\n            closedCallback: this.onClosed.bind(this),\r\n            alwaysOnTop,\r\n            ariaLabel: title || translate('ariaLabelDialog', 'Dialog'),\r\n            afterGuiAttached,\r\n        });\r\n\r\n        if (addPopupRes) {\r\n            this.close = addPopupRes.hideFunc;\r\n        }\r\n    }\r\n\r\n    private onClosed(event?: MouseEvent | TouchEvent | KeyboardEvent): void {\r\n        this.destroy();\r\n        this.config.closedCallback?.(event);\r\n    }\r\n\r\n    private toggleMaximize() {\r\n        const position = this.positionableFeature.getPosition();\r\n        if (this.isMaximized) {\r\n            const { x, y, width, height } = this.lastPosition;\r\n            this.setWidth(width);\r\n            this.setHeight(height);\r\n            this.positionableFeature.offsetElement(x, y);\r\n        } else {\r\n            this.lastPosition.width = this.getWidth()!;\r\n            this.lastPosition.height = this.getHeight()!;\r\n            this.lastPosition.x = position.x;\r\n            this.lastPosition.y = position.y;\r\n            this.positionableFeature.offsetElement(0, 0);\r\n            this.setHeight('100%');\r\n            this.setWidth('100%');\r\n        }\r\n\r\n        this.isMaximized = !this.isMaximized;\r\n        this.refreshMaximizeIcon();\r\n    }\r\n\r\n    private refreshMaximizeIcon() {\r\n        _setDisplayed(this.maximizeIcon!, !this.isMaximized);\r\n        _setDisplayed(this.minimizeIcon!, this.isMaximized);\r\n    }\r\n\r\n    private clearMaximizebleListeners() {\r\n        if (this.maximizeListeners.length) {\r\n            this.maximizeListeners.forEach((destroyListener) => destroyListener());\r\n            this.maximizeListeners.length = 0;\r\n        }\r\n\r\n        if (this.resizeListenerDestroy) {\r\n            this.resizeListenerDestroy();\r\n            this.resizeListenerDestroy = null;\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.maximizeButtonComp = this.destroyBean(this.maximizeButtonComp);\r\n\r\n        this.clearMaximizebleListeners();\r\n        super.destroy();\r\n    }\r\n\r\n    public setResizable(resizable: boolean | ResizableStructure) {\r\n        this.positionableFeature.setResizable(resizable);\r\n    }\r\n\r\n    public setMovable(movable: boolean) {\r\n        this.positionableFeature.setMovable(movable, this.eTitleBar);\r\n    }\r\n\r\n    public setMaximizable(maximizable: boolean) {\r\n        if (!maximizable) {\r\n            this.clearMaximizebleListeners();\r\n\r\n            if (this.maximizeButtonComp) {\r\n                this.destroyBean(this.maximizeButtonComp);\r\n                this.maximizeButtonComp = this.maximizeIcon = this.minimizeIcon = undefined;\r\n            }\r\n            return;\r\n        }\r\n\r\n        const eTitleBar = this.eTitleBar;\r\n\r\n        if (!eTitleBar || maximizable === this.isMaximizable) {\r\n            return;\r\n        }\r\n\r\n        const maximizeButtonComp = this.buildMaximizeAndMinimizeElements();\r\n        this.refreshMaximizeIcon();\r\n\r\n        maximizeButtonComp.addManagedElementListeners(maximizeButtonComp.getGui(), {\r\n            click: this.toggleMaximize.bind(this),\r\n        });\r\n\r\n        this.addTitleBarButton(maximizeButtonComp, 0);\r\n\r\n        this.maximizeListeners.push(\r\n            ...this.addManagedElementListeners(eTitleBar, {\r\n                dblclick: this.toggleMaximize.bind(this),\r\n            })\r\n        );\r\n\r\n        [this.resizeListenerDestroy] = this.addManagedListeners(this.positionableFeature, {\r\n            resize: () => {\r\n                this.isMaximized = false;\r\n                this.refreshMaximizeIcon();\r\n            },\r\n        });\r\n    }\r\n\r\n    private buildMaximizeAndMinimizeElements(): Component {\r\n        const maximizeButtonComp = (this.maximizeButtonComp = this.createBean(\r\n            new Component(/* html */ `<div class=\"ag-dialog-button\"></span>`)\r\n        ));\r\n\r\n        const eGui = maximizeButtonComp.getGui();\r\n\r\n        this.maximizeIcon = _createIconNoSpan('maximize', this.beans)!;\r\n        eGui.appendChild(this.maximizeIcon);\r\n        this.maximizeIcon.classList.add('ag-panel-title-bar-button-icon');\r\n\r\n        this.minimizeIcon = _createIconNoSpan('minimize', this.beans)!;\r\n        eGui.appendChild(this.minimizeIcon);\r\n        this.minimizeIcon.classList.add('ag-panel-title-bar-button-icon');\r\n\r\n        return maximizeButtonComp;\r\n    }\r\n}\r\n", "import type { PositionableOptions, ResizableStructure } from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    PositionableFeature,\r\n    RefPlaceholder,\r\n    _createIconNoSpan,\r\n    _getActiveDomElement,\r\n    _getInnerHeight,\r\n    _getInnerWidth,\r\n    _isVisible,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport { agPanelCSS } from './agPanel.css-GENERATED';\r\n\r\nexport interface PanelOptions extends PositionableOptions {\r\n    component?: Component<any>;\r\n    hideTitleBar?: boolean | null;\r\n    closable?: boolean | null;\r\n    resizable?: boolean | ResizableStructure;\r\n    title?: string | null;\r\n    cssIdentifier?: string | null;\r\n}\r\nfunction getTemplate(config: PanelOptions) {\r\n    const cssIdentifier = config.cssIdentifier || 'default';\r\n    return /* html */ `<div class=\"ag-panel ag-${cssIdentifier}-panel\" tabindex=\"-1\">\r\n        <div data-ref=\"eTitleBar\" class=\"ag-panel-title-bar ag-${cssIdentifier}-panel-title-bar ag-unselectable\">\r\n            <span data-ref=\"eTitle\" class=\"ag-panel-title-bar-title ag-${cssIdentifier}-panel-title-bar-title\"></span>\r\n            <div data-ref=\"eTitleBarButtons\" class=\"ag-panel-title-bar-buttons ag-${cssIdentifier}-panel-title-bar-buttons\"></div>\r\n        </div>\r\n        <div data-ref=\"eContentWrapper\" class=\"ag-panel-content-wrapper ag-${cssIdentifier}-panel-content-wrapper\"></div>\r\n    </div>`;\r\n}\r\n\r\nconst CLOSE_BTN_TEMPLATE = /* html */ `<div class=\"ag-button\"></div>`;\r\n\r\nexport class AgPanel<TConfig extends PanelOptions = PanelOptions> extends Component {\r\n    protected closable = true;\r\n\r\n    protected closeButtonComp: Component | undefined;\r\n    protected positionableFeature: PositionableFeature;\r\n    public close: () => void;\r\n\r\n    protected readonly eContentWrapper: HTMLElement = RefPlaceholder;\r\n    protected readonly eTitleBar: HTMLElement = RefPlaceholder;\r\n    protected readonly eTitleBarButtons: HTMLElement = RefPlaceholder;\r\n    protected readonly eTitle: HTMLElement = RefPlaceholder;\r\n\r\n    constructor(protected readonly config: TConfig) {\r\n        super(getTemplate(config));\r\n        this.registerCSS(agPanelCSS);\r\n    }\r\n\r\n    public postConstruct() {\r\n        const {\r\n            component,\r\n            closable,\r\n            hideTitleBar,\r\n            title,\r\n            minWidth = 250,\r\n            width,\r\n            minHeight = 250,\r\n            height,\r\n            centered,\r\n            popup,\r\n            x,\r\n            y,\r\n        } = this.config;\r\n\r\n        this.positionableFeature = new PositionableFeature(this.getGui(), {\r\n            minWidth,\r\n            width,\r\n            minHeight,\r\n            height,\r\n            centered,\r\n            x,\r\n            y,\r\n            popup,\r\n            calculateTopBuffer: () => this.positionableFeature.getHeight()! - this.getBodyHeight(),\r\n        });\r\n\r\n        this.createManagedBean(this.positionableFeature);\r\n\r\n        const eGui = this.getGui();\r\n\r\n        if (component) {\r\n            this.setBodyComponent(component);\r\n        }\r\n\r\n        if (!hideTitleBar) {\r\n            if (title) {\r\n                this.setTitle(title);\r\n            }\r\n            this.setClosable(closable != null ? closable : this.closable);\r\n        } else {\r\n            _setDisplayed(this.eTitleBar, false);\r\n        }\r\n\r\n        this.addManagedElementListeners(this.eTitleBar, {\r\n            mousedown: (e: MouseEvent) => {\r\n                if (\r\n                    eGui.contains(e.relatedTarget as HTMLElement) ||\r\n                    eGui.contains(_getActiveDomElement(this.beans)) ||\r\n                    this.eTitleBarButtons.contains(e.target as HTMLElement)\r\n                ) {\r\n                    e.preventDefault();\r\n                    return;\r\n                }\r\n\r\n                const focusEl = this.eContentWrapper.querySelector(\r\n                    'button, [href], input, select, textarea, [tabindex]'\r\n                );\r\n\r\n                if (focusEl) {\r\n                    (focusEl as HTMLElement).focus();\r\n                }\r\n            },\r\n        });\r\n\r\n        if (popup && this.positionableFeature.isPositioned()) {\r\n            return;\r\n        }\r\n\r\n        if (this.renderComponent) {\r\n            this.renderComponent();\r\n        }\r\n\r\n        this.positionableFeature.initialisePosition();\r\n        this.eContentWrapper.style.height = '0';\r\n    }\r\n\r\n    protected renderComponent() {\r\n        const eGui = this.getGui();\r\n        eGui.focus();\r\n\r\n        this.close = () => {\r\n            eGui.parentElement!.removeChild(eGui);\r\n            this.destroy();\r\n        };\r\n    }\r\n\r\n    public getHeight(): number | undefined {\r\n        return this.positionableFeature.getHeight();\r\n    }\r\n\r\n    public setHeight(height: number | string): void {\r\n        this.positionableFeature.setHeight(height);\r\n    }\r\n\r\n    public getWidth(): number | undefined {\r\n        return this.positionableFeature.getWidth();\r\n    }\r\n\r\n    public setWidth(width: number | string): void {\r\n        this.positionableFeature.setWidth(width);\r\n    }\r\n\r\n    public setClosable(closable: boolean) {\r\n        if (closable !== this.closable) {\r\n            this.closable = closable;\r\n        }\r\n\r\n        if (closable) {\r\n            const closeButtonComp = (this.closeButtonComp = new Component(CLOSE_BTN_TEMPLATE));\r\n            this.createBean(closeButtonComp);\r\n\r\n            const eGui = closeButtonComp.getGui();\r\n            const child = _createIconNoSpan('close', this.beans)!;\r\n            child.classList.add('ag-panel-title-bar-button-icon');\r\n            eGui.appendChild(child);\r\n\r\n            this.addTitleBarButton(closeButtonComp);\r\n            closeButtonComp.addManagedElementListeners(eGui, { click: this.onBtClose.bind(this) });\r\n        } else if (this.closeButtonComp) {\r\n            const eGui = this.closeButtonComp.getGui();\r\n            eGui.parentElement!.removeChild(eGui);\r\n\r\n            this.closeButtonComp = this.destroyBean(this.closeButtonComp);\r\n        }\r\n    }\r\n\r\n    public setBodyComponent(bodyComponent: Component<any>) {\r\n        bodyComponent.setParentComponent(this);\r\n        this.eContentWrapper.appendChild(bodyComponent.getGui());\r\n    }\r\n\r\n    public addTitleBarButton(button: Component, position?: number) {\r\n        const eTitleBarButtons = this.eTitleBarButtons;\r\n        const buttons = eTitleBarButtons.children;\r\n        const len = buttons.length;\r\n\r\n        if (position == null) {\r\n            position = len;\r\n        }\r\n\r\n        position = Math.max(0, Math.min(position, len));\r\n\r\n        button.addCssClass('ag-panel-title-bar-button');\r\n\r\n        const eGui = button.getGui();\r\n\r\n        if (position === 0) {\r\n            eTitleBarButtons.insertAdjacentElement('afterbegin', eGui);\r\n        } else if (position === len) {\r\n            eTitleBarButtons.insertAdjacentElement('beforeend', eGui);\r\n        } else {\r\n            buttons[position - 1].insertAdjacentElement('afterend', eGui);\r\n        }\r\n\r\n        button.setParentComponent(this);\r\n    }\r\n\r\n    public getBodyHeight(): number {\r\n        return _getInnerHeight(this.eContentWrapper);\r\n    }\r\n\r\n    public getBodyWidth(): number {\r\n        return _getInnerWidth(this.eContentWrapper);\r\n    }\r\n\r\n    public setTitle(title: string) {\r\n        this.eTitle.innerText = title;\r\n    }\r\n\r\n    // called when user hits the 'x' in the top right\r\n    private onBtClose() {\r\n        this.close();\r\n    }\r\n\r\n    public override destroy(): void {\r\n        if (this.closeButtonComp) {\r\n            this.closeButtonComp = this.destroyBean(this.closeButtonComp);\r\n        }\r\n\r\n        const eGui = this.getGui();\r\n\r\n        if (eGui && _isVisible(eGui)) {\r\n            this.close();\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n}\r\n", "export const agPanelCSS = /*css*/ `.ag-panel{background-color:var(--ag-panel-background-color);display:flex;flex-direction:column;overflow:hidden;position:relative}.ag-dialog{border:var(--ag-dialog-border);border-radius:var(--ag-border-radius);box-shadow:var(--ag-dialog-shadow);position:absolute}.ag-panel-title-bar{align-items:center;background-color:var(--ag-panel-title-bar-background-color);border-bottom:var(--ag-panel-title-bar-border);color:var(--ag-header-text-color);cursor:default;display:flex;flex:none;height:var(--ag-header-height);padding:var(--ag-spacing) var(--ag-cell-horizontal-padding)}.ag-panel-title-bar-button{cursor:pointer}:where(.ag-ltr) .ag-panel-title-bar-button{margin-left:calc(var(--ag-spacing)*2);margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-panel-title-bar-button{margin-left:var(--ag-spacing);margin-right:calc(var(--ag-spacing)*2)}.ag-panel-title-bar-title{color:var(--ag-header-text-color);flex:1 1 auto;font-weight:500}.ag-panel-title-bar-buttons{display:flex}.ag-panel-content-wrapper{display:flex;flex:1 1 auto;overflow:hidden;position:relative}:where(.ag-dragging-fill-handle) .ag-dialog,:where(.ag-dragging-range-handle) .ag-dialog{opacity:.7;pointer-events:none}`;\n", "import type { BeanCollection, FilterManager, ITooltipCtrl, Registry, TooltipFeature } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _createIconNoSpan, _makeNull, _setDisabled } from 'ag-grid-community';\r\n\r\nimport type { AdvancedFilterExpressionService } from './advancedFilterExpressionService';\r\nimport type { AdvancedFilterService } from './advancedFilterService';\r\nimport type {\r\n    AgAutocomplete,\r\n    AutocompleteOptionSelectedEvent,\r\n    AutocompleteValidChangedEvent,\r\n    AutocompleteValueChangedEvent,\r\n    AutocompleteValueConfirmedEvent,\r\n} from './autocomplete/agAutocomplete';\r\nimport { AgAutocompleteSelector } from './autocomplete/agAutocomplete';\r\nimport type { AutocompleteEntry, AutocompleteListParams } from './autocomplete/autocompleteParams';\r\nimport type { FilterExpressionParser } from './filterExpressionParser';\r\nimport type { AutocompleteUpdate } from './filterExpressionUtils';\r\n\r\nexport class AdvancedFilterComp extends Component {\r\n    private advancedFilter: AdvancedFilterService;\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n    private filterManager?: FilterManager;\r\n    private registry: Registry;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n        this.advancedFilter = beans.advancedFilter as AdvancedFilterService;\r\n        this.filterManager = beans.filterManager;\r\n        this.registry = beans.registry;\r\n    }\r\n\r\n    private readonly eAutocomplete: AgAutocomplete = RefPlaceholder;\r\n    private readonly eApplyFilterButton: HTMLElement = RefPlaceholder;\r\n    private readonly eBuilderFilterButton: HTMLElement = RefPlaceholder;\r\n    private readonly eBuilderFilterButtonIcon: HTMLElement = RefPlaceholder;\r\n    private readonly eBuilderFilterButtonLabel: HTMLElement = RefPlaceholder;\r\n\r\n    private expressionParser: FilterExpressionParser | null = null;\r\n    private isApplyDisabled = true;\r\n    private builderOpen = false;\r\n    private tooltipFeature?: TooltipFeature;\r\n\r\n    constructor() {\r\n        super(\r\n            /* html */ `\r\n            <div class=\"ag-advanced-filter\" role=\"presentation\" tabindex=\"-1\">\r\n                <ag-autocomplete data-ref=\"eAutocomplete\"></ag-autocomplete>\r\n                <button class=\"ag-button ag-standard-button ag-advanced-filter-apply-button\" data-ref=\"eApplyFilterButton\"></button>\r\n                <button class=\"ag-button ag-advanced-filter-builder-button\" data-ref=\"eBuilderFilterButton\">\r\n                    <span data-ref=\"eBuilderFilterButtonIcon\" aria-hidden=\"true\"></span>\r\n                    <span class=\"ag-advanced-filter-builder-button-label\" data-ref=\"eBuilderFilterButtonLabel\"></span>\r\n                </button>\r\n            </div>`,\r\n            [AgAutocompleteSelector]\r\n        );\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.tooltipFeature = this.createOptionalManagedBean(\r\n            this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.getGui(),\r\n                getTooltipShowDelayOverride: () => 1000,\r\n                getLocation: () => 'advancedFilter',\r\n            } as ITooltipCtrl)\r\n        );\r\n        this.eAutocomplete\r\n            .setListGenerator((_value, position) => this.generateAutocompleteListParams(position))\r\n            .setValidator(() => this.validateValue())\r\n            .setForceLastSelection((lastSelection, searchString) =>\r\n                this.forceLastSelection(lastSelection, searchString)\r\n            )\r\n            .setInputAriaLabel(this.advFilterExpSvc.translate('ariaAdvancedFilterInput'))\r\n            .setListAriaLabel(this.advFilterExpSvc.translate('ariaLabelAdvancedFilterAutocomplete'));\r\n\r\n        this.refresh();\r\n\r\n        this.addManagedListeners(this.eAutocomplete, {\r\n            eventValueChanged: ({ value }: AutocompleteValueChangedEvent) => this.onValueChanged(value),\r\n            eventValueConfirmed: ({ isValid }: AutocompleteValueConfirmedEvent) => this.onValueConfirmed(isValid),\r\n            eventOptionSelected: ({ position, updateEntry, autocompleteType }: AutocompleteOptionSelectedEvent) =>\r\n                this.onOptionSelected(position, updateEntry, autocompleteType),\r\n            eventValidChanged: ({ isValid, validationMessage }: AutocompleteValidChangedEvent) =>\r\n                this.onValidChanged(isValid, validationMessage),\r\n        });\r\n\r\n        this.setupApplyButton();\r\n        this.setupBuilderButton();\r\n    }\r\n\r\n    public refresh(): void {\r\n        const expression = this.advancedFilter.getExpressionDisplayValue();\r\n        this.eAutocomplete.setValue({\r\n            value: expression ?? '',\r\n            position: expression?.length,\r\n            updateListOnlyIfOpen: true,\r\n        });\r\n    }\r\n\r\n    public setInputDisabled(disabled: boolean): void {\r\n        this.eAutocomplete.setInputDisabled(disabled);\r\n        _setDisabled(this.eApplyFilterButton, disabled || this.isApplyDisabled);\r\n    }\r\n\r\n    private setupApplyButton(): void {\r\n        this.eApplyFilterButton.innerText = this.advFilterExpSvc.translate('advancedFilterApply');\r\n        this.activateTabIndex([this.eApplyFilterButton]);\r\n        this.addManagedElementListeners(this.eApplyFilterButton, {\r\n            click: () => this.onValueConfirmed(this.eAutocomplete.isValid()),\r\n        });\r\n        _setDisabled(this.eApplyFilterButton, this.isApplyDisabled);\r\n    }\r\n\r\n    private setupBuilderButton(): void {\r\n        this.eBuilderFilterButtonIcon.appendChild(_createIconNoSpan('advancedFilterBuilder', this.beans)!);\r\n        this.eBuilderFilterButtonLabel.innerText = this.advFilterExpSvc.translate('advancedFilterBuilder');\r\n        this.activateTabIndex([this.eBuilderFilterButton]);\r\n        this.addManagedElementListeners(this.eBuilderFilterButton, { click: () => this.openBuilder() });\r\n        this.addManagedListeners(this.advancedFilter.getCtrl(), {\r\n            advancedFilterBuilderClosed: () => this.closeBuilder(),\r\n        });\r\n    }\r\n\r\n    private onValueChanged(value: string | null): void {\r\n        value = _makeNull(value);\r\n        this.advancedFilter.setExpressionDisplayValue(value);\r\n        this.expressionParser = this.advancedFilter.createExpressionParser(value);\r\n        const updatedExpression = this.expressionParser?.parseExpression();\r\n        if (updatedExpression && updatedExpression !== value) {\r\n            this.eAutocomplete.setValue({ value: updatedExpression, silent: true, restoreFocus: true });\r\n        }\r\n    }\r\n\r\n    private onValueConfirmed(isValid: boolean): void {\r\n        if (!isValid || this.isApplyDisabled) {\r\n            return;\r\n        }\r\n        _setDisabled(this.eApplyFilterButton, true);\r\n        this.advancedFilter.applyExpression();\r\n        this.filterManager?.onFilterChanged({ source: 'advancedFilter' });\r\n    }\r\n\r\n    private onOptionSelected(position: number, updateEntry: AutocompleteEntry, type?: string): void {\r\n        const { updatedValue, updatedPosition, hideAutocomplete } = this.updateExpression(position, updateEntry, type);\r\n        this.eAutocomplete.setValue({\r\n            value: updatedValue,\r\n            position: updatedPosition,\r\n            updateListOnlyIfOpen: hideAutocomplete,\r\n            restoreFocus: true,\r\n        });\r\n    }\r\n\r\n    private validateValue(): string | null {\r\n        return this.expressionParser?.isValid() ? null : this.expressionParser?.getValidationMessage() ?? null;\r\n    }\r\n\r\n    private onValidChanged(isValid: boolean, validationMessage: string | null): void {\r\n        this.isApplyDisabled = !isValid || this.advancedFilter.isCurrentExpressionApplied();\r\n        _setDisabled(this.eApplyFilterButton, this.isApplyDisabled);\r\n        this.tooltipFeature?.setTooltipAndRefresh(validationMessage);\r\n    }\r\n\r\n    private generateAutocompleteListParams(position: number): AutocompleteListParams {\r\n        return this.expressionParser\r\n            ? this.expressionParser.getAutocompleteListParams(position)\r\n            : this.advFilterExpSvc.getDefaultAutocompleteListParams('');\r\n    }\r\n\r\n    private updateExpression(position: number, updateEntry: AutocompleteEntry, type?: string): AutocompleteUpdate {\r\n        this.advFilterExpSvc.updateAutocompleteCache(updateEntry, type);\r\n        return (\r\n            this.expressionParser?.updateExpression(position, updateEntry, type) ??\r\n            this.advancedFilter.getDefaultExpression(updateEntry)\r\n        );\r\n    }\r\n\r\n    private forceLastSelection({ key, displayValue }: AutocompleteEntry, searchString: string): boolean {\r\n        return !!searchString.toLocaleLowerCase().match(`^${(displayValue ?? key).toLocaleLowerCase()}\\\\s*$`);\r\n    }\r\n\r\n    private openBuilder(): void {\r\n        if (this.builderOpen) {\r\n            return;\r\n        }\r\n        this.builderOpen = true;\r\n        _setDisabled(this.eBuilderFilterButton, true);\r\n        this.advancedFilter.getCtrl().toggleFilterBuilder({ source: 'ui', eventSource: this.eBuilderFilterButton });\r\n    }\r\n\r\n    private closeBuilder(): void {\r\n        if (!this.builderOpen) {\r\n            return;\r\n        }\r\n        this.builderOpen = false;\r\n        _setDisabled(this.eBuilderFilterButton, false);\r\n        this.eBuilderFilterButton.focus();\r\n    }\r\n}\r\n", "import type {\r\n    AgEvent,\r\n    AgInputTextField,\r\n    BeanCollection,\r\n    ComponentSelector,\r\n    PopupPositionParams,\r\n    PopupService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgInputTextFieldSelector,\r\n    Component,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    _isNothingFocused,\r\n    _makeNull,\r\n} from 'ag-grid-community';\r\n\r\nimport { agAutocompleteCSS } from './agAutocomplete.css-GENERATED';\r\nimport { AgAutocompleteList } from './agAutocompleteList';\r\nimport type { AutocompleteEntry, AutocompleteListParams } from './autocompleteParams';\r\n\r\ninterface AutoCompleteEvent<T extends AgAutocompleteEvent> extends AgEvent<T> {\r\n    value: string | null;\r\n}\r\n\r\nexport interface AutocompleteValueChangedEvent extends AutoCompleteEvent<'eventValueChanged'> {}\r\n\r\nexport interface AutocompleteValueConfirmedEvent extends AutoCompleteEvent<'eventValueConfirmed'> {\r\n    isValid: boolean;\r\n}\r\n\r\nexport interface AutocompleteOptionSelectedEvent extends AutoCompleteEvent<'eventOptionSelected'> {\r\n    position: number;\r\n    updateEntry: AutocompleteEntry;\r\n    autocompleteType?: string;\r\n}\r\n\r\nexport interface AutocompleteValidChangedEvent extends AgEvent<'eventValidChanged'> {\r\n    isValid: boolean;\r\n    validationMessage: string | null;\r\n}\r\n\r\nexport type AgAutocompleteEvent =\r\n    | 'eventValueChanged'\r\n    | 'eventValueConfirmed'\r\n    | 'eventOptionSelected'\r\n    | 'eventValidChanged';\r\nexport class AgAutocomplete extends Component<AgAutocompleteEvent> {\r\n    private popupSvc: PopupService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.popupSvc = beans.popupSvc!;\r\n    }\r\n\r\n    private eAutocompleteInput: AgInputTextField = RefPlaceholder;\r\n\r\n    private isListOpen = false;\r\n    private autocompleteList: AgAutocompleteList | null;\r\n    private hidePopup: () => void;\r\n    private autocompleteListParams: AutocompleteListParams;\r\n    private lastPosition: number = 0;\r\n    private valid: boolean = true;\r\n    private validationMessage: string | null;\r\n    private listAriaLabel: string;\r\n    private listGenerator?: (value: string | null, position: number) => AutocompleteListParams;\r\n    private validator?: (value: string | null) => string | null;\r\n    private forceLastSelection?: (lastSelection: AutocompleteEntry, searchString: string) => boolean;\r\n\r\n    constructor() {\r\n        super(\r\n            /* html */ `\r\n            <div class=\"ag-autocomplete\" role=\"presentation\">\r\n                <ag-input-text-field data-ref=\"eAutocompleteInput\"></ag-input-text-field>\r\n            </div>`,\r\n            [AgInputTextFieldSelector]\r\n        );\r\n        this.registerCSS(agAutocompleteCSS);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.eAutocompleteInput.onValueChange((value) => this.onValueChanged(value));\r\n        this.eAutocompleteInput.getInputElement().setAttribute('autocomplete', 'off');\r\n\r\n        this.addGuiEventListener('keydown', this.onKeyDown.bind(this));\r\n\r\n        this.addGuiEventListener('click', this.updatePositionAndList.bind(this));\r\n\r\n        this.addDestroyFunc(() => {\r\n            this.destroyBean(this.autocompleteList);\r\n        });\r\n\r\n        this.addGuiEventListener('focusout', () => this.onFocusOut());\r\n    }\r\n\r\n    private onValueChanged(value?: string | null): void {\r\n        const parsedValue = _makeNull(value);\r\n        this.updateValue(parsedValue);\r\n        this.updateAutocompleteList(parsedValue);\r\n    }\r\n\r\n    private updateValue(value: string | null): void {\r\n        this.updateLastPosition();\r\n        this.dispatchLocalEvent<AutocompleteValueChangedEvent>({\r\n            type: 'eventValueChanged',\r\n            value,\r\n        });\r\n        this.validate(value);\r\n    }\r\n\r\n    private updateAutocompleteList(value: string | null): void {\r\n        const autocompleteListParams = this.listGenerator?.(value, this.lastPosition) ?? { enabled: false };\r\n        const isListOpen = this.isListOpen;\r\n        if (!autocompleteListParams.type || autocompleteListParams.type !== this.autocompleteListParams?.type) {\r\n            if (isListOpen) {\r\n                this.closeList();\r\n            }\r\n        }\r\n        this.autocompleteListParams = autocompleteListParams;\r\n        if (autocompleteListParams?.enabled) {\r\n            if (!isListOpen) {\r\n                this.openList();\r\n            }\r\n            const { searchString } = autocompleteListParams;\r\n            this.autocompleteList?.setSearch(searchString ?? '');\r\n        } else {\r\n            if (isListOpen) {\r\n                this.closeList();\r\n            }\r\n        }\r\n    }\r\n\r\n    private onKeyDown(event: KeyboardEvent): void {\r\n        const key = event.key;\r\n\r\n        this.updateLastPosition();\r\n\r\n        switch (key) {\r\n            case KeyCode.ENTER:\r\n                this.onEnterKeyDown(event);\r\n                break;\r\n            case KeyCode.TAB:\r\n                this.onTabKeyDown(event);\r\n                break;\r\n            case KeyCode.DOWN:\r\n            case KeyCode.UP:\r\n                this.onUpDownKeyDown(event, key);\r\n                break;\r\n            case KeyCode.LEFT:\r\n            case KeyCode.RIGHT:\r\n            case KeyCode.PAGE_HOME:\r\n            case KeyCode.PAGE_END:\r\n                // input position is updated after this is called, so do async\r\n                setTimeout(() => {\r\n                    this.updatePositionAndList();\r\n                });\r\n                break;\r\n            case KeyCode.ESCAPE:\r\n                this.onEscapeKeyDown(event);\r\n                break;\r\n            case KeyCode.SPACE:\r\n                if (event.ctrlKey && !this.isListOpen) {\r\n                    event.preventDefault();\r\n                    this.forceOpenList();\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    private confirmSelection(): void {\r\n        const selectedValue = this.autocompleteList?.getSelectedValue();\r\n        if (selectedValue) {\r\n            this.closeList();\r\n            this.dispatchLocalEvent<AutocompleteOptionSelectedEvent>({\r\n                type: 'eventOptionSelected',\r\n                value: this.getValue()!,\r\n                position: this.lastPosition,\r\n                updateEntry: selectedValue,\r\n                autocompleteType: this.autocompleteListParams.type,\r\n            });\r\n        }\r\n    }\r\n\r\n    private onTabKeyDown(event: KeyboardEvent): void {\r\n        if (this.isListOpen) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            this.confirmSelection();\r\n        }\r\n    }\r\n\r\n    private onEnterKeyDown(event: KeyboardEvent): void {\r\n        event.preventDefault();\r\n        if (this.isListOpen) {\r\n            this.confirmSelection();\r\n        } else {\r\n            this.onCompleted();\r\n        }\r\n    }\r\n\r\n    private onUpDownKeyDown(event: KeyboardEvent, key: string): void {\r\n        event.preventDefault();\r\n        if (!this.isListOpen) {\r\n            this.forceOpenList();\r\n        } else {\r\n            this.autocompleteList?.onNavigationKeyDown(event, key);\r\n        }\r\n    }\r\n\r\n    private onEscapeKeyDown(event: KeyboardEvent): void {\r\n        if (this.isListOpen) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            this.closeList();\r\n            this.setCaret(this.lastPosition, true);\r\n        }\r\n    }\r\n\r\n    private onFocusOut(): void {\r\n        if (this.isListOpen) {\r\n            this.closeList();\r\n        }\r\n    }\r\n\r\n    private updatePositionAndList(): void {\r\n        this.updateLastPosition();\r\n        this.updateAutocompleteList(this.eAutocompleteInput.getValue() ?? null);\r\n    }\r\n\r\n    private setCaret(position: number, setFocus?: boolean): void {\r\n        if (setFocus && _isNothingFocused(this.beans)) {\r\n            // clicking on the list loses focus, so restore\r\n            this.eAutocompleteInput.getFocusableElement().focus();\r\n        }\r\n        const eInput = this.eAutocompleteInput.getInputElement();\r\n        eInput.setSelectionRange(position, position);\r\n        if (position === eInput.value.length) {\r\n            // ensure the caret is visible\r\n            eInput.scrollLeft = eInput.scrollWidth;\r\n        }\r\n    }\r\n\r\n    private forceOpenList(): void {\r\n        this.onValueChanged(this.eAutocompleteInput.getValue());\r\n    }\r\n\r\n    private updateLastPosition(): void {\r\n        this.lastPosition = this.eAutocompleteInput.getInputElement().selectionStart ?? 0;\r\n    }\r\n\r\n    private validate(value: string | null): void {\r\n        if (!this.validator) {\r\n            return;\r\n        }\r\n        const validationMessage = (this.validationMessage = this.validator(value));\r\n        this.eAutocompleteInput.getInputElement().setCustomValidity(validationMessage ?? '');\r\n        this.valid = !validationMessage;\r\n        this.dispatchLocalEvent<AutocompleteValidChangedEvent>({\r\n            type: 'eventValidChanged',\r\n            isValid: this.valid,\r\n            validationMessage,\r\n        });\r\n    }\r\n\r\n    private openList(): void {\r\n        this.isListOpen = true;\r\n        // this is unmanaged as it gets destroyed/created each time it is opened\r\n        this.autocompleteList = this.createBean(\r\n            new AgAutocompleteList({\r\n                autocompleteEntries: this.autocompleteListParams.entries!,\r\n                onConfirmed: () => this.confirmSelection(),\r\n                forceLastSelection: this.forceLastSelection,\r\n            })\r\n        );\r\n        const ePopupGui = this.autocompleteList.getGui();\r\n\r\n        const positionParams: PopupPositionParams & { type: string; eventSource: HTMLElement } = {\r\n            ePopup: ePopupGui,\r\n            type: 'autocomplete',\r\n            eventSource: this.getGui(),\r\n            position: 'under',\r\n            alignSide: this.gos.get('enableRtl') ? 'right' : 'left',\r\n            keepWithinBounds: true,\r\n        };\r\n\r\n        const addPopupRes = this.popupSvc.addPopup({\r\n            eChild: ePopupGui,\r\n            anchorToElement: this.getGui(),\r\n            positionCallback: () => this.popupSvc.positionPopupByComponent(positionParams),\r\n            ariaLabel: this.listAriaLabel,\r\n        });\r\n        this.hidePopup = addPopupRes.hideFunc;\r\n\r\n        this.autocompleteList.afterGuiAttached();\r\n    }\r\n\r\n    private closeList(): void {\r\n        this.isListOpen = false;\r\n        this.hidePopup();\r\n        this.destroyBean(this.autocompleteList);\r\n        this.autocompleteList = null;\r\n    }\r\n\r\n    private onCompleted(): void {\r\n        if (this.isListOpen) {\r\n            this.closeList();\r\n        }\r\n        this.dispatchLocalEvent<AutocompleteValueConfirmedEvent>({\r\n            type: 'eventValueConfirmed',\r\n            value: this.getValue(),\r\n            isValid: this.isValid(),\r\n        });\r\n    }\r\n\r\n    public getValue(): string | null {\r\n        return _makeNull(this.eAutocompleteInput.getValue());\r\n    }\r\n\r\n    public setInputPlaceholder(placeholder: string): this {\r\n        this.eAutocompleteInput.setInputPlaceholder(placeholder);\r\n        return this;\r\n    }\r\n\r\n    public setInputAriaLabel(label?: string | null): this {\r\n        this.eAutocompleteInput.setInputAriaLabel(label);\r\n        return this;\r\n    }\r\n\r\n    public setListAriaLabel(label: string): this {\r\n        this.listAriaLabel = label;\r\n        return this;\r\n    }\r\n\r\n    public setListGenerator(listGenerator?: (value: string | null, position: number) => AutocompleteListParams): this {\r\n        this.listGenerator = listGenerator;\r\n        return this;\r\n    }\r\n\r\n    public setValidator(validator?: (value: string | null) => string | null): this {\r\n        this.validator = validator;\r\n        return this;\r\n    }\r\n\r\n    public isValid(): boolean {\r\n        return this.valid;\r\n    }\r\n\r\n    public setValue(params: {\r\n        value: string;\r\n        position?: number;\r\n        silent?: boolean;\r\n        updateListOnlyIfOpen?: boolean;\r\n        restoreFocus?: boolean;\r\n    }): void {\r\n        const { value, position, silent, updateListOnlyIfOpen, restoreFocus } = params;\r\n        this.eAutocompleteInput.setValue(value, true);\r\n        this.setCaret(position ?? this.lastPosition, restoreFocus);\r\n        if (!silent) {\r\n            this.updateValue(value);\r\n        }\r\n        if (!updateListOnlyIfOpen || this.isListOpen) {\r\n            this.updateAutocompleteList(value);\r\n        }\r\n    }\r\n\r\n    public setForceLastSelection(\r\n        forceLastSelection?: (lastSelection: AutocompleteEntry, searchString: string) => boolean\r\n    ): this {\r\n        this.forceLastSelection = forceLastSelection;\r\n        return this;\r\n    }\r\n\r\n    public setInputDisabled(disabled: boolean): this {\r\n        this.eAutocompleteInput.setDisabled(disabled);\r\n        return this;\r\n    }\r\n}\r\n\r\nexport const AgAutocompleteSelector: ComponentSelector = {\r\n    selector: 'AG-AUTOCOMPLETE',\r\n    component: AgAutocomplete,\r\n};\r\n", "export const agAutocompleteCSS = /*css*/ `.ag-autocomplete{align-items:center;display:flex;width:100%;>*{flex:1 1 auto}}.ag-autocomplete-list-popup{background-color:var(--ag-background-color);border-radius:var(--ag-border-radius);box-shadow:var(--ag-dropdown-shadow);padding:0;position:absolute;-webkit-user-select:none;-moz-user-select:none;user-select:none}.ag-autocomplete-list{height:calc(var(--ag-row-height)*6.5);min-width:200px;position:relative;width:100%}.ag-autocomplete-virtual-list-item{cursor:default;display:flex;height:var(--ag-list-item-height);&:focus-visible:after{content:none}&:hover{background-color:var(--ag-row-hover-color)}}.ag-autocomplete-row{align-items:center;display:flex;flex:1 1 auto;overflow:hidden}.ag-autocomplete-row-label{margin:0 var(--ag-widget-container-horizontal-padding);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ag-autocomplete-row-selected{background-color:var(--ag-selected-row-background-color)}`;\n", "import type { Component } from 'ag-grid-community';\r\nimport { KeyCode, PopupComponent, RefPlaceholder, _exists, _fuzzySuggestions } from 'ag-grid-community';\r\n\r\nimport { VirtualList } from '../../widgets/virtualList';\r\nimport { AgAutocompleteRow } from './agAutocompleteRow';\r\nimport type { AutocompleteEntry } from './autocompleteParams';\r\n\r\nexport class AgAutocompleteList extends PopupComponent {\r\n    private readonly eList: HTMLElement = RefPlaceholder;\r\n\r\n    private virtualList: VirtualList<any>;\r\n\r\n    private autocompleteEntries: AutocompleteEntry[];\r\n\r\n    // as the user moves the mouse, the selectedValue changes\r\n    private selectedValue: AutocompleteEntry;\r\n\r\n    private searchString = '';\r\n\r\n    constructor(\r\n        private params: {\r\n            autocompleteEntries: AutocompleteEntry[];\r\n            onConfirmed: () => void;\r\n            useFuzzySearch?: boolean;\r\n            forceLastSelection?: (lastSelection: AutocompleteEntry, searchString: string) => boolean;\r\n        }\r\n    ) {\r\n        super(/* html */ `<div class=\"ag-autocomplete-list-popup\">\r\n            <div data-ref=\"eList\" class=\"ag-autocomplete-list\"></div>\r\n        <div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.autocompleteEntries = this.params.autocompleteEntries;\r\n        this.virtualList = this.createManagedBean(new VirtualList({ cssIdentifier: 'autocomplete' }));\r\n        this.virtualList.setComponentCreator(this.createRowComponent.bind(this));\r\n        this.eList.appendChild(this.virtualList.getGui());\r\n\r\n        this.virtualList.setModel({\r\n            getRowCount: () => this.autocompleteEntries.length,\r\n            getRow: (index: number) => this.autocompleteEntries[index],\r\n        });\r\n\r\n        const virtualListGui = this.virtualList.getGui();\r\n\r\n        this.addManagedListeners(virtualListGui, {\r\n            click: () => this.params.onConfirmed(),\r\n            mousemove: this.onMouseMove.bind(this),\r\n            mousedown: (e) => e.preventDefault(),\r\n        });\r\n\r\n        this.setSelectedValue(0);\r\n    }\r\n\r\n    public onNavigationKeyDown(event: any, key: string): void {\r\n        // if we don't preventDefault the page body and/or grid scroll will move.\r\n        event.preventDefault();\r\n        const oldIndex = this.autocompleteEntries.indexOf(this.selectedValue);\r\n        const newIndex = key === KeyCode.UP ? oldIndex - 1 : oldIndex + 1;\r\n\r\n        this.checkSetSelectedValue(newIndex);\r\n    }\r\n\r\n    public setSearch(searchString: string): void {\r\n        this.searchString = searchString;\r\n        if (_exists(searchString)) {\r\n            this.runSearch();\r\n        } else {\r\n            // reset\r\n            this.autocompleteEntries = this.params.autocompleteEntries;\r\n            this.virtualList.refresh();\r\n            this.checkSetSelectedValue(0);\r\n        }\r\n        this.updateSearchInList();\r\n    }\r\n\r\n    private runContainsSearch(\r\n        searchString: string,\r\n        searchStrings: string[]\r\n    ): { topMatch: string | undefined; allMatches: string[] } {\r\n        let topMatch: string | undefined;\r\n        let topMatchStartsWithSearchString = false;\r\n        const lowerCaseSearchString = searchString.toLocaleLowerCase();\r\n        const allMatches = searchStrings.filter((string) => {\r\n            const lowerCaseString = string.toLocaleLowerCase();\r\n            const index = lowerCaseString.indexOf(lowerCaseSearchString);\r\n            const startsWithSearchString = index === 0;\r\n            const isMatch = index >= 0;\r\n            // top match is shortest value that starts with the search string, otherwise shortest value that includes the search string\r\n            if (\r\n                isMatch &&\r\n                (!topMatch ||\r\n                    (!topMatchStartsWithSearchString && startsWithSearchString) ||\r\n                    (topMatchStartsWithSearchString === startsWithSearchString && string.length < topMatch.length))\r\n            ) {\r\n                topMatch = string;\r\n                topMatchStartsWithSearchString = startsWithSearchString;\r\n            }\r\n            return isMatch;\r\n        });\r\n        if (!topMatch && allMatches.length) {\r\n            topMatch = allMatches[0];\r\n        }\r\n        return { topMatch, allMatches };\r\n    }\r\n\r\n    private runSearch() {\r\n        const { autocompleteEntries, useFuzzySearch, forceLastSelection } = this.params;\r\n        const searchStrings = autocompleteEntries.map((v) => v.displayValue ?? v.key);\r\n\r\n        let matchingStrings: string[];\r\n        let topSuggestion: string | undefined;\r\n        if (useFuzzySearch) {\r\n            matchingStrings = _fuzzySuggestions({\r\n                inputValue: this.searchString,\r\n                allSuggestions: searchStrings,\r\n                hideIrrelevant: true,\r\n                addSequentialWeight: true,\r\n            }).values;\r\n            topSuggestion = matchingStrings.length ? matchingStrings[0] : undefined;\r\n        } else {\r\n            const containsMatches = this.runContainsSearch(this.searchString, searchStrings);\r\n            matchingStrings = containsMatches.allMatches;\r\n            topSuggestion = containsMatches.topMatch;\r\n        }\r\n\r\n        let filteredEntries = autocompleteEntries.filter(({ key, displayValue }) =>\r\n            matchingStrings.includes(displayValue ?? key)\r\n        );\r\n        if (\r\n            !filteredEntries.length &&\r\n            this.selectedValue &&\r\n            forceLastSelection?.(this.selectedValue, this.searchString)\r\n        ) {\r\n            filteredEntries = [this.selectedValue];\r\n        }\r\n        this.autocompleteEntries = filteredEntries;\r\n        this.virtualList.refresh();\r\n\r\n        if (!topSuggestion) {\r\n            return;\r\n        }\r\n\r\n        const topSuggestionIndex = matchingStrings.indexOf(topSuggestion);\r\n\r\n        this.checkSetSelectedValue(topSuggestionIndex);\r\n    }\r\n\r\n    private updateSearchInList(): void {\r\n        this.virtualList.forEachRenderedRow((row: AgAutocompleteRow) => row.setSearchString(this.searchString));\r\n    }\r\n\r\n    private checkSetSelectedValue(index: number): void {\r\n        if (index >= 0 && index < this.autocompleteEntries.length) {\r\n            this.setSelectedValue(index);\r\n        }\r\n    }\r\n\r\n    private setSelectedValue(index: number): void {\r\n        const value = this.autocompleteEntries[index];\r\n\r\n        if (this.selectedValue === value) {\r\n            return;\r\n        }\r\n\r\n        this.selectedValue = value;\r\n        this.virtualList.ensureIndexVisible(index);\r\n\r\n        this.virtualList.forEachRenderedRow((cmp: AgAutocompleteRow, idx: number) => {\r\n            cmp.updateSelected(index === idx);\r\n        });\r\n    }\r\n\r\n    private createRowComponent(value: AutocompleteEntry): Component {\r\n        const row = new AgAutocompleteRow();\r\n\r\n        this.createBean(row);\r\n        row.setState(value.displayValue ?? value.key, value === this.selectedValue);\r\n\r\n        return row;\r\n    }\r\n\r\n    private onMouseMove(mouseEvent: MouseEvent): void {\r\n        const virtualList = this.virtualList;\r\n        const rect = virtualList.getGui().getBoundingClientRect();\r\n        const scrollTop = virtualList.getScrollTop();\r\n        const mouseY = mouseEvent.clientY - rect.top + scrollTop;\r\n        const row = Math.floor(mouseY / virtualList.getRowHeight());\r\n\r\n        this.checkSetSelectedValue(row);\r\n    }\r\n\r\n    public afterGuiAttached(): void {\r\n        this.virtualList.refresh();\r\n    }\r\n\r\n    public getSelectedValue(): AutocompleteEntry | null {\r\n        if (!this.autocompleteEntries.length) {\r\n            return null;\r\n        }\r\n        return this.selectedValue ?? null;\r\n    }\r\n}\r\n", "import type { BeanCollection, Component, ComponentEvent, CssVariablesChanged, Environment } from 'ag-grid-community';\r\nimport {\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    TabGuardComp,\r\n    _getAriaPosInSet,\r\n    _observeResize,\r\n    _requestAnimationFrame,\r\n    _setAriaLabel,\r\n    _setAriaPosInSet,\r\n    _setAriaRole,\r\n    _setAriaSetSize,\r\n    _stopPropagationForAgGrid,\r\n    _waitUntil,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { VirtualListModel } from './iVirtualList';\r\n\r\ninterface VirtualListParams {\r\n    cssIdentifier?: string;\r\n    ariaRole?: string;\r\n    listName?: string;\r\n}\r\n\r\nfunction getVirtualListTemplate(cssIdentifier: string) {\r\n    return (\r\n        /* html */\r\n        `<div class=\"ag-virtual-list-viewport ag-${cssIdentifier}-virtual-list-viewport\" role=\"presentation\">\r\n            <div class=\"ag-virtual-list-container ag-${cssIdentifier}-virtual-list-container\" data-ref=\"eContainer\"></div>\r\n        </div>`\r\n    );\r\n}\r\n\r\nexport class VirtualList<\r\n    C extends Component<any> = Component<any>,\r\n    TEventType extends string = ComponentEvent,\r\n> extends TabGuardComp<TEventType> {\r\n    private environment: Environment;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.environment = beans.environment;\r\n    }\r\n\r\n    private readonly cssIdentifier: string;\r\n    private readonly ariaRole: string;\r\n    private listName?: string;\r\n\r\n    private model: VirtualListModel;\r\n    private renderedRows = new Map<number, { rowComponent: C; eDiv: HTMLDivElement; value: any }>();\r\n    private componentCreator: (value: any, listItemElement: HTMLElement) => C;\r\n    private componentUpdater: (value: any, component: C) => void;\r\n    private rowHeight = 20;\r\n    private pageSize = -1;\r\n    private isScrolling = false;\r\n    private lastFocusedRowIndex: number | null;\r\n    private isHeightFromTheme: boolean = true;\r\n    private readonly eContainer: HTMLElement = RefPlaceholder;\r\n    private awaitStableCallbacks: (() => void)[] = [];\r\n\r\n    constructor(params?: VirtualListParams) {\r\n        super(getVirtualListTemplate(params?.cssIdentifier || 'default'));\r\n\r\n        const { cssIdentifier = 'default', ariaRole = 'listbox', listName } = params || {};\r\n\r\n        this.cssIdentifier = cssIdentifier;\r\n        this.ariaRole = ariaRole;\r\n        this.listName = listName;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.addScrollListener();\r\n        this.rowHeight = this.getItemHeight();\r\n        this.addResizeObserver();\r\n\r\n        this.initialiseTabGuard({\r\n            onFocusIn: (e: FocusEvent) => this.onFocusIn(e),\r\n            onFocusOut: (e: FocusEvent) => this.onFocusOut(e),\r\n            focusInnerElement: (fromBottom: boolean) => this.focusInnerElement(fromBottom),\r\n            onTabKeyDown: (e) => this.onTabKeyDown(e),\r\n            handleKeyDown: (e) => this.handleKeyDown(e),\r\n        });\r\n\r\n        this.setAriaProperties();\r\n        this.addManagedEventListeners({ gridStylesChanged: this.onGridStylesChanged.bind(this) });\r\n    }\r\n\r\n    private onGridStylesChanged(e: CssVariablesChanged): void {\r\n        if (e.listItemHeightChanged) {\r\n            this.rowHeight = this.getItemHeight();\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    private setAriaProperties(): void {\r\n        const translate = this.getLocaleTextFunc();\r\n        const listName = translate('ariaDefaultListName', this.listName || 'List');\r\n        const ariaEl = this.eContainer;\r\n\r\n        _setAriaRole(ariaEl, this.ariaRole);\r\n        _setAriaLabel(ariaEl, listName);\r\n    }\r\n\r\n    private addResizeObserver(): void {\r\n        // do this in an animation frame to prevent loops\r\n        const listener = () => _requestAnimationFrame(this.beans, () => this.drawVirtualRows());\r\n        const destroyObserver = _observeResize(this.beans, this.getGui(), listener);\r\n        this.addDestroyFunc(destroyObserver);\r\n    }\r\n\r\n    protected focusInnerElement(fromBottom: boolean): void {\r\n        this.focusRow(fromBottom ? this.model.getRowCount() - 1 : 0);\r\n    }\r\n\r\n    protected onFocusIn(e: FocusEvent): void {\r\n        const target = e.target as HTMLElement;\r\n\r\n        if (target.classList.contains('ag-virtual-list-item')) {\r\n            this.lastFocusedRowIndex = _getAriaPosInSet(target) - 1;\r\n        }\r\n    }\r\n\r\n    protected onFocusOut(e: FocusEvent): void {\r\n        if (!this.getFocusableElement().contains(e.relatedTarget as HTMLElement)) {\r\n            this.lastFocusedRowIndex = null;\r\n        }\r\n    }\r\n\r\n    protected handleKeyDown(e: KeyboardEvent): void {\r\n        switch (e.key) {\r\n            case KeyCode.UP:\r\n            case KeyCode.DOWN:\r\n                e.preventDefault();\r\n                this.navigate(e.key === KeyCode.UP);\r\n                break;\r\n            case KeyCode.PAGE_HOME:\r\n            case KeyCode.PAGE_END:\r\n            case KeyCode.PAGE_UP:\r\n            case KeyCode.PAGE_DOWN:\r\n                if (this.navigateToPage(e.key) !== null) {\r\n                    e.preventDefault();\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    protected onTabKeyDown(e: KeyboardEvent): void {\r\n        _stopPropagationForAgGrid(e);\r\n        this.forceFocusOutOfContainer(e.shiftKey);\r\n    }\r\n\r\n    private navigate(up: boolean): void {\r\n        if (this.lastFocusedRowIndex == null) {\r\n            return;\r\n        }\r\n\r\n        const nextRow = this.lastFocusedRowIndex + (up ? -1 : 1);\r\n\r\n        if (nextRow < 0 || nextRow >= this.model.getRowCount()) {\r\n            return;\r\n        }\r\n\r\n        this.focusRow(nextRow);\r\n    }\r\n\r\n    public navigateToPage(\r\n        key: 'Home' | 'PageUp' | 'PageDown' | 'End',\r\n        fromItem: number | 'focused' = 'focused'\r\n    ): number | null {\r\n        let hasFocus = false;\r\n\r\n        if (fromItem === 'focused') {\r\n            fromItem = this.getLastFocusedRow() as number;\r\n            hasFocus = true;\r\n        }\r\n\r\n        const rowCount = this.model.getRowCount() - 1;\r\n\r\n        let newIndex = -1;\r\n\r\n        if (key === KeyCode.PAGE_HOME) {\r\n            newIndex = 0;\r\n        } else if (key === KeyCode.PAGE_END) {\r\n            newIndex = rowCount;\r\n        } else if (key === KeyCode.PAGE_DOWN) {\r\n            newIndex = Math.min(fromItem + this.pageSize, rowCount);\r\n        } else if (key === KeyCode.PAGE_UP) {\r\n            newIndex = Math.max(fromItem - this.pageSize, 0);\r\n        }\r\n\r\n        if (newIndex === -1) {\r\n            return null;\r\n        }\r\n\r\n        if (hasFocus) {\r\n            this.focusRow(newIndex);\r\n        } else {\r\n            this.ensureIndexVisible(newIndex);\r\n        }\r\n\r\n        return newIndex;\r\n    }\r\n\r\n    public getLastFocusedRow(): number | null {\r\n        return this.lastFocusedRowIndex;\r\n    }\r\n\r\n    public focusRow(rowNumber: number): void {\r\n        if (this.isScrolling) {\r\n            return;\r\n        }\r\n        this.isScrolling = true;\r\n\r\n        this.ensureIndexVisible(rowNumber);\r\n\r\n        _requestAnimationFrame(this.beans, () => {\r\n            this.isScrolling = false;\r\n            if (!this.isAlive()) {\r\n                return;\r\n            }\r\n            const renderedRow = this.renderedRows.get(rowNumber);\r\n\r\n            if (renderedRow) {\r\n                renderedRow.eDiv.focus();\r\n            }\r\n        });\r\n    }\r\n\r\n    public getComponentAt(rowIndex: number): C | undefined {\r\n        const comp = this.renderedRows.get(rowIndex);\r\n\r\n        return comp && comp.rowComponent;\r\n    }\r\n\r\n    public forEachRenderedRow(func: (comp: C, idx: number) => void): void {\r\n        this.renderedRows.forEach((value, key) => func(value.rowComponent, key));\r\n    }\r\n\r\n    private getItemHeight(): number {\r\n        if (!this.isHeightFromTheme) {\r\n            return this.rowHeight;\r\n        }\r\n        return this.environment.getDefaultListItemHeight();\r\n    }\r\n\r\n    /**\r\n     * Returns true if the view had to be scrolled, otherwise, false.\r\n     */\r\n    public ensureIndexVisible(index: number, scrollPartialIntoView: boolean = true): boolean {\r\n        const lastRow = this.model.getRowCount();\r\n\r\n        if (typeof index !== 'number' || index < 0 || index >= lastRow) {\r\n            _warn(229, { index });\r\n            return false;\r\n        }\r\n\r\n        const rowTopPixel = index * this.rowHeight;\r\n        const rowBottomPixel = rowTopPixel + this.rowHeight;\r\n        const eGui = this.getGui();\r\n\r\n        const viewportTopPixel = eGui.scrollTop;\r\n        const viewportHeight = eGui.offsetHeight;\r\n        const viewportBottomPixel = viewportTopPixel + viewportHeight;\r\n\r\n        const diff = scrollPartialIntoView ? 0 : this.rowHeight;\r\n        const viewportScrolledPastRow = viewportTopPixel > rowTopPixel + diff;\r\n        const viewportScrolledBeforeRow = viewportBottomPixel < rowBottomPixel - diff;\r\n\r\n        if (viewportScrolledPastRow) {\r\n            // if row is before, scroll up with row at top\r\n            eGui.scrollTop = rowTopPixel;\r\n            return true;\r\n        }\r\n\r\n        if (viewportScrolledBeforeRow) {\r\n            // if row is below, scroll down with row at bottom\r\n            const newScrollPosition = rowBottomPixel - viewportHeight;\r\n            eGui.scrollTop = newScrollPosition;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public setComponentCreator(componentCreator: (value: any, listItemElement: HTMLElement) => C): void {\r\n        this.componentCreator = componentCreator;\r\n    }\r\n\r\n    public setComponentUpdater(componentUpdater: (value: any, component: C) => void): void {\r\n        this.componentUpdater = componentUpdater;\r\n    }\r\n\r\n    public getRowHeight(): number {\r\n        return this.rowHeight;\r\n    }\r\n\r\n    public getScrollTop(): number {\r\n        return this.getGui().scrollTop;\r\n    }\r\n\r\n    public setRowHeight(rowHeight: number): void {\r\n        this.isHeightFromTheme = false;\r\n        this.rowHeight = rowHeight;\r\n        this.refresh();\r\n    }\r\n\r\n    public refresh(softRefresh?: boolean): void {\r\n        if (this.model == null || !this.isAlive()) {\r\n            return;\r\n        }\r\n\r\n        const rowCount = this.model.getRowCount();\r\n        this.eContainer.style.height = `${rowCount * this.rowHeight}px`;\r\n\r\n        // ensure height is applied before attempting to redraw rows\r\n        this.awaitStable(() => {\r\n            if (!this.isAlive()) {\r\n                return;\r\n            }\r\n\r\n            if (this.canSoftRefresh(softRefresh)) {\r\n                this.drawVirtualRows(true);\r\n            } else {\r\n                this.clearVirtualRows();\r\n                this.drawVirtualRows();\r\n            }\r\n        });\r\n    }\r\n\r\n    public awaitStable(callback: () => void): void {\r\n        this.awaitStableCallbacks.push(callback);\r\n        if (this.awaitStableCallbacks.length > 1) {\r\n            return;\r\n        }\r\n        const rowCount = this.model.getRowCount();\r\n        _waitUntil(\r\n            () => this.eContainer.clientHeight >= rowCount * this.rowHeight,\r\n            () => {\r\n                if (!this.isAlive()) {\r\n                    return;\r\n                }\r\n                const callbacks = this.awaitStableCallbacks;\r\n                this.awaitStableCallbacks = [];\r\n                callbacks.forEach((c) => c());\r\n            }\r\n        );\r\n    }\r\n\r\n    private canSoftRefresh(softRefresh: boolean | undefined): boolean {\r\n        return !!(\r\n            softRefresh &&\r\n            this.renderedRows.size &&\r\n            typeof this.model.areRowsEqual === 'function' &&\r\n            this.componentUpdater\r\n        );\r\n    }\r\n\r\n    private clearVirtualRows() {\r\n        this.renderedRows.forEach((_, rowIndex) => this.removeRow(rowIndex));\r\n    }\r\n\r\n    protected drawVirtualRows(softRefresh?: boolean) {\r\n        if (!this.isAlive() || !this.model) {\r\n            return;\r\n        }\r\n\r\n        const gui = this.getGui();\r\n        const topPixel = gui.scrollTop;\r\n        const bottomPixel = topPixel + gui.offsetHeight;\r\n        const firstRow = Math.floor(topPixel / this.rowHeight);\r\n        const lastRow = Math.floor(bottomPixel / this.rowHeight);\r\n        this.pageSize = Math.floor((bottomPixel - topPixel) / this.rowHeight);\r\n\r\n        this.ensureRowsRendered(firstRow, lastRow, softRefresh);\r\n    }\r\n\r\n    private ensureRowsRendered(start: number, finish: number, softRefresh?: boolean) {\r\n        // remove any rows that are no longer required\r\n        this.renderedRows.forEach((_, rowIndex) => {\r\n            if ((rowIndex < start || rowIndex > finish) && rowIndex !== this.lastFocusedRowIndex) {\r\n                this.removeRow(rowIndex);\r\n            }\r\n        });\r\n\r\n        if (softRefresh) {\r\n            // refresh any existing rows\r\n            this.refreshRows();\r\n        }\r\n\r\n        // insert any required new rows\r\n        for (let rowIndex = start; rowIndex <= finish; rowIndex++) {\r\n            if (this.renderedRows.has(rowIndex)) {\r\n                continue;\r\n            }\r\n\r\n            // check this row actually exists (in case overflow buffer window exceeds real data)\r\n            if (rowIndex < this.model.getRowCount()) {\r\n                this.insertRow(rowIndex);\r\n            }\r\n        }\r\n    }\r\n\r\n    private insertRow(rowIndex: number): void {\r\n        const value = this.model.getRow(rowIndex);\r\n        const eDiv = document.createElement('div');\r\n\r\n        eDiv.classList.add('ag-virtual-list-item', `ag-${this.cssIdentifier}-virtual-list-item`);\r\n        _setAriaRole(eDiv, this.ariaRole === 'tree' ? 'treeitem' : 'option');\r\n        _setAriaSetSize(eDiv, this.model.getRowCount());\r\n        _setAriaPosInSet(eDiv, rowIndex + 1);\r\n        eDiv.setAttribute('tabindex', '-1');\r\n\r\n        eDiv.style.height = `${this.rowHeight}px`;\r\n        eDiv.style.top = `${this.rowHeight * rowIndex}px`;\r\n\r\n        const rowComponent = this.componentCreator(value, eDiv);\r\n\r\n        rowComponent.addGuiEventListener('focusin', () => (this.lastFocusedRowIndex = rowIndex));\r\n\r\n        eDiv.appendChild(rowComponent.getGui());\r\n\r\n        // keep the DOM order consistent with the order of the rows\r\n        if (this.renderedRows.has(rowIndex - 1)) {\r\n            this.renderedRows.get(rowIndex - 1)!.eDiv.insertAdjacentElement('afterend', eDiv);\r\n        } else if (this.renderedRows.has(rowIndex + 1)) {\r\n            this.renderedRows.get(rowIndex + 1)!.eDiv.insertAdjacentElement('beforebegin', eDiv);\r\n        } else {\r\n            this.eContainer.appendChild(eDiv);\r\n        }\r\n\r\n        this.renderedRows.set(rowIndex, { rowComponent, eDiv, value });\r\n    }\r\n\r\n    private removeRow(rowIndex: number) {\r\n        const component = this.renderedRows.get(rowIndex)!;\r\n\r\n        this.eContainer.removeChild(component.eDiv);\r\n        this.destroyBean(component.rowComponent);\r\n        this.renderedRows.delete(rowIndex);\r\n    }\r\n\r\n    private refreshRows(): void {\r\n        const rowCount = this.model.getRowCount();\r\n        this.renderedRows.forEach((row, rowIndex) => {\r\n            if (rowIndex >= rowCount) {\r\n                this.removeRow(rowIndex);\r\n            } else {\r\n                const newValue = this.model.getRow(rowIndex);\r\n                if (this.model.areRowsEqual?.(row.value, newValue)) {\r\n                    this.componentUpdater(newValue, row.rowComponent);\r\n                } else {\r\n                    // to be replaced later\r\n                    this.removeRow(rowIndex);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private addScrollListener() {\r\n        this.addGuiEventListener('scroll', () => this.drawVirtualRows(), { passive: true });\r\n    }\r\n\r\n    public setModel(model: VirtualListModel): void {\r\n        this.model = model;\r\n    }\r\n\r\n    public override getAriaElement(): Element {\r\n        return this.eContainer;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        if (!this.isAlive()) {\r\n            return;\r\n        }\r\n\r\n        this.clearVirtualRows();\r\n        this.awaitStableCallbacks.length = 0;\r\n        super.destroy();\r\n    }\r\n}\r\n", "import { Component, _escapeString, _exists } from 'ag-grid-community';\r\n\r\nexport class AgAutocompleteRow extends Component {\r\n    private value: string;\r\n    private hasHighlighting = false;\r\n\r\n    constructor() {\r\n        super(/* html */ `\r\n        <div class=\"ag-autocomplete-row\" role=\"presentation\">\r\n            <div class=\"ag-autocomplete-row-label\"></div>\r\n        </div>`);\r\n    }\r\n\r\n    public setState(value: string, selected: boolean): void {\r\n        this.value = value;\r\n\r\n        this.render();\r\n\r\n        this.updateSelected(selected);\r\n    }\r\n\r\n    public updateSelected(selected: boolean): void {\r\n        this.addOrRemoveCssClass('ag-autocomplete-row-selected', selected);\r\n    }\r\n\r\n    public setSearchString(searchString: string): void {\r\n        let keepHighlighting = false;\r\n        if (_exists(searchString)) {\r\n            const index = this.value?.toLocaleLowerCase().indexOf(searchString.toLocaleLowerCase());\r\n            if (index >= 0) {\r\n                keepHighlighting = true;\r\n                this.hasHighlighting = true;\r\n                const highlightEndIndex = index + searchString.length;\r\n                const startPart = _escapeString(this.value.slice(0, index));\r\n                const highlightedPart = _escapeString(this.value.slice(index, highlightEndIndex));\r\n                const endPart = _escapeString(this.value.slice(highlightEndIndex));\r\n                this.getGui().lastElementChild!.innerHTML = `${startPart}<b>${highlightedPart}</b>${endPart}`;\r\n            }\r\n        }\r\n        if (!keepHighlighting && this.hasHighlighting) {\r\n            this.hasHighlighting = false;\r\n            this.render();\r\n        }\r\n    }\r\n\r\n    private render() {\r\n        // putting in blank if missing, so at least the user can click on it\r\n        this.getGui().lastElementChild!.innerHTML = _escapeString(this.value) ?? '&nbsp;';\r\n    }\r\n}\r\n", "import type { BeanCollection, ColumnModel, CtrlsService, FocusService } from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    KeyCode,\r\n    _clearElement,\r\n    _findNextFocusableElement,\r\n    _focusInto,\r\n    _getActiveDomElement,\r\n    _getFloatingFiltersHeight,\r\n    _setAriaColIndex,\r\n    _setAriaColSpan,\r\n    _setAriaRole,\r\n    _setAriaRowIndex,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport { AdvancedFilterComp } from './advancedFilterComp';\r\n\r\nexport class AdvancedFilterHeaderComp extends Component {\r\n    private colModel: ColumnModel;\r\n    private focusSvc: FocusService;\r\n    private ctrlsSvc: CtrlsService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.colModel = beans.colModel;\r\n        this.focusSvc = beans.focusSvc;\r\n        this.ctrlsSvc = beans.ctrlsSvc;\r\n    }\r\n\r\n    private eAdvancedFilter: AdvancedFilterComp | undefined;\r\n    private height: number;\r\n\r\n    constructor(private enabled: boolean) {\r\n        super(/* html */ `\r\n            <div class=\"ag-advanced-filter-header\" role=\"row\">\r\n            </div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.setupAdvancedFilter(this.enabled);\r\n\r\n        this.addDestroyFunc(() => this.destroyBean(this.eAdvancedFilter));\r\n\r\n        const heightListener = () => {\r\n            if (this.enabled) {\r\n                this.setEnabledHeight();\r\n            }\r\n        };\r\n\r\n        this.addManagedEventListeners({\r\n            gridColumnsChanged: () => this.onGridColumnsChanged(),\r\n            columnHeaderHeightChanged: heightListener,\r\n            gridStylesChanged: heightListener,\r\n        });\r\n\r\n        this.addManagedPropertyListener('headerHeight', heightListener);\r\n        this.addManagedPropertyListener('floatingFiltersHeight', heightListener);\r\n\r\n        this.addGuiEventListener('keydown', (event: KeyboardEvent) => this.onKeyDown(event));\r\n\r\n        this.addGuiEventListener('focusout', (event: FocusEvent) => {\r\n            if (!this.getFocusableElement().contains(event.relatedTarget as HTMLElement)) {\r\n                this.focusSvc.clearAdvancedFilterColumn();\r\n            }\r\n        });\r\n    }\r\n\r\n    public override getFocusableElement(): HTMLElement {\r\n        return this.eAdvancedFilter?.getGui() ?? this.getGui();\r\n    }\r\n\r\n    public setEnabled(enabled: boolean): void {\r\n        if (enabled === this.enabled) {\r\n            return;\r\n        }\r\n        this.setupAdvancedFilter(enabled);\r\n    }\r\n\r\n    public refresh(): void {\r\n        this.eAdvancedFilter?.refresh();\r\n    }\r\n\r\n    public getHeight(): number {\r\n        return this.height;\r\n    }\r\n\r\n    public setInputDisabled(disabled: boolean): void {\r\n        this.eAdvancedFilter?.setInputDisabled(disabled);\r\n    }\r\n\r\n    private setupAdvancedFilter(enabled: boolean): void {\r\n        const eGui = this.getGui();\r\n        if (enabled) {\r\n            // unmanaged as can be recreated\r\n            this.eAdvancedFilter = this.createBean(new AdvancedFilterComp());\r\n            const eAdvancedFilterGui = this.eAdvancedFilter.getGui();\r\n            this.eAdvancedFilter.addCssClass('ag-advanced-filter-header-cell');\r\n\r\n            this.setEnabledHeight();\r\n\r\n            this.setAriaRowIndex();\r\n            _setAriaRole(eAdvancedFilterGui, 'gridcell');\r\n            _setAriaColIndex(eAdvancedFilterGui, 1);\r\n            this.setAriaColumnCount(eAdvancedFilterGui);\r\n\r\n            eGui.appendChild(eAdvancedFilterGui);\r\n        } else {\r\n            _clearElement(eGui);\r\n            this.destroyBean(this.eAdvancedFilter);\r\n            this.height = 0;\r\n        }\r\n        _setDisplayed(eGui, enabled);\r\n        this.enabled = enabled;\r\n    }\r\n\r\n    private setEnabledHeight(): void {\r\n        const eGui = this.getGui();\r\n        this.height = _getFloatingFiltersHeight(this.beans);\r\n        const height = `${this.height}px`;\r\n        eGui.style.height = height;\r\n        eGui.style.minHeight = height;\r\n    }\r\n\r\n    private setAriaColumnCount(eAdvancedFilterGui: HTMLElement): void {\r\n        _setAriaColSpan(eAdvancedFilterGui, this.colModel.getCols().length);\r\n    }\r\n\r\n    private setAriaRowIndex(): void {\r\n        _setAriaRowIndex(this.getGui(), this.ctrlsSvc.getHeaderRowContainerCtrl()?.getRowCount() ?? 0);\r\n    }\r\n\r\n    private onGridColumnsChanged(): void {\r\n        if (!this.eAdvancedFilter) {\r\n            return;\r\n        }\r\n        this.setAriaColumnCount(this.eAdvancedFilter.getGui());\r\n        this.setAriaRowIndex();\r\n    }\r\n\r\n    private onKeyDown(event: KeyboardEvent): void {\r\n        switch (event.key) {\r\n            case KeyCode.ENTER: {\r\n                if (this.hasFocus()) {\r\n                    if (_focusInto(this.getFocusableElement())) {\r\n                        event.preventDefault();\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case KeyCode.ESCAPE:\r\n                if (!this.hasFocus()) {\r\n                    this.getFocusableElement().focus();\r\n                }\r\n                break;\r\n            case KeyCode.UP:\r\n                this.navigateUpDown(true, event);\r\n                break;\r\n            case KeyCode.DOWN:\r\n                this.navigateUpDown(false, event);\r\n                break;\r\n            case KeyCode.TAB:\r\n                if (this.hasFocus()) {\r\n                    this.navigateLeftRight(event);\r\n                } else {\r\n                    const nextFocusableEl = _findNextFocusableElement(\r\n                        this.beans,\r\n                        this.getFocusableElement(),\r\n                        null,\r\n                        event.shiftKey\r\n                    );\r\n                    if (nextFocusableEl) {\r\n                        event.preventDefault();\r\n                        nextFocusableEl.focus();\r\n                    } else {\r\n                        this.navigateLeftRight(event);\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    private navigateUpDown(backwards: boolean, event: KeyboardEvent): void {\r\n        if (this.hasFocus()) {\r\n            if (this.focusSvc.focusNextFromAdvancedFilter(backwards)) {\r\n                event.preventDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    private navigateLeftRight(event: KeyboardEvent): void {\r\n        if (event.shiftKey ? this.focusSvc.focusLastHeader() : this.focusSvc.focusNextFromAdvancedFilter(false, true)) {\r\n            event.preventDefault();\r\n        }\r\n    }\r\n\r\n    private hasFocus(): boolean {\r\n        return _getActiveDomElement(this.beans) === this.getFocusableElement();\r\n    }\r\n}\r\n", "import type {\r\n    AdvancedFilterModel,\r\n    BeanCollection,\r\n    ColumnAdvancedFilterModel,\r\n    FilterManager,\r\n    ITooltipCtrl,\r\n    JoinAdvancedFilterModel,\r\n    Registry,\r\n    TooltipFeature,\r\n} from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _exists, _setDisabled } from 'ag-grid-community';\r\n\r\nimport type { VirtualListDragItem } from '../../features/iVirtualListDragFeature';\r\nimport { VirtualList } from '../../widgets/virtualList';\r\nimport type { AdvancedFilterExpressionService } from '../advancedFilterExpressionService';\r\nimport type { AdvancedFilterService } from '../advancedFilterService';\r\nimport { AdvancedFilterBuilderDragFeature } from './advancedFilterBuilderDragFeature';\r\nimport { AdvancedFilterBuilderItemAddComp } from './advancedFilterBuilderItemAddComp';\r\nimport { AdvancedFilterBuilderItemComp } from './advancedFilterBuilderItemComp';\r\nimport type {\r\n    AdvancedFilterBuilderAddEvent,\r\n    AdvancedFilterBuilderEvents,\r\n    AdvancedFilterBuilderItem,\r\n    AdvancedFilterBuilderMoveEvent,\r\n    AdvancedFilterBuilderRemoveEvent,\r\n} from './iAdvancedFilterBuilder';\r\n\r\nexport class AdvancedFilterBuilderComp extends Component<AdvancedFilterBuilderEvents> {\r\n    private filterManager?: FilterManager;\r\n    private advancedFilter: AdvancedFilterService;\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n    private registry: Registry;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.filterManager = beans.filterManager;\r\n        this.advancedFilter = beans.advancedFilter as AdvancedFilterService;\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n        this.registry = beans.registry;\r\n    }\r\n\r\n    private readonly eList: HTMLElement = RefPlaceholder;\r\n    private readonly eApplyFilterButton: HTMLElement = RefPlaceholder;\r\n    private readonly eCancelFilterButton: HTMLElement = RefPlaceholder;\r\n\r\n    private virtualList: VirtualList<AdvancedFilterBuilderItemComp | AdvancedFilterBuilderItemAddComp>;\r\n    private filterModel: AdvancedFilterModel;\r\n    private stringifiedModel: string;\r\n    private items: AdvancedFilterBuilderItem[];\r\n    private dragFeature: AdvancedFilterBuilderDragFeature;\r\n    private showMove: boolean;\r\n    private validationTooltipFeature?: TooltipFeature;\r\n    private validationMessage: string | null = null;\r\n\r\n    constructor() {\r\n        super(/* html */ `\r\n            <div role=\"presentation\" class=\"ag-advanced-filter-builder\" tabindex=\"-1\">\r\n                <div role=\"presentation\" class=\"ag-advanced-filter-builder-list\" data-ref=\"eList\"></div>\r\n                <div role=\"presentation\" class=\"ag-advanced-filter-builder-button-panel\">\r\n                    <button class=\"ag-button ag-standard-button ag-advanced-filter-builder-apply-button\" data-ref=\"eApplyFilterButton\"></button>\r\n                    <button class=\"ag-button ag-standard-button ag-advanced-filter-builder-cancel-button\" data-ref=\"eCancelFilterButton\"></button>\r\n                </div>\r\n            </div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const { showMoveButtons } = this.gos.get('advancedFilterBuilderParams') ?? {};\r\n        this.showMove = !!showMoveButtons;\r\n        this.addManagedPropertyListener('advancedFilterBuilderParams', ({ currentValue }) => {\r\n            this.showMove = !!currentValue?.showMoveButtons;\r\n            this.refreshList(false);\r\n        });\r\n\r\n        this.filterModel = this.setupFilterModel();\r\n        this.setupVirtualList();\r\n\r\n        this.dragFeature = this.createManagedBean(new AdvancedFilterBuilderDragFeature(this, this.virtualList));\r\n\r\n        this.setupButtons();\r\n    }\r\n\r\n    public refresh(): void {\r\n        const virtualList = this.virtualList;\r\n        let indexToFocus = virtualList.getLastFocusedRow();\r\n        this.setupFilterModel();\r\n        this.validateItems();\r\n        this.refreshList(false);\r\n        if (indexToFocus != null) {\r\n            // last focused row is cleared on focus out, so if defined, we need to put the focus back\r\n            if (!virtualList.getComponentAt(indexToFocus)) {\r\n                indexToFocus = 0;\r\n            }\r\n            virtualList.focusRow(indexToFocus);\r\n        }\r\n    }\r\n\r\n    public getNumItems(): number {\r\n        return this.items.length;\r\n    }\r\n\r\n    public moveItem(\r\n        item: AdvancedFilterBuilderItem | null,\r\n        destination: VirtualListDragItem<AdvancedFilterBuilderItemComp> | null\r\n    ): void {\r\n        if (!destination || !item) {\r\n            return;\r\n        }\r\n        this.moveItemToIndex(item, destination.rowIndex, destination.position);\r\n    }\r\n\r\n    public afterGuiAttached(): void {\r\n        this.virtualList.awaitStable(() => this.virtualList.focusRow(0));\r\n    }\r\n\r\n    private setupVirtualList(): void {\r\n        const virtualList = (this.virtualList = this.createManagedBean(\r\n            new VirtualList({\r\n                cssIdentifier: 'advanced-filter-builder',\r\n                ariaRole: 'tree',\r\n                listName: this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderList'),\r\n            })\r\n        ));\r\n\r\n        virtualList.setComponentCreator(this.createItemComponent.bind(this));\r\n        virtualList.setComponentUpdater(this.updateItemComponent.bind(this));\r\n        virtualList.setRowHeight(40);\r\n        this.eList.appendChild(virtualList.getGui());\r\n\r\n        virtualList.setModel({\r\n            getRowCount: () => this.items.length,\r\n            getRow: (index: number) => this.items[index],\r\n            areRowsEqual: (oldRow: AdvancedFilterBuilderItem, newRow: AdvancedFilterBuilderItem) => oldRow === newRow,\r\n        });\r\n        this.buildList();\r\n        virtualList.refresh();\r\n    }\r\n\r\n    private setupButtons(): void {\r\n        this.eApplyFilterButton.innerText = this.advFilterExpSvc.translate('advancedFilterBuilderApply');\r\n        this.activateTabIndex([this.eApplyFilterButton]);\r\n        this.addManagedElementListeners(this.eApplyFilterButton, {\r\n            click: () => {\r\n                this.advancedFilter.setModel(this.filterModel);\r\n                this.filterManager?.onFilterChanged({ source: 'advancedFilter' });\r\n                this.close();\r\n            },\r\n        });\r\n\r\n        this.validationTooltipFeature = this.createOptionalManagedBean(\r\n            this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.eApplyFilterButton,\r\n                getLocation: () => 'advancedFilter',\r\n                getTooltipValue: () => this.validationMessage,\r\n                getTooltipShowDelayOverride: () => 1000,\r\n            } as ITooltipCtrl)\r\n        );\r\n        this.validate();\r\n\r\n        const mouseListener = (isEnter: boolean) =>\r\n            this.addOrRemoveCssClass('ag-advanced-filter-builder-validation', isEnter);\r\n        this.addManagedListeners(this.eApplyFilterButton, {\r\n            mouseenter: () => mouseListener(true),\r\n            mouseleave: () => mouseListener(false),\r\n        });\r\n\r\n        this.eCancelFilterButton.innerText = this.advFilterExpSvc.translate('advancedFilterBuilderCancel');\r\n        this.activateTabIndex([this.eCancelFilterButton]);\r\n        this.addManagedElementListeners(this.eCancelFilterButton, { click: () => this.close() });\r\n    }\r\n\r\n    private removeItemFromParent(item: AdvancedFilterBuilderItem): number {\r\n        const sourceParentIndex = item.parent!.conditions.indexOf(item.filterModel!);\r\n        item.parent!.conditions.splice(sourceParentIndex, 1);\r\n        return sourceParentIndex;\r\n    }\r\n\r\n    private moveItemToIndex(\r\n        item: AdvancedFilterBuilderItem,\r\n        destinationRowIndex: number,\r\n        destinationPosition: 'top' | 'bottom'\r\n    ): void {\r\n        const destinationItem = this.items[destinationRowIndex];\r\n        const destinationIsParent =\r\n            destinationItem.filterModel?.filterType === 'join' && destinationPosition === 'bottom';\r\n        const destinationParent = destinationIsParent\r\n            ? (destinationItem.filterModel as JoinAdvancedFilterModel)\r\n            : destinationItem.parent;\r\n\r\n        // trying to move before the root\r\n        if (!destinationParent) {\r\n            return;\r\n        }\r\n\r\n        // can't move into itself\r\n        if (this.isChildOrSelf(destinationParent, item.filterModel!) || destinationItem === item) {\r\n            return;\r\n        }\r\n\r\n        this.removeItemFromParent(item);\r\n\r\n        let destinationParentIndex;\r\n        if (destinationIsParent) {\r\n            destinationParentIndex = 0;\r\n        } else {\r\n            destinationParentIndex = destinationParent.conditions.indexOf(destinationItem.filterModel!);\r\n            if (destinationParentIndex === -1) {\r\n                destinationParentIndex = destinationParent.conditions.length;\r\n            } else if (destinationPosition === 'bottom') {\r\n                destinationParentIndex += 1;\r\n            }\r\n        }\r\n        destinationParent.conditions.splice(destinationParentIndex, 0, item.filterModel!);\r\n        this.refreshList(false);\r\n    }\r\n\r\n    private isChildOrSelf(modelToCheck: AdvancedFilterModel, potentialParentModel: AdvancedFilterModel): boolean {\r\n        return (\r\n            modelToCheck === potentialParentModel ||\r\n            (potentialParentModel.filterType === 'join' &&\r\n                potentialParentModel.conditions.some((condition) => this.isChildOrSelf(modelToCheck, condition)))\r\n        );\r\n    }\r\n\r\n    private setupFilterModel(): AdvancedFilterModel {\r\n        const filterModel = this.formatFilterModel(this.advancedFilter.getModel());\r\n        this.stringifiedModel = JSON.stringify(filterModel, (_,value)=> typeof value == \"bigint\" ? value.toString()+\"n\" : value);\r\n        return filterModel;\r\n    }\r\n\r\n    private formatFilterModel(filterModel: AdvancedFilterModel | null): AdvancedFilterModel {\r\n        filterModel = filterModel ?? {\r\n            filterType: 'join',\r\n            type: 'AND',\r\n            conditions: [],\r\n        };\r\n        if (filterModel.filterType !== 'join') {\r\n            filterModel = {\r\n                filterType: 'join',\r\n                type: 'AND',\r\n                conditions: [filterModel],\r\n            };\r\n        }\r\n        return filterModel;\r\n    }\r\n\r\n    private buildList(): void {\r\n        const parseFilterModel = (\r\n            filterModel: AdvancedFilterModel,\r\n            items: AdvancedFilterBuilderItem[],\r\n            level: number,\r\n            parent?: JoinAdvancedFilterModel\r\n        ) => {\r\n            items.push({ filterModel, level, parent, valid: true, showMove: this.showMove });\r\n            if (filterModel.filterType === 'join') {\r\n                filterModel.conditions.forEach((childFilterModel) =>\r\n                    parseFilterModel(childFilterModel, items, level + 1, filterModel)\r\n                );\r\n                if (level === 0) {\r\n                    items.push({ filterModel: null, level: level + 1, parent: filterModel, valid: true });\r\n                }\r\n            }\r\n        };\r\n        this.items = [];\r\n        parseFilterModel(this.filterModel, this.items, 0);\r\n    }\r\n\r\n    private refreshList(softRefresh: boolean): void {\r\n        if (!softRefresh) {\r\n            const invalidModels: AdvancedFilterModel[] = [];\r\n            this.items.forEach((item) => {\r\n                if (!item.valid) {\r\n                    invalidModels.push(item.filterModel!);\r\n                }\r\n            });\r\n            this.buildList();\r\n            if (invalidModels.length) {\r\n                this.items.forEach((item) => {\r\n                    if (item.filterModel && invalidModels.includes(item.filterModel)) {\r\n                        item.valid = false;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        this.virtualList.refresh(softRefresh);\r\n        this.validate();\r\n    }\r\n\r\n    private updateItemComponent(item: AdvancedFilterBuilderItem, comp: AdvancedFilterBuilderItemComp): void {\r\n        const index = this.items.indexOf(item);\r\n        const populateTreeLines = (filterModel: AdvancedFilterModel | null, treeLines: boolean[]) => {\r\n            const parentItem = this.items.find((itemToCheck) => itemToCheck.filterModel === filterModel);\r\n            const parentFilterModel = parentItem?.parent;\r\n            if (parentFilterModel) {\r\n                const { conditions } = parentFilterModel as JoinAdvancedFilterModel;\r\n                // check parent\r\n                populateTreeLines(parentFilterModel, treeLines);\r\n                treeLines.push(conditions[conditions.length - 1] === filterModel);\r\n            }\r\n        };\r\n        const treeLines: boolean[] = [];\r\n        const { filterModel } = item;\r\n        if (filterModel) {\r\n            populateTreeLines(filterModel, treeLines);\r\n            // the add item button is always last child\r\n            treeLines[0] = false;\r\n        }\r\n        const showStartTreeLine = filterModel?.filterType === 'join' && !!filterModel.conditions.length;\r\n        comp.setState({\r\n            disableMoveUp: index === 1,\r\n            disableMoveDown: !this.canMoveDown(item, index),\r\n            treeLines,\r\n            showStartTreeLine,\r\n        });\r\n    }\r\n\r\n    private createItemComponent(\r\n        item: AdvancedFilterBuilderItem,\r\n        focusWrapper: HTMLElement\r\n    ): AdvancedFilterBuilderItemComp | AdvancedFilterBuilderItemAddComp {\r\n        const itemComp = this.createBean(\r\n            item.filterModel\r\n                ? new AdvancedFilterBuilderItemComp(item, this.dragFeature, focusWrapper)\r\n                : new AdvancedFilterBuilderItemAddComp(item, focusWrapper)\r\n        );\r\n\r\n        itemComp.addManagedListeners(itemComp, {\r\n            advancedFilterBuilderRemoved: ({ item }: AdvancedFilterBuilderRemoveEvent) => this.removeItem(item),\r\n            advancedFilterBuilderValueChanged: () => this.validate(),\r\n            advancedFilterBuilderAdded: ({ item, isJoin }: AdvancedFilterBuilderAddEvent) => this.addItem(item, isJoin),\r\n            advancedFilterBuilderMoved: ({ item, backwards }: AdvancedFilterBuilderMoveEvent) =>\r\n                this.moveItemUpDown(item, backwards),\r\n        });\r\n\r\n        if (itemComp instanceof AdvancedFilterBuilderItemComp) {\r\n            this.updateItemComponent(item, itemComp);\r\n        }\r\n\r\n        return itemComp;\r\n    }\r\n\r\n    private addItem(item: AdvancedFilterBuilderItem, isJoin: boolean): void {\r\n        const { parent: itemParent, level, filterModel: itemFilterModel } = item;\r\n        const itemIsJoin = itemFilterModel?.filterType === 'join';\r\n        const filterModel = isJoin\r\n            ? ({\r\n                  filterType: 'join',\r\n                  type: 'AND',\r\n                  conditions: [],\r\n              } as JoinAdvancedFilterModel)\r\n            : ({} as ColumnAdvancedFilterModel);\r\n        const parent = (itemIsJoin ? (itemFilterModel as JoinAdvancedFilterModel) : itemParent)!;\r\n        let insertIndex = itemIsJoin ? 0 : parent.conditions.indexOf(itemFilterModel!);\r\n        if (insertIndex >= 0) {\r\n            if (!itemIsJoin) {\r\n                insertIndex += 1;\r\n            }\r\n            parent.conditions.splice(insertIndex, 0, filterModel);\r\n        } else {\r\n            parent.conditions.push(filterModel);\r\n        }\r\n        let index = this.items.indexOf(item);\r\n        const softRefresh = index >= 0;\r\n        if (softRefresh) {\r\n            if (item.filterModel) {\r\n                index++;\r\n            }\r\n            const newItems: AdvancedFilterBuilderItem[] = [\r\n                {\r\n                    filterModel,\r\n                    level: itemIsJoin ? level + 1 : level,\r\n                    parent,\r\n                    valid: isJoin,\r\n                    showMove: this.showMove,\r\n                },\r\n            ];\r\n            this.items.splice(index, 0, ...newItems);\r\n        }\r\n        this.refreshList(softRefresh);\r\n        if (softRefresh) {\r\n            this.virtualList.getComponentAt(index)?.afterAdd();\r\n        }\r\n    }\r\n\r\n    private removeItem(item: AdvancedFilterBuilderItem): void {\r\n        const parent = item.parent!;\r\n        const { filterModel } = item;\r\n        const parentIndex = parent.conditions.indexOf(filterModel!);\r\n        parent.conditions.splice(parentIndex, 1);\r\n\r\n        const isJoin = item.filterModel?.filterType === 'join';\r\n        const index = this.items.indexOf(item);\r\n        // if it's a join, we don't know how many children there are, so always rebuild\r\n        const softRefresh = !isJoin && index >= 0;\r\n        if (softRefresh) {\r\n            this.items.splice(index, 1);\r\n        }\r\n        this.refreshList(softRefresh);\r\n        if (index >= 0) {\r\n            this.virtualList.focusRow(index);\r\n        }\r\n    }\r\n\r\n    private moveItemUpDown(item: AdvancedFilterBuilderItem, backwards: boolean): void {\r\n        const itemIndex = this.items.indexOf(item);\r\n        const destinationIndex = backwards ? itemIndex - 1 : itemIndex + 1;\r\n        if (destinationIndex === 0 || (!backwards && !this.canMoveDown(item, itemIndex))) {\r\n            return;\r\n        }\r\n        const destinationItem = this.items[destinationIndex];\r\n        const indexInParent = this.removeItemFromParent(item);\r\n        const { level, filterModel, parent } = item;\r\n        const {\r\n            level: destinationLevel,\r\n            filterModel: destinationFilterModel,\r\n            parent: destinationParent,\r\n        } = destinationItem;\r\n        if (backwards) {\r\n            if (destinationLevel === level && destinationFilterModel!.filterType === 'join') {\r\n                // destination is empty join. move to last child\r\n                (destinationFilterModel as JoinAdvancedFilterModel).conditions.push(filterModel!);\r\n            } else if (destinationLevel <= level) {\r\n                // same parent or first child. move above destination in destination parent\r\n                const destinationIndex = destinationParent!.conditions.indexOf(destinationFilterModel!);\r\n                destinationParent!.conditions.splice(destinationIndex, 0, filterModel!);\r\n            } else {\r\n                // need to move up a level. move to end of previous item's children\r\n                const newParentItem = parent!.conditions[indexInParent - 1] as JoinAdvancedFilterModel;\r\n                newParentItem.conditions.push(filterModel!);\r\n            }\r\n        } else {\r\n            if (destinationLevel === level) {\r\n                if (destinationFilterModel!.filterType === 'join') {\r\n                    // destination is join. move to first child\r\n                    (destinationFilterModel as JoinAdvancedFilterModel).conditions.splice(0, 0, filterModel!);\r\n                } else {\r\n                    // switch positions\r\n                    const destinationIndex = destinationParent!.conditions.indexOf(destinationFilterModel!);\r\n                    destinationParent!.conditions.splice(destinationIndex + 1, 0, filterModel!);\r\n                }\r\n            } else {\r\n                if (indexInParent < parent!.conditions.length) {\r\n                    // keep in parent, but swap with next child\r\n                    parent!.conditions.splice(indexInParent + 1, 0, filterModel!);\r\n                } else {\r\n                    // need to move down a level. move after parent in its parent\r\n                    const parentItem = this.items.find((itemToCheck) => itemToCheck.filterModel === parent);\r\n                    const destinationIndex = parentItem!.parent!.conditions.indexOf(parentItem!.filterModel!) + 1;\r\n                    parentItem!.parent!.conditions.splice(destinationIndex, 0, filterModel!);\r\n                }\r\n            }\r\n        }\r\n        this.refreshList(false);\r\n        const newIndex = this.items.findIndex(\r\n            ({ filterModel: filterModelToCheck }) => filterModelToCheck === filterModel\r\n        );\r\n        if (newIndex >= 0) {\r\n            const comp = this.virtualList.getComponentAt(newIndex);\r\n            if (comp instanceof AdvancedFilterBuilderItemComp) {\r\n                comp.focusMoveButton(backwards);\r\n            }\r\n        }\r\n    }\r\n\r\n    private canMoveDown(item: AdvancedFilterBuilderItem, index: number): boolean {\r\n        return !(\r\n            (item.level === 1 && index === this.items.length - 2) ||\r\n            (item.level === 1 && item.parent!.conditions[item.parent!.conditions.length - 1] === item.filterModel!)\r\n        );\r\n    }\r\n\r\n    private close(): void {\r\n        this.advancedFilter.getCtrl().toggleFilterBuilder({ source: 'ui' });\r\n    }\r\n\r\n    private validate(): void {\r\n        let disableApply = !this.items.every(({ valid }) => valid);\r\n        if (!disableApply) {\r\n            const currentModel = JSON.stringify(this.filterModel, (_,value)=> typeof value == \"bigint\" ? value.toString()+\"n\" : value);\r\n            disableApply = currentModel === this.stringifiedModel;\r\n            if (disableApply) {\r\n                this.validationMessage = this.advFilterExpSvc.translate(\r\n                    'advancedFilterBuilderValidationAlreadyApplied'\r\n                );\r\n            } else {\r\n                this.validationMessage = null;\r\n            }\r\n        } else {\r\n            this.validationMessage = this.advFilterExpSvc.translate('advancedFilterBuilderValidationIncomplete');\r\n        }\r\n        _setDisabled(this.eApplyFilterButton, disableApply);\r\n        this.validationTooltipFeature?.refreshTooltip();\r\n    }\r\n\r\n    private validateItems(): void {\r\n        const clearOperator = (filterModel: ColumnAdvancedFilterModel) => {\r\n            filterModel.type = undefined as any;\r\n        };\r\n        const clearOperand = (filterModel: ColumnAdvancedFilterModel) => {\r\n            delete (filterModel as any).filter;\r\n        };\r\n        this.items.forEach((item) => {\r\n            if (!item.valid || !item.filterModel || item.filterModel.filterType === 'join') {\r\n                return;\r\n            }\r\n            const { filterModel } = item;\r\n            const { colId } = filterModel;\r\n            const hasColumn = this.advFilterExpSvc.getColumnAutocompleteEntries().find(({ key }) => key === colId);\r\n            const columnDetails = this.advFilterExpSvc.getColumnDetails(filterModel.colId);\r\n            if (!hasColumn || !columnDetails.column) {\r\n                item.valid = false;\r\n                filterModel.colId = undefined as any;\r\n                clearOperator(filterModel);\r\n                clearOperand(filterModel);\r\n                return;\r\n            }\r\n            const operatorForType = this.advFilterExpSvc.getDataTypeExpressionOperator(columnDetails.baseCellDataType)!;\r\n            const operator = operatorForType.operators[filterModel.type];\r\n            if (!operator) {\r\n                item.valid = false;\r\n                clearOperator(filterModel);\r\n                clearOperand(filterModel);\r\n                return;\r\n            }\r\n            if (operator.numOperands > 0 && !_exists((filterModel as any).filter)) {\r\n                item.valid = false;\r\n                return;\r\n            }\r\n        });\r\n    }\r\n}\r\n", "import type { AgEvent } from 'ag-grid-community';\r\nimport { BeanStub, DragSourceType } from 'ag-grid-community';\r\n\r\nimport type { VirtualListDragItem } from '../../features/iVirtualListDragFeature';\r\nimport { VirtualListDragFeature } from '../../features/virtualListDragFeature';\r\nimport type { VirtualList } from '../../widgets/virtualList';\r\nimport type { AdvancedFilterBuilderComp } from './advancedFilterBuilderComp';\r\nimport type { AdvancedFilterBuilderItemComp } from './advancedFilterBuilderItemComp';\r\nimport type { AdvancedFilterBuilderItem } from './iAdvancedFilterBuilder';\r\n\r\nexport interface AdvancedFilterBuilderDragStartedEvent extends AgEvent<'advancedFilterBuilderDragStarted'> {\r\n    item: AdvancedFilterBuilderItem;\r\n}\r\n\r\nexport type AdvancedFilterBuilderDragFeatureEvent =\r\n    | 'advancedFilterBuilderDragStarted'\r\n    | 'advancedFilterBuilderDragEnded';\r\nexport class AdvancedFilterBuilderDragFeature extends BeanStub<AdvancedFilterBuilderDragFeatureEvent> {\r\n    constructor(\r\n        private readonly comp: AdvancedFilterBuilderComp,\r\n        private readonly virtualList: VirtualList\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.createManagedBean(\r\n            new VirtualListDragFeature<\r\n                AdvancedFilterBuilderComp,\r\n                AdvancedFilterBuilderItemComp,\r\n                AdvancedFilterBuilderItem,\r\n                AdvancedFilterBuilderDragStartedEvent\r\n            >(this.comp, this.virtualList, {\r\n                dragSourceType: DragSourceType.AdvancedFilterBuilder,\r\n                listItemDragStartEvent: 'advancedFilterBuilderDragStarted',\r\n                listItemDragEndEvent: 'advancedFilterBuilderDragEnded',\r\n                eventSource: this,\r\n                getCurrentDragValue: (listItemDragStartEvent: AdvancedFilterBuilderDragStartedEvent) =>\r\n                    this.getCurrentDragValue(listItemDragStartEvent),\r\n                isMoveBlocked: () => false,\r\n                getNumRows: (comp: AdvancedFilterBuilderComp) => comp.getNumItems(),\r\n                moveItem: (\r\n                    currentDragValue: AdvancedFilterBuilderItem | null,\r\n                    lastHoveredListItem: VirtualListDragItem<AdvancedFilterBuilderItemComp> | null\r\n                ) => this.moveItem(currentDragValue, lastHoveredListItem),\r\n            })\r\n        );\r\n    }\r\n\r\n    private getCurrentDragValue(\r\n        listItemDragStartEvent: AdvancedFilterBuilderDragStartedEvent\r\n    ): AdvancedFilterBuilderItem {\r\n        return listItemDragStartEvent.item;\r\n    }\r\n\r\n    private moveItem(\r\n        currentDragValue: AdvancedFilterBuilderItem | null,\r\n        lastHoveredListItem: VirtualListDragItem<AdvancedFilterBuilderItemComp> | null\r\n    ): void {\r\n        this.comp.moveItem(currentDragValue, lastHoveredListItem);\r\n    }\r\n}\r\n", "import type {\r\n    AgEvent,\r\n    BeanCollection,\r\n    Component,\r\n    DragAndDropService,\r\n    DragSourceType,\r\n    DraggingEvent,\r\n    DropTarget,\r\n} from 'ag-grid-community';\r\nimport { AutoScrollService, BeanStub, _radioCssClass } from 'ag-grid-community';\r\n\r\nimport type { VirtualList } from '../widgets/virtualList';\r\nimport type { VirtualListDragItem, VirtualListDragParams } from './iVirtualListDragFeature';\r\n\r\nconst LIST_ITEM_HOVERED = 'ag-list-item-hovered';\r\n\r\nexport class VirtualListDragFeature<\r\n    C extends Component<any>,\r\n    R extends Component<any>,\r\n    V,\r\n    E extends AgEvent,\r\n> extends BeanStub {\r\n    private dragAndDrop?: DragAndDropService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.dragAndDrop = beans.dragAndDrop;\r\n    }\r\n\r\n    private currentDragValue: V | null = null;\r\n    private lastHoveredListItem: VirtualListDragItem<R> | null = null;\r\n    private autoScrollService: AutoScrollService;\r\n    private moveBlocked: boolean;\r\n\r\n    constructor(\r\n        private readonly comp: C,\r\n        private readonly virtualList: VirtualList<any>,\r\n        private readonly params: VirtualListDragParams<C, R, V, E>\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.addManagedListeners(this.params.eventSource, {\r\n            [this.params.listItemDragStartEvent]: this.listItemDragStart.bind(this),\r\n            [this.params.listItemDragEndEvent]: this.listItemDragEnd.bind(this),\r\n        });\r\n\r\n        this.createDropTarget();\r\n        this.createAutoScrollService();\r\n    }\r\n\r\n    private listItemDragStart(event: E): void {\r\n        this.currentDragValue = this.params.getCurrentDragValue(event);\r\n        this.moveBlocked = this.params.isMoveBlocked(this.currentDragValue);\r\n    }\r\n\r\n    private listItemDragEnd(): void {\r\n        window.setTimeout(() => {\r\n            this.currentDragValue = null;\r\n            this.moveBlocked = false;\r\n        }, 10);\r\n    }\r\n\r\n    private createDropTarget(): void {\r\n        const dropTarget: DropTarget = {\r\n            isInterestedIn: (type: DragSourceType) => type === this.params.dragSourceType,\r\n            getIconName: () => (this.moveBlocked ? 'pinned' : 'move'),\r\n            getContainer: () => this.comp.getGui(),\r\n            onDragging: (e) => this.onDragging(e),\r\n            onDragStop: () => this.onDragStop(),\r\n            onDragLeave: () => this.onDragLeave(),\r\n            onDragCancel: () => this.onDragCancel(),\r\n        };\r\n\r\n        this.dragAndDrop?.addDropTarget(dropTarget);\r\n    }\r\n\r\n    private createAutoScrollService(): void {\r\n        const virtualListGui = this.virtualList.getGui();\r\n        this.autoScrollService = new AutoScrollService({\r\n            scrollContainer: virtualListGui,\r\n            scrollAxis: 'y',\r\n            getVerticalPosition: () => virtualListGui.scrollTop,\r\n            setVerticalPosition: (position) => (virtualListGui.scrollTop = position),\r\n        });\r\n    }\r\n\r\n    private onDragging(e: DraggingEvent) {\r\n        if (!this.currentDragValue || this.moveBlocked) {\r\n            return;\r\n        }\r\n\r\n        const hoveredListItem = this.getListDragItem(e);\r\n        const comp = this.virtualList.getComponentAt(hoveredListItem.rowIndex);\r\n\r\n        if (!comp) {\r\n            return;\r\n        }\r\n\r\n        const el = comp!.getGui().parentElement as HTMLElement;\r\n\r\n        if (\r\n            this.lastHoveredListItem &&\r\n            this.lastHoveredListItem.rowIndex === hoveredListItem.rowIndex &&\r\n            this.lastHoveredListItem.position === hoveredListItem.position\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        this.autoScrollService.check(e.event);\r\n        this.clearHoveredItems();\r\n        this.lastHoveredListItem = hoveredListItem;\r\n\r\n        _radioCssClass(el, LIST_ITEM_HOVERED);\r\n        _radioCssClass(el, `ag-item-highlight-${hoveredListItem.position}`);\r\n    }\r\n\r\n    private getListDragItem(e: DraggingEvent): VirtualListDragItem<R> {\r\n        const virtualListGui = this.virtualList.getGui();\r\n        const paddingTop = parseFloat(window.getComputedStyle(virtualListGui).paddingTop as string);\r\n        const rowHeight = this.virtualList.getRowHeight();\r\n        const scrollTop = this.virtualList.getScrollTop();\r\n        const rowIndex = Math.max(0, (e.y - paddingTop + scrollTop) / rowHeight);\r\n        const maxLen = this.params.getNumRows(this.comp) - 1;\r\n        const normalizedRowIndex = Math.min(maxLen, rowIndex) | 0;\r\n\r\n        return {\r\n            rowIndex: normalizedRowIndex,\r\n            position: Math.round(rowIndex) > rowIndex || rowIndex > maxLen ? 'bottom' : 'top',\r\n            component: this.virtualList.getComponentAt(normalizedRowIndex) as R,\r\n        };\r\n    }\r\n\r\n    private onDragStop() {\r\n        if (this.moveBlocked) {\r\n            return;\r\n        }\r\n\r\n        this.params.moveItem(this.currentDragValue, this.lastHoveredListItem);\r\n        this.clearDragProperties();\r\n    }\r\n\r\n    private onDragCancel() {\r\n        this.clearDragProperties();\r\n    }\r\n\r\n    private onDragLeave() {\r\n        this.clearDragProperties();\r\n    }\r\n\r\n    private clearDragProperties(): void {\r\n        this.clearHoveredItems();\r\n        this.autoScrollService.ensureCleared();\r\n    }\r\n\r\n    private clearHoveredItems(): void {\r\n        const virtualListGui = this.virtualList.getGui();\r\n        virtualListGui.querySelectorAll(`.${LIST_ITEM_HOVERED}`).forEach((el) => {\r\n            [LIST_ITEM_HOVERED, 'ag-item-highlight-top', 'ag-item-highlight-bottom'].forEach((cls) => {\r\n                (el as HTMLElement).classList.remove(cls);\r\n            });\r\n        });\r\n        this.lastHoveredListItem = null;\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    FieldPickerValueSelectedEvent,\r\n    ITooltipCtrl,\r\n    Registry,\r\n    TooltipFeature,\r\n} from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _setAriaLabel, _setAriaLevel } from 'ag-grid-community';\r\n\r\nimport type { AdvancedFilterExpressionService } from '../advancedFilterExpressionService';\r\nimport { AddDropdownComp } from './addDropdownComp';\r\nimport { AdvancedFilterBuilderItemNavigationFeature } from './advancedFilterBuilderItemNavigationFeature';\r\nimport { getAdvancedFilterBuilderAddButtonParams } from './advancedFilterBuilderUtils';\r\nimport type {\r\n    AdvancedFilterBuilderAddEvent,\r\n    AdvancedFilterBuilderEvents,\r\n    AdvancedFilterBuilderItem,\r\n} from './iAdvancedFilterBuilder';\r\n\r\nexport class AdvancedFilterBuilderItemAddComp extends Component<AdvancedFilterBuilderEvents> {\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n    private registry: Registry;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n        this.registry = beans.registry;\r\n    }\r\n\r\n    private readonly eItem: HTMLElement = RefPlaceholder;\r\n\r\n    constructor(\r\n        private readonly item: AdvancedFilterBuilderItem,\r\n        private readonly focusWrapper: HTMLElement\r\n    ) {\r\n        super(/* html */ `\r\n            <div class=\"ag-advanced-filter-builder-item-wrapper\" role=\"presentation\">\r\n                <div data-ref=\"eItem\" class=\"ag-advanced-filter-builder-item\" role=\"presentation\">\r\n                    <div class=\"ag-advanced-filter-builder-item-tree-lines\" aria-hidden=\"true\">\r\n                        <div class=\"ag-advanced-filter-builder-item-tree-line-vertical-top ag-advanced-filter-builder-item-tree-line-horizontal\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        _setAriaLevel(this.focusWrapper, 2);\r\n\r\n        const addButtonParams = getAdvancedFilterBuilderAddButtonParams(\r\n            (key) => this.advFilterExpSvc.translate(key),\r\n            this.gos.get('advancedFilterBuilderParams')?.addSelectWidth\r\n        );\r\n        const eAddButton = this.createManagedBean(new AddDropdownComp(addButtonParams));\r\n        this.addManagedListeners(eAddButton, {\r\n            fieldPickerValueSelected: ({ value }: FieldPickerValueSelectedEvent) => {\r\n                this.dispatchLocalEvent<AdvancedFilterBuilderAddEvent>({\r\n                    type: 'advancedFilterBuilderAdded',\r\n                    item: this.item,\r\n                    isJoin: value.key === 'join',\r\n                });\r\n            },\r\n        });\r\n        this.eItem.appendChild(eAddButton.getGui());\r\n\r\n        this.createOptionalManagedBean(\r\n            this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => eAddButton.getGui(),\r\n                getLocation: () => 'advancedFilter',\r\n                getTooltipValue: () => this.advFilterExpSvc.translate('advancedFilterBuilderAddButtonTooltip'),\r\n            } as ITooltipCtrl)\r\n        );\r\n\r\n        this.createManagedBean(\r\n            new AdvancedFilterBuilderItemNavigationFeature(this.getGui(), this.focusWrapper, eAddButton)\r\n        );\r\n\r\n        _setAriaLabel(\r\n            this.focusWrapper,\r\n            this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderItem', [\r\n                this.advFilterExpSvc.translate('advancedFilterBuilderAddButtonTooltip'),\r\n                `${this.item.level + 1}`,\r\n            ])\r\n        );\r\n    }\r\n\r\n    public afterAdd(): void {\r\n        // do nothing\r\n    }\r\n}\r\n", "import type { RichSelectParams } from 'ag-grid-community';\r\nimport {\r\n    AgInputTextFieldSelector,\r\n    _setAriaLabel,\r\n    _setAriaLabelledBy,\r\n    _setDisplayed,\r\n    _stopPropagationForAgGrid,\r\n} from 'ag-grid-community';\r\n\r\nimport { AgRichSelect } from '../../widgets/agRichSelect';\r\nimport type { AutocompleteEntry } from '../autocomplete/autocompleteParams';\r\n\r\nexport interface AddDropdownCompParams extends RichSelectParams<AutocompleteEntry> {\r\n    wrapperClassName?: string;\r\n    ariaLabel: string;\r\n}\r\n\r\nexport class AddDropdownComp extends AgRichSelect {\r\n    constructor(private readonly params: AddDropdownCompParams) {\r\n        super({\r\n            ...params,\r\n            template: /* html */ `\r\n                <div class=\"ag-picker-field\" role=\"presentation\">\r\n                    <div data-ref=\"eLabel\"></div>\r\n                    <div data-ref=\"eWrapper\" class=\"ag-wrapper ag-picker-collapsed\">\r\n                        <div data-ref=\"eDisplayField\" class=\"ag-picker-field-display\"></div>\r\n                        <ag-input-text-field data-ref=\"eInput\" class=\"ag-rich-select-field-input\"></ag-input-text-field>\r\n                        <span data-ref=\"eDeselect\" class=\"ag-rich-select-deselect-button ag-picker-field-icon\" role=\"presentation\"></span>\r\n                        <div data-ref=\"eIcon\" class=\"ag-picker-field-icon\" aria-hidden=\"true\"></div>\r\n                    </div>\r\n                </div>`,\r\n            agComponents: [AgInputTextFieldSelector],\r\n        });\r\n    }\r\n\r\n    public override showPicker(): void {\r\n        // avoid focus handling issues with multiple rich selects\r\n        setTimeout(() => super.showPicker());\r\n    }\r\n\r\n    public override hidePicker(): void {\r\n        // avoid focus handling issues with multiple rich selects\r\n        setTimeout(() => super.hidePicker());\r\n    }\r\n\r\n    public override postConstruct(): void {\r\n        super.postConstruct();\r\n\r\n        const { wrapperClassName, ariaLabel } = this.params;\r\n\r\n        _setDisplayed(this.eDisplayField, false);\r\n        if (wrapperClassName) {\r\n            this.eWrapper.classList.add(wrapperClassName);\r\n        }\r\n        _setAriaLabelledBy(this.eWrapper, '');\r\n        _setAriaLabel(this.eWrapper, ariaLabel);\r\n    }\r\n\r\n    protected override onEnterKeyDown(event: KeyboardEvent): void {\r\n        _stopPropagationForAgGrid(event);\r\n        if (this.isPickerDisplayed) {\r\n            super.onEnterKeyDown(event);\r\n        } else {\r\n            event.preventDefault();\r\n            this.showPicker();\r\n        }\r\n    }\r\n}\r\n", "import type {\r\n    AgInputTextField,\r\n    AgPromise,\r\n    AriaAnnouncementService,\r\n    BeanCollection,\r\n    FieldPickerValueSelectedEvent,\r\n    IRichCellEditorRendererParams,\r\n    ITooltipCtrl,\r\n    Registry,\r\n    RichSelectListRowSelectedEvent,\r\n    RichSelectParams,\r\n    TooltipFeature,\r\n    UserCompDetails,\r\n    UserComponentFactory,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgInputTextFieldSelector,\r\n    AgPickerField,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    _bindCellRendererToHtmlElement,\r\n    _clearElement,\r\n    _createIconNoSpan,\r\n    _debounce,\r\n    _escapeString,\r\n    _exists,\r\n    _fuzzySuggestions,\r\n    _getActiveDomElement,\r\n    _getEditorRendererDetails,\r\n    _isEventFromPrintableCharacter,\r\n    _isVisible,\r\n    _setAriaActiveDescendant,\r\n    _shouldDisplayTooltip,\r\n    _stopPropagationForAgGrid,\r\n} from 'ag-grid-community';\r\n\r\nimport { AgPillContainer } from './AgPillContainer';\r\nimport { agRichSelectCSS } from './agRichSelect.css-GENERATED';\r\nimport type { AgRichSelectListEvent } from './agRichSelectList';\r\nimport { AgRichSelectList } from './agRichSelectList';\r\n\r\nexport type AgRichSelectEvent = AgRichSelectListEvent;\r\nexport class AgRichSelect<TValue = any> extends AgPickerField<\r\n    TValue[] | TValue,\r\n    RichSelectParams<TValue>,\r\n    AgRichSelectEvent,\r\n    AgRichSelectList<TValue, AgRichSelectEvent>\r\n> {\r\n    private userCompFactory: UserComponentFactory;\r\n    private ariaAnnounce?: AriaAnnouncementService;\r\n    private registry: Registry;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.userCompFactory = beans.userCompFactory;\r\n        this.ariaAnnounce = beans.ariaAnnounce;\r\n        this.registry = beans.registry;\r\n    }\r\n\r\n    private searchString = '';\r\n    private listComponent: AgRichSelectList<TValue> | undefined;\r\n    private pillContainer: AgPillContainer<TValue> | null;\r\n    protected values: TValue[];\r\n\r\n    private searchStringCreator: ((values: TValue[]) => string[]) | null = null;\r\n    private readonly eInput: AgInputTextField = RefPlaceholder;\r\n    private readonly eDeselect: HTMLSpanElement = RefPlaceholder;\r\n\r\n    private ariaToggleSelection: string;\r\n    private ariaDeselectAllItems: string;\r\n    private ariaDeleteSelection: string;\r\n    private skipWrapperAnnouncement?: boolean = false;\r\n    private tooltipFeature?: TooltipFeature;\r\n    private shouldDisplayTooltip?: () => boolean;\r\n\r\n    constructor(config?: RichSelectParams<TValue>) {\r\n        super({\r\n            pickerAriaLabelKey: 'ariaLabelRichSelectField',\r\n            pickerAriaLabelValue: 'Rich Select Field',\r\n            pickerType: 'ag-list',\r\n            className: 'ag-rich-select',\r\n            pickerIcon: 'richSelectOpen',\r\n            ariaRole: 'combobox',\r\n            template:\r\n                config?.template ??\r\n                /* html */ `\r\n            <div class=\"ag-picker-field\" role=\"presentation\">\r\n                <div data-ref=\"eLabel\"></div>\r\n                <div data-ref=\"eWrapper\" class=\"ag-wrapper ag-picker-field-wrapper ag-rich-select-value ag-picker-collapsed\">\r\n                    <span data-ref=\"eDisplayField\" class=\"ag-picker-field-display\"></span>\r\n                    <ag-input-text-field data-ref=\"eInput\" class=\"ag-rich-select-field-input\"></ag-input-text-field>\r\n                    <span data-ref=\"eDeselect\" class=\"ag-rich-select-deselect-button ag-picker-field-icon\" role=\"presentation\"></span>\r\n                    <span data-ref=\"eIcon\" class=\"ag-picker-field-icon\" aria-hidden=\"true\"></span>\r\n                </div>\r\n            </div>`,\r\n            agComponents: [AgInputTextFieldSelector],\r\n            modalPicker: false,\r\n            ...config,\r\n            // maxPickerHeight needs to be set after expanding `config`\r\n            maxPickerHeight: config?.maxPickerHeight ?? 'calc(var(--ag-row-height) * 6.5)',\r\n        });\r\n\r\n        const { value, valueList, searchStringCreator } = config || {};\r\n\r\n        if (value !== undefined) {\r\n            this.value = value;\r\n        }\r\n\r\n        if (valueList != null) {\r\n            this.values = valueList;\r\n        }\r\n\r\n        if (searchStringCreator) {\r\n            this.searchStringCreator = searchStringCreator;\r\n        }\r\n\r\n        this.registerCSS(agRichSelectCSS);\r\n    }\r\n\r\n    public override postConstruct(): void {\r\n        this.tooltipFeature = this.createOptionalManagedBean(\r\n            this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.getGui(),\r\n                shouldDisplayTooltip: () => this.shouldDisplayTooltip?.() ?? true,\r\n            } as ITooltipCtrl)\r\n        );\r\n        super.postConstruct();\r\n        this.createListComponent();\r\n        this.eDeselect.appendChild(_createIconNoSpan('richSelectRemove', this.beans)!);\r\n\r\n        const { allowTyping, placeholder, suppressDeselectAll } = this.config;\r\n\r\n        this.eDeselect.classList.add('ag-hidden');\r\n\r\n        if (allowTyping) {\r\n            this.eInput.setAutoComplete(false).setInputPlaceholder(placeholder);\r\n            this.eDisplayField.classList.add('ag-hidden');\r\n        } else {\r\n            this.eInput.setDisplayed(false);\r\n        }\r\n\r\n        this.setupAriaProperties();\r\n\r\n        const { searchDebounceDelay = 300 } = this.config;\r\n        this.clearSearchString = _debounce(this, this.clearSearchString.bind(this), searchDebounceDelay);\r\n\r\n        this.renderSelectedValue();\r\n\r\n        if (allowTyping) {\r\n            this.eInput.onValueChange((value) => this.searchTextFromString(value));\r\n        }\r\n\r\n        this.addManagedElementListeners(this.eWrapper, { focus: this.onWrapperFocus.bind(this) });\r\n        this.addManagedElementListeners(this.eWrapper, { focusout: this.onWrapperFocusOut.bind(this) });\r\n\r\n        if (!suppressDeselectAll) {\r\n            this.addManagedElementListeners(this.eDeselect, {\r\n                mousedown: this.onDeselectAllMouseDown.bind(this),\r\n                click: this.onDeselectAllClick.bind(this),\r\n            });\r\n        }\r\n    }\r\n\r\n    private setupAriaProperties(): void {\r\n        const { eWrapper, gos } = this;\r\n\r\n        eWrapper.tabIndex = gos.get('tabIndex');\r\n\r\n        const translate = this.getLocaleTextFunc();\r\n        this.ariaDeleteSelection = translate('ariaLabelRichSelectDeleteSelection', 'Press DELETE to deselect item');\r\n        this.ariaDeselectAllItems = translate(\r\n            'ariaLabelRichSelectDeselectAllItems',\r\n            'Press DELETE to deselect all items'\r\n        );\r\n        this.ariaToggleSelection = translate('ariaLabelRichSelectToggleSelection', 'Press SPACE to toggle selection');\r\n    }\r\n\r\n    private createListComponent(): void {\r\n        this.listComponent = this.createBean(new AgRichSelectList(this.config, this.eWrapper, () => this.searchString));\r\n        this.listComponent.setParentComponent(this);\r\n\r\n        this.addManagedListeners(this.listComponent, {\r\n            richSelectListRowSelected: (e: RichSelectListRowSelectedEvent) => {\r\n                this.onListValueSelected(e.value, e.fromEnterKey);\r\n            },\r\n        });\r\n    }\r\n\r\n    private renderSelectedValue(): void {\r\n        const { value, eDisplayField, config, gos } = this;\r\n        const {\r\n            allowTyping,\r\n            cellRenderer,\r\n            initialInputValue,\r\n            multiSelect,\r\n            suppressDeselectAll,\r\n            suppressMultiSelectPillRenderer,\r\n        } = config;\r\n        const valueFormatted = this.config.valueFormatter ? this.config.valueFormatter(value) : value;\r\n\r\n        if (allowTyping) {\r\n            this.eInput.setValue(initialInputValue ?? valueFormatted);\r\n            return;\r\n        }\r\n\r\n        if (multiSelect && !suppressDeselectAll) {\r\n            const isEmpty = value == null || (Array.isArray(value) && value.length === 0);\r\n            this.eDeselect.classList.toggle('ag-hidden', isEmpty);\r\n        }\r\n\r\n        let userCompDetails: UserCompDetails | undefined;\r\n\r\n        if (multiSelect && !suppressMultiSelectPillRenderer) {\r\n            this.createOrUpdatePillContainer(eDisplayField);\r\n            return;\r\n        }\r\n\r\n        if (cellRenderer) {\r\n            userCompDetails = _getEditorRendererDetails<RichSelectParams, IRichCellEditorRendererParams<TValue>>(\r\n                this.userCompFactory,\r\n                config,\r\n                {\r\n                    value,\r\n                    valueFormatted,\r\n                    getValue: () => this.getValue(),\r\n                    setValue: (value: TValue[] | TValue | null) => {\r\n                        this.setValue(value, true);\r\n                    },\r\n                    setTooltip: (value: string, shouldDisplayTooltip: () => boolean) => {\r\n                        gos.assertModuleRegistered('Tooltip', 3);\r\n                        this.shouldDisplayTooltip = shouldDisplayTooltip;\r\n                        this.tooltipFeature?.setTooltipAndRefresh(value);\r\n                    },\r\n                }\r\n            );\r\n        }\r\n\r\n        let userCompDetailsPromise: AgPromise<any> | undefined;\r\n\r\n        if (userCompDetails) {\r\n            userCompDetailsPromise = userCompDetails.newAgStackInstance();\r\n        }\r\n\r\n        if (userCompDetailsPromise) {\r\n            _clearElement(eDisplayField);\r\n            _bindCellRendererToHtmlElement(userCompDetailsPromise, eDisplayField);\r\n            userCompDetailsPromise.then((renderer) => {\r\n                this.addDestroyFunc(() => this.destroyBean(renderer));\r\n            });\r\n        } else {\r\n            if (_exists(this.value)) {\r\n                eDisplayField.innerText = valueFormatted;\r\n                eDisplayField.classList.remove('ag-display-as-placeholder');\r\n            } else {\r\n                const { placeholder } = config;\r\n                if (_exists(placeholder)) {\r\n                    eDisplayField.innerHTML = `${_escapeString(placeholder)}`;\r\n                    eDisplayField.classList.add('ag-display-as-placeholder');\r\n                } else {\r\n                    _clearElement(eDisplayField);\r\n                }\r\n            }\r\n\r\n            this.shouldDisplayTooltip = _shouldDisplayTooltip(() => this.eDisplayField);\r\n            this.tooltipFeature?.setTooltipAndRefresh(valueFormatted ?? null);\r\n        }\r\n    }\r\n\r\n    protected createPickerComponent() {\r\n        const { values } = this;\r\n\r\n        if (values) {\r\n            this.setValueList({ valueList: values });\r\n        }\r\n\r\n        // do not create the picker every time to save state\r\n        return this.listComponent!;\r\n    }\r\n\r\n    public setSearchStringCreator(searchStringFn: (values: TValue[]) => string[]): void {\r\n        this.searchStringCreator = searchStringFn;\r\n    }\r\n\r\n    public setValueList(params: { valueList: TValue[]; refresh?: boolean }): void {\r\n        const { valueList, refresh } = params;\r\n\r\n        if (!this.listComponent || this.listComponent.getCurrentList() === valueList) {\r\n            return;\r\n        }\r\n\r\n        this.listComponent.setCurrentList(valueList);\r\n\r\n        if (refresh) {\r\n            // if `values` is not present, it means the valuesList was set asynchronously\r\n            if (!this.values) {\r\n                this.values = valueList;\r\n                if (this.isPickerDisplayed) {\r\n                    const hasRefreshed = this.listComponent.selectValue(this.value);\r\n                    if (!hasRefreshed) {\r\n                        this.listComponent.refresh();\r\n                    }\r\n                }\r\n            } else {\r\n                this.listComponent.refresh(true);\r\n            }\r\n\r\n            this.alignPickerToComponent();\r\n        }\r\n    }\r\n\r\n    public override showPicker() {\r\n        super.showPicker();\r\n        const { listComponent, value } = this;\r\n\r\n        if (!listComponent) {\r\n            return;\r\n        }\r\n\r\n        let idx = null;\r\n        if (this.value != null) {\r\n            listComponent.selectValue(this.value);\r\n            idx = listComponent.getIndicesForValues(Array.isArray(value) ? value : [value])[0];\r\n        }\r\n\r\n        if (idx != null) {\r\n            listComponent.highlightIndex(idx);\r\n        } else {\r\n            listComponent.refresh();\r\n        }\r\n\r\n        this.displayOrHidePicker();\r\n    }\r\n\r\n    protected override beforeHidePicker(): void {\r\n        super.beforeHidePicker();\r\n    }\r\n\r\n    private createOrUpdatePillContainer(container: HTMLElement): void {\r\n        if (!this.pillContainer) {\r\n            const pillContainer = (this.pillContainer = this.createBean(new AgPillContainer<TValue>()));\r\n            this.addDestroyFunc(() => {\r\n                this.destroyBean(this.pillContainer);\r\n                this.pillContainer = null;\r\n            });\r\n\r\n            _clearElement(container);\r\n            container.appendChild(pillContainer.getGui());\r\n\r\n            pillContainer.init({\r\n                eWrapper: this.eWrapper,\r\n                onPillMouseDown: (e: MouseEvent) => {\r\n                    e.stopImmediatePropagation();\r\n                },\r\n                announceItemFocus: () => {\r\n                    this.announceAriaValue(this.ariaDeleteSelection);\r\n                },\r\n                getValue: () => this.getValue() as TValue[] | null,\r\n                setValue: (value: TValue[] | null) => this.setValue(value, true),\r\n            });\r\n        }\r\n\r\n        this.doWhileBlockingAnnouncement(() => this.pillContainer?.refresh());\r\n    }\r\n\r\n    private doWhileBlockingAnnouncement(func: () => void): void {\r\n        this.skipWrapperAnnouncement = true;\r\n        func();\r\n        this.skipWrapperAnnouncement = false;\r\n    }\r\n\r\n    private onWrapperFocus(): void {\r\n        const { eInput, config } = this;\r\n        const { allowTyping, multiSelect, suppressDeselectAll } = config;\r\n\r\n        if (allowTyping) {\r\n            const focusableEl = eInput.getFocusableElement() as HTMLInputElement;\r\n            focusableEl.focus();\r\n            focusableEl.select();\r\n        } else if (multiSelect && !suppressDeselectAll && !this.skipWrapperAnnouncement) {\r\n            this.announceAriaValue(this.ariaDeselectAllItems);\r\n        }\r\n    }\r\n\r\n    private onWrapperFocusOut(e: FocusEvent): void {\r\n        if (!this.eWrapper.contains(e.relatedTarget as Element)) {\r\n            this.hidePicker();\r\n        }\r\n    }\r\n\r\n    private onDeselectAllMouseDown(e: MouseEvent): void {\r\n        // don't expand or collapse picker when clicking on deselect all\r\n        e.stopImmediatePropagation();\r\n    }\r\n\r\n    private onDeselectAllClick(): void {\r\n        this.setValue([], true);\r\n    }\r\n\r\n    private buildSearchStringFromKeyboardEvent(searchKey: KeyboardEvent) {\r\n        let { key } = searchKey;\r\n\r\n        if (key === KeyCode.BACKSPACE) {\r\n            this.searchString = this.searchString.slice(0, -1);\r\n            key = '';\r\n        } else if (!_isEventFromPrintableCharacter(searchKey)) {\r\n            return;\r\n        }\r\n\r\n        searchKey.preventDefault();\r\n\r\n        this.searchTextFromCharacter(key);\r\n    }\r\n\r\n    private searchTextFromCharacter(char: string): void {\r\n        this.searchString += char;\r\n        this.runSearch();\r\n        this.clearSearchString();\r\n    }\r\n\r\n    public searchTextFromString(str: string | null | undefined): void {\r\n        if (str == null) {\r\n            str = '';\r\n        }\r\n        this.searchString = str;\r\n        this.runSearch();\r\n    }\r\n\r\n    private buildSearchStrings(values: TValue[]): string[] | undefined {\r\n        const { valueFormatter = (value) => value } = this.config;\r\n\r\n        let searchStrings: string[] | undefined;\r\n        if (typeof values[0] === 'number' || typeof values[0] === 'string') {\r\n            searchStrings = values.map((v) => valueFormatter(v));\r\n        } else if (typeof values[0] === 'object' && this.searchStringCreator) {\r\n            searchStrings = this.searchStringCreator(values);\r\n        }\r\n\r\n        return searchStrings;\r\n    }\r\n\r\n    private filterListModel(filteredValues: TValue[]): void {\r\n        const { filterList } = this.config;\r\n\r\n        if (!filterList) {\r\n            return;\r\n        }\r\n\r\n        this.setValueList({ valueList: filteredValues, refresh: true });\r\n    }\r\n\r\n    private runSearch() {\r\n        if (!this.listComponent) {\r\n            return;\r\n        }\r\n\r\n        const { values } = this;\r\n        const searchStrings = this.buildSearchStrings(values);\r\n\r\n        if (!searchStrings) {\r\n            this.listComponent.highlightIndex(-1);\r\n            return;\r\n        }\r\n\r\n        const { suggestions, filteredValues } = this.getSuggestionsAndFilteredValues(this.searchString, searchStrings);\r\n        const { filterList, highlightMatch, searchType = 'fuzzy' } = this.config;\r\n\r\n        const filterValueLen = filteredValues.length;\r\n        const shouldFilter = !!(filterList && this.searchString !== '');\r\n\r\n        this.filterListModel(shouldFilter ? filteredValues : values);\r\n\r\n        if (suggestions.length) {\r\n            const topSuggestionIndex = shouldFilter ? 0 : searchStrings.indexOf(suggestions[0]);\r\n            this.listComponent?.highlightIndex(topSuggestionIndex);\r\n        } else {\r\n            this.listComponent?.highlightIndex(-1);\r\n\r\n            if (!shouldFilter || filterValueLen) {\r\n                this.listComponent?.ensureIndexVisible(0);\r\n            } else if (shouldFilter) {\r\n                this.getAriaElement().removeAttribute('data-active-option');\r\n                const eListAriaEl = this.listComponent?.getAriaElement();\r\n                if (eListAriaEl) {\r\n                    _setAriaActiveDescendant(eListAriaEl, null);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (highlightMatch && searchType !== 'fuzzy') {\r\n            this.listComponent?.highlightFilterMatch(this.searchString);\r\n        }\r\n\r\n        this.displayOrHidePicker();\r\n    }\r\n\r\n    private getSuggestionsAndFilteredValues(\r\n        searchValue: string,\r\n        valueList: string[]\r\n    ): { suggestions: string[]; filteredValues: TValue[] } {\r\n        let suggestions: string[] = [];\r\n        const filteredValues: TValue[] = [];\r\n\r\n        if (!searchValue.length) {\r\n            return { suggestions, filteredValues };\r\n        }\r\n\r\n        const { searchType = 'fuzzy', filterList } = this.config;\r\n\r\n        if (searchType === 'fuzzy') {\r\n            const fuzzySearchResult = _fuzzySuggestions({\r\n                inputValue: searchValue,\r\n                allSuggestions: valueList,\r\n                hideIrrelevant: true,\r\n                addSequentialWeight: true,\r\n            });\r\n            suggestions = fuzzySearchResult.values;\r\n\r\n            const indices = fuzzySearchResult.indices;\r\n            if (filterList && indices.length) {\r\n                for (let i = 0; i < indices.length; i++) {\r\n                    filteredValues.push(this.values[indices[i]]);\r\n                }\r\n            }\r\n        } else {\r\n            suggestions = valueList.filter((val, idx) => {\r\n                const currentValue = val.toLocaleLowerCase();\r\n                const valueToMatch = this.searchString.toLocaleLowerCase();\r\n\r\n                const isMatch =\r\n                    searchType === 'match'\r\n                        ? currentValue.startsWith(valueToMatch)\r\n                        : currentValue.indexOf(valueToMatch) !== -1;\r\n                if (filterList && isMatch) {\r\n                    filteredValues.push(this.values[idx]);\r\n                }\r\n                return isMatch;\r\n            });\r\n        }\r\n\r\n        return { suggestions, filteredValues };\r\n    }\r\n\r\n    private displayOrHidePicker(): void {\r\n        if (!this.listComponent) {\r\n            return;\r\n        }\r\n\r\n        const eListGui = this.listComponent.getGui();\r\n        const list = this.listComponent.getCurrentList();\r\n        const toggleValue = list ? list.length === 0 : false;\r\n\r\n        eListGui.classList.toggle('ag-hidden', toggleValue);\r\n    }\r\n\r\n    private clearSearchString(): void {\r\n        this.searchString = '';\r\n    }\r\n\r\n    public override setValue(\r\n        value: TValue[] | TValue | null,\r\n        silent?: boolean,\r\n        fromPicker?: boolean,\r\n        skipRendering?: boolean\r\n    ): this {\r\n        if (this.value === value) {\r\n            return this;\r\n        }\r\n\r\n        const isArray = Array.isArray(value);\r\n\r\n        if (value != null) {\r\n            if (!isArray) {\r\n                const list = this.listComponent?.getCurrentList();\r\n                const index = list ? list.indexOf(value) : -1;\r\n\r\n                if (index === -1) {\r\n                    return this;\r\n                }\r\n            }\r\n\r\n            if (!fromPicker) {\r\n                this.listComponent?.selectValue(value);\r\n            }\r\n        }\r\n\r\n        super.setValue(value, silent);\r\n\r\n        if (!skipRendering) {\r\n            this.renderSelectedValue();\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    private onNavigationKeyDown(event: any, key: string, announceItem: () => void): void {\r\n        // if we don't preventDefault the page body and/or grid scroll will move.\r\n        event.preventDefault();\r\n\r\n        const isDown = key === KeyCode.DOWN;\r\n\r\n        if (!this.isPickerDisplayed && isDown) {\r\n            this.showPicker();\r\n            return;\r\n        }\r\n\r\n        this.listComponent?.onNavigationKeyDown(key, announceItem);\r\n    }\r\n\r\n    protected onEnterKeyDown(e: KeyboardEvent): void {\r\n        if (!this.isPickerDisplayed) {\r\n            return;\r\n        }\r\n        e.preventDefault();\r\n\r\n        if (this.listComponent?.getCurrentList()) {\r\n            const lastRowHovered = this.listComponent.getLastItemHovered();\r\n            if (this.config.multiSelect || lastRowHovered == null) {\r\n                this.dispatchPickerEventAndHidePicker(this.value, true);\r\n            } else {\r\n                this.onListValueSelected(new Set<TValue>([lastRowHovered]), true);\r\n            }\r\n        }\r\n    }\r\n\r\n    private onDeleteKeyDown(e: KeyboardEvent): void {\r\n        const { eWrapper, beans } = this;\r\n        const activeEl = _getActiveDomElement(beans);\r\n\r\n        if (activeEl === eWrapper) {\r\n            e.preventDefault();\r\n            this.setValue([], true);\r\n        }\r\n    }\r\n\r\n    private onTabKeyDown(): void {\r\n        const { config, isPickerDisplayed, listComponent } = this;\r\n        const { multiSelect } = config;\r\n\r\n        if (!isPickerDisplayed || !listComponent) {\r\n            return;\r\n        }\r\n\r\n        if (multiSelect) {\r\n            const values = this.getValueFromSet(listComponent.getSelectedItems());\r\n\r\n            if (values) {\r\n                this.setValue(values, false, true, true);\r\n            }\r\n        } else {\r\n            this.setValue(listComponent.getLastItemHovered(), false, true);\r\n        }\r\n        this.hidePicker();\r\n    }\r\n\r\n    private getValueFromSet(valueSet: Set<TValue>): TValue[] | TValue | null {\r\n        const { multiSelect } = this.config;\r\n        let newValue: TValue[] | TValue | null = null;\r\n\r\n        for (const value of valueSet) {\r\n            if (valueSet.size === 1 && !multiSelect) {\r\n                newValue = value;\r\n                break;\r\n            }\r\n            if (!newValue) {\r\n                newValue = [];\r\n            }\r\n            (newValue as TValue[]).push(value);\r\n        }\r\n\r\n        if (Array.isArray(newValue)) {\r\n            newValue.sort();\r\n        }\r\n\r\n        return newValue;\r\n    }\r\n\r\n    private onListValueSelected(valueSet: Set<TValue>, fromEnterKey: boolean): void {\r\n        const newValue = this.getValueFromSet(valueSet);\r\n\r\n        this.setValue(newValue, false, true);\r\n\r\n        if (!this.config.multiSelect) {\r\n            this.dispatchPickerEventAndHidePicker(newValue, fromEnterKey);\r\n        }\r\n    }\r\n\r\n    private dispatchPickerEventAndHidePicker(value: TValue[] | TValue | null, fromEnterKey: boolean): void {\r\n        const event: WithoutGridCommon<FieldPickerValueSelectedEvent> = {\r\n            type: 'fieldPickerValueSelected',\r\n            fromEnterKey,\r\n            value,\r\n        };\r\n\r\n        this.dispatchLocalEvent(event);\r\n        this.hidePicker();\r\n    }\r\n\r\n    public override getFocusableElement(): HTMLElement {\r\n        const { allowTyping } = this.config;\r\n\r\n        if (allowTyping) {\r\n            return this.eInput.getFocusableElement();\r\n        }\r\n\r\n        return super.getFocusableElement();\r\n    }\r\n\r\n    protected override onKeyDown(e: KeyboardEvent): void {\r\n        const { key } = e;\r\n\r\n        const { isPickerDisplayed, config, listComponent, pickerComponent } = this;\r\n        const { allowTyping, multiSelect, suppressDeselectAll } = config;\r\n\r\n        switch (key) {\r\n            case KeyCode.LEFT:\r\n            case KeyCode.RIGHT:\r\n                if (!allowTyping || this.pillContainer) {\r\n                    e.preventDefault();\r\n                    if (this.pillContainer) {\r\n                        this.listComponent?.highlightIndex(-1);\r\n                        this.pillContainer.onNavigationKeyDown(e);\r\n                    }\r\n                }\r\n                break;\r\n            case KeyCode.PAGE_HOME:\r\n            case KeyCode.PAGE_END:\r\n                if (allowTyping) {\r\n                    e.preventDefault();\r\n                    const inputEl = this.eInput.getInputElement();\r\n                    const target = key === KeyCode.PAGE_HOME ? 0 : inputEl.value.length;\r\n                    inputEl.setSelectionRange(target, target);\r\n                    break;\r\n                }\r\n            // Only break here for allowTyping, otherwise use the same logic as PageUp/PageDown\r\n            // eslint-disable-next-line\r\n            case KeyCode.PAGE_UP:\r\n            case KeyCode.PAGE_DOWN:\r\n                e.preventDefault();\r\n                if (pickerComponent) {\r\n                    listComponent?.navigateToPage(key);\r\n                }\r\n                break;\r\n            case KeyCode.DOWN:\r\n            case KeyCode.UP:\r\n                this.onNavigationKeyDown(e, key, () => {\r\n                    if (multiSelect) {\r\n                        this.doWhileBlockingAnnouncement(() => this.eWrapper.focus());\r\n                        this.announceAriaValue(this.ariaToggleSelection);\r\n                    }\r\n                });\r\n                break;\r\n            case KeyCode.ESCAPE:\r\n                if (isPickerDisplayed) {\r\n                    if (_isVisible(this.listComponent!.getGui())) {\r\n                        e.preventDefault();\r\n                        _stopPropagationForAgGrid(e);\r\n                    }\r\n                    this.hidePicker();\r\n                }\r\n                break;\r\n            case KeyCode.ENTER:\r\n                this.onEnterKeyDown(e);\r\n                break;\r\n            case KeyCode.SPACE:\r\n                if (isPickerDisplayed && multiSelect && listComponent) {\r\n                    e.preventDefault();\r\n                    const lastItemHovered = listComponent.getLastItemHovered();\r\n\r\n                    if (lastItemHovered) {\r\n                        listComponent.toggleListItemSelection(lastItemHovered);\r\n                    }\r\n                }\r\n                break;\r\n            case KeyCode.TAB:\r\n                this.onTabKeyDown();\r\n                break;\r\n            case KeyCode.DELETE:\r\n                if (multiSelect && !suppressDeselectAll) {\r\n                    this.onDeleteKeyDown(e);\r\n                }\r\n                break;\r\n            default:\r\n                if (!allowTyping) {\r\n                    this.buildSearchStringFromKeyboardEvent(e);\r\n                }\r\n        }\r\n    }\r\n\r\n    private announceAriaValue(value: string): void {\r\n        this.ariaAnnounce?.announceValue(value, 'richSelect');\r\n    }\r\n\r\n    public override destroy(): void {\r\n        if (this.listComponent) {\r\n            this.listComponent = this.destroyBean(this.listComponent);\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n}\r\n", "import {\r\n    Component,\r\n    KeyCode,\r\n    _clearElement,\r\n    _findFocusableElements,\r\n    _findNextFocusableElement,\r\n    _getActiveDomElement,\r\n    _getDocument,\r\n    _setAriaPosInSet,\r\n    _setAriaSetSize,\r\n} from 'ag-grid-community';\r\n\r\nimport { AgPill } from './agPill';\r\n\r\nexport interface PillRendererParams<TValue> {\r\n    eWrapper?: HTMLElement;\r\n    announceItemFocus?: () => void;\r\n    onPillMouseDown?: (e: MouseEvent) => void;\r\n    getValue: () => TValue[] | null;\r\n    setValue: (value: TValue[] | null) => void;\r\n}\r\n\r\nexport class AgPillContainer<TValue> extends Component {\r\n    private params: PillRendererParams<TValue>;\r\n    private pills: AgPill[] = [];\r\n\r\n    constructor() {\r\n        super(/* html */ `\r\n            <div class=\"ag-pill-container\" role=\"listbox\"></div>\r\n            `);\r\n    }\r\n\r\n    public init(params: PillRendererParams<TValue>) {\r\n        this.params = params;\r\n        this.refresh();\r\n    }\r\n\r\n    public refresh(): void {\r\n        this.clearPills();\r\n\r\n        const { params, onPillKeyDown } = this;\r\n\r\n        const values = params.getValue();\r\n\r\n        if (!Array.isArray(values)) {\r\n            return;\r\n        }\r\n\r\n        const len = values.length;\r\n\r\n        for (let i = 0; i < len; i++) {\r\n            const value = values[i];\r\n            const pill: AgPill = this.createBean(\r\n                new AgPill({\r\n                    onButtonClick: () => this.onPillButtonClick(pill),\r\n                    onKeyDown: onPillKeyDown.bind(this),\r\n                })\r\n            );\r\n\r\n            const pillGui = pill.getGui();\r\n\r\n            _setAriaPosInSet(pillGui, i + 1);\r\n            _setAriaSetSize(pillGui, len);\r\n\r\n            if (params.onPillMouseDown) {\r\n                pill.addGuiEventListener('mousedown', params.onPillMouseDown);\r\n            }\r\n\r\n            if (params.announceItemFocus) {\r\n                pill.addGuiEventListener('focus', params.announceItemFocus);\r\n            }\r\n\r\n            pill.setText(value as string);\r\n            pill.toggleCloseButtonClass('ag-icon-cancel', true);\r\n            this.appendChild(pillGui);\r\n            this.pills.push(pill);\r\n        }\r\n    }\r\n\r\n    public onNavigationKeyDown(e: KeyboardEvent): void {\r\n        const { key } = e;\r\n\r\n        if (!this.pills.length || (key !== KeyCode.LEFT && key !== KeyCode.RIGHT)) {\r\n            return;\r\n        }\r\n\r\n        e.preventDefault();\r\n\r\n        const { params, beans } = this;\r\n        const activeEl = _getActiveDomElement(beans);\r\n        const eGui = this.getGui();\r\n\r\n        if (eGui.contains(activeEl)) {\r\n            const nextFocusableEl = _findNextFocusableElement(beans, eGui, false, key === KeyCode.LEFT);\r\n\r\n            if (nextFocusableEl) {\r\n                nextFocusableEl.focus();\r\n            } else if (params.eWrapper) {\r\n                params.eWrapper.focus();\r\n            }\r\n        } else {\r\n            const focusableElements = _findFocusableElements(eGui);\r\n            if (focusableElements.length > 0) {\r\n                focusableElements[key === KeyCode.RIGHT ? 0 : focusableElements.length - 1].focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    private clearPills(): void {\r\n        const eGui = this.getGui();\r\n\r\n        if (eGui.contains(_getActiveDomElement(this.beans)) && this.params.eWrapper) {\r\n            this.params.eWrapper.focus();\r\n        }\r\n\r\n        _clearElement(eGui);\r\n        this.destroyBeans(this.pills);\r\n        this.pills = [];\r\n    }\r\n\r\n    private onPillButtonClick(pill: AgPill): void {\r\n        this.deletePill(pill);\r\n    }\r\n\r\n    private onPillKeyDown(e: KeyboardEvent): void {\r\n        const key = e.key;\r\n\r\n        if (key !== KeyCode.DELETE && key !== KeyCode.BACKSPACE) {\r\n            return;\r\n        }\r\n\r\n        e.preventDefault();\r\n\r\n        const eDoc = _getDocument(this.beans);\r\n        const pillIndex = this.pills.findIndex((pill) => pill.getGui().contains(eDoc.activeElement));\r\n\r\n        if (pillIndex === -1) {\r\n            return;\r\n        }\r\n\r\n        const pill = this.pills[pillIndex];\r\n\r\n        if (pill) {\r\n            this.deletePill(pill, pillIndex);\r\n        }\r\n    }\r\n\r\n    private deletePill(pill: AgPill, restoreFocusToIndex?: number): void {\r\n        const value = pill.getText();\r\n        const values = (this.params.getValue() || []).filter((val) => val !== value);\r\n        this.params.setValue(values);\r\n\r\n        if (!values.length && this.params.eWrapper) {\r\n            this.params.eWrapper.focus();\r\n        } else if (restoreFocusToIndex != null) {\r\n            const pill = this.pills[Math.min(restoreFocusToIndex, this.pills.length - 1)];\r\n            if (pill) {\r\n                pill.getFocusableElement().focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.clearPills();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import { RefPlaceholder } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nexport interface PillConfig {\r\n    onKeyDown?: (e?: KeyboardEvent) => void;\r\n    onButtonClick?: (e?: MouseEvent) => void;\r\n}\r\n\r\nexport class AgPill extends Component {\r\n    private readonly eText: HTMLElement = RefPlaceholder;\r\n    private readonly eButton: HTMLElement = RefPlaceholder;\r\n\r\n    constructor(private readonly config: PillConfig) {\r\n        super(/* html */ `\r\n            <div class=\"ag-pill\" role=\"option\">\r\n                <span class=\"ag-pill-text\" data-ref=\"eText\"></span>\r\n                <span class=\"ag-button ag-pill-button\" data-ref=\"eButton\" role=\"presentation\"></span>\r\n            </div>\r\n        `);\r\n    }\r\n\r\n    public postConstruct() {\r\n        const { config, eButton } = this;\r\n        const { onKeyDown, onButtonClick } = config;\r\n\r\n        this.getGui().setAttribute('tabindex', String(this.gos.get('tabIndex')));\r\n\r\n        this.addGuiEventListener('focus', () => {\r\n            this.eButton.focus();\r\n        });\r\n\r\n        if (onKeyDown) {\r\n            this.addGuiEventListener('keydown', onKeyDown);\r\n        }\r\n\r\n        if (onButtonClick) {\r\n            this.addManagedElementListeners(eButton, {\r\n                click: onButtonClick,\r\n            });\r\n        }\r\n    }\r\n\r\n    public toggleCloseButtonClass(className: string, force?: boolean) {\r\n        this.eButton.classList.toggle(className, force);\r\n    }\r\n\r\n    public setText(text: string) {\r\n        this.eText.textContent = text;\r\n    }\r\n\r\n    public getText(): string | null {\r\n        return this.eText.textContent;\r\n    }\r\n}\r\n", "export const agRichSelectCSS = /*css*/ `.ag-rich-select{cursor:default;height:100%}.ag-rich-select-value{align-items:center;background-color:var(--ag-input-background-color);display:flex;height:100%;padding:var(--ag-spacing);:where(.ag-picker-field-display){overflow:hidden;text-overflow:ellipsis;&:where(.ag-display-as-placeholder){opacity:.5}}}.ag-rich-select-list{background-color:var(--ag-input-background-color);border:var(--ag-input-border);border-radius:var(--ag-input-border-radius);box-shadow:var(--ag-dropdown-shadow);height:auto;position:relative;width:100%;:where(.ag-loading-text){padding:var(--ag-widget-container-vertical-padding) var(--ag-widget-container-horizontal-padding)}}.ag-rich-select-row{align-items:center;display:flex;flex:1 1 auto;height:100%;overflow:hidden;padding:0 var(--ag-spacing);white-space:nowrap}.ag-rich-select-row-selected{background-color:var(--ag-selected-row-background-color)}.ag-rich-select-row-highlighted,.ag-rich-select-row:hover{background-image:linear-gradient(var(--ag-row-hover-color),var(--ag-row-hover-color))}.ag-rich-select-row-text-highlight{font-weight:700}.ag-rich-select-field-input{flex:1 1 auto;:where(.ag-input-field-input){border:none!important;box-shadow:none!important;padding:0!important;text-overflow:ellipsis;&::-moz-placeholder{opacity:.8}&::placeholder{opacity:.8}}}:where(.ag-ltr) .ag-rich-select-field-input{left:var(--ag-spacing)}:where(.ag-rtl) .ag-rich-select-field-input{right:var(--ag-spacing)}:where(.ag-popup-editor) .ag-rich-select-value{height:var(--ag-row-height);min-width:200px}.ag-rich-select-virtual-list-item{cursor:default;height:var(--ag-list-item-height)}.ag-pill-container{display:flex;flex-wrap:nowrap;gap:.25rem}.ag-pill{align-items:center;background:var(--ag-select-cell-background-color);border:var(--ag-select-cell-border);border-radius:var(--ag-border-radius);display:flex;padding:0 .25rem;white-space:nowrap}.ag-pill-button{border:none;padding:0;&:hover{color:var(--ag-accent-color);cursor:pointer}}:where(.ag-ltr) .ag-pill-button{margin-left:var(--ag-spacing)}:where(.ag-rtl) .ag-pill-button{margin-right:var(--ag-spacing)}`;\n", "import type { Component, RichSelectParams } from 'ag-grid-community';\r\nimport {\r\n    KeyCode,\r\n    _getDocument,\r\n    _requestAnimationFrame,\r\n    _setAriaActiveDescendant,\r\n    _setAriaControls,\r\n    _setAriaLabel,\r\n} from 'ag-grid-community';\r\n\r\nimport { RichSelectRow } from './agRichSelectRow';\r\nimport { VirtualList } from './virtualList';\r\n\r\nexport type AgRichSelectListEvent = 'fieldPickerValueSelected' | 'richSelectListRowSelected';\r\n\r\nconst LIST_COMPONENT_NAME = 'ag-rich-select-list';\r\nconst ROW_COMPONENT_NAME = 'ag-rich-select-row';\r\n\r\nexport class AgRichSelectList<TValue, TEventType extends string = AgRichSelectListEvent> extends VirtualList<\r\n    Component<TEventType | AgRichSelectListEvent>,\r\n    TEventType | AgRichSelectListEvent\r\n> {\r\n    private eLoading: HTMLElement | undefined;\r\n    private lastRowHovered: number = -1;\r\n    private currentList: TValue[] | undefined;\r\n    private selectedItems: Set<TValue> = new Set<TValue>();\r\n\r\n    constructor(\r\n        private readonly params: RichSelectParams,\r\n        private readonly richSelectWrapper: HTMLElement,\r\n        private readonly getSearchString: () => string\r\n    ) {\r\n        super({ cssIdentifier: 'rich-select' });\r\n        this.params = params;\r\n        this.setComponentCreator(this.createRowComponent.bind(this));\r\n        /* nothing to update but method required to soft refresh */\r\n        this.setComponentUpdater(() => {});\r\n    }\r\n\r\n    public override postConstruct(): void {\r\n        super.postConstruct();\r\n        this.createLoadingElement();\r\n\r\n        const { cellRowHeight, pickerAriaLabelKey, pickerAriaLabelValue } = this.params;\r\n\r\n        if (cellRowHeight) {\r\n            this.setRowHeight(cellRowHeight);\r\n        }\r\n\r\n        const eGui = this.getGui();\r\n        const eListAriaEl = this.getAriaElement();\r\n\r\n        this.addManagedListeners(eGui, {\r\n            mousemove: this.onMouseMove.bind(this),\r\n            mouseout: this.onMouseOut.bind(this),\r\n            mousedown: this.onMouseDown.bind(this),\r\n            click: this.onClick.bind(this),\r\n        });\r\n\r\n        eGui.classList.add(LIST_COMPONENT_NAME);\r\n\r\n        const listId = `${LIST_COMPONENT_NAME}-${this.getCompId()}`;\r\n        eListAriaEl.setAttribute('id', listId);\r\n        const translate = this.getLocaleTextFunc();\r\n        const ariaLabel = translate(pickerAriaLabelKey, pickerAriaLabelValue);\r\n\r\n        _setAriaLabel(eListAriaEl, ariaLabel);\r\n        _setAriaControls(this.richSelectWrapper, eListAriaEl);\r\n    }\r\n\r\n    public override navigateToPage(key: 'PageUp' | 'PageDown' | 'Home' | 'End'): number | null {\r\n        const newIndex = super.navigateToPage(key, this.lastRowHovered);\r\n\r\n        if (newIndex != null) {\r\n            _requestAnimationFrame(this.beans, () => {\r\n                if (!this.isAlive()) {\r\n                    return null;\r\n                }\r\n                this.highlightIndex(newIndex);\r\n            });\r\n        }\r\n\r\n        return newIndex;\r\n    }\r\n\r\n    protected override drawVirtualRows(softRefresh?: boolean | undefined): void {\r\n        super.drawVirtualRows(softRefresh);\r\n\r\n        this.refreshSelectedItems();\r\n    }\r\n\r\n    public highlightFilterMatch(searchString: string): void {\r\n        this.forEachRenderedRow((cmp: RichSelectRow<TValue>) => {\r\n            cmp.highlightString(searchString);\r\n        });\r\n    }\r\n\r\n    public onNavigationKeyDown(key: string, announceItem: () => void): void {\r\n        _requestAnimationFrame(this.beans, () => {\r\n            if (!this.currentList || !this.isAlive()) {\r\n                return;\r\n            }\r\n            const len = this.currentList.length;\r\n            const oldIndex = this.lastRowHovered;\r\n\r\n            const diff = key === KeyCode.DOWN ? 1 : -1;\r\n            const newIndex = Math.min(Math.max(oldIndex === -1 ? 0 : oldIndex + diff, 0), len - 1);\r\n            this.highlightIndex(newIndex);\r\n            announceItem();\r\n        });\r\n    }\r\n\r\n    public selectValue(value?: TValue[] | TValue): boolean {\r\n        if (!this.currentList) {\r\n            if (this.eLoading) {\r\n                this.appendChild(this.eLoading);\r\n            }\r\n            return false;\r\n        }\r\n\r\n        if (this.eLoading?.offsetParent) {\r\n            this.eLoading.parentElement?.removeChild(this.eLoading);\r\n        }\r\n\r\n        if (value == null) {\r\n            return false;\r\n        }\r\n\r\n        const selectedPositions = this.getIndicesForValues(value);\r\n\r\n        const refresh = selectedPositions.length > 0;\r\n\r\n        if (refresh) {\r\n            // make sure the virtual list has been sized correctly\r\n            this.refresh();\r\n            this.ensureIndexVisible(selectedPositions[0]);\r\n            // this second call to refresh is necessary to force scrolled elements\r\n            // to be rendered with the correct index info.\r\n            this.refresh(true);\r\n        }\r\n\r\n        this.selectListItems(Array.isArray(value) ? value : [value]);\r\n\r\n        return refresh;\r\n    }\r\n\r\n    private selectListItems(values: TValue[], append = false): void {\r\n        if (!append) {\r\n            this.selectedItems.clear();\r\n        }\r\n\r\n        for (let i = 0; i < values.length; i++) {\r\n            const currentItem = values[i];\r\n            if (this.selectedItems.has(currentItem)) {\r\n                continue;\r\n            }\r\n            this.selectedItems.add(currentItem);\r\n        }\r\n\r\n        this.refreshSelectedItems();\r\n    }\r\n\r\n    public getCurrentList(): TValue[] | undefined {\r\n        return this.currentList;\r\n    }\r\n\r\n    public setCurrentList(list: TValue[]): void {\r\n        this.currentList = list;\r\n\r\n        this.setModel({\r\n            getRowCount: () => list.length,\r\n            getRow: (index: number) => list[index],\r\n            areRowsEqual: (oldRow, newRow) => oldRow === newRow,\r\n        });\r\n    }\r\n\r\n    public getSelectedItems(): Set<TValue> {\r\n        return this.selectedItems;\r\n    }\r\n\r\n    public getLastItemHovered(): TValue {\r\n        return this.currentList![this.lastRowHovered];\r\n    }\r\n\r\n    public highlightIndex(index: number, preventUnnecessaryScroll?: boolean): void {\r\n        if (!this.currentList) {\r\n            return;\r\n        }\r\n\r\n        if (index < 0 || index >= this.currentList.length) {\r\n            this.lastRowHovered = -1;\r\n        } else {\r\n            this.lastRowHovered = index;\r\n\r\n            const wasScrolled = this.ensureIndexVisible(index, !preventUnnecessaryScroll);\r\n\r\n            if (wasScrolled && !preventUnnecessaryScroll) {\r\n                this.refresh(true);\r\n            }\r\n        }\r\n\r\n        this.forEachRenderedRow((cmp: RichSelectRow<TValue>, idx: number) => {\r\n            const highlighted = index === idx;\r\n\r\n            cmp.toggleHighlighted(highlighted);\r\n\r\n            if (highlighted) {\r\n                const idForParent = `${ROW_COMPONENT_NAME}-${cmp.getCompId()}`;\r\n                _setAriaActiveDescendant(this.richSelectWrapper, idForParent);\r\n                this.richSelectWrapper.setAttribute('data-active-option', idForParent);\r\n            }\r\n        });\r\n    }\r\n\r\n    public getIndicesForValues(values?: TValue[] | TValue): number[] {\r\n        const { currentList } = this;\r\n\r\n        if (!currentList || currentList.length === 0 || values == null) {\r\n            return [];\r\n        }\r\n\r\n        if (!Array.isArray(values)) {\r\n            values = [values] as TValue[];\r\n        }\r\n\r\n        if (values.length === 0) {\r\n            return [];\r\n        }\r\n\r\n        const positions: number[] = [];\r\n\r\n        for (let i = 0; i < values.length; i++) {\r\n            const idx = currentList.indexOf(values[i]);\r\n            if (idx >= 0) {\r\n                positions.push(idx);\r\n            }\r\n        }\r\n\r\n        return positions;\r\n    }\r\n\r\n    public toggleListItemSelection(value: TValue): void {\r\n        if (this.selectedItems.has(value)) {\r\n            this.selectedItems.delete(value);\r\n        } else {\r\n            this.selectedItems.add(value);\r\n        }\r\n\r\n        this.refreshSelectedItems();\r\n        this.dispatchValueSelected();\r\n    }\r\n\r\n    private refreshSelectedItems(): void {\r\n        this.forEachRenderedRow((cmp: RichSelectRow<TValue>) => {\r\n            const selected = this.selectedItems.has(cmp.getValue());\r\n            cmp.updateSelected(selected);\r\n        });\r\n    }\r\n\r\n    private createLoadingElement(): void {\r\n        const eDocument = _getDocument(this.beans);\r\n        const translate = this.getLocaleTextFunc();\r\n        const el = eDocument.createElement('div');\r\n\r\n        el.classList.add('ag-loading-text');\r\n        el.innerText = translate('loadingOoo', 'Loading...');\r\n        this.eLoading = el;\r\n    }\r\n\r\n    private createRowComponent(value: TValue, listItemElement: HTMLElement): Component<AgRichSelectListEvent> {\r\n        const row = new RichSelectRow<TValue>(this.params);\r\n        listItemElement.setAttribute('id', `${ROW_COMPONENT_NAME}-${row.getCompId()}`);\r\n        row.setParentComponent(this);\r\n        this.createBean(row);\r\n        row.setState(value);\r\n\r\n        const { highlightMatch, searchType = 'fuzzy' } = this.params;\r\n\r\n        if (highlightMatch && searchType !== 'fuzzy') {\r\n            row.highlightString(this.getSearchString());\r\n        }\r\n\r\n        return row;\r\n    }\r\n\r\n    private getRowForMouseEvent(e: MouseEvent): number {\r\n        const eGui = this.getGui();\r\n        const rect = eGui.getBoundingClientRect();\r\n        const scrollTop = this.getScrollTop();\r\n        const mouseY = e.clientY - rect.top + scrollTop;\r\n\r\n        return Math.floor(mouseY / this.getRowHeight());\r\n    }\r\n\r\n    private onMouseMove(e: MouseEvent): void {\r\n        const row = this.getRowForMouseEvent(e);\r\n\r\n        if (row !== -1 && row != this.lastRowHovered) {\r\n            this.lastRowHovered = row;\r\n            this.highlightIndex(row, true);\r\n        }\r\n    }\r\n\r\n    private onMouseDown(e: MouseEvent): void {\r\n        // this prevents the list from receiving focus as it\r\n        // should be controlled by the agRichSelect component\r\n        e.preventDefault();\r\n    }\r\n\r\n    private onMouseOut(e: MouseEvent): void {\r\n        if (!this.getGui().contains(e.relatedTarget as HTMLElement)) {\r\n            this.highlightIndex(-1);\r\n        }\r\n    }\r\n\r\n    private onClick(e: MouseEvent): void {\r\n        const { multiSelect } = this.params;\r\n\r\n        if (!this.currentList) {\r\n            return;\r\n        }\r\n\r\n        const row = this.getRowForMouseEvent(e);\r\n        const item = this.currentList[row];\r\n\r\n        if (multiSelect) {\r\n            this.toggleListItemSelection(item);\r\n        } else {\r\n            this.selectListItems([item]);\r\n            this.dispatchValueSelected();\r\n        }\r\n    }\r\n\r\n    private dispatchValueSelected(): void {\r\n        this.dispatchLocalEvent({\r\n            type: 'richSelectListRowSelected',\r\n            fromEnterKey: false,\r\n            value: this.selectedItems,\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n        this.eLoading = undefined;\r\n    }\r\n}\r\n", "import type {\r\n    AgPromise,\r\n    BeanCollection,\r\n    IRichCellEditorRendererParams,\r\n    ITooltipCtrl,\r\n    Registry,\r\n    RichSelectParams,\r\n    TooltipFeature,\r\n    UserCompDetails,\r\n    UserComponentFactory,\r\n} from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    _bindCellRendererToHtmlElement,\r\n    _escapeString,\r\n    _exists,\r\n    _getDocument,\r\n    _getEditorRendererDetails,\r\n    _setAriaSelected,\r\n    _shouldDisplayTooltip,\r\n} from 'ag-grid-community';\r\n\r\nimport type { AgRichSelect } from './agRichSelect';\r\n\r\nexport class RichSelectRow<TValue> extends Component {\r\n    private userCompFactory: UserComponentFactory;\r\n    private registry: Registry;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.userCompFactory = beans.userCompFactory;\r\n        this.registry = beans.registry;\r\n    }\r\n\r\n    private value: TValue;\r\n    private parsedValue: string | null;\r\n    private tooltipFeature?: TooltipFeature;\r\n    private shouldDisplayTooltip?: () => boolean;\r\n\r\n    constructor(private readonly params: RichSelectParams<TValue>) {\r\n        super(/* html */ `<div class=\"ag-rich-select-row\" role=\"presentation\"></div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.tooltipFeature = this.createOptionalManagedBean(\r\n            this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.getGui(),\r\n                shouldDisplayTooltip: () => this.shouldDisplayTooltip?.() ?? true,\r\n            } as ITooltipCtrl)\r\n        );\r\n    }\r\n\r\n    public setState(value: TValue): void {\r\n        let formattedValue: string = '';\r\n\r\n        const { params } = this;\r\n\r\n        if (params.valueFormatter) {\r\n            formattedValue = params.valueFormatter(value);\r\n        }\r\n        const rendererSuccessful = this.populateWithRenderer(value, formattedValue);\r\n        if (!rendererSuccessful) {\r\n            this.populateWithoutRenderer(value, formattedValue);\r\n        }\r\n\r\n        this.value = value;\r\n    }\r\n\r\n    public highlightString(matchString: string): void {\r\n        const { parsedValue } = this;\r\n\r\n        if (this.params.cellRenderer || !_exists(parsedValue)) {\r\n            return;\r\n        }\r\n\r\n        let hasMatch = _exists(matchString);\r\n\r\n        if (hasMatch) {\r\n            const index = parsedValue?.toLocaleLowerCase().indexOf(matchString.toLocaleLowerCase());\r\n            if (index >= 0) {\r\n                const highlightEndIndex = index + matchString.length;\r\n                const startPart = _escapeString(parsedValue.slice(0, index), true);\r\n                const highlightedPart = _escapeString(parsedValue.slice(index, highlightEndIndex), true);\r\n                const endPart = _escapeString(parsedValue.slice(highlightEndIndex));\r\n                this.renderValueWithoutRenderer(\r\n                    /* html */ `${startPart}<span class=\"ag-rich-select-row-text-highlight\">${highlightedPart}</span>${endPart}`\r\n                );\r\n            } else {\r\n                hasMatch = false;\r\n            }\r\n        }\r\n\r\n        if (!hasMatch) {\r\n            this.renderValueWithoutRenderer(parsedValue);\r\n        }\r\n    }\r\n\r\n    public updateSelected(selected: boolean): void {\r\n        const eGui = this.getGui();\r\n        _setAriaSelected(eGui.parentElement!, selected);\r\n\r\n        this.addOrRemoveCssClass('ag-rich-select-row-selected', selected);\r\n    }\r\n\r\n    public getValue(): TValue {\r\n        return this.value;\r\n    }\r\n\r\n    public toggleHighlighted(highlighted: boolean): void {\r\n        this.addOrRemoveCssClass('ag-rich-select-row-highlighted', highlighted);\r\n    }\r\n\r\n    private populateWithoutRenderer(value: any, valueFormatted: any) {\r\n        const eDocument = _getDocument(this.beans);\r\n        const eGui = this.getGui();\r\n\r\n        const span = eDocument.createElement('span');\r\n        span.style.overflow = 'hidden';\r\n        span.style.textOverflow = 'ellipsis';\r\n        const parsedValue = _escapeString(_exists(valueFormatted) ? valueFormatted : value, true);\r\n        this.parsedValue = _exists(parsedValue) ? parsedValue : null;\r\n\r\n        eGui.appendChild(span);\r\n        this.renderValueWithoutRenderer(parsedValue);\r\n        this.shouldDisplayTooltip = _shouldDisplayTooltip(() => span);\r\n        this.tooltipFeature?.setTooltipAndRefresh(this.parsedValue);\r\n    }\r\n\r\n    private renderValueWithoutRenderer(value: string | null): void {\r\n        const span = this.getGui().querySelector('span');\r\n        if (!span) {\r\n            return;\r\n        }\r\n        span.innerHTML = _exists(value) ? value : '&nbsp;';\r\n    }\r\n\r\n    private populateWithRenderer(value: TValue, valueFormatted: string): boolean {\r\n        // bad coder here - we are not populating all values of the cellRendererParams\r\n        let cellRendererPromise: AgPromise<any> | undefined;\r\n        let userCompDetails: UserCompDetails | undefined;\r\n\r\n        if (this.params.cellRenderer) {\r\n            const richSelect = this.getParentComponent()?.getParentComponent() as AgRichSelect;\r\n            userCompDetails = _getEditorRendererDetails<RichSelectParams, IRichCellEditorRendererParams<TValue>>(\r\n                this.userCompFactory,\r\n                this.params,\r\n                {\r\n                    value,\r\n                    valueFormatted,\r\n                    getValue: () => richSelect?.getValue(),\r\n                    setValue: (value: TValue[] | TValue | null) => {\r\n                        richSelect?.setValue(value, true);\r\n                    },\r\n                    setTooltip: (value: string, shouldDisplayTooltip: () => boolean) => {\r\n                        this.gos.assertModuleRegistered('Tooltip', 3);\r\n                        this.shouldDisplayTooltip = shouldDisplayTooltip;\r\n                        this.tooltipFeature?.setTooltipAndRefresh(value);\r\n                    },\r\n                }\r\n            );\r\n        }\r\n\r\n        if (userCompDetails) {\r\n            cellRendererPromise = userCompDetails.newAgStackInstance();\r\n        }\r\n\r\n        if (cellRendererPromise) {\r\n            _bindCellRendererToHtmlElement(cellRendererPromise, this.getGui());\r\n        }\r\n\r\n        if (cellRendererPromise) {\r\n            cellRendererPromise.then((childComponent) => {\r\n                this.addDestroyFunc(() => {\r\n                    this.destroyBean(childComponent);\r\n                });\r\n            });\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n", "import type { Component } from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    KeyCode,\r\n    _getActiveDomElement,\r\n    _isStopPropagationForAgGrid,\r\n    _stopPropagationForAgGrid,\r\n} from 'ag-grid-community';\r\n\r\nexport class AdvancedFilterBuilderItemNavigationFeature extends BeanStub {\r\n    constructor(\r\n        private readonly eGui: HTMLElement,\r\n        private readonly focusWrapper: HTMLElement,\r\n        private readonly eFocusableComp: Component<any>\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.addManagedElementListeners(this.eGui, {\r\n            keydown: (event: KeyboardEvent) => {\r\n                switch (event.key) {\r\n                    case KeyCode.TAB:\r\n                        if (!event.defaultPrevented) {\r\n                            // tab guard handled the navigation. stop from reaching virtual list\r\n                            _stopPropagationForAgGrid(event);\r\n                        }\r\n                        break;\r\n                    case KeyCode.UP:\r\n                    case KeyCode.DOWN:\r\n                        // if this hasn't been handled by an editor, prevent virtual list navigation\r\n                        _stopPropagationForAgGrid(event);\r\n                        break;\r\n                    case KeyCode.ESCAPE:\r\n                        if (_isStopPropagationForAgGrid(event)) {\r\n                            return;\r\n                        }\r\n                        if (this.eGui.contains(_getActiveDomElement(this.beans))) {\r\n                            event.preventDefault();\r\n                            _stopPropagationForAgGrid(event);\r\n                            this.focusWrapper.focus();\r\n                        }\r\n                        break;\r\n                }\r\n            },\r\n        });\r\n        const highlightClass = 'ag-advanced-filter-builder-virtual-list-item-highlight';\r\n        this.addManagedListeners(this.focusWrapper, {\r\n            keydown: (event: KeyboardEvent) => {\r\n                switch (event.key) {\r\n                    case KeyCode.ENTER:\r\n                        if (_isStopPropagationForAgGrid(event)) {\r\n                            return;\r\n                        }\r\n                        if (_getActiveDomElement(this.beans) === this.focusWrapper) {\r\n                            event.preventDefault();\r\n                            _stopPropagationForAgGrid(event);\r\n                            this.eFocusableComp.getFocusableElement().focus();\r\n                        }\r\n                        break;\r\n                }\r\n            },\r\n            focusin: () => {\r\n                this.focusWrapper.classList.add(highlightClass);\r\n            },\r\n            focusout: (event: FocusEvent) => {\r\n                if (!this.focusWrapper.contains(event.relatedTarget as HTMLElement)) {\r\n                    this.focusWrapper.classList.remove(highlightClass);\r\n                }\r\n            },\r\n        });\r\n    }\r\n}\r\n", "import type { ADVANCED_FILTER_LOCALE_TEXT } from '../advancedFilterLocaleText';\r\nimport type { AutocompleteEntry } from '../autocomplete/autocompleteParams';\r\nimport type { AddDropdownCompParams } from './addDropdownComp';\r\n\r\nexport function getAdvancedFilterBuilderAddButtonParams(\r\n    translate: (key: keyof typeof ADVANCED_FILTER_LOCALE_TEXT) => string,\r\n    maxPickerWidth?: number\r\n): AddDropdownCompParams {\r\n    return {\r\n        pickerAriaLabelKey: 'ariaLabelAdvancedFilterBuilderAddField',\r\n        pickerAriaLabelValue: 'Advanced Filter Builder Add Field',\r\n        pickerType: 'ag-list',\r\n        valueList: [\r\n            {\r\n                key: 'condition',\r\n                displayValue: translate('advancedFilterBuilderAddCondition'),\r\n            },\r\n            {\r\n                key: 'join',\r\n                displayValue: translate('advancedFilterBuilderAddJoin'),\r\n            },\r\n        ],\r\n        valueFormatter: (value: AutocompleteEntry) => (value == null ? null : value.displayValue ?? value.key),\r\n        pickerIcon: 'advancedFilterBuilderAdd',\r\n        maxPickerWidth: `${maxPickerWidth ?? 120}px`,\r\n        wrapperClassName: 'ag-advanced-filter-builder-item-button',\r\n        ariaLabel: translate('advancedFilterBuilderAddButtonTooltip'),\r\n    };\r\n}\r\n", "import type {\r\n    BaseCellDataType,\r\n    BeanCollection,\r\n    DragAndDropService,\r\n    DragSource,\r\n    FieldPickerValueSelectedEvent,\r\n    FieldValueEvent,\r\n    ITooltipCtrl,\r\n    Registry,\r\n    TooltipFeature,\r\n} from 'ag-grid-community';\r\nimport {\r\n    DragSourceType,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    TabGuardComp,\r\n    _createIconNoSpan,\r\n    _removeAriaExpanded,\r\n    _setAriaDisabled,\r\n    _setAriaExpanded,\r\n    _setAriaLabel,\r\n    _setAriaLevel,\r\n    _setDisplayed,\r\n    _setVisible,\r\n    _stopPropagationForAgGrid,\r\n} from 'ag-grid-community';\r\n\r\nimport type { AdvancedFilterExpressionService } from '../advancedFilterExpressionService';\r\nimport type { AutocompleteEntry } from '../autocomplete/autocompleteParams';\r\nimport { AddDropdownComp } from './addDropdownComp';\r\nimport type { AdvancedFilterBuilderDragStartedEvent } from './advancedFilterBuilderDragFeature';\r\nimport type { AdvancedFilterBuilderDragFeature } from './advancedFilterBuilderDragFeature';\r\nimport { AdvancedFilterBuilderItemNavigationFeature } from './advancedFilterBuilderItemNavigationFeature';\r\nimport { getAdvancedFilterBuilderAddButtonParams } from './advancedFilterBuilderUtils';\r\nimport { ConditionPillWrapperComp } from './conditionPillWrapperComp';\r\nimport type {\r\n    AdvancedFilterBuilderAddEvent,\r\n    AdvancedFilterBuilderEvents,\r\n    AdvancedFilterBuilderItem,\r\n    AdvancedFilterBuilderMoveEvent,\r\n    AdvancedFilterBuilderRemoveEvent,\r\n    CreatePillParams,\r\n} from './iAdvancedFilterBuilder';\r\nimport { InputPillComp } from './inputPillComp';\r\nimport { JoinPillWrapperComp } from './joinPillWrapperComp';\r\nimport { SelectPillComp } from './selectPillComp';\r\n\r\nexport class AdvancedFilterBuilderItemComp extends TabGuardComp<AdvancedFilterBuilderEvents> {\r\n    private dragAndDrop: DragAndDropService;\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n    private registry: Registry;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.dragAndDrop = beans.dragAndDrop!;\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n        this.registry = beans.registry;\r\n    }\r\n\r\n    private readonly eTreeLines: HTMLElement = RefPlaceholder;\r\n    private readonly eDragHandle: HTMLElement = RefPlaceholder;\r\n    private readonly eButtons: HTMLElement = RefPlaceholder;\r\n    private readonly eValidation: HTMLElement = RefPlaceholder;\r\n    private readonly eMoveUpButton: HTMLElement = RefPlaceholder;\r\n    private readonly eMoveDownButton: HTMLElement = RefPlaceholder;\r\n    private readonly eAddButton: HTMLElement = RefPlaceholder;\r\n    private readonly eRemoveButton: HTMLElement = RefPlaceholder;\r\n\r\n    private ePillWrapper: JoinPillWrapperComp | ConditionPillWrapperComp;\r\n    private validationTooltipFeature?: TooltipFeature;\r\n    private moveUpDisabled: boolean = false;\r\n    private moveDownDisabled: boolean = false;\r\n    private moveUpTooltipFeature?: TooltipFeature;\r\n    private moveDownTooltipFeature?: TooltipFeature;\r\n\r\n    constructor(\r\n        private readonly item: AdvancedFilterBuilderItem,\r\n        private readonly dragFeature: AdvancedFilterBuilderDragFeature,\r\n        private readonly focusWrapper: HTMLElement\r\n    ) {\r\n        super(/* html */ `\r\n            <div class=\"ag-advanced-filter-builder-item-wrapper\" role=\"presentation\">\r\n                <div class=\"ag-advanced-filter-builder-item\" role=\"presentation\">\r\n                    <div data-ref=\"eTreeLines\" class=\"ag-advanced-filter-builder-item-tree-lines\" aria-hidden=\"true\"></div>\r\n                    <span data-ref=\"eDragHandle\" class=\"ag-drag-handle\" aria-hidden=\"true\"></span>\r\n                    <span data-ref=\"eValidation\" class=\"ag-advanced-filter-builder-item-button ag-advanced-filter-builder-invalid\" aria-hidden=\"true\"></span>\r\n                </div>\r\n                <div data-ref=\"eButtons\" class=\"ag-advanced-filter-builder-item-buttons\">\r\n                    <span data-ref=\"eMoveUpButton\" class=\"ag-advanced-filter-builder-item-button\" role=\"button\"></span>\r\n                    <span data-ref=\"eMoveDownButton\" class=\"ag-advanced-filter-builder-item-button\" role=\"button\"></span>\r\n                    <div data-ref=\"eAddButton\" role=\"presentation\"></div>\r\n                    <span data-ref=\"eRemoveButton\" class=\"ag-advanced-filter-builder-item-button\" role=\"button\"></span>\r\n                </div>\r\n            </div>\r\n        `);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const { filterModel, level, showMove } = this.item;\r\n\r\n        const isJoin = filterModel!.filterType === 'join';\r\n        this.ePillWrapper = this.createManagedBean(isJoin ? new JoinPillWrapperComp() : new ConditionPillWrapperComp());\r\n        this.ePillWrapper.init({ item: this.item, createPill: (params: CreatePillParams) => this.createPill(params) });\r\n        this.eDragHandle.insertAdjacentElement('afterend', this.ePillWrapper.getGui());\r\n\r\n        if (level === 0) {\r\n            const eTreeLine = document.createElement('div');\r\n            eTreeLine.classList.add('ag-advanced-filter-builder-item-tree-line-vertical-bottom');\r\n            eTreeLine.classList.add('ag-advanced-filter-builder-item-tree-line-root');\r\n            this.eTreeLines.appendChild(eTreeLine);\r\n\r\n            _setDisplayed(this.eDragHandle, false);\r\n            _setDisplayed(this.eButtons, false);\r\n            _setAriaExpanded(this.focusWrapper, true);\r\n        } else {\r\n            this.setupTreeLines(level);\r\n\r\n            this.eDragHandle.appendChild(_createIconNoSpan('advancedFilterBuilderDrag', this.beans)!);\r\n            this.setupValidation();\r\n            this.setupMoveButtons(showMove);\r\n            this.setupAddButton();\r\n            this.setupRemoveButton();\r\n\r\n            this.setupDragging();\r\n            this.updateAriaExpanded();\r\n        }\r\n\r\n        _setAriaLevel(this.focusWrapper, level + 1);\r\n\r\n        this.initialiseTabGuard({});\r\n\r\n        this.createManagedBean(\r\n            new AdvancedFilterBuilderItemNavigationFeature(this.getGui(), this.focusWrapper, this.ePillWrapper)\r\n        );\r\n\r\n        this.updateAriaLabel();\r\n\r\n        this.addManagedListeners(this.ePillWrapper, {\r\n            advancedFilterBuilderValueChanged: () =>\r\n                this.dispatchLocalEvent({\r\n                    type: 'advancedFilterBuilderValueChanged',\r\n                }),\r\n            advancedFilterBuilderValidChanged: () => this.updateValidity(),\r\n        });\r\n    }\r\n\r\n    public setState(params: {\r\n        disableMoveUp?: boolean;\r\n        disableMoveDown?: boolean;\r\n        treeLines: boolean[];\r\n        showStartTreeLine: boolean;\r\n    }): void {\r\n        const { level } = this.item;\r\n        if (level === 0) {\r\n            return;\r\n        }\r\n        const { showMove } = this.item;\r\n        const { disableMoveUp, disableMoveDown, treeLines, showStartTreeLine } = params;\r\n        this.updateTreeLines(treeLines, showStartTreeLine);\r\n        this.updateAriaExpanded();\r\n        if (showMove) {\r\n            this.moveUpDisabled = !!disableMoveUp;\r\n            this.moveDownDisabled = !!disableMoveDown;\r\n            this.eMoveUpButton.classList.toggle('ag-advanced-filter-builder-item-button-disabled', disableMoveUp);\r\n            this.eMoveDownButton.classList.toggle('ag-advanced-filter-builder-item-button-disabled', disableMoveDown);\r\n            _setAriaDisabled(this.eMoveUpButton, !!disableMoveUp);\r\n            _setAriaDisabled(this.eMoveDownButton, !!disableMoveDown);\r\n            this.moveUpTooltipFeature?.refreshTooltip();\r\n            this.moveDownTooltipFeature?.refreshTooltip();\r\n        }\r\n    }\r\n\r\n    public focusMoveButton(backwards: boolean): void {\r\n        (backwards ? this.eMoveUpButton : this.eMoveDownButton).focus();\r\n    }\r\n\r\n    public afterAdd(): void {\r\n        this.ePillWrapper.getFocusableElement().focus();\r\n    }\r\n\r\n    private setupTreeLines(level: number): void {\r\n        for (let i = 0; i < level; i++) {\r\n            const eTreeLine = document.createElement('div');\r\n            this.eTreeLines.appendChild(eTreeLine);\r\n        }\r\n    }\r\n\r\n    private updateTreeLines(treeLines: boolean[], showStartTreeLine: boolean): void {\r\n        const lastTreeLineIndex = treeLines.length - 1;\r\n        const { children } = this.eTreeLines;\r\n        for (let i = 0; i < lastTreeLineIndex; i++) {\r\n            const eTreeLine = children.item(i);\r\n            if (eTreeLine) {\r\n                eTreeLine.classList.toggle('ag-advanced-filter-builder-item-tree-line-vertical', !treeLines[i]);\r\n            }\r\n        }\r\n        const eTreeLine = children.item(lastTreeLineIndex);\r\n        if (eTreeLine) {\r\n            eTreeLine.classList.add('ag-advanced-filter-builder-item-tree-line-horizontal');\r\n            const isLastChild = treeLines[lastTreeLineIndex];\r\n            eTreeLine.classList.toggle('ag-advanced-filter-builder-item-tree-line-vertical-top', isLastChild);\r\n            eTreeLine.classList.toggle('ag-advanced-filter-builder-item-tree-line-vertical', !isLastChild);\r\n        }\r\n        this.eDragHandle.classList.toggle(\r\n            'ag-advanced-filter-builder-item-tree-line-vertical-bottom',\r\n            showStartTreeLine\r\n        );\r\n    }\r\n\r\n    private setupValidation(): void {\r\n        this.eValidation.appendChild(_createIconNoSpan('advancedFilterBuilderInvalid', this.beans)!);\r\n        this.validationTooltipFeature = this.createOptionalManagedBean(\r\n            this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.eValidation,\r\n                getLocation: () => 'advancedFilter',\r\n                getTooltipValue: () => this.ePillWrapper.getValidationMessage(),\r\n                getTooltipShowDelayOverride: () => 1000,\r\n            } as ITooltipCtrl)\r\n        );\r\n        this.updateValidity();\r\n    }\r\n\r\n    private setupAddButton(): void {\r\n        const addButtonParams = getAdvancedFilterBuilderAddButtonParams(\r\n            (key) => this.advFilterExpSvc.translate(key),\r\n            this.gos.get('advancedFilterBuilderParams')?.addSelectWidth\r\n        );\r\n        const eAddButton = this.createManagedBean(new AddDropdownComp(addButtonParams));\r\n        this.addManagedListeners(eAddButton, {\r\n            fieldPickerValueSelected: ({ value }: FieldPickerValueSelectedEvent) =>\r\n                this.dispatchLocalEvent<AdvancedFilterBuilderAddEvent>({\r\n                    type: 'advancedFilterBuilderAdded',\r\n                    item: this.item,\r\n                    isJoin: value.key === 'join',\r\n                }),\r\n        });\r\n        this.eAddButton.appendChild(eAddButton.getGui());\r\n\r\n        this.createOptionalManagedBean(\r\n            this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.eAddButton,\r\n                getLocation: () => 'advancedFilter',\r\n                getTooltipValue: () => this.advFilterExpSvc.translate('advancedFilterBuilderAddButtonTooltip'),\r\n            } as ITooltipCtrl)\r\n        );\r\n    }\r\n\r\n    private setupRemoveButton(): void {\r\n        this.eRemoveButton.appendChild(_createIconNoSpan('advancedFilterBuilderRemove', this.beans)!);\r\n        this.addManagedListeners(this.eRemoveButton, {\r\n            click: () => this.removeItem(),\r\n            keydown: (event: KeyboardEvent) => {\r\n                switch (event.key) {\r\n                    case KeyCode.ENTER:\r\n                        event.preventDefault();\r\n                        _stopPropagationForAgGrid(event);\r\n                        this.removeItem();\r\n                        break;\r\n                }\r\n            },\r\n        });\r\n\r\n        this.createOptionalManagedBean(\r\n            this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.eRemoveButton,\r\n                getLocation: () => 'advancedFilter',\r\n                getTooltipValue: () => this.advFilterExpSvc.translate('advancedFilterBuilderRemoveButtonTooltip'),\r\n            } as ITooltipCtrl)\r\n        );\r\n        _setAriaLabel(this.eRemoveButton, this.advFilterExpSvc.translate('advancedFilterBuilderRemoveButtonTooltip'));\r\n\r\n        this.activateTabIndex([this.eRemoveButton]);\r\n    }\r\n\r\n    private setupMoveButtons(showMove?: boolean): void {\r\n        if (showMove) {\r\n            this.eMoveUpButton.appendChild(_createIconNoSpan('advancedFilterBuilderMoveUp', this.beans)!);\r\n\r\n            this.addManagedListeners(this.eMoveUpButton, {\r\n                click: () => this.moveItem(true),\r\n                keydown: (event: KeyboardEvent) => {\r\n                    switch (event.key) {\r\n                        case KeyCode.ENTER:\r\n                            event.preventDefault();\r\n                            _stopPropagationForAgGrid(event);\r\n                            this.moveItem(true);\r\n                            break;\r\n                    }\r\n                },\r\n            });\r\n\r\n            this.moveUpTooltipFeature = this.createOptionalManagedBean(\r\n                this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                    getGui: () => this.eMoveUpButton,\r\n                    getLocation: () => 'advancedFilter',\r\n                    getTooltipValue: () =>\r\n                        this.moveUpDisabled\r\n                            ? null\r\n                            : this.advFilterExpSvc.translate('advancedFilterBuilderMoveUpButtonTooltip'),\r\n                } as ITooltipCtrl)\r\n            );\r\n            _setAriaLabel(\r\n                this.eMoveUpButton,\r\n                this.advFilterExpSvc.translate('advancedFilterBuilderMoveUpButtonTooltip')\r\n            );\r\n\r\n            this.eMoveDownButton.appendChild(_createIconNoSpan('advancedFilterBuilderMoveDown', this.beans)!);\r\n            this.addManagedListeners(this.eMoveDownButton, {\r\n                click: () => this.moveItem(false),\r\n                keydown: (event: KeyboardEvent) => {\r\n                    switch (event.key) {\r\n                        case KeyCode.ENTER:\r\n                            event.preventDefault();\r\n                            _stopPropagationForAgGrid(event);\r\n                            this.moveItem(false);\r\n                            break;\r\n                    }\r\n                },\r\n            });\r\n\r\n            this.moveDownTooltipFeature = this.createOptionalManagedBean(\r\n                this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                    getGui: () => this.eMoveDownButton,\r\n                    getLocation: () => 'advancedFilter',\r\n                    getTooltipValue: () =>\r\n                        this.moveDownDisabled\r\n                            ? null\r\n                            : this.advFilterExpSvc.translate('advancedFilterBuilderMoveDownButtonTooltip'),\r\n                } as ITooltipCtrl)\r\n            );\r\n            _setAriaLabel(\r\n                this.eMoveDownButton,\r\n                this.advFilterExpSvc.translate('advancedFilterBuilderMoveDownButtonTooltip')\r\n            );\r\n\r\n            this.activateTabIndex([this.eMoveUpButton, this.eMoveDownButton]);\r\n        } else {\r\n            _setDisplayed(this.eMoveUpButton, false);\r\n            _setDisplayed(this.eMoveDownButton, false);\r\n        }\r\n    }\r\n\r\n    private updateValidity(): void {\r\n        _setVisible(this.eValidation, !this.item.valid);\r\n        this.validationTooltipFeature?.refreshTooltip();\r\n        this.updateAriaLabel();\r\n    }\r\n\r\n    private createPill(params: CreatePillParams): SelectPillComp | InputPillComp {\r\n        const { key, cssClass, update, ariaLabel } = params;\r\n        const onUpdated = (key: string) => {\r\n            if (key == null) {\r\n                return;\r\n            }\r\n            update(key);\r\n            this.dispatchLocalEvent({\r\n                type: 'advancedFilterBuilderValueChanged',\r\n            });\r\n        };\r\n        if (params.isSelect) {\r\n            const { getEditorParams, pickerAriaLabelKey, pickerAriaLabelValue, displayValue } = params;\r\n            const advancedFilterBuilderParams = this.gos.get('advancedFilterBuilderParams');\r\n            const minPickerWidth = `${advancedFilterBuilderParams?.pillSelectMinWidth ?? 140}px`;\r\n            const maxPickerWidth = `${advancedFilterBuilderParams?.pillSelectMaxWidth ?? 200}px`;\r\n            const comp = this.createBean(\r\n                new SelectPillComp({\r\n                    pickerAriaLabelKey,\r\n                    pickerAriaLabelValue,\r\n                    pickerType: 'ag-list',\r\n                    value: {\r\n                        key,\r\n                        displayValue,\r\n                    },\r\n                    valueFormatter: (value: AutocompleteEntry) =>\r\n                        value == null ? null : value.displayValue ?? value.key,\r\n                    variableWidth: true,\r\n                    minPickerWidth,\r\n                    maxPickerWidth,\r\n                    getEditorParams,\r\n                    wrapperClassName: cssClass,\r\n                    ariaLabel,\r\n                    pickerIcon: 'advancedFilterBuilderSelectOpen',\r\n                })\r\n            );\r\n            this.addManagedListeners(comp, {\r\n                fieldPickerValueSelected: ({ value }: FieldPickerValueSelectedEvent) => onUpdated(value?.key),\r\n            });\r\n            return comp;\r\n        } else {\r\n            const { baseCellDataType, valueFormatter } = params;\r\n            const comp = this.createBean(\r\n                new InputPillComp({\r\n                    value: key,\r\n                    valueFormatter,\r\n                    cssClass,\r\n                    type: this.getInputType(baseCellDataType),\r\n                    ariaLabel,\r\n                })\r\n            );\r\n            this.addManagedListeners(comp, { fieldValueChanged: ({ value }: FieldValueEvent) => onUpdated(value) });\r\n            return comp;\r\n        }\r\n    }\r\n\r\n    private getInputType(baseCellDataType: BaseCellDataType): 'text' | 'number' | 'date' | 'bigint' {\r\n        switch (baseCellDataType) {\r\n            case 'text':\r\n            case 'object':\r\n            case 'boolean':\r\n                return 'text';\r\n            case 'number':\r\n                return 'number';\r\n            case 'bigint':\r\n                return 'bigint';\r\n            case 'date':\r\n            case 'dateString':\r\n                return 'date';\r\n        }\r\n    }\r\n\r\n    private setupDragging(): void {\r\n        const dragSource: DragSource = {\r\n            type: DragSourceType.AdvancedFilterBuilder,\r\n            eElement: this.eDragHandle,\r\n            dragItemName: () => this.ePillWrapper.getDragName(),\r\n            getDefaultIconName: () => 'notAllowed',\r\n            getDragItem: () => ({}),\r\n            onDragStarted: () =>\r\n                this.dragFeature.dispatchLocalEvent<AdvancedFilterBuilderDragStartedEvent>({\r\n                    type: 'advancedFilterBuilderDragStarted',\r\n                    item: this.item,\r\n                }),\r\n            onDragStopped: () =>\r\n                this.dragFeature.dispatchLocalEvent({\r\n                    type: 'advancedFilterBuilderDragEnded',\r\n                }),\r\n        };\r\n\r\n        this.dragAndDrop.addDragSource(dragSource, true);\r\n        this.addDestroyFunc(() => this.dragAndDrop.removeDragSource(dragSource));\r\n    }\r\n\r\n    private updateAriaLabel(): void {\r\n        const wrapperLabel = this.ePillWrapper.getAriaLabel();\r\n        const level = `${this.item.level + 1}`;\r\n        const validationMessage = this.ePillWrapper.getValidationMessage();\r\n        let ariaLabel;\r\n        if (validationMessage) {\r\n            ariaLabel = this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderItemValidation', [\r\n                wrapperLabel,\r\n                level,\r\n                validationMessage,\r\n            ]);\r\n        } else {\r\n            ariaLabel = this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderItem', [wrapperLabel, level]);\r\n        }\r\n        _setAriaLabel(this.focusWrapper, ariaLabel);\r\n    }\r\n\r\n    private updateAriaExpanded(): void {\r\n        _removeAriaExpanded(this.focusWrapper);\r\n        const { filterModel } = this.item;\r\n        if (filterModel?.filterType === 'join' && filterModel.conditions.length) {\r\n            _setAriaExpanded(this.focusWrapper, true);\r\n        }\r\n    }\r\n\r\n    private removeItem(): void {\r\n        this.dispatchLocalEvent<AdvancedFilterBuilderRemoveEvent>({\r\n            type: 'advancedFilterBuilderRemoved',\r\n            item: this.item,\r\n        });\r\n    }\r\n\r\n    private moveItem(backwards: boolean): void {\r\n        this.dispatchLocalEvent<AdvancedFilterBuilderMoveEvent>({\r\n            type: 'advancedFilterBuilderMoved',\r\n            item: this.item,\r\n            backwards,\r\n        });\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BaseCellDataType,\r\n    BeanCollection,\r\n    BooleanAdvancedFilterModel,\r\n    ColumnAdvancedFilterModel,\r\n} from 'ag-grid-community';\r\nimport { Component, _exists, _removeFromParent, _toStringOrNull } from 'ag-grid-community';\r\n\r\nimport type { AdvancedFilterExpressionService } from '../advancedFilterExpressionService';\r\nimport type { AutocompleteEntry } from '../autocomplete/autocompleteParams';\r\nimport type {\r\n    AdvancedFilterBuilderEvents,\r\n    AdvancedFilterBuilderItem,\r\n    CreatePillParams,\r\n} from './iAdvancedFilterBuilder';\r\nimport type { InputPillComp } from './inputPillComp';\r\nimport type { SelectPillComp } from './selectPillComp';\r\n\r\nexport class ConditionPillWrapperComp extends Component<AdvancedFilterBuilderEvents> {\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n    }\r\n\r\n    private item: AdvancedFilterBuilderItem;\r\n    private createPill: (params: CreatePillParams) => SelectPillComp | InputPillComp;\r\n    private filterModel: ColumnAdvancedFilterModel;\r\n    private baseCellDataType: BaseCellDataType;\r\n    private column: AgColumn | undefined;\r\n    private numOperands: number;\r\n    private eColumnPill: SelectPillComp | InputPillComp;\r\n    private eOperatorPill: SelectPillComp | InputPillComp | undefined;\r\n    private eOperandPill: SelectPillComp | InputPillComp | undefined;\r\n    private validationMessage: string | null = null;\r\n\r\n    constructor() {\r\n        super(/* html */ `\r\n            <div class=\"ag-advanced-filter-builder-item-condition\" role=\"presentation\"></div>\r\n        `);\r\n    }\r\n\r\n    public init(params: {\r\n        item: AdvancedFilterBuilderItem;\r\n        createPill: (params: CreatePillParams) => SelectPillComp | InputPillComp;\r\n    }): void {\r\n        const { item, createPill } = params;\r\n        this.item = item;\r\n        this.createPill = createPill;\r\n        this.filterModel = item.filterModel as ColumnAdvancedFilterModel;\r\n        this.setupColumnCondition(this.filterModel);\r\n        this.validate();\r\n\r\n        this.addDestroyFunc(() => this.destroyBeans([this.eColumnPill, this.eOperatorPill, this.eOperandPill]));\r\n    }\r\n\r\n    public getDragName(): string {\r\n        return this.filterModel.colId\r\n            ? this.advFilterExpSvc.parseColumnFilterModel(this.filterModel)\r\n            : this.getDefaultColumnDisplayValue();\r\n    }\r\n\r\n    public getAriaLabel(): string {\r\n        return `${this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderFilterItem')} ${this.getDragName()}`;\r\n    }\r\n\r\n    public getValidationMessage(): string | null {\r\n        return this.validationMessage;\r\n    }\r\n\r\n    public override getFocusableElement(): HTMLElement {\r\n        return this.eColumnPill.getFocusableElement();\r\n    }\r\n\r\n    private setupColumnCondition(filterModel: ColumnAdvancedFilterModel): void {\r\n        const columnDetails = this.advFilterExpSvc.getColumnDetails(filterModel.colId);\r\n        this.baseCellDataType = columnDetails.baseCellDataType;\r\n        this.column = columnDetails.column;\r\n        this.numOperands = this.getNumOperands(this.getOperatorKey());\r\n\r\n        this.eColumnPill = this.createPill({\r\n            key: this.getColumnKey(),\r\n            displayValue: this.getColumnDisplayValue() ?? this.getDefaultColumnDisplayValue(),\r\n            cssClass: 'ag-advanced-filter-builder-column-pill',\r\n            isSelect: true,\r\n            getEditorParams: () => ({ values: this.advFilterExpSvc.getColumnAutocompleteEntries() }),\r\n            update: (key) => this.setColumnKey(key),\r\n            pickerAriaLabelKey: 'ariaLabelAdvancedFilterBuilderColumnSelectField',\r\n            pickerAriaLabelValue: 'Advanced Filter Builder Column Select Field',\r\n            ariaLabel: this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderColumn'),\r\n        });\r\n        this.getGui().appendChild(this.eColumnPill.getGui());\r\n\r\n        if (_exists(this.getColumnKey())) {\r\n            this.createOperatorPill();\r\n            if (this.hasOperand()) {\r\n                this.createOperandPill();\r\n            }\r\n        }\r\n    }\r\n\r\n    private createOperatorPill(): void {\r\n        this.eOperatorPill = this.createPill({\r\n            key: this.getOperatorKey(),\r\n            displayValue: this.getOperatorDisplayValue() ?? this.getDefaultOptionSelectValue(),\r\n            cssClass: 'ag-advanced-filter-builder-option-pill',\r\n            isSelect: true,\r\n            getEditorParams: () => ({ values: this.getOperatorAutocompleteEntries() }),\r\n            update: (key) => this.setOperatorKey(key),\r\n            pickerAriaLabelKey: 'ariaLabelAdvancedFilterBuilderOptionSelectField',\r\n            pickerAriaLabelValue: 'Advanced Filter Builder Option Select Field',\r\n            ariaLabel: this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderOption'),\r\n        });\r\n        this.eColumnPill.getGui().insertAdjacentElement('afterend', this.eOperatorPill.getGui());\r\n    }\r\n\r\n    private createOperandPill(): void {\r\n        // Date inputs want iso string, so read straight from model. For numbers, convert to string\r\n        const { filter } = this.filterModel as Exclude<ColumnAdvancedFilterModel, BooleanAdvancedFilterModel>;\r\n        const key = (typeof filter === 'number' || typeof filter === 'bigint' ? _toStringOrNull(filter) : filter) ?? '';\r\n        this.eOperandPill = this.createPill({\r\n            key,\r\n            // Convert from the input format to display format.\r\n            // Input format matches model format except for numbers, but these get stringified anyway\r\n            valueFormatter: (value) =>\r\n                this.advFilterExpSvc.getOperandDisplayValue({ ...this.filterModel, filter: value } as any, true),\r\n            baseCellDataType: this.baseCellDataType,\r\n            cssClass: 'ag-advanced-filter-builder-value-pill',\r\n            isSelect: false,\r\n            update: (key) => this.setOperand(key),\r\n            ariaLabel: this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderValue'),\r\n        });\r\n        this.getGui().appendChild(this.eOperandPill.getGui());\r\n    }\r\n\r\n    private getColumnKey(): string {\r\n        return this.filterModel.colId;\r\n    }\r\n\r\n    private getColumnDisplayValue(): string | undefined {\r\n        return this.advFilterExpSvc.getColumnDisplayValue(this.filterModel);\r\n    }\r\n\r\n    private getOperatorKey(): string {\r\n        return this.filterModel.type;\r\n    }\r\n\r\n    private getOperatorDisplayValue(): string | undefined {\r\n        return this.advFilterExpSvc.getOperatorDisplayValue(this.filterModel);\r\n    }\r\n\r\n    private getOperandDisplayValue(): string {\r\n        return this.advFilterExpSvc.getOperandDisplayValue(this.filterModel, true);\r\n    }\r\n\r\n    private hasOperand(): boolean {\r\n        return this.numOperands > 0;\r\n    }\r\n\r\n    private getOperatorAutocompleteEntries(): AutocompleteEntry[] {\r\n        return this.column\r\n            ? this.advFilterExpSvc.getOperatorAutocompleteEntries(this.column, this.baseCellDataType)\r\n            : [];\r\n    }\r\n\r\n    private setColumnKey(colId: string): void {\r\n        if (!this.eOperatorPill) {\r\n            this.createOperatorPill();\r\n        }\r\n\r\n        const newColumnDetails = this.advFilterExpSvc.getColumnDetails(colId);\r\n        this.column = newColumnDetails.column;\r\n        const newBaseCellDataType = newColumnDetails.baseCellDataType;\r\n        if (this.baseCellDataType !== newBaseCellDataType) {\r\n            this.baseCellDataType = newBaseCellDataType;\r\n\r\n            this.setOperatorKey(undefined as any);\r\n            if (this.eOperatorPill) {\r\n                _removeFromParent(this.eOperatorPill.getGui());\r\n                this.destroyBean(this.eOperatorPill);\r\n                this.createOperatorPill();\r\n            }\r\n            this.validate();\r\n        }\r\n        this.filterModel.colId = colId;\r\n        this.filterModel.filterType = this.baseCellDataType;\r\n    }\r\n\r\n    private setOperatorKey(operator: string): void {\r\n        const newNumOperands = this.getNumOperands(operator);\r\n        if (newNumOperands !== this.numOperands) {\r\n            this.numOperands = newNumOperands;\r\n            if (newNumOperands === 0) {\r\n                this.destroyOperandPill();\r\n            } else {\r\n                this.createOperandPill();\r\n                if (this.baseCellDataType !== 'number' && this.baseCellDataType !== 'bigint') {\r\n                    this.setOperand('');\r\n                }\r\n            }\r\n        }\r\n        this.filterModel.type = operator as any;\r\n        this.validate();\r\n    }\r\n\r\n    private setOperand(operand: string): void {\r\n        let parsedOperand: string | number | bigint = operand;\r\n        // Number comes back as string from input, so convert. Dates are already in iso string format\r\n        if (this.baseCellDataType === 'number') {\r\n            parsedOperand = _exists(operand) ? Number(operand) : '';\r\n        } else if (this.baseCellDataType === 'bigint') {\r\n            try {\r\n                parsedOperand = _exists(operand) ? BigInt(operand) : '';\r\n            } catch {\r\n                parsedOperand = '';\r\n            }\r\n        }\r\n        (this.filterModel as any).filter = parsedOperand;\r\n        this.validate();\r\n    }\r\n\r\n    private getNumOperands(operator: string): number {\r\n        return this.advFilterExpSvc.getExpressionOperator(this.baseCellDataType, operator)?.numOperands ?? 0;\r\n    }\r\n\r\n    private destroyOperandPill(): void {\r\n        delete (this.filterModel as any).filter;\r\n        this.getGui().removeChild(this.eOperandPill!.getGui());\r\n        this.destroyBean(this.eOperandPill);\r\n        this.eOperandPill = undefined;\r\n    }\r\n\r\n    private validate(): void {\r\n        let validationMessage = null;\r\n        if (!_exists(this.getColumnKey())) {\r\n            validationMessage = this.advFilterExpSvc.translate('advancedFilterBuilderValidationSelectColumn');\r\n        } else if (!_exists(this.getOperatorKey())) {\r\n            validationMessage = this.advFilterExpSvc.translate('advancedFilterBuilderValidationSelectOption');\r\n        } else if (this.numOperands > 0 && !_exists(this.getOperandDisplayValue())) {\r\n            validationMessage = this.advFilterExpSvc.translate('advancedFilterBuilderValidationEnterValue');\r\n        }\r\n\r\n        this.item.valid = !validationMessage;\r\n        if (validationMessage !== this.validationMessage) {\r\n            this.validationMessage = validationMessage;\r\n            this.dispatchLocalEvent({\r\n                type: 'advancedFilterBuilderValidChanged',\r\n            });\r\n        }\r\n    }\r\n\r\n    private getDefaultColumnDisplayValue(): string {\r\n        return this.advFilterExpSvc.translate('advancedFilterBuilderSelectColumn');\r\n    }\r\n\r\n    private getDefaultOptionSelectValue(): string {\r\n        return this.advFilterExpSvc.translate('advancedFilterBuilderSelectOption');\r\n    }\r\n}\r\n", "import type { BeanCollection, FieldValueEvent, WithoutGridCommon } from 'ag-grid-community';\r\nimport {\r\n    AgInputDateField,\r\n    AgInputNumberField,\r\n    AgInputTextField,\r\n    Component,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    _exists,\r\n    _setAriaDescribedBy,\r\n    _setAriaLabel,\r\n    _setDisplayed,\r\n    _stopPropagationForAgGrid,\r\n} from 'ag-grid-community';\r\n\r\nimport type { AdvancedFilterExpressionService } from '../advancedFilterExpressionService';\r\n\r\nexport type InputPillCompEvent = 'fieldValueChanged';\r\nexport class InputPillComp extends Component<InputPillCompEvent> {\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n    }\r\n\r\n    private readonly ePill: HTMLElement = RefPlaceholder;\r\n    private readonly eLabel: HTMLElement = RefPlaceholder;\r\n\r\n    private eEditor: AgInputTextField | undefined;\r\n    private value: string;\r\n    private displayValue: string;\r\n\r\n    constructor(\r\n        private readonly params: {\r\n            value: string;\r\n            valueFormatter: (value: string) => string;\r\n            cssClass: string;\r\n            type: 'text' | 'number' | 'bigint' | 'date';\r\n            ariaLabel: string;\r\n        }\r\n    ) {\r\n        super(/* html */ `\r\n            <div class=\"ag-advanced-filter-builder-pill-wrapper\" role=\"presentation\">\r\n                <div data-ref=\"ePill\" class=\"ag-advanced-filter-builder-pill\" role=\"button\">\r\n                    <span data-ref=\"eLabel\" class=\"ag-advanced-filter-builder-pill-display\"></span>\r\n                </div>\r\n            </div>\r\n        `);\r\n        const { value, valueFormatter } = params;\r\n        this.value = value;\r\n        this.displayValue = valueFormatter(value);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const { cssClass, ariaLabel } = this.params;\r\n\r\n        this.ePill.classList.add(cssClass);\r\n        this.activateTabIndex([this.ePill]);\r\n\r\n        this.eLabel.id = `${this.getCompId()}`;\r\n        _setAriaDescribedBy(this.ePill, this.eLabel.id);\r\n        _setAriaLabel(this.ePill, ariaLabel);\r\n\r\n        this.renderValue();\r\n\r\n        this.addManagedListeners(this.ePill, {\r\n            click: (event: MouseEvent) => {\r\n                event.preventDefault();\r\n                this.showEditor();\r\n            },\r\n            keydown: (event: KeyboardEvent) => {\r\n                switch (event.key) {\r\n                    case KeyCode.ENTER:\r\n                        event.preventDefault();\r\n                        _stopPropagationForAgGrid(event);\r\n                        this.showEditor();\r\n                        break;\r\n                }\r\n            },\r\n        });\r\n        this.addDestroyFunc(() => this.destroyBean(this.eEditor));\r\n    }\r\n\r\n    public override getFocusableElement(): HTMLElement {\r\n        return this.ePill;\r\n    }\r\n\r\n    private showEditor(): void {\r\n        if (this.eEditor) {\r\n            return;\r\n        }\r\n        _setDisplayed(this.ePill, false);\r\n        this.eEditor = this.createEditorComp(this.params.type);\r\n        this.eEditor.setValue(this.value);\r\n        const eEditorGui = this.eEditor.getGui();\r\n        this.eEditor.addManagedElementListeners(eEditorGui, {\r\n            keydown: (event: KeyboardEvent) => {\r\n                switch (event.key) {\r\n                    case KeyCode.ENTER:\r\n                        event.preventDefault();\r\n                        _stopPropagationForAgGrid(event);\r\n                        this.updateValue(true);\r\n                        break;\r\n                    case KeyCode.ESCAPE:\r\n                        event.preventDefault();\r\n                        _stopPropagationForAgGrid(event);\r\n                        this.hideEditor(true);\r\n                        break;\r\n                }\r\n            },\r\n            focusout: () => this.updateValue(false),\r\n        });\r\n        this.getGui().appendChild(eEditorGui);\r\n        this.eEditor.getFocusableElement().focus();\r\n    }\r\n\r\n    private createEditorComp(\r\n        type: 'text' | 'number' | 'bigint' | 'date'\r\n    ): AgInputTextField | AgInputNumberField | AgInputDateField {\r\n        let comp;\r\n        switch (type) {\r\n            case 'text':\r\n                comp = new AgInputTextField();\r\n                break;\r\n            case 'bigint':\r\n            case 'number':\r\n                comp = new AgInputNumberField();\r\n                break;\r\n            case 'date':\r\n                comp = new AgInputDateField();\r\n                break;\r\n        }\r\n        return this.createBean(comp);\r\n    }\r\n\r\n    private hideEditor(keepFocus: boolean): void {\r\n        const { eEditor } = this;\r\n        if (!eEditor) {\r\n            return;\r\n        }\r\n        this.eEditor = undefined;\r\n        this.getGui().removeChild(eEditor.getGui());\r\n        this.destroyBean(eEditor);\r\n        _setDisplayed(this.ePill, true);\r\n        if (keepFocus) {\r\n            this.ePill.focus();\r\n        }\r\n    }\r\n\r\n    private renderValue(): void {\r\n        let value: string;\r\n        const { displayValue, eLabel } = this;\r\n        const { classList } = eLabel;\r\n        classList.remove(\r\n            'ag-advanced-filter-builder-value-empty',\r\n            'ag-advanced-filter-builder-value-number',\r\n            'ag-advanced-filter-builder-value-text'\r\n        );\r\n        if (!_exists(displayValue)) {\r\n            value = this.advFilterExpSvc.translate('advancedFilterBuilderEnterValue');\r\n            classList.add('ag-advanced-filter-builder-value-empty');\r\n        } else if (this.params.type === 'number' || this.params.type === \"bigint\") {\r\n            value = displayValue;\r\n            classList.add('ag-advanced-filter-builder-value-number');\r\n        } else {\r\n            value = `\"${displayValue}\"`;\r\n            classList.add('ag-advanced-filter-builder-value-text');\r\n        }\r\n        eLabel.innerText = value;\r\n    }\r\n\r\n    private updateValue(keepFocus: boolean): void {\r\n        if (!this.eEditor) {\r\n            return;\r\n        }\r\n        const value = this.eEditor!.getValue() ?? '';\r\n        this.dispatchLocalEvent<WithoutGridCommon<FieldValueEvent>>({\r\n            type: 'fieldValueChanged',\r\n            value,\r\n        });\r\n        this.value = value;\r\n        this.displayValue = this.params.valueFormatter(value);\r\n        this.renderValue();\r\n        this.hideEditor(keepFocus);\r\n    }\r\n}\r\n", "import type { BeanCollection, JoinAdvancedFilterModel } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { AdvancedFilterExpressionService } from '../advancedFilterExpressionService';\r\nimport type {\r\n    AdvancedFilterBuilderEvents,\r\n    AdvancedFilterBuilderItem,\r\n    CreatePillParams,\r\n} from './iAdvancedFilterBuilder';\r\nimport type { InputPillComp } from './inputPillComp';\r\nimport type { SelectPillComp } from './selectPillComp';\r\n\r\nexport class JoinPillWrapperComp extends Component<AdvancedFilterBuilderEvents> {\r\n    private advFilterExpSvc: AdvancedFilterExpressionService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.advFilterExpSvc = beans.advFilterExpSvc as AdvancedFilterExpressionService;\r\n    }\r\n\r\n    private filterModel: JoinAdvancedFilterModel;\r\n    private ePill: SelectPillComp | InputPillComp;\r\n\r\n    constructor() {\r\n        super(/* html */ `\r\n            <div class=\"ag-advanced-filter-builder-item-condition\" role=\"presentation\"></div>\r\n        `);\r\n    }\r\n\r\n    public init(params: {\r\n        item: AdvancedFilterBuilderItem;\r\n        createPill: (params: CreatePillParams) => SelectPillComp | InputPillComp;\r\n    }): void {\r\n        const { item, createPill } = params;\r\n        const filterModel = item.filterModel as JoinAdvancedFilterModel;\r\n        this.filterModel = filterModel;\r\n\r\n        this.ePill = createPill({\r\n            key: filterModel.type,\r\n            displayValue: this.advFilterExpSvc.parseJoinOperator(filterModel),\r\n            cssClass: 'ag-advanced-filter-builder-join-pill',\r\n            isSelect: true,\r\n            getEditorParams: () => ({\r\n                values: this.advFilterExpSvc.getJoinOperatorAutocompleteEntries(),\r\n            }),\r\n            update: (key) => (filterModel.type = key as any),\r\n            pickerAriaLabelKey: 'ariaLabelAdvancedFilterBuilderJoinSelectField',\r\n            pickerAriaLabelValue: 'Advanced Filter Builder Join Operator Select Field',\r\n            ariaLabel: this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderJoinOperator'),\r\n        });\r\n        this.getGui().appendChild(this.ePill.getGui());\r\n        this.addDestroyFunc(() => this.destroyBean(this.ePill));\r\n    }\r\n\r\n    public getDragName(): string {\r\n        return this.advFilterExpSvc.parseJoinOperator(this.filterModel);\r\n    }\r\n\r\n    public getAriaLabel(): string {\r\n        return `${this.advFilterExpSvc.translate('ariaAdvancedFilterBuilderGroupItem')} ${this.getDragName()}`;\r\n    }\r\n\r\n    public getValidationMessage(): string | null {\r\n        return null;\r\n    }\r\n\r\n    public override getFocusableElement(): HTMLElement {\r\n        return this.ePill.getFocusableElement();\r\n    }\r\n}\r\n", "import type { RichSelectParams } from 'ag-grid-community';\r\nimport {\r\n    AgInputTextFieldSelector,\r\n    _setAriaLabel,\r\n    _setAriaLabelledBy,\r\n    _stopPropagationForAgGrid,\r\n} from 'ag-grid-community';\r\n\r\nimport { AgRichSelect } from '../../widgets/agRichSelect';\r\nimport type { AutocompleteEntry } from '../autocomplete/autocompleteParams';\r\n\r\nexport interface SelectPillParams extends RichSelectParams<AutocompleteEntry> {\r\n    getEditorParams: () => { values?: any[] };\r\n    wrapperClassName: string;\r\n    ariaLabel: string;\r\n}\r\n\r\nexport class SelectPillComp extends AgRichSelect<AutocompleteEntry> {\r\n    constructor(private readonly params: SelectPillParams) {\r\n        super({\r\n            ...params,\r\n            template: /* html */ `\r\n                <div class=\"ag-picker-field ag-advanced-filter-builder-pill-wrapper\" role=\"presentation\">\r\n                    <div data-ref=\"eLabel\"></div>\r\n                    <div data-ref=\"eWrapper\" class=\"ag-wrapper ag-advanced-filter-builder-pill ag-picker-collapsed\">\r\n                        <div data-ref=\"eDisplayField\" class=\"ag-picker-field-display ag-advanced-filter-builder-pill-display\"></div>\r\n                        <ag-input-text-field data-ref=\"eInput\" class=\"ag-rich-select-field-input\"></ag-input-text-field>\r\n                        <span data-ref=\"eDeselect\" class=\"ag-rich-select-deselect-button ag-picker-field-icon\" role=\"presentation\"></span>\r\n                        <div data-ref=\"eIcon\" class=\"ag-picker-field-icon\" aria-hidden=\"true\"></div>\r\n                    </div>\r\n                </div>`,\r\n            agComponents: [AgInputTextFieldSelector],\r\n        });\r\n    }\r\n\r\n    public override getFocusableElement(): HTMLElement {\r\n        return this.eWrapper;\r\n    }\r\n\r\n    public override showPicker(): void {\r\n        // avoid focus handling issues with multiple rich selects\r\n        setTimeout(() => super.showPicker());\r\n    }\r\n\r\n    public override hidePicker(): void {\r\n        // avoid focus handling issues with multiple rich selects\r\n        setTimeout(() => super.hidePicker());\r\n    }\r\n\r\n    public override postConstruct(): void {\r\n        super.postConstruct();\r\n\r\n        const { wrapperClassName, ariaLabel } = this.params;\r\n\r\n        this.eWrapper.classList.add(wrapperClassName);\r\n        _setAriaLabelledBy(this.eWrapper, '');\r\n        _setAriaLabel(this.eWrapper, ariaLabel);\r\n    }\r\n\r\n    protected override createPickerComponent() {\r\n        if (!this.values) {\r\n            const { values } = this.params.getEditorParams();\r\n            this.values = values!;\r\n            const key = (this.value as AutocompleteEntry).key;\r\n            const value = values!.find((value) => value.key === key) ?? {\r\n                key,\r\n                displayValue: (this.value as AutocompleteEntry).displayValue,\r\n            };\r\n            this.value = value;\r\n        }\r\n        return super.createPickerComponent();\r\n    }\r\n\r\n    protected override onEnterKeyDown(event: KeyboardEvent): void {\r\n        _stopPropagationForAgGrid(event);\r\n        if (this.isPickerDisplayed) {\r\n            super.onEnterKeyDown(event);\r\n        } else {\r\n            event.preventDefault();\r\n            this.showPicker();\r\n        }\r\n    }\r\n}\r\n", "import type { AdvancedFilterModel } from 'ag-grid-community';\r\n\r\nimport type { ADVANCED_FILTER_LOCALE_TEXT } from './advancedFilterLocaleText';\r\nimport type { AutocompleteEntry, AutocompleteListParams } from './autocomplete/autocompleteParams';\r\nimport { ColFilterExpressionParser } from './colFilterExpressionParser';\r\nimport { findMatch } from './filterExpressionOperators';\r\nimport type {\r\n    AutocompleteUpdate,\r\n    FilterExpressionFunction,\r\n    FilterExpressionFunctionParams,\r\n    FilterExpressionParserParams,\r\n    FilterExpressionValidationError,\r\n} from './filterExpressionUtils';\r\nimport { checkAndUpdateExpression, findEndPosition, getSearchString, updateExpression } from './filterExpressionUtils';\r\n\r\nclass OperatorParser {\r\n    private operators: string[] = [];\r\n    private parsedOperator: 'AND' | 'OR';\r\n    private operatorStartPositions: number[] = [];\r\n    private operatorEndPositions: (number | undefined)[] = [];\r\n    private activeOperator: number = 0;\r\n    private validationError: FilterExpressionValidationError | null = null;\r\n\r\n    constructor(private params: FilterExpressionParserParams) {}\r\n\r\n    public parseExpression(i: number): number {\r\n        this.operators.push('');\r\n        this.operatorStartPositions.push(i);\r\n        this.operatorEndPositions.push(undefined);\r\n        const { expression } = this.params;\r\n        while (i < expression.length) {\r\n            const char = expression[i];\r\n            if (char === ' ') {\r\n                const isComplete = this.parseOperator(i - 1);\r\n                if (isComplete) {\r\n                    this.activeOperator++;\r\n                    return i - 1;\r\n                } else {\r\n                    this.operators[this.activeOperator] += char;\r\n                }\r\n            } else {\r\n                this.operators[this.activeOperator] += char;\r\n            }\r\n            i++;\r\n        }\r\n        this.parseOperator(i - 1);\r\n\r\n        return i;\r\n    }\r\n\r\n    public isValid(): boolean {\r\n        return !this.validationError && (!this.operators.length || !!this.parsedOperator);\r\n    }\r\n\r\n    public getValidationError(): FilterExpressionValidationError | null {\r\n        return this.validationError;\r\n    }\r\n\r\n    public getFunction(): '&&' | '||' {\r\n        return this.parsedOperator === 'OR' ? '||' : '&&';\r\n    }\r\n\r\n    public getModel(): 'AND' | 'OR' {\r\n        return this.parsedOperator === 'OR' ? 'OR' : 'AND';\r\n    }\r\n\r\n    public getAutocompleteListParams(position: number, operatorIndex?: number): AutocompleteListParams {\r\n        let searchString: string;\r\n        if (operatorIndex == null) {\r\n            searchString = '';\r\n        } else {\r\n            const operator = this.operators[operatorIndex];\r\n            const operatorEndPosition = this.operatorEndPositions[operatorIndex];\r\n            searchString = getSearchString(\r\n                operator,\r\n                position,\r\n                operatorEndPosition == null ? this.params.expression.length : operatorEndPosition + 1\r\n            );\r\n        }\r\n        let entries = this.params.advFilterExpSvc.getJoinOperatorAutocompleteEntries();\r\n        if (operatorIndex || (operatorIndex == null && this.activeOperator)) {\r\n            // if operator already chosen, don't allow other operators\r\n            entries = entries.filter(({ key }) => key === this.parsedOperator);\r\n        }\r\n        return this.params.advFilterExpSvc.generateAutocompleteListParams(entries, 'join', searchString);\r\n    }\r\n\r\n    public updateExpression(\r\n        position: number,\r\n        updateEntry: AutocompleteEntry,\r\n        operatorIndex: number\r\n    ): AutocompleteUpdate {\r\n        let { expression } = this.params;\r\n        const updatedValuePart = updateEntry.displayValue ?? updateEntry.key;\r\n        if (operatorIndex === 0) {\r\n            // need to update all others\r\n            for (let i = this.operatorEndPositions.length - 1; i > 0; i--) {\r\n                const operatorEndPosition = this.operatorEndPositions[i];\r\n                if (operatorEndPosition == null) {\r\n                    continue;\r\n                }\r\n                expression = updateExpression(\r\n                    expression,\r\n                    this.operatorStartPositions[i],\r\n                    operatorEndPosition,\r\n                    updatedValuePart\r\n                ).updatedValue;\r\n            }\r\n        }\r\n        // if we don't have a start position, haven't typed anything yet, so use current position\r\n        const startPosition =\r\n            this.operatorStartPositions.length > operatorIndex ? this.operatorStartPositions[operatorIndex] : position;\r\n        const endPosition =\r\n            (this.operatorEndPositions.length > operatorIndex ? this.operatorEndPositions[operatorIndex] : undefined) ??\r\n            findEndPosition(expression, position, true).endPosition;\r\n        return updateExpression(expression, startPosition, endPosition, updatedValuePart, true);\r\n    }\r\n\r\n    public getNumOperators(): number {\r\n        return this.operators.length;\r\n    }\r\n\r\n    public getLastOperatorEndPosition(): number | undefined {\r\n        return this.operatorEndPositions[this.operatorEndPositions.length - 1];\r\n    }\r\n\r\n    private parseOperator(endPosition: number): boolean {\r\n        const operator = this.operators.length > this.activeOperator ? this.operators[this.activeOperator] : '';\r\n        const joinOperators = this.params.advFilterExpSvc.getExpressionJoinOperators();\r\n        const parsedValue = findMatch(operator, joinOperators, (v) => v) as 'AND' | 'OR';\r\n        if (parsedValue) {\r\n            // exact match\r\n            this.operatorEndPositions[this.activeOperator] = endPosition;\r\n            const displayValue = joinOperators[parsedValue];\r\n            if (this.activeOperator) {\r\n                if (parsedValue !== this.parsedOperator) {\r\n                    if (!this.validationError) {\r\n                        this.validationError = {\r\n                            message: this.params.advFilterExpSvc.translate(\r\n                                'advancedFilterValidationJoinOperatorMismatch'\r\n                            ),\r\n                            startPosition: endPosition - operator.length + 1,\r\n                            endPosition,\r\n                        };\r\n                    }\r\n                    return false;\r\n                }\r\n            } else {\r\n                this.parsedOperator = parsedValue;\r\n            }\r\n            if (operator !== displayValue) {\r\n                checkAndUpdateExpression(this.params, operator, displayValue, endPosition);\r\n                this.operators[this.activeOperator] = displayValue;\r\n            }\r\n            return true;\r\n        } else if (parsedValue === null) {\r\n            // partial match\r\n            return false;\r\n        } else {\r\n            // no match\r\n            if (!this.validationError) {\r\n                this.validationError = {\r\n                    message: this.params.advFilterExpSvc.translate('advancedFilterValidationInvalidJoinOperator'),\r\n                    startPosition: endPosition - operator.length + 1,\r\n                    endPosition,\r\n                };\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n}\r\n\r\nexport class JoinFilterExpressionParser {\r\n    private expectingExpression: boolean = true;\r\n    private expectingOperator: boolean = false;\r\n    private expressionParsers: (JoinFilterExpressionParser | ColFilterExpressionParser)[] = [];\r\n    private operatorParser: OperatorParser = new OperatorParser(this.params);\r\n    private endPosition: number;\r\n    private missingEndBracket: boolean = false;\r\n    private extraEndBracket: boolean = false;\r\n\r\n    constructor(\r\n        private params: FilterExpressionParserParams,\r\n        public readonly startPosition: number\r\n    ) {}\r\n\r\n    public parseExpression(): number {\r\n        let i = this.startPosition;\r\n        const { expression } = this.params;\r\n        while (i < expression.length) {\r\n            const char = expression[i];\r\n            if (char === '(' && !this.expectingOperator) {\r\n                const nestedParser = new JoinFilterExpressionParser(this.params, i + 1);\r\n                i = nestedParser.parseExpression();\r\n                this.expressionParsers.push(nestedParser);\r\n                this.expectingExpression = false;\r\n                this.expectingOperator = true;\r\n            } else if (char === ')') {\r\n                this.endPosition = i - 1;\r\n                if (this.startPosition === 0) {\r\n                    this.extraEndBracket = true;\r\n                }\r\n                return i;\r\n            } else if (char === ' ') {\r\n                // ignore extra whitespace\r\n            } else if (this.expectingExpression) {\r\n                const nestedParser = new ColFilterExpressionParser(this.params, i);\r\n                i = nestedParser.parseExpression();\r\n                this.expressionParsers.push(nestedParser);\r\n                this.expectingExpression = false;\r\n                this.expectingOperator = true;\r\n            } else if (this.expectingOperator) {\r\n                i = this.operatorParser.parseExpression(i);\r\n                this.expectingOperator = false;\r\n                this.expectingExpression = true;\r\n            }\r\n            i++;\r\n        }\r\n        if (this.startPosition > 0) {\r\n            this.missingEndBracket = true;\r\n        }\r\n\r\n        return i;\r\n    }\r\n\r\n    public isValid(): boolean {\r\n        return (\r\n            !this.missingEndBracket &&\r\n            !this.extraEndBracket &&\r\n            this.expressionParsers.length === this.operatorParser.getNumOperators() + 1 &&\r\n            this.operatorParser.isValid() &&\r\n            this.expressionParsers.every((expressionParser) => expressionParser.isValid())\r\n        );\r\n    }\r\n\r\n    public getValidationError(): FilterExpressionValidationError | null {\r\n        const operatorError = this.operatorParser.getValidationError();\r\n        for (let i = 0; i < this.expressionParsers.length; i++) {\r\n            const expressionError = this.expressionParsers[i].getValidationError();\r\n            if (expressionError) {\r\n                return operatorError && operatorError.startPosition < expressionError.startPosition\r\n                    ? operatorError\r\n                    : expressionError;\r\n            }\r\n        }\r\n        if (operatorError) {\r\n            return operatorError;\r\n        }\r\n        if (this.extraEndBracket) {\r\n            return {\r\n                message: this.params.advFilterExpSvc.translate('advancedFilterValidationExtraEndBracket'),\r\n                startPosition: this.endPosition + 1,\r\n                endPosition: this.endPosition + 1,\r\n            };\r\n        }\r\n        let translateKey: keyof typeof ADVANCED_FILTER_LOCALE_TEXT | undefined;\r\n        if (this.expressionParsers.length === this.operatorParser.getNumOperators()) {\r\n            translateKey = 'advancedFilterValidationMissingCondition';\r\n        } else if (this.missingEndBracket) {\r\n            translateKey = 'advancedFilterValidationMissingEndBracket';\r\n        }\r\n        if (translateKey) {\r\n            return {\r\n                message: this.params.advFilterExpSvc.translate(translateKey),\r\n                startPosition: this.params.expression.length,\r\n                endPosition: this.params.expression.length,\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public getFunctionString(params: FilterExpressionFunctionParams): string {\r\n        const hasMultipleExpressions = this.expressionParsers.length > 1;\r\n        const expression = this.expressionParsers\r\n            .map((expressionParser) => expressionParser.getFunctionString(params))\r\n            .join(` ${this.operatorParser.getFunction()} `);\r\n        return hasMultipleExpressions ? `(${expression})` : expression;\r\n    }\r\n\r\n    public getFunctionParsed(params: FilterExpressionFunctionParams): FilterExpressionFunction {\r\n        const operator = this.operatorParser.getFunction();\r\n        const funcs = this.expressionParsers.map((expressionParser) => expressionParser.getFunctionParsed(params));\r\n        const arrayFunc = operator === '&&' ? 'every' : 'some';\r\n        return (expressionProxy, node, p) => funcs[arrayFunc]((func) => func(expressionProxy, node, p));\r\n    }\r\n\r\n    public getAutocompleteListParams(position: number): AutocompleteListParams | undefined {\r\n        if (this.endPosition != null && position > this.endPosition + 1) {\r\n            return undefined;\r\n        }\r\n        if (!this.expressionParsers.length) {\r\n            return this.getColumnAutocompleteListParams();\r\n        }\r\n\r\n        const expressionParserIndex = this.getExpressionParserIndex(position);\r\n\r\n        if (expressionParserIndex == null) {\r\n            if (this.params.expression[position] === '(') {\r\n                return { enabled: false };\r\n            }\r\n            // positioned before the expression, so new expression\r\n            return this.getColumnAutocompleteListParams();\r\n        }\r\n\r\n        const expressionParser = this.expressionParsers[expressionParserIndex];\r\n\r\n        const autocompleteType = expressionParser.getAutocompleteListParams(position);\r\n\r\n        if (!autocompleteType) {\r\n            // beyond the end of the expression\r\n            if (expressionParserIndex! < this.expressionParsers.length - 1) {\r\n                // in the middle of two expressions\r\n                return this.operatorParser.getAutocompleteListParams(position, expressionParserIndex);\r\n            }\r\n            if (this.expressionParsers.length === this.operatorParser.getNumOperators()) {\r\n                const operatorEndPosition = this.operatorParser.getLastOperatorEndPosition();\r\n                return operatorEndPosition == null || position <= operatorEndPosition + 1\r\n                    ? this.operatorParser.getAutocompleteListParams(position, this.operatorParser.getNumOperators() - 1)\r\n                    : this.getColumnAutocompleteListParams();\r\n            }\r\n            if (this.params.expression[position - 1] === ')') {\r\n                return { enabled: false };\r\n            }\r\n            return this.operatorParser.getAutocompleteListParams(position);\r\n        }\r\n\r\n        return autocompleteType;\r\n    }\r\n\r\n    public updateExpression(\r\n        position: number,\r\n        updateEntry: AutocompleteEntry,\r\n        type?: string\r\n    ): AutocompleteUpdate | null {\r\n        const expression = this.params.expression;\r\n\r\n        const expressionParserIndex = this.getExpressionParserIndex(position);\r\n\r\n        if (expressionParserIndex == null) {\r\n            // positioned before the expression\r\n            const updatedValuePart =\r\n                type === 'column'\r\n                    ? this.params.advFilterExpSvc.getColumnValue(updateEntry)\r\n                    : updateEntry.displayValue ?? updateEntry.key;\r\n            return updateExpression(expression, this.startPosition, this.startPosition, updatedValuePart, true);\r\n        }\r\n\r\n        const expressionParser = this.expressionParsers[expressionParserIndex];\r\n\r\n        const updatedExpression = expressionParser.updateExpression(position, updateEntry, type);\r\n\r\n        if (updatedExpression == null) {\r\n            if (type === 'column') {\r\n                // beyond the end of the expression, just do simple update\r\n                return updateExpression(\r\n                    expression,\r\n                    position,\r\n                    expression.length - 1,\r\n                    this.params.advFilterExpSvc.getColumnValue(updateEntry),\r\n                    true\r\n                );\r\n            } else if (this.endPosition != null && position > this.endPosition + 1) {\r\n                return null;\r\n            } else {\r\n                return this.operatorParser.updateExpression(position, updateEntry, expressionParserIndex);\r\n            }\r\n        }\r\n        return updatedExpression;\r\n    }\r\n\r\n    public getModel(): AdvancedFilterModel {\r\n        if (this.expressionParsers.length > 1) {\r\n            return {\r\n                filterType: 'join',\r\n                type: this.operatorParser.getModel(),\r\n                conditions: this.expressionParsers.map((parser) => parser.getModel()),\r\n            };\r\n        } else {\r\n            return this.expressionParsers[0].getModel();\r\n        }\r\n    }\r\n\r\n    private getColumnAutocompleteListParams(): AutocompleteListParams {\r\n        return this.params.advFilterExpSvc.generateAutocompleteListParams(\r\n            this.params.advFilterExpSvc.getColumnAutocompleteEntries(),\r\n            'column',\r\n            ''\r\n        );\r\n    }\r\n\r\n    private getExpressionParserIndex(position: number): number | undefined {\r\n        let expressionParserIndex: number | undefined;\r\n\r\n        for (let i = 0; i < this.expressionParsers.length; i++) {\r\n            const expressionParserToCheck = this.expressionParsers[i];\r\n            if (expressionParserToCheck.startPosition > position) {\r\n                break;\r\n            }\r\n            expressionParserIndex = i;\r\n        }\r\n\r\n        return expressionParserIndex;\r\n    }\r\n}\r\n", "import type { AdvancedFilterModel } from 'ag-grid-community';\r\n\r\nimport type { AutocompleteEntry, AutocompleteListParams } from './autocomplete/autocompleteParams';\r\nimport type {\r\n    AutocompleteUpdate,\r\n    FilterExpressionFunction,\r\n    FilterExpressionFunctionParams,\r\n    FilterExpressionParserParams,\r\n} from './filterExpressionUtils';\r\nimport { JoinFilterExpressionParser } from './joinFilterExpressionParser';\r\n\r\nexport class FilterExpressionParser {\r\n    private joinExpressionParser: JoinFilterExpressionParser;\r\n    private valid: boolean = false;\r\n\r\n    constructor(private params: FilterExpressionParserParams) {}\r\n\r\n    public parseExpression(): string {\r\n        this.joinExpressionParser = new JoinFilterExpressionParser(this.params, 0);\r\n        const i = this.joinExpressionParser.parseExpression();\r\n        this.valid = i >= this.params.expression.length - 1 && this.joinExpressionParser.isValid();\r\n        return this.params.expression;\r\n    }\r\n\r\n    public isValid(): boolean {\r\n        return this.valid;\r\n    }\r\n\r\n    public getValidationMessage(): string | null {\r\n        const error = this.joinExpressionParser.getValidationError();\r\n        if (!error) {\r\n            return null;\r\n        }\r\n        const { message, startPosition, endPosition } = error;\r\n        return startPosition < this.params.expression.length\r\n            ? this.params.advFilterExpSvc.translate('advancedFilterValidationMessage', [\r\n                  message,\r\n                  this.params.expression.slice(startPosition, endPosition + 1).trim(),\r\n              ])\r\n            : this.params.advFilterExpSvc.translate('advancedFilterValidationMessageAtEnd', [message]);\r\n    }\r\n\r\n    public getFunctionString(): {\r\n        functionString: string;\r\n        params: FilterExpressionFunctionParams;\r\n    } {\r\n        const params = this.createFunctionParams();\r\n        return {\r\n            functionString: `return ${this.joinExpressionParser.getFunctionString(params)};`,\r\n            params,\r\n        };\r\n    }\r\n\r\n    public getFunctionParsed(): {\r\n        expressionFunction: FilterExpressionFunction;\r\n        params: FilterExpressionFunctionParams;\r\n    } {\r\n        const params = this.createFunctionParams();\r\n        return {\r\n            expressionFunction: this.joinExpressionParser.getFunctionParsed(params),\r\n            params,\r\n        };\r\n    }\r\n\r\n    public getAutocompleteListParams(position: number): AutocompleteListParams {\r\n        return this.joinExpressionParser.getAutocompleteListParams(position) ?? { enabled: false };\r\n    }\r\n\r\n    public updateExpression(position: number, updateEntry: AutocompleteEntry, type?: string): AutocompleteUpdate {\r\n        return this.joinExpressionParser.updateExpression(position, updateEntry, type)!;\r\n    }\r\n\r\n    public getModel(): AdvancedFilterModel | null {\r\n        return this.isValid() ? this.joinExpressionParser.getModel() : null;\r\n    }\r\n\r\n    private createFunctionParams(): FilterExpressionFunctionParams {\r\n        return {\r\n            operands: [],\r\n            operators: [],\r\n            evaluatorParams: [],\r\n        };\r\n    }\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\nimport { _ColumnMoveModule, _PopupModule, _SharedDragAndDropModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { SideBarModule } from '../sideBar/sideBarModule';\r\nimport { VERSION } from '../version';\r\nimport { MenuItemModule } from '../widgets/menuItemModule';\r\nimport { ColumnToolPanel } from './columnToolPanel';\r\nimport { ColumnToolPanelFactory } from './columnToolPanelFactory';\r\n\r\n/**\r\n * @feature Accessories -> Columns Tool Panel\r\n */\r\nexport const ColumnsToolPanelModule: _ModuleWithoutApi = {\r\n    moduleName: 'ColumnsToolPanel',\r\n    version: VERSION,\r\n    beans: [ColumnToolPanelFactory],\r\n    userComponents: { agColumnsToolPanel: ColumnToolPanel },\r\n    icons: {\r\n        // column tool panel tab\r\n        columnsToolPanel: 'columns',\r\n        // \"Group by {column-name}\" item in column header menu\r\n        menuAddRowGroup: 'group',\r\n        // \"Un-Group by {column-name}\" item in column header menu\r\n        menuRemoveRowGroup: 'group',\r\n        // identifies the pivot drop zone\r\n        pivotPanel: 'pivot',\r\n        // \"Row groups\" drop zone in column tool panel\r\n        rowGroupPanel: 'group',\r\n        // columns tool panel Values drop zone\r\n        valuePanel: 'aggregation',\r\n        // column tool panel column group contracted (click to expand)\r\n        columnSelectClosed: 'tree-closed',\r\n        // column tool panel column group expanded (click to contract)\r\n        columnSelectOpen: 'tree-open',\r\n        // column tool panel header expand/collapse all button, shown when some children are expanded and\r\n        //     others are collapsed\r\n        columnSelectIndeterminate: 'tree-indeterminate',\r\n    },\r\n    dependsOn: [\r\n        EnterpriseCoreModule,\r\n        SideBarModule,\r\n        _ColumnMoveModule,\r\n        _SharedDragAndDropModule,\r\n        _PopupModule,\r\n        MenuItemModule,\r\n    ],\r\n};\r\n", "import type { _ModuleWithApi, _SideBarGridApi } from 'ag-grid-community';\r\nimport { _HorizontalResizeModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport {\r\n    closeToolPanel,\r\n    getOpenedToolPanel,\r\n    getSideBar,\r\n    getToolPanelInstance,\r\n    isSideBarVisible,\r\n    isToolPanelShowing,\r\n    openToolPanel,\r\n    refreshToolPanel,\r\n    setSideBarPosition,\r\n    setSideBarVisible,\r\n} from './sideBarApi';\r\nimport { SideBarService } from './sideBarService';\r\n\r\n/**\r\n * @feature Accessories -> Side Bar\r\n * @gridOption sideBar\r\n */\r\nexport const SideBarModule: _ModuleWithApi<_SideBarGridApi<any>> = {\r\n    moduleName: 'SideBar',\r\n    version: VERSION,\r\n    beans: [SideBarService],\r\n    apiFunctions: {\r\n        isSideBarVisible,\r\n        setSideBarVisible,\r\n        setSideBarPosition,\r\n        openToolPanel,\r\n        closeToolPanel,\r\n        getOpenedToolPanel,\r\n        refreshToolPanel,\r\n        isToolPanelShowing,\r\n        getToolPanelInstance,\r\n        getSideBar,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _HorizontalResizeModule],\r\n};\r\n", "import type { BeanCollection, IToolPanel, SideBarDef } from 'ag-grid-community';\r\nimport { _unwrapUserComp } from 'ag-grid-community';\r\n\r\nexport function isSideBarVisible(beans: BeanCollection): boolean {\r\n    return beans.sideBar?.comp.isDisplayed() ?? false;\r\n}\r\n\r\nexport function setSideBarVisible(beans: BeanCollection, show: boolean) {\r\n    beans.sideBar?.comp.setDisplayed(show);\r\n}\r\n\r\nexport function setSideBarPosition(beans: BeanCollection, position: 'left' | 'right') {\r\n    beans.sideBar?.comp.setSideBarPosition(position);\r\n}\r\n\r\nexport function openToolPanel(beans: BeanCollection, key: string) {\r\n    beans.sideBar?.comp.openToolPanel(key, 'api');\r\n}\r\n\r\nexport function closeToolPanel(beans: BeanCollection) {\r\n    beans.sideBar?.comp.close('api');\r\n}\r\n\r\nexport function getOpenedToolPanel(beans: BeanCollection): string | null {\r\n    return beans.sideBar?.comp.openedItem() ?? null;\r\n}\r\n\r\nexport function refreshToolPanel(beans: BeanCollection): void {\r\n    beans.sideBar?.comp.refresh();\r\n}\r\n\r\nexport function isToolPanelShowing(beans: BeanCollection): boolean {\r\n    return beans.sideBar?.comp.isToolPanelShowing() ?? false;\r\n}\r\n\r\nexport function getToolPanelInstance<TToolPanel = IToolPanel>(\r\n    beans: BeanCollection,\r\n    id: string\r\n): TToolPanel | undefined {\r\n    const comp = beans.sideBar?.comp.getToolPanelInstance(id);\r\n    return _unwrapUserComp(comp) as any;\r\n}\r\n\r\nexport function getSideBar(beans: BeanCollection): SideBarDef | undefined {\r\n    return beans.sideBar?.comp.getDef();\r\n}\r\n", "import type { ComponentSelector, ISideBar, ISideBarService, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\nimport { AgSideBarSelector } from './agSideBar';\r\n\r\nexport class SideBarService extends BeanStub implements NamedBean, ISideBarService {\r\n    beanName = 'sideBar' as const;\r\n\r\n    public comp: ISideBar;\r\n\r\n    public getSelector(): ComponentSelector {\r\n        return AgSideBarSelector;\r\n    }\r\n}\r\n", "import type {\r\n    ComponentSelector,\r\n    ISideBar,\r\n    IToolPanel,\r\n    IToolPanelParams,\r\n    SideBarDef,\r\n    SideBarState,\r\n    ToolPanelDef,\r\n} from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    KeyCode,\r\n    ManagedFocusFeature,\r\n    RefPlaceholder,\r\n    _addFocusableContainerListener,\r\n    _findNextFocusableElement,\r\n    _focusInto,\r\n    _focusNextGridCoreContainer,\r\n    _getActiveDomElement,\r\n    _removeFromParent,\r\n    _setAriaControls,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { findFocusableElementBeforeTabGuard, isTargetUnderManagedComponent } from '../misc/enterpriseFocusUtils';\r\nimport { agSideBarCSS } from './agSideBar.css-GENERATED';\r\nimport type { AgSideBarButtons, SideBarButtonClickedEvent } from './agSideBarButtons';\r\nimport { AgSideBarButtonsSelector } from './agSideBarButtons';\r\nimport { parseSideBarDef } from './sideBarDefParser';\r\nimport type { SideBarService } from './sideBarService';\r\nimport { ToolPanelWrapper } from './toolPanelWrapper';\r\n\r\nexport class AgSideBar extends Component implements ISideBar {\r\n    private readonly sideBarButtons: AgSideBarButtons = RefPlaceholder;\r\n\r\n    private toolPanelWrappers: ToolPanelWrapper[] = [];\r\n    private sideBar: SideBarDef | undefined;\r\n    private position: 'left' | 'right';\r\n\r\n    constructor() {\r\n        super(\r\n            /* html */\r\n            `<div class=\"ag-side-bar ag-unselectable\">\r\n                <ag-side-bar-buttons data-ref=\"sideBarButtons\"></ag-side-bar-buttons>\r\n            </div>`,\r\n            [AgSideBarButtonsSelector]\r\n        );\r\n        this.registerCSS(agSideBarCSS);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.sideBarButtons.addEventListener('sideBarButtonClicked', this.onToolPanelButtonClicked.bind(this));\r\n        const { beans, gos } = this;\r\n        const { sideBar: sideBarState } = gos.get('initialState') ?? {};\r\n        this.setSideBarDef({\r\n            sideBarDef: parseSideBarDef(gos.get('sideBar')),\r\n            sideBarState,\r\n        });\r\n\r\n        this.addManagedPropertyListener('sideBar', this.onSideBarUpdated.bind(this));\r\n\r\n        (beans.sideBar as SideBarService).comp = this;\r\n        const eGui = this.getFocusableElement();\r\n        this.createManagedBean(\r\n            new ManagedFocusFeature(eGui, {\r\n                onTabKeyDown: this.onTabKeyDown.bind(this),\r\n                handleKeyDown: this.handleKeyDown.bind(this),\r\n            })\r\n        );\r\n\r\n        _addFocusableContainerListener(beans, this, eGui);\r\n    }\r\n\r\n    protected onTabKeyDown(e: KeyboardEvent) {\r\n        if (e.defaultPrevented) {\r\n            return;\r\n        }\r\n\r\n        const { beans, sideBarButtons } = this;\r\n        const eGui = this.getGui();\r\n        const sideBarGui = sideBarButtons.getGui();\r\n        const activeElement = _getActiveDomElement(beans) as HTMLElement;\r\n        const openPanel = eGui.querySelector('.ag-tool-panel-wrapper:not(.ag-hidden)') as HTMLElement;\r\n        const target = e.target as HTMLElement;\r\n\r\n        if (!openPanel) {\r\n            return _focusNextGridCoreContainer(beans, e.shiftKey, true);\r\n        }\r\n\r\n        if (sideBarGui.contains(activeElement)) {\r\n            if (_focusInto(openPanel, e.shiftKey)) {\r\n                e.preventDefault();\r\n            }\r\n            return;\r\n        }\r\n\r\n        // only handle backwards focus to target the sideBar buttons\r\n        if (!e.shiftKey) {\r\n            return;\r\n        }\r\n\r\n        let nextEl: HTMLElement | null = null;\r\n\r\n        if (openPanel.contains(activeElement)) {\r\n            nextEl = _findNextFocusableElement(beans, openPanel, undefined, true);\r\n        } else if (isTargetUnderManagedComponent(openPanel, target) && e.shiftKey) {\r\n            nextEl = findFocusableElementBeforeTabGuard(openPanel, target);\r\n        }\r\n\r\n        if (!nextEl) {\r\n            nextEl = sideBarGui.querySelector('.ag-selected button') as HTMLElement;\r\n        }\r\n\r\n        if (nextEl && nextEl !== e.target) {\r\n            e.preventDefault();\r\n            nextEl.focus();\r\n        }\r\n    }\r\n\r\n    protected handleKeyDown(e: KeyboardEvent): void {\r\n        const currentButton = _getActiveDomElement(this.beans);\r\n\r\n        const sideBarButtons = this.sideBarButtons;\r\n        if (!sideBarButtons.getGui().contains(currentButton)) {\r\n            return;\r\n        }\r\n\r\n        const sideBarGui = sideBarButtons.getGui();\r\n        const buttons: HTMLElement[] = Array.prototype.slice.call(sideBarGui.querySelectorAll('.ag-side-button'));\r\n\r\n        const currentPos = buttons.findIndex((button) => button.contains(currentButton));\r\n        let nextPos: number | null = null;\r\n\r\n        switch (e.key) {\r\n            case KeyCode.LEFT:\r\n            case KeyCode.UP:\r\n                nextPos = Math.max(0, currentPos - 1);\r\n                break;\r\n            case KeyCode.RIGHT:\r\n            case KeyCode.DOWN:\r\n                nextPos = Math.min(currentPos + 1, buttons.length - 1);\r\n                break;\r\n        }\r\n\r\n        if (nextPos === null) {\r\n            return;\r\n        }\r\n\r\n        const innerButton = buttons[nextPos].querySelector('button');\r\n\r\n        if (innerButton) {\r\n            innerButton.focus();\r\n            e.preventDefault();\r\n        }\r\n    }\r\n\r\n    private onToolPanelButtonClicked(event: SideBarButtonClickedEvent): void {\r\n        const id = event.toolPanelId;\r\n        const openedItem = this.openedItem();\r\n\r\n        // if item was already open, we close it\r\n        if (openedItem === id) {\r\n            this.openToolPanel(undefined, 'sideBarButtonClicked'); // passing undefined closes\r\n        } else {\r\n            this.openToolPanel(id, 'sideBarButtonClicked');\r\n        }\r\n    }\r\n\r\n    private clearDownUi(): void {\r\n        this.sideBarButtons.clearButtons();\r\n        this.destroyToolPanelWrappers();\r\n    }\r\n\r\n    private setSideBarDef({\r\n        sideBarDef,\r\n        sideBarState,\r\n        existingToolPanelWrappers,\r\n    }: {\r\n        sideBarDef?: SideBarDef;\r\n        sideBarState?: SideBarState;\r\n        existingToolPanelWrappers?: { [id: string]: ToolPanelWrapper };\r\n    }): void {\r\n        // initially hide side bar\r\n        this.setDisplayed(false);\r\n\r\n        this.sideBar = sideBarDef;\r\n\r\n        if (!!sideBarDef && !!sideBarDef.toolPanels) {\r\n            const toolPanelDefs = sideBarDef.toolPanels as ToolPanelDef[];\r\n            this.createToolPanelsAndSideButtons(toolPanelDefs, sideBarState, existingToolPanelWrappers);\r\n            if (!this.toolPanelWrappers.length) {\r\n                return;\r\n            }\r\n\r\n            const shouldDisplaySideBar = sideBarState ? sideBarState.visible : !sideBarDef.hiddenByDefault;\r\n            this.setDisplayed(shouldDisplaySideBar);\r\n\r\n            this.setSideBarPosition(sideBarState ? sideBarState.position : sideBarDef.position);\r\n\r\n            if (shouldDisplaySideBar) {\r\n                if (sideBarState) {\r\n                    const { openToolPanel } = sideBarState;\r\n                    if (openToolPanel) {\r\n                        this.openToolPanel(openToolPanel, 'sideBarInitializing');\r\n                    }\r\n                } else {\r\n                    this.openToolPanel(sideBarDef.defaultToolPanel, 'sideBarInitializing');\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public getDef() {\r\n        return this.sideBar;\r\n    }\r\n\r\n    public setSideBarPosition(position?: 'left' | 'right'): this {\r\n        if (!position) {\r\n            position = 'right';\r\n        }\r\n\r\n        this.position = position;\r\n\r\n        const isLeft = position === 'left';\r\n        const resizerSide = isLeft ? 'right' : 'left';\r\n\r\n        this.addOrRemoveCssClass('ag-side-bar-left', isLeft);\r\n        this.addOrRemoveCssClass('ag-side-bar-right', !isLeft);\r\n\r\n        this.toolPanelWrappers.forEach((wrapper) => {\r\n            wrapper.setResizerSizerSide(resizerSide);\r\n        });\r\n\r\n        this.dispatchSideBarUpdated();\r\n\r\n        return this;\r\n    }\r\n\r\n    public override setDisplayed(\r\n        displayed: boolean,\r\n        options?: { skipAriaHidden?: boolean | undefined } | undefined\r\n    ): void {\r\n        super.setDisplayed(displayed, options);\r\n        this.dispatchSideBarUpdated();\r\n    }\r\n\r\n    public getState(): SideBarState {\r\n        const toolPanels: { [id: string]: any } = {};\r\n        this.toolPanelWrappers.forEach((wrapper) => {\r\n            toolPanels[wrapper.getToolPanelId()] = wrapper.getToolPanelInstance()?.getState?.();\r\n        });\r\n        return {\r\n            visible: this.isDisplayed(),\r\n            position: this.position,\r\n            openToolPanel: this.openedItem(),\r\n            toolPanels,\r\n        };\r\n    }\r\n\r\n    private createToolPanelsAndSideButtons(\r\n        defs: ToolPanelDef[],\r\n        sideBarState?: SideBarState,\r\n        existingToolPanelWrappers?: { [id: string]: ToolPanelWrapper }\r\n    ): void {\r\n        for (const def of defs) {\r\n            this.createToolPanelAndSideButton(\r\n                def,\r\n                sideBarState?.toolPanels?.[def.id],\r\n                existingToolPanelWrappers?.[def.id]\r\n            );\r\n        }\r\n    }\r\n\r\n    private validateDef(def: ToolPanelDef): boolean {\r\n        if (def.id == null) {\r\n            _warn(212);\r\n            return false;\r\n        }\r\n\r\n        if (def.toolPanel === 'agFiltersToolPanel') {\r\n            if (this.beans.filterManager?.isAdvFilterEnabled()) {\r\n                _warn(213);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private createToolPanelAndSideButton(\r\n        def: ToolPanelDef,\r\n        initialState?: any,\r\n        existingToolPanelWrapper?: ToolPanelWrapper\r\n    ): void {\r\n        if (!this.validateDef(def)) {\r\n            return;\r\n        }\r\n        let wrapper: ToolPanelWrapper;\r\n        if (existingToolPanelWrapper) {\r\n            wrapper = existingToolPanelWrapper;\r\n        } else {\r\n            wrapper = this.createBean(new ToolPanelWrapper());\r\n\r\n            const created = wrapper.setToolPanelDef(def, {\r\n                initialState,\r\n                onStateUpdated: () => this.dispatchSideBarUpdated(),\r\n            });\r\n            if (!created) {\r\n                return;\r\n            }\r\n        }\r\n        wrapper.setDisplayed(false);\r\n\r\n        const wrapperGui = wrapper.getGui();\r\n        this.appendChild(wrapperGui);\r\n\r\n        this.toolPanelWrappers.push(wrapper);\r\n\r\n        const button = this.sideBarButtons.addButtonComp(def);\r\n\r\n        _setAriaControls(button.eToggleButton, wrapperGui);\r\n    }\r\n\r\n    public refresh(): void {\r\n        this.toolPanelWrappers.forEach((wrapper) => wrapper.refresh());\r\n    }\r\n\r\n    public openToolPanel(\r\n        key: string | undefined,\r\n        source: 'sideBarButtonClicked' | 'sideBarInitializing' | 'api' = 'api'\r\n    ): void {\r\n        const currentlyOpenedKey = this.openedItem();\r\n        if (currentlyOpenedKey === key) {\r\n            return;\r\n        }\r\n\r\n        this.toolPanelWrappers.forEach((wrapper) => {\r\n            const show = key === wrapper.getToolPanelId();\r\n            wrapper.setDisplayed(show);\r\n        });\r\n\r\n        const newlyOpenedKey = this.openedItem();\r\n        const openToolPanelChanged = currentlyOpenedKey !== newlyOpenedKey;\r\n        if (openToolPanelChanged) {\r\n            this.sideBarButtons.setActiveButton(key);\r\n            this.raiseToolPanelVisibleEvent(key, currentlyOpenedKey ?? undefined, source);\r\n        }\r\n    }\r\n\r\n    public getToolPanelInstance(key: string): IToolPanel | undefined {\r\n        const toolPanelWrapper = this.toolPanelWrappers.filter((toolPanel) => toolPanel.getToolPanelId() === key)[0];\r\n\r\n        if (!toolPanelWrapper) {\r\n            _warn(214, { key });\r\n            return;\r\n        }\r\n\r\n        return toolPanelWrapper.getToolPanelInstance();\r\n    }\r\n\r\n    private raiseToolPanelVisibleEvent(\r\n        key: string | undefined,\r\n        previousKey: string | undefined,\r\n        source: 'sideBarButtonClicked' | 'sideBarInitializing' | 'api'\r\n    ): void {\r\n        const switchingToolPanel = !!key && !!previousKey;\r\n        const eventSvc = this.eventSvc;\r\n        if (previousKey) {\r\n            eventSvc.dispatchEvent({\r\n                type: 'toolPanelVisibleChanged',\r\n                source,\r\n                key: previousKey,\r\n                visible: false,\r\n                switchingToolPanel,\r\n            });\r\n        }\r\n        if (key) {\r\n            eventSvc.dispatchEvent({\r\n                type: 'toolPanelVisibleChanged',\r\n                source,\r\n                key,\r\n                visible: true,\r\n                switchingToolPanel,\r\n            });\r\n        }\r\n    }\r\n\r\n    public close(source: 'sideBarButtonClicked' | 'sideBarInitializing' | 'api' = 'api'): void {\r\n        this.openToolPanel(undefined, source);\r\n    }\r\n\r\n    public isToolPanelShowing(): boolean {\r\n        return !!this.openedItem();\r\n    }\r\n\r\n    public openedItem(): string | null {\r\n        let activeToolPanel: string | null = null;\r\n        this.toolPanelWrappers.forEach((wrapper) => {\r\n            if (wrapper.isDisplayed()) {\r\n                activeToolPanel = wrapper.getToolPanelId();\r\n            }\r\n        });\r\n        return activeToolPanel;\r\n    }\r\n\r\n    private onSideBarUpdated(): void {\r\n        const sideBarDef = parseSideBarDef(this.gos.get('sideBar'));\r\n\r\n        const existingToolPanelWrappers: { [id: string]: ToolPanelWrapper } = {};\r\n        if (sideBarDef && this.sideBar) {\r\n            sideBarDef.toolPanels?.forEach((toolPanelDef: ToolPanelDef) => {\r\n                const { id } = toolPanelDef;\r\n                if (!id) {\r\n                    return;\r\n                }\r\n                const existingToolPanelDef = this.sideBar!.toolPanels?.find(\r\n                    (toolPanelDefToCheck: ToolPanelDef) => toolPanelDefToCheck.id === id\r\n                ) as ToolPanelDef | undefined;\r\n                if (!existingToolPanelDef || toolPanelDef.toolPanel !== existingToolPanelDef.toolPanel) {\r\n                    return;\r\n                }\r\n                const toolPanelWrapper = this.toolPanelWrappers.find((toolPanel) => toolPanel.getToolPanelId() === id);\r\n                if (!toolPanelWrapper) {\r\n                    return;\r\n                }\r\n                const params = this.gos.addGridCommonParams<IToolPanelParams>({\r\n                    ...(toolPanelDef.toolPanelParams ?? {}),\r\n                    onStateUpdated: () => this.dispatchSideBarUpdated(),\r\n                });\r\n                const hasRefreshed = toolPanelWrapper.getToolPanelInstance()?.refresh(params);\r\n                if (hasRefreshed !== true) {\r\n                    return;\r\n                }\r\n                this.toolPanelWrappers = this.toolPanelWrappers.filter((toolPanel) => toolPanel !== toolPanelWrapper);\r\n                _removeFromParent(toolPanelWrapper.getGui());\r\n                existingToolPanelWrappers[id] = toolPanelWrapper;\r\n            });\r\n        }\r\n\r\n        this.clearDownUi();\r\n\r\n        // don't re-assign initial state\r\n        this.setSideBarDef({ sideBarDef, existingToolPanelWrappers });\r\n    }\r\n\r\n    private dispatchSideBarUpdated(): void {\r\n        this.eventSvc.dispatchEvent({ type: 'sideBarUpdated' });\r\n    }\r\n\r\n    private destroyToolPanelWrappers(): void {\r\n        this.toolPanelWrappers.forEach((wrapper) => {\r\n            _removeFromParent(wrapper.getGui());\r\n            this.destroyBean(wrapper);\r\n        });\r\n        this.toolPanelWrappers.length = 0;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyToolPanelWrappers();\r\n        super.destroy();\r\n    }\r\n}\r\n\r\nexport const AgSideBarSelector: ComponentSelector = {\r\n    selector: 'AG-SIDE-BAR',\r\n    component: AgSideBar,\r\n};\r\n", "import { TabGuardClassNames, _FOCUS_MANAGED_CLASS, _findFocusableElements } from 'ag-grid-community';\r\n\r\nexport function findFocusableElementBeforeTabGuard(\r\n    rootNode: HTMLElement,\r\n    referenceElement?: HTMLElement\r\n): HTMLElement | null {\r\n    if (!referenceElement) {\r\n        return null;\r\n    }\r\n\r\n    const focusableElements = _findFocusableElements(rootNode);\r\n    const referenceIndex = focusableElements.indexOf(referenceElement);\r\n\r\n    if (referenceIndex === -1) {\r\n        return null;\r\n    }\r\n\r\n    let lastTabGuardIndex = -1;\r\n    for (let i = referenceIndex - 1; i >= 0; i--) {\r\n        if (focusableElements[i].classList.contains(TabGuardClassNames.TAB_GUARD_TOP)) {\r\n            lastTabGuardIndex = i;\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (lastTabGuardIndex <= 0) {\r\n        return null;\r\n    }\r\n\r\n    return focusableElements[lastTabGuardIndex - 1];\r\n}\r\n\r\nexport function isTargetUnderManagedComponent(rootNode: HTMLElement, target?: HTMLElement): boolean {\r\n    if (!target) {\r\n        return false;\r\n    }\r\n\r\n    const managedContainers = rootNode.querySelectorAll(`.${_FOCUS_MANAGED_CLASS}`);\r\n\r\n    if (!managedContainers.length) {\r\n        return false;\r\n    }\r\n\r\n    for (let i = 0; i < managedContainers.length; i++) {\r\n        if (managedContainers[i].contains(target)) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n", "export const agSideBarCSS = /*css*/ `.ag-tool-panel-wrapper{cursor:default;display:flex;overflow:hidden auto;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:var(--ag-side-bar-panel-width)}.ag-select-agg-func-item{align-items:center;display:flex;flex:1 1 auto;flex-flow:row nowrap;height:100%;overflow:hidden;position:relative;text-overflow:ellipsis;white-space:nowrap;>*{flex:none}}.ag-tool-panel-horizontal-resize{cursor:ew-resize;height:100%;position:absolute;top:0;width:5px;z-index:1}.ag-side-bar{background-color:var(--ag-side-bar-background-color);display:flex;flex-direction:row-reverse;position:relative}:where(.ag-ltr) :where(.ag-side-bar-left) .ag-tool-panel-horizontal-resize{right:-3px}:where(.ag-rtl) :where(.ag-side-bar-left) .ag-tool-panel-horizontal-resize{left:-3px}:where(.ag-ltr) :where(.ag-side-bar-right) .ag-tool-panel-horizontal-resize{left:-3px}:where(.ag-rtl) :where(.ag-side-bar-right) .ag-tool-panel-horizontal-resize{right:-3px}.ag-side-bar-left{flex-direction:row;order:-1}.ag-side-buttons{background-color:var(--ag-side-button-bar-background-color);padding-top:var(--ag-side-button-bar-top-padding);position:relative}.ag-side-button{background-color:var(--ag-side-button-background-color);border-bottom:var(--ag-side-button-selected-border);border-bottom-color:transparent;border-top:var(--ag-side-button-selected-border);border-top-color:transparent;color:var(--ag-side-button-text-color);position:relative;&:before{background-color:transparent;bottom:0;content:\"\";display:block;position:absolute;top:0;transition:background-color var(--ag-side-button-selected-underline-transition-duration);width:var(--ag-side-button-selected-underline-width)}&:hover{background-color:var(--ag-side-button-hover-background-color);color:var(--ag-side-button-hover-text-color)}&.ag-selected{background-color:var(--ag-side-button-selected-background-color);border-bottom:var(--ag-side-button-selected-border);color:var(--ag-side-button-selected-text-color);&:where(:not(:first-of-type)){border-top:var(--ag-side-button-selected-border)}&:before{background-color:var(--ag-side-button-selected-underline-color)}}}:where(.ag-ltr) .ag-side-button{&:before{left:0}}:where(.ag-rtl) .ag-side-button{&:before{right:0}}.ag-side-button-button{align-items:center;cursor:pointer;display:flex;flex-direction:column;gap:var(--ag-spacing);position:relative;white-space:nowrap;width:100%;&:focus{box-shadow:none}}:where(.ag-ltr) .ag-side-button-button{padding:var(--ag-side-button-vertical-padding) var(--ag-side-button-right-padding) var(--ag-side-button-vertical-padding) var(--ag-side-button-left-padding)}:where(.ag-rtl) .ag-side-button-button{padding:var(--ag-side-button-vertical-padding) var(--ag-side-button-left-padding) var(--ag-side-button-vertical-padding) var(--ag-side-button-right-padding)}.ag-side-button-button:focus-visible{box-shadow:inset var(--ag-focus-shadow)}.ag-side-button-label{writing-mode:vertical-lr}@media (resolution <= 1.5x){.ag-side-button-label{font-family:\"Segoe UI\",var(--ag-font-family)}:where(.ag-ltr) .ag-side-button-label{transform:rotate(.05deg)}:where(.ag-rtl) .ag-side-button-label{transform:rotate(-.05deg)}}:where(.ag-ltr) .ag-side-bar-left,:where(.ag-rtl) .ag-side-bar-right{border-right:var(--ag-side-panel-border);:where(.ag-tool-panel-wrapper){border-left:var(--ag-side-panel-border)}}:where(.ag-ltr) .ag-side-bar-right,:where(.ag-rtl) .ag-side-bar-left{border-left:var(--ag-side-panel-border);:where(.ag-tool-panel-wrapper){border-right:var(--ag-side-panel-border)}}`;\n", "import type { AgEvent, ComponentSelector, ToolPanelDef } from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    KeyCode,\r\n    _clearElement,\r\n    _focusNextGridCoreContainer,\r\n    _stopPropagationForAgGrid,\r\n} from 'ag-grid-community';\r\n\r\nimport { SideBarButtonComp } from './sideBarButtonComp';\r\n\r\nexport interface SideBarButtonClickedEvent extends AgEvent<'sideBarButtonClicked'> {\r\n    toolPanelId: string;\r\n}\r\n\r\nexport type AgSideBarButtonsEvent = 'sideBarButtonClicked';\r\nexport class AgSideBarButtons extends Component<AgSideBarButtonsEvent> {\r\n    private buttonComps: SideBarButtonComp[] = [];\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-side-buttons\" role=\"tablist\"></div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.addManagedElementListeners(this.getFocusableElement(), { keydown: this.handleKeyDown.bind(this) });\r\n    }\r\n\r\n    private handleKeyDown(e: KeyboardEvent): void {\r\n        if (e.key !== KeyCode.TAB || !e.shiftKey) {\r\n            return;\r\n        }\r\n\r\n        if (_focusNextGridCoreContainer(this.beans, true)) {\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n\r\n        // Prevent the tab to go in an loop without exit inside the sidebar\r\n        _stopPropagationForAgGrid(e);\r\n    }\r\n\r\n    public setActiveButton(id: string | undefined): void {\r\n        this.buttonComps.forEach((comp) => {\r\n            comp.setSelected(id === comp.getToolPanelId());\r\n        });\r\n    }\r\n\r\n    public addButtonComp(def: ToolPanelDef): SideBarButtonComp {\r\n        const buttonComp = this.createBean(new SideBarButtonComp(def));\r\n        this.buttonComps.push(buttonComp);\r\n        this.appendChild(buttonComp);\r\n\r\n        buttonComp.addEventListener('toggleButtonClicked', () => {\r\n            this.dispatchLocalEvent({\r\n                type: 'sideBarButtonClicked',\r\n                toolPanelId: def.id,\r\n            });\r\n        });\r\n\r\n        return buttonComp;\r\n    }\r\n\r\n    public clearButtons(): void {\r\n        this.buttonComps = this.destroyBeans(this.buttonComps);\r\n        _clearElement(this.getGui());\r\n        super.destroy();\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.clearButtons();\r\n        super.destroy();\r\n    }\r\n}\r\n\r\nexport const AgSideBarButtonsSelector: ComponentSelector = {\r\n    selector: 'AG-SIDE-BAR-BUTTONS',\r\n    component: AgSideBarButtons,\r\n};\r\n", "import type { IconName, ToolPanelDef } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _createIconNoSpan, _setAriaExpanded } from 'ag-grid-community';\r\n\r\nexport type SideBarButtonCompEvent = 'toggleButtonClicked';\r\nexport class SideBarButtonComp extends Component<SideBarButtonCompEvent> {\r\n    public readonly eToggleButton: HTMLButtonElement = RefPlaceholder;\r\n    private readonly eIconWrapper: HTMLElement = RefPlaceholder;\r\n    private readonly eLabel: HTMLElement = RefPlaceholder;\r\n\r\n    constructor(private readonly toolPanelDef: ToolPanelDef) {\r\n        super();\r\n    }\r\n\r\n    public getToolPanelId(): string {\r\n        return this.toolPanelDef.id;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const template = this.createTemplate();\r\n        this.setTemplate(template, []);\r\n        this.setLabel();\r\n        this.setIcon();\r\n        this.addManagedElementListeners(this.eToggleButton, { click: this.onButtonPressed.bind(this) });\r\n        this.eToggleButton.setAttribute('id', `ag-${this.getCompId()}-button`);\r\n    }\r\n\r\n    private createTemplate(): string {\r\n        const res =\r\n            /* html */\r\n            `<div class=\"ag-side-button\" role=\"presentation\">\r\n                <button type=\"button\" data-ref=\"eToggleButton\" tabindex=\"-1\" role=\"tab\" aria-expanded=\"false\" class=\"ag-button ag-side-button-button\">\r\n                    <div data-ref=\"eIconWrapper\" class=\"ag-side-button-icon-wrapper\" aria-hidden=\"true\"></div>\r\n                    <span data-ref=\"eLabel\" class=\"ag-side-button-label\"></span>\r\n                </button>\r\n            </div>`;\r\n        return res;\r\n    }\r\n\r\n    private setLabel(): void {\r\n        const translate = this.getLocaleTextFunc();\r\n        const def = this.toolPanelDef;\r\n        const label = translate(def.labelKey, def.labelDefault);\r\n\r\n        this.eLabel.innerText = label;\r\n    }\r\n\r\n    private setIcon(): void {\r\n        this.eIconWrapper.insertAdjacentElement(\r\n            'afterbegin',\r\n            _createIconNoSpan(this.toolPanelDef.iconKey as IconName, this.beans)!\r\n        );\r\n    }\r\n\r\n    private onButtonPressed(): void {\r\n        this.dispatchLocalEvent({ type: 'toggleButtonClicked' });\r\n    }\r\n\r\n    public setSelected(selected: boolean): void {\r\n        this.addOrRemoveCssClass('ag-selected', selected);\r\n        _setAriaExpanded(this.eToggleButton, selected);\r\n    }\r\n}\r\n", "import type { SideBarDef, ToolPanelDef } from 'ag-grid-community';\r\nimport { _warn } from 'ag-grid-community';\r\n\r\nconst DEFAULT_COLUMN_COMP: ToolPanelDef = {\r\n    id: 'columns',\r\n    labelDefault: 'Columns',\r\n    labelKey: 'columns',\r\n    iconKey: 'columnsToolPanel',\r\n    toolPanel: 'agColumnsToolPanel',\r\n};\r\n\r\nconst DEFAULT_FILTER_COMP: ToolPanelDef = {\r\n    id: 'filters',\r\n    labelDefault: 'Filters',\r\n    labelKey: 'filters',\r\n    iconKey: 'filtersToolPanel',\r\n    toolPanel: 'agFiltersToolPanel',\r\n};\r\n\r\nconst DEFAULT_BY_KEY: { [p: string]: ToolPanelDef } = {\r\n    columns: DEFAULT_COLUMN_COMP,\r\n    filters: DEFAULT_FILTER_COMP,\r\n};\r\n\r\nexport function parseSideBarDef(\r\n    toParse: SideBarDef | string | string[] | boolean | null | undefined\r\n): SideBarDef | undefined {\r\n    if (!toParse) {\r\n        return undefined;\r\n    }\r\n    if (toParse === true) {\r\n        return {\r\n            toolPanels: [DEFAULT_COLUMN_COMP, DEFAULT_FILTER_COMP],\r\n            defaultToolPanel: 'columns',\r\n        };\r\n    }\r\n\r\n    if (typeof toParse === 'string') {\r\n        return parseSideBarDef([toParse]);\r\n    }\r\n\r\n    if (Array.isArray(toParse)) {\r\n        const comps: ToolPanelDef[] = [];\r\n        toParse.forEach((key) => {\r\n            const lookupResult = DEFAULT_BY_KEY[key];\r\n            if (!lookupResult) {\r\n                _warn(215, { key, defaultByKey: DEFAULT_BY_KEY });\r\n                return;\r\n            }\r\n\r\n            comps.push(lookupResult);\r\n        });\r\n\r\n        if (comps.length === 0) {\r\n            return undefined;\r\n        }\r\n\r\n        return {\r\n            toolPanels: comps,\r\n            defaultToolPanel: comps[0].id,\r\n        };\r\n    }\r\n\r\n    const result: SideBarDef = {\r\n        toolPanels: parseComponents(toParse.toolPanels),\r\n        defaultToolPanel: toParse.defaultToolPanel,\r\n        hiddenByDefault: toParse.hiddenByDefault,\r\n        position: toParse.position,\r\n    };\r\n\r\n    return result;\r\n}\r\n\r\nfunction parseComponents(from?: (ToolPanelDef | string)[]): ToolPanelDef[] {\r\n    const result: ToolPanelDef[] = [];\r\n\r\n    if (!from) {\r\n        return result;\r\n    }\r\n\r\n    from.forEach((it: ToolPanelDef | string) => {\r\n        let toAdd: ToolPanelDef | null = null;\r\n        if (typeof it === 'string') {\r\n            const lookupResult = DEFAULT_BY_KEY[it];\r\n            if (!lookupResult) {\r\n                _warn(215, { key: it, defaultByKey: DEFAULT_BY_KEY });\r\n                return;\r\n            }\r\n\r\n            toAdd = lookupResult;\r\n        } else {\r\n            toAdd = it;\r\n        }\r\n\r\n        result.push(toAdd);\r\n    });\r\n\r\n    return result;\r\n}\r\n", "import type {\r\n    ComponentType,\r\n    IToolPanelComp,\r\n    IToolPanelParams,\r\n    ToolPanelDef,\r\n    UserCompDetails,\r\n    UserComponentFactory,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport { AgHorizontalResize } from './agHorizontalResize';\r\n\r\nfunction getToolPanelCompDetails(\r\n    userCompFactory: UserComponentFactory,\r\n    toolPanelDef: ToolPanelDef,\r\n    params: WithoutGridCommon<IToolPanelParams>\r\n): UserCompDetails<IToolPanelComp> | undefined {\r\n    return userCompFactory.getCompDetails(toolPanelDef, ToolPanelComponent, undefined, params, true);\r\n}\r\n\r\nconst ToolPanelComponent: ComponentType = {\r\n    name: 'toolPanel',\r\n    optionalMethods: ['refresh', 'getState'],\r\n};\r\n\r\nexport class ToolPanelWrapper extends Component {\r\n    private toolPanelCompInstance: IToolPanelComp | undefined;\r\n    private toolPanelId: string;\r\n    private resizeBar: AgHorizontalResize;\r\n    private width: number | undefined;\r\n    private params: IToolPanelParams;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-tool-panel-wrapper\" role=\"tabpanel\"/>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const eGui = this.getGui();\r\n        const resizeBar = (this.resizeBar = this.createManagedBean(new AgHorizontalResize()));\r\n\r\n        eGui.setAttribute('id', `ag-${this.getCompId()}`);\r\n\r\n        resizeBar.elementToResize = eGui;\r\n        this.appendChild(resizeBar);\r\n    }\r\n\r\n    public getToolPanelId(): string {\r\n        return this.toolPanelId;\r\n    }\r\n\r\n    public setToolPanelDef(toolPanelDef: ToolPanelDef, params: WithoutGridCommon<IToolPanelParams>): boolean {\r\n        const { id, minWidth, maxWidth, width } = toolPanelDef;\r\n\r\n        this.toolPanelId = id;\r\n        this.width = width;\r\n\r\n        const compDetails = getToolPanelCompDetails(this.beans.userCompFactory, toolPanelDef, params);\r\n        if (compDetails == null) {\r\n            return false;\r\n        }\r\n\r\n        const componentPromise = compDetails.newAgStackInstance();\r\n        this.params = compDetails.params;\r\n\r\n        componentPromise.then(this.setToolPanelComponent.bind(this));\r\n\r\n        const resizeBar = this.resizeBar;\r\n        if (minWidth != null) {\r\n            resizeBar.minWidth = minWidth;\r\n        }\r\n\r\n        if (maxWidth != null) {\r\n            resizeBar.maxWidth = maxWidth;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private setToolPanelComponent(compInstance: IToolPanelComp): void {\r\n        this.toolPanelCompInstance = compInstance;\r\n\r\n        this.appendChild(compInstance.getGui());\r\n        this.addDestroyFunc(() => {\r\n            this.destroyBean(compInstance);\r\n        });\r\n\r\n        const width = this.width;\r\n        if (width) {\r\n            this.getGui().style.width = `${width}px`;\r\n        }\r\n    }\r\n\r\n    public getToolPanelInstance(): IToolPanelComp | undefined {\r\n        return this.toolPanelCompInstance;\r\n    }\r\n\r\n    public setResizerSizerSide(side: 'right' | 'left') {\r\n        const isRtl = this.gos.get('enableRtl');\r\n        const isLeft = side === 'left';\r\n        const inverted = isRtl ? isLeft : !isLeft;\r\n\r\n        this.resizeBar.inverted = inverted;\r\n    }\r\n\r\n    public refresh(): void {\r\n        this.toolPanelCompInstance?.refresh(this.params);\r\n    }\r\n}\r\n", "import { Component } from 'ag-grid-community';\r\n\r\nexport class AgHorizontalResize extends Component {\r\n    private startingWidth: number;\r\n    public elementToResize: HTMLElement;\r\n    public inverted: boolean;\r\n    public minWidth: number = 100;\r\n    public maxWidth: number | null = null;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-tool-panel-horizontal-resize\"></div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const finishedWithResizeFunc = this.beans.horizontalResizeSvc!.addResizeBar({\r\n            eResizeBar: this.getGui(),\r\n            dragStartPixels: 1,\r\n            onResizeStart: this.onResizeStart.bind(this),\r\n            onResizing: this.onResizing.bind(this),\r\n            onResizeEnd: this.onResizeEnd.bind(this),\r\n        });\r\n\r\n        this.addDestroyFunc(finishedWithResizeFunc);\r\n        this.inverted = this.gos.get('enableRtl');\r\n    }\r\n\r\n    private dispatchResizeEvent(start: boolean, end: boolean, width: number) {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'toolPanelSizeChanged',\r\n            width: width,\r\n            started: start,\r\n            ended: end,\r\n        });\r\n    }\r\n\r\n    private onResizeStart(): void {\r\n        this.startingWidth = this.elementToResize.offsetWidth;\r\n        this.dispatchResizeEvent(true, false, this.startingWidth);\r\n    }\r\n\r\n    private onResizeEnd(delta: number): void {\r\n        return this.onResizing(delta, true);\r\n    }\r\n\r\n    private onResizing(delta: number, isEnd: boolean = false): void {\r\n        const direction = this.inverted ? -1 : 1;\r\n        let newWidth = Math.max(this.minWidth, Math.floor(this.startingWidth - delta * direction));\r\n\r\n        if (this.maxWidth != null) {\r\n            newWidth = Math.min(this.maxWidth, newWidth);\r\n        }\r\n        this.elementToResize.style.width = `${newWidth}px`;\r\n        this.dispatchResizeEvent(false, isEnd, newWidth);\r\n    }\r\n}\r\n", "import type { IMenuItemComp, IMenuItemParams } from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    _createIconNoSpan,\r\n    _isNodeOrElement,\r\n    _loadTemplate,\r\n    _setAriaChecked,\r\n    _setAriaExpanded,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\ninterface AgMenuItemRendererParams {\r\n    cssClassPrefix?: string;\r\n    isCompact?: boolean;\r\n}\r\n\r\nexport class AgMenuItemRenderer extends Component implements IMenuItemComp {\r\n    private params: IMenuItemParams & AgMenuItemRendererParams;\r\n    private cssClassPrefix: string;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.setTemplate(/* html */ `<div></div>`);\r\n    }\r\n\r\n    public init(params: IMenuItemParams & AgMenuItemRendererParams): void {\r\n        this.params = params;\r\n        this.cssClassPrefix = this.params.cssClassPrefix ?? 'ag-menu-option';\r\n\r\n        this.addAriaAttributes();\r\n        this.addIcon();\r\n        this.addName();\r\n        this.addShortcut();\r\n        this.addSubMenu();\r\n    }\r\n\r\n    public configureDefaults(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private addAriaAttributes(): void {\r\n        const { checked, subMenu } = this.params;\r\n\r\n        const eGui = this.getGui();\r\n\r\n        if (checked) {\r\n            _setAriaChecked(eGui, checked);\r\n        }\r\n\r\n        if (subMenu) {\r\n            _setAriaExpanded(eGui, false);\r\n        }\r\n    }\r\n\r\n    private addIcon(): void {\r\n        if (this.params.isCompact) {\r\n            return;\r\n        }\r\n        const iconWrapper = _loadTemplate(\r\n            /* html */\r\n            `<span data-ref=\"eIcon\" class=\"${this.getClassName('part')} ${this.getClassName('icon')}\" role=\"presentation\"></span>`\r\n        );\r\n\r\n        const { checked, icon } = this.params;\r\n\r\n        if (checked) {\r\n            iconWrapper.appendChild(_createIconNoSpan('check', this.beans)!);\r\n        } else if (icon) {\r\n            if (_isNodeOrElement(icon)) {\r\n                iconWrapper.appendChild(icon);\r\n            } else if (typeof icon === 'string') {\r\n                iconWrapper.innerHTML = icon;\r\n            } else {\r\n                _warn(227);\r\n            }\r\n        }\r\n\r\n        this.getGui().appendChild(iconWrapper);\r\n    }\r\n\r\n    private addName(): void {\r\n        const name = _loadTemplate(\r\n            /* html */\r\n            `<span data-ref=\"eName\" class=\"${this.getClassName('part')} ${this.getClassName('text')}\">${this.params.name || ''}</span>`\r\n        );\r\n\r\n        this.getGui().appendChild(name);\r\n    }\r\n\r\n    private addShortcut(): void {\r\n        if (this.params.isCompact) {\r\n            return;\r\n        }\r\n        const shortcut = _loadTemplate(\r\n            /* html */\r\n            `<span data-ref=\"eShortcut\" class=\"${this.getClassName('part')} ${this.getClassName('shortcut')}\">${this.params.shortcut || ''}</span>`\r\n        );\r\n\r\n        this.getGui().appendChild(shortcut);\r\n    }\r\n\r\n    private addSubMenu(): void {\r\n        const pointer = _loadTemplate(\r\n            /* html */\r\n            `<span data-ref=\"ePopupPointer\" class=\"${this.getClassName('part')} ${this.getClassName('popup-pointer')}\"></span>`\r\n        );\r\n\r\n        const eGui = this.getGui();\r\n\r\n        if (this.params.subMenu) {\r\n            const iconName = this.gos.get('enableRtl') ? 'subMenuOpenRtl' : 'subMenuOpen';\r\n            pointer.appendChild(_createIconNoSpan(iconName, this.beans)!);\r\n        }\r\n\r\n        eGui.appendChild(pointer);\r\n    }\r\n\r\n    private getClassName(suffix: string) {\r\n        return `${this.cssClassPrefix}-${suffix}`;\r\n    }\r\n}\r\n", "export const menuCSS = /*css*/ `.ag-menu-list{cursor:default;display:table;padding:var(--ag-spacing) 0;width:100%}.ag-menu-option,.ag-menu-separator{display:table-row}.ag-menu-option-part,.ag-menu-separator-part{display:table-cell;vertical-align:middle}.ag-menu-option{cursor:pointer;font-weight:500}:where(.ag-ltr) :where(.ag-menu-option-popup-pointer) .ag-icon{text-align:right}:where(.ag-rtl) :where(.ag-menu-option-popup-pointer) .ag-icon{text-align:left}.ag-menu-option-text{white-space:nowrap}.ag-menu-option-custom{display:contents}.ag-compact-menu-option{display:flex;flex-wrap:nowrap;width:100%}.ag-compact-menu-option-text{flex:1 1 auto;white-space:nowrap}.ag-menu-separator{height:calc(var(--ag-spacing)*2 + 1px)}.ag-menu-separator-part:after{border-top:1px solid var(--ag-menu-separator-color);content:\"\";display:block}.ag-compact-menu-option-active,.ag-menu-option-active{background-color:var(--ag-row-hover-color)}.ag-compact-menu-option-part,.ag-menu-option-part{line-height:var(--ag-icon-size);padding:calc(var(--ag-spacing) + 2px) 0}.ag-compact-menu-option-disabled,.ag-menu-option-disabled{cursor:not-allowed;opacity:.5}.ag-compact-menu-option-icon,.ag-menu-option-icon{width:var(--ag-icon-size)}:where(.ag-ltr) .ag-compact-menu-option-icon,:where(.ag-ltr) .ag-menu-option-icon{padding-left:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-compact-menu-option-icon,:where(.ag-rtl) .ag-menu-option-icon{padding-right:calc(var(--ag-spacing)*2)}.ag-compact-menu-option-text,.ag-menu-option-text{padding-left:calc(var(--ag-spacing)*2);padding-right:calc(var(--ag-spacing)*2)}:where(.ag-ltr) .ag-compact-menu-option-shortcut,:where(.ag-ltr) .ag-menu-option-shortcut{padding-right:var(--ag-spacing)}:where(.ag-rtl) .ag-compact-menu-option-shortcut,:where(.ag-rtl) .ag-menu-option-shortcut{padding-left:var(--ag-spacing)}:where(.ag-ltr) .ag-compact-menu-option-popup-pointer,:where(.ag-ltr) .ag-menu-option-popup-pointer{padding-right:var(--ag-spacing)}:where(.ag-rtl) .ag-compact-menu-option-popup-pointer,:where(.ag-rtl) .ag-menu-option-popup-pointer{padding-left:var(--ag-spacing)}.ag-menu-column-select-wrapper{height:265px;overflow:auto;:where(.ag-column-select){height:100%}}.ag-menu:where(.ag-tabs){min-width:290px}.ag-context-menu-loading-icon{pointer-events:none;position:absolute}`;\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\n\r\nimport { VERSION } from '../version';\r\nimport { AgMenuItemRenderer } from './agMenuItemRenderer';\r\nimport { menuCSS } from './menu.css-GENERATED';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const MenuItemModule: _ModuleWithoutApi = {\r\n    moduleName: 'MenuItem',\r\n    version: VERSION,\r\n    userComponents: {\r\n        agMenuItem: AgMenuItemRenderer,\r\n    },\r\n    icons: {\r\n        // indicates the currently active pin state in the \"Pin column\" sub-menu of the column menu\r\n        check: 'tick',\r\n        // icon for sub menu item\r\n        subMenuOpen: 'small-right',\r\n        // version of subMenuOpen used in RTL mode\r\n        subMenuOpenRtl: 'small-left',\r\n    },\r\n    css: [menuCSS],\r\n};\r\n", "import type {\r\n    BeanCollection,\r\n    ColDef,\r\n    ColGroupDef,\r\n    ColumnToolPanelState,\r\n    IColumnToolPanel,\r\n    IToolPanelColumnCompParams,\r\n    IToolPanelComp,\r\n    IToolPanelParams,\r\n} from 'ag-grid-community';\r\nimport { Component, _clearElement, _last } from 'ag-grid-community';\r\n\r\nimport type { PivotDropZonePanel } from '../rowGrouping/columnDropZones/pivotDropZonePanel';\r\nimport type { RowGroupDropZonePanel } from '../rowGrouping/columnDropZones/rowGroupDropZonePanel';\r\nimport type { ValuesDropZonePanel } from '../rowGrouping/columnDropZones/valueDropZonePanel';\r\nimport { AgPrimaryCols } from './agPrimaryCols';\r\nimport { columnToolPanelCSS } from './columnToolPanel.css-GENERATED';\r\nimport type { ColumnToolPanelFactory } from './columnToolPanelFactory';\r\nimport type { PivotModePanel } from './pivotModePanel';\r\n\r\nexport interface ToolPanelColumnCompParams<TData = any, TContext = any>\r\n    extends IToolPanelParams<TData, TContext, ColumnToolPanelState>,\r\n        IToolPanelColumnCompParams {}\r\n\r\nexport class ColumnToolPanel extends Component implements IColumnToolPanel, IToolPanelComp {\r\n    private initialised = false;\r\n    private params: ToolPanelColumnCompParams;\r\n\r\n    private childDestroyFuncs: (() => void)[] = [];\r\n\r\n    private pivotModePanel?: PivotModePanel;\r\n    private primaryColsPanel: AgPrimaryCols;\r\n    private rowGroupDropZonePanel?: RowGroupDropZonePanel;\r\n    private valuesDropZonePanel?: ValuesDropZonePanel;\r\n    private pivotDropZonePanel?: PivotDropZonePanel;\r\n    private colToolPanelFactory?: ColumnToolPanelFactory;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-column-panel\"></div>`);\r\n        this.registerCSS(columnToolPanelCSS);\r\n    }\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.colToolPanelFactory = beans.colToolPanelFactory as ColumnToolPanelFactory;\r\n    }\r\n\r\n    // lazy initialise the panel\r\n    public override setVisible(visible: boolean): void {\r\n        super.setDisplayed(visible);\r\n        if (visible && !this.initialised) {\r\n            this.init(this.params);\r\n        }\r\n    }\r\n\r\n    public init(params: ToolPanelColumnCompParams): void {\r\n        const defaultParams: Partial<ToolPanelColumnCompParams> = this.gos.addGridCommonParams({\r\n            suppressColumnMove: false,\r\n            suppressColumnSelectAll: false,\r\n            suppressColumnFilter: false,\r\n            suppressColumnExpandAll: false,\r\n            contractColumnSelection: false,\r\n            suppressPivotMode: false,\r\n            suppressRowGroups: false,\r\n            suppressValues: false,\r\n            suppressPivots: false,\r\n            suppressSyncLayoutWithGrid: false,\r\n        });\r\n        const mergedParams = {\r\n            ...defaultParams,\r\n            ...params,\r\n        };\r\n        this.params = mergedParams;\r\n\r\n        const { childDestroyFuncs, colToolPanelFactory, gos } = this;\r\n\r\n        const hasPivotModule = gos.isModuleRegistered('SharedPivot');\r\n        const hasRowGroupingModule = hasPivotModule || gos.isModuleRegistered('SharedRowGrouping');\r\n\r\n        if (!mergedParams.suppressPivotMode && colToolPanelFactory && hasPivotModule) {\r\n            this.pivotModePanel = colToolPanelFactory.createPivotModePanel(this, childDestroyFuncs);\r\n        }\r\n\r\n        // DO NOT CHANGE TO createManagedBean\r\n        const primaryColsPanel = this.createBean(new AgPrimaryCols());\r\n        this.primaryColsPanel = primaryColsPanel;\r\n        childDestroyFuncs.push(() => this.destroyBean(this.primaryColsPanel));\r\n\r\n        primaryColsPanel.init(true, mergedParams, 'toolPanelUi');\r\n        primaryColsPanel.addCssClass('ag-column-panel-column-select');\r\n        this.appendChild(primaryColsPanel);\r\n\r\n        if (colToolPanelFactory) {\r\n            if (!mergedParams.suppressRowGroups && hasRowGroupingModule) {\r\n                this.rowGroupDropZonePanel = colToolPanelFactory.createRowGroupPanel(this, childDestroyFuncs);\r\n            }\r\n\r\n            if (!mergedParams.suppressValues && hasRowGroupingModule) {\r\n                this.valuesDropZonePanel = colToolPanelFactory.createValuesPanel(this, childDestroyFuncs);\r\n            }\r\n\r\n            if (!mergedParams.suppressPivots && hasPivotModule) {\r\n                this.pivotDropZonePanel = colToolPanelFactory.createPivotPanel(this, childDestroyFuncs);\r\n            }\r\n\r\n            this.setLastVisible();\r\n            const [pivotModeListener] = this.addManagedEventListeners({\r\n                columnPivotModeChanged: () => {\r\n                    this.resetChildrenHeight();\r\n                    this.setLastVisible();\r\n                },\r\n            });\r\n            childDestroyFuncs.push(() => pivotModeListener!());\r\n        }\r\n\r\n        this.initialised = true;\r\n    }\r\n\r\n    public setPivotModeSectionVisible(visible: boolean): void {\r\n        const colToolPanelFactory = this.colToolPanelFactory;\r\n        if (!colToolPanelFactory) {\r\n            return;\r\n        }\r\n\r\n        this.pivotModePanel = colToolPanelFactory.setPanelVisible(\r\n            this.pivotModePanel,\r\n            visible,\r\n            colToolPanelFactory.createPivotModePanel.bind(colToolPanelFactory, this, this.childDestroyFuncs, true)\r\n        );\r\n        this.setLastVisible();\r\n    }\r\n\r\n    public setRowGroupsSectionVisible(visible: boolean): void {\r\n        const colToolPanelFactory = this.colToolPanelFactory;\r\n        if (!colToolPanelFactory) {\r\n            return;\r\n        }\r\n\r\n        this.rowGroupDropZonePanel = colToolPanelFactory.setPanelVisible(\r\n            this.rowGroupDropZonePanel,\r\n            visible,\r\n            colToolPanelFactory.createRowGroupPanel.bind(colToolPanelFactory, this, this.childDestroyFuncs)\r\n        );\r\n        this.setLastVisible();\r\n    }\r\n\r\n    public setValuesSectionVisible(visible: boolean): void {\r\n        const colToolPanelFactory = this.colToolPanelFactory;\r\n        if (!colToolPanelFactory) {\r\n            return;\r\n        }\r\n\r\n        this.valuesDropZonePanel = colToolPanelFactory.setPanelVisible(\r\n            this.valuesDropZonePanel,\r\n            visible,\r\n            colToolPanelFactory.createValuesPanel.bind(colToolPanelFactory, this, this.childDestroyFuncs)\r\n        );\r\n        this.setLastVisible();\r\n    }\r\n\r\n    public setPivotSectionVisible(visible: boolean): void {\r\n        const colToolPanelFactory = this.colToolPanelFactory;\r\n        if (!colToolPanelFactory) {\r\n            return;\r\n        }\r\n\r\n        this.pivotDropZonePanel = colToolPanelFactory.setPanelVisible(\r\n            this.pivotDropZonePanel,\r\n            visible,\r\n            colToolPanelFactory.createPivotPanel.bind(colToolPanelFactory, this, this.childDestroyFuncs)\r\n        );\r\n        this.pivotDropZonePanel?.setDisplayed(visible);\r\n        this.setLastVisible();\r\n    }\r\n\r\n    private setResizers(): void {\r\n        [this.primaryColsPanel, this.rowGroupDropZonePanel, this.valuesDropZonePanel, this.pivotDropZonePanel].forEach(\r\n            (panel) => {\r\n                if (!panel) {\r\n                    return;\r\n                }\r\n                const eGui = panel.getGui();\r\n                panel.toggleResizable(\r\n                    !eGui.classList.contains('ag-last-column-drop') && !eGui.classList.contains('ag-hidden')\r\n                );\r\n            }\r\n        );\r\n    }\r\n\r\n    private setLastVisible(): void {\r\n        const eGui = this.getGui();\r\n\r\n        const columnDrops: HTMLElement[] = Array.prototype.slice.call(eGui.querySelectorAll('.ag-column-drop'));\r\n\r\n        columnDrops.forEach((columnDrop) => columnDrop.classList.remove('ag-last-column-drop'));\r\n\r\n        const columnDropEls = eGui.querySelectorAll('.ag-column-drop:not(.ag-hidden)');\r\n        const lastVisible = _last(columnDropEls) as HTMLElement;\r\n\r\n        if (lastVisible) {\r\n            lastVisible.classList.add('ag-last-column-drop');\r\n        }\r\n\r\n        this.setResizers();\r\n    }\r\n\r\n    private resetChildrenHeight(): void {\r\n        const eGui = this.getGui();\r\n        const children = eGui.children;\r\n\r\n        for (let i = 0; i < children.length; i++) {\r\n            const { style } = children[i] as HTMLElement;\r\n            style.removeProperty('height');\r\n            style.removeProperty('flex');\r\n        }\r\n    }\r\n\r\n    public expandColumnGroups(groupIds?: string[]): void {\r\n        this.primaryColsPanel.expandGroups(groupIds);\r\n    }\r\n\r\n    public collapseColumnGroups(groupIds?: string[]): void {\r\n        this.primaryColsPanel.collapseGroups(groupIds);\r\n    }\r\n\r\n    public setColumnLayout(colDefs: (ColDef | ColGroupDef)[]): void {\r\n        this.primaryColsPanel.setColumnLayout(colDefs);\r\n    }\r\n\r\n    public syncLayoutWithGrid(): void {\r\n        this.primaryColsPanel.syncLayoutWithGrid();\r\n    }\r\n\r\n    public destroyChildren(): void {\r\n        const childDestroyFuncs = this.childDestroyFuncs;\r\n        childDestroyFuncs.forEach((func) => func());\r\n        childDestroyFuncs.length = 0;\r\n        _clearElement(this.getGui());\r\n    }\r\n\r\n    public refresh(params: ToolPanelColumnCompParams): boolean {\r\n        this.destroyChildren();\r\n        this.init(params);\r\n        return true;\r\n    }\r\n\r\n    public getState(): ColumnToolPanelState {\r\n        return {\r\n            expandedGroupIds: this.primaryColsPanel.getExpandedGroups(),\r\n        };\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyChildren();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { ColDef, ColGroupDef, ColumnEventType, ComponentSelector } from 'ag-grid-community';\r\nimport { Component, PositionableFeature, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport { agPrimaryColsCSS } from './agPrimaryCols.css-GENERATED';\r\nimport type { AgPrimaryColsHeader } from './agPrimaryColsHeader';\r\nimport { AgPrimaryColsHeaderSelector } from './agPrimaryColsHeader';\r\nimport type { AgPrimaryColsList } from './agPrimaryColsList';\r\nimport { AgPrimaryColsListSelector } from './agPrimaryColsList';\r\nimport type { ToolPanelColumnCompParams } from './columnToolPanel';\r\n\r\nexport class AgPrimaryCols extends Component {\r\n    private readonly primaryColsHeaderPanel: AgPrimaryColsHeader = RefPlaceholder;\r\n    private readonly primaryColsListPanel: AgPrimaryColsList = RefPlaceholder;\r\n\r\n    private positionableFeature: PositionableFeature;\r\n\r\n    constructor() {\r\n        super(\r\n            /* html */ `<div class=\"ag-column-select\">\r\n            <ag-primary-cols-header data-ref=\"primaryColsHeaderPanel\"></ag-primary-cols-header>\r\n            <ag-primary-cols-list data-ref=\"primaryColsListPanel\"></ag-primary-cols-list>\r\n        </div>`,\r\n            [AgPrimaryColsHeaderSelector, AgPrimaryColsListSelector]\r\n        );\r\n        this.registerCSS(agPrimaryColsCSS);\r\n    }\r\n\r\n    // we allow dragging in the toolPanel, but not when this component appears in the column menu\r\n    public init(allowDragging: boolean, params: ToolPanelColumnCompParams, eventType: ColumnEventType): void {\r\n        const { primaryColsHeaderPanel, primaryColsListPanel } = this;\r\n\r\n        primaryColsHeaderPanel.init(params);\r\n\r\n        const hideFilter = params.suppressColumnFilter;\r\n        const hideSelect = params.suppressColumnSelectAll;\r\n        const hideExpand = params.suppressColumnExpandAll;\r\n\r\n        if (hideExpand && hideFilter && hideSelect) {\r\n            primaryColsHeaderPanel.setDisplayed(false);\r\n        }\r\n\r\n        this.addManagedListeners(primaryColsListPanel, {\r\n            groupExpanded: (event) => {\r\n                primaryColsHeaderPanel.setExpandState(event.state);\r\n                params.onStateUpdated();\r\n            },\r\n            selectionChanged: (event) => primaryColsHeaderPanel.setSelectionState(event.state),\r\n        });\r\n\r\n        primaryColsListPanel.init(params, allowDragging, eventType);\r\n\r\n        this.addManagedListeners(primaryColsHeaderPanel, {\r\n            expandAll: primaryColsListPanel.doSetExpandedAll.bind(primaryColsListPanel, true),\r\n            collapseAll: primaryColsListPanel.doSetExpandedAll.bind(primaryColsListPanel, false),\r\n            selectAll: primaryColsListPanel.doSetSelectedAll.bind(primaryColsListPanel, true),\r\n            unselectAll: primaryColsListPanel.doSetSelectedAll.bind(primaryColsListPanel, false),\r\n            filterChanged: (event) => primaryColsListPanel.setFilterText(event.filterText),\r\n        });\r\n\r\n        this.positionableFeature = this.createManagedBean(new PositionableFeature(this.getGui(), { minHeight: 100 }));\r\n    }\r\n\r\n    public toggleResizable(resizable: boolean) {\r\n        this.positionableFeature.setResizable(resizable ? { bottom: true } : false);\r\n    }\r\n\r\n    public expandGroups(groupIds?: string[]): void {\r\n        this.primaryColsListPanel.setGroupsExpanded(true, groupIds);\r\n    }\r\n\r\n    public collapseGroups(groupIds?: string[]): void {\r\n        this.primaryColsListPanel.setGroupsExpanded(false, groupIds);\r\n    }\r\n\r\n    public setColumnLayout(colDefs: (ColDef | ColGroupDef)[]): void {\r\n        this.primaryColsListPanel.setColumnLayout(colDefs);\r\n    }\r\n\r\n    public syncLayoutWithGrid(): void {\r\n        this.primaryColsListPanel.onColumnsChanged();\r\n    }\r\n\r\n    public getExpandedGroups(): string[] {\r\n        return this.primaryColsListPanel.getExpandedGroups();\r\n    }\r\n}\r\n\r\nexport const AgPrimaryColsSelector: ComponentSelector = {\r\n    selector: 'AG-PRIMARY-COLS',\r\n    component: AgPrimaryCols,\r\n};\r\n", "export const agPrimaryColsCSS = /*css*/ `.ag-column-select{display:flex;flex:3 1 0px;flex-direction:column;overflow:hidden;position:relative}.ag-column-select-header{align-items:center;display:flex;flex:none;gap:var(--ag-widget-horizontal-spacing);height:var(--ag-header-height);padding-left:var(--ag-widget-container-horizontal-padding);padding-right:var(--ag-widget-container-horizontal-padding);position:relative}.ag-column-select-column,.ag-column-select-column-group{align-items:center;display:flex;gap:var(--ag-widget-horizontal-spacing);height:100%;position:relative;&:where(:not(:last-child)){margin-bottom:var(--ag-widget-vertical-spacing)}}:where(.ag-ltr) .ag-column-select-column,:where(.ag-ltr) .ag-column-select-column-group{padding-left:calc(var(--ag-indentation-level)*var(--ag-column-select-indent-size))}:where(.ag-rtl) .ag-column-select-column,:where(.ag-rtl) .ag-column-select-column-group{padding-right:calc(var(--ag-indentation-level)*var(--ag-column-select-indent-size))}.ag-column-select-header-icon{border-radius:var(--ag-border-radius);cursor:pointer;height:var(--ag-icon-size);position:relative;width:var(--ag-icon-size);&:focus-visible{box-shadow:var(--ag-focus-shadow)}}.ag-column-select-header-filter-wrapper{flex:1 1 auto}.ag-column-select-header-filter{width:100%}.ag-column-select-list{flex:1 1 0px;overflow:hidden}:where(.ag-ltr) .ag-column-select-add-group-indent{margin-left:calc(var(--ag-icon-size) + var(--ag-spacing)*1.5)}:where(.ag-rtl) .ag-column-select-add-group-indent{margin-right:calc(var(--ag-icon-size) + var(--ag-spacing)*1.5)}.ag-column-select-column-group-readonly,.ag-column-select-column-readonly{opacity:.5;pointer-events:none}.ag-column-select-virtual-list-viewport{padding:calc(var(--ag-widget-container-vertical-padding)*.5) 0}.ag-column-select-virtual-list-item{padding:0 var(--ag-widget-container-horizontal-padding)}.ag-column-select-column-label{flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ag-column-select-checkbox{display:flex}`;\n", "import type { AgCheckbox, AgInputTextField, ComponentSelector } from 'ag-grid-community';\r\nimport {\r\n    AgCheckboxSelector,\r\n    AgInputTextFieldSelector,\r\n    Component,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    _createIconNoSpan,\r\n    _debounce,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport type { ToolPanelColumnCompParams } from './columnToolPanel';\r\n\r\nexport enum ExpandState {\r\n    EXPANDED,\r\n    COLLAPSED,\r\n    INDETERMINATE,\r\n}\r\n\r\nconst DEBOUNCE_DELAY = 300;\r\nexport type AgPrimaryColsHeaderEvent = 'unselectAll' | 'selectAll' | 'collapseAll' | 'expandAll' | 'filterChanged';\r\nexport class AgPrimaryColsHeader extends Component<AgPrimaryColsHeaderEvent> {\r\n    private readonly eExpand: Element = RefPlaceholder;\r\n    private readonly eSelect: AgCheckbox = RefPlaceholder;\r\n    private readonly eFilterTextField: AgInputTextField = RefPlaceholder;\r\n\r\n    private eExpandChecked: Element;\r\n    private eExpandUnchecked: Element;\r\n    private eExpandIndeterminate: Element;\r\n\r\n    private expandState: ExpandState;\r\n    private selectState?: boolean;\r\n\r\n    private onFilterTextChangedDebounced: () => void;\r\n\r\n    private params: ToolPanelColumnCompParams;\r\n\r\n    constructor() {\r\n        super(\r\n            /* html */ `<div class=\"ag-column-select-header\" role=\"presentation\">\r\n            <div data-ref=\"eExpand\" class=\"ag-column-select-header-icon\"></div>\r\n            <ag-checkbox data-ref=\"eSelect\" class=\"ag-column-select-header-checkbox\"></ag-checkbox>\r\n            <ag-input-text-field class=\"ag-column-select-header-filter-wrapper\" data-ref=\"eFilterTextField\"></ag-input-text-field>\r\n        </div>`,\r\n            [AgCheckboxSelector, AgInputTextFieldSelector]\r\n        );\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.createExpandIcons();\r\n\r\n        this.addManagedListeners(this.eExpand, {\r\n            click: this.onExpandClicked.bind(this),\r\n            keydown: (e: KeyboardEvent) => {\r\n                if (e.key === KeyCode.SPACE) {\r\n                    e.preventDefault();\r\n                    this.onExpandClicked();\r\n                }\r\n            },\r\n        });\r\n\r\n        this.addManagedElementListeners(this.eSelect.getInputElement(), { click: this.onSelectClicked.bind(this) });\r\n        this.addManagedPropertyListener('functionsReadOnly', () => this.onFunctionsReadOnlyPropChanged());\r\n\r\n        this.eFilterTextField.setAutoComplete(false).onValueChange(() => this.onFilterTextChanged());\r\n\r\n        this.addManagedEventListeners({ newColumnsLoaded: this.showOrHideOptions.bind(this) });\r\n\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        this.eSelect.setInputAriaLabel(translate('ariaColumnSelectAll', 'Toggle All Columns Visibility'));\r\n        this.eFilterTextField.setInputAriaLabel(translate('ariaFilterColumnsInput', 'Filter Columns Input'));\r\n\r\n        this.activateTabIndex([this.eExpand]);\r\n    }\r\n\r\n    private onFunctionsReadOnlyPropChanged(): void {\r\n        const readOnly = this.gos.get('functionsReadOnly');\r\n        this.eSelect.setReadOnly(readOnly);\r\n        this.eSelect.addOrRemoveCssClass('ag-column-select-column-readonly', readOnly);\r\n    }\r\n\r\n    public init(params: ToolPanelColumnCompParams): void {\r\n        this.params = params;\r\n\r\n        const readOnly = this.gos.get('functionsReadOnly');\r\n        this.eSelect.setReadOnly(readOnly);\r\n        this.eSelect.addOrRemoveCssClass('ag-column-select-column-readonly', readOnly);\r\n\r\n        if (this.beans.colModel.ready) {\r\n            this.showOrHideOptions();\r\n        }\r\n    }\r\n\r\n    private createExpandIcons() {\r\n        const beans = this.beans;\r\n        this.eExpand.appendChild((this.eExpandChecked = _createIconNoSpan('columnSelectOpen', beans)!));\r\n\r\n        this.eExpand.appendChild((this.eExpandUnchecked = _createIconNoSpan('columnSelectClosed', beans)!));\r\n\r\n        this.eExpand.appendChild((this.eExpandIndeterminate = _createIconNoSpan('columnSelectIndeterminate', beans)!));\r\n\r\n        this.setExpandState(ExpandState.EXPANDED);\r\n    }\r\n\r\n    // we only show expand / collapse if we are showing columns\r\n    private showOrHideOptions(): void {\r\n        const params = this.params;\r\n        const showFilter = !params.suppressColumnFilter;\r\n        const showSelect = !params.suppressColumnSelectAll;\r\n        const showExpand = !params.suppressColumnExpandAll;\r\n        const groupsPresent = !!this.beans.colModel.colDefCols?.treeDepth;\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        this.eFilterTextField.setInputPlaceholder(translate('searchOoo', 'Search...'));\r\n\r\n        _setDisplayed(this.eFilterTextField.getGui(), showFilter);\r\n        _setDisplayed(this.eSelect.getGui(), showSelect);\r\n        _setDisplayed(this.eExpand, showExpand && groupsPresent);\r\n    }\r\n\r\n    private onFilterTextChanged(): void {\r\n        if (!this.onFilterTextChangedDebounced) {\r\n            this.onFilterTextChangedDebounced = _debounce(\r\n                this,\r\n                () => {\r\n                    const filterText = this.eFilterTextField.getValue();\r\n                    this.dispatchLocalEvent({ type: 'filterChanged', filterText: filterText });\r\n                },\r\n                DEBOUNCE_DELAY\r\n            );\r\n        }\r\n\r\n        this.onFilterTextChangedDebounced();\r\n    }\r\n\r\n    private onSelectClicked(): void {\r\n        this.dispatchLocalEvent({ type: this.selectState ? 'unselectAll' : 'selectAll' });\r\n    }\r\n\r\n    private onExpandClicked(): void {\r\n        this.dispatchLocalEvent({ type: this.expandState === ExpandState.EXPANDED ? 'collapseAll' : 'expandAll' });\r\n    }\r\n\r\n    public setExpandState(state: ExpandState): void {\r\n        this.expandState = state;\r\n\r\n        _setDisplayed(this.eExpandChecked, state === ExpandState.EXPANDED);\r\n        _setDisplayed(this.eExpandUnchecked, state === ExpandState.COLLAPSED);\r\n        _setDisplayed(this.eExpandIndeterminate, state === ExpandState.INDETERMINATE);\r\n    }\r\n\r\n    public setSelectionState(state?: boolean): void {\r\n        this.selectState = state;\r\n        this.eSelect.setValue(this.selectState);\r\n    }\r\n}\r\n\r\nexport const AgPrimaryColsHeaderSelector: ComponentSelector = {\r\n    selector: 'AG-PRIMARY-COLS-HEADER',\r\n    component: AgPrimaryColsHeader,\r\n};\r\n", "import type {\r\n    AbstractColDef,\r\n    AgColumn,\r\n    AgProvidedColumnGroup,\r\n    BeanCollection,\r\n    ColGroupDef,\r\n    ColumnEventType,\r\n    ColumnModel,\r\n    ColumnToolPanelState,\r\n    ComponentSelector,\r\n} from 'ag-grid-community';\r\nimport { Component, _exists, _setAriaLabel, _setAriaLevel, _warn, isProvidedColumnGroup } from 'ag-grid-community';\r\n\r\nimport { syncLayoutWithGrid, toolPanelCreateColumnTree } from '../sideBar/common/toolPanelColDefService';\r\nimport type { VirtualListModel } from '../widgets/iVirtualList';\r\nimport { VirtualList } from '../widgets/virtualList';\r\nimport { ExpandState } from './agPrimaryColsHeader';\r\nimport { ColumnModelItem } from './columnModelItem';\r\nimport type { ToolPanelColumnCompParams } from './columnToolPanel';\r\nimport { selectAllChildren } from './modelItemUtils';\r\nimport { PrimaryColsListPanelItemDragFeature } from './primaryColsListPanelItemDragFeature';\r\nimport { ToolPanelColumnComp } from './toolPanelColumnComp';\r\nimport { ToolPanelColumnGroupComp } from './toolPanelColumnGroupComp';\r\n\r\nclass UIColumnModel implements VirtualListModel {\r\n    constructor(private readonly items: ColumnModelItem[]) {}\r\n\r\n    public getRowCount(): number {\r\n        return this.items.length;\r\n    }\r\n\r\n    public getRow(index: number): ColumnModelItem {\r\n        return this.items[index];\r\n    }\r\n}\r\n\r\nconst PRIMARY_COLS_LIST_PANEL_CLASS = 'ag-column-select-list';\r\n\r\nexport type AgPrimaryColsListEvent = 'groupExpanded' | 'selectionChanged';\r\nexport class AgPrimaryColsList extends Component<AgPrimaryColsListEvent> {\r\n    private colModel: ColumnModel;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n    }\r\n\r\n    private allowDragging: boolean;\r\n    private filterText: string | null;\r\n    private expandGroupsByDefault: boolean;\r\n    private params: ToolPanelColumnCompParams;\r\n    private eventType: ColumnEventType;\r\n\r\n    private groupsExist: boolean;\r\n\r\n    private virtualList: VirtualList;\r\n\r\n    private allColsTree: ColumnModelItem[];\r\n    private displayedColsList: ColumnModelItem[];\r\n    private destroyColumnItemFuncs: (() => void)[] = [];\r\n    private hasLoadedInitialState: boolean = false;\r\n    private isInitialState: boolean = false;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"${PRIMARY_COLS_LIST_PANEL_CLASS}\" role=\"presentation\"></div>`);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyColumnTree();\r\n        super.destroy();\r\n    }\r\n\r\n    private destroyColumnTree(): void {\r\n        this.allColsTree = [];\r\n        this.destroyColumnItemFuncs.forEach((f) => f());\r\n        this.destroyColumnItemFuncs = [];\r\n    }\r\n\r\n    public init(params: ToolPanelColumnCompParams, allowDragging: boolean, eventType: ColumnEventType): void {\r\n        this.params = params;\r\n        this.allowDragging = allowDragging;\r\n        this.eventType = eventType;\r\n\r\n        if (!params.suppressSyncLayoutWithGrid) {\r\n            this.addManagedEventListeners({ columnMoved: this.onColumnsChanged.bind(this) });\r\n        }\r\n\r\n        this.addManagedEventListeners({\r\n            newColumnsLoaded: this.onColumnsChanged.bind(this),\r\n        });\r\n\r\n        const listener = this.fireSelectionChangedEvent.bind(this);\r\n        this.addManagedEventListeners({\r\n            columnPivotChanged: listener,\r\n            columnPivotModeChanged: listener,\r\n            columnRowGroupChanged: listener,\r\n            columnValueChanged: listener,\r\n            columnVisible: listener,\r\n            newColumnsLoaded: listener,\r\n        });\r\n\r\n        this.expandGroupsByDefault = !params.contractColumnSelection;\r\n\r\n        const virtualList = this.createManagedBean(\r\n            new VirtualList({\r\n                cssIdentifier: 'column-select',\r\n                ariaRole: 'tree',\r\n            })\r\n        );\r\n        this.virtualList = virtualList;\r\n\r\n        this.appendChild(virtualList.getGui());\r\n\r\n        virtualList.setComponentCreator((item: ColumnModelItem, listItemElement: HTMLElement) => {\r\n            _setAriaLevel(listItemElement, item.depth + 1);\r\n            return this.createComponentFromItem(item, listItemElement);\r\n        });\r\n\r\n        if (this.colModel.ready) {\r\n            this.onColumnsChanged();\r\n        }\r\n\r\n        if (params.suppressColumnMove) {\r\n            return;\r\n        }\r\n\r\n        this.createManagedBean(new PrimaryColsListPanelItemDragFeature(this, virtualList));\r\n    }\r\n\r\n    private createComponentFromItem(item: ColumnModelItem, listItemElement: HTMLElement): Component {\r\n        const allowDragging = this.allowDragging;\r\n        if (item.group) {\r\n            const renderedGroup = new ToolPanelColumnGroupComp(item, allowDragging, this.eventType, listItemElement);\r\n            this.createBean(renderedGroup);\r\n\r\n            return renderedGroup;\r\n        }\r\n\r\n        const columnComp = new ToolPanelColumnComp(item, allowDragging, this.groupsExist, listItemElement);\r\n        this.createBean(columnComp);\r\n\r\n        return columnComp;\r\n    }\r\n\r\n    public onColumnsChanged(): void {\r\n        const params = this.params;\r\n        if (!this.hasLoadedInitialState) {\r\n            this.hasLoadedInitialState = true;\r\n            this.isInitialState = !!params.initialState;\r\n        }\r\n\r\n        const expandedStates = this.getExpandedStates();\r\n\r\n        const pivotModeActive = this.colModel.isPivotMode();\r\n        const shouldSyncColumnLayoutWithGrid = !params.suppressSyncLayoutWithGrid && !pivotModeActive;\r\n\r\n        if (shouldSyncColumnLayoutWithGrid) {\r\n            this.buildTreeFromWhatGridIsDisplaying();\r\n        } else {\r\n            this.buildTreeFromProvidedColumnDefs();\r\n        }\r\n\r\n        this.setExpandedStates(expandedStates);\r\n\r\n        this.markFilteredColumns();\r\n        this.flattenAndFilterModel();\r\n\r\n        this.isInitialState = false;\r\n    }\r\n\r\n    public getDisplayedColsList(): ColumnModelItem[] {\r\n        return this.displayedColsList;\r\n    }\r\n\r\n    private getExpandedStates(): { [key: string]: boolean } {\r\n        const res: { [id: string]: boolean } = {};\r\n\r\n        if (this.isInitialState) {\r\n            const { expandedGroupIds } = this.params.initialState as ColumnToolPanelState;\r\n            expandedGroupIds.forEach((id) => {\r\n                res[id] = true;\r\n            });\r\n            return res;\r\n        }\r\n\r\n        if (!this.allColsTree) {\r\n            return {};\r\n        }\r\n\r\n        this.forEachItem((item) => {\r\n            if (!item.group) {\r\n                return;\r\n            }\r\n            const colGroup = item.columnGroup;\r\n            if (colGroup) {\r\n                // group should always exist, this is defensive\r\n                res[colGroup.getId()] = item.expanded;\r\n            }\r\n        });\r\n\r\n        return res;\r\n    }\r\n\r\n    private setExpandedStates(states: { [key: string]: boolean }): void {\r\n        if (!this.allColsTree) {\r\n            return;\r\n        }\r\n\r\n        const { isInitialState } = this;\r\n        this.forEachItem((item) => {\r\n            if (!item.group) {\r\n                return;\r\n            }\r\n            const colGroup = item.columnGroup;\r\n            if (colGroup) {\r\n                // group should always exist, this is defensive\r\n                const expanded = states[colGroup.getId()];\r\n                const groupExistedLastTime = expanded != null;\r\n                if (groupExistedLastTime || isInitialState) {\r\n                    item.expanded = !!expanded;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private buildTreeFromWhatGridIsDisplaying(): void {\r\n        syncLayoutWithGrid(this.colModel, this.setColumnLayout.bind(this));\r\n    }\r\n\r\n    public setColumnLayout(colDefs: AbstractColDef[]): void {\r\n        const columnTree = toolPanelCreateColumnTree(this.colModel, colDefs);\r\n        this.buildListModel(columnTree);\r\n\r\n        // using col defs to check if groups exist as it could be a custom layout\r\n        this.groupsExist = colDefs.some((colDef) => {\r\n            return colDef && typeof (colDef as ColGroupDef).children !== 'undefined';\r\n        });\r\n\r\n        this.markFilteredColumns();\r\n        this.flattenAndFilterModel();\r\n    }\r\n\r\n    private buildTreeFromProvidedColumnDefs(): void {\r\n        const colModel = this.colModel;\r\n        // add column / group comps to tool panel\r\n        this.buildListModel(colModel.getColDefColTree());\r\n        this.groupsExist = !!colModel.colDefCols?.treeDepth;\r\n    }\r\n\r\n    private buildListModel(columnTree: (AgColumn | AgProvidedColumnGroup)[]): void {\r\n        const columnExpandedListener = this.onColumnExpanded.bind(this);\r\n        const addListeners = (item: ColumnModelItem) => {\r\n            item.addEventListener('expandedChanged', columnExpandedListener);\r\n            const removeFunc = item.removeEventListener.bind(item, 'expandedChanged', columnExpandedListener);\r\n            this.destroyColumnItemFuncs.push(removeFunc);\r\n        };\r\n        const colNames = this.beans.colNames;\r\n\r\n        const recursivelyBuild = (\r\n            tree: (AgColumn | AgProvidedColumnGroup)[],\r\n            dept: number,\r\n            parentList: ColumnModelItem[]\r\n        ): void => {\r\n            tree.forEach((child) => {\r\n                if (isProvidedColumnGroup(child)) {\r\n                    createGroupItem(child, dept, parentList);\r\n                } else {\r\n                    createColumnItem(child, dept, parentList);\r\n                }\r\n            });\r\n        };\r\n\r\n        const createGroupItem = (\r\n            columnGroup: AgProvidedColumnGroup,\r\n            dept: number,\r\n            parentList: ColumnModelItem[]\r\n        ): void => {\r\n            const columnGroupDef = columnGroup.getColGroupDef();\r\n            const skipThisGroup = columnGroupDef && columnGroupDef.suppressColumnsToolPanel;\r\n            if (skipThisGroup) {\r\n                return;\r\n            }\r\n\r\n            if (columnGroup.isPadding()) {\r\n                recursivelyBuild(columnGroup.getChildren(), dept, parentList);\r\n                return;\r\n            }\r\n\r\n            const displayName = colNames.getDisplayNameForProvidedColumnGroup(null, columnGroup, 'columnToolPanel');\r\n            const item: ColumnModelItem = new ColumnModelItem(\r\n                displayName,\r\n                columnGroup,\r\n                dept,\r\n                true,\r\n                this.expandGroupsByDefault\r\n            );\r\n\r\n            parentList.push(item);\r\n            addListeners(item);\r\n\r\n            recursivelyBuild(columnGroup.getChildren(), dept + 1, item.children);\r\n        };\r\n\r\n        const createColumnItem = (column: AgColumn, dept: number, parentList: ColumnModelItem[]): void => {\r\n            const skipThisColumn = column.getColDef() && column.getColDef().suppressColumnsToolPanel;\r\n\r\n            if (skipThisColumn) {\r\n                return;\r\n            }\r\n\r\n            const displayName = colNames.getDisplayNameForColumn(column, 'columnToolPanel');\r\n\r\n            parentList.push(new ColumnModelItem(displayName, column, dept));\r\n        };\r\n\r\n        this.destroyColumnTree();\r\n        recursivelyBuild(columnTree, 0, this.allColsTree);\r\n    }\r\n\r\n    private onColumnExpanded(): void {\r\n        this.flattenAndFilterModel();\r\n    }\r\n\r\n    private flattenAndFilterModel(): void {\r\n        this.displayedColsList = [];\r\n\r\n        const recursiveFunc = (item: ColumnModelItem) => {\r\n            if (!item.passesFilter) {\r\n                return;\r\n            }\r\n            this.displayedColsList.push(item);\r\n            if (item.group && item.expanded) {\r\n                item.children.forEach(recursiveFunc);\r\n            }\r\n        };\r\n\r\n        const virtualList = this.virtualList;\r\n        this.allColsTree.forEach(recursiveFunc);\r\n        virtualList.setModel(new UIColumnModel(this.displayedColsList));\r\n\r\n        const focusedRow = virtualList.getLastFocusedRow();\r\n        virtualList.refresh();\r\n\r\n        if (focusedRow != null) {\r\n            this.focusRowIfAlive(focusedRow);\r\n        }\r\n\r\n        this.notifyListeners();\r\n\r\n        this.refreshAriaLabel();\r\n    }\r\n\r\n    private refreshAriaLabel(): void {\r\n        const translate = this.getLocaleTextFunc();\r\n        const columnListName = translate('ariaColumnPanelList', 'Column List');\r\n        const localeColumns = translate('columns', 'Columns');\r\n        const items = this.displayedColsList.length;\r\n\r\n        _setAriaLabel(this.virtualList.getAriaElement(), `${columnListName} ${items} ${localeColumns}`);\r\n    }\r\n\r\n    private focusRowIfAlive(rowIndex: number): void {\r\n        window.setTimeout(() => {\r\n            if (this.isAlive()) {\r\n                this.virtualList.focusRow(rowIndex);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    private forEachItem(callback: (item: ColumnModelItem) => void): void {\r\n        const recursiveFunc = (items: ColumnModelItem[]) => {\r\n            items.forEach((item) => {\r\n                callback(item);\r\n                if (item.group) {\r\n                    recursiveFunc(item.children);\r\n                }\r\n            });\r\n        };\r\n\r\n        const allColsTree = this.allColsTree;\r\n        if (!allColsTree) {\r\n            return;\r\n        }\r\n\r\n        recursiveFunc(allColsTree);\r\n    }\r\n\r\n    public doSetExpandedAll(value: boolean): void {\r\n        this.forEachItem((item) => {\r\n            if (item.group) {\r\n                item.expanded = value;\r\n            }\r\n        });\r\n    }\r\n\r\n    public setGroupsExpanded(expand: boolean, groupIds?: string[]): void {\r\n        if (!groupIds) {\r\n            this.doSetExpandedAll(expand);\r\n            return;\r\n        }\r\n\r\n        const expandedGroupIds: string[] = [];\r\n\r\n        this.forEachItem((item) => {\r\n            if (!item.group) {\r\n                return;\r\n            }\r\n\r\n            const groupId = item.columnGroup.getId();\r\n            if (groupIds.indexOf(groupId) >= 0) {\r\n                item.expanded = expand;\r\n                expandedGroupIds.push(groupId);\r\n            }\r\n        });\r\n\r\n        const unrecognisedGroupIds = groupIds.filter((groupId) => !expandedGroupIds.includes(groupId));\r\n        if (unrecognisedGroupIds.length > 0) {\r\n            _warn(157, { unrecognisedGroupIds });\r\n        }\r\n    }\r\n\r\n    private getExpandState(): ExpandState {\r\n        let expandedCount = 0;\r\n        let notExpandedCount = 0;\r\n\r\n        this.forEachItem((item) => {\r\n            if (!item.group) {\r\n                return;\r\n            }\r\n            if (item.expanded) {\r\n                expandedCount++;\r\n            } else {\r\n                notExpandedCount++;\r\n            }\r\n        });\r\n\r\n        if (expandedCount > 0 && notExpandedCount > 0) {\r\n            return ExpandState.INDETERMINATE;\r\n        }\r\n\r\n        if (notExpandedCount > 0) {\r\n            return ExpandState.COLLAPSED;\r\n        }\r\n\r\n        return ExpandState.EXPANDED;\r\n    }\r\n\r\n    public doSetSelectedAll(selectAllChecked: boolean): void {\r\n        selectAllChildren(this.beans, this.allColsTree, selectAllChecked, this.eventType);\r\n    }\r\n\r\n    private getSelectionState(): boolean | undefined {\r\n        let checkedCount = 0;\r\n        let uncheckedCount = 0;\r\n\r\n        const pivotMode = this.colModel.isPivotMode();\r\n\r\n        this.forEachItem((item) => {\r\n            if (item.group) {\r\n                return;\r\n            }\r\n            if (!item.passesFilter) {\r\n                return;\r\n            }\r\n\r\n            const column = item.column;\r\n            const colDef = column.getColDef();\r\n\r\n            let checked: boolean;\r\n\r\n            if (pivotMode) {\r\n                const noPivotModeOptionsAllowed =\r\n                    !column.isAllowPivot() && !column.isAllowRowGroup() && !column.isAllowValue();\r\n                if (noPivotModeOptionsAllowed) {\r\n                    return;\r\n                }\r\n                checked = column.isValueActive() || column.isPivotActive() || column.isRowGroupActive();\r\n            } else {\r\n                if (colDef.lockVisible) {\r\n                    return;\r\n                }\r\n\r\n                checked = column.isVisible();\r\n            }\r\n\r\n            checked ? checkedCount++ : uncheckedCount++;\r\n        });\r\n\r\n        if (checkedCount > 0 && uncheckedCount > 0) {\r\n            return undefined;\r\n        }\r\n\r\n        return !(checkedCount === 0 || uncheckedCount > 0);\r\n    }\r\n\r\n    public setFilterText(filterText: string) {\r\n        this.filterText = _exists(filterText) ? filterText.toLowerCase() : null;\r\n        this.markFilteredColumns();\r\n        this.flattenAndFilterModel();\r\n    }\r\n\r\n    private markFilteredColumns(): void {\r\n        const passesFilter = (item: ColumnModelItem) => {\r\n            if (!_exists(this.filterText)) {\r\n                return true;\r\n            }\r\n\r\n            const displayName = item.displayName;\r\n\r\n            return displayName == null || displayName.toLowerCase().indexOf(this.filterText) !== -1;\r\n        };\r\n\r\n        const recursivelyCheckFilter = (item: ColumnModelItem, parentPasses: boolean): boolean => {\r\n            let atLeastOneChildPassed = false;\r\n            if (item.group) {\r\n                const groupPasses = passesFilter(item);\r\n                item.children.forEach((child) => {\r\n                    const childPasses = recursivelyCheckFilter(child, groupPasses || parentPasses);\r\n                    if (childPasses) {\r\n                        atLeastOneChildPassed = childPasses;\r\n                    }\r\n                });\r\n            }\r\n\r\n            const filterPasses = parentPasses || atLeastOneChildPassed ? true : passesFilter(item);\r\n            item.passesFilter = filterPasses;\r\n            return filterPasses;\r\n        };\r\n\r\n        this.allColsTree.forEach((item) => recursivelyCheckFilter(item, false));\r\n    }\r\n\r\n    private notifyListeners(): void {\r\n        this.fireGroupExpandedEvent();\r\n        this.fireSelectionChangedEvent();\r\n    }\r\n\r\n    private fireGroupExpandedEvent(): void {\r\n        const expandState = this.getExpandState();\r\n        this.dispatchLocalEvent({ type: 'groupExpanded', state: expandState });\r\n    }\r\n\r\n    private fireSelectionChangedEvent(): void {\r\n        if (!this.allColsTree) {\r\n            return;\r\n        }\r\n        const selectionState = this.getSelectionState();\r\n        this.dispatchLocalEvent({ type: 'selectionChanged', state: selectionState });\r\n    }\r\n\r\n    public getExpandedGroups(): string[] {\r\n        const expandedGroupIds: string[] = [];\r\n\r\n        if (!this.allColsTree) {\r\n            return expandedGroupIds;\r\n        }\r\n\r\n        this.forEachItem((item) => {\r\n            if (item.group && item.expanded) {\r\n                expandedGroupIds.push(item.columnGroup.getId());\r\n            }\r\n        });\r\n\r\n        return expandedGroupIds;\r\n    }\r\n}\r\n\r\nexport const AgPrimaryColsListSelector: ComponentSelector = {\r\n    selector: 'AG-PRIMARY-COLS-LIST',\r\n    component: AgPrimaryColsList,\r\n};\r\n", "import type { AbstractColDef, AgColumn, ColDef, ColumnModel } from 'ag-grid-community';\r\nimport { AgProvidedColumnGroup, _warn, isProvidedColumnGroup } from 'ag-grid-community';\r\n\r\nimport { isColGroupDef, mergeLeafPathTrees } from './sideBarUtils';\r\n\r\nexport function toolPanelCreateColumnTree(\r\n    colModel: ColumnModel,\r\n    colDefs: AbstractColDef[]\r\n): (AgColumn | AgProvidedColumnGroup)[] {\r\n    const invalidColIds: AbstractColDef[] = [];\r\n\r\n    const createDummyColGroup = (abstractColDef: AbstractColDef, depth: number): AgColumn | AgProvidedColumnGroup => {\r\n        if (isColGroupDef(abstractColDef)) {\r\n            // creating 'dummy' group which is not associated with grid column group\r\n            const groupDef = abstractColDef;\r\n            const groupId = typeof groupDef.groupId !== 'undefined' ? groupDef.groupId : groupDef.headerName;\r\n            const group = new AgProvidedColumnGroup(groupDef, groupId!, false, depth);\r\n            const children: (AgColumn | AgProvidedColumnGroup)[] = [];\r\n            groupDef.children.forEach((def) => {\r\n                const child = createDummyColGroup(def, depth + 1);\r\n                // check column exists in case invalid colDef is supplied for primary column\r\n                if (child) {\r\n                    children.push(child);\r\n                }\r\n            });\r\n            group.setChildren(children);\r\n\r\n            return group;\r\n        } else {\r\n            const colDef = abstractColDef as ColDef;\r\n            const key = colDef.colId ? colDef.colId : colDef.field;\r\n            const column = colModel.getColDefCol(key!)!;\r\n\r\n            if (!column) {\r\n                invalidColIds.push(colDef);\r\n            }\r\n\r\n            return column;\r\n        }\r\n    };\r\n\r\n    const mappedResults: (AgColumn | AgProvidedColumnGroup)[] = [];\r\n    colDefs.forEach((colDef) => {\r\n        const result = createDummyColGroup(colDef, 0);\r\n        if (result) {\r\n            // only return correctly mapped colDef results\r\n            mappedResults.push(result);\r\n        }\r\n    });\r\n\r\n    if (invalidColIds.length > 0) {\r\n        _warn(217, { invalidColIds });\r\n    }\r\n\r\n    return mappedResults;\r\n}\r\n\r\nexport function syncLayoutWithGrid(\r\n    colModel: ColumnModel,\r\n    syncLayoutCallback: (colDefs: AbstractColDef[]) => void\r\n): void {\r\n    // extract ordered list of leaf path trees (column group hierarchy for each individual leaf column)\r\n    const leafPathTrees: AbstractColDef[] = getLeafPathTrees(colModel);\r\n\r\n    // merge leaf path tree taking split column groups into account\r\n    const mergedColumnTrees = mergeLeafPathTrees(leafPathTrees);\r\n\r\n    // sync layout with merged column trees\r\n    syncLayoutCallback(mergedColumnTrees);\r\n}\r\n\r\nfunction getLeafPathTrees(colModel: ColumnModel): AbstractColDef[] {\r\n    // leaf tree paths are obtained by walking up the tree starting at a column until we reach the top level group.\r\n    const getLeafPathTree = (node: AgColumn | AgProvidedColumnGroup, childDef: AbstractColDef): AbstractColDef => {\r\n        let leafPathTree: AbstractColDef;\r\n\r\n        // build up tree in reverse order\r\n        if (isProvidedColumnGroup(node)) {\r\n            if (node.isPadding()) {\r\n                // skip over padding groups\r\n                leafPathTree = childDef;\r\n            } else {\r\n                const groupDef = Object.assign({}, node.getColGroupDef());\r\n                // ensure group contains groupId\r\n                groupDef.groupId = node.getGroupId();\r\n                groupDef.children = [childDef];\r\n                leafPathTree = groupDef;\r\n            }\r\n        } else {\r\n            const colDef = Object.assign({}, node.getColDef());\r\n            // ensure col contains colId\r\n            colDef.colId = node.getColId();\r\n            leafPathTree = colDef;\r\n        }\r\n\r\n        // walk tree\r\n        const parent = node.getOriginalParent();\r\n        if (parent) {\r\n            // keep walking up the tree until we reach the root\r\n            return getLeafPathTree(parent, leafPathTree);\r\n        } else {\r\n            // we have reached the root - exit with resulting leaf path tree\r\n            return leafPathTree;\r\n        }\r\n    };\r\n\r\n    // obtain a sorted list of all grid columns\r\n    const allGridColumns = colModel.getCols();\r\n\r\n    // only primary columns and non row group columns should appear in the tool panel\r\n    const allPrimaryGridColumns = allGridColumns.filter((column) => {\r\n        const colDef = column.getColDef();\r\n        return column.isPrimary() && !colDef.showRowGroup;\r\n    });\r\n\r\n    // construct a leaf path tree for each column\r\n    return allPrimaryGridColumns.map((col) => getLeafPathTree(col, col.getColDef()));\r\n}\r\n", "import type { AbstractColDef, ColDef, ColGroupDef } from 'ag-grid-community';\r\nimport { _last } from 'ag-grid-community';\r\n\r\nexport function isColGroupDef(colDef: AbstractColDef): colDef is ColGroupDef {\r\n    return !!colDef && typeof (colDef as ColGroupDef).children !== 'undefined';\r\n}\r\n\r\nfunction getId(colDef: AbstractColDef): string | undefined {\r\n    return isColGroupDef(colDef) ? colDef.groupId : (colDef as ColDef).colId;\r\n}\r\n\r\nfunction addChildrenToGroup(tree: AbstractColDef, groupId: string, colDef: AbstractColDef): boolean {\r\n    const subGroupIsSplit = (currentSubGroup: ColGroupDef, currentSubGroupToAdd: ColGroupDef) => {\r\n        const existingChildIds = currentSubGroup.children.map(getId);\r\n        const childGroupAlreadyExists = existingChildIds.includes(getId(currentSubGroupToAdd));\r\n        const lastChild = _last(currentSubGroup.children);\r\n        const lastChildIsDifferent = lastChild && getId(lastChild) !== getId(currentSubGroupToAdd);\r\n        return childGroupAlreadyExists && lastChildIsDifferent;\r\n    };\r\n\r\n    if (!isColGroupDef(tree)) {\r\n        return true;\r\n    }\r\n\r\n    const currentGroup = tree;\r\n    const groupToAdd = colDef as ColGroupDef;\r\n\r\n    if (subGroupIsSplit(currentGroup, groupToAdd)) {\r\n        currentGroup.children.push(groupToAdd);\r\n        return true;\r\n    }\r\n\r\n    if (currentGroup.groupId === groupId) {\r\n        // add children that don't already exist to group\r\n        const existingChildIds = currentGroup.children.map(getId);\r\n        const colDefAlreadyPresent = existingChildIds.includes(getId(groupToAdd));\r\n        if (!colDefAlreadyPresent) {\r\n            currentGroup.children.push(groupToAdd);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    // recurse until correct group is found to add children\r\n    for (let i = currentGroup.children.length - 1; i >= 0; i--) {\r\n        if (addChildrenToGroup(currentGroup.children[i], groupId, colDef)) {\r\n            break;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function mergeLeafPathTrees(leafPathTrees: AbstractColDef[]): AbstractColDef[] {\r\n    const matchingRootGroupIds = (pathA: AbstractColDef, pathB: AbstractColDef) => {\r\n        const bothPathsAreGroups = isColGroupDef(pathA) && isColGroupDef(pathB);\r\n        return bothPathsAreGroups && getId(pathA) === getId(pathB);\r\n    };\r\n\r\n    const mergeTrees = (treeA: AbstractColDef, treeB: AbstractColDef): AbstractColDef => {\r\n        if (!isColGroupDef(treeB)) {\r\n            return treeA;\r\n        }\r\n\r\n        const mergeResult = treeA;\r\n        const groupToMerge = treeB;\r\n\r\n        if (groupToMerge.children && groupToMerge.groupId) {\r\n            const added = addChildrenToGroup(mergeResult, groupToMerge.groupId, groupToMerge.children[0]);\r\n            if (added) {\r\n                return mergeResult;\r\n            }\r\n        }\r\n\r\n        groupToMerge.children.forEach((child) => mergeTrees(mergeResult, child));\r\n\r\n        return mergeResult;\r\n    };\r\n\r\n    // we can't just merge the leaf path trees as groups can be split apart - instead only merge if leaf\r\n    // path groups with the same root group id are contiguous.\r\n    const mergeColDefs: AbstractColDef[] = [];\r\n    for (let i = 1; i <= leafPathTrees.length; i++) {\r\n        const first = leafPathTrees[i - 1];\r\n        const second = leafPathTrees[i];\r\n\r\n        if (matchingRootGroupIds(first, second)) {\r\n            leafPathTrees[i] = mergeTrees(first, second);\r\n        } else {\r\n            mergeColDefs.push(first);\r\n        }\r\n    }\r\n\r\n    return mergeColDefs;\r\n}\r\n", "import type { AgColumn, AgProvidedColumnGroup, IEventEmitter, IEventListener } from 'ag-grid-community';\r\nimport { LocalEventService } from 'ag-grid-community';\r\n\r\nexport type ColumnModelItemEvent = 'expandedChanged';\r\nexport class ColumnModelItem implements IEventEmitter<ColumnModelItemEvent> {\r\n    private localEventService: LocalEventService<ColumnModelItemEvent> = new LocalEventService();\r\n\r\n    public readonly columnGroup: AgProvidedColumnGroup;\r\n    public readonly column: AgColumn;\r\n    public readonly children: ColumnModelItem[];\r\n\r\n    private _expanded: boolean | undefined;\r\n    public passesFilter: boolean;\r\n\r\n    constructor(\r\n        public readonly displayName: string | null,\r\n        columnOrGroup: AgColumn | AgProvidedColumnGroup,\r\n        public readonly depth: number,\r\n        public readonly group = false,\r\n        expanded?: boolean\r\n    ) {\r\n        if (group) {\r\n            this.columnGroup = columnOrGroup as AgProvidedColumnGroup;\r\n            this._expanded = expanded;\r\n            this.children = [];\r\n        } else {\r\n            this.column = columnOrGroup as AgColumn;\r\n        }\r\n    }\r\n\r\n    public get expanded(): boolean {\r\n        return !!this._expanded;\r\n    }\r\n\r\n    public set expanded(expanded: boolean) {\r\n        if (expanded === this._expanded) {\r\n            return;\r\n        }\r\n        this._expanded = expanded;\r\n        this.localEventService.dispatchEvent({ type: 'expandedChanged' });\r\n    }\r\n\r\n    public addEventListener<T extends ColumnModelItemEvent>(\r\n        eventType: T,\r\n        listener: IEventListener<ColumnModelItemEvent>\r\n    ): void {\r\n        this.localEventService.addEventListener(eventType, listener);\r\n    }\r\n\r\n    public removeEventListener<T extends ColumnModelItemEvent>(\r\n        eventType: T,\r\n        listener: IEventListener<ColumnModelItemEvent>\r\n    ): void {\r\n        this.localEventService.removeEventListener(eventType, listener);\r\n    }\r\n}\r\n", "import type { AgColumn, BeanCollection, ColumnEventType, ColumnState, IAggFunc } from 'ag-grid-community';\r\nimport { _applyColumnState } from 'ag-grid-community';\r\n\r\nimport type { ColumnModelItem } from './columnModelItem';\r\n\r\nexport function selectAllChildren(\r\n    beans: BeanCollection,\r\n    colTree: ColumnModelItem[],\r\n    selectAllChecked: boolean,\r\n    eventType: ColumnEventType\r\n): void {\r\n    const cols = extractAllLeafColumns(colTree);\r\n    setAllColumns(beans, cols, selectAllChecked, eventType);\r\n}\r\n\r\nexport function setAllColumns(\r\n    beans: BeanCollection,\r\n    cols: AgColumn[],\r\n    selectAllChecked: boolean,\r\n    eventType: ColumnEventType\r\n): void {\r\n    if (beans.colModel.isPivotMode()) {\r\n        setAllPivot(beans, cols, selectAllChecked, eventType);\r\n    } else {\r\n        setAllVisible(beans, cols, selectAllChecked, eventType);\r\n    }\r\n}\r\n\r\nfunction extractAllLeafColumns(allItems: ColumnModelItem[]): AgColumn[] {\r\n    const res: AgColumn[] = [];\r\n\r\n    const recursiveFunc = (items: ColumnModelItem[]) => {\r\n        items.forEach((item) => {\r\n            if (!item.passesFilter) {\r\n                return;\r\n            }\r\n            if (item.group) {\r\n                recursiveFunc(item.children);\r\n            } else {\r\n                res.push(item.column);\r\n            }\r\n        });\r\n    };\r\n\r\n    recursiveFunc(allItems);\r\n\r\n    return res;\r\n}\r\n\r\nfunction setAllVisible(beans: BeanCollection, columns: AgColumn[], visible: boolean, eventType: ColumnEventType): void {\r\n    const colStateItems: ColumnState[] = [];\r\n\r\n    columns.forEach((col) => {\r\n        if (col.getColDef().lockVisible) {\r\n            return;\r\n        }\r\n        if (col.isVisible() != visible) {\r\n            colStateItems.push({\r\n                colId: col.getId(),\r\n                hide: !visible,\r\n            });\r\n        }\r\n    });\r\n\r\n    if (colStateItems.length > 0) {\r\n        _applyColumnState(beans, { state: colStateItems }, eventType);\r\n    }\r\n\r\n    beans.selectionColSvc?.refreshVisibility(eventType);\r\n}\r\n\r\nfunction setAllPivot(beans: BeanCollection, columns: AgColumn[], value: boolean, eventType: ColumnEventType): void {\r\n    setAllPivotActive(beans, columns, value, eventType);\r\n}\r\n\r\nfunction setAllPivotActive(\r\n    beans: BeanCollection,\r\n    columns: AgColumn[],\r\n    value: boolean,\r\n    eventType: ColumnEventType\r\n): void {\r\n    const colStateItems: ColumnState[] = [];\r\n\r\n    const turnOnAction = (col: AgColumn) => {\r\n        // don't change any column that's already got a function active\r\n        if (col.isAnyFunctionActive()) {\r\n            return;\r\n        }\r\n\r\n        if (col.isAllowValue()) {\r\n            const aggFunc =\r\n                typeof col.getAggFunc() === 'string' ? col.getAggFunc() : beans.aggFuncSvc?.getDefaultAggFunc(col);\r\n            colStateItems.push({\r\n                colId: col.getId(),\r\n                aggFunc: aggFunc,\r\n            });\r\n        } else if (col.isAllowRowGroup()) {\r\n            colStateItems.push({\r\n                colId: col.getId(),\r\n                rowGroup: true,\r\n            });\r\n        } else if (col.isAllowPivot()) {\r\n            colStateItems.push({\r\n                colId: col.getId(),\r\n                pivot: true,\r\n            });\r\n        }\r\n    };\r\n\r\n    const turnOffAction = (col: AgColumn) => {\r\n        const isActive = col.isPivotActive() || col.isRowGroupActive() || col.isValueActive();\r\n        if (isActive) {\r\n            colStateItems.push({\r\n                colId: col.getId(),\r\n                pivot: false,\r\n                rowGroup: false,\r\n                aggFunc: null,\r\n            });\r\n        }\r\n    };\r\n\r\n    const action = value ? turnOnAction : turnOffAction;\r\n\r\n    columns.forEach(action);\r\n\r\n    if (colStateItems.length > 0) {\r\n        _applyColumnState(beans, { state: colStateItems }, eventType);\r\n    }\r\n}\r\n\r\nexport function updateColumns(\r\n    beans: BeanCollection,\r\n    params: {\r\n        columns: AgColumn[];\r\n        visibleState?: { [key: string]: boolean };\r\n        pivotState?: {\r\n            [key: string]: {\r\n                pivot?: boolean;\r\n                rowGroup?: boolean;\r\n                aggFunc?: string | IAggFunc | null;\r\n            };\r\n        };\r\n        eventType: ColumnEventType;\r\n    }\r\n): void {\r\n    const { columns, visibleState, pivotState, eventType } = params;\r\n    const state: ColumnState[] = columns.map((column) => {\r\n        const colId = column.getColId();\r\n        if (beans.colModel.isPivotMode()) {\r\n            const pivotStateForColumn = pivotState?.[colId];\r\n            return {\r\n                colId,\r\n                pivot: pivotStateForColumn?.pivot,\r\n                rowGroup: pivotStateForColumn?.rowGroup,\r\n                aggFunc: pivotStateForColumn?.aggFunc,\r\n            };\r\n        } else {\r\n            return {\r\n                colId,\r\n                hide: !visibleState?.[colId],\r\n            };\r\n        }\r\n    });\r\n    _applyColumnState(beans, { state }, eventType);\r\n}\r\n\r\nexport function createPivotState(column: AgColumn): {\r\n    pivot?: boolean;\r\n    rowGroup?: boolean;\r\n    aggFunc?: string | IAggFunc | null;\r\n} {\r\n    return {\r\n        pivot: column.isPivotActive(),\r\n        rowGroup: column.isRowGroupActive(),\r\n        aggFunc: column.isValueActive() ? column.getAggFunc() : undefined,\r\n    };\r\n}\r\n", "import type { AgColumn, AgProvidedColumnGroup, ColumnPanelItemDragStartEvent } from 'ag-grid-community';\r\nimport { BeanStub, DragSourceType, isProvidedColumnGroup } from 'ag-grid-community';\r\n\r\nimport type { VirtualListDragItem } from '../features/iVirtualListDragFeature';\r\nimport { VirtualListDragFeature } from '../features/virtualListDragFeature';\r\nimport type { VirtualList } from '../widgets/virtualList';\r\nimport type { AgPrimaryColsList } from './agPrimaryColsList';\r\nimport type { ToolPanelColumnComp } from './toolPanelColumnComp';\r\nimport { ToolPanelColumnGroupComp } from './toolPanelColumnGroupComp';\r\n\r\nexport class PrimaryColsListPanelItemDragFeature extends BeanStub {\r\n    constructor(\r\n        private readonly comp: AgPrimaryColsList,\r\n        private readonly virtualList: VirtualList\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.createManagedBean(\r\n            new VirtualListDragFeature<\r\n                AgPrimaryColsList,\r\n                ToolPanelColumnGroupComp | ToolPanelColumnComp,\r\n                AgColumn | AgProvidedColumnGroup,\r\n                ColumnPanelItemDragStartEvent\r\n            >(this.comp, this.virtualList, {\r\n                dragSourceType: DragSourceType.ToolPanel,\r\n                listItemDragStartEvent: 'columnPanelItemDragStart',\r\n                listItemDragEndEvent: 'columnPanelItemDragEnd',\r\n                eventSource: this.eventSvc,\r\n                getCurrentDragValue: (listItemDragStartEvent: ColumnPanelItemDragStartEvent) =>\r\n                    this.getCurrentDragValue(listItemDragStartEvent),\r\n                isMoveBlocked: (currentDragValue: AgColumn | AgProvidedColumnGroup | null) =>\r\n                    this.isMoveBlocked(currentDragValue),\r\n                getNumRows: (comp: AgPrimaryColsList) => comp.getDisplayedColsList().length,\r\n                moveItem: (\r\n                    currentDragValue: AgColumn | AgProvidedColumnGroup | null,\r\n                    lastHoveredListItem: VirtualListDragItem<ToolPanelColumnGroupComp | ToolPanelColumnComp> | null\r\n                ) => this.moveItem(this.getCurrentColumnsBeingMoved(currentDragValue), lastHoveredListItem),\r\n            })\r\n        );\r\n    }\r\n\r\n    private getCurrentDragValue(\r\n        listItemDragStartEvent: ColumnPanelItemDragStartEvent\r\n    ): AgColumn | AgProvidedColumnGroup {\r\n        return listItemDragStartEvent.column as AgColumn | AgProvidedColumnGroup;\r\n    }\r\n\r\n    private getCurrentColumnsBeingMoved(column: AgColumn | AgProvidedColumnGroup | null): AgColumn[] {\r\n        if (isProvidedColumnGroup(column)) {\r\n            return column.getLeafColumns();\r\n        }\r\n        return column ? [column] : [];\r\n    }\r\n\r\n    private isMoveBlocked(currentDragValue: AgColumn | AgProvidedColumnGroup | null): boolean {\r\n        const preventMoving = this.gos.get('suppressMovableColumns');\r\n        if (preventMoving) {\r\n            return true;\r\n        }\r\n\r\n        const currentColumns = this.getCurrentColumnsBeingMoved(currentDragValue);\r\n        const hasNotMovable = currentColumns.find((col) => {\r\n            const colDef = col.getColDef();\r\n            return !!colDef.suppressMovable || !!colDef.lockPosition;\r\n        });\r\n\r\n        return !!hasNotMovable;\r\n    }\r\n\r\n    private moveItem(\r\n        currentColumns: AgColumn[],\r\n        lastHoveredListItem: VirtualListDragItem<ToolPanelColumnGroupComp | ToolPanelColumnComp> | null\r\n    ): void {\r\n        if (!lastHoveredListItem) {\r\n            return;\r\n        }\r\n\r\n        const { component } = lastHoveredListItem;\r\n\r\n        let lastHoveredColumn: AgColumn | null = null;\r\n        let isBefore = lastHoveredListItem.position === 'top';\r\n\r\n        if (component instanceof ToolPanelColumnGroupComp) {\r\n            const columns = component.getColumns();\r\n            lastHoveredColumn = columns[0];\r\n            isBefore = true;\r\n        } else if (component) {\r\n            lastHoveredColumn = component.column;\r\n        }\r\n\r\n        if (!lastHoveredColumn) {\r\n            return;\r\n        }\r\n\r\n        const targetIndex: number | null = this.getMoveTargetIndex({\r\n            currentColumns,\r\n            lastHoveredColumn,\r\n            isBefore,\r\n        });\r\n\r\n        if (targetIndex != null) {\r\n            this.beans.colMoves?.moveColumns(currentColumns, targetIndex, 'toolPanelUi');\r\n        }\r\n    }\r\n\r\n    private getMoveTargetIndex(params: {\r\n        currentColumns: AgColumn[] | null;\r\n        lastHoveredColumn: AgColumn;\r\n        isBefore: boolean;\r\n    }): number | null {\r\n        const { currentColumns, lastHoveredColumn, isBefore } = params;\r\n        if (!lastHoveredColumn || !currentColumns) {\r\n            return null;\r\n        }\r\n\r\n        const allColumns = this.beans.colModel.getCols();\r\n        const targetColumnIndex = allColumns.indexOf(lastHoveredColumn);\r\n        const adjustedTarget = isBefore ? targetColumnIndex : targetColumnIndex + 1;\r\n        const diff = this.getMoveDiff(allColumns, currentColumns, adjustedTarget);\r\n\r\n        return adjustedTarget - diff;\r\n    }\r\n\r\n    private getMoveDiff(allColumns: AgColumn[], currentColumns: AgColumn[] | null, end: number): number {\r\n        if (!currentColumns) {\r\n            return 0;\r\n        }\r\n\r\n        const targetColumn = currentColumns[0];\r\n        const span = currentColumns.length;\r\n\r\n        const currentIndex = allColumns.indexOf(targetColumn);\r\n\r\n        if (currentIndex < end) {\r\n            return span;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n}\r\n", "import type {\r\n    AgCheckbox,\r\n    AgColumn,\r\n    AgProvidedColumnGroup,\r\n    ColumnEventType,\r\n    DragItem,\r\n    DragSource,\r\n    IAggFunc,\r\n    ITooltipCtrl,\r\n    TooltipFeature,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgCheckboxSelector,\r\n    Component,\r\n    DragSourceType,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    TouchListener,\r\n    _createIcon,\r\n    _createIconNoSpan,\r\n    _getShouldDisplayTooltip,\r\n    _getToolPanelClassesFromColDef,\r\n    _setAriaDescribedBy,\r\n    _setAriaExpanded,\r\n    _setAriaLabel,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport type { ColumnModelItem } from './columnModelItem';\r\nimport { createPivotState, selectAllChildren, updateColumns } from './modelItemUtils';\r\nimport { ToolPanelContextMenu } from './toolPanelContextMenu';\r\n\r\nexport class ToolPanelColumnGroupComp extends Component {\r\n    private readonly cbSelect: AgCheckbox = RefPlaceholder;\r\n    private readonly eLabel: HTMLElement = RefPlaceholder;\r\n\r\n    private readonly eGroupOpenedIcon: Element = RefPlaceholder;\r\n    private readonly eGroupClosedIcon: Element = RefPlaceholder;\r\n    private readonly eColumnGroupIcons: Element = RefPlaceholder;\r\n\r\n    private eDragHandle: Element;\r\n\r\n    private readonly columnGroup: AgProvidedColumnGroup;\r\n    private readonly columnDepth: number;\r\n\r\n    private readonly displayName: string | null;\r\n    private processingColumnStateChange = false;\r\n    private tooltipFeature?: TooltipFeature;\r\n\r\n    constructor(\r\n        private readonly modelItem: ColumnModelItem,\r\n        private readonly allowDragging: boolean,\r\n        private readonly eventType: ColumnEventType,\r\n        private readonly focusWrapper: HTMLElement\r\n    ) {\r\n        super();\r\n        const { columnGroup, depth, displayName } = modelItem;\r\n        this.columnGroup = columnGroup;\r\n        this.columnDepth = depth;\r\n        this.displayName = displayName;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.setTemplate(\r\n            /* html */\r\n            `<div class=\"ag-column-select-column-group\">\r\n                <span class=\"ag-column-group-icons\" data-ref=\"eColumnGroupIcons\" >\r\n                    <span class=\"ag-column-group-closed-icon\" data-ref=\"eGroupClosedIcon\"></span>\r\n                    <span class=\"ag-column-group-opened-icon\" data-ref=\"eGroupOpenedIcon\"></span>\r\n                </span>\r\n                <ag-checkbox data-ref=\"cbSelect\" class=\"ag-column-select-checkbox\"></ag-checkbox>\r\n                <span class=\"ag-column-select-column-label\" data-ref=\"eLabel\"></span>\r\n            </div>`,\r\n            [AgCheckboxSelector]\r\n        );\r\n\r\n        const {\r\n            beans,\r\n            cbSelect,\r\n            eLabel,\r\n            displayName,\r\n            columnDepth: columnDept,\r\n            modelItem,\r\n            focusWrapper,\r\n            columnGroup,\r\n        } = this;\r\n        const { registry, gos } = beans;\r\n\r\n        const eDragHandle = _createIconNoSpan('columnDrag', beans)!;\r\n        this.eDragHandle = eDragHandle;\r\n        eDragHandle.classList.add('ag-drag-handle', 'ag-column-select-column-group-drag-handle');\r\n\r\n        const checkboxGui = cbSelect.getGui();\r\n        const checkboxInput = cbSelect.getInputElement();\r\n\r\n        checkboxGui.insertAdjacentElement('afterend', eDragHandle);\r\n        checkboxInput.setAttribute('tabindex', '-1');\r\n\r\n        eLabel.innerHTML = displayName ?? '';\r\n        this.setupExpandContract();\r\n\r\n        this.addCssClass('ag-column-select-indent-' + columnDept);\r\n        this.getGui().style.setProperty('--ag-indentation-level', String(columnDept));\r\n\r\n        this.tooltipFeature = this.createOptionalManagedBean(\r\n            registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.getGui(),\r\n                getLocation: () => 'columnToolPanelColumnGroup',\r\n                shouldDisplayTooltip: _getShouldDisplayTooltip(gos, () => eLabel),\r\n            } as ITooltipCtrl)\r\n        );\r\n\r\n        this.addManagedEventListeners({ columnPivotModeChanged: this.onColumnStateChanged.bind(this) });\r\n\r\n        this.addManagedElementListeners(eLabel, { click: this.onLabelClicked.bind(this) });\r\n        this.addManagedListeners(cbSelect, { fieldValueChanged: this.onCheckboxChanged.bind(this) });\r\n        this.addManagedListeners(modelItem, { expandedChanged: this.onExpandChanged.bind(this) });\r\n        this.addManagedListeners(focusWrapper, {\r\n            keydown: this.handleKeyDown.bind(this),\r\n            contextmenu: this.onContextMenu.bind(this),\r\n        });\r\n\r\n        this.setOpenClosedIcons();\r\n        this.setupDragging();\r\n        this.onColumnStateChanged();\r\n        this.addVisibilityListenersToAllChildren();\r\n        this.refreshAriaExpanded();\r\n        this.refreshAriaLabel();\r\n        this.setupTooltip();\r\n\r\n        const classes = _getToolPanelClassesFromColDef(columnGroup.getColGroupDef(), gos, null, columnGroup);\r\n        classes.forEach((c) => this.addOrRemoveCssClass(c, true));\r\n    }\r\n\r\n    public getColumns(): AgColumn[] {\r\n        return this.columnGroup.getLeafColumns();\r\n    }\r\n\r\n    private setupTooltip(): void {\r\n        const colGroupDef = this.columnGroup.getColGroupDef();\r\n\r\n        if (!colGroupDef) {\r\n            return;\r\n        }\r\n\r\n        const refresh = () => this.tooltipFeature?.setTooltipAndRefresh(colGroupDef.headerTooltip);\r\n\r\n        refresh();\r\n\r\n        this.addManagedEventListeners({ newColumnsLoaded: refresh });\r\n    }\r\n\r\n    private handleKeyDown(e: KeyboardEvent): void {\r\n        switch (e.key) {\r\n            case KeyCode.LEFT:\r\n                e.preventDefault();\r\n                this.modelItem.expanded = false;\r\n                break;\r\n            case KeyCode.RIGHT:\r\n                e.preventDefault();\r\n                this.modelItem.expanded = true;\r\n                break;\r\n            case KeyCode.SPACE:\r\n                e.preventDefault();\r\n                if (this.isSelectable()) {\r\n                    this.onSelectAllChanged(!this.isSelected());\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    private onContextMenu(e: MouseEvent): void {\r\n        const { columnGroup, gos } = this;\r\n\r\n        if (gos.get('functionsReadOnly')) {\r\n            return;\r\n        }\r\n\r\n        const contextMenu = this.createBean(new ToolPanelContextMenu(columnGroup, e, this.focusWrapper));\r\n        this.addDestroyFunc(() => {\r\n            if (contextMenu.isAlive()) {\r\n                this.destroyBean(contextMenu);\r\n            }\r\n        });\r\n    }\r\n\r\n    private addVisibilityListenersToAllChildren(): void {\r\n        const listener = this.onColumnStateChanged.bind(this);\r\n        this.columnGroup.getLeafColumns().forEach((column) => {\r\n            this.addManagedListeners(column, {\r\n                visibleChanged: listener,\r\n                columnValueChanged: listener,\r\n                columnPivotChanged: listener,\r\n                columnRowGroupChanged: listener,\r\n            });\r\n        });\r\n    }\r\n\r\n    private setupDragging(): void {\r\n        if (!this.allowDragging) {\r\n            _setDisplayed(this.eDragHandle, false);\r\n            return;\r\n        }\r\n\r\n        const beans = this.beans;\r\n        const { gos, eventSvc, dragAndDrop } = beans;\r\n\r\n        let hideColumnOnExit = !gos.get('suppressDragLeaveHidesColumns');\r\n        const dragSource: DragSource = {\r\n            type: DragSourceType.ToolPanel,\r\n            eElement: this.eDragHandle,\r\n            dragItemName: this.displayName,\r\n            getDefaultIconName: () => (hideColumnOnExit ? 'hide' : 'notAllowed'),\r\n            getDragItem: () => this.createDragItem(),\r\n            onDragStarted: () => {\r\n                hideColumnOnExit = !gos.get('suppressDragLeaveHidesColumns');\r\n                eventSvc.dispatchEvent({\r\n                    type: 'columnPanelItemDragStart',\r\n                    column: this.columnGroup,\r\n                });\r\n            },\r\n            onDragStopped: () => {\r\n                eventSvc.dispatchEvent({\r\n                    type: 'columnPanelItemDragEnd',\r\n                });\r\n            },\r\n            onGridEnter: (dragItem: DragItem | null) => {\r\n                if (hideColumnOnExit) {\r\n                    // when dragged into the grid, restore the state that was active pre-drag\r\n                    updateColumns(beans, {\r\n                        columns: this.columnGroup.getLeafColumns(),\r\n                        visibleState: dragItem?.visibleState,\r\n                        pivotState: dragItem?.pivotState,\r\n                        eventType: this.eventType,\r\n                    });\r\n                }\r\n            },\r\n            onGridExit: () => {\r\n                if (hideColumnOnExit) {\r\n                    // when dragged outside of the grid, mimic what happens when checkbox is disabled\r\n                    // this handles the behaviour for pivot which is different to just hiding a column.\r\n                    this.onChangeCommon(false);\r\n                }\r\n            },\r\n        };\r\n\r\n        dragAndDrop!.addDragSource(dragSource, true);\r\n        this.addDestroyFunc(() => dragAndDrop!.removeDragSource(dragSource));\r\n    }\r\n\r\n    private createDragItem() {\r\n        const columns = this.columnGroup.getLeafColumns();\r\n        const visibleState: { [key: string]: boolean } = {};\r\n        const pivotState: {\r\n            [key: string]: {\r\n                pivot?: boolean;\r\n                rowGroup?: boolean;\r\n                aggFunc?: string | IAggFunc | null;\r\n            };\r\n        } = {};\r\n        columns.forEach((col) => {\r\n            const colId = col.getId();\r\n            visibleState[colId] = col.isVisible();\r\n            pivotState[colId] = createPivotState(col);\r\n        });\r\n\r\n        return {\r\n            columns,\r\n            visibleState,\r\n            pivotState,\r\n        };\r\n    }\r\n\r\n    private setupExpandContract(): void {\r\n        const { beans, eGroupClosedIcon, eGroupOpenedIcon, eColumnGroupIcons } = this;\r\n        eGroupClosedIcon.appendChild(_createIcon('columnSelectClosed', beans, null));\r\n        eGroupOpenedIcon.appendChild(_createIcon('columnSelectOpen', beans, null));\r\n\r\n        const listener = this.onExpandOrContractClicked.bind(this);\r\n        this.addManagedElementListeners(eGroupClosedIcon, { click: listener });\r\n        this.addManagedElementListeners(eGroupOpenedIcon, { click: listener });\r\n\r\n        const touchListener = new TouchListener(eColumnGroupIcons, true);\r\n        this.addManagedListeners(touchListener, { tap: listener });\r\n        this.addDestroyFunc(touchListener.destroy.bind(touchListener));\r\n    }\r\n\r\n    private onLabelClicked(): void {\r\n        const nextState = !this.cbSelect.getValue();\r\n        this.onChangeCommon(nextState);\r\n    }\r\n\r\n    private onCheckboxChanged(event: any): void {\r\n        this.onChangeCommon(event.selected);\r\n    }\r\n\r\n    private getVisibleLeafColumns(): AgColumn[] {\r\n        const childColumns: AgColumn[] = [];\r\n\r\n        const extractCols = (children: ColumnModelItem[]) => {\r\n            children.forEach((child) => {\r\n                if (!child.passesFilter) {\r\n                    return;\r\n                }\r\n                if (child.group) {\r\n                    extractCols(child.children);\r\n                } else {\r\n                    childColumns.push(child.column);\r\n                }\r\n            });\r\n        };\r\n\r\n        extractCols(this.modelItem.children);\r\n\r\n        return childColumns;\r\n    }\r\n\r\n    private onChangeCommon(nextState: boolean): void {\r\n        this.refreshAriaLabel();\r\n\r\n        if (this.processingColumnStateChange) {\r\n            return;\r\n        }\r\n\r\n        selectAllChildren(this.beans, this.modelItem.children, nextState, this.eventType);\r\n    }\r\n\r\n    private refreshAriaLabel(): void {\r\n        const { cbSelect, focusWrapper, displayName } = this;\r\n        const translate = this.getLocaleTextFunc();\r\n        const columnLabel = translate('ariaColumnGroup', 'Column Group');\r\n        const checkboxValue = cbSelect.getValue();\r\n        const state =\r\n            checkboxValue === undefined\r\n                ? translate('ariaIndeterminate', 'indeterminate')\r\n                : checkboxValue\r\n                  ? translate('ariaVisible', 'visible')\r\n                  : translate('ariaHidden', 'hidden');\r\n        const visibilityLabel = translate('ariaToggleVisibility', 'Press SPACE to toggle visibility');\r\n\r\n        _setAriaLabel(focusWrapper, `${displayName} ${columnLabel}`);\r\n        cbSelect.setInputAriaLabel(`${visibilityLabel} (${state})`);\r\n        _setAriaDescribedBy(focusWrapper, cbSelect.getInputElement().id);\r\n    }\r\n\r\n    public onColumnStateChanged(): void {\r\n        const selectedValue = this.workOutSelectedValue();\r\n        const readOnlyValue = this.workOutReadOnlyValue();\r\n        this.processingColumnStateChange = true;\r\n        const cbSelect = this.cbSelect;\r\n        cbSelect.setValue(selectedValue);\r\n        cbSelect.setReadOnly(readOnlyValue);\r\n        this.addOrRemoveCssClass('ag-column-select-column-group-readonly', readOnlyValue);\r\n        this.processingColumnStateChange = false;\r\n    }\r\n\r\n    private workOutSelectedValue(): boolean | undefined {\r\n        const pivotMode = this.beans.colModel.isPivotMode();\r\n\r\n        const visibleLeafColumns = this.getVisibleLeafColumns();\r\n\r\n        let checkedCount = 0;\r\n        let uncheckedCount = 0;\r\n\r\n        visibleLeafColumns.forEach((column) => {\r\n            if (!pivotMode && column.getColDef().lockVisible) {\r\n                return;\r\n            }\r\n\r\n            if (this.isColumnChecked(column, pivotMode)) {\r\n                checkedCount++;\r\n            } else {\r\n                uncheckedCount++;\r\n            }\r\n        });\r\n\r\n        if (checkedCount > 0 && uncheckedCount > 0) {\r\n            return undefined;\r\n        }\r\n\r\n        return checkedCount > 0;\r\n    }\r\n\r\n    private workOutReadOnlyValue(): boolean {\r\n        const pivotMode = this.beans.colModel.isPivotMode();\r\n\r\n        let colsThatCanAction = 0;\r\n\r\n        this.columnGroup.getLeafColumns().forEach((col) => {\r\n            if (pivotMode) {\r\n                if (col.isAnyFunctionAllowed()) {\r\n                    colsThatCanAction++;\r\n                }\r\n            } else {\r\n                if (!col.getColDef().lockVisible) {\r\n                    colsThatCanAction++;\r\n                }\r\n            }\r\n        });\r\n\r\n        return colsThatCanAction === 0;\r\n    }\r\n\r\n    private isColumnChecked(column: AgColumn, pivotMode: boolean): boolean {\r\n        if (pivotMode) {\r\n            const pivoted = column.isPivotActive();\r\n            const grouped = column.isRowGroupActive();\r\n            const aggregated = column.isValueActive();\r\n            return pivoted || grouped || aggregated;\r\n        }\r\n\r\n        return column.isVisible();\r\n    }\r\n\r\n    private onExpandOrContractClicked(): void {\r\n        const modelItem = this.modelItem;\r\n        const oldState = modelItem.expanded;\r\n        modelItem.expanded = !oldState;\r\n    }\r\n\r\n    private onExpandChanged() {\r\n        this.setOpenClosedIcons();\r\n        this.refreshAriaExpanded();\r\n    }\r\n\r\n    private setOpenClosedIcons(): void {\r\n        const folderOpen = this.modelItem.expanded;\r\n        _setDisplayed(this.eGroupClosedIcon, !folderOpen);\r\n        _setDisplayed(this.eGroupOpenedIcon, folderOpen);\r\n    }\r\n\r\n    private refreshAriaExpanded(): void {\r\n        _setAriaExpanded(this.focusWrapper, this.modelItem.expanded);\r\n    }\r\n\r\n    public getDisplayName(): string | null {\r\n        return this.displayName;\r\n    }\r\n\r\n    public onSelectAllChanged(value: boolean): void {\r\n        const cbSelect = this.cbSelect;\r\n        const cbValue = cbSelect.getValue();\r\n        const readOnly = cbSelect.isReadOnly();\r\n\r\n        if (!readOnly && ((value && !cbValue) || (!value && cbValue))) {\r\n            cbSelect.toggle();\r\n        }\r\n    }\r\n\r\n    public isSelected(): boolean | undefined {\r\n        return this.cbSelect.getValue();\r\n    }\r\n\r\n    public isSelectable(): boolean {\r\n        return !this.cbSelect.isReadOnly();\r\n    }\r\n\r\n    public setSelected(selected: boolean) {\r\n        this.cbSelect.setValue(selected, true);\r\n    }\r\n}\r\n", "import type { AgColumn, AgProvidedColumnGroup, IconName, MenuItemDef } from 'ag-grid-community';\r\nimport { Component, _createIconNoSpan, _focusInto, isColumn, isProvidedColumnGroup } from 'ag-grid-community';\r\n\r\nimport { isRowGroupColLocked } from '../rowGrouping/rowGroupingUtils';\r\nimport { AgMenuList } from '../widgets/agMenuList';\r\n\r\ntype MenuItemName = 'rowGroup' | 'value' | 'pivot';\r\n\r\ntype MenuItemProperty = {\r\n    allowedFunction: (col: AgColumn) => boolean;\r\n    activeFunction: (col: AgColumn) => boolean;\r\n    activateLabel: (name: string) => string;\r\n    deactivateLabel: (name: string) => string;\r\n    activateFunction: () => void;\r\n    deActivateFunction: () => void;\r\n    addIcon: IconName;\r\n    removeIcon: IconName;\r\n};\r\n\r\nexport class ToolPanelContextMenu extends Component {\r\n    private columns: AgColumn[];\r\n    private allowGrouping: boolean;\r\n    private allowValues: boolean;\r\n    private allowPivoting: boolean;\r\n    private menuItemMap: Map<MenuItemName, MenuItemProperty>;\r\n    private displayName: string | null = null;\r\n\r\n    constructor(\r\n        private readonly column: AgColumn | AgProvidedColumnGroup,\r\n        private readonly mouseEvent: MouseEvent,\r\n        private readonly parentEl: HTMLElement\r\n    ) {\r\n        super(/* html */ `<div class=\"ag-menu\"></div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const {\r\n            column,\r\n            beans: { colNames },\r\n        } = this;\r\n        this.initializeProperties(column);\r\n\r\n        let displayName: string | null;\r\n        if (isColumn(column)) {\r\n            displayName = colNames.getDisplayNameForColumn(column, 'columnToolPanel');\r\n        } else {\r\n            displayName = colNames.getDisplayNameForProvidedColumnGroup(null, column, 'columnToolPanel');\r\n        }\r\n        this.displayName = displayName;\r\n\r\n        this.buildMenuItemMap();\r\n\r\n        if (this.isActive()) {\r\n            this.mouseEvent.preventDefault();\r\n            const menuItemsMapped: MenuItemDef[] = this.getMappedMenuItems();\r\n            if (menuItemsMapped.length === 0) {\r\n                return;\r\n            }\r\n\r\n            this.displayContextMenu(menuItemsMapped);\r\n        }\r\n    }\r\n\r\n    private initializeProperties(column: AgColumn | AgProvidedColumnGroup): void {\r\n        let columns: AgColumn[];\r\n        if (isProvidedColumnGroup(column)) {\r\n            columns = column.getLeafColumns();\r\n        } else {\r\n            columns = [column];\r\n        }\r\n        this.columns = columns;\r\n\r\n        this.allowGrouping = columns.some((col) => col.isPrimary() && col.isAllowRowGroup());\r\n        this.allowValues = columns.some((col) => col.isPrimary() && col.isAllowValue());\r\n        this.allowPivoting =\r\n            this.beans.colModel.isPivotMode() && columns.some((col) => col.isPrimary() && col.isAllowPivot());\r\n    }\r\n\r\n    private buildMenuItemMap(): void {\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const { beans, displayName } = this;\r\n        const { rowGroupColsSvc, valueColsSvc, pivotColsSvc, colModel } = beans;\r\n\r\n        const menuItemMap = new Map<MenuItemName, MenuItemProperty>();\r\n        this.menuItemMap = menuItemMap;\r\n        menuItemMap.set('rowGroup', {\r\n            allowedFunction: (col) => col.isPrimary() && col.isAllowRowGroup() && !isRowGroupColLocked(col, beans),\r\n            activeFunction: (col) => col.isRowGroupActive(),\r\n            activateLabel: () => `${localeTextFunc('groupBy', 'Group by')} ${displayName}`,\r\n            deactivateLabel: () => `${localeTextFunc('ungroupBy', 'Un-Group by')} ${displayName}`,\r\n            activateFunction: () =>\r\n                rowGroupColsSvc?.setColumns(this.addColumnsToList(rowGroupColsSvc.columns), 'toolPanelUi'),\r\n            deActivateFunction: () =>\r\n                rowGroupColsSvc?.setColumns(this.removeColumnsFromList(rowGroupColsSvc.columns), 'toolPanelUi'),\r\n            addIcon: 'menuAddRowGroup',\r\n            removeIcon: 'menuRemoveRowGroup',\r\n        });\r\n\r\n        menuItemMap.set('value', {\r\n            allowedFunction: (col) => col.isPrimary() && col.isAllowValue(),\r\n            activeFunction: (col) => col.isValueActive(),\r\n            activateLabel: () => localeTextFunc('addToValues', `Add ${displayName} to values`, [displayName!]),\r\n            deactivateLabel: () =>\r\n                localeTextFunc('removeFromValues', `Remove ${displayName} from values`, [displayName!]),\r\n            activateFunction: () =>\r\n                valueColsSvc?.setColumns(this.addColumnsToList(valueColsSvc.columns), 'toolPanelUi'),\r\n            deActivateFunction: () =>\r\n                valueColsSvc?.setColumns(this.removeColumnsFromList(valueColsSvc.columns), 'toolPanelUi'),\r\n            addIcon: 'valuePanel',\r\n            removeIcon: 'valuePanel',\r\n        });\r\n\r\n        menuItemMap.set('pivot', {\r\n            allowedFunction: (col) => colModel.isPivotMode() && col.isPrimary() && col.isAllowPivot(),\r\n            activeFunction: (col) => col.isPivotActive(),\r\n            activateLabel: () => localeTextFunc('addToLabels', `Add ${displayName} to labels`, [displayName!]),\r\n            deactivateLabel: () =>\r\n                localeTextFunc('removeFromLabels', `Remove ${displayName} from labels`, [displayName!]),\r\n            activateFunction: () =>\r\n                pivotColsSvc?.setColumns(this.addColumnsToList(pivotColsSvc.columns), 'toolPanelUi'),\r\n            deActivateFunction: () =>\r\n                pivotColsSvc?.setColumns(this.removeColumnsFromList(pivotColsSvc.columns), 'toolPanelUi'),\r\n            addIcon: 'pivotPanel',\r\n            removeIcon: 'pivotPanel',\r\n        });\r\n    }\r\n\r\n    private addColumnsToList(columnList: AgColumn[]): AgColumn[] {\r\n        return [...columnList].concat(this.columns.filter((col) => columnList.indexOf(col) === -1));\r\n    }\r\n\r\n    private removeColumnsFromList(columnList: AgColumn[]): AgColumn[] {\r\n        return columnList.filter((col) => this.columns.indexOf(col) === -1);\r\n    }\r\n\r\n    private displayContextMenu(menuItemsMapped: MenuItemDef[]): void {\r\n        const eGui = this.getGui();\r\n        const menuList = this.createBean(new AgMenuList());\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n\r\n        let hideFunc = () => {};\r\n\r\n        eGui.appendChild(menuList.getGui());\r\n        menuList.addMenuItems(menuItemsMapped);\r\n        menuList.addManagedListeners(menuList, {\r\n            closeMenu: () => {\r\n                this.parentEl.focus();\r\n                hideFunc();\r\n            },\r\n        });\r\n\r\n        const popupSvc = this.beans.popupSvc!;\r\n        const addPopupRes = popupSvc.addPopup({\r\n            modal: true,\r\n            eChild: eGui,\r\n            closeOnEsc: true,\r\n            afterGuiAttached: () => _focusInto(menuList.getGui()),\r\n            ariaLabel: localeTextFunc('ariaLabelContextMenu', 'Context Menu'),\r\n            closedCallback: (e: KeyboardEvent) => {\r\n                if (e instanceof KeyboardEvent) {\r\n                    this.parentEl.focus();\r\n                }\r\n                this.destroyBean(menuList);\r\n            },\r\n        });\r\n\r\n        if (addPopupRes) {\r\n            hideFunc = addPopupRes.hideFunc;\r\n        }\r\n\r\n        popupSvc.positionPopupUnderMouseEvent({\r\n            type: 'columnContextMenu',\r\n            mouseEvent: this.mouseEvent,\r\n            ePopup: eGui,\r\n        });\r\n    }\r\n\r\n    private isActive(): boolean {\r\n        return this.allowGrouping || this.allowValues || this.allowPivoting;\r\n    }\r\n\r\n    private getMappedMenuItems(): MenuItemDef[] {\r\n        const ret: MenuItemDef[] = [];\r\n        const { menuItemMap, columns, displayName, beans } = this;\r\n        for (const val of menuItemMap.values()) {\r\n            const isInactive = columns.some((col) => val.allowedFunction(col) && !val.activeFunction(col));\r\n            const isActive = columns.some((col) => val.allowedFunction(col) && val.activeFunction(col));\r\n\r\n            if (isInactive) {\r\n                ret.push({\r\n                    name: val.activateLabel(displayName!),\r\n                    icon: _createIconNoSpan(val.addIcon, beans, null),\r\n                    action: () => val.activateFunction(),\r\n                });\r\n            }\r\n\r\n            if (isActive) {\r\n                ret.push({\r\n                    name: val.deactivateLabel(displayName!),\r\n                    icon: _createIconNoSpan(val.removeIcon, beans, null),\r\n                    action: () => val.deActivateFunction(),\r\n                });\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    }\r\n}\r\n", "import type { AgColumn, BeanCollection, ColumnModel, RowNode } from 'ag-grid-community';\r\n\r\nexport function setRowNodeGroupValue(\r\n    rowNode: RowNode,\r\n    colModel: ColumnModel,\r\n    colKey: string | AgColumn,\r\n    newValue: any\r\n): void {\r\n    const column = colModel.getCol(colKey)!;\r\n\r\n    if (!rowNode.groupData) {\r\n        rowNode.groupData = {};\r\n    }\r\n\r\n    const columnId = column.getColId();\r\n    const oldValue = rowNode.groupData[columnId];\r\n\r\n    if (oldValue === newValue) {\r\n        return;\r\n    }\r\n\r\n    rowNode.groupData[columnId] = newValue;\r\n    rowNode.dispatchCellChangedEvent(column, newValue, oldValue);\r\n}\r\n\r\nexport function setRowNodeGroup(rowNode: RowNode, beans: BeanCollection, group: boolean): void {\r\n    if (rowNode.group === group) {\r\n        return;\r\n    }\r\n\r\n    // if we used to be a group, and no longer, then close the node\r\n    if (rowNode.group && !group) {\r\n        rowNode.expanded = false;\r\n    }\r\n\r\n    rowNode.group = group;\r\n    rowNode.updateHasChildren();\r\n    beans.selectionSvc?.updateRowSelectable(rowNode);\r\n    rowNode.dispatchRowEvent('groupChanged');\r\n}\r\n\r\nexport function isRowGroupColLocked(column: AgColumn | undefined | null, beans: BeanCollection): boolean {\r\n    const { gos, rowGroupColsSvc } = beans;\r\n\r\n    if (!rowGroupColsSvc || !column) {\r\n        return false;\r\n    }\r\n\r\n    const groupLockGroupColumns = gos.get('groupLockGroupColumns');\r\n    if (!column.isRowGroupActive() || groupLockGroupColumns === 0) {\r\n        return false;\r\n    }\r\n\r\n    if (groupLockGroupColumns === -1) {\r\n        return true;\r\n    }\r\n\r\n    const colIndex = rowGroupColsSvc.columns.findIndex((groupCol) => groupCol.getColId() === column.getColId());\r\n    return groupLockGroupColumns > colIndex;\r\n}\r\n", "import type { BeanStub, IMenuActionParams, MenuItemDef, WithoutGridCommon } from 'ag-grid-community';\r\nimport {\r\n    AgPromise,\r\n    KeyCode,\r\n    TabGuardComp,\r\n    _last,\r\n    _loadTemplate,\r\n    _stopPropagationForAgGrid,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { AgMenuItemComponentEvent, CloseMenuEvent, MenuItemActivatedEvent } from './agMenuItemComponent';\r\nimport { AgMenuItemComponent } from './agMenuItemComponent';\r\n\r\nexport type AgMenuListEvent = AgMenuItemComponentEvent;\r\n\r\nexport class AgMenuList extends TabGuardComp<AgMenuListEvent> {\r\n    private menuItems: AgMenuItemComponent[] = [];\r\n    private activeMenuItem: AgMenuItemComponent | null;\r\n    private params: WithoutGridCommon<IMenuActionParams>;\r\n\r\n    constructor(\r\n        private readonly level = 0,\r\n        params?: WithoutGridCommon<IMenuActionParams>\r\n    ) {\r\n        super(/* html */ `<div class=\"ag-menu-list\" role=\"tree\"></div>`);\r\n        this.params = params ?? {\r\n            column: null,\r\n            node: null,\r\n            value: null,\r\n        };\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.initialiseTabGuard({\r\n            onTabKeyDown: (e) => this.onTabKeyDown(e),\r\n            handleKeyDown: (e) => this.handleKeyDown(e),\r\n            onFocusIn: (e) => this.handleFocusIn(e),\r\n            onFocusOut: (e) => this.handleFocusOut(e),\r\n        });\r\n    }\r\n\r\n    private onTabKeyDown(e: KeyboardEvent) {\r\n        const parent = this.getParentComponent();\r\n        const parentGui = parent && parent.getGui();\r\n        const isManaged = parentGui && parentGui.classList.contains('ag-focus-managed');\r\n\r\n        if (!isManaged) {\r\n            e.preventDefault();\r\n        }\r\n\r\n        if (e.shiftKey) {\r\n            this.closeIfIsChild(e);\r\n        }\r\n    }\r\n\r\n    private handleKeyDown(e: KeyboardEvent): void {\r\n        switch (e.key) {\r\n            case KeyCode.UP:\r\n            case KeyCode.RIGHT:\r\n            case KeyCode.DOWN:\r\n            case KeyCode.LEFT:\r\n                e.preventDefault();\r\n                this.handleNavKey(e.key);\r\n                break;\r\n            case KeyCode.ESCAPE:\r\n                if (this.closeIfIsChild()) {\r\n                    _stopPropagationForAgGrid(e);\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    private handleFocusIn(e: FocusEvent): void {\r\n        // if focus is coming from outside the menu list, then re-activate an item\r\n        const oldFocusedElement = e.relatedTarget as HTMLElement;\r\n        if (\r\n            !this.tabGuardFeature.getTabGuardCtrl().isTabGuard(oldFocusedElement) &&\r\n            (this.getGui().contains(oldFocusedElement) ||\r\n                this.activeMenuItem?.getSubMenuGui()?.contains(oldFocusedElement))\r\n        ) {\r\n            return;\r\n        }\r\n        if (this.activeMenuItem) {\r\n            this.activeMenuItem.activate();\r\n        } else {\r\n            this.activateFirstItem();\r\n        }\r\n    }\r\n\r\n    private handleFocusOut(e: FocusEvent): void {\r\n        // if focus is going outside the menu list, deactivate the current item\r\n        const newFocusedElement = e.relatedTarget as HTMLElement;\r\n        if (\r\n            !this.activeMenuItem ||\r\n            this.getGui().contains(newFocusedElement) ||\r\n            this.activeMenuItem.getSubMenuGui()?.contains(newFocusedElement)\r\n        ) {\r\n            return;\r\n        }\r\n        if (!this.activeMenuItem.isSubMenuOpening()) {\r\n            this.activeMenuItem.deactivate();\r\n        }\r\n    }\r\n\r\n    public clearActiveItem(): void {\r\n        if (this.activeMenuItem) {\r\n            this.activeMenuItem.deactivate();\r\n            this.activeMenuItem = null;\r\n        }\r\n    }\r\n\r\n    public addMenuItems(menuItems?: (MenuItemDef | string)[]): void {\r\n        if (menuItems == null) {\r\n            return;\r\n        }\r\n\r\n        AgPromise.all(\r\n            menuItems.map<AgPromise<{ eGui: HTMLElement | null; comp?: AgMenuItemComponent }>>((menuItemOrString) => {\r\n                if (menuItemOrString === 'separator') {\r\n                    return AgPromise.resolve({ eGui: this.createSeparator() });\r\n                } else if (typeof menuItemOrString === 'string') {\r\n                    _warn(228, { menuItemOrString });\r\n                    return AgPromise.resolve({ eGui: null });\r\n                } else {\r\n                    return this.addItem(menuItemOrString);\r\n                }\r\n            })\r\n        ).then((elements) => {\r\n            (elements ?? []).forEach((element) => {\r\n                if (element?.eGui) {\r\n                    this.appendChild(element.eGui);\r\n                    if (element.comp) {\r\n                        this.menuItems.push(element.comp);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    private addItem(menuItemDef: MenuItemDef): AgPromise<{ comp: AgMenuItemComponent; eGui: HTMLElement }> {\r\n        const menuItem = this.createManagedBean(new AgMenuItemComponent());\r\n        return menuItem\r\n            .init({\r\n                menuItemDef,\r\n                isAnotherSubMenuOpen: () => this.menuItems.some((m) => m.isSubMenuOpen()),\r\n                level: this.level,\r\n                contextParams: this.params,\r\n            })\r\n            .then(() => {\r\n                menuItem.setParentComponent(this);\r\n\r\n                this.addManagedListeners(menuItem, {\r\n                    closeMenu: (event: CloseMenuEvent) => {\r\n                        this.dispatchLocalEvent(event);\r\n                    },\r\n                    menuItemActivated: (event: MenuItemActivatedEvent) => {\r\n                        if (this.activeMenuItem && this.activeMenuItem !== event.menuItem) {\r\n                            this.activeMenuItem.deactivate();\r\n                        }\r\n\r\n                        this.activeMenuItem = event.menuItem;\r\n                    },\r\n                });\r\n\r\n                return {\r\n                    comp: menuItem,\r\n                    eGui: menuItem.getGui(),\r\n                };\r\n            });\r\n    }\r\n\r\n    public activateFirstItem(): void {\r\n        const item = this.menuItems.filter((currentItem) => !currentItem.isDisabled())[0];\r\n\r\n        if (!item) {\r\n            return;\r\n        }\r\n\r\n        item.activate();\r\n    }\r\n\r\n    private createSeparator(): HTMLElement {\r\n        const separatorHtml = /* html */ `\r\n            <div class=\"ag-menu-separator\" aria-hidden=\"true\">\r\n                <div class=\"ag-menu-separator-part\"></div>\r\n                <div class=\"ag-menu-separator-part\"></div>\r\n                <div class=\"ag-menu-separator-part\"></div>\r\n                <div class=\"ag-menu-separator-part\"></div>\r\n            </div>`;\r\n\r\n        return _loadTemplate(separatorHtml);\r\n    }\r\n\r\n    private handleNavKey(key: string): void {\r\n        switch (key) {\r\n            case KeyCode.UP:\r\n            case KeyCode.DOWN: {\r\n                const nextItem = this.findNextItem(key === KeyCode.UP);\r\n\r\n                if (nextItem && nextItem !== this.activeMenuItem) {\r\n                    nextItem.activate();\r\n                }\r\n\r\n                return;\r\n            }\r\n        }\r\n\r\n        const left = this.gos.get('enableRtl') ? KeyCode.RIGHT : KeyCode.LEFT;\r\n\r\n        if (key === left) {\r\n            this.closeIfIsChild();\r\n        } else {\r\n            this.openChild();\r\n        }\r\n    }\r\n\r\n    private closeIfIsChild(e?: KeyboardEvent): boolean {\r\n        const parentItem = this.getParentComponent() as BeanStub;\r\n\r\n        if (parentItem && parentItem instanceof AgMenuItemComponent) {\r\n            if (e) {\r\n                e.preventDefault();\r\n            }\r\n\r\n            parentItem.closeSubMenu();\r\n            parentItem.getGui().focus();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private openChild(): void {\r\n        if (this.activeMenuItem) {\r\n            this.activeMenuItem.openSubMenu(true);\r\n        }\r\n    }\r\n\r\n    private findNextItem(up?: boolean): AgMenuItemComponent | undefined {\r\n        const items = this.menuItems.filter((item) => !item.isDisabled());\r\n\r\n        if (!items.length) {\r\n            return;\r\n        }\r\n\r\n        if (!this.activeMenuItem) {\r\n            return up ? _last(items) : items[0];\r\n        }\r\n\r\n        if (up) {\r\n            items.reverse();\r\n        }\r\n\r\n        let nextItem: AgMenuItemComponent | undefined;\r\n        let foundCurrent = false;\r\n\r\n        for (let i = 0; i < items.length; i++) {\r\n            const item = items[i];\r\n\r\n            if (!foundCurrent) {\r\n                if (item === this.activeMenuItem) {\r\n                    foundCurrent = true;\r\n                }\r\n                continue;\r\n            }\r\n\r\n            nextItem = item;\r\n            break;\r\n        }\r\n\r\n        if (foundCurrent && !nextItem) {\r\n            // start again from the beginning (/end)\r\n            return items[0];\r\n        }\r\n\r\n        return nextItem! || this.activeMenuItem;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.clearActiveItem();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import {\r\n    AgPromise,\r\n    BeanStub,\r\n    KeyCode,\r\n    _loadTemplate,\r\n    _setAriaDisabled,\r\n    _setAriaExpanded,\r\n    _setAriaLevel,\r\n    _setAriaRole,\r\n} from 'ag-grid-community';\r\nimport type {\r\n    AgColumn,\r\n    AgEvent,\r\n    BeanCollection,\r\n    Component,\r\n    ComponentType,\r\n    IComponent,\r\n    IMenuActionParams,\r\n    IMenuConfigParams,\r\n    IMenuItemComp,\r\n    IMenuItemParams,\r\n    ITooltipCtrl,\r\n    MenuItemDef,\r\n    PopupService,\r\n    Registry,\r\n    TooltipFeature,\r\n    UserCompDetails,\r\n    UserComponentFactory,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\n\r\nimport { AgMenuList } from './agMenuList';\r\nimport { AgMenuPanel } from './agMenuPanel';\r\n\r\nexport interface CloseMenuEvent extends AgEvent<'closeMenu'> {\r\n    mouseEvent?: MouseEvent;\r\n    keyboardEvent?: KeyboardEvent;\r\n}\r\n\r\nexport interface MenuItemActivatedEvent extends AgEvent<'menuItemActivated'> {\r\n    menuItem: AgMenuItemComponent;\r\n}\r\n\r\ninterface AgMenuItemComponentParams {\r\n    menuItemDef: MenuItemDef;\r\n    isAnotherSubMenuOpen: () => boolean;\r\n    level: number;\r\n    childComponent?: IComponent<any>;\r\n    contextParams: WithoutGridCommon<IMenuActionParams>;\r\n}\r\n\r\nexport type AgMenuItemComponentEvent = 'closeMenu' | 'menuItemActivated';\r\n\r\nfunction getMenuItemCompDetails(\r\n    userCompFactory: UserComponentFactory,\r\n    def: MenuItemDef,\r\n    params: WithoutGridCommon<IMenuItemParams>\r\n): UserCompDetails<IMenuItemComp> | undefined {\r\n    return userCompFactory.getCompDetails(def, MenuItemComponent, 'agMenuItem', params, true);\r\n}\r\n\r\nconst MenuItemComponent: ComponentType<IMenuItemComp> = {\r\n    name: 'menuItem',\r\n    optionalMethods: ['setActive', 'select', 'setExpanded', 'configureDefaults'],\r\n};\r\n\r\nexport class AgMenuItemComponent extends BeanStub<AgMenuItemComponentEvent> {\r\n    private popupSvc?: PopupService;\r\n    private userCompFactory: UserComponentFactory;\r\n    private registry: Registry;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.popupSvc = beans.popupSvc;\r\n        this.userCompFactory = beans.userCompFactory;\r\n        this.registry = beans.registry;\r\n    }\r\n\r\n    private ACTIVATION_DELAY = 80;\r\n\r\n    private eGui?: HTMLElement;\r\n    private params: MenuItemDef;\r\n    private isAnotherSubMenuOpen: () => boolean;\r\n    private level: number;\r\n    private childComponent?: IComponent<any>;\r\n    private contextParams: WithoutGridCommon<IMenuActionParams>;\r\n    private menuItemComp: IMenuItemComp;\r\n    private isActive = false;\r\n    private hideSubMenu: (() => void) | null;\r\n    private subMenuIsOpen = false;\r\n    private subMenuIsOpening = false;\r\n    private activateTimeoutId: number;\r\n    private deactivateTimeoutId: number;\r\n    private parentComponent?: Component<any>;\r\n    private tooltip?: string;\r\n    private tooltipFeature?: TooltipFeature;\r\n    private suppressRootStyles: boolean = true;\r\n    private suppressAria: boolean = true;\r\n    private suppressFocus: boolean = true;\r\n    private cssClassPrefix: string;\r\n    private eSubMenuGui?: HTMLElement;\r\n\r\n    public init(params: AgMenuItemComponentParams): AgPromise<void> {\r\n        const { menuItemDef, isAnotherSubMenuOpen, level, childComponent, contextParams } = params;\r\n        this.params = params.menuItemDef;\r\n        this.level = level;\r\n        this.isAnotherSubMenuOpen = isAnotherSubMenuOpen;\r\n        this.childComponent = childComponent;\r\n        this.contextParams = contextParams;\r\n        this.cssClassPrefix = this.params.menuItemParams?.cssClassPrefix ?? 'ag-menu-option';\r\n        const compDetails = getMenuItemCompDetails(this.userCompFactory, this.params, {\r\n            ...menuItemDef,\r\n            level,\r\n            isAnotherSubMenuOpen,\r\n            openSubMenu: (activateFirstItem) => this.openSubMenu(activateFirstItem),\r\n            closeSubMenu: () => this.closeSubMenu(),\r\n            closeMenu: (event) => this.closeMenu(event),\r\n            updateTooltip: (tooltip?: string, shouldDisplayTooltip?: () => boolean) =>\r\n                this.refreshTooltip(tooltip, shouldDisplayTooltip),\r\n            onItemActivated: () => this.onItemActivated(),\r\n        });\r\n        return (\r\n            compDetails?.newAgStackInstance().then((comp: IMenuItemComp) => {\r\n                this.menuItemComp = comp;\r\n                const configureDefaults = comp.configureDefaults?.();\r\n                if (configureDefaults) {\r\n                    this.configureDefaults(configureDefaults === true ? undefined : configureDefaults);\r\n                }\r\n            }) ?? AgPromise.resolve()\r\n        );\r\n    }\r\n\r\n    private addListeners(eGui: HTMLElement, params?: IMenuConfigParams): void {\r\n        if (!params?.suppressClick) {\r\n            this.addManagedElementListeners(eGui, { click: (e) => this.onItemSelected(e!) });\r\n        }\r\n        if (!params?.suppressKeyboardSelect) {\r\n            this.addManagedElementListeners(eGui, {\r\n                keydown: (e: KeyboardEvent) => {\r\n                    if (e.key === KeyCode.ENTER || e.key === KeyCode.SPACE) {\r\n                        e.preventDefault();\r\n                        this.onItemSelected(e);\r\n                    }\r\n                },\r\n            });\r\n        }\r\n        if (!params?.suppressMouseDown) {\r\n            this.addManagedElementListeners(eGui, {\r\n                mousedown: (e: MouseEvent) => {\r\n                    // Prevent event bubbling to other event handlers such as PopupService triggering\r\n                    // premature closing of any open sub-menu popup.\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                },\r\n            });\r\n        }\r\n        if (!params?.suppressMouseOver) {\r\n            this.addManagedElementListeners(eGui, {\r\n                mouseenter: () => this.onMouseEnter(),\r\n                mouseleave: () => this.onMouseLeave(),\r\n            });\r\n        }\r\n    }\r\n\r\n    public isDisabled(): boolean {\r\n        return !!this.params.disabled;\r\n    }\r\n\r\n    public openSubMenu(activateFirstItem = false, event?: MouseEvent | KeyboardEvent): void {\r\n        this.closeSubMenu();\r\n\r\n        if (!this.params.subMenu) {\r\n            return;\r\n        }\r\n\r\n        this.subMenuIsOpening = true;\r\n\r\n        const ePopup = _loadTemplate(/* html */ `<div class=\"ag-menu\" role=\"presentation\"></div>`);\r\n        this.eSubMenuGui = ePopup;\r\n        let destroySubMenu: () => void;\r\n        let afterGuiAttached = () => {\r\n            this.subMenuIsOpening = false;\r\n        };\r\n\r\n        if (this.childComponent) {\r\n            const menuPanel = this.createBean(new AgMenuPanel(this.childComponent));\r\n            menuPanel.setParentComponent(this as any);\r\n\r\n            const subMenuGui = menuPanel.getGui();\r\n            const mouseEvent = 'mouseenter';\r\n            const mouseEnterListener = () => this.cancelDeactivate();\r\n\r\n            subMenuGui.addEventListener(mouseEvent, mouseEnterListener);\r\n\r\n            destroySubMenu = () => subMenuGui.removeEventListener(mouseEvent, mouseEnterListener);\r\n\r\n            ePopup.appendChild(subMenuGui);\r\n\r\n            if ((this.childComponent as any).afterGuiAttached) {\r\n                afterGuiAttached = () => {\r\n                    (this.childComponent as any).afterGuiAttached!();\r\n                    this.subMenuIsOpening = false;\r\n                };\r\n            }\r\n        } else if (this.params.subMenu) {\r\n            const childMenu = this.createBean(new AgMenuList(this.level + 1, this.contextParams));\r\n\r\n            childMenu.setParentComponent(this as any);\r\n            childMenu.addMenuItems(this.params.subMenu);\r\n            ePopup.appendChild(childMenu.getGui());\r\n\r\n            // bubble menu item selected events\r\n            this.addManagedListeners(childMenu, { closeMenu: (e) => this.dispatchLocalEvent(e) });\r\n            childMenu.addGuiEventListener('mouseenter', () => this.cancelDeactivate());\r\n\r\n            destroySubMenu = () => this.destroyBean(childMenu);\r\n\r\n            if (activateFirstItem) {\r\n                afterGuiAttached = () => {\r\n                    childMenu.activateFirstItem();\r\n                    this.subMenuIsOpening = false;\r\n                };\r\n            }\r\n        }\r\n\r\n        const { popupSvc } = this;\r\n        const positionCallback = () => {\r\n            const eventSource = this.eGui!;\r\n            popupSvc?.positionPopupForMenu({\r\n                eventSource,\r\n                ePopup,\r\n            });\r\n            const { column, node } = this.contextParams;\r\n            popupSvc?.callPostProcessPopup(\r\n                'subMenu',\r\n                ePopup,\r\n                eventSource,\r\n                event instanceof MouseEvent ? event : undefined,\r\n                column as AgColumn,\r\n                node\r\n            );\r\n        };\r\n\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        const addPopupRes = popupSvc?.addPopup({\r\n            modal: true,\r\n            eChild: ePopup,\r\n            positionCallback,\r\n            anchorToElement: this.eGui,\r\n            ariaLabel: translate('ariaLabelSubMenu', 'SubMenu'),\r\n            afterGuiAttached,\r\n        });\r\n\r\n        this.subMenuIsOpen = true;\r\n        this.setAriaExpanded(true);\r\n\r\n        this.hideSubMenu = () => {\r\n            if (addPopupRes) {\r\n                addPopupRes.hideFunc();\r\n            }\r\n            this.subMenuIsOpen = false;\r\n            this.setAriaExpanded(false);\r\n            destroySubMenu();\r\n            this.menuItemComp.setExpanded?.(false);\r\n            this.eSubMenuGui = undefined;\r\n        };\r\n\r\n        this.menuItemComp.setExpanded?.(true);\r\n    }\r\n\r\n    private setAriaExpanded(expanded: boolean): void {\r\n        if (!this.suppressAria) {\r\n            _setAriaExpanded(this.eGui!, expanded);\r\n        }\r\n    }\r\n\r\n    public closeSubMenu(): void {\r\n        if (!this.hideSubMenu) {\r\n            return;\r\n        }\r\n\r\n        this.hideSubMenu();\r\n        this.hideSubMenu = null;\r\n        this.setAriaExpanded(false);\r\n    }\r\n\r\n    public isSubMenuOpen(): boolean {\r\n        return this.subMenuIsOpen;\r\n    }\r\n\r\n    public isSubMenuOpening(): boolean {\r\n        return this.subMenuIsOpening;\r\n    }\r\n\r\n    public activate(openSubMenu?: boolean): void {\r\n        this.cancelActivate();\r\n\r\n        if (this.params.disabled) {\r\n            return;\r\n        }\r\n\r\n        this.isActive = true;\r\n        if (!this.suppressRootStyles) {\r\n            this.eGui!.classList.add(`${this.cssClassPrefix}-active`);\r\n        }\r\n        this.menuItemComp.setActive?.(true);\r\n        if (!this.suppressFocus) {\r\n            this.eGui!.focus({ preventScroll: true });\r\n        }\r\n\r\n        if (openSubMenu && this.params.subMenu) {\r\n            window.setTimeout(() => {\r\n                if (this.isAlive() && this.isActive) {\r\n                    this.openSubMenu();\r\n                }\r\n            }, 300);\r\n        }\r\n\r\n        this.onItemActivated();\r\n    }\r\n\r\n    public deactivate() {\r\n        this.cancelDeactivate();\r\n        if (!this.suppressRootStyles) {\r\n            this.eGui!.classList.remove(`${this.cssClassPrefix}-active`);\r\n        }\r\n        this.menuItemComp.setActive?.(false);\r\n        this.isActive = false;\r\n\r\n        if (this.subMenuIsOpen) {\r\n            this.hideSubMenu!();\r\n        }\r\n    }\r\n\r\n    public getGui(): HTMLElement {\r\n        return this.menuItemComp.getGui();\r\n    }\r\n\r\n    public getParentComponent(): Component | undefined {\r\n        return this.parentComponent;\r\n    }\r\n\r\n    public setParentComponent(component: Component<any>): void {\r\n        this.parentComponent = component;\r\n    }\r\n\r\n    public getSubMenuGui(): HTMLElement | undefined {\r\n        return this.eSubMenuGui;\r\n    }\r\n\r\n    private onItemSelected(event: MouseEvent | KeyboardEvent): void {\r\n        this.menuItemComp.select?.();\r\n        if (this.params.action) {\r\n            this.beans.frameworkOverrides.wrapOutgoing(() =>\r\n                this.params.action!(\r\n                    this.gos.addGridCommonParams({\r\n                        ...this.contextParams,\r\n                    })\r\n                )\r\n            );\r\n        } else {\r\n            this.openSubMenu(event && event.type === 'keydown', event);\r\n        }\r\n\r\n        if ((this.params.subMenu && !this.params.action) || this.params.suppressCloseOnSelect) {\r\n            return;\r\n        }\r\n\r\n        this.closeMenu(event);\r\n    }\r\n\r\n    private closeMenu(event?: MouseEvent | KeyboardEvent): void {\r\n        const e: CloseMenuEvent = {\r\n            type: 'closeMenu',\r\n        };\r\n\r\n        if (event) {\r\n            if (event instanceof MouseEvent) {\r\n                e.mouseEvent = event;\r\n            } else {\r\n                e.keyboardEvent = event;\r\n            }\r\n        }\r\n\r\n        this.dispatchLocalEvent(e);\r\n    }\r\n\r\n    private onItemActivated(): void {\r\n        const event: MenuItemActivatedEvent = {\r\n            type: 'menuItemActivated',\r\n            menuItem: this,\r\n        };\r\n\r\n        this.dispatchLocalEvent(event);\r\n    }\r\n\r\n    private cancelActivate(): void {\r\n        if (this.activateTimeoutId) {\r\n            window.clearTimeout(this.activateTimeoutId);\r\n            this.activateTimeoutId = 0;\r\n        }\r\n    }\r\n\r\n    private cancelDeactivate(): void {\r\n        if (this.deactivateTimeoutId) {\r\n            window.clearTimeout(this.deactivateTimeoutId);\r\n            this.deactivateTimeoutId = 0;\r\n        }\r\n    }\r\n\r\n    private onMouseEnter(): void {\r\n        this.cancelDeactivate();\r\n\r\n        if (this.isAnotherSubMenuOpen()) {\r\n            // wait to see if the user enters the open sub-menu\r\n            this.activateTimeoutId = window.setTimeout(() => this.activate(true), this.ACTIVATION_DELAY);\r\n        } else {\r\n            // activate immediately\r\n            this.activate(true);\r\n        }\r\n    }\r\n\r\n    private onMouseLeave(): void {\r\n        this.cancelActivate();\r\n\r\n        if (this.isSubMenuOpen()) {\r\n            // wait to see if the user enters the sub-menu\r\n            this.deactivateTimeoutId = window.setTimeout(() => this.deactivate(), this.ACTIVATION_DELAY);\r\n        } else {\r\n            // de-activate immediately\r\n            this.deactivate();\r\n        }\r\n    }\r\n\r\n    private configureDefaults(params?: IMenuConfigParams): void {\r\n        if (!this.menuItemComp) {\r\n            // need to wait for init to complete\r\n            setTimeout(() => this.configureDefaults(params));\r\n            return;\r\n        }\r\n\r\n        let eGui = this.menuItemComp.getGui();\r\n        const { suppressRootStyles, suppressTooltip, suppressAria, suppressTabIndex, suppressFocus } = params || {};\r\n\r\n        // in some frameworks, `getGui` might be a framework element\r\n        const rootElement = (this.menuItemComp as any).getRootElement?.() as HTMLElement | undefined;\r\n        if (rootElement) {\r\n            if (!suppressRootStyles) {\r\n                eGui.classList.add('ag-menu-option-custom');\r\n            }\r\n            eGui = rootElement;\r\n        }\r\n\r\n        this.eGui = eGui;\r\n\r\n        this.suppressRootStyles = !!suppressRootStyles;\r\n        if (!this.suppressRootStyles) {\r\n            eGui.classList.add(this.cssClassPrefix);\r\n            this.params.cssClasses?.forEach((it) => eGui.classList.add(it));\r\n            if (this.params.disabled) {\r\n                eGui.classList.add(`${this.cssClassPrefix}-disabled`);\r\n            }\r\n        }\r\n\r\n        if (!suppressTooltip) {\r\n            this.refreshTooltip(this.params.tooltip);\r\n        }\r\n\r\n        this.suppressAria = !!suppressAria;\r\n\r\n        if (!this.suppressAria) {\r\n            _setAriaRole(eGui, 'treeitem');\r\n            _setAriaLevel(eGui, this.level + 1);\r\n            if (this.params.disabled) {\r\n                _setAriaDisabled(eGui, true);\r\n            }\r\n        }\r\n\r\n        if (!suppressTabIndex) {\r\n            eGui.setAttribute('tabindex', '-1');\r\n        }\r\n\r\n        if (!this.params.disabled) {\r\n            this.addListeners(eGui, params);\r\n        }\r\n\r\n        this.suppressFocus = !!suppressFocus;\r\n    }\r\n\r\n    private refreshTooltip(tooltip?: string, shouldDisplayTooltip?: () => boolean): void {\r\n        this.tooltip = tooltip;\r\n\r\n        this.tooltipFeature = this.destroyBean(this.tooltipFeature);\r\n\r\n        if (!tooltip || !this.menuItemComp) {\r\n            return;\r\n        }\r\n\r\n        const tooltipFeature = this.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n            getGui: () => this.getGui(),\r\n            getTooltipValue: () => this.tooltip,\r\n            getLocation: () => 'menu',\r\n            shouldDisplayTooltip,\r\n        } as ITooltipCtrl);\r\n\r\n        if (tooltipFeature) {\r\n            this.tooltipFeature = this.createBean(tooltipFeature);\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.tooltipFeature = this.destroyBean(this.tooltipFeature);\r\n        this.menuItemComp?.destroy?.();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { IComponent } from 'ag-grid-community';\r\nimport { KeyCode, TabGuardComp } from 'ag-grid-community';\r\n\r\nimport type { AgMenuItemComponent } from './agMenuItemComponent';\r\n\r\nexport class AgMenuPanel extends TabGuardComp {\r\n    constructor(wrappedComponent: IComponent<any>) {\r\n        super();\r\n\r\n        this.setTemplateFromElement(wrappedComponent.getGui(), undefined, undefined, true);\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.initialiseTabGuard({\r\n            onTabKeyDown: (e) => this.onTabKeyDown(e),\r\n            handleKeyDown: (e) => this.handleKeyDown(e),\r\n        });\r\n    }\r\n\r\n    private handleKeyDown(e: KeyboardEvent): void {\r\n        if (e.key === KeyCode.ESCAPE) {\r\n            this.closePanel();\r\n        }\r\n    }\r\n\r\n    private onTabKeyDown(e: KeyboardEvent): void {\r\n        if (e.defaultPrevented) {\r\n            return;\r\n        }\r\n\r\n        this.closePanel();\r\n        e.preventDefault();\r\n    }\r\n\r\n    private closePanel(): void {\r\n        const menuItem = this.parentComponent as unknown as AgMenuItemComponent;\r\n        menuItem.closeSubMenu();\r\n        setTimeout(() => menuItem.getGui().focus(), 0);\r\n    }\r\n}\r\n", "import type { AgCheckbox, AgColumn, DragItem, DragSource, ITooltipCtrl, TooltipFeature } from 'ag-grid-community';\r\nimport {\r\n    AgCheckboxSelector,\r\n    Component,\r\n    DragSourceType,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    _createIconNoSpan,\r\n    _escapeString,\r\n    _getShouldDisplayTooltip,\r\n    _getToolPanelClassesFromColDef,\r\n    _setAriaDescribedBy,\r\n    _setAriaLabel,\r\n    _setDisplayed,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { ColumnModelItem } from './columnModelItem';\r\nimport { createPivotState, setAllColumns, updateColumns } from './modelItemUtils';\r\nimport { ToolPanelContextMenu } from './toolPanelContextMenu';\r\n\r\nexport class ToolPanelColumnComp extends Component {\r\n    private readonly eLabel: HTMLElement = RefPlaceholder;\r\n    private readonly cbSelect: AgCheckbox = RefPlaceholder;\r\n\r\n    public readonly column: AgColumn;\r\n    private readonly columnDept: number;\r\n    private eDragHandle: Element;\r\n    private readonly displayName: string | null;\r\n    private processingColumnStateChange = false;\r\n    private tooltipFeature?: TooltipFeature;\r\n\r\n    constructor(\r\n        modelItem: ColumnModelItem,\r\n        private readonly allowDragging: boolean,\r\n        private readonly groupsExist: boolean,\r\n        private readonly focusWrapper: HTMLElement\r\n    ) {\r\n        super();\r\n        const { column, depth, displayName } = modelItem;\r\n        this.column = column;\r\n        this.columnDept = depth;\r\n        this.displayName = displayName;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.setTemplate(\r\n            /* html */\r\n            `<div class=\"ag-column-select-column\">\r\n                <ag-checkbox data-ref=\"cbSelect\" class=\"ag-column-select-checkbox\"></ag-checkbox>\r\n                <span class=\"ag-column-select-column-label\" data-ref=\"eLabel\"></span>\r\n            </div>`,\r\n            [AgCheckboxSelector]\r\n        );\r\n        const {\r\n            beans,\r\n            cbSelect,\r\n            displayName,\r\n            eLabel,\r\n            columnDept: indent,\r\n            groupsExist,\r\n            column,\r\n            gos,\r\n            focusWrapper,\r\n        } = this;\r\n        const eDragHandle = _createIconNoSpan('columnDrag', beans)!;\r\n        this.eDragHandle = eDragHandle;\r\n        eDragHandle.classList.add('ag-drag-handle', 'ag-column-select-column-drag-handle');\r\n\r\n        const checkboxGui = cbSelect.getGui();\r\n        const checkboxInput = cbSelect.getInputElement();\r\n\r\n        checkboxGui.insertAdjacentElement('afterend', eDragHandle);\r\n        checkboxInput.setAttribute('tabindex', '-1');\r\n\r\n        const displayNameSanitised: any = _escapeString(displayName);\r\n        eLabel.innerHTML = displayNameSanitised;\r\n\r\n        // if grouping, we add an extra level of indent, to cater for expand/contract icons we need to indent for\r\n        if (groupsExist) {\r\n            this.addCssClass('ag-column-select-add-group-indent');\r\n        }\r\n        this.addCssClass(`ag-column-select-indent-${indent}`);\r\n        this.getGui().style.setProperty('--ag-indentation-level', String(indent));\r\n\r\n        this.tooltipFeature = this.createOptionalManagedBean(\r\n            beans.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.getGui(),\r\n                getLocation: () => 'columnToolPanelColumn',\r\n                getColDef: () => column.getColDef(),\r\n                shouldDisplayTooltip: _getShouldDisplayTooltip(gos, () => eLabel),\r\n            } as ITooltipCtrl)\r\n        );\r\n\r\n        this.setupDragging();\r\n\r\n        const onColStateChanged = this.onColumnStateChanged.bind(this);\r\n        this.addManagedEventListeners({ columnPivotModeChanged: onColStateChanged });\r\n\r\n        this.addManagedListeners(column, {\r\n            columnValueChanged: onColStateChanged,\r\n            columnPivotChanged: onColStateChanged,\r\n            columnRowGroupChanged: onColStateChanged,\r\n            visibleChanged: onColStateChanged,\r\n        });\r\n        this.addManagedListeners(focusWrapper, {\r\n            keydown: this.handleKeyDown.bind(this),\r\n            contextmenu: this.onContextMenu.bind(this),\r\n        });\r\n\r\n        this.addManagedPropertyListener('functionsReadOnly', this.onColumnStateChanged.bind(this));\r\n\r\n        this.addManagedListeners(cbSelect, { fieldValueChanged: this.onCheckboxChanged.bind(this) });\r\n        this.addManagedElementListeners(eLabel, { click: this.onLabelClicked.bind(this) });\r\n\r\n        this.onColumnStateChanged();\r\n        this.refreshAriaLabel();\r\n\r\n        this.setupTooltip();\r\n\r\n        const classes = _getToolPanelClassesFromColDef(column.getColDef(), gos, column, null);\r\n        classes.forEach((c) => this.addOrRemoveCssClass(c, true));\r\n    }\r\n\r\n    public getColumn(): AgColumn {\r\n        return this.column;\r\n    }\r\n\r\n    private setupTooltip(): void {\r\n        const refresh = () => this.tooltipFeature?.setTooltipAndRefresh(this.column.getColDef().headerTooltip);\r\n        refresh();\r\n\r\n        this.addManagedEventListeners({ newColumnsLoaded: refresh });\r\n    }\r\n\r\n    private onContextMenu(e: MouseEvent): void {\r\n        const { column, gos } = this;\r\n\r\n        if (gos.get('functionsReadOnly')) {\r\n            return;\r\n        }\r\n\r\n        const contextMenu = this.createBean(new ToolPanelContextMenu(column, e, this.focusWrapper));\r\n        this.addDestroyFunc(() => {\r\n            if (contextMenu.isAlive()) {\r\n                this.destroyBean(contextMenu);\r\n            }\r\n        });\r\n    }\r\n\r\n    protected handleKeyDown(e: KeyboardEvent): void {\r\n        if (e.key === KeyCode.SPACE) {\r\n            e.preventDefault();\r\n            if (this.isSelectable()) {\r\n                this.onSelectAllChanged(!this.isSelected());\r\n            }\r\n        }\r\n    }\r\n\r\n    private onLabelClicked(): void {\r\n        if (this.gos.get('functionsReadOnly')) {\r\n            return;\r\n        }\r\n\r\n        const nextState = !this.cbSelect.getValue();\r\n        this.onChangeCommon(nextState);\r\n    }\r\n\r\n    private onCheckboxChanged(event: any): void {\r\n        this.onChangeCommon(event.selected);\r\n    }\r\n\r\n    private onChangeCommon(nextState: boolean): void {\r\n        // ignore lock visible columns\r\n        if (this.cbSelect.isReadOnly()) {\r\n            return;\r\n        }\r\n\r\n        this.refreshAriaLabel();\r\n\r\n        // only want to action if the user clicked the checkbox, not if we are setting the checkbox because\r\n        // of a change in the model\r\n        if (this.processingColumnStateChange) {\r\n            return;\r\n        }\r\n\r\n        setAllColumns(this.beans, [this.column], nextState, 'toolPanelUi');\r\n    }\r\n\r\n    private refreshAriaLabel(): void {\r\n        const { cbSelect, focusWrapper, displayName } = this;\r\n        const translate = this.getLocaleTextFunc();\r\n        const columnLabel = translate('ariaColumn', 'Column');\r\n        const state = cbSelect.getValue() ? translate('ariaVisible', 'visible') : translate('ariaHidden', 'hidden');\r\n        const visibilityLabel = translate('ariaToggleVisibility', 'Press SPACE to toggle visibility');\r\n\r\n        _setAriaLabel(focusWrapper, `${displayName} ${columnLabel}`);\r\n        this.cbSelect.setInputAriaLabel(`${visibilityLabel} (${state})`);\r\n        _setAriaDescribedBy(focusWrapper, cbSelect.getInputElement().id);\r\n    }\r\n\r\n    private setupDragging(): void {\r\n        const eDragHandle = this.eDragHandle;\r\n        if (!this.allowDragging) {\r\n            _setDisplayed(eDragHandle, false);\r\n            return;\r\n        }\r\n\r\n        const beans = this.beans;\r\n        const { gos, eventSvc, dragAndDrop } = beans;\r\n\r\n        let hideColumnOnExit = !gos.get('suppressDragLeaveHidesColumns');\r\n        const dragSource: DragSource = {\r\n            type: DragSourceType.ToolPanel,\r\n            eElement: eDragHandle,\r\n            dragItemName: this.displayName,\r\n            getDefaultIconName: () => (hideColumnOnExit ? 'hide' : 'notAllowed'),\r\n            getDragItem: () => this.createDragItem(),\r\n            onDragStarted: () => {\r\n                hideColumnOnExit = !gos.get('suppressDragLeaveHidesColumns');\r\n                eventSvc.dispatchEvent({\r\n                    type: 'columnPanelItemDragStart',\r\n                    column: this.column,\r\n                });\r\n            },\r\n            onDragStopped: () => {\r\n                eventSvc.dispatchEvent({\r\n                    type: 'columnPanelItemDragEnd',\r\n                });\r\n            },\r\n            onGridEnter: (dragItem: DragItem | null) => {\r\n                if (hideColumnOnExit) {\r\n                    // when dragged into the grid, restore the state that was active pre-drag\r\n                    updateColumns(beans, {\r\n                        columns: [this.column],\r\n                        visibleState: dragItem?.visibleState,\r\n                        pivotState: dragItem?.pivotState,\r\n                        eventType: 'toolPanelUi',\r\n                    });\r\n                }\r\n            },\r\n            onGridExit: () => {\r\n                if (hideColumnOnExit) {\r\n                    // when dragged outside of the grid, mimic what happens when checkbox is disabled\r\n                    // this handles the behaviour for pivot which is different to just hiding a column.\r\n                    this.onChangeCommon(false);\r\n                }\r\n            },\r\n        };\r\n\r\n        dragAndDrop!.addDragSource(dragSource, true);\r\n        this.addDestroyFunc(() => dragAndDrop!.removeDragSource(dragSource));\r\n    }\r\n\r\n    private createDragItem() {\r\n        const colId = this.column.getColId();\r\n        const visibleState = { [colId]: this.column.isVisible() };\r\n        const pivotState = { [colId]: createPivotState(this.column) };\r\n        return {\r\n            columns: [this.column],\r\n            visibleState,\r\n            pivotState,\r\n        };\r\n    }\r\n\r\n    private onColumnStateChanged(): void {\r\n        this.processingColumnStateChange = true;\r\n        const isPivotMode = this.beans.colModel.isPivotMode();\r\n        if (isPivotMode) {\r\n            // if reducing, checkbox means column is one of pivot, value or group\r\n            const anyFunctionActive = this.column.isAnyFunctionActive();\r\n            this.cbSelect.setValue(anyFunctionActive);\r\n        } else {\r\n            // if not reducing, the checkbox tells us if column is visible or not\r\n            this.cbSelect.setValue(this.column.isVisible());\r\n        }\r\n\r\n        let canBeToggled = true;\r\n        let canBeDragged = true;\r\n        if (isPivotMode) {\r\n            // when in pivot mode, the item should be read only if:\r\n            //  a) gui is not allowed make any changes\r\n            const functionsReadOnly = this.gos.get('functionsReadOnly');\r\n            //  b) column is not allow any functions on it\r\n            const noFunctionsAllowed = !this.column.isAnyFunctionAllowed();\r\n            canBeToggled = !functionsReadOnly && !noFunctionsAllowed;\r\n            canBeDragged = canBeToggled;\r\n        } else {\r\n            const { enableRowGroup, enableValue, lockPosition, suppressMovable, lockVisible } = this.column.getColDef();\r\n            const forceDraggable = !!enableRowGroup || !!enableValue;\r\n            const disableDraggable = !!lockPosition || !!suppressMovable;\r\n            canBeToggled = !lockVisible;\r\n            canBeDragged = forceDraggable || !disableDraggable;\r\n        }\r\n\r\n        this.cbSelect.setReadOnly(!canBeToggled);\r\n        this.eDragHandle.classList.toggle('ag-column-select-column-readonly', !canBeDragged);\r\n        this.addOrRemoveCssClass('ag-column-select-column-readonly', !canBeDragged && !canBeToggled);\r\n\r\n        this.cbSelect.setPassive(false);\r\n\r\n        this.processingColumnStateChange = false;\r\n    }\r\n\r\n    public getDisplayName(): string | null {\r\n        return this.displayName;\r\n    }\r\n\r\n    public onSelectAllChanged(value: boolean): void {\r\n        const cbSelect = this.cbSelect;\r\n        if (value !== cbSelect.getValue()) {\r\n            if (!cbSelect.isReadOnly()) {\r\n                cbSelect.toggle();\r\n            }\r\n        }\r\n    }\r\n\r\n    public isSelected(): boolean | undefined {\r\n        return this.cbSelect.getValue();\r\n    }\r\n\r\n    public isSelectable(): boolean {\r\n        return !this.cbSelect.isReadOnly();\r\n    }\r\n\r\n    public isExpandable(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public setExpanded(_value: boolean): void {\r\n        _warn(158);\r\n    }\r\n}\r\n", "export const columnToolPanelCSS = /*css*/ `.ag-column-panel{display:flex;flex:1 1 auto;flex-direction:column;overflow:hidden}.ag-pivot-mode-panel{display:flex;height:var(--ag-header-height)}.ag-pivot-mode-select{align-items:center;display:flex}:where(.ag-ltr) .ag-pivot-mode-select{margin-left:var(--ag-widget-container-horizontal-padding)}:where(.ag-rtl) .ag-pivot-mode-select{margin-right:var(--ag-widget-container-horizontal-padding)}.ag-column-panel-column-select{border-bottom:var(--ag-tool-panel-separator-border)}.ag-column-panel-column-select:where(:nth-child(n+2 of :not(.ag-hidden))){border-top:var(--ag-tool-panel-separator-border)}:where(.ag-column-panel) .ag-column-drop-vertical{flex:1 1 0px;min-height:50px;&:where(:not(.ag-last-column-drop)){border-bottom:var(--ag-tool-panel-separator-border)}}`;\n", "import type { BeanName, Component, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\nimport { PivotDropZonePanel } from '../rowGrouping/columnDropZones/pivotDropZonePanel';\r\nimport { RowGroupDropZonePanel } from '../rowGrouping/columnDropZones/rowGroupDropZonePanel';\r\nimport { ValuesDropZonePanel } from '../rowGrouping/columnDropZones/valueDropZonePanel';\r\nimport { PivotModePanel } from './pivotModePanel';\r\n\r\nexport class ColumnToolPanelFactory extends BeanStub implements NamedBean {\r\n    beanName: BeanName = 'colToolPanelFactory';\r\n\r\n    public setPanelVisible<C extends RowGroupDropZonePanel | ValuesDropZonePanel | PivotDropZonePanel | PivotModePanel>(\r\n        existingPanel: C | undefined,\r\n        visible: boolean,\r\n        createFunc: () => C\r\n    ): C | undefined {\r\n        if (existingPanel) {\r\n            existingPanel.setDisplayed(visible);\r\n        } else if (visible) {\r\n            existingPanel = createFunc();\r\n        }\r\n        return existingPanel;\r\n    }\r\n\r\n    public createRowGroupPanel(parent: Component, destroyFuncs: (() => void)[]): RowGroupDropZonePanel {\r\n        return this.createPanel(parent, destroyFuncs, new RowGroupDropZonePanel(false));\r\n    }\r\n\r\n    public createValuesPanel(parent: Component, destroyFuncs: (() => void)[]): ValuesDropZonePanel {\r\n        return this.createPanel(parent, destroyFuncs, new ValuesDropZonePanel(false));\r\n    }\r\n\r\n    public createPivotPanel(parent: Component, destroyFuncs: (() => void)[]): PivotDropZonePanel {\r\n        return this.createPanel(parent, destroyFuncs, new PivotDropZonePanel(false));\r\n    }\r\n\r\n    public createPivotModePanel(parent: Component, destroyFuncs: (() => void)[], prepend?: boolean): PivotModePanel {\r\n        return this.createPanel(parent, destroyFuncs, new PivotModePanel(), prepend);\r\n    }\r\n\r\n    private createPanel<C extends RowGroupDropZonePanel | ValuesDropZonePanel | PivotDropZonePanel | PivotModePanel>(\r\n        parent: Component,\r\n        destroyFuncs: (() => void)[],\r\n        panel: C,\r\n        prepend?: boolean\r\n    ): C {\r\n        panel = parent.createBean(panel);\r\n        destroyFuncs.push(() => parent.destroyBean(panel));\r\n        if (prepend) {\r\n            parent.prependChild(panel);\r\n        } else {\r\n            parent.appendChild(panel);\r\n        }\r\n        return panel;\r\n    }\r\n}\r\n", "import type { AgColumn, DragAndDropIcon, DraggingEvent } from 'ag-grid-community';\r\nimport { _createIconNoSpan } from 'ag-grid-community';\r\n\r\nimport { BaseDropZonePanel } from './baseDropZonePanel';\r\n\r\nexport class PivotDropZonePanel extends BaseDropZonePanel {\r\n    constructor(horizontal: boolean) {\r\n        super(horizontal, 'pivot');\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const emptyMessage = localeTextFunc('pivotColumnsEmptyMessage', 'Drag here to set column labels');\r\n        const title = localeTextFunc('pivots', 'Column Labels');\r\n\r\n        super.init({\r\n            icon: _createIconNoSpan('pivotPanel', this.beans, null)!,\r\n            emptyMessage: emptyMessage,\r\n            title: title,\r\n        });\r\n\r\n        this.addManagedEventListeners({\r\n            newColumnsLoaded: this.refresh.bind(this),\r\n            columnPivotChanged: this.refresh.bind(this),\r\n            columnPivotModeChanged: this.checkVisibility.bind(this),\r\n        });\r\n\r\n        this.refresh();\r\n    }\r\n\r\n    protected getAriaLabel(): string {\r\n        const translate = this.getLocaleTextFunc();\r\n        const label = translate('ariaPivotDropZonePanelLabel', 'Column Labels');\r\n\r\n        return label;\r\n    }\r\n\r\n    private refresh(): void {\r\n        this.checkVisibility();\r\n        this.refreshGui();\r\n    }\r\n\r\n    private checkVisibility(): void {\r\n        const colModel = this.beans.colModel;\r\n        const pivotMode = colModel.isPivotMode();\r\n\r\n        if (this.horizontal) {\r\n            // what we do for horizontal (ie the pivot panel at the top) depends\r\n            // on the user property as well as pivotMode.\r\n            switch (this.gos.get('pivotPanelShow')) {\r\n                case 'always':\r\n                    this.setDisplayed(pivotMode);\r\n                    break;\r\n                case 'onlyWhenPivoting': {\r\n                    const pivotActive = colModel.isPivotActive();\r\n                    this.setDisplayed(pivotMode && pivotActive);\r\n                    break;\r\n                }\r\n                default:\r\n                    // never show it\r\n                    this.setDisplayed(false);\r\n                    break;\r\n            }\r\n        } else {\r\n            // in toolPanel, the pivot panel is always shown when pivot mode is on\r\n            this.setDisplayed(pivotMode);\r\n        }\r\n    }\r\n\r\n    protected isItemDroppable(column: AgColumn, draggingEvent: DraggingEvent): boolean {\r\n        // we never allow grouping of secondary columns\r\n        if (this.gos.get('functionsReadOnly') || !column.isPrimary()) {\r\n            return false;\r\n        }\r\n\r\n        return column.isAllowPivot() && (!column.isPivotActive() || this.isSourceEventFromTarget(draggingEvent));\r\n    }\r\n\r\n    protected updateItems(columns: AgColumn[]): void {\r\n        this.beans.pivotColsSvc?.setColumns(columns, 'toolPanelUi');\r\n    }\r\n\r\n    protected getIconName(): DragAndDropIcon {\r\n        return this.isPotentialDndItems() ? 'pivot' : 'notAllowed';\r\n    }\r\n\r\n    protected getExistingItems(): AgColumn[] {\r\n        return this.beans.pivotColsSvc?.columns ?? [];\r\n    }\r\n}\r\n", "import type { AgColumn, ColumnEventType, DragItem, DraggingEvent, DropTarget } from 'ag-grid-community';\r\nimport { DragSourceType, _shouldUpdateColVisibilityAfterGroup } from 'ag-grid-community';\r\n\r\nimport type { PillDropZonePanelParams } from '../../widgets/pillDropZonePanel';\r\nimport { PillDropZonePanel } from '../../widgets/pillDropZonePanel';\r\nimport { DropZoneColumnComp } from './dropZoneColumnComp';\r\n\r\nexport type TDropZone = 'rowGroup' | 'pivot' | 'aggregation';\r\n\r\nexport abstract class BaseDropZonePanel extends PillDropZonePanel<DropZoneColumnComp, AgColumn> {\r\n    constructor(\r\n        horizontal: boolean,\r\n        private dropZonePurpose: TDropZone\r\n    ) {\r\n        super(horizontal);\r\n        this.addElementClasses(this.getGui(), this.dropZonePurpose.toLowerCase());\r\n    }\r\n\r\n    public override init(params: PillDropZonePanelParams): void {\r\n        super.init(params);\r\n\r\n        this.addManagedEventListeners({ newColumnsLoaded: this.refreshGui.bind(this) });\r\n\r\n        this.addManagedPropertyListeners(\r\n            ['functionsReadOnly', 'rowGroupPanelSuppressSort', 'groupLockGroupColumns'],\r\n            this.refreshGui.bind(this)\r\n        );\r\n    }\r\n\r\n    protected getItems(dragItem: DragItem): AgColumn[] {\r\n        return (dragItem.columns as AgColumn[]) ?? [];\r\n    }\r\n\r\n    protected isInterestedIn(type: DragSourceType): boolean {\r\n        // not interested in row drags\r\n        return type === DragSourceType.HeaderCell || type === DragSourceType.ToolPanel;\r\n    }\r\n\r\n    protected override minimumAllowedNewInsertIndex(): number {\r\n        const { gos, rowGroupColsSvc } = this.beans;\r\n        const numberOfLockedCols = gos.get('groupLockGroupColumns');\r\n        const numberOfGroupCols = rowGroupColsSvc?.columns.length ?? 0;\r\n        if (numberOfLockedCols === -1) {\r\n            return numberOfGroupCols;\r\n        }\r\n        return Math.min(numberOfLockedCols, numberOfGroupCols);\r\n    }\r\n\r\n    private showOrHideColumnOnExit(draggingEvent: DraggingEvent): boolean {\r\n        return (\r\n            this.isRowGroupPanel() && _shouldUpdateColVisibilityAfterGroup(this.gos, true) && !draggingEvent.fromNudge\r\n        );\r\n    }\r\n\r\n    protected override handleDragEnterEnd(draggingEvent: DraggingEvent): void {\r\n        const hideColumnOnExit = this.showOrHideColumnOnExit(draggingEvent);\r\n\r\n        if (hideColumnOnExit) {\r\n            const dragItem = draggingEvent.dragSource.getDragItem();\r\n            const columns = dragItem.columns as AgColumn[];\r\n            this.setColumnsVisible(columns, false, 'uiColumnDragged');\r\n        }\r\n    }\r\n\r\n    protected override handleDragLeaveEnd(draggingEvent: DraggingEvent): void {\r\n        const showColumnOnExit = this.showOrHideColumnOnExit(draggingEvent);\r\n\r\n        if (showColumnOnExit) {\r\n            const dragItem = draggingEvent.dragSource.getDragItem();\r\n\r\n            this.setColumnsVisible(dragItem.columns as AgColumn[], true, 'uiColumnDragged');\r\n        }\r\n    }\r\n\r\n    public setColumnsVisible(columns: AgColumn[] | null | undefined, visible: boolean, source: ColumnEventType) {\r\n        if (columns) {\r\n            const allowedCols = columns.filter((c) => !c.getColDef().lockVisible);\r\n            this.beans.colModel.setColsVisible(allowedCols, visible, source);\r\n        }\r\n    }\r\n\r\n    private isRowGroupPanel() {\r\n        return this.dropZonePurpose === 'rowGroup';\r\n    }\r\n\r\n    protected createPillComponent(\r\n        column: AgColumn,\r\n        dropTarget: DropTarget,\r\n        ghost: boolean,\r\n        horizontal: boolean\r\n    ): DropZoneColumnComp {\r\n        return new DropZoneColumnComp(column, dropTarget, ghost, this.dropZonePurpose, horizontal);\r\n    }\r\n}\r\n", "import type { DragAndDropIcon, DragItem, DragSourceType, DraggingEvent, DropTarget } from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    KeyCode,\r\n    ManagedFocusFeature,\r\n    PositionableFeature,\r\n    _areEqual,\r\n    _clearElement,\r\n    _createIconNoSpan,\r\n    _findFocusableElements,\r\n    _findNextFocusableElement,\r\n    _getActiveDomElement,\r\n    _isKeyboardMode,\r\n    _last,\r\n    _setAriaHidden,\r\n    _setAriaLabel,\r\n    _setAriaPosInSet,\r\n    _setAriaRole,\r\n    _setAriaSetSize,\r\n} from 'ag-grid-community';\r\n\r\nimport type { PillDragComp } from './pillDragComp';\r\nimport { pillDropZonePanelCSS } from './pillDropZonePanel.css-GENERATED';\r\n\r\nexport interface PillDropZonePanelParams {\r\n    emptyMessage?: string;\r\n    title?: string;\r\n    icon?: Element;\r\n}\r\n\r\ntype PillState = 'notDragging' | 'newItemsIn' | 'rearrangeItems';\r\n\r\nfunction _insertArrayIntoArray<T>(dest: T[], src: T[], toIndex: number) {\r\n    if (dest == null || src == null) {\r\n        return;\r\n    }\r\n\r\n    dest.splice(toIndex, 0, ...src);\r\n}\r\n\r\nexport abstract class PillDropZonePanel<TPill extends PillDragComp<TItem>, TItem> extends Component {\r\n    private state: PillState = 'notDragging';\r\n\r\n    private dropTarget: DropTarget;\r\n\r\n    // when we are considering a drop from a dnd event,\r\n    // the items to be dropped go in here\r\n    private potentialDndItems: TItem[];\r\n\r\n    private guiDestroyFunctions: (() => void)[] = [];\r\n\r\n    private params: PillDropZonePanelParams;\r\n\r\n    private childPillComponents: TPill[] = [];\r\n    private insertIndex: number;\r\n\r\n    // when this component is refreshed, we rip out all DOM elements and build it up\r\n    // again from scratch. one exception is ePillDropList, as we want to maintain the\r\n    // scroll position between the refreshes, so we create one instance of it here and\r\n    // reuse it.\r\n    private ePillDropList: HTMLElement;\r\n\r\n    private positionableFeature: PositionableFeature;\r\n    private resizeEnabled: boolean = false;\r\n\r\n    protected abstract isItemDroppable(item: TItem, draggingEvent: DraggingEvent): boolean;\r\n    protected abstract updateItems(items: TItem[]): void;\r\n    protected abstract getExistingItems(): TItem[];\r\n    protected abstract getIconName(): DragAndDropIcon;\r\n    protected abstract getAriaLabel(): string;\r\n    protected abstract createPillComponent(\r\n        item: TItem,\r\n        dropTarget: DropTarget,\r\n        ghost: boolean,\r\n        horizontal: boolean\r\n    ): TPill;\r\n    protected abstract getItems(dragItem: DragItem<TItem>): TItem[];\r\n    protected abstract isInterestedIn(type: DragSourceType): boolean;\r\n\r\n    constructor(protected readonly horizontal: boolean) {\r\n        super(/* html */ `<div class=\"ag-unselectable\" role=\"presentation\"></div>`);\r\n        this.addElementClasses(this.getGui());\r\n        this.ePillDropList = document.createElement('div');\r\n        this.addElementClasses(this.ePillDropList, 'list');\r\n        _setAriaRole(this.ePillDropList, 'listbox');\r\n        this.registerCSS(pillDropZonePanelCSS);\r\n    }\r\n\r\n    public toggleResizable(resizable: boolean) {\r\n        this.positionableFeature.setResizable(resizable ? { bottom: true } : false);\r\n        this.resizeEnabled = resizable;\r\n    }\r\n\r\n    protected isSourceEventFromTarget(draggingEvent: DraggingEvent): boolean {\r\n        const { dropZoneTarget, dragSource } = draggingEvent;\r\n        return dropZoneTarget.contains(dragSource.eElement);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyGui();\r\n        super.destroy();\r\n    }\r\n\r\n    private destroyGui(): void {\r\n        this.guiDestroyFunctions.forEach((func) => func());\r\n        this.guiDestroyFunctions.length = 0;\r\n        this.childPillComponents.length = 0;\r\n        _clearElement(this.getGui());\r\n        _clearElement(this.ePillDropList);\r\n    }\r\n\r\n    public init(params?: PillDropZonePanelParams): void {\r\n        this.params = params ?? {};\r\n\r\n        this.createManagedBean(\r\n            new ManagedFocusFeature(this.getFocusableElement(), {\r\n                onTabKeyDown: this.onTabKeyDown.bind(this),\r\n                handleKeyDown: this.onKeyDown.bind(this),\r\n            })\r\n        );\r\n\r\n        this.setupDropTarget();\r\n\r\n        this.positionableFeature = new PositionableFeature(this.getGui());\r\n        this.createManagedBean(this.positionableFeature);\r\n\r\n        this.refreshGui();\r\n        _setAriaLabel(this.ePillDropList, this.getAriaLabel());\r\n    }\r\n\r\n    private onTabKeyDown(e: KeyboardEvent): void {\r\n        const focusableElements = _findFocusableElements(this.getFocusableElement(), null, true);\r\n        const len = focusableElements.length;\r\n\r\n        if (len === 0) {\r\n            return;\r\n        }\r\n\r\n        const { shiftKey } = e;\r\n        const activeEl = _getActiveDomElement(this.beans);\r\n\r\n        const isFirstFocused = activeEl === focusableElements[0];\r\n        const isLastFocused = activeEl === _last(focusableElements);\r\n        const shouldAllowDefaultTab = len === 1 || (isFirstFocused && shiftKey) || (isLastFocused && !shiftKey);\r\n\r\n        if (!shouldAllowDefaultTab) {\r\n            focusableElements[shiftKey ? 0 : len - 1].focus();\r\n        }\r\n    }\r\n\r\n    private onKeyDown(e: KeyboardEvent) {\r\n        const { key } = e;\r\n        const isVertical = !this.horizontal;\r\n\r\n        let isNext = key === KeyCode.DOWN;\r\n        let isPrevious = key === KeyCode.UP;\r\n\r\n        if (!isVertical) {\r\n            const isRtl = this.gos.get('enableRtl');\r\n            isNext = (!isRtl && key === KeyCode.RIGHT) || (isRtl && key === KeyCode.LEFT);\r\n            isPrevious = (!isRtl && key === KeyCode.LEFT) || (isRtl && key === KeyCode.RIGHT);\r\n        }\r\n\r\n        if (!isNext && !isPrevious) {\r\n            return;\r\n        }\r\n\r\n        const el = _findNextFocusableElement(this.beans, this.getFocusableElement(), false, isPrevious);\r\n\r\n        if (el) {\r\n            e.preventDefault();\r\n            el.focus();\r\n        }\r\n    }\r\n\r\n    protected addElementClasses(el: Element, suffix?: string) {\r\n        suffix = suffix ? `-${suffix}` : '';\r\n        const direction = this.horizontal ? 'horizontal' : 'vertical';\r\n        el.classList.add(`ag-column-drop${suffix}`, `ag-column-drop-${direction}${suffix}`);\r\n    }\r\n\r\n    private setupDropTarget(): void {\r\n        this.dropTarget = {\r\n            getContainer: this.getGui.bind(this),\r\n            getIconName: this.getIconName.bind(this),\r\n            onDragging: this.onDragging.bind(this),\r\n            onDragEnter: this.onDragEnter.bind(this),\r\n            onDragLeave: this.onDragLeave.bind(this),\r\n            onDragStop: this.onDragStop.bind(this),\r\n            onDragCancel: this.onDragCancel.bind(this),\r\n            isInterestedIn: this.isInterestedIn.bind(this),\r\n        };\r\n\r\n        this.beans.dragAndDrop?.addDropTarget(this.dropTarget);\r\n    }\r\n\r\n    protected minimumAllowedNewInsertIndex(): number {\r\n        return 0;\r\n    }\r\n\r\n    private checkInsertIndex(draggingEvent: DraggingEvent): boolean {\r\n        const newIndex = this.getNewInsertIndex(draggingEvent);\r\n\r\n        // <0 happens when drag is no a direction we are interested in, eg drag is up/down but in horizontal panel\r\n        if (newIndex < 0) {\r\n            return false;\r\n        }\r\n\r\n        const minimumAllowedIndex = this.minimumAllowedNewInsertIndex();\r\n        const newAdjustedIndex = Math.max(minimumAllowedIndex, newIndex);\r\n\r\n        const changed = newAdjustedIndex !== this.insertIndex;\r\n\r\n        if (changed) {\r\n            this.insertIndex = newAdjustedIndex;\r\n        }\r\n\r\n        return changed;\r\n    }\r\n\r\n    private getNewInsertIndex(draggingEvent: DraggingEvent): number {\r\n        const mouseEvent = draggingEvent.event;\r\n        const mouseLocation = this.horizontal ? mouseEvent.clientX : mouseEvent.clientY;\r\n\r\n        const boundsList = this.childPillComponents.map((comp) => comp.getGui().getBoundingClientRect());\r\n        // find the non-ghost component we're hovering\r\n        const hoveredIndex = boundsList.findIndex((rect) =>\r\n            this.horizontal\r\n                ? rect.right > mouseLocation && rect.left < mouseLocation\r\n                : rect.top < mouseLocation && rect.bottom > mouseLocation\r\n        );\r\n\r\n        // not hovering a non-ghost component\r\n        if (hoveredIndex === -1) {\r\n            const enableRtl = this.gos.get('enableRtl');\r\n\r\n            // if mouse is below or right of all components then new index should be placed last\r\n            const isLast = boundsList.every((rect) => mouseLocation > (this.horizontal ? rect.right : rect.bottom));\r\n\r\n            if (isLast) {\r\n                return enableRtl && this.horizontal ? 0 : this.childPillComponents.length;\r\n            }\r\n\r\n            // if mouse is above or left of all components, new index is first\r\n            const isFirst = boundsList.every((rect) => mouseLocation < (this.horizontal ? rect.left : rect.top));\r\n\r\n            if (isFirst) {\r\n                return enableRtl && this.horizontal ? this.childPillComponents.length : 0;\r\n            }\r\n\r\n            // must be hovering a ghost, don't change the index\r\n            return this.insertIndex;\r\n        }\r\n\r\n        // if the old index is equal to or less than the index of our new target\r\n        // we need to shift right, to insert after rather than before\r\n        if (this.insertIndex <= hoveredIndex) {\r\n            return hoveredIndex + 1;\r\n        }\r\n        return hoveredIndex;\r\n    }\r\n\r\n    private checkDragStartedBySelf(draggingEvent: DraggingEvent): void {\r\n        if (this.state !== 'notDragging') {\r\n            return;\r\n        }\r\n\r\n        this.state = 'rearrangeItems';\r\n\r\n        this.potentialDndItems = this.getItems(draggingEvent.dragSource.getDragItem());\r\n        this.refreshGui();\r\n\r\n        this.checkInsertIndex(draggingEvent);\r\n        this.refreshGui();\r\n    }\r\n\r\n    private onDragging(draggingEvent: DraggingEvent): void {\r\n        this.checkDragStartedBySelf(draggingEvent);\r\n\r\n        if (this.checkInsertIndex(draggingEvent)) {\r\n            this.refreshGui();\r\n        }\r\n    }\r\n\r\n    protected handleDragEnterEnd(_: DraggingEvent): void {}\r\n\r\n    private onDragEnter(draggingEvent: DraggingEvent): void {\r\n        // this will contain all items that are potential drops\r\n        const dragItems = this.getItems(draggingEvent.dragSource.getDragItem());\r\n        this.state = 'newItemsIn';\r\n        // take out items that are not droppable\r\n        const goodDragItems = dragItems.filter((item) => this.isItemDroppable(item, draggingEvent));\r\n        const alreadyPresent = goodDragItems.every(\r\n            (item) => this.childPillComponents.map((cmp) => cmp.getItem()).indexOf(item) !== -1\r\n        );\r\n\r\n        if (goodDragItems.length === 0) {\r\n            return;\r\n        }\r\n\r\n        this.potentialDndItems = goodDragItems;\r\n\r\n        if (alreadyPresent) {\r\n            this.state = 'notDragging';\r\n            return;\r\n        }\r\n\r\n        this.handleDragEnterEnd(draggingEvent);\r\n\r\n        this.checkInsertIndex(draggingEvent);\r\n        this.refreshGui();\r\n    }\r\n\r\n    protected isPotentialDndItems(): boolean {\r\n        return !!this.potentialDndItems?.length;\r\n    }\r\n\r\n    protected handleDragLeaveEnd(_: DraggingEvent): void {}\r\n\r\n    private onDragLeave(draggingEvent: DraggingEvent): void {\r\n        // if the dragging started from us, we remove the group, however if it started\r\n        // some place else, then we don't, as it was only 'asking'\r\n\r\n        if (this.state === 'rearrangeItems') {\r\n            const items = this.getItems(draggingEvent.dragSource.getDragItem());\r\n            this.removeItems(items);\r\n        }\r\n\r\n        if (this.isPotentialDndItems()) {\r\n            this.handleDragLeaveEnd(draggingEvent);\r\n\r\n            this.potentialDndItems = [];\r\n            this.refreshGui();\r\n        }\r\n\r\n        this.state = 'notDragging';\r\n    }\r\n\r\n    private onDragCancel(draggingEvent: DraggingEvent): void {\r\n        if (this.isPotentialDndItems()) {\r\n            if (this.state === 'newItemsIn') {\r\n                this.handleDragLeaveEnd(draggingEvent);\r\n            }\r\n\r\n            this.potentialDndItems = [];\r\n            this.refreshGui();\r\n        }\r\n\r\n        this.state = 'notDragging';\r\n    }\r\n\r\n    private onDragStop(): void {\r\n        if (this.isPotentialDndItems()) {\r\n            if (this.state === 'newItemsIn') {\r\n                this.addItems(this.potentialDndItems);\r\n            } else {\r\n                this.rearrangeItems(this.potentialDndItems);\r\n            }\r\n\r\n            this.potentialDndItems = [];\r\n            this.refreshGui();\r\n        }\r\n\r\n        this.state = 'notDragging';\r\n    }\r\n\r\n    private removeItems(itemsToRemove: TItem[]): void {\r\n        const newItemList = this.getExistingItems().filter((item) => !itemsToRemove.includes(item));\r\n        this.updateItems(newItemList);\r\n    }\r\n\r\n    private addItems(itemsToAdd: TItem[]): void {\r\n        if (!itemsToAdd) {\r\n            return;\r\n        }\r\n        const newItemList = this.getExistingItems().slice();\r\n        const itemsToAddNoDuplicates = itemsToAdd.filter((item) => newItemList.indexOf(item) < 0);\r\n        _insertArrayIntoArray(newItemList, itemsToAddNoDuplicates, this.insertIndex);\r\n        this.updateItems(newItemList);\r\n    }\r\n\r\n    public addItem(item: TItem): void {\r\n        this.insertIndex = this.getExistingItems().length;\r\n        this.addItems([item]);\r\n        this.refreshGui();\r\n    }\r\n\r\n    private rearrangeItems(itemsToAdd: TItem[]): boolean {\r\n        const newItemList = this.getNonGhostItems().slice();\r\n        _insertArrayIntoArray(newItemList, itemsToAdd, this.insertIndex);\r\n\r\n        if (_areEqual(newItemList, this.getExistingItems())) {\r\n            return false;\r\n        }\r\n\r\n        this.updateItems(newItemList);\r\n        return true;\r\n    }\r\n\r\n    public refreshGui(): void {\r\n        // we reset the scroll position after the refresh.\r\n        // if we don't do this, then the list will always scroll to the top\r\n        // each time we refresh it. this is because part of the refresh empties\r\n        // out the list which sets scroll to zero. so the user could be just\r\n        // reordering the list - we want to prevent the resetting of the scroll.\r\n        // this is relevant for vertical display only (as horizontal has no scroll)\r\n        const scrollTop = this.ePillDropList.scrollTop;\r\n        const resizeEnabled = this.resizeEnabled;\r\n        const focusedIndex = this.getFocusedItem();\r\n\r\n        const { eGridDiv } = this.beans;\r\n        let alternateElement = _findNextFocusableElement(this.beans, eGridDiv);\r\n\r\n        if (!alternateElement) {\r\n            alternateElement = _findNextFocusableElement(this.beans, eGridDiv, false, true);\r\n        }\r\n\r\n        this.toggleResizable(false);\r\n        this.destroyGui();\r\n\r\n        this.addIconAndTitleToGui();\r\n        this.addEmptyMessageToGui();\r\n        this.addItemsToGui();\r\n\r\n        if (!this.horizontal) {\r\n            this.ePillDropList.scrollTop = scrollTop;\r\n        }\r\n\r\n        if (resizeEnabled) {\r\n            this.toggleResizable(resizeEnabled);\r\n        }\r\n\r\n        // focus should only be restored when keyboard mode\r\n        // otherwise mouse clicks will cause containers to scroll\r\n        // without no apparent reason.\r\n        if (_isKeyboardMode()) {\r\n            this.restoreFocus(focusedIndex, alternateElement!);\r\n        }\r\n    }\r\n\r\n    private getFocusedItem(): number {\r\n        const eGui = this.getGui();\r\n        const activeElement = _getActiveDomElement(this.beans);\r\n\r\n        if (!eGui.contains(activeElement)) {\r\n            return -1;\r\n        }\r\n\r\n        const items = Array.from(eGui.querySelectorAll('.ag-column-drop-cell'));\r\n\r\n        return items.indexOf(activeElement as HTMLElement);\r\n    }\r\n\r\n    private restoreFocus(index: number, alternateElement: HTMLElement): void {\r\n        const eGui = this.getGui();\r\n        const items = Array.from(eGui.querySelectorAll('.ag-column-drop-cell'));\r\n\r\n        if (index === -1) {\r\n            return;\r\n        }\r\n\r\n        if (items.length === 0) {\r\n            alternateElement.focus();\r\n        }\r\n\r\n        const indexToFocus = Math.min(items.length - 1, index);\r\n        const el = items[indexToFocus] as HTMLElement;\r\n\r\n        if (el) {\r\n            el.focus();\r\n        }\r\n    }\r\n\r\n    public focusList(fromBottom?: boolean): void {\r\n        const index = fromBottom ? this.childPillComponents.length - 1 : 0;\r\n        this.restoreFocus(index, this.getFocusableElement());\r\n    }\r\n\r\n    private getNonGhostItems(): TItem[] {\r\n        const existingItems = this.getExistingItems();\r\n\r\n        if (this.isPotentialDndItems()) {\r\n            return existingItems.filter((item) => !this.potentialDndItems.includes(item));\r\n        }\r\n        return existingItems;\r\n    }\r\n\r\n    private addItemsToGui(): void {\r\n        const nonGhostItems = this.getNonGhostItems();\r\n        const itemsToAddToGui: TPill[] = nonGhostItems.map((item) => this.createItemComponent(item, false));\r\n\r\n        if (this.isPotentialDndItems()) {\r\n            const dndItems = this.potentialDndItems.map((item) => this.createItemComponent(item, true));\r\n            if (this.insertIndex >= itemsToAddToGui.length) {\r\n                itemsToAddToGui.push(...dndItems);\r\n            } else {\r\n                itemsToAddToGui.splice(this.insertIndex, 0, ...dndItems);\r\n            }\r\n        }\r\n\r\n        this.appendChild(this.ePillDropList);\r\n\r\n        itemsToAddToGui.forEach((itemComponent, index) => {\r\n            if (index > 0) {\r\n                this.addArrow(this.ePillDropList);\r\n            }\r\n\r\n            this.ePillDropList.appendChild(itemComponent.getGui());\r\n        });\r\n\r\n        this.addAriaLabelsToComponents();\r\n    }\r\n\r\n    private addAriaLabelsToComponents(): void {\r\n        this.childPillComponents.forEach((comp, idx) => {\r\n            const eGui = comp.getGui();\r\n            _setAriaPosInSet(eGui, idx + 1);\r\n            _setAriaSetSize(eGui, this.childPillComponents.length);\r\n        });\r\n    }\r\n\r\n    private createItemComponent(item: TItem, ghost: boolean): TPill {\r\n        const itemComponent = this.createPillComponent(item, this.dropTarget, ghost, this.horizontal);\r\n        itemComponent.addEventListener('columnRemove', this.removeItems.bind(this, [item]));\r\n\r\n        this.createBean(itemComponent);\r\n        this.guiDestroyFunctions.push(() => this.destroyBean(itemComponent));\r\n\r\n        if (!ghost) {\r\n            this.childPillComponents.push(itemComponent);\r\n        }\r\n\r\n        return itemComponent;\r\n    }\r\n\r\n    private addIconAndTitleToGui(): void {\r\n        const { title, icon: eGroupIcon } = this.params;\r\n        if (!title || !eGroupIcon) {\r\n            return;\r\n        }\r\n        const eTitleBar = document.createElement('div');\r\n        _setAriaHidden(eTitleBar, true);\r\n        this.addElementClasses(eTitleBar, 'title-bar');\r\n        this.addElementClasses(eGroupIcon, 'icon');\r\n        this.addOrRemoveCssClass('ag-column-drop-empty', this.isExistingItemsEmpty());\r\n\r\n        eTitleBar.appendChild(eGroupIcon);\r\n\r\n        if (!this.horizontal) {\r\n            const eTitle = document.createElement('span');\r\n            this.addElementClasses(eTitle, 'title');\r\n            eTitle.innerHTML = title;\r\n\r\n            eTitleBar.appendChild(eTitle);\r\n        }\r\n\r\n        this.appendChild(eTitleBar);\r\n    }\r\n\r\n    private isExistingItemsEmpty(): boolean {\r\n        return this.getExistingItems().length === 0;\r\n    }\r\n\r\n    private addEmptyMessageToGui(): void {\r\n        const { emptyMessage } = this.params;\r\n        if (!emptyMessage || !this.isExistingItemsEmpty() || this.isPotentialDndItems()) {\r\n            return;\r\n        }\r\n\r\n        const eMessage = document.createElement('span');\r\n        eMessage.innerHTML = emptyMessage;\r\n        this.addElementClasses(eMessage, 'empty-message');\r\n        this.ePillDropList.appendChild(eMessage);\r\n    }\r\n\r\n    private addArrow(eParent: HTMLElement): void {\r\n        // only add the arrows if the layout is horizontal\r\n        if (this.horizontal) {\r\n            // for RTL it's a left arrow, otherwise it's a right arrow\r\n            const enableRtl = this.gos.get('enableRtl');\r\n            const icon = _createIconNoSpan(enableRtl ? 'panelDelimiterRtl' : 'panelDelimiter', this.beans)!;\r\n            this.addElementClasses(icon, 'cell-separator');\r\n            eParent.appendChild(icon);\r\n        }\r\n    }\r\n}\r\n", "export const pillDropZonePanelCSS = /*css*/ `.ag-column-drop{align-items:center;display:inline-flex;overflow:auto;position:relative;width:100%}.ag-column-drop-list{align-items:center;display:flex}.ag-column-drop-cell{align-items:center;background-color:var(--ag-column-drop-cell-background-color);border:var(--ag-column-drop-cell-border);border-radius:500px;color:var(--ag-column-drop-cell-text-color);display:flex;padding:calc(var(--ag-spacing)*.25);position:relative;&:focus-visible{box-shadow:var(--ag-focus-shadow)}:where(.ag-drag-handle){color:var(--ag-column-drop-cell-drag-handle-color)}}:where(.ag-ltr) .ag-column-drop-cell{padding-left:calc(var(--ag-spacing)*.75)}:where(.ag-rtl) .ag-column-drop-cell{padding-right:calc(var(--ag-spacing)*.75)}.ag-column-drop-cell-text{flex:1 1 auto;margin:0 var(--ag-spacing);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ag-column-drop-vertical{align-items:stretch;display:flex;flex-direction:column;min-height:75px;overflow:hidden}.ag-column-drop-vertical-title-bar{align-items:center;display:flex;flex:none;padding:var(--ag-widget-container-vertical-padding) calc(var(--ag-spacing)*2) 0}.ag-column-drop-vertical-list{align-items:stretch;flex-direction:column;flex-grow:1;overflow-x:auto;padding-bottom:var(--ag-spacing);padding-left:var(--ag-spacing);padding-right:var(--ag-spacing);position:relative;>*{flex:none}}:where(.ag-column-drop-empty) .ag-column-drop-vertical-list{overflow:hidden}.ag-column-drop-vertical-empty-message{align-items:center;border:1px dashed;border-color:var(--ag-border-color);display:flex;inset:0;justify-content:center;margin:calc(var(--ag-spacing)*1.5) calc(var(--ag-spacing)*2);overflow:hidden;padding:calc(var(--ag-spacing)*2);position:absolute}.ag-column-drop-cell-button{cursor:pointer;min-width:0;opacity:.75;&:hover{opacity:1}}.ag-column-drop-wrapper{display:flex}.ag-column-drop-horizontal-half-width{width:50%!important}.ag-column-drop-cell-ghost{opacity:.5}.ag-column-drop-horizontal{background-color:var(--ag-header-background-color);border-bottom:var(--ag-header-row-border);gap:var(--ag-cell-widget-spacing);height:var(--ag-header-height);overflow:hidden;white-space:nowrap}:where(.ag-ltr) .ag-column-drop-horizontal{padding-left:var(--ag-cell-horizontal-padding)}:where(.ag-rtl) .ag-column-drop-horizontal{padding-right:var(--ag-cell-horizontal-padding)}.ag-column-drop-horizontal-list{gap:var(--ag-cell-widget-spacing)}.ag-column-drop-vertical-cell{margin-top:var(--ag-spacing)}:where(.ag-ltr) .ag-column-drop-vertical-icon{margin-right:var(--ag-widget-horizontal-spacing)}:where(.ag-rtl) .ag-column-drop-vertical-icon{margin-left:var(--ag-widget-horizontal-spacing)}.ag-select-agg-func-popup{background:var(--ag-background-color);border:1px solid var(--ag-border-color);border-radius:var(--ag-border-radius);box-shadow:var(--ag-dropdown-shadow);height:calc(var(--ag-spacing)*5*3.5);padding:0;position:absolute}.ag-select-agg-func-virtual-list-item{cursor:default;&:hover{background-color:var(--ag-selected-row-background-color)}}:where(.ag-ltr) .ag-select-agg-func-virtual-list-item{padding-left:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-select-agg-func-virtual-list-item{padding-right:calc(var(--ag-spacing)*2)}:where(.ag-ltr) .ag-column-drop-horizontal-half-width:where(:not(:last-child)){border-right:1px solid var(--ag-border-color)}:where(.ag-rtl) .ag-column-drop-horizontal-half-width:where(:not(:last-child)){border-left:1px solid var(--ag-border-color)}`;\n", "import type { AgColumn, DragAndDropIcon, DragItem, DropTarget, SortIndicatorComp } from 'ag-grid-community';\r\nimport { Component, DragSourceType, KeyCode, RefPlaceholder, _loadTemplate } from 'ag-grid-community';\r\n\r\nimport { PillDragComp } from '../../widgets/pillDragComp';\r\nimport { VirtualList } from '../../widgets/virtualList';\r\nimport { isRowGroupColLocked } from '../rowGroupingUtils';\r\nimport type { TDropZone } from './baseDropZonePanel';\r\n\r\nexport class DropZoneColumnComp extends PillDragComp<AgColumn> {\r\n    private readonly eSortIndicator: SortIndicatorComp = RefPlaceholder;\r\n\r\n    private displayName: string | null;\r\n    private popupShowing = false;\r\n\r\n    constructor(\r\n        private column: AgColumn,\r\n        dragSourceDropTarget: DropTarget,\r\n        ghost: boolean,\r\n        private dropZonePurpose: TDropZone,\r\n        horizontal: boolean\r\n    ) {\r\n        super(dragSourceDropTarget, ghost, horizontal);\r\n    }\r\n\r\n    public override postConstruct(): void {\r\n        const { sortSvc, colNames } = this.beans;\r\n        this.template = /* html */ `\r\n            <span role=\"option\">\r\n                <span data-ref=\"eDragHandle\" class=\"ag-drag-handle ag-column-drop-cell-drag-handle\" role=\"presentation\"></span>\r\n                <span data-ref=\"eText\" class=\"ag-column-drop-cell-text\" aria-hidden=\"true\"></span>\r\n                ${sortSvc ? '<ag-sort-indicator data-ref=\"eSortIndicator\"></ag-sort-indicator>' : ''}\r\n                <span data-ref=\"eButton\" class=\"ag-column-drop-cell-button\" role=\"presentation\"></span>\r\n            </span>\r\n        `;\r\n        if (sortSvc) {\r\n            this.agComponents = [sortSvc.getSortIndicatorSelector()];\r\n        }\r\n\r\n        this.displayName = colNames.getDisplayNameForColumn(this.column, 'columnDrop');\r\n\r\n        super.postConstruct();\r\n\r\n        if (sortSvc) {\r\n            this.setupSort();\r\n\r\n            this.addManagedEventListeners({\r\n                sortChanged: () => {\r\n                    this.setupAria();\r\n                },\r\n            });\r\n        }\r\n\r\n        if (this.isGroupingZone()) {\r\n            this.addManagedPropertyListener('groupLockGroupColumns', () => {\r\n                this.refreshRemove();\r\n                this.refreshDraggable();\r\n                this.setupAria();\r\n            });\r\n        }\r\n    }\r\n\r\n    public getItem(): AgColumn {\r\n        return this.column;\r\n    }\r\n\r\n    protected getDisplayName(): string {\r\n        return this.displayName!;\r\n    }\r\n\r\n    protected getTooltip(): string | null | undefined {\r\n        return this.column.getColDef().headerTooltip;\r\n    }\r\n\r\n    protected override addAdditionalAriaInstructions(\r\n        ariaInstructions: string[],\r\n        translate: (key: string, defaultValue: string) => string\r\n    ): void {\r\n        const isSortSuppressed = this.gos.get('rowGroupPanelSuppressSort');\r\n        const isFunctionsReadOnly = this.gos.get('functionsReadOnly');\r\n        if (this.isAggregationZone() && !isFunctionsReadOnly) {\r\n            const aggregationMenuAria = translate(\r\n                'ariaDropZoneColumnValueItemDescription',\r\n                'Press ENTER to change the aggregation type'\r\n            );\r\n            ariaInstructions.push(aggregationMenuAria);\r\n        }\r\n\r\n        if (this.isGroupingZone() && this.column.isSortable() && !isSortSuppressed) {\r\n            const sortProgressAria = translate('ariaDropZoneColumnGroupItemDescription', 'Press ENTER to sort');\r\n            ariaInstructions.push(sortProgressAria);\r\n        }\r\n\r\n        super.addAdditionalAriaInstructions(ariaInstructions, translate);\r\n    }\r\n\r\n    protected override isDraggable(): boolean {\r\n        return this.isReadOnly();\r\n    }\r\n\r\n    protected override isRemovable(): boolean {\r\n        return this.isReadOnly();\r\n    }\r\n\r\n    private isReadOnly(): boolean {\r\n        return !this.isGroupingAndLocked() && !this.gos.get('functionsReadOnly');\r\n    }\r\n\r\n    protected getAriaDisplayName(): string {\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        const { name, aggFuncName } = this.getColumnAndAggFuncName();\r\n        const aggSeparator = translate('ariaDropZoneColumnComponentAggFuncSeparator', ' of ');\r\n        const sortDirection = {\r\n            asc: translate('ariaDropZoneColumnComponentSortAscending', 'ascending'),\r\n            desc: translate('ariaDropZoneColumnComponentSortDescending', 'descending'),\r\n        };\r\n        const columnSort = this.column.getSort();\r\n        const isSortSuppressed = this.gos.get('rowGroupPanelSuppressSort');\r\n        return [\r\n            aggFuncName && `${aggFuncName}${aggSeparator}`,\r\n            name,\r\n            this.isGroupingZone() && !isSortSuppressed && columnSort && `, ${sortDirection[columnSort]}`,\r\n        ]\r\n            .filter((part) => !!part)\r\n            .join('');\r\n    }\r\n\r\n    private getColumnAndAggFuncName(): { name: string; aggFuncName: string } {\r\n        const name = this.displayName as string;\r\n        let aggFuncName: string = '';\r\n\r\n        if (this.isAggregationZone()) {\r\n            const aggFunc = this.column.getAggFunc();\r\n            // if aggFunc is a string, we can use it, but if it's a function, then we swap with 'func'\r\n            const aggFuncString = typeof aggFunc === 'string' ? aggFunc : 'agg';\r\n            const localeTextFunc = this.getLocaleTextFunc();\r\n            aggFuncName = localeTextFunc(aggFuncString, aggFuncString);\r\n        }\r\n\r\n        return { name, aggFuncName };\r\n    }\r\n\r\n    private setupSort(): void {\r\n        if (!this.column.isSortable() || !this.isGroupingZone()) {\r\n            return;\r\n        }\r\n\r\n        if (!this.gos.get('rowGroupPanelSuppressSort')) {\r\n            this.eSortIndicator.setupSort(this.column, true);\r\n            const performSort = (event: MouseEvent | KeyboardEvent) => {\r\n                event.preventDefault();\r\n                this.beans.sortSvc!.progressSortFromEvent(this.column, event);\r\n            };\r\n\r\n            this.addGuiEventListener('click', performSort);\r\n            this.addGuiEventListener('keydown', (e: KeyboardEvent) => {\r\n                const isEnter = e.key === KeyCode.ENTER;\r\n                if (isEnter && this.isGroupingZone()) {\r\n                    performSort(e);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    protected override getDefaultIconName(): DragAndDropIcon {\r\n        return 'hide';\r\n    }\r\n\r\n    protected createGetDragItem(): () => DragItem {\r\n        const { column } = this;\r\n        return () => {\r\n            const visibleState: { [key: string]: boolean } = {};\r\n            visibleState[column.getId()] = column.isVisible();\r\n            return {\r\n                columns: [column],\r\n                visibleState: visibleState,\r\n            };\r\n        };\r\n    }\r\n\r\n    protected override setupComponents(): void {\r\n        super.setupComponents();\r\n\r\n        if (this.isAggregationZone() && !this.gos.get('functionsReadOnly')) {\r\n            this.addGuiEventListener('click', this.onShowAggFuncSelection.bind(this));\r\n        }\r\n    }\r\n\r\n    protected override onKeyDown(e: KeyboardEvent): void {\r\n        super.onKeyDown(e);\r\n\r\n        const isEnter = e.key === KeyCode.ENTER;\r\n        if (isEnter && this.isAggregationZone() && !this.gos.get('functionsReadOnly')) {\r\n            e.preventDefault();\r\n            this.onShowAggFuncSelection();\r\n        }\r\n    }\r\n\r\n    protected override getDisplayValue(): string {\r\n        const { name, aggFuncName } = this.getColumnAndAggFuncName();\r\n        return this.isAggregationZone() ? `${aggFuncName}(${name})` : name;\r\n    }\r\n\r\n    private onShowAggFuncSelection(): void {\r\n        if (this.popupShowing) {\r\n            return;\r\n        }\r\n\r\n        this.popupShowing = true;\r\n\r\n        const { aggFuncSvc, popupSvc } = this.beans;\r\n\r\n        const virtualList = new VirtualList({ cssIdentifier: 'select-agg-func' });\r\n        const rows = aggFuncSvc!.getFuncNames(this.column);\r\n        const eGui = this.getGui();\r\n        const virtualListGui = virtualList.getGui();\r\n\r\n        virtualList.setModel({\r\n            getRow: function (index: number) {\r\n                return rows[index];\r\n            },\r\n            getRowCount: function () {\r\n                return rows.length;\r\n            },\r\n        });\r\n\r\n        this.createBean(virtualList);\r\n\r\n        const ePopup = _loadTemplate(/* html*/ `<div class=\"ag-select-agg-func-popup\"></div>`);\r\n        ePopup.style.top = '0px';\r\n        ePopup.style.left = '0px';\r\n        ePopup.appendChild(virtualListGui);\r\n        ePopup.style.width = `${eGui.clientWidth}px`;\r\n\r\n        const [focusoutListener] = this.addManagedElementListeners(ePopup, {\r\n            focusout: (e: FocusEvent) => {\r\n                if (!ePopup.contains(e.relatedTarget as HTMLElement) && addPopupRes) {\r\n                    addPopupRes.hideFunc();\r\n                }\r\n            },\r\n        });\r\n\r\n        const popupHiddenFunc = (callbackEvent?: KeyboardEvent) => {\r\n            this.destroyBean(virtualList);\r\n            this.popupShowing = false;\r\n\r\n            if (callbackEvent?.key === 'Escape') {\r\n                eGui.focus();\r\n            }\r\n\r\n            if (focusoutListener) {\r\n                focusoutListener();\r\n            }\r\n        };\r\n\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        const addPopupRes = popupSvc!.addPopup({\r\n            modal: true,\r\n            eChild: ePopup,\r\n            closeOnEsc: true,\r\n            closedCallback: popupHiddenFunc,\r\n            ariaLabel: translate('ariaLabelAggregationFunction', 'Aggregation Function'),\r\n        });\r\n\r\n        if (addPopupRes) {\r\n            virtualList.setComponentCreator(this.createAggSelect.bind(this, addPopupRes.hideFunc));\r\n        }\r\n\r\n        virtualList.addGuiEventListener('keydown', (e: KeyboardEvent) => {\r\n            if (e.key === KeyCode.ENTER || e.key === KeyCode.SPACE) {\r\n                const row = virtualList.getLastFocusedRow();\r\n\r\n                if (row == null) {\r\n                    return;\r\n                }\r\n\r\n                const comp = virtualList.getComponentAt(row) as AggItemComp;\r\n\r\n                if (comp) {\r\n                    comp.selectItem();\r\n                }\r\n            }\r\n        });\r\n\r\n        popupSvc!.positionPopupByComponent({\r\n            type: 'aggFuncSelect',\r\n            eventSource: eGui,\r\n            ePopup: ePopup,\r\n            keepWithinBounds: true,\r\n            column: this.column,\r\n            position: 'under',\r\n        });\r\n\r\n        virtualList.refresh();\r\n\r\n        let rowToFocus = rows.findIndex((r) => r === this.column.getAggFunc());\r\n        if (rowToFocus === -1) {\r\n            rowToFocus = 0;\r\n        }\r\n\r\n        virtualList.focusRow(rowToFocus);\r\n    }\r\n\r\n    private createAggSelect(hidePopup: () => void, value: any): Component {\r\n        const itemSelected = () => {\r\n            hidePopup();\r\n            this.getGui().focus();\r\n            this.beans.valueColsSvc?.setColumnAggFunc?.(this.column, value, 'toolPanelDragAndDrop');\r\n        };\r\n\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const aggFuncString = value.toString();\r\n        const aggFuncStringTranslated = localeTextFunc(aggFuncString, aggFuncString);\r\n        const comp = new AggItemComp(itemSelected, aggFuncStringTranslated);\r\n\r\n        return comp;\r\n    }\r\n\r\n    private isGroupingAndLocked(): boolean {\r\n        return this.isGroupingZone() && isRowGroupColLocked(this.column, this.beans);\r\n    }\r\n\r\n    private isAggregationZone() {\r\n        return this.dropZonePurpose === 'aggregation';\r\n    }\r\n\r\n    private isGroupingZone() {\r\n        return this.dropZonePurpose === 'rowGroup';\r\n    }\r\n\r\n    protected getDragSourceType(): DragSourceType {\r\n        return DragSourceType.ToolPanel;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n        (this.column as any) = null;\r\n    }\r\n}\r\n\r\nclass AggItemComp extends Component {\r\n    public selectItem: () => void;\r\n\r\n    constructor(itemSelected: () => void, value: string) {\r\n        super(/* html */ `<div class=\"ag-select-agg-func-item\"/>`);\r\n        this.selectItem = itemSelected;\r\n        this.getGui().innerText = value;\r\n        this.addGuiEventListener('click', this.selectItem);\r\n    }\r\n}\r\n", "import type {\r\n    AgEvent,\r\n    ComponentSelector,\r\n    DragAndDropIcon,\r\n    DragItem,\r\n    DragSource,\r\n    DragSourceType,\r\n    DropTarget,\r\n    ITooltipCtrl,\r\n    TooltipFeature,\r\n} from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    TouchListener,\r\n    _createIconNoSpan,\r\n    _escapeString,\r\n    _setAriaLabel,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nexport type PillDragCompEvent = 'columnRemove';\r\nexport abstract class PillDragComp<TItem> extends Component<PillDragCompEvent> {\r\n    private readonly eText: HTMLElement = RefPlaceholder;\r\n    private readonly eDragHandle: HTMLElement = RefPlaceholder;\r\n    private readonly eButton: HTMLElement = RefPlaceholder;\r\n\r\n    public abstract getItem(): TItem;\r\n    protected abstract getDisplayName(): string;\r\n    protected abstract getAriaDisplayName(): string;\r\n    protected abstract getTooltip(): string | null | undefined;\r\n    protected abstract createGetDragItem(): () => DragItem<TItem>;\r\n    protected abstract getDragSourceType(): DragSourceType;\r\n    private tooltipFeature?: TooltipFeature;\r\n\r\n    constructor(\r\n        private dragSourceDropTarget: DropTarget,\r\n        private ghost: boolean,\r\n        private horizontal: boolean,\r\n        protected template?: string,\r\n        protected agComponents?: ComponentSelector[]\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.setTemplate(\r\n            this.template ??\r\n                /* html */ `\r\n            <span role=\"option\">\r\n              <span data-ref=\"eDragHandle\" class=\"ag-drag-handle ag-column-drop-cell-drag-handle\" role=\"presentation\"></span>\r\n              <span data-ref=\"eText\" class=\"ag-column-drop-cell-text\" aria-hidden=\"true\"></span>\r\n              <span data-ref=\"eButton\" class=\"ag-column-drop-cell-button\" role=\"presentation\"></span>\r\n            </span>`,\r\n            this.agComponents\r\n        );\r\n        const eGui = this.getGui();\r\n\r\n        const { beans, eDragHandle, eText, eButton } = this;\r\n\r\n        this.addElementClasses(eGui);\r\n        this.addElementClasses(eDragHandle, 'drag-handle');\r\n        this.addElementClasses(eText, 'text');\r\n        this.addElementClasses(eButton, 'button');\r\n\r\n        eDragHandle.appendChild(_createIconNoSpan('columnDrag', beans)!);\r\n\r\n        eButton.appendChild(_createIconNoSpan('cancel', beans)!);\r\n\r\n        this.tooltipFeature = this.createOptionalManagedBean(\r\n            beans.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.getGui(),\r\n            } as ITooltipCtrl)\r\n        );\r\n\r\n        this.setupComponents();\r\n\r\n        if (!this.ghost && this.isDraggable()) {\r\n            this.addDragSource();\r\n        }\r\n\r\n        this.setupAria();\r\n\r\n        this.setupTooltip();\r\n        this.activateTabIndex();\r\n\r\n        this.refreshDraggable();\r\n    }\r\n\r\n    protected isDraggable(): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected refreshDraggable(): void {\r\n        this.eDragHandle.classList.toggle('ag-column-select-column-readonly', !this.isDraggable());\r\n    }\r\n\r\n    protected setupAria() {\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        const ariaInstructions = [this.getAriaDisplayName()];\r\n\r\n        this.addAdditionalAriaInstructions(ariaInstructions, translate);\r\n\r\n        _setAriaLabel(this.getGui(), ariaInstructions.join('. '));\r\n    }\r\n\r\n    protected addAdditionalAriaInstructions(\r\n        ariaInstructions: string[],\r\n        translate: (key: string, defaultValue: string) => string\r\n    ): void {\r\n        if (this.isRemovable()) {\r\n            const deleteAria = translate('ariaDropZoneColumnComponentDescription', 'Press DELETE to remove');\r\n            ariaInstructions.push(deleteAria);\r\n        }\r\n    }\r\n\r\n    private setupTooltip(): void {\r\n        const refresh = () => this.tooltipFeature?.setTooltipAndRefresh(this.getTooltip());\r\n\r\n        refresh();\r\n\r\n        this.addManagedEventListeners({ newColumnsLoaded: refresh });\r\n    }\r\n\r\n    protected getDragSourceId(): string | undefined {\r\n        return undefined;\r\n    }\r\n\r\n    protected getDefaultIconName(): DragAndDropIcon {\r\n        return 'notAllowed';\r\n    }\r\n\r\n    private addDragSource(): void {\r\n        const {\r\n            beans: { dragAndDrop },\r\n            eDragHandle,\r\n        } = this;\r\n        const getDragItem = this.createGetDragItem();\r\n        const defaultIconName = this.getDefaultIconName();\r\n        const dragSource: DragSource = {\r\n            type: this.getDragSourceType(),\r\n            sourceId: this.getDragSourceId(),\r\n            eElement: eDragHandle,\r\n            getDefaultIconName: () => defaultIconName,\r\n            getDragItem,\r\n            dragItemName: this.getDisplayName(),\r\n        };\r\n\r\n        dragAndDrop?.addDragSource(dragSource, true);\r\n        this.addDestroyFunc(() => dragAndDrop?.removeDragSource(dragSource));\r\n    }\r\n\r\n    protected setupComponents(): void {\r\n        this.setTextValue();\r\n        this.setupRemove();\r\n\r\n        if (this.ghost) {\r\n            this.addCssClass('ag-column-drop-cell-ghost');\r\n        }\r\n    }\r\n\r\n    protected isRemovable(): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected refreshRemove(): void {\r\n        _setDisplayed(this.eButton, this.isRemovable());\r\n    }\r\n\r\n    private setupRemove(): void {\r\n        this.refreshRemove();\r\n\r\n        const agEvent: AgEvent<PillDragCompEvent> = { type: 'columnRemove' };\r\n\r\n        this.addGuiEventListener('keydown', (e: KeyboardEvent) => this.onKeyDown(e));\r\n\r\n        this.addManagedElementListeners(this.eButton, {\r\n            click: (mouseEvent: MouseEvent) => {\r\n                this.dispatchLocalEvent(agEvent);\r\n                mouseEvent.stopPropagation();\r\n            },\r\n        });\r\n\r\n        const touchListener = new TouchListener(this.eButton);\r\n        this.addManagedListeners(touchListener, {\r\n            tap: () => this.dispatchLocalEvent(agEvent),\r\n        });\r\n        this.addDestroyFunc(touchListener.destroy.bind(touchListener));\r\n    }\r\n\r\n    protected onKeyDown(e: KeyboardEvent): void {\r\n        const isDelete = e.key === KeyCode.DELETE;\r\n\r\n        if (isDelete) {\r\n            if (this.isRemovable()) {\r\n                e.preventDefault();\r\n                this.dispatchLocalEvent({ type: 'columnRemove' });\r\n            }\r\n        }\r\n    }\r\n\r\n    protected getDisplayValue(): string {\r\n        return this.getDisplayName();\r\n    }\r\n\r\n    private setTextValue(): void {\r\n        const displayValue = this.getDisplayValue();\r\n        const displayValueSanitised: any = _escapeString(displayValue);\r\n\r\n        this.eText.innerHTML = displayValueSanitised;\r\n    }\r\n\r\n    private addElementClasses(el: HTMLElement, suffix?: string) {\r\n        suffix = suffix ? `-${suffix}` : '';\r\n        const direction = this.horizontal ? 'horizontal' : 'vertical';\r\n        el.classList.add(`ag-column-drop-cell${suffix}`, `ag-column-drop-${direction}-cell${suffix}`);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n        (this.dragSourceDropTarget as any) = null;\r\n    }\r\n}\r\n", "import type { AgColumn, DragAndDropIcon, DraggingEvent } from 'ag-grid-community';\r\nimport { _createIconNoSpan } from 'ag-grid-community';\r\n\r\nimport { BaseDropZonePanel } from './baseDropZonePanel';\r\n\r\nexport class RowGroupDropZonePanel extends BaseDropZonePanel {\r\n    constructor(horizontal: boolean) {\r\n        super(horizontal, 'rowGroup');\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const emptyMessage = localeTextFunc('rowGroupColumnsEmptyMessage', 'Drag here to set row groups');\r\n        const title = localeTextFunc('groups', 'Row Groups');\r\n\r\n        super.init({\r\n            icon: _createIconNoSpan('rowGroupPanel', this.beans, null)!,\r\n            emptyMessage: emptyMessage,\r\n            title,\r\n        });\r\n\r\n        this.addManagedEventListeners({ columnRowGroupChanged: this.refreshGui.bind(this) });\r\n    }\r\n\r\n    protected getAriaLabel(): string {\r\n        const translate = this.getLocaleTextFunc();\r\n        const label = translate('ariaRowGroupDropZonePanelLabel', 'Row Groups');\r\n\r\n        return label;\r\n    }\r\n\r\n    protected isItemDroppable(column: AgColumn, draggingEvent: DraggingEvent): boolean {\r\n        // we never allow grouping of secondary columns\r\n        if (this.gos.get('functionsReadOnly') || !column.isPrimary()) {\r\n            return false;\r\n        }\r\n\r\n        return column.isAllowRowGroup() && (!column.isRowGroupActive() || this.isSourceEventFromTarget(draggingEvent));\r\n    }\r\n\r\n    protected updateItems(columns: AgColumn[]) {\r\n        this.beans.rowGroupColsSvc?.setColumns(columns, 'toolPanelUi');\r\n    }\r\n\r\n    protected getIconName(): DragAndDropIcon {\r\n        return this.isPotentialDndItems() ? 'group' : 'notAllowed';\r\n    }\r\n\r\n    protected getExistingItems(): AgColumn[] {\r\n        return this.beans.rowGroupColsSvc?.columns ?? [];\r\n    }\r\n}\r\n", "import type { AgColumn, DragAndDropIcon, DraggingEvent } from 'ag-grid-community';\r\nimport { _createIconNoSpan } from 'ag-grid-community';\r\n\r\nimport { BaseDropZonePanel } from './baseDropZonePanel';\r\n\r\nexport class ValuesDropZonePanel extends BaseDropZonePanel {\r\n    constructor(horizontal: boolean) {\r\n        super(horizontal, 'aggregation');\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const emptyMessage = localeTextFunc('valueColumnsEmptyMessage', 'Drag here to aggregate');\r\n        const title = localeTextFunc('values', 'Values');\r\n\r\n        super.init({\r\n            icon: _createIconNoSpan('valuePanel', this.beans, null)!,\r\n            emptyMessage: emptyMessage,\r\n            title: title,\r\n        });\r\n\r\n        this.addManagedEventListeners({ columnValueChanged: this.refreshGui.bind(this) });\r\n    }\r\n\r\n    protected getAriaLabel(): string {\r\n        const translate = this.getLocaleTextFunc();\r\n        const label = translate('ariaValuesDropZonePanelLabel', 'Values');\r\n\r\n        return label;\r\n    }\r\n\r\n    protected getIconName(): DragAndDropIcon {\r\n        return this.isPotentialDndItems() ? 'aggregate' : 'notAllowed';\r\n    }\r\n\r\n    protected isItemDroppable(column: AgColumn, draggingEvent: DraggingEvent): boolean {\r\n        // we never allow grouping of secondary columns\r\n        if (this.gos.get('functionsReadOnly') || !column.isPrimary()) {\r\n            return false;\r\n        }\r\n\r\n        return column.isAllowValue() && (!column.isValueActive() || this.isSourceEventFromTarget(draggingEvent));\r\n    }\r\n\r\n    protected updateItems(columns: AgColumn[]): void {\r\n        this.beans.valueColsSvc?.setColumns(columns, 'toolPanelUi');\r\n    }\r\n\r\n    protected getExistingItems(): AgColumn[] {\r\n        return this.beans.valueColsSvc?.columns ?? [];\r\n    }\r\n}\r\n", "import type { AgCheckbox } from 'ag-grid-community';\r\nimport { AgToggleButtonSelector, Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nexport class PivotModePanel extends Component {\r\n    private readonly cbPivotMode: AgCheckbox = RefPlaceholder;\r\n\r\n    private createTemplate(): string {\r\n        return /* html */ `<div class=\"ag-pivot-mode-panel\">\r\n                <ag-toggle-button data-ref=\"cbPivotMode\" class=\"ag-pivot-mode-select\"></ag-toggle-button>\r\n            </div>`;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.setTemplate(this.createTemplate(), [AgToggleButtonSelector]);\r\n\r\n        const cbPivotMode = this.cbPivotMode;\r\n        const { colModel, ctrlsSvc, gos } = this.beans;\r\n\r\n        cbPivotMode.setValue(colModel.isPivotMode());\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        cbPivotMode.setLabel(localeTextFunc('pivotMode', 'Pivot Mode'));\r\n\r\n        const onBtPivotMode = () => {\r\n            const newValue = !!cbPivotMode.getValue();\r\n            if (newValue !== colModel.isPivotMode()) {\r\n                gos.updateGridOptions({ options: { pivotMode: newValue }, source: 'toolPanelUi' as any });\r\n                ctrlsSvc.getHeaderRowContainerCtrls().forEach((c) => c.refresh());\r\n            }\r\n        };\r\n\r\n        const onPivotModeChanged = () => {\r\n            const pivotModeActive = colModel.isPivotMode();\r\n            cbPivotMode.setValue(pivotModeActive);\r\n        };\r\n\r\n        this.addManagedListeners(cbPivotMode, { fieldValueChanged: onBtPivotMode });\r\n        this.addManagedEventListeners({\r\n            newColumnsLoaded: onPivotModeChanged,\r\n            columnPivotModeChanged: onPivotModeChanged,\r\n        });\r\n    }\r\n}\r\n", "import type { _ColumnChooserGridApi, _ContextMenuGridApi, _ModuleWithApi, _ModuleWithoutApi } from 'ag-grid-community';\r\nimport { _ColumnMoveModule, _PopupModule, _SharedDragAndDropModule, _SharedMenuModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { MenuItemModule } from '../widgets/menuItemModule';\r\nimport { ChartMenuItemMapper } from './chartMenuItemMapper';\r\nimport { ColumnChooserFactory } from './columnChooserFactory';\r\nimport { ColumnMenuFactory } from './columnMenuFactory';\r\nimport { ContextMenuService } from './contextMenu';\r\nimport { EnterpriseMenuFactory } from './enterpriseMenu';\r\nimport { hideColumnChooser, showColumnChooser, showContextMenu } from './menuApi';\r\nimport { MenuItemMapper } from './menuItemMapper';\r\nimport { MenuUtils } from './menuUtils';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const MenuCoreModule: _ModuleWithoutApi = {\r\n    moduleName: 'MenuCore',\r\n    version: VERSION,\r\n    beans: [MenuItemMapper, ChartMenuItemMapper, MenuUtils],\r\n    icons: {\r\n        // context menu chart item\r\n        chart: 'chart',\r\n        // columns in menu (column chooser / columns tab)\r\n        columns: 'columns',\r\n        // loading async menu items\r\n        loadingMenuItems: 'loading',\r\n        // \"Pin column\" item in column header menu\r\n        menuPin: 'pin',\r\n        // \"Value aggregation\" column menu item (shown on numeric columns when grouping is active)\"\r\n        menuValue: 'aggregation',\r\n        // \"Group by {column-name}\" item in column header menu\r\n        menuAddRowGroup: 'group',\r\n        // \"Un-Group by {column-name}\" item in column header menu\r\n        menuRemoveRowGroup: 'group',\r\n        // context menu copy item\r\n        clipboardCopy: 'copy',\r\n        // context menu cut item\r\n        clipboardCut: 'cut',\r\n        // context menu paste item\r\n        clipboardPaste: 'paste',\r\n        // context menu export item\r\n        save: 'save',\r\n        // csv export\r\n        csvExport: 'csv',\r\n        // excel export,\r\n        excelExport: 'excel',\r\n        // show on column header when column is sorted ascending\r\n        sortAscending: 'asc',\r\n        // show on column header when column is sorted descending\r\n        sortDescending: 'desc',\r\n        // show on column header when column has no sort, only when enabled with colDef.unSortIcon=true\r\n        sortUnSort: 'none',\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _PopupModule, _SharedMenuModule, MenuItemModule],\r\n};\r\n\r\n/**\r\n * @feature Accessories -> Column Menu\r\n */\r\nexport const ColumnMenuModule: _ModuleWithApi<_ColumnChooserGridApi> = {\r\n    moduleName: 'ColumnMenu',\r\n    version: VERSION,\r\n    beans: [EnterpriseMenuFactory, ColumnMenuFactory, ColumnChooserFactory],\r\n    icons: {\r\n        // menu tab icon in legacy tabbed enterprise column menu\r\n        legacyMenu: 'menu',\r\n        // filter tab icon in legacy tabbed enterprise column menu\r\n        filterTab: 'filter',\r\n        // column tool panel column group contracted (click to expand)\r\n        columnSelectClosed: 'tree-closed',\r\n        // column tool panel column group expanded (click to contract)\r\n        columnSelectOpen: 'tree-open',\r\n        // column tool panel header expand/collapse all button, shown when some children are expanded and\r\n        //     others are collapsed\r\n        columnSelectIndeterminate: 'tree-indeterminate',\r\n    },\r\n    apiFunctions: {\r\n        showColumnChooser,\r\n        hideColumnChooser,\r\n    },\r\n    dependsOn: [MenuCoreModule, _SharedDragAndDropModule, _ColumnMoveModule],\r\n};\r\n\r\n/**\r\n * @feature Accessories -> Context Menu\r\n */\r\nexport const ContextMenuModule: _ModuleWithApi<_ContextMenuGridApi> = {\r\n    moduleName: 'ContextMenu',\r\n    version: VERSION,\r\n    beans: [ContextMenuService],\r\n    apiFunctions: {\r\n        showContextMenu,\r\n    },\r\n    dependsOn: [MenuCoreModule],\r\n};\r\n\r\n/**\r\n * @feature Accessories -> Column Menu / Context Menu\r\n */\r\nexport const MenuModule: _ModuleWithoutApi = {\r\n    moduleName: 'Menu',\r\n    version: VERSION,\r\n    dependsOn: [ColumnMenuModule, ContextMenuModule],\r\n};\r\n", "import type {\r\n    BeanCollection,\r\n    ChartGroupsDef,\r\n    ChartType,\r\n    IChartService,\r\n    LocaleTextFunc,\r\n    MenuItemDef,\r\n    NamedBean,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _createIconNoSpan, _warn } from 'ag-grid-community';\r\n\r\nexport class ChartMenuItemMapper extends BeanStub implements NamedBean {\r\n    beanName = 'chartMenuItemMapper' as const;\r\n\r\n    public getChartItems(key: 'pivotChart' | 'chartRange'): MenuItemDef | null {\r\n        const beans = this.beans;\r\n        const chartSvc = beans.chartSvc;\r\n        const isPivot = key === 'pivotChart';\r\n        if (!chartSvc) {\r\n            return null;\r\n        }\r\n\r\n        const getLocaleTextFunc = this.getLocaleTextFunc.bind(this);\r\n        const builder = isPivot\r\n            ? new PivotMenuItemMapper(beans, chartSvc, getLocaleTextFunc)\r\n            : new RangeMenuItemMapper(beans, chartSvc, getLocaleTextFunc);\r\n\r\n        const isEnterprise = chartSvc.isEnterprise();\r\n\r\n        let topLevelMenuItem: MenuItemDefWithKey | null = builder.getMenuItem();\r\n\r\n        if (topLevelMenuItem && topLevelMenuItem.subMenu && !isEnterprise) {\r\n            // Filter out enterprise-only menu items if 'Community Integrated'\r\n            const filterEnterpriseItems = (m: MenuItemDefWithKey): MenuItemDefWithKey => ({\r\n                ...m,\r\n                subMenu: m.subMenu?.filter((menu) => !menu._enterprise).map((menu) => filterEnterpriseItems(menu)),\r\n            });\r\n            topLevelMenuItem = filterEnterpriseItems(topLevelMenuItem);\r\n        }\r\n\r\n        const chartGroupsDef = this.gos.get('chartToolPanelsDef')?.settingsPanel?.chartGroupsDef;\r\n        if (chartGroupsDef) {\r\n            topLevelMenuItem = this.filterAndOrderChartMenu(\r\n                topLevelMenuItem,\r\n                chartGroupsDef,\r\n                builder.getConfigLookup()\r\n            );\r\n        }\r\n        return this.cleanInternals(topLevelMenuItem);\r\n    }\r\n\r\n    // Remove our internal _key and _enterprise properties so this does not leak out of the class on the menu items.\r\n    private cleanInternals(menuItem: MenuItemDefWithKey | null): MenuItemDef | null {\r\n        if (!menuItem) {\r\n            return menuItem;\r\n        }\r\n\r\n        const removeKeys = (m: MenuItemDefWithKey | null) => {\r\n            delete m?._key;\r\n            delete m?._enterprise;\r\n            m?.subMenu?.forEach((s) => removeKeys(s));\r\n            return m;\r\n        };\r\n\r\n        return removeKeys(menuItem);\r\n    }\r\n\r\n    private buildLookup<T extends MenuItemDefWithKey<any>>(menuItem: T) {\r\n        const itemLookup: Record<any, T> = {} as any;\r\n        const addItem = (item: T) => {\r\n            itemLookup[item._key] = item;\r\n            if (item.subMenu) {\r\n                item.subMenu.forEach((s) => addItem(s as T));\r\n            }\r\n        };\r\n        addItem(menuItem);\r\n        return itemLookup;\r\n    }\r\n\r\n    /**\r\n     * Make the MenuItem match the charts provided and their ordering on the ChartGroupsDef config object as provided by the user.\r\n     */\r\n    private filterAndOrderChartMenu<TKeys extends string>(\r\n        topLevelMenuItem: MenuItemDefWithKey<TKeys>,\r\n        chartGroupsDef: ChartGroupsDef,\r\n        configLookup: ChartDefToMenuItems<TKeys>\r\n    ): MenuItemDefWithKey<TKeys> | null {\r\n        const menuItemLookup = this.buildLookup(topLevelMenuItem);\r\n        const orderedAndFiltered: MenuItemDefWithKey = { ...topLevelMenuItem, subMenu: [] };\r\n\r\n        Object.entries(chartGroupsDef).forEach(([group, chartTypes]: [keyof ChartGroupsDef, ChartType[]]) => {\r\n            const chartConfigGroup = configLookup[group];\r\n\r\n            // Skip any context panels that are not enabled for the current chart type\r\n            if (chartConfigGroup === null) return;\r\n\r\n            if (chartConfigGroup == undefined) {\r\n                _warn(173, { group });\r\n                return;\r\n            }\r\n\r\n            const menuItem = menuItemLookup[chartConfigGroup._key];\r\n            if (menuItem) {\r\n                if (menuItem.subMenu) {\r\n                    const subMenus = chartTypes\r\n                        .map((chartType) => {\r\n                            const itemKey = (chartConfigGroup as any)[chartType];\r\n                            if (itemKey == undefined) {\r\n                                _warn(174, { group, chartType });\r\n                                return undefined;\r\n                            }\r\n                            return menuItemLookup[itemKey];\r\n                        })\r\n                        .filter((s) => s !== undefined) as MenuItemDefWithKey[];\r\n\r\n                    if (subMenus.length > 0) {\r\n                        menuItem.subMenu = subMenus;\r\n                        orderedAndFiltered.subMenu?.push(menuItem);\r\n                    }\r\n                } else {\r\n                    // Handles line case which is not actually a sub subMenu\r\n                    orderedAndFiltered.subMenu?.push(menuItem);\r\n                }\r\n            }\r\n        });\r\n        if (orderedAndFiltered.subMenu?.length == 0) {\r\n            return null;\r\n        }\r\n        return orderedAndFiltered;\r\n    }\r\n}\r\n\r\ninterface MenuItemBuilder<MenuItemKeys extends string> {\r\n    getMenuItem(): MenuItemDefWithKey<MenuItemKeys>;\r\n    getConfigLookup(): ChartDefToMenuItems<MenuItemKeys>;\r\n}\r\n\r\n/** Utility type to keep chart menu item lookups in sync with ChartGroupsDef */\r\ntype ChartDefToMenuItems<MenuItemKeys extends string> = {\r\n    [K in keyof ChartGroupsDef]-?: ChartGroupsDef[K] extends (infer P)[] | undefined\r\n        ? [P] extends [ChartType]\r\n            ? ({ [T in P]-?: MenuItemKeys | null } & { _key: MenuItemKeys }) | null\r\n            : never\r\n        : never;\r\n};\r\n\r\ninterface MenuItemDefWithKey<MenuItemKey extends string = any> extends MenuItemDef {\r\n    _key: MenuItemKey;\r\n    _enterprise?: boolean;\r\n    subMenu?: MenuItemDefWithKey<MenuItemKey>[];\r\n}\r\n\r\nexport type PivotMenuOptionName =\r\n    | 'pivotChart'\r\n    | 'pivotColumnChart'\r\n    | 'pivotGroupedColumn'\r\n    | 'pivotStackedColumn'\r\n    | 'pivotNormalizedColumn'\r\n    | 'pivotBarChart'\r\n    | 'pivotGroupedBar'\r\n    | 'pivotStackedBar'\r\n    | 'pivotNormalizedBar'\r\n    | 'pivotPieChart'\r\n    | 'pivotPie'\r\n    | 'pivotDonut'\r\n    | 'pivotLineChart'\r\n    | 'pivotStackedLine'\r\n    | 'pivotNormalizedLine'\r\n    | 'pivotXYChart'\r\n    | 'pivotScatter'\r\n    | 'pivotBubble'\r\n    | 'pivotAreaChart'\r\n    | 'pivotArea'\r\n    | 'pivotStackedArea'\r\n    | 'pivotNormalizedArea'\r\n    | 'pivotStatisticalChart'\r\n    | 'pivotHistogram'\r\n    | 'pivotHierarchicalChart'\r\n    | 'pivotTreemap'\r\n    | 'pivotSunburst'\r\n    | 'pivotCombinationChart'\r\n    | 'pivotColumnLineCombo'\r\n    | 'pivotAreaColumnCombo';\r\n\r\nclass PivotMenuItemMapper implements MenuItemBuilder<PivotMenuOptionName> {\r\n    constructor(\r\n        private beans: BeanCollection,\r\n        private chartSvc: IChartService,\r\n        private getLocaleTextFunc: () => LocaleTextFunc\r\n    ) {}\r\n\r\n    getMenuItem(): MenuItemDefWithKey<PivotMenuOptionName> {\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const getMenuItem = (\r\n            localeKey: string,\r\n            defaultText: string,\r\n            chartType: ChartType,\r\n            key: PivotMenuOptionName,\r\n            enterprise = false\r\n        ) => {\r\n            return {\r\n                name: localeTextFunc(localeKey, defaultText),\r\n                action: () => this.chartSvc.createPivotChart({ chartType }),\r\n                _key: key,\r\n                _enterprise: enterprise,\r\n            };\r\n        };\r\n        return {\r\n            name: localeTextFunc('pivotChart', 'Pivot Chart'),\r\n            _key: 'pivotChart',\r\n            subMenu: [\r\n                {\r\n                    _key: 'pivotColumnChart',\r\n                    name: localeTextFunc('columnChart', 'Column'),\r\n                    subMenu: [\r\n                        getMenuItem('groupedColumn', 'Grouped&lrm;', 'groupedColumn', 'pivotGroupedColumn'),\r\n                        getMenuItem('stackedColumn', 'Stacked&lrm;', 'stackedColumn', 'pivotStackedColumn'),\r\n                        getMenuItem(\r\n                            'normalizedColumn',\r\n                            '100% Stacked&lrm;',\r\n                            'normalizedColumn',\r\n                            'pivotNormalizedColumn'\r\n                        ),\r\n                    ],\r\n                },\r\n                {\r\n                    _key: 'pivotBarChart',\r\n                    name: localeTextFunc('barChart', 'Bar'),\r\n                    subMenu: [\r\n                        getMenuItem('groupedBar', 'Grouped&lrm;', 'groupedBar', 'pivotGroupedBar'),\r\n                        getMenuItem('stackedBar', 'Stacked&lrm;', 'stackedBar', 'pivotStackedBar'),\r\n                        getMenuItem('normalizedBar', '100% Stacked&lrm;', 'normalizedBar', 'pivotNormalizedBar'),\r\n                    ],\r\n                },\r\n                {\r\n                    _key: 'pivotPieChart',\r\n                    name: localeTextFunc('pieChart', 'Pie'),\r\n                    subMenu: [\r\n                        getMenuItem('pie', 'Pie&lrm;', 'pie', 'pivotPie'),\r\n                        getMenuItem('donut', 'Donut&lrm;', 'donut', 'pivotDonut'),\r\n                    ],\r\n                },\r\n                {\r\n                    _key: 'pivotLineChart',\r\n                    name: localeTextFunc('lineChart', 'Line'),\r\n                    subMenu: [\r\n                        getMenuItem('lineChart', 'Line&lrm;', 'line', 'pivotLineChart'),\r\n                        getMenuItem('stackedLine', 'Stacked&lrm;', 'stackedLine', 'pivotStackedLine'),\r\n                        getMenuItem('normalizedLine', '100% Stacked&lrm;', 'normalizedLine', 'pivotNormalizedLine'),\r\n                    ],\r\n                },\r\n                {\r\n                    _key: 'pivotAreaChart',\r\n                    name: localeTextFunc('areaChart', 'Area'),\r\n                    subMenu: [\r\n                        getMenuItem('areaChart', 'Area&lrm;', 'area', 'pivotArea'),\r\n                        getMenuItem('stackedArea', 'Stacked&lrm;', 'stackedArea', 'pivotStackedArea'),\r\n                        getMenuItem('normalizedArea', '100% Stacked&lrm;', 'normalizedArea', 'pivotNormalizedArea'),\r\n                    ],\r\n                },\r\n                {\r\n                    _key: 'pivotXYChart',\r\n                    name: localeTextFunc('xyChart', 'X Y (Scatter)'),\r\n                    subMenu: [\r\n                        getMenuItem('scatter', 'Scatter&lrm;', 'scatter', 'pivotScatter'),\r\n                        getMenuItem('bubble', 'Bubble&lrm;', 'bubble', 'pivotBubble'),\r\n                    ],\r\n                },\r\n                {\r\n                    _key: 'pivotStatisticalChart',\r\n                    _enterprise: false, // histogram chart is available in both community and enterprise distributions\r\n                    name: localeTextFunc('statisticalChart', 'Statistical'),\r\n                    subMenu: [getMenuItem('histogramChart', 'Histogram&lrm;', 'histogram', 'pivotHistogram', false)],\r\n                },\r\n                {\r\n                    _key: 'pivotHierarchicalChart',\r\n                    _enterprise: true,\r\n                    name: localeTextFunc('hierarchicalChart', 'Hierarchical'),\r\n                    subMenu: [\r\n                        getMenuItem('treemapChart', 'Treemap&lrm;', 'treemap', 'pivotTreemap', true),\r\n                        getMenuItem('sunburstChart', 'Sunburst&lrm;', 'sunburst', 'pivotSunburst', true),\r\n                    ],\r\n                },\r\n                {\r\n                    _key: 'pivotCombinationChart',\r\n                    name: localeTextFunc('combinationChart', 'Combination'),\r\n                    subMenu: [\r\n                        getMenuItem('columnLineCombo', 'Column & Line&lrm;', 'columnLineCombo', 'pivotColumnLineCombo'),\r\n                        getMenuItem('AreaColumnCombo', 'Area & Column&lrm;', 'areaColumnCombo', 'pivotAreaColumnCombo'),\r\n                    ],\r\n                },\r\n            ],\r\n            icon: _createIconNoSpan('chart', this.beans, undefined),\r\n        };\r\n    }\r\n\r\n    getConfigLookup(): ChartDefToMenuItems<PivotMenuOptionName> {\r\n        return {\r\n            columnGroup: {\r\n                _key: 'pivotColumnChart',\r\n                column: 'pivotGroupedColumn',\r\n                stackedColumn: 'pivotStackedColumn',\r\n                normalizedColumn: 'pivotNormalizedColumn',\r\n            },\r\n            barGroup: {\r\n                _key: 'pivotBarChart',\r\n                bar: 'pivotGroupedBar',\r\n                stackedBar: 'pivotStackedBar',\r\n                normalizedBar: 'pivotNormalizedBar',\r\n            },\r\n            pieGroup: {\r\n                _key: 'pivotPieChart',\r\n                pie: 'pivotPie',\r\n                donut: 'pivotDonut',\r\n                doughnut: 'pivotDonut',\r\n            },\r\n            lineGroup: {\r\n                _key: 'pivotLineChart',\r\n                line: 'pivotLineChart',\r\n                stackedLine: 'pivotStackedLine',\r\n                normalizedLine: 'pivotNormalizedLine',\r\n            },\r\n            areaGroup: {\r\n                _key: 'pivotAreaChart',\r\n                area: 'pivotArea',\r\n                stackedArea: 'pivotStackedArea',\r\n                normalizedArea: 'pivotNormalizedArea',\r\n            },\r\n            scatterGroup: {\r\n                _key: 'pivotXYChart',\r\n                bubble: 'pivotBubble',\r\n                scatter: 'pivotScatter',\r\n            },\r\n            combinationGroup: {\r\n                _key: 'pivotCombinationChart',\r\n                columnLineCombo: 'pivotColumnLineCombo',\r\n                areaColumnCombo: 'pivotAreaColumnCombo',\r\n                customCombo: null, // Not currently supported\r\n            },\r\n            hierarchicalGroup: {\r\n                _key: 'pivotHierarchicalChart',\r\n                treemap: 'pivotTreemap',\r\n                sunburst: 'pivotSunburst',\r\n            },\r\n            statisticalGroup: {\r\n                _key: 'pivotStatisticalChart',\r\n                histogram: 'pivotHistogram',\r\n                // Some statistical charts do not currently support pivot mode\r\n                rangeBar: null,\r\n                rangeArea: null,\r\n                boxPlot: null,\r\n            },\r\n            // Polar charts do not support pivot mode\r\n            polarGroup: null,\r\n            // Specialized charts do not currently support pivot mode\r\n            specializedGroup: null,\r\n        };\r\n    }\r\n}\r\n\r\nexport type RangeMenuOptionName =\r\n    | 'chartRange'\r\n    | 'rangeColumnChart'\r\n    | 'rangeGroupedColumn'\r\n    | 'rangeStackedColumn'\r\n    | 'rangeNormalizedColumn'\r\n    | 'rangeBarChart'\r\n    | 'rangeGroupedBar'\r\n    | 'rangeStackedBar'\r\n    | 'rangeNormalizedBar'\r\n    | 'rangePieChart'\r\n    | 'rangePie'\r\n    | 'rangeDonut'\r\n    | 'rangeLineChart'\r\n    | 'rangeStackedLine'\r\n    | 'rangeNormalizedLine'\r\n    | 'rangeXYChart'\r\n    | 'rangeScatter'\r\n    | 'rangeBubble'\r\n    | 'rangeAreaChart'\r\n    | 'rangeArea'\r\n    | 'rangeStackedArea'\r\n    | 'rangeNormalizedArea'\r\n    | 'rangePolarChart'\r\n    | 'rangeRadarLine'\r\n    | 'rangeRadarArea'\r\n    | 'rangeNightingale'\r\n    | 'rangeRadialColumn'\r\n    | 'rangeRadialBar'\r\n    | 'rangeStatisticalChart'\r\n    | 'rangeBoxPlot'\r\n    | 'rangeHistogram'\r\n    | 'rangeRangeBar'\r\n    | 'rangeRangeArea'\r\n    | 'rangeHierarchicalChart'\r\n    | 'rangeTreemap'\r\n    | 'rangeSunburst'\r\n    | 'rangeSpecializedChart'\r\n    | 'rangeWaterfall'\r\n    | 'rangeHeatmap'\r\n    | 'rangeCombinationChart'\r\n    | 'rangeColumnLineCombo'\r\n    | 'rangeAreaColumnCombo';\r\n\r\nclass RangeMenuItemMapper implements MenuItemBuilder<RangeMenuOptionName> {\r\n    constructor(\r\n        private beans: BeanCollection,\r\n        private chartSvc: IChartService,\r\n        private getLocaleTextFunc: () => LocaleTextFunc\r\n    ) {}\r\n\r\n    getMenuItem(): MenuItemDefWithKey<RangeMenuOptionName> {\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const getMenuItem = (\r\n            localeKey: string,\r\n            defaultText: string,\r\n            chartType: ChartType,\r\n            key: RangeMenuOptionName,\r\n            enterprise = false\r\n        ) => {\r\n            return {\r\n                name: localeTextFunc(localeKey, defaultText),\r\n                action: () => this.chartSvc.createChartFromCurrentRange(chartType),\r\n                _key: key,\r\n                _enterprise: enterprise,\r\n            };\r\n        };\r\n\r\n        return {\r\n            name: localeTextFunc('chartRange', 'Chart Range'),\r\n            _key: 'chartRange',\r\n            subMenu: [\r\n                {\r\n                    name: localeTextFunc('columnChart', 'Column'),\r\n                    subMenu: [\r\n                        getMenuItem('groupedColumn', 'Grouped&lrm;', 'groupedColumn', 'rangeGroupedColumn'),\r\n                        getMenuItem('stackedColumn', 'Stacked&lrm;', 'stackedColumn', 'rangeStackedColumn'),\r\n                        getMenuItem(\r\n                            'normalizedColumn',\r\n                            '100% Stacked&lrm;',\r\n                            'normalizedColumn',\r\n                            'rangeNormalizedColumn'\r\n                        ),\r\n                    ],\r\n                    _key: 'rangeColumnChart',\r\n                },\r\n                {\r\n                    name: localeTextFunc('barChart', 'Bar'),\r\n                    subMenu: [\r\n                        getMenuItem('groupedBar', 'Grouped&lrm;', 'groupedBar', 'rangeGroupedBar'),\r\n                        getMenuItem('stackedBar', 'Stacked&lrm;', 'stackedBar', 'rangeStackedBar'),\r\n                        getMenuItem('normalizedBar', '100% Stacked&lrm;', 'normalizedBar', 'rangeNormalizedBar'),\r\n                    ],\r\n                    _key: 'rangeBarChart',\r\n                },\r\n                {\r\n                    name: localeTextFunc('pieChart', 'Pie'),\r\n                    subMenu: [\r\n                        getMenuItem('pie', 'Pie&lrm;', 'pie', 'rangePie'),\r\n                        getMenuItem('donut', 'Donut&lrm;', 'donut', 'rangeDonut'),\r\n                    ],\r\n                    _key: 'rangePieChart',\r\n                },\r\n                {\r\n                    name: localeTextFunc('lineChart', 'Line'),\r\n                    subMenu: [\r\n                        getMenuItem('lineChart', 'Line&lrm;', 'line', 'rangeLineChart'),\r\n                        getMenuItem('stackedLine', 'Stacked&lrm;', 'stackedLine', 'rangeStackedLine'),\r\n                        getMenuItem('normalizedLine', '100% Stacked&lrm;', 'normalizedLine', 'rangeNormalizedLine'),\r\n                    ],\r\n                    _key: 'rangeLineChart',\r\n                },\r\n                {\r\n                    name: localeTextFunc('areaChart', 'Area'),\r\n                    subMenu: [\r\n                        getMenuItem('areaChart', 'Area&lrm;', 'area', 'rangeArea'),\r\n                        getMenuItem('stackedArea', 'Stacked&lrm;', 'stackedArea', 'rangeStackedArea'),\r\n                        getMenuItem('normalizedArea', '100% Stacked&lrm;', 'normalizedArea', 'rangeNormalizedArea'),\r\n                    ],\r\n                    _key: 'rangeAreaChart',\r\n                },\r\n                {\r\n                    name: localeTextFunc('xyChart', 'X Y (Scatter)'),\r\n                    subMenu: [\r\n                        getMenuItem('scatter', 'Scatter&lrm;', 'scatter', 'rangeScatter'),\r\n                        getMenuItem('bubble', 'Bubble&lrm;', 'bubble', 'rangeBubble'),\r\n                    ],\r\n                    _key: 'rangeXYChart',\r\n                },\r\n                {\r\n                    name: localeTextFunc('polarChart', 'Polar'),\r\n                    subMenu: [\r\n                        getMenuItem('radarLine', 'Radar Line&lrm;', 'radarLine', 'rangeRadarLine'),\r\n                        getMenuItem('radarArea', 'Radar Area&lrm;', 'radarArea', 'rangeRadarArea'),\r\n                        getMenuItem('nightingale', 'Nightingale&lrm;', 'nightingale', 'rangeNightingale'),\r\n                        getMenuItem('radialColumn', 'Radial Column&lrm;', 'radialColumn', 'rangeRadialColumn'),\r\n                        getMenuItem('radialBar', 'Radial Bar&lrm;', 'radialBar', 'rangeRadialBar'),\r\n                    ],\r\n                    _key: 'rangePolarChart',\r\n                    _enterprise: true,\r\n                },\r\n                {\r\n                    name: localeTextFunc('statisticalChart', 'Statistical'),\r\n                    subMenu: [\r\n                        getMenuItem('boxPlot', 'Box Plot&lrm;', 'boxPlot', 'rangeBoxPlot', true),\r\n                        getMenuItem('histogramChart', 'Histogram&lrm;', 'histogram', 'rangeHistogram', false),\r\n                        getMenuItem('rangeBar', 'Range Bar&lrm;', 'rangeBar', 'rangeRangeBar', true),\r\n                        getMenuItem('rangeArea', 'Range Area&lrm;', 'rangeArea', 'rangeRangeArea', true),\r\n                    ],\r\n                    _key: 'rangeStatisticalChart',\r\n                    _enterprise: false, // histogram chart is available in both community and enterprise distributions\r\n                },\r\n                {\r\n                    name: localeTextFunc('hierarchicalChart', 'Hierarchical'),\r\n                    subMenu: [\r\n                        getMenuItem('treemap', 'Treemap&lrm;', 'treemap', 'rangeTreemap'),\r\n                        getMenuItem('sunburst', 'Sunburst&lrm;', 'sunburst', 'rangeSunburst'),\r\n                    ],\r\n                    _key: 'rangeHierarchicalChart',\r\n                    _enterprise: true,\r\n                },\r\n                {\r\n                    name: localeTextFunc('specializedChart', 'Specialized'),\r\n                    subMenu: [\r\n                        getMenuItem('heatmap', 'Heatmap&lrm;', 'heatmap', 'rangeHeatmap'),\r\n                        getMenuItem('waterfall', 'Waterfall&lrm;', 'waterfall', 'rangeWaterfall'),\r\n                    ],\r\n                    _key: 'rangeSpecializedChart',\r\n                    _enterprise: true,\r\n                },\r\n                {\r\n                    name: localeTextFunc('combinationChart', 'Combination'),\r\n                    subMenu: [\r\n                        getMenuItem('columnLineCombo', 'Column & Line&lrm;', 'columnLineCombo', 'rangeColumnLineCombo'),\r\n                        getMenuItem('AreaColumnCombo', 'Area & Column&lrm;', 'areaColumnCombo', 'rangeAreaColumnCombo'),\r\n                    ],\r\n                    _key: 'rangeCombinationChart',\r\n                },\r\n            ],\r\n            icon: _createIconNoSpan('chart', this.beans, undefined),\r\n        };\r\n    }\r\n\r\n    getConfigLookup(): ChartDefToMenuItems<RangeMenuOptionName> {\r\n        return {\r\n            columnGroup: {\r\n                _key: 'rangeColumnChart',\r\n                column: 'rangeGroupedColumn',\r\n                stackedColumn: 'rangeStackedColumn',\r\n                normalizedColumn: 'rangeNormalizedColumn',\r\n            },\r\n            barGroup: {\r\n                _key: 'rangeBarChart',\r\n                bar: 'rangeGroupedBar',\r\n                stackedBar: 'rangeStackedBar',\r\n                normalizedBar: 'rangeNormalizedBar',\r\n            },\r\n            pieGroup: {\r\n                _key: 'rangePieChart',\r\n                pie: 'rangePie',\r\n                donut: 'rangeDonut',\r\n                doughnut: 'rangeDonut',\r\n            },\r\n            lineGroup: {\r\n                _key: 'rangeLineChart',\r\n                line: 'rangeLineChart',\r\n                stackedLine: 'rangeStackedLine',\r\n                normalizedLine: 'rangeNormalizedLine',\r\n            },\r\n            areaGroup: {\r\n                _key: 'rangeAreaChart',\r\n                area: 'rangeArea',\r\n                stackedArea: 'rangeStackedArea',\r\n                normalizedArea: 'rangeNormalizedArea',\r\n            },\r\n            scatterGroup: {\r\n                _key: 'rangeXYChart',\r\n                bubble: 'rangeBubble',\r\n                scatter: 'rangeScatter',\r\n            },\r\n            polarGroup: {\r\n                _key: 'rangePolarChart',\r\n                radarLine: 'rangeRadarLine',\r\n                radarArea: 'rangeRadarArea',\r\n                nightingale: 'rangeNightingale',\r\n                radialColumn: 'rangeRadialColumn',\r\n                radialBar: 'rangeRadialBar',\r\n            },\r\n            statisticalGroup: {\r\n                _key: 'rangeStatisticalChart',\r\n                boxPlot: 'rangeBoxPlot',\r\n                histogram: 'rangeHistogram',\r\n                rangeBar: 'rangeRangeBar',\r\n                rangeArea: 'rangeRangeArea',\r\n            },\r\n            hierarchicalGroup: {\r\n                _key: 'rangeHierarchicalChart',\r\n                treemap: 'rangeTreemap',\r\n                sunburst: 'rangeSunburst',\r\n            },\r\n            specializedGroup: {\r\n                _key: 'rangeSpecializedChart',\r\n                heatmap: 'rangeHeatmap',\r\n                waterfall: 'rangeWaterfall',\r\n            },\r\n            combinationGroup: {\r\n                _key: 'rangeCombinationChart',\r\n                columnLineCombo: 'rangeColumnLineCombo',\r\n                areaColumnCombo: 'rangeAreaColumnCombo',\r\n                customCombo: null, // Not currently supported\r\n            },\r\n        };\r\n    }\r\n}\r\n", "import type { AgColumn, ColumnChooserParams, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub, _findNextFocusableElement } from 'ag-grid-community';\r\n\r\nimport { AgPrimaryCols } from '../columnToolPanel/agPrimaryCols';\r\nimport { AgDialog } from '../widgets/agDialog';\r\nimport type { MenuUtils } from './menuUtils';\r\n\r\ninterface ShowColumnChooserParams {\r\n    column?: AgColumn | null;\r\n    chooserParams?: ColumnChooserParams;\r\n    eventSource?: HTMLElement;\r\n}\r\n\r\nexport class ColumnChooserFactory extends BeanStub implements NamedBean {\r\n    beanName = 'colChooserFactory' as const;\r\n\r\n    private activeColumnChooser: AgPrimaryCols | undefined;\r\n    private activeColumnChooserDialog: AgDialog | undefined;\r\n\r\n    public createColumnSelectPanel(\r\n        parent: BeanStub<any>,\r\n        column?: AgColumn | null,\r\n        draggable?: boolean,\r\n        params?: ColumnChooserParams\r\n    ): AgPrimaryCols {\r\n        const columnSelectPanel = parent.createManagedBean(new AgPrimaryCols());\r\n\r\n        const columnChooserParams = params ?? column?.getColDef().columnChooserParams ?? {};\r\n\r\n        const {\r\n            contractColumnSelection,\r\n            suppressColumnExpandAll,\r\n            suppressColumnFilter,\r\n            suppressColumnSelectAll,\r\n            suppressSyncLayoutWithGrid,\r\n            columnLayout,\r\n        } = columnChooserParams;\r\n\r\n        columnSelectPanel.init(\r\n            !!draggable,\r\n            this.gos.addGridCommonParams({\r\n                suppressColumnMove: false,\r\n                suppressValues: false,\r\n                suppressPivots: false,\r\n                suppressRowGroups: false,\r\n                suppressPivotMode: false,\r\n                contractColumnSelection: !!contractColumnSelection,\r\n                suppressColumnExpandAll: !!suppressColumnExpandAll,\r\n                suppressColumnFilter: !!suppressColumnFilter,\r\n                suppressColumnSelectAll: !!suppressColumnSelectAll,\r\n                suppressSyncLayoutWithGrid: !!columnLayout || !!suppressSyncLayoutWithGrid,\r\n                onStateUpdated: () => {},\r\n            }),\r\n            'columnMenu'\r\n        );\r\n\r\n        if (columnLayout) {\r\n            columnSelectPanel.setColumnLayout(columnLayout);\r\n        }\r\n\r\n        return columnSelectPanel;\r\n    }\r\n\r\n    public showColumnChooser({ column, chooserParams, eventSource }: ShowColumnChooserParams): void {\r\n        this.hideActiveColumnChooser();\r\n\r\n        const columnSelectPanel = this.createColumnSelectPanel(this, column, true, chooserParams);\r\n        const translate = this.getLocaleTextFunc();\r\n        const beans = this.beans;\r\n        const { visibleCols, focusSvc, menuUtils } = beans;\r\n        const columnIndex = visibleCols.allCols.indexOf(column as AgColumn);\r\n        const headerPosition = column ? focusSvc.focusedHeader : null;\r\n\r\n        this.activeColumnChooserDialog = this.createBean(\r\n            new AgDialog({\r\n                title: translate('chooseColumns', 'Choose Columns'),\r\n                component: columnSelectPanel,\r\n                width: 300,\r\n                height: 300,\r\n                resizable: true,\r\n                movable: true,\r\n                centered: true,\r\n                closable: true,\r\n                afterGuiAttached: () => {\r\n                    _findNextFocusableElement(beans, columnSelectPanel.getGui())?.focus({\r\n                        preventScroll: true,\r\n                    });\r\n                    this.dispatchVisibleChangedEvent(true, column);\r\n                },\r\n                closedCallback: (event) => {\r\n                    const eComp = this.activeColumnChooser!.getGui();\r\n                    this.destroyBean(this.activeColumnChooser);\r\n                    this.activeColumnChooser = undefined;\r\n                    this.activeColumnChooserDialog = undefined;\r\n                    this.dispatchVisibleChangedEvent(false, column);\r\n                    if (column) {\r\n                        (menuUtils as MenuUtils).restoreFocusOnClose(\r\n                            { column, headerPosition, columnIndex, eventSource },\r\n                            eComp,\r\n                            event,\r\n                            true\r\n                        );\r\n                    }\r\n                },\r\n                postProcessPopupParams: {\r\n                    type: 'columnChooser',\r\n                    column,\r\n                    eventSource,\r\n                },\r\n            })\r\n        );\r\n\r\n        this.activeColumnChooser = columnSelectPanel;\r\n    }\r\n\r\n    public hideActiveColumnChooser(): void {\r\n        this.destroyBean(this.activeColumnChooserDialog);\r\n    }\r\n\r\n    private dispatchVisibleChangedEvent(visible: boolean, column?: AgColumn | null): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'columnMenuVisibleChanged',\r\n            visible,\r\n            switchingTab: false,\r\n            key: 'columnChooser',\r\n            column: column ?? null,\r\n        });\r\n    }\r\n}\r\n", "import type { AgColumn, AgProvidedColumnGroup, DefaultMenuItem, MenuItemDef, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub, _isClientSideRowModel, _isLegacyMenuEnabled } from 'ag-grid-community';\r\n\r\nimport { isRowGroupColLocked } from '../rowGrouping/rowGroupingUtils';\r\nimport { AgMenuList } from '../widgets/agMenuList';\r\nimport { MENU_ITEM_SEPARATOR, _removeRepeatsFromArray } from './menuItemMapper';\r\nimport type { MenuItemMapper } from './menuItemMapper';\r\n\r\nexport class ColumnMenuFactory extends BeanStub implements NamedBean {\r\n    beanName = 'colMenuFactory' as const;\r\n\r\n    public createMenu(\r\n        parent: BeanStub<any>,\r\n        menuItems: (DefaultMenuItem | MenuItemDef)[],\r\n        column: AgColumn | undefined,\r\n        sourceElement: () => HTMLElement\r\n    ): AgMenuList {\r\n        const menuList = parent.createManagedBean(\r\n            new AgMenuList(0, {\r\n                column: column ?? null,\r\n                node: null,\r\n                value: null,\r\n            })\r\n        );\r\n\r\n        const menuItemsMapped = (this.beans.menuItemMapper as MenuItemMapper).mapWithStockItems(\r\n            menuItems,\r\n            column ?? null,\r\n            sourceElement,\r\n            'columnMenu'\r\n        );\r\n\r\n        menuList.addMenuItems(menuItemsMapped);\r\n\r\n        return menuList;\r\n    }\r\n\r\n    public getMenuItems(\r\n        column: AgColumn | null = null,\r\n        columnGroup: AgProvidedColumnGroup | null = null\r\n    ): (DefaultMenuItem | MenuItemDef)[] {\r\n        const defaultItems = this.getDefaultMenuOptions(column);\r\n        let result: (DefaultMenuItem | MenuItemDef)[];\r\n\r\n        const columnMainMenuItems = (column?.getColDef() ?? columnGroup?.getColGroupDef())?.mainMenuItems;\r\n        if (Array.isArray(columnMainMenuItems)) {\r\n            result = columnMainMenuItems;\r\n        } else if (typeof columnMainMenuItems === 'function') {\r\n            result = columnMainMenuItems(\r\n                this.gos.addGridCommonParams({\r\n                    column,\r\n                    columnGroup,\r\n                    defaultItems,\r\n                })\r\n            );\r\n        } else {\r\n            const userFunc = this.gos.getCallback('getMainMenuItems');\r\n            if (userFunc) {\r\n                result = userFunc({\r\n                    column,\r\n                    columnGroup,\r\n                    defaultItems,\r\n                });\r\n            } else {\r\n                result = defaultItems;\r\n            }\r\n        }\r\n\r\n        // GUI looks weird when two separators are side by side. this can happen accidentally\r\n        // if we remove items from the menu then two separators can edit up adjacent.\r\n        _removeRepeatsFromArray(result, MENU_ITEM_SEPARATOR);\r\n\r\n        return result;\r\n    }\r\n\r\n    private getDefaultMenuOptions(column: AgColumn | null): DefaultMenuItem[] {\r\n        const result: DefaultMenuItem[] = [];\r\n\r\n        const { beans, gos } = this;\r\n        const {\r\n            colChooserFactory,\r\n            rowGroupColsSvc,\r\n            colModel,\r\n            expansionSvc,\r\n            sortSvc,\r\n            menuSvc,\r\n            pinnedCols,\r\n            aggFuncSvc,\r\n            colAutosize,\r\n        } = beans;\r\n        const isLegacyMenuEnabled = _isLegacyMenuEnabled(gos);\r\n\r\n        const addColumnItems = () => {\r\n            if (!isLegacyMenuEnabled && colChooserFactory) {\r\n                result.push('columnChooser');\r\n            }\r\n            result.push('resetColumns');\r\n        };\r\n\r\n        if (!column) {\r\n            addColumnItems();\r\n            return result;\r\n        }\r\n\r\n        const { colDef } = column;\r\n        const allowPinning = pinnedCols && !colDef.lockPinned;\r\n\r\n        const rowGroupCount = rowGroupColsSvc?.columns.length ?? 0;\r\n        const doingGrouping = rowGroupCount > 0;\r\n\r\n        const isPrimary = column.isPrimary();\r\n\r\n        const allowValueAgg =\r\n            (aggFuncSvc &&\r\n                // if primary, then only allow aggValue if grouping and it's a value columns\r\n                isPrimary &&\r\n                doingGrouping &&\r\n                column.isAllowValue()) ||\r\n            // secondary columns can always have aggValue, as it means it's a pivot value column\r\n            !isPrimary;\r\n\r\n        if (sortSvc && !isLegacyMenuEnabled && column.isSortable()) {\r\n            const sort = column.getSort();\r\n            if (sort !== 'asc') {\r\n                result.push('sortAscending');\r\n            }\r\n            if (sort !== 'desc') {\r\n                result.push('sortDescending');\r\n            }\r\n            if (sort) {\r\n                result.push('sortUnSort');\r\n            }\r\n            result.push(MENU_ITEM_SEPARATOR);\r\n        }\r\n\r\n        if (menuSvc?.isFilterMenuItemEnabled(column)) {\r\n            result.push('columnFilter');\r\n            result.push(MENU_ITEM_SEPARATOR);\r\n        }\r\n\r\n        if (allowPinning) {\r\n            result.push('pinSubMenu');\r\n        }\r\n\r\n        if (allowValueAgg) {\r\n            result.push('valueAggSubMenu');\r\n        }\r\n\r\n        if (allowPinning || allowValueAgg) {\r\n            result.push(MENU_ITEM_SEPARATOR);\r\n        }\r\n\r\n        if (colAutosize) {\r\n            result.push('autoSizeThis');\r\n            result.push('autoSizeAll');\r\n            result.push(MENU_ITEM_SEPARATOR);\r\n        }\r\n\r\n        if (rowGroupColsSvc && gos.isModuleRegistered('SharedRowGrouping')) {\r\n            const numItems = result.length;\r\n            const showRowGroup = colDef.showRowGroup;\r\n            if (showRowGroup) {\r\n                result.push('rowUnGroup');\r\n            } else if (column.isAllowRowGroup() && isPrimary) {\r\n                if (column.isRowGroupActive()) {\r\n                    const groupLocked = isRowGroupColLocked(column, beans);\r\n                    if (!groupLocked) {\r\n                        result.push('rowUnGroup');\r\n                    }\r\n                } else {\r\n                    result.push('rowGroup');\r\n                }\r\n            }\r\n            if (result.length > numItems) {\r\n                // only add separator if added group items\r\n                result.push(MENU_ITEM_SEPARATOR);\r\n            }\r\n        }\r\n\r\n        addColumnItems();\r\n\r\n        // only add grouping expand/collapse if grouping in the InMemoryRowModel\r\n        // if pivoting, we only have expandable groups if grouping by 2 or more columns\r\n        // as the lowest level group is not expandable while pivoting.\r\n        // if not pivoting, then any active row group can be expanded.\r\n        if (\r\n            expansionSvc &&\r\n            _isClientSideRowModel(gos) &&\r\n            (gos.get('treeData') || rowGroupCount > (colModel.isPivotMode() ? 1 : 0))\r\n        ) {\r\n            result.push('expandAll');\r\n            result.push('contractAll');\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    ColumnEventType,\r\n    DefaultMenuItem,\r\n    IAggFuncService,\r\n    IColsService,\r\n    LocaleTextFunc,\r\n    MenuItemDef,\r\n    NamedBean,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    _createIconNoSpan,\r\n    _escapeString,\r\n    _exists,\r\n    _getRowNode,\r\n    _resetColumnState,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { isRowGroupColLocked } from '../rowGrouping/rowGroupingUtils';\r\nimport type { ChartMenuItemMapper } from './chartMenuItemMapper';\r\nimport type { ColumnChooserFactory } from './columnChooserFactory';\r\n\r\nexport const MENU_ITEM_SEPARATOR = 'separator';\r\n\r\nexport function _removeRepeatsFromArray<T>(array: T[], object: T) {\r\n    if (!array) {\r\n        return;\r\n    }\r\n\r\n    for (let index = array.length - 2; index >= 0; index--) {\r\n        const thisOneMatches = array[index] === object;\r\n        const nextOneMatches = array[index + 1] === object;\r\n\r\n        if (thisOneMatches && nextOneMatches) {\r\n            array.splice(index + 1, 1);\r\n        }\r\n    }\r\n}\r\n\r\nexport class MenuItemMapper extends BeanStub implements NamedBean {\r\n    beanName = 'menuItemMapper' as const;\r\n\r\n    public mapWithStockItems(\r\n        originalList: (MenuItemDef | DefaultMenuItem)[],\r\n        column: AgColumn | null,\r\n        sourceElement: () => HTMLElement,\r\n        source: ColumnEventType\r\n    ): (MenuItemDef | 'separator')[] {\r\n        if (!originalList) {\r\n            return [];\r\n        }\r\n\r\n        const resultList: (MenuItemDef | 'separator')[] = [];\r\n\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const { beans, gos } = this;\r\n        const {\r\n            validation,\r\n            pinnedCols,\r\n            colAutosize,\r\n            aggFuncSvc,\r\n            rowGroupColsSvc,\r\n            colNames,\r\n            colModel,\r\n            clipboardSvc,\r\n            expansionSvc,\r\n            focusSvc,\r\n            csvCreator,\r\n            excelCreator,\r\n            menuSvc,\r\n            colChooserFactory,\r\n            sortSvc,\r\n            chartMenuItemMapper,\r\n            valueColsSvc,\r\n        } = beans;\r\n\r\n        const getStockMenuItem = (\r\n            key: DefaultMenuItem,\r\n            column: AgColumn | null,\r\n            sourceElement: () => HTMLElement,\r\n            source: ColumnEventType\r\n        ): MenuItemDef | 'separator' | null => {\r\n            validation?.validateMenuItem(key);\r\n\r\n            switch (key) {\r\n                case 'pinSubMenu':\r\n                    return pinnedCols && column\r\n                        ? {\r\n                              name: localeTextFunc('pinColumn', 'Pin Column'),\r\n                              icon: _createIconNoSpan('menuPin', beans, null),\r\n                              subMenu: ['clearPinned', 'pinLeft', 'pinRight'],\r\n                          }\r\n                        : null;\r\n                case 'pinLeft':\r\n                    return pinnedCols && column\r\n                        ? {\r\n                              name: localeTextFunc('pinLeft', 'Pin Left'),\r\n                              action: () => pinnedCols.setColsPinned([column], 'left', source),\r\n                              checked: !!column && column.isPinnedLeft(),\r\n                          }\r\n                        : null;\r\n                case 'pinRight':\r\n                    return pinnedCols && column\r\n                        ? {\r\n                              name: localeTextFunc('pinRight', 'Pin Right'),\r\n                              action: () => pinnedCols.setColsPinned([column], 'right', source),\r\n                              checked: !!column && column.isPinnedRight(),\r\n                          }\r\n                        : null;\r\n                case 'clearPinned':\r\n                    return pinnedCols && column\r\n                        ? {\r\n                              name: localeTextFunc('noPin', 'No Pin'),\r\n                              action: () => pinnedCols.setColsPinned([column], null, source),\r\n                              checked: !!column && !column.isPinned(),\r\n                          }\r\n                        : null;\r\n                case 'valueAggSubMenu':\r\n                    if (aggFuncSvc && valueColsSvc && (column?.isPrimary() || column?.getColDef().pivotValueColumn)) {\r\n                        return {\r\n                            name: localeTextFunc('valueAggregation', 'Value Aggregation'),\r\n                            icon: _createIconNoSpan('menuValue', beans, null),\r\n                            subMenu: createAggregationSubMenu(column!, aggFuncSvc, valueColsSvc, localeTextFunc),\r\n                            disabled: gos.get('functionsReadOnly'),\r\n                        };\r\n                    } else {\r\n                        return null;\r\n                    }\r\n                case 'autoSizeThis':\r\n                    return colAutosize\r\n                        ? {\r\n                              name: localeTextFunc('autosizeThisColumn', 'Autosize This Column'),\r\n                              action: () => colAutosize.autoSizeColumn(column, source, gos.get('skipHeaderOnAutoSize')),\r\n                          }\r\n                        : null;\r\n                case 'autoSizeAll':\r\n                    return colAutosize\r\n                        ? {\r\n                              name: localeTextFunc('autosizeAllColumns', 'Autosize All Columns'),\r\n                              action: () => colAutosize.autoSizeAllColumns(source, gos.get('skipHeaderOnAutoSize')),\r\n                          }\r\n                        : null;\r\n                case 'rowGroup':\r\n                    return rowGroupColsSvc\r\n                        ? {\r\n                              name:\r\n                                  localeTextFunc('groupBy', 'Group by') +\r\n                                  ' ' +\r\n                                  _escapeString(colNames.getDisplayNameForColumn(column, 'header')),\r\n                              disabled:\r\n                                  gos.get('functionsReadOnly') ||\r\n                                  column?.isRowGroupActive() ||\r\n                                  !column?.getColDef().enableRowGroup,\r\n                              action: () => rowGroupColsSvc.addColumns([column], source),\r\n                              icon: _createIconNoSpan('menuAddRowGroup', beans, null),\r\n                          }\r\n                        : null;\r\n                case 'rowUnGroup': {\r\n                    if (rowGroupColsSvc && gos.isModuleRegistered('SharedRowGrouping')) {\r\n                        const showRowGroup = column?.getColDef().showRowGroup;\r\n                        const lockedGroups = gos.get('groupLockGroupColumns');\r\n                        let name: string;\r\n                        let disabled: boolean;\r\n                        let action: () => void;\r\n                        // Handle single auto group column\r\n                        if (showRowGroup === true) {\r\n                            name = localeTextFunc('ungroupAll', 'Un-Group All');\r\n                            disabled =\r\n                                gos.get('functionsReadOnly') ||\r\n                                lockedGroups === -1 ||\r\n                                lockedGroups >= (rowGroupColsSvc.columns.length ?? 0);\r\n                            action = () =>\r\n                                rowGroupColsSvc.setColumns(rowGroupColsSvc.columns.slice(0, lockedGroups), source);\r\n                        } else if (typeof showRowGroup === 'string') {\r\n                            // Handle multiple auto group columns\r\n                            const underlyingColumn = colModel.getColDefCol(showRowGroup);\r\n                            const ungroupByName =\r\n                                underlyingColumn != null\r\n                                    ? _escapeString(colNames.getDisplayNameForColumn(underlyingColumn, 'header'))\r\n                                    : showRowGroup;\r\n                            name = localeTextFunc('ungroupBy', 'Un-Group by') + ' ' + ungroupByName;\r\n                            disabled = gos.get('functionsReadOnly') || isRowGroupColLocked(underlyingColumn, beans);\r\n                            action = () => {\r\n                                rowGroupColsSvc.removeColumns([showRowGroup], source);\r\n                            };\r\n                        } else {\r\n                            // Handle primary column\r\n                            name =\r\n                                localeTextFunc('ungroupBy', 'Un-Group by') +\r\n                                ' ' +\r\n                                _escapeString(colNames.getDisplayNameForColumn(column, 'header'));\r\n                            disabled =\r\n                                gos.get('functionsReadOnly') ||\r\n                                !column?.isRowGroupActive() ||\r\n                                !column?.getColDef().enableRowGroup ||\r\n                                isRowGroupColLocked(column, beans);\r\n                            action = () => rowGroupColsSvc.removeColumns([column], source);\r\n                        }\r\n                        return {\r\n                            name,\r\n                            disabled,\r\n                            action,\r\n                            icon: _createIconNoSpan('menuRemoveRowGroup', beans, null),\r\n                        };\r\n                    } else {\r\n                        return null;\r\n                    }\r\n                }\r\n                case 'resetColumns':\r\n                    return {\r\n                        name: localeTextFunc('resetColumns', 'Reset Columns'),\r\n                        action: () => _resetColumnState(beans, source),\r\n                    };\r\n                case 'expandAll':\r\n                    return expansionSvc\r\n                        ? {\r\n                              name: localeTextFunc('expandAll', 'Expand All Row Groups'),\r\n                              action: () => expansionSvc.expandAll(true),\r\n                          }\r\n                        : null;\r\n                case 'contractAll':\r\n                    return expansionSvc\r\n                        ? {\r\n                              name: localeTextFunc('collapseAll', 'Collapse All Row Groups'),\r\n                              action: () => expansionSvc.expandAll(false),\r\n                          }\r\n                        : null;\r\n                case 'copy':\r\n                    return clipboardSvc\r\n                        ? {\r\n                              name: localeTextFunc('copy', 'Copy'),\r\n                              shortcut: localeTextFunc('ctrlC', 'Ctrl+C'),\r\n                              icon: _createIconNoSpan('clipboardCopy', beans, null),\r\n                              action: () => clipboardSvc.copyToClipboard(),\r\n                          }\r\n                        : null;\r\n                case 'copyWithHeaders':\r\n                    return clipboardSvc\r\n                        ? {\r\n                              name: localeTextFunc('copyWithHeaders', 'Copy with Headers'),\r\n                              // shortcut: localeTextFunc('ctrlC','Ctrl+C'),\r\n                              icon: _createIconNoSpan('clipboardCopy', beans, null),\r\n                              action: () => clipboardSvc.copyToClipboard({ includeHeaders: true }),\r\n                          }\r\n                        : null;\r\n                case 'copyWithGroupHeaders':\r\n                    return clipboardSvc\r\n                        ? {\r\n                              name: localeTextFunc('copyWithGroupHeaders', 'Copy with Group Headers'),\r\n                              // shortcut: localeTextFunc('ctrlC','Ctrl+C'),\r\n                              icon: _createIconNoSpan('clipboardCopy', beans, null),\r\n                              action: () =>\r\n                                  clipboardSvc.copyToClipboard({ includeHeaders: true, includeGroupHeaders: true }),\r\n                          }\r\n                        : null;\r\n                case 'cut':\r\n                    if (clipboardSvc) {\r\n                        const focusedCell = focusSvc.getFocusedCell();\r\n                        const rowNode = focusedCell ? _getRowNode(beans, focusedCell) : null;\r\n                        const isEditable = rowNode ? focusedCell?.column.isCellEditable(rowNode) : false;\r\n                        return {\r\n                            name: localeTextFunc('cut', 'Cut'),\r\n                            shortcut: localeTextFunc('ctrlX', 'Ctrl+X'),\r\n                            icon: _createIconNoSpan('clipboardCut', beans, null),\r\n                            disabled: !isEditable || gos.get('suppressCutToClipboard'),\r\n                            action: () => clipboardSvc.cutToClipboard(undefined, 'contextMenu'),\r\n                        };\r\n                    } else {\r\n                        return null;\r\n                    }\r\n                case 'paste':\r\n                    return clipboardSvc\r\n                        ? {\r\n                              name: localeTextFunc('paste', 'Paste'),\r\n                              shortcut: localeTextFunc('ctrlV', 'Ctrl+V'),\r\n                              disabled: true,\r\n                              icon: _createIconNoSpan('clipboardPaste', beans, null),\r\n                              action: () => clipboardSvc.pasteFromClipboard(),\r\n                          }\r\n                        : null;\r\n                case 'export': {\r\n                    const exportSubMenuItems: string[] = [];\r\n\r\n                    if (!gos.get('suppressCsvExport') && csvCreator) {\r\n                        exportSubMenuItems.push('csvExport');\r\n                    }\r\n                    if (!gos.get('suppressExcelExport') && excelCreator) {\r\n                        exportSubMenuItems.push('excelExport');\r\n                    }\r\n                    return exportSubMenuItems.length\r\n                        ? {\r\n                              name: localeTextFunc('export', 'Export'),\r\n                              subMenu: exportSubMenuItems,\r\n                              icon: _createIconNoSpan('save', beans, null),\r\n                          }\r\n                        : null;\r\n                }\r\n                case 'csvExport':\r\n                    return csvCreator\r\n                        ? {\r\n                              name: localeTextFunc('csvExport', 'CSV Export'),\r\n                              icon: _createIconNoSpan('csvExport', beans, null),\r\n                              action: () => csvCreator.exportDataAsCsv(),\r\n                          }\r\n                        : null;\r\n                case 'excelExport':\r\n                    return excelCreator\r\n                        ? {\r\n                              name: localeTextFunc('excelExport', 'Excel Export'),\r\n                              icon: _createIconNoSpan('excelExport', beans, null),\r\n                              action: () => excelCreator.exportDataAsExcel(),\r\n                          }\r\n                        : null;\r\n                case 'separator':\r\n                    return 'separator';\r\n                case 'pivotChart':\r\n                case 'chartRange':\r\n                    return (chartMenuItemMapper as ChartMenuItemMapper).getChartItems(key);\r\n                case 'columnFilter':\r\n                    return menuSvc && column\r\n                        ? {\r\n                              name: localeTextFunc('columnFilter', 'Column Filter'),\r\n                              icon: _createIconNoSpan('filter', beans, null),\r\n                              action: () =>\r\n                                  menuSvc.showFilterMenu({\r\n                                      column,\r\n                                      buttonElement: sourceElement(),\r\n                                      containerType: 'columnFilter',\r\n                                      positionBy: 'button',\r\n                                  }),\r\n                          }\r\n                        : null;\r\n                case 'columnChooser':\r\n                    return colChooserFactory\r\n                        ? {\r\n                              name: localeTextFunc('columnChooser', 'Choose Columns'),\r\n                              icon: _createIconNoSpan('columns', beans, null),\r\n                              action: () =>\r\n                                  (colChooserFactory as ColumnChooserFactory).showColumnChooser({\r\n                                      column,\r\n                                      eventSource: sourceElement(),\r\n                                  }),\r\n                          }\r\n                        : null;\r\n                case 'sortAscending':\r\n                    return sortSvc\r\n                        ? {\r\n                              name: localeTextFunc('sortAscending', 'Sort Ascending'),\r\n                              icon: _createIconNoSpan('sortAscending', beans, null),\r\n                              action: () => sortSvc.setSortForColumn(column!, 'asc', false, source),\r\n                          }\r\n                        : null;\r\n                case 'sortDescending':\r\n                    return sortSvc\r\n                        ? {\r\n                              name: localeTextFunc('sortDescending', 'Sort Descending'),\r\n                              icon: _createIconNoSpan('sortDescending', beans, null),\r\n                              action: () => sortSvc.setSortForColumn(column!, 'desc', false, source),\r\n                          }\r\n                        : null;\r\n                case 'sortUnSort':\r\n                    return sortSvc\r\n                        ? {\r\n                              name: localeTextFunc('sortUnSort', 'Clear Sort'),\r\n                              icon: _createIconNoSpan('sortUnSort', beans, null),\r\n                              action: () => sortSvc.setSortForColumn(column!, null, false, source),\r\n                          }\r\n                        : null;\r\n                default: {\r\n                    _warn(176, { key });\r\n                    return null;\r\n                }\r\n            }\r\n        };\r\n\r\n        originalList.forEach((menuItemOrString) => {\r\n            let result: MenuItemDef | 'separator' | null;\r\n\r\n            if (typeof menuItemOrString === 'string') {\r\n                result = getStockMenuItem(menuItemOrString as DefaultMenuItem, column, sourceElement, source);\r\n            } else {\r\n                // Spread to prevent leaking mapped subMenus back into the original menuItem\r\n                result = { ...menuItemOrString };\r\n            }\r\n            // if no mapping, can happen when module is not loaded but user tries to use module anyway\r\n            if (!result) {\r\n                return;\r\n            }\r\n\r\n            const resultDef = result as MenuItemDef;\r\n            const { subMenu } = resultDef;\r\n\r\n            if (subMenu && subMenu instanceof Array) {\r\n                resultDef.subMenu = this.mapWithStockItems(\r\n                    subMenu as (DefaultMenuItem | MenuItemDef)[],\r\n                    column,\r\n                    sourceElement,\r\n                    source\r\n                );\r\n            }\r\n\r\n            if (result != null) {\r\n                resultList.push(result);\r\n            }\r\n        });\r\n\r\n        // items could have been removed due to missing modules\r\n        _removeRepeatsFromArray(resultList, MENU_ITEM_SEPARATOR);\r\n\r\n        return resultList;\r\n    }\r\n}\r\nfunction createAggregationSubMenu(\r\n    column: AgColumn,\r\n    aggFuncSvc: IAggFuncService,\r\n    valueColsSvc: IColsService,\r\n    localeTextFunc: LocaleTextFunc\r\n): MenuItemDef[] {\r\n    let columnToUse: AgColumn | undefined;\r\n    if (column.isPrimary()) {\r\n        columnToUse = column;\r\n    } else {\r\n        const pivotValueColumn = column.getColDef().pivotValueColumn as AgColumn;\r\n        columnToUse = _exists(pivotValueColumn) ? pivotValueColumn : undefined;\r\n    }\r\n\r\n    const result: MenuItemDef[] = [];\r\n    if (columnToUse) {\r\n        const columnIsAlreadyAggValue = columnToUse.isValueActive();\r\n        const funcNames = aggFuncSvc.getFuncNames(columnToUse);\r\n\r\n        result.push({\r\n            name: localeTextFunc('noAggregation', 'None'),\r\n            action: () => {\r\n                valueColsSvc.removeColumns([columnToUse!], 'contextMenu');\r\n                valueColsSvc.setColumnAggFunc!(columnToUse, undefined, 'contextMenu');\r\n            },\r\n            checked: !columnIsAlreadyAggValue,\r\n        });\r\n\r\n        funcNames.forEach((funcName) => {\r\n            result.push({\r\n                name: localeTextFunc(funcName, aggFuncSvc.getDefaultFuncLabel(funcName)),\r\n                action: () => {\r\n                    valueColsSvc.setColumnAggFunc!(columnToUse, funcName, 'contextMenu');\r\n                    valueColsSvc.addColumns([columnToUse!], 'contextMenu');\r\n                },\r\n                checked: columnIsAlreadyAggValue && columnToUse!.getAggFunc() === funcName,\r\n            });\r\n        });\r\n    }\r\n\r\n    return result;\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    CellCtrl,\r\n    CellPosition,\r\n    DefaultMenuItem,\r\n    EventShowContextMenuParams,\r\n    IAfterGuiAttachedParams,\r\n    IContextMenuService,\r\n    MenuItemDef,\r\n    MouseShowContextMenuParams,\r\n    NamedBean,\r\n    RowCtrl,\r\n    RowNode,\r\n    TouchShowContextMenuParam,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    Component,\r\n    _anchorElementToMouseMoveEvent,\r\n    _areCellsEqual,\r\n    _createIconNoSpan,\r\n    _exists,\r\n    _focusInto,\r\n    _getPageBody,\r\n    _getRootNode,\r\n    _isIOSUserAgent,\r\n    _isKeyboardMode,\r\n    _isNothingFocused,\r\n    _isPromise,\r\n    _isVisible,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { CloseMenuEvent } from '../widgets/agMenuItemComponent';\r\nimport { AgMenuList } from '../widgets/agMenuList';\r\nimport type { MenuItemMapper } from './menuItemMapper';\r\nimport type { MenuUtils } from './menuUtils';\r\n\r\nconst CSS_MENU = 'ag-menu';\r\nconst CSS_CONTEXT_MENU_OPEN = 'ag-context-menu-open';\r\nconst CSS_CONTEXT_MENU_LOADING_ICON = 'ag-context-menu-loading-icon';\r\n\r\nexport class ContextMenuService extends BeanStub implements NamedBean, IContextMenuService {\r\n    beanName = 'contextMenuSvc' as const;\r\n\r\n    private destroyLoadingSpinner: (() => void) | null = null;\r\n    private lastPromise: number = 0;\r\n\r\n    private activeMenu: ContextMenu | null;\r\n\r\n    public hideActiveMenu(): void {\r\n        this.destroyBean(this.activeMenu);\r\n    }\r\n\r\n    private getMenuItems(\r\n        node: RowNode | null,\r\n        column: AgColumn | null,\r\n        value: any,\r\n        mouseEvent: MouseEvent | Touch\r\n    ): (DefaultMenuItem | MenuItemDef<any, any>)[] | Promise<(DefaultMenuItem | MenuItemDef<any, any>)[]> | undefined {\r\n        const defaultMenuOptions: DefaultMenuItem[] = [];\r\n\r\n        const { clipboardSvc, chartSvc, csvCreator, excelCreator, colModel, rangeSvc, gos } = this.beans;\r\n\r\n        if (_exists(node) && clipboardSvc) {\r\n            if (column) {\r\n                // only makes sense if column exists, could have originated from a row\r\n                if (!gos.get('suppressCutToClipboard')) {\r\n                    defaultMenuOptions.push('cut');\r\n                }\r\n                defaultMenuOptions.push('copy', 'copyWithHeaders', 'copyWithGroupHeaders', 'paste', 'separator');\r\n            }\r\n        }\r\n\r\n        if (gos.get('enableCharts') && chartSvc) {\r\n            if (colModel.isPivotMode()) {\r\n                defaultMenuOptions.push('pivotChart');\r\n            }\r\n\r\n            if (rangeSvc && !rangeSvc.isEmpty()) {\r\n                defaultMenuOptions.push('chartRange');\r\n            }\r\n        }\r\n\r\n        if (_exists(node)) {\r\n            // if user clicks a cell\r\n            const suppressExcel = gos.get('suppressExcelExport') || !excelCreator;\r\n            const suppressCsv = gos.get('suppressCsvExport') || !csvCreator;\r\n            const onIPad = _isIOSUserAgent();\r\n            const anyExport: boolean = !onIPad && (!suppressExcel || !suppressCsv);\r\n            if (anyExport) {\r\n                defaultMenuOptions.push('export');\r\n            }\r\n        }\r\n\r\n        const defaultItems = defaultMenuOptions.length ? defaultMenuOptions : undefined;\r\n        const columnContextMenuItems = column?.getColDef().contextMenuItems;\r\n\r\n        if (Array.isArray(columnContextMenuItems)) {\r\n            return columnContextMenuItems;\r\n        }\r\n\r\n        if (typeof columnContextMenuItems === 'function') {\r\n            return columnContextMenuItems(\r\n                gos.addGridCommonParams({\r\n                    column,\r\n                    node,\r\n                    value,\r\n                    defaultItems,\r\n                    event: mouseEvent,\r\n                })\r\n            );\r\n        }\r\n\r\n        const userFunc = gos.getCallback('getContextMenuItems');\r\n\r\n        if (userFunc) {\r\n            return userFunc({ column, node, value, defaultItems, event: mouseEvent });\r\n        }\r\n\r\n        return defaultMenuOptions;\r\n    }\r\n\r\n    public getContextMenuPosition(rowNode?: RowNode | null, column?: AgColumn | null): { x: number; y: number } {\r\n        const rowCtrl = this.getRowCtrl(rowNode);\r\n        const eGui = this.getCellGui(rowCtrl, column);\r\n\r\n        if (!eGui) {\r\n            if (rowCtrl) {\r\n                return { x: 0, y: rowCtrl.getRowYPosition() };\r\n            }\r\n            return { x: 0, y: 0 };\r\n        }\r\n\r\n        const rect = eGui.getBoundingClientRect();\r\n\r\n        return {\r\n            x: rect.x + rect.width / 2,\r\n            y: rect.y + rect.height / 2,\r\n        };\r\n    }\r\n\r\n    public showContextMenu(params: EventShowContextMenuParams & { anchorToElement?: HTMLElement }): void {\r\n        const rowNode = params.rowNode as RowNode | null | undefined;\r\n        const column = params.column as AgColumn | null | undefined;\r\n        let { anchorToElement, value } = params;\r\n\r\n        if (rowNode && column && value == null) {\r\n            value = this.beans.valueSvc.getValueForDisplay(column, rowNode);\r\n        }\r\n\r\n        if (anchorToElement == null) {\r\n            anchorToElement = this.getContextMenuAnchorElement(rowNode, column);\r\n        }\r\n\r\n        this.onContextMenu(\r\n            (params as MouseShowContextMenuParams).mouseEvent ?? null,\r\n            (params as TouchShowContextMenuParam).touchEvent ?? null,\r\n            rowNode ?? null,\r\n            column ?? null,\r\n            value,\r\n            anchorToElement\r\n        );\r\n    }\r\n\r\n    public handleContextMenuMouseEvent(\r\n        mouseEvent: MouseEvent | undefined,\r\n        touchEvent: TouchEvent | undefined,\r\n        rowComp: RowCtrl | null,\r\n        cellCtrl: CellCtrl\r\n    ): void {\r\n        const rowNode = rowComp?.rowNode ?? null;\r\n        const column = cellCtrl?.column ?? null;\r\n        let value = null;\r\n        const { valueSvc, ctrlsSvc } = this.beans;\r\n\r\n        if (column) {\r\n            const event = mouseEvent ? mouseEvent : touchEvent;\r\n            cellCtrl.dispatchCellContextMenuEvent(event ?? null);\r\n            value = valueSvc.getValue(column, rowNode);\r\n        }\r\n\r\n        // if user clicked on a cell, anchor to that cell, otherwise anchor to the grid panel\r\n        const gridBodyCon = ctrlsSvc.getGridBodyCtrl();\r\n        const anchorToElement = cellCtrl ? cellCtrl.eGui : gridBodyCon.eGridBody;\r\n\r\n        this.showContextMenu({\r\n            mouseEvent,\r\n            touchEvent,\r\n            rowNode,\r\n            column,\r\n            value,\r\n            anchorToElement,\r\n        } as EventShowContextMenuParams);\r\n    }\r\n\r\n    private onContextMenu(\r\n        mouseEvent: MouseEvent | null,\r\n        touchEvent: TouchEvent | null,\r\n        rowNode: RowNode | null,\r\n        column: AgColumn | null,\r\n        value: any,\r\n        anchorToElement: HTMLElement\r\n    ): void {\r\n        (this.beans.menuUtils as MenuUtils).onContextMenu(mouseEvent, touchEvent, (eventOrTouch) =>\r\n            this.showMenu(rowNode, column, value, eventOrTouch, anchorToElement)\r\n        );\r\n    }\r\n\r\n    private showMenu(\r\n        node: RowNode | null,\r\n        column: AgColumn | null,\r\n        value: any,\r\n        mouseEvent: MouseEvent | Touch,\r\n        anchorToElement: HTMLElement\r\n    ): boolean {\r\n        const menuItems = this.getMenuItems(node, column, value, mouseEvent);\r\n\r\n        if (_isPromise<(DefaultMenuItem | MenuItemDef)[]>(menuItems)) {\r\n            const currentPromise = this.lastPromise + 1;\r\n            this.lastPromise = currentPromise;\r\n            if (!this.destroyLoadingSpinner) {\r\n                this.createLoadingIcon(mouseEvent);\r\n            }\r\n\r\n            menuItems.then((menuItems) => {\r\n                if (this.lastPromise !== currentPromise) {\r\n                    return;\r\n                }\r\n\r\n                const shouldShowMenu =\r\n                    // check if there are actual menu items to be displayed\r\n                    menuItems &&\r\n                    menuItems.length &&\r\n                    // check if the element that triggered the context menu was removed from the DOM\r\n                    _isVisible(mouseEvent.target as HTMLElement) &&\r\n                    // overlay was displayed\r\n                    !this.beans.overlays?.isExclusive();\r\n\r\n                if (shouldShowMenu) {\r\n                    this.createContextMenu({ menuItems, node, column, value, mouseEvent, anchorToElement });\r\n                }\r\n\r\n                if (this.destroyLoadingSpinner) {\r\n                    this.destroyLoadingSpinner();\r\n                }\r\n            });\r\n            return true;\r\n        }\r\n\r\n        if (menuItems === undefined || !menuItems?.length) {\r\n            return false;\r\n        }\r\n\r\n        this.createContextMenu({ menuItems, node, column, value, mouseEvent, anchorToElement });\r\n\r\n        return true;\r\n    }\r\n\r\n    private createLoadingIcon(mouseEvent: MouseEvent | Touch) {\r\n        const { beans } = this;\r\n        const translate = this.getLocaleTextFunc();\r\n        const loadingIcon = _createIconNoSpan('loadingMenuItems', beans) as HTMLElement;\r\n        const wrapperEl = document.createElement('div');\r\n        wrapperEl.classList.add(CSS_CONTEXT_MENU_LOADING_ICON);\r\n        wrapperEl.appendChild(loadingIcon);\r\n\r\n        const rootNode = _getRootNode(beans);\r\n        const targetEl = _getPageBody(beans);\r\n\r\n        if (!targetEl) {\r\n            _warn(54);\r\n            return;\r\n        }\r\n\r\n        targetEl.appendChild(wrapperEl);\r\n        beans.ariaAnnounce?.announceValue(\r\n            translate('ariaLabelLoadingContextMenu', 'Loading Context Menu'),\r\n            'contextmenu'\r\n        );\r\n        beans.environment.applyThemeClasses(wrapperEl);\r\n        _anchorElementToMouseMoveEvent(wrapperEl, mouseEvent, beans);\r\n\r\n        const mouseMoveCallback = (e: MouseEvent) => {\r\n            _anchorElementToMouseMoveEvent(wrapperEl, e, beans);\r\n        };\r\n\r\n        rootNode.addEventListener('mousemove', mouseMoveCallback);\r\n\r\n        this.destroyLoadingSpinner = () => {\r\n            rootNode.removeEventListener('mousemove', mouseMoveCallback);\r\n            targetEl.removeChild(wrapperEl);\r\n            this.destroyLoadingSpinner = null;\r\n        };\r\n    }\r\n\r\n    private createContextMenu(params: {\r\n        menuItems: (DefaultMenuItem | MenuItemDef<any, any>)[];\r\n        node: RowNode | null;\r\n        column: AgColumn | null;\r\n        value: any;\r\n        mouseEvent: MouseEvent | Touch;\r\n        anchorToElement: HTMLElement;\r\n    }): void {\r\n        const { menuItems, node, column, value, mouseEvent, anchorToElement } = params;\r\n        const { ctrlsSvc, focusSvc, popupSvc } = this.beans;\r\n\r\n        const eGridBodyGui = ctrlsSvc.getGridBodyCtrl().eGridBody;\r\n        const menu = new ContextMenu(menuItems, column, node, value);\r\n        this.createBean(menu);\r\n\r\n        const eMenuGui = menu.getGui();\r\n\r\n        if (!column) {\r\n            // the context menu has been opened not on a cell, therefore we don't want to\r\n            // display the previous cell as focused, or return focus there after\r\n            focusSvc.clearFocusedCell();\r\n        }\r\n\r\n        const positionParams = {\r\n            column: column,\r\n            rowNode: node,\r\n            type: 'contextMenu',\r\n            mouseEvent: mouseEvent,\r\n            ePopup: eMenuGui,\r\n            // move one pixel away so that accidentally double clicking\r\n            // won't show the browser's contextmenu\r\n            nudgeY: 1,\r\n        };\r\n\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        const addPopupRes = popupSvc!.addPopup({\r\n            modal: true,\r\n            eChild: eMenuGui,\r\n            closeOnEsc: true,\r\n            closedCallback: (e) => {\r\n                eGridBodyGui.classList.remove(CSS_CONTEXT_MENU_OPEN);\r\n                this.destroyBean(menu);\r\n                this.dispatchVisibleChangedEvent(false, e === undefined ? 'api' : 'ui');\r\n            },\r\n            click: mouseEvent,\r\n            positionCallback: () => {\r\n                const isRtl = this.gos.get('enableRtl');\r\n                popupSvc!.positionPopupUnderMouseEvent({\r\n                    ...positionParams,\r\n                    nudgeX: isRtl ? (eMenuGui.offsetWidth + 1) * -1 : 1,\r\n                });\r\n            },\r\n            // so when browser is scrolled down, or grid is scrolled, context menu stays with cell\r\n            anchorToElement: anchorToElement,\r\n            ariaLabel: translate('ariaLabelContextMenu', 'Context Menu'),\r\n        });\r\n\r\n        if (addPopupRes) {\r\n            eGridBodyGui.classList.add(CSS_CONTEXT_MENU_OPEN);\r\n            menu.afterGuiAttached({ container: 'contextMenu', hidePopup: addPopupRes.hideFunc });\r\n        }\r\n\r\n        // there should never be an active menu at this point, however it was found\r\n        // that you could right click a second time just 1 or 2 pixels from the first\r\n        // click, and another menu would pop up. so somehow the logic for closing the\r\n        // first menu (clicking outside should close it) was glitchy somehow. an easy\r\n        // way to avoid this is just remove the old context menu here if it exists.\r\n        if (this.activeMenu) {\r\n            this.hideActiveMenu();\r\n        }\r\n\r\n        this.activeMenu = menu;\r\n\r\n        menu.addEventListener('destroyed', () => {\r\n            if (this.activeMenu === menu) {\r\n                this.activeMenu = null;\r\n            }\r\n        });\r\n\r\n        // hide the popup if something gets selected\r\n        if (addPopupRes) {\r\n            menu.addEventListener('closeMenu', (e: CloseMenuEvent) =>\r\n                addPopupRes.hideFunc({\r\n                    mouseEvent: e.mouseEvent ?? undefined,\r\n                    keyboardEvent: e.keyboardEvent ?? undefined,\r\n                    forceHide: true,\r\n                })\r\n            );\r\n        }\r\n\r\n        // we check for a mousedown event because `gridApi.showContextMenu`\r\n        // generates a `mousedown` event to display the context menu.\r\n        const isApi = mouseEvent && mouseEvent instanceof MouseEvent && mouseEvent.type === 'mousedown';\r\n        this.dispatchVisibleChangedEvent(true, isApi ? 'api' : 'ui');\r\n    }\r\n\r\n    private dispatchVisibleChangedEvent(visible: boolean, source: 'api' | 'ui' = 'ui'): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'contextMenuVisibleChanged',\r\n            visible,\r\n            source,\r\n        });\r\n    }\r\n\r\n    private getRowCtrl(rowNode?: RowNode | null): RowCtrl | undefined {\r\n        const { rowIndex, rowPinned } = rowNode || {};\r\n\r\n        if (rowIndex == null) {\r\n            return;\r\n        }\r\n\r\n        return this.beans.rowRenderer.getRowByPosition({ rowIndex, rowPinned }) || undefined;\r\n    }\r\n\r\n    private getCellGui(rowCtrl?: RowCtrl, column?: AgColumn | null): HTMLElement | undefined {\r\n        if (!rowCtrl || !column) {\r\n            return;\r\n        }\r\n\r\n        const cellCtrl = rowCtrl.getCellCtrl(column);\r\n\r\n        return cellCtrl?.eGui || undefined;\r\n    }\r\n\r\n    private getContextMenuAnchorElement(rowNode?: RowNode | null, column?: AgColumn | null): HTMLElement {\r\n        const gridBodyEl = this.beans.ctrlsSvc.getGridBodyCtrl().eGridBody;\r\n        const rowCtrl = this.getRowCtrl(rowNode);\r\n\r\n        if (!rowCtrl) {\r\n            return gridBodyEl;\r\n        }\r\n\r\n        const cellGui = this.getCellGui(rowCtrl, column);\r\n\r\n        if (cellGui) {\r\n            return cellGui;\r\n        }\r\n\r\n        if (rowCtrl.isFullWidth()) {\r\n            return rowCtrl.getFullWidthElement() as HTMLElement;\r\n        }\r\n\r\n        return gridBodyEl;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyLoadingSpinner?.();\r\n        super.destroy();\r\n    }\r\n}\r\n\r\nexport type ContextMenuEvent = 'closeMenu';\r\n\r\nclass ContextMenu extends Component<ContextMenuEvent> {\r\n    private menuList: AgMenuList | null = null;\r\n    private focusedCell: CellPosition | null = null;\r\n\r\n    constructor(\r\n        private readonly menuItems: (MenuItemDef | DefaultMenuItem)[],\r\n        private readonly column: AgColumn | null,\r\n        private readonly node: RowNode | null,\r\n        private readonly value: any\r\n    ) {\r\n        super(/* html */ `<div class=\"${CSS_MENU}\" role=\"presentation\"></div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const menuList = this.createManagedBean(\r\n            new AgMenuList(0, {\r\n                column: this.column,\r\n                node: this.node,\r\n                value: this.value,\r\n            })\r\n        );\r\n        const menuItemsMapped = (this.beans.menuItemMapper as MenuItemMapper).mapWithStockItems(\r\n            this.menuItems,\r\n            null,\r\n            () => this.getGui(),\r\n            'contextMenu'\r\n        );\r\n\r\n        menuList.addMenuItems(menuItemsMapped);\r\n\r\n        this.appendChild(menuList);\r\n        this.menuList = menuList;\r\n\r\n        menuList.addEventListener('closeMenu', (e) => this.dispatchLocalEvent(e));\r\n    }\r\n\r\n    public afterGuiAttached(params: IAfterGuiAttachedParams): void {\r\n        if (params.hidePopup) {\r\n            this.addDestroyFunc(params.hidePopup);\r\n        }\r\n\r\n        this.focusedCell = this.beans.focusSvc.getFocusedCell();\r\n\r\n        const menuList = this.menuList;\r\n        if (menuList) {\r\n            _focusInto(menuList.getGui());\r\n        }\r\n    }\r\n\r\n    private restoreFocusedCell(): void {\r\n        const { beans, focusedCell } = this;\r\n        const focusSvc = beans.focusSvc;\r\n        const currentFocusedCell = focusSvc.getFocusedCell();\r\n\r\n        if (currentFocusedCell && focusedCell && _areCellsEqual(currentFocusedCell, focusedCell)) {\r\n            const { rowIndex, rowPinned, column } = focusedCell;\r\n\r\n            if (_isNothingFocused(beans)) {\r\n                focusSvc.setFocusedCell({\r\n                    rowIndex,\r\n                    column,\r\n                    rowPinned,\r\n                    forceBrowserFocus: true,\r\n                    preventScrollOnBrowserFocus: !_isKeyboardMode(),\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.restoreFocusedCell();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AgEvent,\r\n    AgProvidedColumnGroup,\r\n    Bean,\r\n    ColumnMenuTab,\r\n    ComponentEvent,\r\n    ContainerType,\r\n    DefaultMenuItem,\r\n    IAfterGuiAttachedParams,\r\n    IMenuFactory,\r\n    MenuItemDef,\r\n    NamedBean,\r\n    PopupEventParams,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgPromise,\r\n    BeanStub,\r\n    Component,\r\n    FilterWrapperComp,\r\n    RefPlaceholder,\r\n    _createIconNoSpan,\r\n    _error,\r\n    _focusInto,\r\n    _isColumnMenuAnchoringEnabled,\r\n    _isLegacyMenuEnabled,\r\n    _setColMenuVisible,\r\n    _warn,\r\n    isColumn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { CloseMenuEvent } from '../widgets/agMenuItemComponent';\r\nimport type { AgMenuList } from '../widgets/agMenuList';\r\nimport type { TabbedItem } from '../widgets/iTabbedLayout';\r\nimport { TabbedLayout } from '../widgets/tabbedLayout';\r\nimport type { ColumnChooserFactory } from './columnChooserFactory';\r\nimport type { ColumnMenuFactory } from './columnMenuFactory';\r\nimport type { MenuRestoreFocusParams, MenuUtils } from './menuUtils';\r\n\r\nexport interface TabSelectedEvent extends AgEvent<'tabSelected'> {\r\n    key: string;\r\n}\r\n\r\ninterface EnterpriseColumnMenu extends Bean {\r\n    getGui(): HTMLElement;\r\n    showTab?(tab: string): void;\r\n    afterGuiAttached(params?: IAfterGuiAttachedParams): void;\r\n    showTabBasedOnPreviousSelection?(): void;\r\n}\r\n\r\nconst TAB_FILTER = 'filterMenuTab' as const;\r\nconst TAB_GENERAL = 'generalMenuTab' as const;\r\nconst TAB_COLUMNS = 'columnsMenuTab' as const;\r\nconst TABS_DEFAULT: ColumnMenuTab[] = [TAB_GENERAL, TAB_FILTER, TAB_COLUMNS];\r\n\r\nexport class EnterpriseMenuFactory extends BeanStub implements NamedBean, IMenuFactory {\r\n    beanName = 'enterpriseMenuFactory' as const;\r\n\r\n    private lastSelectedTab: string;\r\n    private activeMenu: EnterpriseColumnMenu | null;\r\n\r\n    public hideActiveMenu(): void {\r\n        this.destroyBean(this.activeMenu);\r\n    }\r\n\r\n    public showMenuAfterMouseEvent(\r\n        columnOrGroup: AgColumn | AgProvidedColumnGroup | undefined,\r\n        mouseEvent: MouseEvent | Touch,\r\n        containerType: ContainerType,\r\n        filtersOnly?: boolean\r\n    ): void {\r\n        const { column, columnGroup } = this.splitColumnOrGroup(columnOrGroup);\r\n        const defaultTab = filtersOnly ? 'filterMenuTab' : undefined;\r\n        this.showMenu(\r\n            column,\r\n            columnGroup,\r\n            (menu: EnterpriseColumnMenu) => {\r\n                const ePopup = menu.getGui();\r\n\r\n                this.beans.popupSvc!.positionPopupUnderMouseEvent({\r\n                    type: containerType,\r\n                    column,\r\n                    mouseEvent,\r\n                    ePopup,\r\n                });\r\n\r\n                if (defaultTab) {\r\n                    menu.showTab?.(defaultTab);\r\n                }\r\n                this.dispatchVisibleChangedEvent(true, false, column, columnGroup, defaultTab);\r\n            },\r\n            containerType,\r\n            defaultTab,\r\n            undefined,\r\n            mouseEvent.target as HTMLElement\r\n        );\r\n    }\r\n\r\n    private splitColumnOrGroup(columnOrGroup: AgColumn | AgProvidedColumnGroup | undefined): {\r\n        column: AgColumn | undefined;\r\n        columnGroup: AgProvidedColumnGroup | undefined;\r\n    } {\r\n        const colIsColumn = columnOrGroup && isColumn(columnOrGroup);\r\n        const column = colIsColumn ? columnOrGroup : undefined;\r\n        const columnGroup = colIsColumn ? undefined : columnOrGroup;\r\n        return { column, columnGroup };\r\n    }\r\n\r\n    public showMenuAfterButtonClick(\r\n        columnOrGroup: AgColumn | AgProvidedColumnGroup | undefined,\r\n        eventSource: HTMLElement,\r\n        containerType: ContainerType,\r\n        filtersOnly?: boolean\r\n    ): void {\r\n        let multiplier = -1;\r\n        let alignSide: 'left' | 'right' = 'left';\r\n\r\n        if (this.gos.get('enableRtl')) {\r\n            multiplier = 1;\r\n            alignSide = 'right';\r\n        }\r\n\r\n        const defaultTab: ColumnMenuTab | undefined = filtersOnly ? 'filterMenuTab' : undefined;\r\n        const restrictToTabs = defaultTab ? [defaultTab] : undefined;\r\n\r\n        const isLegacyMenuEnabled = _isLegacyMenuEnabled(this.gos);\r\n        const nudgeX = (isLegacyMenuEnabled ? 9 : 4) * multiplier;\r\n        const nudgeY = isLegacyMenuEnabled ? -23 : 4;\r\n\r\n        const { column, columnGroup } = this.splitColumnOrGroup(columnOrGroup);\r\n\r\n        this.showMenu(\r\n            column,\r\n            columnGroup,\r\n            (menu: EnterpriseColumnMenu) => {\r\n                const ePopup = menu.getGui();\r\n\r\n                this.beans.popupSvc!.positionPopupByComponent({\r\n                    type: containerType,\r\n                    column,\r\n                    eventSource,\r\n                    ePopup,\r\n                    alignSide,\r\n                    nudgeX,\r\n                    nudgeY,\r\n                    position: 'under',\r\n                    keepWithinBounds: true,\r\n                });\r\n\r\n                if (defaultTab) {\r\n                    menu.showTab?.(defaultTab);\r\n                }\r\n                this.dispatchVisibleChangedEvent(true, false, column, columnGroup, defaultTab);\r\n            },\r\n            containerType,\r\n            defaultTab,\r\n            restrictToTabs,\r\n            eventSource\r\n        );\r\n    }\r\n\r\n    private showMenu(\r\n        column: AgColumn | undefined,\r\n        columnGroup: AgProvidedColumnGroup | undefined,\r\n        positionCallback: (menu: EnterpriseColumnMenu) => void,\r\n        containerType: ContainerType,\r\n        defaultTab?: string,\r\n        restrictToTabs?: ColumnMenuTab[],\r\n        eventSource?: HTMLElement\r\n    ): void {\r\n        const menuParams = this.getMenuParams(column, columnGroup, restrictToTabs, eventSource);\r\n        if (!menuParams) {\r\n            // can't create menu\r\n            return;\r\n        }\r\n        const { menu, eMenuGui, anchorToElement, restoreFocusParams } = menuParams;\r\n        const closedFuncs: ((e?: Event) => void)[] = [];\r\n        const { menuUtils, popupSvc } = this.beans;\r\n\r\n        closedFuncs.push((e) => {\r\n            const eComp = menu.getGui();\r\n            this.destroyBean(menu);\r\n            if (column) {\r\n                _setColMenuVisible(column, false, 'contextMenu');\r\n                // if we don't have a column, then the menu wasn't launched via keyboard navigation\r\n                (menuUtils as MenuUtils).restoreFocusOnClose(restoreFocusParams, eComp, e);\r\n            }\r\n        });\r\n\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        // need to show filter before positioning, as only after filter\r\n        // is visible can we find out what the width of it is\r\n        popupSvc!.addPopup({\r\n            modal: true,\r\n            eChild: eMenuGui,\r\n            closeOnEsc: true,\r\n            closedCallback: (e?: Event) => {\r\n                // menu closed callback\r\n                closedFuncs.forEach((f) => f(e));\r\n                this.dispatchVisibleChangedEvent(false, false, column, columnGroup, defaultTab);\r\n            },\r\n            afterGuiAttached: (params) =>\r\n                menu.afterGuiAttached(Object.assign({}, { container: containerType }, params)),\r\n            // if defaultTab is not present, positionCallback will be called\r\n            // after `showTabBasedOnPreviousSelection` is called.\r\n            positionCallback: defaultTab ? () => positionCallback(menu) : undefined,\r\n            ariaLabel: translate('ariaLabelColumnMenu', 'Column Menu'),\r\n        });\r\n\r\n        if (!defaultTab) {\r\n            menu.showTabBasedOnPreviousSelection?.();\r\n            // reposition the menu because the method above could load\r\n            // an element that is bigger than enterpriseMenu header.\r\n            positionCallback(menu);\r\n        }\r\n\r\n        if (_isColumnMenuAnchoringEnabled(this.gos)) {\r\n            // if user starts showing / hiding columns, or otherwise move the underlying column\r\n            // for this menu, we want to stop tracking the menu with the column position. otherwise\r\n            // the menu would move as the user is using the columns tab inside the menu.\r\n            const stopAnchoringPromise = popupSvc!.setPopupPositionRelatedToElement(eMenuGui, anchorToElement);\r\n\r\n            if (stopAnchoringPromise && column) {\r\n                this.addStopAnchoring(stopAnchoringPromise, column, closedFuncs);\r\n            }\r\n        }\r\n\r\n        menu.addEventListener('tabSelected', (event: any) => {\r\n            this.dispatchVisibleChangedEvent(false, true, column);\r\n            this.lastSelectedTab = event.key;\r\n            this.dispatchVisibleChangedEvent(true, true, column);\r\n        });\r\n\r\n        if (column) {\r\n            _setColMenuVisible(column, true, 'contextMenu');\r\n        }\r\n\r\n        this.activeMenu = menu;\r\n\r\n        menu.addEventListener('destroyed', () => {\r\n            if (this.activeMenu === menu) {\r\n                this.activeMenu = null;\r\n            }\r\n        });\r\n    }\r\n\r\n    private addStopAnchoring(\r\n        stopAnchoringPromise: AgPromise<() => void>,\r\n        column: AgColumn,\r\n        closedFuncsArr: (() => void)[]\r\n    ) {\r\n        stopAnchoringPromise.then((stopAnchoringFunc: () => void) => {\r\n            column.addEventListener('leftChanged', stopAnchoringFunc);\r\n            column.addEventListener('visibleChanged', stopAnchoringFunc);\r\n\r\n            closedFuncsArr.push(() => {\r\n                column.removeEventListener('leftChanged', stopAnchoringFunc);\r\n                column.removeEventListener('visibleChanged', stopAnchoringFunc);\r\n            });\r\n        });\r\n    }\r\n\r\n    private getMenuParams(\r\n        column?: AgColumn,\r\n        columnGroup?: AgProvidedColumnGroup,\r\n        restrictToTabs?: ColumnMenuTab[],\r\n        eventSource?: HTMLElement\r\n    ) {\r\n        const { focusSvc, visibleCols, ctrlsSvc } = this.beans;\r\n        const restoreFocusParams = {\r\n            column,\r\n            headerPosition: focusSvc.focusedHeader,\r\n            columnIndex: visibleCols.allCols.indexOf(column as AgColumn),\r\n            eventSource,\r\n        };\r\n        const menu = this.createMenu(column, columnGroup, restoreFocusParams, restrictToTabs, eventSource);\r\n        return menu\r\n            ? {\r\n                  menu,\r\n                  eMenuGui: menu.getGui(),\r\n                  anchorToElement: eventSource || ctrlsSvc.getGridBodyCtrl().eGridBody,\r\n                  restoreFocusParams,\r\n              }\r\n            : undefined;\r\n    }\r\n\r\n    private createMenu(\r\n        column: AgColumn | undefined,\r\n        columnGroup: AgProvidedColumnGroup | undefined,\r\n        restoreFocusParams: MenuRestoreFocusParams,\r\n        restrictToTabs?: ColumnMenuTab[],\r\n        eventSource?: HTMLElement\r\n    ): (EnterpriseColumnMenu & BeanStub<TabbedColumnMenuEvent | ComponentEvent>) | undefined {\r\n        if (_isLegacyMenuEnabled(this.gos)) {\r\n            return this.createBean(\r\n                new TabbedColumnMenu(column, restoreFocusParams, this.lastSelectedTab, restrictToTabs, eventSource)\r\n            );\r\n        } else {\r\n            const menuItems = (this.beans.colMenuFactory as ColumnMenuFactory).getMenuItems(column, columnGroup);\r\n            return menuItems.length\r\n                ? this.createBean(new ColumnContextMenu(menuItems, column, restoreFocusParams, eventSource))\r\n                : undefined;\r\n        }\r\n    }\r\n\r\n    private dispatchVisibleChangedEvent(\r\n        visible: boolean,\r\n        switchingTab: boolean,\r\n        column?: AgColumn,\r\n        columnGroup?: AgProvidedColumnGroup,\r\n        defaultTab?: string\r\n    ): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'columnMenuVisibleChanged',\r\n            visible,\r\n            switchingTab,\r\n            key: (this.lastSelectedTab ??\r\n                defaultTab ??\r\n                (_isLegacyMenuEnabled(this.gos) ? TAB_GENERAL : 'columnMenu')) as any,\r\n            column: column ?? null,\r\n            columnGroup: columnGroup ?? null,\r\n        });\r\n    }\r\n\r\n    public isMenuEnabled(column: AgColumn): boolean {\r\n        if (!_isLegacyMenuEnabled(this.gos)) {\r\n            return true;\r\n        }\r\n        // Determine whether there are any tabs to show in the menu, given that the filter tab may be hidden\r\n        const isFilterDisabled = !this.beans.filterManager?.isFilterAllowed(column);\r\n        const tabs = column.getColDef().menuTabs ?? TABS_DEFAULT;\r\n        const numActiveTabs = isFilterDisabled && tabs.includes(TAB_FILTER) ? tabs.length - 1 : tabs.length;\r\n        return numActiveTabs > 0;\r\n    }\r\n\r\n    public showMenuAfterContextMenuEvent(\r\n        column: AgColumn | AgProvidedColumnGroup | undefined,\r\n        mouseEvent?: MouseEvent | null,\r\n        touchEvent?: TouchEvent | null\r\n    ): void {\r\n        (this.beans.menuUtils as MenuUtils).onContextMenu(mouseEvent, touchEvent, (eventOrTouch) => {\r\n            this.showMenuAfterMouseEvent(column, eventOrTouch, 'columnMenu');\r\n            return true;\r\n        });\r\n    }\r\n}\r\n\r\ntype TabbedColumnMenuEvent = 'tabSelected' | 'and';\r\nclass TabbedColumnMenu extends BeanStub<TabbedColumnMenuEvent> implements EnterpriseColumnMenu {\r\n    private tabbedLayout: TabbedLayout;\r\n    private hidePopupFunc: (popupParams?: PopupEventParams) => void;\r\n    private mainMenuList: AgMenuList;\r\n\r\n    private tabItemFilter: TabbedItem;\r\n    private tabItemGeneral: TabbedItem;\r\n    private tabItemColumns: TabbedItem;\r\n\r\n    private tabFactories: { [p: string]: () => TabbedItem } = {};\r\n    private includeChecks: { [p: string]: () => boolean } = {};\r\n\r\n    private filterComp?: FilterWrapperComp | null;\r\n\r\n    constructor(\r\n        private readonly column: AgColumn | undefined,\r\n        private readonly restoreFocusParams: MenuRestoreFocusParams,\r\n        private readonly initialSelection: string,\r\n        private readonly restrictTo?: ColumnMenuTab[],\r\n        private readonly sourceElement?: HTMLElement\r\n    ) {\r\n        super();\r\n        const { tabFactories, includeChecks } = this;\r\n        tabFactories[TAB_GENERAL] = this.createMainPanel.bind(this);\r\n        tabFactories[TAB_FILTER] = this.createFilterPanel.bind(this);\r\n        tabFactories[TAB_COLUMNS] = this.createColumnsPanel.bind(this);\r\n\r\n        includeChecks[TAB_GENERAL] = () => true;\r\n        includeChecks[TAB_FILTER] = () => (column ? !!this.beans.filterManager?.isFilterAllowed(column) : false);\r\n        includeChecks[TAB_COLUMNS] = () => true;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const tabs = this.getTabsToCreate().map((name) => this.createTab(name));\r\n\r\n        const tabbedLayout = new TabbedLayout({\r\n            items: tabs,\r\n            cssClass: 'ag-menu',\r\n            onActiveItemClicked: this.onHidePopup.bind(this),\r\n            onItemClicked: this.onTabItemClicked.bind(this),\r\n        });\r\n        this.tabbedLayout = this.createBean(tabbedLayout);\r\n\r\n        this.mainMenuList?.setParentComponent(tabbedLayout);\r\n\r\n        this.addDestroyFunc(() => this.destroyBean(tabbedLayout));\r\n    }\r\n\r\n    private getTabsToCreate() {\r\n        if (this.restrictTo) {\r\n            return this.restrictTo;\r\n        }\r\n\r\n        return (this.column?.getColDef().menuTabs ?? TABS_DEFAULT).filter(\r\n            (tabName) => this.isValidMenuTabItem(tabName) && this.isNotSuppressed(tabName)\r\n        );\r\n    }\r\n\r\n    private isValidMenuTabItem(menuTabName: ColumnMenuTab): boolean {\r\n        let isValid: boolean = true;\r\n        let itemsToConsider = TABS_DEFAULT;\r\n\r\n        if (this.restrictTo != null) {\r\n            isValid = this.restrictTo.indexOf(menuTabName) > -1;\r\n            itemsToConsider = this.restrictTo;\r\n        }\r\n\r\n        isValid = isValid && TABS_DEFAULT.indexOf(menuTabName) > -1;\r\n\r\n        if (!isValid) {\r\n            _warn(175, { menuTabName, itemsToConsider });\r\n        }\r\n\r\n        return isValid;\r\n    }\r\n\r\n    private isNotSuppressed(menuTabName: string): boolean {\r\n        return this.includeChecks[menuTabName]();\r\n    }\r\n\r\n    private createTab(name: string): TabbedItem {\r\n        return this.tabFactories[name]();\r\n    }\r\n\r\n    public showTabBasedOnPreviousSelection(): void {\r\n        // show the tab the user was on last time they had a menu open\r\n        this.showTab(this.initialSelection);\r\n    }\r\n\r\n    public showTab(toShow: string) {\r\n        const { tabItemColumns, tabbedLayout, tabItemFilter, tabItemGeneral } = this;\r\n        if (tabItemColumns && toShow === TAB_COLUMNS) {\r\n            tabbedLayout.showItem(tabItemColumns);\r\n        } else if (tabItemFilter && toShow === TAB_FILTER) {\r\n            tabbedLayout.showItem(tabItemFilter);\r\n        } else if (tabItemGeneral && toShow === TAB_GENERAL) {\r\n            tabbedLayout.showItem(tabItemGeneral);\r\n        } else {\r\n            tabbedLayout.showFirstItem();\r\n        }\r\n    }\r\n\r\n    private onTabItemClicked(event: { item: TabbedItem }): void {\r\n        let key: string | null = null;\r\n\r\n        switch (event.item) {\r\n            case this.tabItemColumns:\r\n                key = TAB_COLUMNS;\r\n                break;\r\n            case this.tabItemFilter:\r\n                key = TAB_FILTER;\r\n                break;\r\n            case this.tabItemGeneral:\r\n                key = TAB_GENERAL;\r\n                break;\r\n        }\r\n\r\n        if (key) {\r\n            this.activateTab(key);\r\n        }\r\n    }\r\n\r\n    private activateTab(tab: string): void {\r\n        const ev: TabSelectedEvent = {\r\n            type: 'tabSelected',\r\n            key: tab,\r\n        };\r\n        this.dispatchLocalEvent(ev);\r\n    }\r\n\r\n    private createMainPanel(): TabbedItem {\r\n        const { beans, column } = this;\r\n        const colMenuFactory = beans.colMenuFactory as ColumnMenuFactory;\r\n        const mainMenuList = colMenuFactory.createMenu(\r\n            this,\r\n            colMenuFactory.getMenuItems(column),\r\n            this.column,\r\n            () => this.sourceElement ?? this.getGui()\r\n        );\r\n        this.mainMenuList = mainMenuList;\r\n        mainMenuList.addEventListener('closeMenu', this.onHidePopup.bind(this));\r\n\r\n        const tabItemGeneral = {\r\n            title: _createIconNoSpan('legacyMenu', beans, column)!,\r\n            titleLabel: TAB_GENERAL.replace('MenuTab', ''),\r\n            bodyPromise: AgPromise.resolve(mainMenuList.getGui()),\r\n            name: TAB_GENERAL,\r\n        };\r\n        this.tabItemGeneral = tabItemGeneral;\r\n\r\n        return tabItemGeneral;\r\n    }\r\n\r\n    private onHidePopup(event?: CloseMenuEvent): void {\r\n        (this.beans.menuUtils as MenuUtils).closePopupAndRestoreFocusOnSelect(\r\n            this.hidePopupFunc,\r\n            this.restoreFocusParams,\r\n            event\r\n        );\r\n    }\r\n\r\n    private createFilterPanel(): TabbedItem {\r\n        const comp = this.column ? this.createBean(new FilterWrapperComp(this.column, 'COLUMN_MENU')) : null;\r\n        this.filterComp = comp;\r\n        if (!comp?.hasFilter()) {\r\n            _error(119);\r\n        }\r\n\r\n        const afterAttachedCallback = (params: IAfterGuiAttachedParams) => comp?.afterGuiAttached(params);\r\n\r\n        const afterDetachedCallback = () => comp?.afterGuiDetached();\r\n\r\n        this.tabItemFilter = {\r\n            title: _createIconNoSpan('filterTab', this.beans, this.column)!,\r\n            titleLabel: TAB_FILTER.replace('MenuTab', ''),\r\n            bodyPromise: AgPromise.resolve(comp?.getGui()) as AgPromise<HTMLElement>,\r\n            afterAttachedCallback,\r\n            afterDetachedCallback,\r\n            name: TAB_FILTER,\r\n        };\r\n\r\n        return this.tabItemFilter;\r\n    }\r\n\r\n    private createColumnsPanel(): TabbedItem {\r\n        const eWrapperDiv = document.createElement('div');\r\n        eWrapperDiv.classList.add('ag-menu-column-select-wrapper');\r\n\r\n        const { beans, column } = this;\r\n        const columnSelectPanel = (beans.colChooserFactory as ColumnChooserFactory).createColumnSelectPanel(\r\n            this,\r\n            column\r\n        );\r\n\r\n        const columnSelectPanelGui = columnSelectPanel.getGui();\r\n        columnSelectPanelGui.classList.add('ag-menu-column-select');\r\n        eWrapperDiv.appendChild(columnSelectPanelGui);\r\n\r\n        const tabItemColumns = {\r\n            title: _createIconNoSpan('columns', beans, column)!, //createColumnsIcon(),\r\n            titleLabel: TAB_COLUMNS.replace('MenuTab', ''),\r\n            bodyPromise: AgPromise.resolve(eWrapperDiv),\r\n            name: TAB_COLUMNS,\r\n        };\r\n        this.tabItemColumns = tabItemColumns;\r\n\r\n        return tabItemColumns;\r\n    }\r\n\r\n    public afterGuiAttached(params: IAfterGuiAttachedParams): void {\r\n        const { container, hidePopup } = params;\r\n\r\n        this.tabbedLayout.setAfterAttachedParams({ container, hidePopup });\r\n\r\n        if (hidePopup) {\r\n            this.hidePopupFunc = hidePopup;\r\n            this.addDestroyFunc(hidePopup);\r\n        }\r\n    }\r\n\r\n    public getGui(): HTMLElement {\r\n        return this.tabbedLayout.getGui();\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n        // Needs to be destroyed last to ensure that `afterGuiDetached` runs\r\n        this.destroyBean(this.filterComp);\r\n    }\r\n}\r\n\r\nclass ColumnContextMenu extends Component implements EnterpriseColumnMenu {\r\n    private readonly eColumnMenu: HTMLElement = RefPlaceholder;\r\n\r\n    private hidePopupFunc: (popupParams?: PopupEventParams) => void;\r\n    private mainMenuList: AgMenuList;\r\n\r\n    constructor(\r\n        private readonly menuItems: (DefaultMenuItem | MenuItemDef)[],\r\n        private readonly column: AgColumn | undefined,\r\n        private readonly restoreFocusParams: MenuRestoreFocusParams,\r\n        private readonly sourceElement?: HTMLElement\r\n    ) {\r\n        super(/* html */ `\r\n            <div data-ref=\"eColumnMenu\" role=\"presentation\" class=\"ag-menu ag-column-menu\"></div>\r\n        `);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const mainMenuList = (this.beans.colMenuFactory as ColumnMenuFactory).createMenu(\r\n            this,\r\n            this.menuItems,\r\n            this.column,\r\n            () => this.sourceElement ?? this.getGui()\r\n        );\r\n        this.mainMenuList = mainMenuList;\r\n        mainMenuList.addEventListener('closeMenu', this.onHidePopup.bind(this));\r\n        this.eColumnMenu.appendChild(mainMenuList.getGui());\r\n    }\r\n\r\n    private onHidePopup(event?: CloseMenuEvent): void {\r\n        (this.beans.menuUtils as MenuUtils).closePopupAndRestoreFocusOnSelect(\r\n            this.hidePopupFunc,\r\n            this.restoreFocusParams,\r\n            event\r\n        );\r\n    }\r\n\r\n    public afterGuiAttached({ hidePopup }: IAfterGuiAttachedParams): void {\r\n        if (hidePopup) {\r\n            this.hidePopupFunc = hidePopup;\r\n            this.addDestroyFunc(hidePopup);\r\n        }\r\n        _focusInto(this.mainMenuList.getGui());\r\n    }\r\n}\r\n", "import type { IAfterGuiAttachedParams } from 'ag-grid-community';\r\nimport {\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    TabGuardComp,\r\n    _clearElement,\r\n    _createIconNoSpan,\r\n    _findNextFocusableElement,\r\n    _focusInto,\r\n    _getActiveDomElement,\r\n    _getDocument,\r\n    _isKeyboardMode,\r\n    _setAriaLabel,\r\n    _setAriaRole,\r\n} from 'ag-grid-community';\r\n\r\nimport { findFocusableElementBeforeTabGuard, isTargetUnderManagedComponent } from '../misc/enterpriseFocusUtils';\r\nimport type { TabbedItem, TabbedLayoutParams } from './iTabbedLayout';\r\n\r\ninterface TabbedItemWrapper {\r\n    tabbedItem: TabbedItem;\r\n    eHeaderButton: HTMLElement;\r\n}\r\n\r\nfunction getTabbedLayoutTemplate(cssClass?: string) {\r\n    return /* html */ `<div class=\"ag-tabs ${cssClass}\">\r\n        <div data-ref=\"eHeader\"></div>\r\n        <div data-ref=\"eBody\" role=\"presentation\" class=\"ag-tabs-body ${cssClass ? `${cssClass}-body` : ''}\"></div>\r\n    </div>`;\r\n}\r\n\r\nexport class TabbedLayout extends TabGuardComp {\r\n    private readonly eHeader: HTMLElement = RefPlaceholder;\r\n    private readonly eBody: HTMLElement = RefPlaceholder;\r\n\r\n    private eTabHeader: HTMLElement;\r\n    private eCloseButton?: HTMLElement;\r\n\r\n    private params: TabbedLayoutParams;\r\n    private afterAttachedParams: IAfterGuiAttachedParams;\r\n    private items: TabbedItemWrapper[] = [];\r\n    private activeItem: TabbedItemWrapper;\r\n    private lastScrollListener: (() => null) | null | undefined;\r\n    private readonly tabbedItemScrollMap = new Map<string, number>();\r\n\r\n    constructor(params: TabbedLayoutParams) {\r\n        super(getTabbedLayoutTemplate(params.cssClass));\r\n        this.params = params;\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.setupHeader();\r\n\r\n        if (this.params.items) {\r\n            this.params.items.forEach((item) => this.addItem(item));\r\n        }\r\n\r\n        this.initialiseTabGuard({\r\n            onTabKeyDown: this.onTabKeyDown.bind(this),\r\n            handleKeyDown: this.handleKeyDown.bind(this),\r\n            focusInnerElement: this.focusInnerElement.bind(this),\r\n            focusTrapActive: true,\r\n        });\r\n\r\n        this.addDestroyFunc(() => this.activeItem?.tabbedItem?.afterDetachedCallback?.());\r\n    }\r\n\r\n    private setupHeader(): void {\r\n        const { enableCloseButton, cssClass } = this.params;\r\n        const addCssClasses = (el: HTMLElement, suffix: string) => {\r\n            el.classList.add(`ag-tabs-${suffix}`);\r\n            if (cssClass) {\r\n                el.classList.add(`${cssClass}-${suffix}`);\r\n            }\r\n        };\r\n        if (enableCloseButton) {\r\n            this.setupCloseButton(addCssClasses);\r\n            this.eTabHeader = _getDocument(this.beans).createElement('div');\r\n            addCssClasses(this.eHeader, 'header-wrapper');\r\n            _setAriaRole(this.eHeader, 'presentation');\r\n            this.eHeader.appendChild(this.eTabHeader);\r\n        } else {\r\n            this.eTabHeader = this.eHeader;\r\n        }\r\n        _setAriaRole(this.eTabHeader, 'tablist');\r\n        addCssClasses(this.eTabHeader, 'header');\r\n    }\r\n\r\n    private setupCloseButton(addCssClasses: (el: HTMLElement, suffix: string) => void): void {\r\n        const eDocument = _getDocument(this.beans);\r\n        const eCloseButton = eDocument.createElement('button');\r\n        addCssClasses(eCloseButton, 'close-button');\r\n        const eIcon = _createIconNoSpan('close', this.beans)!;\r\n        _setAriaLabel(eCloseButton, this.params.closeButtonAriaLabel);\r\n        eCloseButton.appendChild(eIcon);\r\n        this.addManagedElementListeners(eCloseButton, { click: () => this.params.onCloseClicked?.() });\r\n        const eCloseButtonWrapper = eDocument.createElement('div');\r\n        addCssClasses(eCloseButtonWrapper, 'close-button-wrapper');\r\n        _setAriaRole(eCloseButtonWrapper, 'presentation');\r\n        eCloseButtonWrapper.appendChild(eCloseButton);\r\n        this.eHeader.appendChild(eCloseButtonWrapper);\r\n        this.eCloseButton = eCloseButton;\r\n    }\r\n\r\n    protected handleKeyDown(e: KeyboardEvent): void {\r\n        switch (e.key) {\r\n            case KeyCode.RIGHT:\r\n            case KeyCode.LEFT: {\r\n                if (!this.eTabHeader.contains(_getActiveDomElement(this.beans))) {\r\n                    return;\r\n                }\r\n                const isRightKey = e.key === KeyCode.RIGHT;\r\n                const isRtl = this.gos.get('enableRtl');\r\n                const currentPosition = this.items.indexOf(this.activeItem);\r\n                const nextPosition =\r\n                    isRightKey !== isRtl\r\n                        ? Math.min(currentPosition + 1, this.items.length - 1)\r\n                        : Math.max(currentPosition - 1, 0);\r\n\r\n                if (currentPosition === nextPosition) {\r\n                    return;\r\n                }\r\n\r\n                e.preventDefault();\r\n\r\n                const nextItem = this.items[nextPosition];\r\n\r\n                this.showItemWrapper(nextItem);\r\n                nextItem.eHeaderButton.focus();\r\n                break;\r\n            }\r\n            case KeyCode.UP:\r\n            case KeyCode.DOWN:\r\n                e.stopPropagation();\r\n                break;\r\n        }\r\n    }\r\n\r\n    protected onTabKeyDown(e: KeyboardEvent) {\r\n        if (e.defaultPrevented) {\r\n            return;\r\n        }\r\n\r\n        const { beans, eHeader, eBody, activeItem, params } = this;\r\n        const { suppressTrapFocus, enableCloseButton } = params;\r\n\r\n        const activeElement = _getActiveDomElement(beans);\r\n        const target = e.target as HTMLElement;\r\n        const backwards = e.shiftKey;\r\n\r\n        if (eHeader.contains(activeElement)) {\r\n            e.preventDefault();\r\n            if (enableCloseButton && backwards && !this.eCloseButton?.contains(activeElement)) {\r\n                this.eCloseButton?.focus();\r\n            } else if (suppressTrapFocus && backwards) {\r\n                findFocusableElementBeforeTabGuard(_getDocument(beans).body, target)?.focus();\r\n            } else {\r\n                // focus is in header, move into body of popup\r\n                this.focusBody(e.shiftKey);\r\n            }\r\n            return;\r\n        }\r\n\r\n        let nextEl: HTMLElement | null = null;\r\n\r\n        if (isTargetUnderManagedComponent(eBody, target)) {\r\n            if (backwards) {\r\n                nextEl = findFocusableElementBeforeTabGuard(eBody, target);\r\n            }\r\n\r\n            if (!nextEl && !suppressTrapFocus) {\r\n                nextEl = activeItem.eHeaderButton;\r\n            }\r\n        }\r\n\r\n        if (!nextEl && eBody.contains(activeElement)) {\r\n            nextEl = _findNextFocusableElement(beans, eBody, false, backwards);\r\n\r\n            if (!nextEl) {\r\n                if (suppressTrapFocus && !backwards) {\r\n                    this.forceFocusOutOfContainer(backwards);\r\n                } else if (enableCloseButton && !backwards) {\r\n                    e.preventDefault();\r\n                    this.eCloseButton?.focus();\r\n                } else {\r\n                    e.preventDefault();\r\n                    this.focusHeader();\r\n                }\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (nextEl) {\r\n            e.preventDefault();\r\n            nextEl.focus();\r\n        }\r\n    }\r\n\r\n    private focusInnerElement(fromBottom?: boolean): void {\r\n        if (fromBottom) {\r\n            this.focusBody(true);\r\n        } else {\r\n            this.focusHeader();\r\n        }\r\n    }\r\n\r\n    public focusHeader(preventScroll?: boolean): void {\r\n        this.activeItem.eHeaderButton.focus({ preventScroll });\r\n    }\r\n\r\n    private focusBody(fromBottom?: boolean): void {\r\n        _focusInto(this.eBody, fromBottom);\r\n    }\r\n\r\n    public setAfterAttachedParams(params: IAfterGuiAttachedParams): void {\r\n        this.afterAttachedParams = params;\r\n    }\r\n\r\n    public showFirstItem(): void {\r\n        if (this.items.length > 0) {\r\n            this.showItemWrapper(this.items[0]);\r\n        }\r\n    }\r\n\r\n    private addItem(item: TabbedItem): void {\r\n        const eHeaderButton = document.createElement('span');\r\n\r\n        _setAriaRole(eHeaderButton, 'tab');\r\n        eHeaderButton.setAttribute('tabindex', '-1');\r\n        eHeaderButton.appendChild(item.title);\r\n        eHeaderButton.classList.add('ag-tab');\r\n\r\n        this.eTabHeader.appendChild(eHeaderButton);\r\n        _setAriaLabel(eHeaderButton, item.titleLabel);\r\n\r\n        const wrapper: TabbedItemWrapper = {\r\n            tabbedItem: item,\r\n            eHeaderButton: eHeaderButton,\r\n        };\r\n        this.items.push(wrapper);\r\n\r\n        eHeaderButton.addEventListener('click', this.showItemWrapper.bind(this, wrapper));\r\n    }\r\n\r\n    public showItem(tabbedItem: TabbedItem): void {\r\n        const itemWrapper = this.items.find((wrapper) => wrapper.tabbedItem === tabbedItem);\r\n\r\n        if (itemWrapper) {\r\n            this.showItemWrapper(itemWrapper);\r\n        }\r\n    }\r\n\r\n    private showItemWrapper(wrapper: TabbedItemWrapper): void {\r\n        const { tabbedItem, eHeaderButton } = wrapper;\r\n\r\n        this.params.onItemClicked?.({ item: tabbedItem });\r\n\r\n        if (this.activeItem === wrapper) {\r\n            this.params.onActiveItemClicked?.();\r\n            return;\r\n        }\r\n\r\n        if (this.lastScrollListener) {\r\n            this.lastScrollListener = this.lastScrollListener();\r\n        }\r\n\r\n        _clearElement(this.eBody);\r\n\r\n        tabbedItem.bodyPromise.then((body: HTMLElement) => {\r\n            this.eBody.appendChild(body);\r\n            const onlyUnmanaged = !_isKeyboardMode();\r\n\r\n            if (!this.params.suppressFocusBodyOnOpen) {\r\n                _focusInto(this.eBody, false, onlyUnmanaged);\r\n            }\r\n\r\n            if (tabbedItem.afterAttachedCallback) {\r\n                tabbedItem.afterAttachedCallback(this.afterAttachedParams);\r\n            }\r\n\r\n            if (this.params.keepScrollPosition) {\r\n                const scrollableContainer =\r\n                    (tabbedItem.getScrollableContainer && tabbedItem.getScrollableContainer()) || body;\r\n                [this.lastScrollListener] = this.addManagedElementListeners(scrollableContainer, {\r\n                    scroll: () => {\r\n                        this.tabbedItemScrollMap.set(tabbedItem.name, scrollableContainer.scrollTop);\r\n                    },\r\n                });\r\n                const scrollPosition = this.tabbedItemScrollMap.get(tabbedItem.name);\r\n                if (scrollPosition !== undefined) {\r\n                    // Safari needs a small timeout or it will fire a scroll event to position 0\r\n                    setTimeout(() => {\r\n                        scrollableContainer.scrollTop = scrollPosition;\r\n                    }, 0);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (this.activeItem) {\r\n            this.activeItem.eHeaderButton.classList.remove('ag-tab-selected');\r\n            this.activeItem.tabbedItem.afterDetachedCallback?.();\r\n        }\r\n\r\n        eHeaderButton.classList.add('ag-tab-selected');\r\n\r\n        this.activeItem = wrapper;\r\n    }\r\n}\r\n", "import type { AgColumn, BeanCollection, ColumnChooserParams, IContextMenuParams, RowNode } from 'ag-grid-community';\r\n\r\nimport type { ColumnChooserFactory } from './columnChooserFactory';\r\n\r\nexport function showContextMenu(beans: BeanCollection, params?: IContextMenuParams) {\r\n    const { contextMenuSvc } = beans;\r\n    if (!contextMenuSvc) {\r\n        return;\r\n    }\r\n    const { rowNode, column, value, x, y } = params || {};\r\n    let { x: clientX, y: clientY } = contextMenuSvc.getContextMenuPosition(rowNode as RowNode, column as AgColumn);\r\n\r\n    if (x != null) {\r\n        clientX = x;\r\n    }\r\n\r\n    if (y != null) {\r\n        clientY = y;\r\n    }\r\n\r\n    contextMenuSvc.showContextMenu({\r\n        mouseEvent: new MouseEvent('mousedown', { clientX, clientY }),\r\n        rowNode,\r\n        column,\r\n        value,\r\n    });\r\n}\r\n\r\nexport function showColumnChooser(beans: BeanCollection, params?: ColumnChooserParams): void {\r\n    (beans.colChooserFactory as ColumnChooserFactory)?.showColumnChooser({ chooserParams: params });\r\n}\r\n\r\nexport function hideColumnChooser(beans: BeanCollection): void {\r\n    (beans.colChooserFactory as ColumnChooserFactory)?.hideActiveColumnChooser();\r\n}\r\n", "import type { AgColumn, HeaderPosition, NamedBean, PopupEventParams } from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    _findTabbableParent,\r\n    _getActiveDomElement,\r\n    _isNothingFocused,\r\n    _isVisible,\r\n    _last,\r\n} from 'ag-grid-community';\r\n\r\nimport type { CloseMenuEvent } from '../widgets/agMenuItemComponent';\r\n\r\nexport interface MenuRestoreFocusParams {\r\n    column: AgColumn | undefined;\r\n    headerPosition: HeaderPosition | null;\r\n    columnIndex: number;\r\n    eventSource?: HTMLElement;\r\n}\r\n\r\nexport class MenuUtils extends BeanStub implements NamedBean {\r\n    beanName = 'menuUtils' as const;\r\n\r\n    public restoreFocusOnClose(\r\n        restoreFocusParams: MenuRestoreFocusParams,\r\n        eComp: HTMLElement,\r\n        e?: Event,\r\n        restoreIfMouseEvent?: boolean\r\n    ): void {\r\n        const { eventSource } = restoreFocusParams;\r\n        const isKeyboardEvent = e instanceof KeyboardEvent;\r\n        if ((!restoreIfMouseEvent && !isKeyboardEvent) || !eventSource) {\r\n            return;\r\n        }\r\n\r\n        const activeEl = _getActiveDomElement(this.beans);\r\n        if (\r\n            // focus is outside of comp\r\n            !eComp.contains(activeEl) &&\r\n            // something else has focus\r\n            !_isNothingFocused(this.beans)\r\n        ) {\r\n            // don't return focus to the header\r\n            return;\r\n        }\r\n        this.focusHeaderCell(restoreFocusParams);\r\n    }\r\n\r\n    public closePopupAndRestoreFocusOnSelect(\r\n        hidePopupFunc: (popupParams?: PopupEventParams) => void,\r\n        restoreFocusParams: MenuRestoreFocusParams,\r\n        event?: CloseMenuEvent\r\n    ): void {\r\n        let keyboardEvent: KeyboardEvent | undefined;\r\n\r\n        if (event && event.keyboardEvent) {\r\n            keyboardEvent = event.keyboardEvent;\r\n        }\r\n\r\n        hidePopupFunc(keyboardEvent && { keyboardEvent });\r\n\r\n        const beans = this.beans;\r\n        const focusSvc = beans.focusSvc;\r\n        // this method only gets called when the menu was closed by selecting an option\r\n        // in this case we focus the cell that was previously focused, otherwise the header\r\n        const focusedCell = focusSvc.getFocusedCell();\r\n\r\n        if (_isNothingFocused(beans)) {\r\n            if (focusedCell) {\r\n                const { rowIndex, rowPinned, column } = focusedCell;\r\n                focusSvc.setFocusedCell({\r\n                    rowIndex,\r\n                    column,\r\n                    rowPinned,\r\n                    forceBrowserFocus: true,\r\n                    preventScrollOnBrowserFocus: true,\r\n                });\r\n            } else {\r\n                this.focusHeaderCell(restoreFocusParams);\r\n            }\r\n        }\r\n    }\r\n\r\n    public onContextMenu(\r\n        mouseEvent: MouseEvent | null | undefined,\r\n        touchEvent: TouchEvent | null | undefined,\r\n        showMenuCallback: (eventOrTouch: MouseEvent | Touch) => boolean\r\n    ): void {\r\n        // to allow us to debug in chrome, we ignore the event if ctrl is pressed.\r\n        // not everyone wants this, so first 'if' below allows to turn this hack off.\r\n        if (!this.gos.get('allowContextMenuWithControlKey')) {\r\n            // then do the check\r\n            if (mouseEvent && (mouseEvent.ctrlKey || mouseEvent.metaKey)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // need to do this regardless of context menu showing or not, so doing\r\n        // before the isSuppressContextMenu() check\r\n        if (mouseEvent) {\r\n            this.blockMiddleClickScrollsIfNeeded(mouseEvent);\r\n        }\r\n\r\n        if (this.gos.get('suppressContextMenu')) {\r\n            return;\r\n        }\r\n\r\n        const eventOrTouch: MouseEvent | Touch = mouseEvent ?? touchEvent!.touches[0];\r\n        if (showMenuCallback(eventOrTouch)) {\r\n            const event = mouseEvent ?? touchEvent;\r\n\r\n            if (event && event.cancelable) {\r\n                event.preventDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    // make this async for react\r\n    private async focusHeaderCell(restoreFocusParams: MenuRestoreFocusParams): Promise<void> {\r\n        const { column, columnIndex, headerPosition, eventSource } = restoreFocusParams;\r\n        const { visibleCols, headerNavigation, focusSvc } = this.beans;\r\n\r\n        // DO NOT REMOVE `await` from the statement below\r\n        // even though `getAllCols` is a synchronous method, we use `await` to make it async\r\n        const isColumnStillVisible = await visibleCols.allCols.some((col) => col === column);\r\n\r\n        if (column && !column.isAlive()) {\r\n            return;\r\n        }\r\n\r\n        if (isColumnStillVisible && eventSource && _isVisible(eventSource)) {\r\n            const focusableEl = _findTabbableParent(eventSource);\r\n            if (focusableEl) {\r\n                if (column) {\r\n                    headerNavigation?.scrollToColumn(column);\r\n                }\r\n                focusableEl.focus();\r\n            }\r\n        }\r\n        // if the focusEl is no longer in the DOM, we try to focus\r\n        // the header that is closest to the previous header position\r\n        else if (headerPosition && columnIndex !== -1) {\r\n            const allColumns = visibleCols.allCols;\r\n            const columnToFocus = allColumns[columnIndex] || _last(allColumns);\r\n\r\n            if (columnToFocus) {\r\n                focusSvc.focusHeaderPosition({\r\n                    headerPosition: {\r\n                        headerRowIndex: headerPosition.headerRowIndex,\r\n                        column: columnToFocus,\r\n                    },\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private blockMiddleClickScrollsIfNeeded(mouseEvent: MouseEvent): void {\r\n        // if we don't do this, then middle click will never result in a 'click' event, as 'mousedown'\r\n        // will be consumed by the browser to mean 'scroll' (as you can scroll with the middle mouse\r\n        // button in the browser). so this property allows the user to receive middle button clicks if\r\n        // they want.\r\n        if (this.gos.get('suppressMiddleClickScrolls') && mouseEvent.which === 2) {\r\n            mouseEvent.preventDefault();\r\n        }\r\n    }\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\nimport { _EditCoreModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { RichSelectCellEditor } from './richSelectCellEditor';\r\n\r\n/**\r\n * @feature Editing -> Rich Select Editor\r\n */\r\nexport const RichSelectModule: _ModuleWithoutApi = {\r\n    moduleName: 'RichSelect',\r\n    version: VERSION,\r\n    beans: [],\r\n    userComponents: { agRichSelect: RichSelectCellEditor, agRichSelectCellEditor: RichSelectCellEditor },\r\n    icons: {\r\n        // open icon for rich select editor\r\n        richSelectOpen: 'small-down',\r\n        // remove for rich select editor pills\r\n        richSelectRemove: 'cancel',\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _EditCoreModule],\r\n};\r\n", "import type {\r\n    FieldPickerValueSelectedEvent,\r\n    ICellEditor,\r\n    ICellEditorParams,\r\n    KeyCreatorParams,\r\n    RichCellEditorParams,\r\n    RichSelectParams,\r\n} from 'ag-grid-community';\r\nimport { PopupComponent, _missing, _warn } from 'ag-grid-community';\r\n\r\nimport { AgRichSelect } from '../widgets/agRichSelect';\r\n\r\nexport class RichSelectCellEditor<TData = any, TValue = any> extends PopupComponent implements ICellEditor<TValue> {\r\n    private params: RichCellEditorParams<TData, TValue>;\r\n    private focusAfterAttached: boolean;\r\n    private richSelect: AgRichSelect<TValue>;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-cell-edit-wrapper\"></div>`);\r\n    }\r\n\r\n    public init(params: RichCellEditorParams<TData, TValue>): void {\r\n        this.params = params;\r\n\r\n        const { cellStartedEdit, values } = params;\r\n\r\n        if (_missing(values)) {\r\n            _warn(180);\r\n        }\r\n\r\n        const { params: richSelectParams, valuesPromise } = this.buildRichSelectParams();\r\n\r\n        const richSelect = this.createManagedBean(new AgRichSelect<TValue>(richSelectParams));\r\n        this.richSelect = richSelect;\r\n        richSelect.addCssClass('ag-cell-editor');\r\n        this.appendChild(richSelect);\r\n\r\n        if (valuesPromise) {\r\n            valuesPromise.then((values: TValue[]) => {\r\n                richSelect.setValueList({ valueList: values, refresh: true });\r\n                const searchStringCallback = this.getSearchStringCallback(values);\r\n                if (searchStringCallback) {\r\n                    richSelect.setSearchStringCreator(searchStringCallback);\r\n                }\r\n            });\r\n        }\r\n\r\n        this.addManagedListeners(richSelect, {\r\n            fieldPickerValueSelected: this.onEditorPickerValueSelected.bind(this),\r\n        });\r\n        this.focusAfterAttached = cellStartedEdit;\r\n    }\r\n\r\n    private onEditorPickerValueSelected(e: FieldPickerValueSelectedEvent): void {\r\n        // there is an issue with focus handling when we call `stopEditing` while the\r\n        // picker list is still collapsing, so we make this call async to guarantee that.\r\n        setTimeout(() => this.params.stopEditing(!e.fromEnterKey));\r\n    }\r\n\r\n    private buildRichSelectParams(): { params: RichSelectParams<TValue>; valuesPromise?: Promise<TValue[]> } {\r\n        const params = this.params;\r\n        const {\r\n            cellRenderer,\r\n            cellHeight,\r\n            value,\r\n            values,\r\n            formatValue,\r\n            searchDebounceDelay,\r\n            valueListGap,\r\n            valueListMaxHeight,\r\n            valueListMaxWidth,\r\n            allowTyping,\r\n            filterList,\r\n            searchType,\r\n            highlightMatch,\r\n            valuePlaceholder,\r\n            eventKey,\r\n            multiSelect,\r\n            suppressDeselectAll,\r\n            suppressMultiSelectPillRenderer,\r\n        } = params;\r\n\r\n        const ret: RichSelectParams = {\r\n            value: value,\r\n            cellRenderer,\r\n            cellRowHeight: cellHeight,\r\n            searchDebounceDelay,\r\n            valueFormatter: formatValue,\r\n            pickerAriaLabelKey: 'ariaLabelRichSelectField',\r\n            pickerAriaLabelValue: 'Rich Select Field',\r\n            pickerType: 'virtual-list',\r\n            pickerGap: valueListGap,\r\n            allowTyping,\r\n            filterList,\r\n            searchType,\r\n            highlightMatch,\r\n            maxPickerHeight: valueListMaxHeight,\r\n            maxPickerWidth: valueListMaxWidth,\r\n            placeholder: valuePlaceholder,\r\n            initialInputValue: eventKey?.length === 1 ? eventKey : undefined,\r\n            multiSelect,\r\n            suppressDeselectAll,\r\n            suppressMultiSelectPillRenderer,\r\n        };\r\n\r\n        let valuesResult;\r\n        let valuesPromise;\r\n\r\n        if (typeof values === 'function') {\r\n            valuesResult = values(params as ICellEditorParams);\r\n        } else {\r\n            valuesResult = values ?? [];\r\n        }\r\n\r\n        if (Array.isArray(valuesResult)) {\r\n            ret.valueList = valuesResult;\r\n            ret.searchStringCreator = this.getSearchStringCallback(valuesResult);\r\n        } else {\r\n            valuesPromise = valuesResult;\r\n        }\r\n\r\n        if (multiSelect && allowTyping) {\r\n            params.allowTyping = ret.allowTyping = false;\r\n            _warn(181);\r\n        }\r\n\r\n        return { params: ret, valuesPromise };\r\n    }\r\n\r\n    private getSearchStringCallback(values: TValue[]): ((values: TValue[]) => string[]) | undefined {\r\n        const params = this.params;\r\n        const { colDef } = params;\r\n\r\n        if (typeof values[0] !== 'object' || !colDef.keyCreator) {\r\n            return;\r\n        }\r\n\r\n        const { column, node, data } = params;\r\n        return (values: TValue[]) =>\r\n            values.map((value: TValue) => {\r\n                const keyParams: KeyCreatorParams = this.gos.addGridCommonParams({\r\n                    value,\r\n                    colDef,\r\n                    column,\r\n                    node,\r\n                    data,\r\n                });\r\n                return colDef.keyCreator!(keyParams);\r\n            });\r\n    }\r\n\r\n    // we need to have the gui attached before we can draw the virtual rows, as the\r\n    // virtual row logic needs info about the gui state\r\n    public afterGuiAttached(): void {\r\n        const { focusAfterAttached, params } = this;\r\n\r\n        setTimeout(() => {\r\n            if (!this.isAlive()) {\r\n                return;\r\n            }\r\n\r\n            const richSelect = this.richSelect;\r\n\r\n            if (focusAfterAttached) {\r\n                const focusableEl = richSelect.getFocusableElement() as HTMLInputElement;\r\n                focusableEl.focus();\r\n                const { allowTyping, eventKey } = this.params;\r\n                if (allowTyping && (!eventKey || eventKey.length !== 1)) {\r\n                    focusableEl.select();\r\n                }\r\n            }\r\n\r\n            richSelect.showPicker();\r\n\r\n            const { eventKey } = params;\r\n            if (eventKey) {\r\n                if (eventKey?.length === 1) {\r\n                    richSelect.searchTextFromString(eventKey);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public focusIn(): void {\r\n        this.richSelect.getFocusableElement().focus();\r\n    }\r\n\r\n    public getValue(): any {\r\n        return this.richSelect.getValue();\r\n    }\r\n\r\n    public override isPopup(): boolean {\r\n        return false;\r\n    }\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\nimport { _ColumnFilterModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { SetFilter } from './setFilter';\r\nimport { SetFloatingFilterComp } from './setFloatingFilter';\r\n\r\n/**\r\n * @feature Filtering -> Set Filter\r\n */\r\nexport const SetFilterModule: _ModuleWithoutApi = {\r\n    moduleName: 'SetFilter',\r\n    version: VERSION,\r\n    userComponents: { agSetColumnFilter: SetFilter, agSetColumnFloatingFilter: SetFloatingFilterComp },\r\n    icons: {\r\n        // set filter tree list group contracted (click to expand)\r\n        setFilterGroupClosed: 'tree-closed',\r\n        // set filter tree list group expanded (click to contract)\r\n        setFilterGroupOpen: 'tree-open',\r\n        // set filter tree list expand/collapse all button, shown when some children are expanded and\r\n        //     others are collapsed\r\n        setFilterGroupIndeterminate: 'tree-indeterminate',\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _ColumnFilterModule],\r\n};\r\n", "import type {\r\n    AgColumn,\r\n    AgInputTextField,\r\n    BeanCollection,\r\n    ComponentSelector,\r\n    DataTypeService,\r\n    IAfterGuiAttachedParams,\r\n    IColsService,\r\n    IDoesFilterPassParams,\r\n    IRowNode,\r\n    ISetFilter,\r\n    KeyCreatorParams,\r\n    RowNode,\r\n    SetFilterModel,\r\n    SetFilterModelValue,\r\n    SetFilterParams,\r\n    ValueFormatterParams,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgInputTextFieldSelector,\r\n    AgPromise,\r\n    GROUP_AUTO_COLUMN_ID,\r\n    KeyCode,\r\n    ProvidedFilter,\r\n    RefPlaceholder,\r\n    _areEqual,\r\n    _error,\r\n    _getActiveDomElement,\r\n    _last,\r\n    _makeNull,\r\n    _setDisplayed,\r\n    _toStringOrNull,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { VirtualListModel } from '../widgets/iVirtualList';\r\nimport { VirtualList } from '../widgets/virtualList';\r\nimport type { SetFilterModelTreeItem } from './iSetDisplayValueModel';\r\nimport { SET_FILTER_ADD_SELECTION_TO_FILTER, SET_FILTER_SELECT_ALL } from './iSetDisplayValueModel';\r\nimport type { ISetFilterLocaleText } from './localeText';\r\nimport { DEFAULT_LOCALE_TEXT } from './localeText';\r\nimport type {\r\n    SetFilterListItemExpandedChangedEvent,\r\n    SetFilterListItemParams,\r\n    SetFilterListItemSelectionChangedEvent,\r\n} from './setFilterListItem';\r\nimport { SetFilterListItem } from './setFilterListItem';\r\nimport { SetFilterModelFormatter } from './setFilterModelFormatter';\r\nimport { processDataPath } from './setFilterUtils';\r\nimport { SetFilterModelValuesType, SetValueModel } from './setValueModel';\r\n\r\n/** @param V type of value in the Set Filter */\r\nexport class SetFilter<V = string> extends ProvidedFilter<SetFilterModel, V> implements ISetFilter<V> {\r\n    private rowGroupColsSvc?: IColsService;\r\n    private valueSvc: ValueService;\r\n    private dataTypeSvc?: DataTypeService;\r\n\r\n    protected filterType = 'set' as const;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.rowGroupColsSvc = beans.rowGroupColsSvc;\r\n        this.valueSvc = beans.valueSvc;\r\n        this.dataTypeSvc = beans.dataTypeSvc;\r\n    }\r\n\r\n    private readonly eMiniFilter: AgInputTextField = RefPlaceholder;\r\n    private readonly eFilterLoading: HTMLElement = RefPlaceholder;\r\n    private readonly eSetFilterList: HTMLElement = RefPlaceholder;\r\n    private readonly eFilterNoMatches: HTMLElement = RefPlaceholder;\r\n\r\n    private valueModel: SetValueModel<V>;\r\n    private setFilterParams: SetFilterParams<any, V>;\r\n    private virtualList: VirtualList<any>;\r\n    private caseSensitive: boolean = false;\r\n    private treeDataTreeList = false;\r\n    private groupingTreeList = false;\r\n    private hardRefreshVirtualList = false;\r\n    private noValueFormatterSupplied = false;\r\n\r\n    private createKey: (value: V | null | undefined, node?: IRowNode | null) => string | null;\r\n\r\n    private valueFormatter?: (params: ValueFormatterParams) => string;\r\n    private readonly filterModelFormatter = new SetFilterModelFormatter();\r\n\r\n    constructor() {\r\n        super('setFilter');\r\n    }\r\n\r\n    public override postConstruct() {\r\n        super.postConstruct();\r\n    }\r\n\r\n    // unlike the simple filters, nothing in the set filter UI shows/hides.\r\n    // maybe this method belongs in abstractSimpleFilter???\r\n    protected updateUiVisibility(): void {}\r\n\r\n    protected createBodyTemplate(): string {\r\n        return /* html */ `\r\n            <div class=\"ag-set-filter\">\r\n                <div data-ref=\"eFilterLoading\" class=\"ag-filter-loading ag-hidden\">${this.translateForSetFilter('loadingOoo')}</div>\r\n                <ag-input-text-field class=\"ag-mini-filter\" data-ref=\"eMiniFilter\"></ag-input-text-field>\r\n                <div data-ref=\"eFilterNoMatches\" class=\"ag-filter-no-matches ag-hidden\">${this.translateForSetFilter('noMatches')}</div>\r\n                <div data-ref=\"eSetFilterList\" class=\"ag-set-filter-list\" role=\"presentation\"></div>\r\n            </div>`;\r\n    }\r\n    protected getAgComponents(): ComponentSelector[] {\r\n        return [AgInputTextFieldSelector];\r\n    }\r\n\r\n    protected override handleKeyDown(e: KeyboardEvent): void {\r\n        super.handleKeyDown(e);\r\n\r\n        if (e.defaultPrevented) {\r\n            return;\r\n        }\r\n\r\n        switch (e.key) {\r\n            case KeyCode.SPACE:\r\n                this.handleKeySpace(e);\r\n                break;\r\n            case KeyCode.ENTER:\r\n                this.handleKeyEnter(e);\r\n                break;\r\n            case KeyCode.LEFT:\r\n                this.handleKeyLeft(e);\r\n                break;\r\n            case KeyCode.RIGHT:\r\n                this.handleKeyRight(e);\r\n                break;\r\n        }\r\n    }\r\n\r\n    private handleKeySpace(e: KeyboardEvent): void {\r\n        this.getComponentForKeyEvent(e)?.toggleSelected();\r\n    }\r\n\r\n    private handleKeyEnter(e: KeyboardEvent): void {\r\n        const { excelMode, readOnly } = this.setFilterParams;\r\n        if (!excelMode || !!readOnly) {\r\n            return;\r\n        }\r\n\r\n        e.preventDefault();\r\n\r\n        // in Excel Mode, hitting Enter is the same as pressing the Apply button\r\n        this.onBtApply(false, false, e);\r\n\r\n        if (this.setFilterParams.excelMode === 'mac') {\r\n            // in Mac version, select all the input text\r\n            this.eMiniFilter.getInputElement().select();\r\n        }\r\n    }\r\n\r\n    private handleKeyLeft(e: KeyboardEvent): void {\r\n        this.getComponentForKeyEvent(e)?.setExpanded(false);\r\n    }\r\n\r\n    private handleKeyRight(e: KeyboardEvent): void {\r\n        this.getComponentForKeyEvent(e)?.setExpanded(true);\r\n    }\r\n\r\n    private getComponentForKeyEvent(e: KeyboardEvent): SetFilterListItem<V> | undefined {\r\n        if (!this.eSetFilterList.contains(_getActiveDomElement(this.beans))) {\r\n            return;\r\n        }\r\n\r\n        const currentItem = this.virtualList.getLastFocusedRow();\r\n        if (currentItem == null) {\r\n            return;\r\n        }\r\n\r\n        const component = this.virtualList.getComponentAt(currentItem) as SetFilterListItem<V>;\r\n        if (component == null) {\r\n            return;\r\n        }\r\n\r\n        e.preventDefault();\r\n\r\n        const { readOnly } = this.setFilterParams;\r\n        if (readOnly) {\r\n            return;\r\n        }\r\n        return component;\r\n    }\r\n\r\n    protected getCssIdentifier(): string {\r\n        return 'set-filter';\r\n    }\r\n\r\n    public override setModel(model: SetFilterModel | null): AgPromise<void> {\r\n        if (model == null && this.valueModel.getModel() == null) {\r\n            // refreshing is expensive. if new and old model are both null (e.g. nothing set), skip.\r\n            // mini filter isn't contained within the model, so always reset\r\n            this.setMiniFilter(null);\r\n            return AgPromise.resolve();\r\n        }\r\n        return super.setModel(model);\r\n    }\r\n\r\n    override refresh(params: SetFilterParams<any, V>): boolean {\r\n        this.applyExcelModeOptions(params);\r\n\r\n        if (!super.refresh(params)) {\r\n            return false;\r\n        }\r\n\r\n        const oldParams = this.setFilterParams;\r\n\r\n        // Those params have a large impact and should trigger a reload when they change.\r\n        const paramsThatForceReload: (keyof SetFilterParams<any, V>)[] = [\r\n            'treeList',\r\n            'treeListPathGetter',\r\n            'caseSensitive',\r\n            'comparator',\r\n            'excelMode',\r\n        ];\r\n\r\n        if (paramsThatForceReload.some((param) => params[param] !== oldParams?.[param])) {\r\n            return false;\r\n        }\r\n\r\n        if (this.haveColDefParamsChanged(params)) {\r\n            return false;\r\n        }\r\n\r\n        super.updateParams(params);\r\n        this.updateSetFilterOnParamsChange(params);\r\n        this.updateMiniFilter();\r\n\r\n        if (params.suppressSelectAll !== oldParams?.suppressSelectAll) {\r\n            this.createVirtualListModel(params);\r\n        }\r\n\r\n        this.valueModel.updateOnParamsChange(params).then(() => {\r\n            this.refreshFilterValues();\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    private haveColDefParamsChanged(params: SetFilterParams<any, V>): boolean {\r\n        const { colDef, keyCreator } = params;\r\n        const { colDef: existingColDef, keyCreator: existingKeyCreator } = this.setFilterParams;\r\n\r\n        const currentKeyCreator = keyCreator ?? colDef.keyCreator;\r\n        const previousKeyCreator = existingKeyCreator ?? existingColDef?.keyCreator;\r\n\r\n        const filterValueGetterChanged = colDef.filterValueGetter !== existingColDef?.filterValueGetter;\r\n        const keyCreatorChanged = currentKeyCreator !== previousKeyCreator;\r\n        const valueFormatterIsKeyCreatorAndHasChanged =\r\n            !!this.dataTypeSvc &&\r\n            !!currentKeyCreator &&\r\n            this.dataTypeSvc.getFormatValue(colDef.cellDataType as string) === currentKeyCreator &&\r\n            colDef.valueFormatter !== existingColDef?.valueFormatter;\r\n\r\n        return filterValueGetterChanged || keyCreatorChanged || valueFormatterIsKeyCreatorAndHasChanged;\r\n    }\r\n\r\n    private setModelAndRefresh(values: SetFilterModelValue | null): AgPromise<void> {\r\n        return this.valueModel.setModel(values).then(() => {\r\n            if (this.isAlive()) {\r\n                // Async values could arrive after the grid has been destroyed\r\n                this.checkAndRefreshVirtualList();\r\n            }\r\n        });\r\n    }\r\n\r\n    protected resetUiToDefaults(): AgPromise<void> {\r\n        this.setMiniFilter(null);\r\n\r\n        return this.setModelAndRefresh(null);\r\n    }\r\n\r\n    protected setModelIntoUi(model: SetFilterModel | null): AgPromise<void> {\r\n        this.setMiniFilter(null);\r\n\r\n        const values = model == null ? null : model.values;\r\n        return this.setModelAndRefresh(values);\r\n    }\r\n\r\n    public getModelFromUi(): SetFilterModel | null {\r\n        const values = this.valueModel.getModel();\r\n\r\n        if (!values) {\r\n            return null;\r\n        }\r\n\r\n        return { values, filterType: this.filterType };\r\n    }\r\n\r\n    public getValueModel(): SetValueModel<V> {\r\n        return this.valueModel;\r\n    }\r\n\r\n    protected areModelsEqual(a: SetFilterModel, b: SetFilterModel): boolean {\r\n        // both are missing\r\n        if (a == null && b == null) {\r\n            return true;\r\n        }\r\n\r\n        return a != null && b != null && _areEqual(a.values, b.values);\r\n    }\r\n\r\n    private updateSetFilterOnParamsChange = (newParams: SetFilterParams<any, V>) => {\r\n        this.setFilterParams = newParams;\r\n        this.caseSensitive = !!newParams.caseSensitive;\r\n        const keyCreator = newParams.keyCreator ?? newParams.colDef.keyCreator;\r\n        this.setValueFormatter(newParams.valueFormatter, keyCreator, !!newParams.treeList, !!newParams.colDef.refData);\r\n        const isGroupCol = newParams.column.getId().startsWith(GROUP_AUTO_COLUMN_ID);\r\n        this.treeDataTreeList = this.gos.get('treeData') && !!newParams.treeList && isGroupCol;\r\n        this.groupingTreeList = !!this.rowGroupColsSvc?.columns.length && !!newParams.treeList && isGroupCol;\r\n        this.createKey = this.generateCreateKey(keyCreator, this.treeDataTreeList || this.groupingTreeList);\r\n    };\r\n\r\n    public override setParams(params: SetFilterParams<any, V>): void {\r\n        this.applyExcelModeOptions(params);\r\n\r\n        super.setParams(params);\r\n\r\n        this.updateSetFilterOnParamsChange(params);\r\n\r\n        const keyCreator = params.keyCreator ?? params.colDef.keyCreator;\r\n\r\n        this.valueModel = new SetValueModel({\r\n            filterParams: params,\r\n            setIsLoading: (loading) => this.setIsLoading(loading),\r\n            translate: (key) => this.translateForSetFilter(key),\r\n            caseFormat: (v) => this.caseFormat(v),\r\n            createKey: this.createKey,\r\n            valueFormatter: this.valueFormatter,\r\n            usingComplexObjects: !!keyCreator,\r\n            gos: this.gos,\r\n            rowGroupColsSvc: this.rowGroupColsSvc,\r\n            valueSvc: this.valueSvc,\r\n            treeDataTreeList: this.treeDataTreeList,\r\n            groupingTreeList: this.groupingTreeList,\r\n            addManagedEventListeners: (handlers) => this.addManagedEventListeners(handlers),\r\n        });\r\n\r\n        this.initialiseFilterBodyUi();\r\n\r\n        this.addEventListenersForDataChanges();\r\n    }\r\n\r\n    private onAddCurrentSelectionToFilterChange(newValue: boolean) {\r\n        this.valueModel.setAddCurrentSelectionToFilter(newValue);\r\n    }\r\n\r\n    private setValueFormatter(\r\n        providedValueFormatter: ((params: ValueFormatterParams) => string) | undefined,\r\n        keyCreator: ((params: KeyCreatorParams<any, any>) => string) | undefined,\r\n        treeList: boolean,\r\n        isRefData: boolean\r\n    ) {\r\n        let valueFormatter = providedValueFormatter;\r\n        if (!valueFormatter) {\r\n            if (keyCreator && !treeList) {\r\n                _error(249);\r\n                return;\r\n            }\r\n            this.noValueFormatterSupplied = true;\r\n            // ref data is handled by ValueService\r\n            if (!isRefData) {\r\n                valueFormatter = (params) => _toStringOrNull(params.value)!;\r\n            }\r\n        }\r\n        this.valueFormatter = valueFormatter;\r\n    }\r\n\r\n    private generateCreateKey(\r\n        keyCreator: ((params: KeyCreatorParams<any, any>) => string) | undefined,\r\n        treeDataOrGrouping: boolean\r\n    ): (value: V | null | undefined, node?: IRowNode | null) => string | null {\r\n        if (treeDataOrGrouping && !keyCreator) {\r\n            _error(250);\r\n            return () => null;\r\n        }\r\n        if (keyCreator) {\r\n            return (value, node = null) => {\r\n                const params = this.getKeyCreatorParams(value, node);\r\n                return _makeNull(keyCreator!(params));\r\n            };\r\n        }\r\n        return (value) => _makeNull(_toStringOrNull(value));\r\n    }\r\n\r\n    public getFormattedValue(key: string | null): string | null {\r\n        let value: V | string | null = this.valueModel.getValue(key);\r\n        if (this.noValueFormatterSupplied && (this.treeDataTreeList || this.groupingTreeList) && Array.isArray(value)) {\r\n            // essentially get back the cell value\r\n            value = _last(value) as string;\r\n        }\r\n\r\n        const formattedValue = this.valueSvc.formatValue(\r\n            this.setFilterParams.column as AgColumn,\r\n            null,\r\n            value,\r\n            this.valueFormatter,\r\n            false\r\n        );\r\n\r\n        return (\r\n            (formattedValue == null ? _toStringOrNull(value) : formattedValue) ?? this.translateForSetFilter('blanks')\r\n        );\r\n    }\r\n\r\n    private applyExcelModeOptions(params: SetFilterParams<any, V>): void {\r\n        // apply default options to match Excel behaviour, unless they have already been specified\r\n        if (params.excelMode === 'windows') {\r\n            if (!params.buttons) {\r\n                params.buttons = ['apply', 'cancel'];\r\n            }\r\n\r\n            if (params.closeOnApply == null) {\r\n                params.closeOnApply = true;\r\n            }\r\n        } else if (params.excelMode === 'mac') {\r\n            if (!params.buttons) {\r\n                params.buttons = ['reset'];\r\n            }\r\n\r\n            if (params.applyMiniFilterWhileTyping == null) {\r\n                params.applyMiniFilterWhileTyping = true;\r\n            }\r\n\r\n            if (params.debounceMs == null) {\r\n                params.debounceMs = 500;\r\n            }\r\n        }\r\n        if (params.excelMode && params.defaultToNothingSelected) {\r\n            params.defaultToNothingSelected = false;\r\n            _warn(207);\r\n        }\r\n    }\r\n\r\n    private addEventListenersForDataChanges(): void {\r\n        if (!this.isValuesTakenFromGrid()) {\r\n            return;\r\n        }\r\n\r\n        this.addManagedPropertyListeners(['groupAllowUnbalanced'], () => {\r\n            this.syncAfterDataChange();\r\n        });\r\n\r\n        this.addManagedEventListeners({\r\n            cellValueChanged: (event) => {\r\n                // only interested in changes to do with this column\r\n                if (event.column === this.setFilterParams.column) {\r\n                    this.syncAfterDataChange();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    private syncAfterDataChange(): AgPromise<void> {\r\n        const promise = this.valueModel.refreshValues();\r\n\r\n        return promise.then(() => {\r\n            this.checkAndRefreshVirtualList();\r\n            if (!this.applyActive || this.areModelsEqual(this.getModel()!, this.getModelFromUi()!)) {\r\n                this.onBtApply(false, true);\r\n            }\r\n        });\r\n    }\r\n\r\n    private setIsLoading(isLoading: boolean): void {\r\n        _setDisplayed(this.eFilterLoading, isLoading);\r\n        if (!isLoading) {\r\n            // hard refresh when async data received\r\n            this.hardRefreshVirtualList = true;\r\n        }\r\n    }\r\n\r\n    private initialiseFilterBodyUi(): void {\r\n        this.initVirtualList();\r\n        this.initMiniFilter();\r\n    }\r\n\r\n    private initVirtualList(): void {\r\n        const translate = this.getLocaleTextFunc();\r\n        const filterListName = translate('ariaFilterList', 'Filter List');\r\n        const isTree = !!this.setFilterParams.treeList;\r\n\r\n        const virtualList = (this.virtualList = this.createBean(\r\n            new VirtualList({\r\n                cssIdentifier: 'filter',\r\n                ariaRole: isTree ? 'tree' : 'listbox',\r\n                listName: filterListName,\r\n            })\r\n        ));\r\n        const eSetFilterList = this.eSetFilterList;\r\n\r\n        if (isTree) {\r\n            eSetFilterList.classList.add('ag-set-filter-tree-list');\r\n        }\r\n\r\n        if (eSetFilterList) {\r\n            eSetFilterList.appendChild(virtualList.getGui());\r\n        }\r\n\r\n        const { cellHeight } = this.setFilterParams;\r\n\r\n        if (cellHeight != null) {\r\n            virtualList.setRowHeight(cellHeight);\r\n        }\r\n\r\n        const componentCreator = (item: SetFilterModelTreeItem | string | null, listItemElement: HTMLElement) =>\r\n            this.createSetListItem(item, isTree, listItemElement);\r\n        virtualList.setComponentCreator(componentCreator);\r\n\r\n        const componentUpdater = (\r\n            item: SetFilterModelTreeItem | string | null,\r\n            component: SetFilterListItem<V | string | null>\r\n        ) => this.updateSetListItem(item, component);\r\n        virtualList.setComponentUpdater(componentUpdater);\r\n\r\n        this.createVirtualListModel(this.setFilterParams);\r\n    }\r\n\r\n    private createVirtualListModel(params: SetFilterParams<any, V>): void {\r\n        let model: VirtualListModel;\r\n        if (params.suppressSelectAll) {\r\n            model = new ModelWrapper(this.valueModel);\r\n        } else {\r\n            model = new ModelWrapperWithSelectAll(this.valueModel, () => this.isSelectAllSelected());\r\n        }\r\n        if (params.treeList) {\r\n            model = new TreeModelWrapper(model);\r\n        }\r\n\r\n        this.virtualList.setModel(model);\r\n    }\r\n\r\n    private getSelectAllLabel(): string {\r\n        const key =\r\n            this.valueModel.getMiniFilter() == null || !this.setFilterParams.excelMode\r\n                ? 'selectAll'\r\n                : 'selectAllSearchResults';\r\n\r\n        return this.translateForSetFilter(key);\r\n    }\r\n\r\n    private getAddSelectionToFilterLabel(): string {\r\n        return this.translateForSetFilter('addCurrentSelectionToFilter');\r\n    }\r\n\r\n    private createSetListItem(\r\n        item: SetFilterModelTreeItem | string | null,\r\n        isTree: boolean,\r\n        focusWrapper: HTMLElement\r\n    ): SetFilterListItem<V | string | null> {\r\n        const groupsExist = this.valueModel.hasGroups();\r\n        const { isSelected, isExpanded } = this.isSelectedExpanded(item);\r\n\r\n        const { value, depth, isGroup, hasIndeterminateExpandState, selectedListener, expandedListener } =\r\n            this.newSetListItemAttributes(item);\r\n\r\n        const itemParams: SetFilterListItemParams<V | string | null> = {\r\n            focusWrapper,\r\n            value,\r\n            params: this.setFilterParams,\r\n            translate: (translateKey: any) => this.translateForSetFilter(translateKey),\r\n            valueFormatter: this.valueFormatter,\r\n            item,\r\n            isSelected,\r\n            isTree,\r\n            depth,\r\n            groupsExist,\r\n            isGroup,\r\n            isExpanded,\r\n            hasIndeterminateExpandState,\r\n        };\r\n        const listItem = this.createBean(new SetFilterListItem<V | string | null>(itemParams));\r\n\r\n        listItem.addEventListener('selectionChanged', selectedListener as any);\r\n        if (expandedListener) {\r\n            listItem.addEventListener('expandedChanged', expandedListener as any);\r\n        }\r\n\r\n        return listItem;\r\n    }\r\n\r\n    private newSetTreeItemAttributes(item: SetFilterModelTreeItem): {\r\n        value: V | string | (() => string) | null;\r\n        depth?: number | undefined;\r\n        isGroup?: boolean | undefined;\r\n        hasIndeterminateExpandState?: boolean | undefined;\r\n        selectedListener: (e: SetFilterListItemSelectionChangedEvent) => void;\r\n        expandedListener?: (e: SetFilterListItemExpandedChangedEvent) => void;\r\n    } {\r\n        const groupsExist = this.valueModel.hasGroups();\r\n\r\n        // Select all option\r\n        if (item.key === SET_FILTER_SELECT_ALL) {\r\n            return {\r\n                value: () => this.getSelectAllLabel(),\r\n                isGroup: groupsExist,\r\n                depth: item.depth,\r\n                hasIndeterminateExpandState: true,\r\n                selectedListener: (e: SetFilterListItemSelectionChangedEvent) => this.onSelectAll(e.isSelected),\r\n                expandedListener: (e: SetFilterListItemExpandedChangedEvent<SetFilterModelTreeItem>) =>\r\n                    this.onExpandAll(e.item, e.isExpanded),\r\n            };\r\n        }\r\n\r\n        // Add selection to filter option\r\n        if (item.key === SET_FILTER_ADD_SELECTION_TO_FILTER) {\r\n            return {\r\n                value: () => this.getAddSelectionToFilterLabel(),\r\n                depth: item.depth,\r\n                isGroup: false,\r\n                hasIndeterminateExpandState: false,\r\n                selectedListener: (e: SetFilterListItemSelectionChangedEvent) => {\r\n                    this.onAddCurrentSelectionToFilterChange(e.isSelected);\r\n                },\r\n            };\r\n        }\r\n\r\n        // Group\r\n        if (item.children) {\r\n            return {\r\n                value:\r\n                    this.setFilterParams.treeListFormatter?.(item.treeKey, item.depth, item.parentTreeKeys) ??\r\n                    item.treeKey,\r\n                depth: item.depth,\r\n                isGroup: true,\r\n                selectedListener: (e: SetFilterListItemSelectionChangedEvent<SetFilterModelTreeItem>) =>\r\n                    this.onGroupItemSelected(e.item, e.isSelected),\r\n                expandedListener: (e: SetFilterListItemExpandedChangedEvent<SetFilterModelTreeItem>) =>\r\n                    this.onExpandedChanged(e.item, e.isExpanded),\r\n            };\r\n        }\r\n\r\n        // Leaf\r\n        return {\r\n            value:\r\n                this.setFilterParams.treeListFormatter?.(item.treeKey, item.depth, item.parentTreeKeys) ?? item.treeKey,\r\n            depth: item.depth,\r\n            selectedListener: (e: SetFilterListItemSelectionChangedEvent<SetFilterModelTreeItem>) =>\r\n                this.onItemSelected(e.item.key!, e.isSelected),\r\n        };\r\n    }\r\n\r\n    private newSetListItemAttributes(item: SetFilterModelTreeItem | string | null): {\r\n        value: V | string | (() => string) | null;\r\n        depth?: number | undefined;\r\n        isGroup?: boolean | undefined;\r\n        hasIndeterminateExpandState?: boolean | undefined;\r\n        selectedListener: (e: SetFilterListItemSelectionChangedEvent) => void;\r\n        expandedListener?: (e: SetFilterListItemExpandedChangedEvent) => void;\r\n    } {\r\n        // Tree item\r\n        if (this.isSetFilterModelTreeItem(item)) {\r\n            return this.newSetTreeItemAttributes(item);\r\n        }\r\n\r\n        // List item - 'Select All'\r\n        if (item === SET_FILTER_SELECT_ALL) {\r\n            return {\r\n                value: () => this.getSelectAllLabel(),\r\n                selectedListener: (e: SetFilterListItemSelectionChangedEvent<string>) => this.onSelectAll(e.isSelected),\r\n            };\r\n        }\r\n\r\n        // List item - 'Add selection to filter'\r\n        if (item === SET_FILTER_ADD_SELECTION_TO_FILTER) {\r\n            return {\r\n                value: () => this.getAddSelectionToFilterLabel(),\r\n                selectedListener: (e: SetFilterListItemSelectionChangedEvent<string | null>) => {\r\n                    this.onAddCurrentSelectionToFilterChange(e.isSelected);\r\n                },\r\n            };\r\n        }\r\n\r\n        // List item\r\n        return {\r\n            value: this.valueModel.getValue(item),\r\n            selectedListener: (e: SetFilterListItemSelectionChangedEvent<string | null>) =>\r\n                this.onItemSelected(e.item, e.isSelected),\r\n        };\r\n    }\r\n\r\n    private updateSetListItem(\r\n        item: SetFilterModelTreeItem | string | null,\r\n        component: SetFilterListItem<V | string | null>\r\n    ): void {\r\n        const { isSelected, isExpanded } = this.isSelectedExpanded(item);\r\n        component.refresh(item, isSelected, isExpanded);\r\n    }\r\n\r\n    private isSelectedExpanded(item: SetFilterModelTreeItem | string | null): {\r\n        isSelected: boolean | undefined;\r\n        isExpanded: boolean | undefined;\r\n    } {\r\n        let isSelected: boolean | undefined;\r\n        let isExpanded: boolean | undefined;\r\n        if (this.isSetFilterModelTreeItem(item)) {\r\n            isExpanded = item.expanded;\r\n            if (item.key === SET_FILTER_SELECT_ALL) {\r\n                isSelected = this.isSelectAllSelected();\r\n            } else if (item.key === SET_FILTER_ADD_SELECTION_TO_FILTER) {\r\n                isSelected = this.valueModel.isAddCurrentSelectionToFilterChecked();\r\n            } else if (item.children) {\r\n                isSelected = this.areAllChildrenSelected(item);\r\n            } else {\r\n                isSelected = this.valueModel.isKeySelected(item.key!);\r\n            }\r\n        } else {\r\n            if (item === SET_FILTER_SELECT_ALL) {\r\n                isSelected = this.isSelectAllSelected();\r\n            } else if (item === SET_FILTER_ADD_SELECTION_TO_FILTER) {\r\n                isSelected = this.valueModel.isAddCurrentSelectionToFilterChecked();\r\n            } else {\r\n                isSelected = this.valueModel.isKeySelected(item);\r\n            }\r\n        }\r\n        return { isSelected, isExpanded };\r\n    }\r\n\r\n    private isSetFilterModelTreeItem(item: any): item is SetFilterModelTreeItem {\r\n        return item?.treeKey !== undefined;\r\n    }\r\n\r\n    private initMiniFilter() {\r\n        const { eMiniFilter } = this;\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        eMiniFilter.setDisplayed(!this.setFilterParams.suppressMiniFilter);\r\n        eMiniFilter.setValue(this.valueModel.getMiniFilter());\r\n        eMiniFilter.onValueChange(() => this.onMiniFilterInput());\r\n        eMiniFilter.setInputAriaLabel(translate('ariaSearchFilterValues', 'Search filter values'));\r\n\r\n        this.addManagedElementListeners(eMiniFilter.getInputElement(), {\r\n            keydown: (e) => this.onMiniFilterKeyDown(e!),\r\n        });\r\n    }\r\n\r\n    private updateMiniFilter() {\r\n        const { eMiniFilter } = this;\r\n\r\n        if (eMiniFilter.isDisplayed() !== !this.setFilterParams.suppressMiniFilter) {\r\n            eMiniFilter.setDisplayed(!this.setFilterParams.suppressMiniFilter);\r\n        }\r\n\r\n        const miniFilterValue = this.valueModel.getMiniFilter();\r\n        if (eMiniFilter.getValue() !== miniFilterValue) {\r\n            eMiniFilter.setValue(miniFilterValue);\r\n        }\r\n    }\r\n\r\n    // we need to have the GUI attached before we can draw the virtual rows, as the\r\n    // virtual row logic needs info about the GUI state\r\n    public override afterGuiAttached(params?: IAfterGuiAttachedParams): void {\r\n        super.afterGuiAttached(params);\r\n\r\n        // collapse all tree list items (if tree list)\r\n        this.resetExpansion();\r\n\r\n        this.refreshVirtualList();\r\n\r\n        const { eMiniFilter } = this;\r\n\r\n        eMiniFilter.setInputPlaceholder(this.translateForSetFilter('searchOoo'));\r\n\r\n        if (!params || !params.suppressFocus) {\r\n            if (eMiniFilter.isDisplayed()) {\r\n                eMiniFilter.getFocusableElement().focus();\r\n            } else {\r\n                this.virtualList.awaitStable(() => this.virtualList.focusRow(0));\r\n            }\r\n        }\r\n    }\r\n\r\n    public override afterGuiDetached(): void {\r\n        super.afterGuiDetached();\r\n\r\n        // discard any unapplied UI state (reset to model)\r\n        if (this.setFilterParams.excelMode) {\r\n            this.resetMiniFilter();\r\n        }\r\n        const appliedModel = this.getModel();\r\n        if (this.setFilterParams.excelMode || !this.areModelsEqual(appliedModel!, this.getModelFromUi()!)) {\r\n            this.resetUiToActiveModel(appliedModel);\r\n            this.showOrHideResults();\r\n        }\r\n    }\r\n\r\n    public override applyModel(source: 'api' | 'ui' | 'rowDataUpdated' = 'api'): boolean {\r\n        if (\r\n            this.setFilterParams.excelMode &&\r\n            source !== 'rowDataUpdated' &&\r\n            this.valueModel.isEverythingVisibleSelected()\r\n        ) {\r\n            // In Excel, if the filter is applied with all visible values selected, then any active filter on the\r\n            // column is removed. This ensures the filter is removed in this situation.\r\n            this.valueModel.selectAllMatchingMiniFilter();\r\n        }\r\n\r\n        // Here we implement AG-9090 TC2\r\n        // When 'Add current selection to filter' is visible and checked, but no filter is applied:\r\n        // Do NOT apply the current selection as filter.\r\n        const shouldKeepCurrentSelection =\r\n            this.valueModel.showAddCurrentSelectionToFilter() && this.valueModel.isAddCurrentSelectionToFilterChecked();\r\n        if (shouldKeepCurrentSelection && !this.getModel()) {\r\n            return false;\r\n        }\r\n\r\n        const result = super.applyModel(source);\r\n\r\n        // keep appliedModelKeys in sync with the applied model\r\n        const appliedModel = this.getModel();\r\n\r\n        if (appliedModel) {\r\n            if (!shouldKeepCurrentSelection) {\r\n                this.valueModel.setAppliedModelKeys(new Set());\r\n            }\r\n\r\n            appliedModel.values.forEach((key) => {\r\n                this.valueModel!.addToAppliedModelKeys(key);\r\n            });\r\n        } else {\r\n            if (!shouldKeepCurrentSelection) {\r\n                this.valueModel.setAppliedModelKeys(null);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    protected override isModelValid(model: SetFilterModel): boolean {\r\n        return this.setFilterParams.excelMode ? model == null || model.values.length > 0 : true;\r\n    }\r\n\r\n    public doesFilterPass(params: IDoesFilterPassParams): boolean {\r\n        if (!this.valueModel.getCaseFormattedAppliedModelKeys()) {\r\n            return true;\r\n        }\r\n\r\n        // if nothing selected, don't need to check value\r\n        if (!this.valueModel.hasAnyAppliedModelKey()) {\r\n            return false;\r\n        }\r\n\r\n        const { node } = params;\r\n        if (this.treeDataTreeList) {\r\n            return this.doesFilterPassForTreeData(node);\r\n        }\r\n        if (this.groupingTreeList) {\r\n            return this.doesFilterPassForGrouping(node);\r\n        }\r\n\r\n        const value = this.getValueFromNode(node);\r\n\r\n        if (value != null && Array.isArray(value)) {\r\n            if (value.length === 0) {\r\n                return this.valueModel.hasAppliedModelKey(null);\r\n            }\r\n            return value.some((v) => this.isInAppliedModel(this.createKey(v, node)));\r\n        }\r\n\r\n        return this.isInAppliedModel(this.createKey(value, node));\r\n    }\r\n\r\n    private doesFilterPassForTreeData(node: IRowNode): boolean {\r\n        if (node.childrenAfterGroup?.length) {\r\n            // only perform checking on leaves. The core filtering logic for tree data won't work properly otherwise\r\n            return false;\r\n        }\r\n        return this.isInAppliedModel(\r\n            this.createKey(\r\n                processDataPath(\r\n                    (node as RowNode).getRoute() ?? [node.key ?? node.id!],\r\n                    true,\r\n                    this.gos.get('groupAllowUnbalanced')\r\n                ) as any\r\n            ) as any\r\n        );\r\n    }\r\n\r\n    private doesFilterPassForGrouping(node: IRowNode): boolean {\r\n        const dataPath = (this.rowGroupColsSvc?.columns ?? []).map((groupCol) =>\r\n            this.valueSvc.getKeyForNode(groupCol, node)\r\n        );\r\n        dataPath.push(this.getValueFromNode(node));\r\n        return this.isInAppliedModel(\r\n            this.createKey(processDataPath(dataPath, false, this.gos.get('groupAllowUnbalanced')) as any) as any\r\n        );\r\n    }\r\n\r\n    private isInAppliedModel(key: string | null): boolean {\r\n        return this.valueModel.hasAppliedModelKey(key);\r\n    }\r\n\r\n    private getValueFromNode(node: IRowNode): V | null | undefined {\r\n        return this.setFilterParams.getValue(node);\r\n    }\r\n\r\n    private getKeyCreatorParams(value: V | null | undefined, node: IRowNode | null = null): KeyCreatorParams {\r\n        const { colDef, column, api, context } = this.setFilterParams;\r\n        return {\r\n            value,\r\n            colDef,\r\n            column,\r\n            node,\r\n            data: node?.data,\r\n            api,\r\n            context,\r\n        };\r\n    }\r\n\r\n    public override onNewRowsLoaded(): void {\r\n        if (this.isValuesTakenFromGrid()) {\r\n            this.syncAfterDataChange();\r\n        }\r\n    }\r\n\r\n    private isValuesTakenFromGrid(): boolean {\r\n        const valuesType = this.valueModel.getValuesType();\r\n        return valuesType === SetFilterModelValuesType.TAKEN_FROM_GRID_VALUES;\r\n    }\r\n\r\n    //noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Public method provided so the user can change the value of the filter once\r\n     * the filter has been already started\r\n     * @param values The values to use.\r\n     */\r\n    public setFilterValues(values: (V | null)[]): void {\r\n        this.valueModel.overrideValues(values).then(() => {\r\n            this.checkAndRefreshVirtualList();\r\n            this.onUiChanged();\r\n        });\r\n    }\r\n\r\n    //noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Public method provided so the user can reset the values of the filter once that it has started.\r\n     */\r\n    public resetFilterValues(): void {\r\n        this.valueModel.setValuesType(SetFilterModelValuesType.TAKEN_FROM_GRID_VALUES);\r\n        this.syncAfterDataChange();\r\n    }\r\n\r\n    public refreshFilterValues(): void {\r\n        // the model is still being initialised\r\n        if (!this.valueModel.isInitialised()) {\r\n            return;\r\n        }\r\n\r\n        this.valueModel.refreshValues().then(() => {\r\n            this.hardRefreshVirtualList = true;\r\n            this.checkAndRefreshVirtualList();\r\n            this.onUiChanged();\r\n        });\r\n    }\r\n\r\n    public onAnyFilterChanged(): void {\r\n        // don't block the current action when updating the values for this filter\r\n        setTimeout(() => {\r\n            if (!this.isAlive()) {\r\n                return;\r\n            }\r\n\r\n            this.valueModel.refreshAfterAnyFilterChanged().then((refresh) => {\r\n                if (refresh) {\r\n                    this.checkAndRefreshVirtualList();\r\n                    this.showOrHideResults();\r\n                }\r\n            });\r\n        }, 0);\r\n    }\r\n\r\n    private onMiniFilterInput() {\r\n        if (!this.valueModel.setMiniFilter(this.eMiniFilter.getValue())) {\r\n            return;\r\n        }\r\n\r\n        const { applyMiniFilterWhileTyping, readOnly } = this.setFilterParams;\r\n        if (!readOnly && applyMiniFilterWhileTyping) {\r\n            this.filterOnAllVisibleValues(false);\r\n        } else {\r\n            this.updateUiAfterMiniFilterChange();\r\n        }\r\n    }\r\n\r\n    private updateUiAfterMiniFilterChange(): void {\r\n        const { excelMode, readOnly } = this.setFilterParams;\r\n        if (excelMode == null || !!readOnly) {\r\n            this.checkAndRefreshVirtualList();\r\n        } else if (this.valueModel.getMiniFilter() == null) {\r\n            this.resetUiToActiveModel(this.getModel());\r\n        } else {\r\n            this.valueModel.selectAllMatchingMiniFilter(true);\r\n            this.checkAndRefreshVirtualList();\r\n            this.onUiChanged();\r\n        }\r\n\r\n        this.showOrHideResults();\r\n    }\r\n\r\n    private showOrHideResults(): void {\r\n        const hideResults = this.valueModel.getMiniFilter() != null && this.valueModel.getDisplayedValueCount() < 1;\r\n\r\n        _setDisplayed(this.eFilterNoMatches, hideResults);\r\n        _setDisplayed(this.eSetFilterList, !hideResults);\r\n    }\r\n\r\n    private resetMiniFilter(): void {\r\n        this.eMiniFilter.setValue(null, true);\r\n        this.valueModel.setMiniFilter(null);\r\n    }\r\n\r\n    protected override resetUiToActiveModel(\r\n        currentModel: SetFilterModel | null,\r\n        afterUiUpdatedFunc?: () => void\r\n    ): void {\r\n        // override the default behaviour as we don't always want to clear the mini filter\r\n        this.setModelAndRefresh(currentModel == null ? null : currentModel.values).then(() => {\r\n            this.onUiChanged(false, 'prevent');\r\n\r\n            afterUiUpdatedFunc?.();\r\n        });\r\n    }\r\n\r\n    protected override handleCancelEnd(e: Event): void {\r\n        this.setMiniFilter(null);\r\n        super.handleCancelEnd(e);\r\n    }\r\n\r\n    private onMiniFilterKeyDown(e: KeyboardEvent): void {\r\n        const { excelMode, readOnly } = this.setFilterParams;\r\n        if (e.key === KeyCode.ENTER && !excelMode && !readOnly) {\r\n            this.filterOnAllVisibleValues();\r\n        }\r\n    }\r\n\r\n    private filterOnAllVisibleValues(applyImmediately = true): void {\r\n        this.valueModel.selectAllMatchingMiniFilter(true);\r\n        this.checkAndRefreshVirtualList();\r\n        this.onUiChanged(false, applyImmediately ? 'immediately' : 'debounce');\r\n        this.showOrHideResults();\r\n    }\r\n\r\n    private focusRowIfAlive(rowIndex: number | null): void {\r\n        if (rowIndex == null) {\r\n            return;\r\n        }\r\n\r\n        window.setTimeout(() => {\r\n            if (this.isAlive()) {\r\n                this.virtualList.focusRow(rowIndex);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    private onSelectAll(isSelected: boolean): void {\r\n        if (isSelected) {\r\n            this.valueModel.selectAllMatchingMiniFilter();\r\n        } else {\r\n            this.valueModel.deselectAllMatchingMiniFilter();\r\n        }\r\n\r\n        this.refreshAfterSelection();\r\n    }\r\n\r\n    private onGroupItemSelected(item: SetFilterModelTreeItem, isSelected: boolean): void {\r\n        const recursiveGroupSelection = (i: SetFilterModelTreeItem) => {\r\n            if (i.children) {\r\n                i.children.forEach((childItem) => recursiveGroupSelection(childItem));\r\n            } else {\r\n                this.selectItem(i.key!, isSelected);\r\n            }\r\n        };\r\n\r\n        recursiveGroupSelection(item);\r\n\r\n        this.refreshAfterSelection();\r\n    }\r\n\r\n    private onItemSelected(key: string | null, isSelected: boolean): void {\r\n        this.selectItem(key, isSelected);\r\n\r\n        this.refreshAfterSelection();\r\n    }\r\n\r\n    private selectItem(key: string | null, isSelected: boolean): void {\r\n        if (isSelected) {\r\n            this.valueModel.selectKey(key);\r\n        } else {\r\n            this.valueModel.deselectKey(key);\r\n        }\r\n    }\r\n\r\n    private onExpandAll(item: SetFilterModelTreeItem, isExpanded: boolean): void {\r\n        const recursiveExpansion = (i: SetFilterModelTreeItem) => {\r\n            if (i.filterPasses && i.available && i.children) {\r\n                i.children.forEach((childItem) => recursiveExpansion(childItem));\r\n                i.expanded = isExpanded;\r\n            }\r\n        };\r\n\r\n        recursiveExpansion(item);\r\n\r\n        this.refreshAfterExpansion();\r\n    }\r\n\r\n    private onExpandedChanged(item: SetFilterModelTreeItem, isExpanded: boolean): void {\r\n        item.expanded = isExpanded;\r\n\r\n        this.refreshAfterExpansion();\r\n    }\r\n\r\n    private refreshAfterExpansion(): void {\r\n        const focusedRow = this.virtualList.getLastFocusedRow();\r\n\r\n        this.valueModel.updateDisplayedValues('expansion');\r\n\r\n        this.checkAndRefreshVirtualList();\r\n        this.focusRowIfAlive(focusedRow);\r\n    }\r\n\r\n    private refreshAfterSelection(): void {\r\n        const focusedRow = this.virtualList.getLastFocusedRow();\r\n\r\n        this.checkAndRefreshVirtualList();\r\n        this.onUiChanged();\r\n        this.focusRowIfAlive(focusedRow);\r\n    }\r\n\r\n    public setMiniFilter(newMiniFilter: string | null): void {\r\n        this.eMiniFilter.setValue(newMiniFilter);\r\n        this.onMiniFilterInput();\r\n    }\r\n\r\n    public getMiniFilter(): string | null {\r\n        return this.valueModel.getMiniFilter();\r\n    }\r\n\r\n    private checkAndRefreshVirtualList() {\r\n        this.virtualList.refresh(!this.hardRefreshVirtualList);\r\n\r\n        if (this.hardRefreshVirtualList) {\r\n            this.hardRefreshVirtualList = false;\r\n        }\r\n    }\r\n\r\n    public getFilterKeys(): SetFilterModelValue {\r\n        return this.valueModel.getKeys();\r\n    }\r\n\r\n    public getFilterValues(): (V | null)[] {\r\n        return this.valueModel.getValues();\r\n    }\r\n\r\n    public getValues(): SetFilterModelValue {\r\n        return this.getFilterKeys();\r\n    }\r\n\r\n    public refreshVirtualList(): void {\r\n        if (this.setFilterParams.refreshValuesOnOpen) {\r\n            this.refreshFilterValues();\r\n        } else {\r\n            this.checkAndRefreshVirtualList();\r\n        }\r\n    }\r\n\r\n    private translateForSetFilter(key: keyof ISetFilterLocaleText): string {\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        return translate(key, DEFAULT_LOCALE_TEXT[key]);\r\n    }\r\n\r\n    private isSelectAllSelected(): boolean | undefined {\r\n        if (!this.setFilterParams.defaultToNothingSelected) {\r\n            // everything selected by default\r\n            if (this.valueModel.hasSelections() && this.valueModel.isNothingVisibleSelected()) {\r\n                return false;\r\n            }\r\n\r\n            if (this.valueModel.isEverythingVisibleSelected()) {\r\n                return true;\r\n            }\r\n        } else {\r\n            // nothing selected by default\r\n            if (this.valueModel.hasSelections() && this.valueModel.isEverythingVisibleSelected()) {\r\n                return true;\r\n            }\r\n\r\n            if (this.valueModel.isNothingVisibleSelected()) {\r\n                return false;\r\n            }\r\n        }\r\n        // returning `undefined` means the checkbox status is indeterminate.\r\n        return undefined;\r\n    }\r\n\r\n    private areAllChildrenSelected(item: SetFilterModelTreeItem): boolean | undefined {\r\n        const recursiveChildSelectionCheck = (i: SetFilterModelTreeItem): boolean | undefined => {\r\n            if (i.children) {\r\n                let someTrue = false;\r\n                let someFalse = false;\r\n                const mixed = i.children.some((child) => {\r\n                    if (!child.filterPasses || !child.available) {\r\n                        return false;\r\n                    }\r\n                    const childSelected = recursiveChildSelectionCheck(child);\r\n                    if (childSelected === undefined) {\r\n                        return true;\r\n                    }\r\n                    if (childSelected) {\r\n                        someTrue = true;\r\n                    } else {\r\n                        someFalse = true;\r\n                    }\r\n                    return someTrue && someFalse;\r\n                });\r\n                // returning `undefined` means the checkbox status is indeterminate.\r\n                // if not mixed and some true, all must be true\r\n                return mixed ? undefined : someTrue;\r\n            } else {\r\n                return this.valueModel.isKeySelected(i.key!);\r\n            }\r\n        };\r\n\r\n        if (!this.setFilterParams!.defaultToNothingSelected) {\r\n            // everything selected by default\r\n            return recursiveChildSelectionCheck(item);\r\n        } else {\r\n            // nothing selected by default\r\n            return this.valueModel.hasSelections() && recursiveChildSelectionCheck(item);\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        (this.virtualList as any) = this.destroyBean(this.virtualList);\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    private caseFormat<T extends string | number | null>(valueToFormat: T): typeof valueToFormat {\r\n        if (valueToFormat == null || typeof valueToFormat !== 'string') {\r\n            return valueToFormat;\r\n        }\r\n        return this.caseSensitive ? valueToFormat : (valueToFormat.toUpperCase() as T);\r\n    }\r\n\r\n    private resetExpansion(): void {\r\n        if (!this.setFilterParams.treeList) {\r\n            return;\r\n        }\r\n\r\n        const selectAllItem = this.valueModel.getSelectAllItem();\r\n\r\n        if (this.isSetFilterModelTreeItem(selectAllItem)) {\r\n            const recursiveCollapse = (i: SetFilterModelTreeItem) => {\r\n                if (i.children) {\r\n                    i.children.forEach((childItem) => recursiveCollapse(childItem));\r\n                    i.expanded = false;\r\n                }\r\n            };\r\n            recursiveCollapse(selectAllItem);\r\n            this.valueModel.updateDisplayedValues('expansion');\r\n        }\r\n    }\r\n\r\n    public getModelAsString(model: SetFilterModel): string {\r\n        return this.filterModelFormatter.getModelAsString(model, this);\r\n    }\r\n\r\n    protected override getPositionableElement(): HTMLElement {\r\n        return this.eSetFilterList;\r\n    }\r\n}\r\n\r\nclass ModelWrapper<V> implements VirtualListModel {\r\n    constructor(private readonly model: SetValueModel<V>) {}\r\n\r\n    public getRowCount(): number {\r\n        return this.model.getDisplayedValueCount();\r\n    }\r\n\r\n    public getRow(index: number): string | null {\r\n        return this.model.getDisplayedItem(index) as any;\r\n    }\r\n\r\n    public areRowsEqual(oldRow: string | null, newRow: string | null): boolean {\r\n        return oldRow === newRow;\r\n    }\r\n}\r\n\r\nclass ModelWrapperWithSelectAll<V> implements VirtualListModel {\r\n    constructor(\r\n        private readonly model: SetValueModel<V>,\r\n        private readonly isSelectAllSelected: () => boolean | undefined\r\n    ) {}\r\n\r\n    public getRowCount(): number {\r\n        const showAddCurrentSelectionToFilter = this.model.showAddCurrentSelectionToFilter();\r\n        const outboundItems = showAddCurrentSelectionToFilter ? 2 : 1;\r\n        return this.model.getDisplayedValueCount() + outboundItems;\r\n    }\r\n\r\n    public getRow(index: number): string | null {\r\n        if (index === 0) {\r\n            return this.model.getSelectAllItem() as any;\r\n        }\r\n\r\n        const showAddCurrentSelectionToFilter = this.model.showAddCurrentSelectionToFilter();\r\n        const outboundItems = showAddCurrentSelectionToFilter ? 2 : 1;\r\n        if (index === 1 && showAddCurrentSelectionToFilter) {\r\n            return this.model.getAddSelectionToFilterItem() as any;\r\n        }\r\n\r\n        return this.model.getDisplayedItem(index - outboundItems) as any;\r\n    }\r\n\r\n    public areRowsEqual(oldRow: string | null, newRow: string | null): boolean {\r\n        return oldRow === newRow;\r\n    }\r\n}\r\n\r\n// isRowSelected is used by VirtualList to add aria tags for flat lists. We want to suppress this when using trees\r\nclass TreeModelWrapper implements VirtualListModel {\r\n    constructor(private readonly model: VirtualListModel) {}\r\n\r\n    public getRowCount(): number {\r\n        return this.model.getRowCount();\r\n    }\r\n\r\n    public getRow(index: number): SetFilterModelTreeItem | null {\r\n        return this.model.getRow(index);\r\n    }\r\n\r\n    public areRowsEqual(oldRow: SetFilterModelTreeItem | null, newRow: SetFilterModelTreeItem | null): boolean {\r\n        if (oldRow == null && newRow == null) {\r\n            return true;\r\n        }\r\n        return oldRow != null && newRow != null && oldRow.treeKey === newRow.treeKey && oldRow.depth === newRow.depth;\r\n    }\r\n}\r\n", "export interface ISetDisplayValueModel<V> {\r\n    updateDisplayedValuesToAllAvailable(\r\n        getValue: (key: string | null) => V | null,\r\n        allKeys: Iterable<string | null> | undefined,\r\n        availableKeys: Set<string | null>,\r\n        source: 'reload' | 'otherFilter' | 'miniFilter'\r\n    ): void;\r\n\r\n    updateDisplayedValuesToMatchMiniFilter(\r\n        getValue: (key: string | null) => V | null,\r\n        allKeys: Iterable<string | null> | undefined,\r\n        availableKeys: Set<string | null>,\r\n        matchesFilter: (valueToCheck: string | null) => boolean,\r\n        nullMatchesFilter: boolean,\r\n        source: 'reload' | 'otherFilter' | 'miniFilter'\r\n    ): void;\r\n\r\n    getDisplayedValueCount(): number;\r\n\r\n    getDisplayedItem(index: number): string | SetFilterModelTreeItem | null;\r\n\r\n    getSelectAllItem(): string | SetFilterModelTreeItem;\r\n\r\n    getAddSelectionToFilterItem(): string | SetFilterModelTreeItem;\r\n\r\n    getDisplayedKeys(): (string | null)[];\r\n\r\n    forEachDisplayedKey(func: (key: string | null) => void): void;\r\n\r\n    someDisplayedKey(func: (key: string | null) => boolean): boolean;\r\n\r\n    hasGroups(): boolean;\r\n\r\n    refresh(): void;\r\n}\r\n\r\nexport const SET_FILTER_SELECT_ALL = '__AG_SELECT_ALL__';\r\nexport const SET_FILTER_ADD_SELECTION_TO_FILTER = '__AG_ADD_SELECTION_TO_FILTER__';\r\n\r\nexport interface SetFilterModelTreeItem {\r\n    treeKey: string | null;\r\n    depth: number;\r\n    filterPasses: boolean;\r\n    available: boolean;\r\n    expanded?: boolean;\r\n    children?: SetFilterModelTreeItem[];\r\n    key?: string | null;\r\n    parentTreeKeys: (string | null)[];\r\n}\r\n", "export interface ISetFilterLocaleText {\r\n    loadingOoo: string;\r\n    blanks: string;\r\n    searchOoo: string;\r\n    selectAll: string;\r\n    selectAllSearchResults: string;\r\n    addCurrentSelectionToFilter: string;\r\n    noMatches: string;\r\n}\r\n\r\nexport const DEFAULT_LOCALE_TEXT: ISetFilterLocaleText = {\r\n    loadingOoo: 'Loading...',\r\n    blanks: '(Blanks)',\r\n    searchOoo: 'Search...',\r\n    selectAll: '(Select All)',\r\n    selectAllSearchResults: '(Select All Search Results)',\r\n    addCurrentSelectionToFilter: 'Add current selection to filter',\r\n    noMatches: 'No matches.',\r\n};\r\n", "import type {\r\n    AgCheckbox,\r\n    AgColumn,\r\n    AgEvent,\r\n    ColDef,\r\n    ICellRendererComp,\r\n    ISetFilterCellRendererParams,\r\n    ITooltipCtrl,\r\n    SetFilterParams,\r\n    TooltipFeature,\r\n    ValueFormatterParams,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgCheckboxSelector,\r\n    Component,\r\n    RefPlaceholder,\r\n    _createIcon,\r\n    _getCellRendererDetails,\r\n    _getShouldDisplayTooltip,\r\n    _isShowTooltipWhenTruncated,\r\n    _setAriaChecked,\r\n    _setAriaDescribedBy,\r\n    _setAriaExpanded,\r\n    _setAriaLabel,\r\n    _setAriaLabelledBy,\r\n    _setAriaLevel,\r\n    _setDisplayed,\r\n    _toStringOrNull,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { SetFilterModelTreeItem } from './iSetDisplayValueModel';\r\nimport type { ISetFilterLocaleText } from './localeText';\r\n\r\nexport interface SetFilterListItemSelectionChangedEvent<\r\n    I extends SetFilterModelTreeItem | string | null = SetFilterModelTreeItem | string | null,\r\n> extends AgEvent<'selectionChanged'> {\r\n    isSelected: boolean;\r\n    item: I;\r\n}\r\n\r\nexport interface SetFilterListItemExpandedChangedEvent<\r\n    I extends SetFilterModelTreeItem | string | null = SetFilterModelTreeItem | string | null,\r\n> extends AgEvent<'expandedChanged'> {\r\n    isExpanded: boolean;\r\n    item: I;\r\n}\r\n\r\nexport interface SetFilterListItemParams<V> {\r\n    focusWrapper: HTMLElement;\r\n    value: V | null | (() => string);\r\n    params: SetFilterParams<any, V>;\r\n    translate: (key: keyof ISetFilterLocaleText) => string;\r\n    valueFormatter?: (params: ValueFormatterParams) => string;\r\n    item: SetFilterModelTreeItem | string | null;\r\n    isSelected: boolean | undefined;\r\n    isTree?: boolean;\r\n    depth?: number;\r\n    groupsExist?: boolean;\r\n    isGroup?: boolean;\r\n    isExpanded?: boolean;\r\n    hasIndeterminateExpandState?: boolean;\r\n}\r\n\r\nexport type SetFilterListItemEvent = 'selectionChanged' | 'expandedChanged';\r\n/** @param V type of value in the Set Filter */\r\nexport class SetFilterListItem<V> extends Component<SetFilterListItemEvent> {\r\n    private readonly eCheckbox: AgCheckbox = RefPlaceholder;\r\n\r\n    private readonly eGroupOpenedIcon: HTMLElement = RefPlaceholder;\r\n    private readonly eGroupClosedIcon: HTMLElement = RefPlaceholder;\r\n    private readonly eGroupIndeterminateIcon: HTMLElement = RefPlaceholder;\r\n\r\n    private readonly focusWrapper: HTMLElement;\r\n    private readonly value: V | null | (() => string);\r\n    private readonly params: SetFilterParams<any, V>;\r\n    private readonly translate: (key: keyof ISetFilterLocaleText) => string;\r\n    private readonly valueFormatter?: (params: ValueFormatterParams) => string;\r\n    private readonly isTree?: boolean;\r\n    private readonly depth: number;\r\n    private readonly isGroup?: boolean;\r\n    private readonly groupsExist?: boolean;\r\n    private readonly hasIndeterminateExpandState?: boolean;\r\n\r\n    private item: SetFilterModelTreeItem | string | null;\r\n    private isSelected: boolean | undefined;\r\n    private isExpanded: boolean | undefined;\r\n    // only used for select all\r\n    private valueFunction?: () => string;\r\n\r\n    private cellRendererParams: ISetFilterCellRendererParams;\r\n    private cellRendererComponent?: ICellRendererComp;\r\n    private destroyCellRendererComponent?: () => void;\r\n    private tooltipFeature?: TooltipFeature;\r\n    private shouldDisplayTooltip?: () => boolean;\r\n    private formattedValue: string | null = null;\r\n\r\n    constructor(params: SetFilterListItemParams<V>) {\r\n        super(\r\n            params.isGroup\r\n                ? /* html */ `\r\n            <div class=\"ag-set-filter-item\" aria-hidden=\"true\">\r\n                <span class=\"ag-set-filter-group-icons\">\r\n                    <span class=\"ag-set-filter-group-closed-icon\" data-ref=\"eGroupClosedIcon\"></span>\r\n                    <span class=\"ag-set-filter-group-opened-icon\" data-ref=\"eGroupOpenedIcon\"></span>\r\n                    <span class=\"ag-set-filter-group-indeterminate-icon\" data-ref=\"eGroupIndeterminateIcon\"></span>\r\n                </span>\r\n                <ag-checkbox data-ref=\"eCheckbox\" class=\"ag-set-filter-item-checkbox\"></ag-checkbox>\r\n            </div>`\r\n                : /* html */ `\r\n            <div class=\"ag-set-filter-item\">\r\n                <ag-checkbox data-ref=\"eCheckbox\" class=\"ag-set-filter-item-checkbox\"></ag-checkbox>\r\n            </div>`,\r\n            [AgCheckboxSelector]\r\n        );\r\n        this.focusWrapper = params.focusWrapper;\r\n        this.value = params.value;\r\n        this.params = params.params;\r\n        this.translate = params.translate;\r\n        this.valueFormatter = params.valueFormatter;\r\n        this.item = params.item;\r\n        this.isSelected = params.isSelected;\r\n        this.isTree = params.isTree;\r\n        this.depth = params.depth ?? 0;\r\n        this.isGroup = params.isGroup;\r\n        this.groupsExist = params.groupsExist;\r\n        this.isExpanded = params.isExpanded;\r\n        this.hasIndeterminateExpandState = params.hasIndeterminateExpandState;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.tooltipFeature = this.createOptionalManagedBean(\r\n            this.beans.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.getGui(),\r\n                getColDef: () => this.params.colDef,\r\n                getColumn: () => this.params.column as AgColumn,\r\n                getLocation: () => 'setFilterValue',\r\n                shouldDisplayTooltip: () => this.shouldDisplayTooltip?.() ?? true,\r\n                getValueFormatted: () => this.formattedValue,\r\n                getAdditionalParams: () => (this.isTree ? { level: this.depth } : {}),\r\n            } as ITooltipCtrl)\r\n        );\r\n\r\n        this.addDestroyFunc(() => this.destroyCellRendererComponent?.());\r\n\r\n        this.render();\r\n\r\n        this.eCheckbox\r\n            .setLabelEllipsis(true)\r\n            .setValue(this.isSelected, true)\r\n            .setDisabled(!!this.params.readOnly)\r\n            .getInputElement()\r\n            .setAttribute('tabindex', '-1');\r\n\r\n        this.refreshVariableAriaLabels();\r\n\r\n        if (this.isTree) {\r\n            if (this.depth > 0) {\r\n                this.addCssClass('ag-set-filter-indent-' + this.depth);\r\n                this.getGui().style.setProperty('--ag-indentation-level', String(this.depth));\r\n            }\r\n            if (this.isGroup) {\r\n                this.setupExpansion();\r\n            } else {\r\n                if (this.groupsExist) {\r\n                    this.addCssClass('ag-set-filter-add-group-indent');\r\n                }\r\n            }\r\n\r\n            _setAriaLevel(this.getAriaElement(), this.depth + 1);\r\n        }\r\n\r\n        this.refreshAriaChecked();\r\n\r\n        if (this.params.readOnly) {\r\n            // Don't add event listeners if we're read-only.\r\n            return;\r\n        }\r\n\r\n        this.eCheckbox.onValueChange((value) => this.onCheckboxChanged(!!value));\r\n    }\r\n\r\n    public override getFocusableElement(): HTMLElement {\r\n        return this.focusWrapper;\r\n    }\r\n\r\n    private setupExpansion(): void {\r\n        const { eGroupClosedIcon, eGroupOpenedIcon, eGroupIndeterminateIcon, hasIndeterminateExpandState, beans } =\r\n            this;\r\n\r\n        eGroupClosedIcon.appendChild(_createIcon('setFilterGroupClosed', beans, null));\r\n        eGroupOpenedIcon.appendChild(_createIcon('setFilterGroupOpen', beans, null));\r\n        const listener = this.onExpandOrContractClicked.bind(this);\r\n        this.addManagedElementListeners(eGroupClosedIcon, { click: listener });\r\n        this.addManagedElementListeners(eGroupOpenedIcon, { click: listener });\r\n\r\n        if (hasIndeterminateExpandState) {\r\n            eGroupIndeterminateIcon.appendChild(_createIcon('setFilterGroupIndeterminate', beans, null));\r\n            this.addManagedElementListeners(eGroupIndeterminateIcon, {\r\n                click: listener,\r\n            });\r\n        }\r\n\r\n        this.setExpandedIcons();\r\n        this.refreshAriaExpanded();\r\n    }\r\n\r\n    private onExpandOrContractClicked(): void {\r\n        this.setExpanded(!this.isExpanded);\r\n    }\r\n\r\n    public setExpanded(isExpanded: boolean | undefined, silent?: boolean): void {\r\n        if (this.isGroup && isExpanded !== this.isExpanded) {\r\n            this.isExpanded = isExpanded;\r\n\r\n            const event: SetFilterListItemExpandedChangedEvent = {\r\n                type: 'expandedChanged',\r\n                isExpanded: !!isExpanded,\r\n                item: this.item,\r\n            };\r\n\r\n            if (!silent) {\r\n                this.dispatchLocalEvent(event);\r\n            }\r\n\r\n            this.setExpandedIcons();\r\n            this.refreshAriaExpanded();\r\n        }\r\n    }\r\n\r\n    private setExpandedIcons(): void {\r\n        const { isExpanded, hasIndeterminateExpandState, eGroupClosedIcon, eGroupOpenedIcon, eGroupIndeterminateIcon } =\r\n            this;\r\n        _setDisplayed(eGroupClosedIcon, hasIndeterminateExpandState ? isExpanded === false : !isExpanded);\r\n        _setDisplayed(eGroupOpenedIcon, isExpanded === true);\r\n        if (hasIndeterminateExpandState) {\r\n            _setDisplayed(eGroupIndeterminateIcon, isExpanded === undefined);\r\n        }\r\n    }\r\n\r\n    private onCheckboxChanged(isSelected: boolean): void {\r\n        this.isSelected = isSelected;\r\n\r\n        const event: SetFilterListItemSelectionChangedEvent = {\r\n            type: 'selectionChanged',\r\n            isSelected,\r\n            item: this.item,\r\n        };\r\n\r\n        this.dispatchLocalEvent(event);\r\n        this.refreshVariableAriaLabels();\r\n        this.refreshAriaChecked();\r\n    }\r\n\r\n    public toggleSelected(): void {\r\n        if (this.params.readOnly) {\r\n            return;\r\n        }\r\n\r\n        this.setSelected(!this.isSelected);\r\n    }\r\n\r\n    private setSelected(isSelected: boolean | undefined, silent?: boolean) {\r\n        this.isSelected = isSelected;\r\n        this.eCheckbox.setValue(isSelected, silent);\r\n        this.refreshAriaChecked();\r\n    }\r\n\r\n    private refreshVariableAriaLabels(): void {\r\n        if (!this.isTree) {\r\n            return;\r\n        }\r\n        const translate = this.getLocaleTextFunc();\r\n        const checkboxValue = this.eCheckbox.getValue();\r\n        const state =\r\n            checkboxValue === undefined\r\n                ? translate('ariaIndeterminate', 'indeterminate')\r\n                : checkboxValue\r\n                  ? translate('ariaVisible', 'visible')\r\n                  : translate('ariaHidden', 'hidden');\r\n        const visibilityLabel = translate('ariaToggleVisibility', 'Press SPACE to toggle visibility');\r\n        _setAriaLabelledBy(this.eCheckbox.getInputElement(), undefined as any);\r\n        this.eCheckbox.setInputAriaLabel(`${visibilityLabel} (${state})`);\r\n    }\r\n\r\n    private setupFixedAriaLabels(value: any): void {\r\n        if (!this.isTree) {\r\n            return;\r\n        }\r\n        const translate = this.getLocaleTextFunc();\r\n        const itemLabel = translate('ariaFilterValue', 'Filter Value');\r\n        const ariaEl = this.getAriaElement();\r\n        _setAriaLabel(ariaEl, `${value} ${itemLabel}`);\r\n        _setAriaDescribedBy(ariaEl, this.eCheckbox.getInputElement().id);\r\n    }\r\n\r\n    private refreshAriaChecked(): void {\r\n        const ariaEl = this.getAriaElement();\r\n\r\n        _setAriaChecked(ariaEl, this.eCheckbox.getValue());\r\n    }\r\n\r\n    private refreshAriaExpanded(): void {\r\n        _setAriaExpanded(this.getAriaElement(), !!this.isExpanded);\r\n    }\r\n\r\n    public refresh(\r\n        item: SetFilterModelTreeItem | string | null,\r\n        isSelected: boolean | undefined,\r\n        isExpanded: boolean | undefined\r\n    ): void {\r\n        this.item = item;\r\n        // setExpanded checks if value has changed, setSelected does not\r\n        if (isSelected !== this.isSelected) {\r\n            this.setSelected(isSelected, true);\r\n        }\r\n        this.setExpanded(isExpanded, true);\r\n        const { cellRendererComponent, cellRendererParams, beans, params } = this;\r\n        if (this.valueFunction) {\r\n            // underlying value might have changed, so call again and re-render\r\n            const value = this.valueFunction();\r\n            this.setTooltipAndCellRendererParams(value as any, value);\r\n            if (!cellRendererComponent) {\r\n                this.renderCellWithoutCellRenderer();\r\n            }\r\n        }\r\n        if (cellRendererComponent) {\r\n            // need to get correct params for refresh from comp details\r\n            const compDetails = _getCellRendererDetails<SetFilterParams<any, V>, ISetFilterCellRendererParams>(\r\n                beans.userCompFactory,\r\n                params,\r\n                cellRendererParams\r\n            );\r\n            const success = cellRendererComponent.refresh?.(compDetails?.params ?? cellRendererParams);\r\n            if (!success) {\r\n                const oldComponent = cellRendererComponent;\r\n                this.renderCell();\r\n                this.destroyBean(oldComponent);\r\n            }\r\n        }\r\n    }\r\n\r\n    public render(): void {\r\n        const {\r\n            params: { column },\r\n        } = this;\r\n\r\n        let { value } = this;\r\n        let formattedValue: string | null = null;\r\n\r\n        if (typeof value === 'function') {\r\n            this.valueFunction = value as () => string;\r\n            formattedValue = this.valueFunction();\r\n            // backwards compatibility for select all in value\r\n            value = formattedValue as any;\r\n        } else if (this.isTree) {\r\n            // tree values are already formatted via treeListFormatter\r\n            formattedValue = _toStringOrNull(value);\r\n        } else {\r\n            formattedValue = this.getFormattedValue(column as AgColumn, value);\r\n        }\r\n        this.formattedValue = formattedValue;\r\n\r\n        this.setTooltipAndCellRendererParams(value, formattedValue);\r\n\r\n        this.renderCell();\r\n    }\r\n\r\n    private setTooltipAndCellRendererParams(value: V | null | (() => string), formattedValue: string | null): void {\r\n        const gos = this.gos;\r\n        if (this.params.showTooltips && (!_isShowTooltipWhenTruncated(gos) || !this.params.cellRenderer)) {\r\n            const newTooltipText = formattedValue != null ? formattedValue : _toStringOrNull(value);\r\n            this.shouldDisplayTooltip = _getShouldDisplayTooltip(\r\n                gos,\r\n                () => this.eCheckbox.getGui().querySelector('.ag-label') as HTMLElement | undefined\r\n            );\r\n            this.tooltipFeature?.setTooltipAndRefresh(newTooltipText);\r\n        }\r\n\r\n        this.cellRendererParams = gos.addGridCommonParams({\r\n            value,\r\n            valueFormatted: formattedValue,\r\n            colDef: this.params.colDef,\r\n            column: this.params.column,\r\n            setTooltip: (value: string, shouldDisplayTooltip: () => boolean) => {\r\n                gos.assertModuleRegistered('Tooltip', 3);\r\n                this.shouldDisplayTooltip = shouldDisplayTooltip;\r\n                this.tooltipFeature?.setTooltipAndRefresh(value);\r\n            },\r\n        });\r\n    }\r\n\r\n    private getFormattedValue(column: AgColumn, value: any) {\r\n        return this.beans.valueSvc.formatValue(column, null, value, this.valueFormatter, false);\r\n    }\r\n\r\n    private renderCell(): void {\r\n        const compDetails = _getCellRendererDetails<SetFilterParams<any, V>, ISetFilterCellRendererParams>(\r\n            this.beans.userCompFactory,\r\n            this.params,\r\n            this.cellRendererParams\r\n        );\r\n        const cellRendererPromise = compDetails?.newAgStackInstance();\r\n\r\n        if (cellRendererPromise == null) {\r\n            this.renderCellWithoutCellRenderer();\r\n            return;\r\n        }\r\n\r\n        cellRendererPromise.then((component) => {\r\n            if (component) {\r\n                this.cellRendererComponent = component;\r\n                this.eCheckbox.setLabel(component.getGui());\r\n                this.destroyCellRendererComponent = () => this.destroyBean(component);\r\n            }\r\n        });\r\n    }\r\n\r\n    private renderCellWithoutCellRenderer(): void {\r\n        const { valueFormatted, value } = this.cellRendererParams;\r\n        let valueToRender = (valueFormatted == null ? value : valueFormatted) ?? this.translate('blanks');\r\n        if (typeof valueToRender !== 'string') {\r\n            _warn(208);\r\n            valueToRender = '';\r\n        }\r\n\r\n        this.eCheckbox.setLabel(valueToRender);\r\n        this.setupFixedAriaLabels(valueToRender);\r\n    }\r\n\r\n    public getComponentHolder(): ColDef {\r\n        return this.params.column.getColDef();\r\n    }\r\n}\r\n", "import type { SetFilterModel } from 'ag-grid-community';\r\n\r\nimport type { SetFilter } from './setFilter';\r\n\r\nexport class SetFilterModelFormatter {\r\n    public getModelAsString<V>(model: SetFilterModel | null | undefined, setFilter: SetFilter<V>): string {\r\n        const { values } = model || setFilter.getModel() || {};\r\n        const valueModel = setFilter.getValueModel();\r\n\r\n        if (values == null || valueModel == null) {\r\n            return '';\r\n        }\r\n\r\n        const availableKeys = values.filter((v) => valueModel.isKeyAvailable(v));\r\n        const numValues = availableKeys.length;\r\n\r\n        const formattedValues = availableKeys.slice(0, 10).map((key) => setFilter.getFormattedValue(key));\r\n\r\n        return `(${numValues}) ${formattedValues.join(',')}${numValues > 10 ? ',...' : ''}`;\r\n    }\r\n}\r\n", "import { _last, _makeNull, _toStringOrNull } from 'ag-grid-community';\r\n\r\nexport function processDataPath(\r\n    dataPath: string[] | null,\r\n    treeData: boolean,\r\n    groupAllowUnbalanced: boolean\r\n): (string | null)[] | null {\r\n    let processedDataPath: (string | null)[] | null = dataPath;\r\n    if (!processedDataPath) {\r\n        return null;\r\n    }\r\n\r\n    processedDataPath = processedDataPath.map((treeKey) => _toStringOrNull(_makeNull(treeKey)));\r\n\r\n    // leave `null`s in the path unless unbalanced groups\r\n    if (!treeData && groupAllowUnbalanced && processedDataPath.some((treeKey) => treeKey == null)) {\r\n        if (_last(processedDataPath) == null) {\r\n            return null;\r\n        }\r\n        return processedDataPath.filter((treeKey) => treeKey != null);\r\n    }\r\n    return processedDataPath;\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AgEventType,\r\n    GridOptionsService,\r\n    IColsService,\r\n    IEventEmitter,\r\n    IEventListener,\r\n    RowNode,\r\n    SetFilterModelValue,\r\n    SetFilterParams,\r\n    SetFilterValues,\r\n    SetFilterValuesFunc,\r\n    SetFilterValuesFuncParams,\r\n    TextFormatter,\r\n    ValueFormatterParams,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgPromise,\r\n    LocalEventService,\r\n    _defaultComparator,\r\n    _error,\r\n    _exists,\r\n    _isClientSideRowModel,\r\n    _makeNull,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { ClientSideValuesExtractor } from './clientSideValueExtractor';\r\nimport { SetValueModelFilteringKeys } from './filteringKeys';\r\nimport { FlatSetDisplayValueModel } from './flatSetDisplayValueModel';\r\nimport type { ISetDisplayValueModel, SetFilterModelTreeItem } from './iSetDisplayValueModel';\r\nimport type { ISetFilterLocaleText } from './localeText';\r\nimport { TreeSetDisplayValueModel } from './treeSetDisplayValueModel';\r\n\r\nexport enum SetFilterModelValuesType {\r\n    PROVIDED_LIST,\r\n    PROVIDED_CALLBACK,\r\n    TAKEN_FROM_GRID_VALUES,\r\n}\r\n\r\nexport interface SetValueModelParams<V> {\r\n    gos: GridOptionsService;\r\n    rowGroupColsSvc?: IColsService;\r\n    valueSvc: ValueService;\r\n    filterParams: SetFilterParams<any, V>;\r\n    setIsLoading: (loading: boolean) => void;\r\n    translate: (key: keyof ISetFilterLocaleText) => string;\r\n    caseFormat: <T extends string | null>(valueToFormat: T) => typeof valueToFormat;\r\n    createKey: (value: V | null | undefined, node?: RowNode) => string | null;\r\n    valueFormatter?: (params: ValueFormatterParams) => string;\r\n    usingComplexObjects?: boolean;\r\n    treeDataTreeList?: boolean;\r\n    groupingTreeList?: boolean;\r\n    addManagedEventListeners: (handlers: Partial<Record<AgEventType, (event?: any) => void>>) => (() => null)[];\r\n}\r\n\r\nexport type SetValueModelEvent = 'availableValuesChanged';\r\n/** @param V type of value in the Set Filter */\r\nexport class SetValueModel<V> implements IEventEmitter<SetValueModelEvent> {\r\n    private readonly gos: GridOptionsService;\r\n    private readonly localEventService = new LocalEventService<SetValueModelEvent>();\r\n    private formatter: TextFormatter;\r\n    private suppressSorting: boolean;\r\n    private readonly clientSideValuesExtractor: ClientSideValuesExtractor<V>;\r\n    private readonly doesRowPassOtherFilters: (node: RowNode) => boolean;\r\n    private readonly keyComparator: (a: string | null, b: string | null) => number;\r\n    private readonly entryComparator: (a: [string | null, V | null], b: [string | null, V | null]) => number;\r\n    private readonly compareByValue: boolean;\r\n    private readonly caseSensitive: boolean;\r\n    private displayValueModel: ISetDisplayValueModel<V>;\r\n    private filterParams: SetFilterParams<any, V>;\r\n    private readonly setIsLoading: (loading: boolean) => void;\r\n    private readonly translate: (key: keyof ISetFilterLocaleText) => string;\r\n    private readonly caseFormat: <T extends string | null>(valueToFormat: T) => typeof valueToFormat;\r\n    private readonly createKey: (value: V | null | undefined, node?: RowNode) => string | null;\r\n    private readonly usingComplexObjects: boolean;\r\n\r\n    private valuesType: SetFilterModelValuesType;\r\n    private miniFilterText: string | null = null;\r\n\r\n    /** When true, in excelMode = 'windows', it adds previously selected filter items to newly checked filter selection */\r\n    private addCurrentSelectionToFilter: boolean = false;\r\n\r\n    /** Values provided to the filter for use. */\r\n    private providedValues: SetFilterValues<any, V> | null = null;\r\n\r\n    /** Values can be loaded asynchronously, so wait on this promise if you need to ensure values have been loaded. */\r\n    private allValuesPromise: AgPromise<(string | null)[]>;\r\n\r\n    /** All possible values for the filter, sorted if required. */\r\n    private allValues: Map<string | null, V | null> = new Map();\r\n\r\n    /** Remaining keys when filters from other columns have been applied. */\r\n    private availableKeys = new Set<string | null>();\r\n\r\n    /** Keys that have been selected for this filter. */\r\n    private selectedKeys = new Set<string | null>();\r\n\r\n    /**\r\n     * Here we keep track of the keys that are currently being used for filtering.\r\n     * In most cases, the filtering keys are the same as the selected keys,\r\n     * but for the specific case when excelMode = 'windows' and the user has ticked 'Add current selection to filter',\r\n     * the filtering keys can be different from the selected keys.\r\n     */\r\n    private filteringKeys: SetValueModelFilteringKeys;\r\n\r\n    private initialised: boolean = false;\r\n\r\n    constructor(params: SetValueModelParams<V>) {\r\n        const {\r\n            usingComplexObjects,\r\n            rowGroupColsSvc,\r\n            valueSvc,\r\n            treeDataTreeList,\r\n            groupingTreeList,\r\n            filterParams,\r\n            gos,\r\n            valueFormatter,\r\n            addManagedEventListeners,\r\n        } = params;\r\n        const {\r\n            column,\r\n            colDef,\r\n            textFormatter,\r\n            doesRowPassOtherFilter,\r\n            suppressSorting,\r\n            comparator,\r\n            rowModel,\r\n            values,\r\n            caseSensitive,\r\n            treeList,\r\n            treeListPathGetter,\r\n            treeListFormatter,\r\n        } = filterParams;\r\n\r\n        this.filterParams = filterParams;\r\n        this.gos = gos;\r\n        this.setIsLoading = params.setIsLoading;\r\n        this.translate = params.translate;\r\n        this.caseFormat = params.caseFormat;\r\n        this.createKey = params.createKey;\r\n        this.usingComplexObjects = !!params.usingComplexObjects;\r\n        this.formatter = textFormatter ?? ((value) => value ?? null);\r\n        this.doesRowPassOtherFilters = doesRowPassOtherFilter;\r\n        this.suppressSorting = suppressSorting || false;\r\n        this.filteringKeys = new SetValueModelFilteringKeys({ caseFormat: this.caseFormat });\r\n        const keyComparator = comparator ?? (colDef.comparator as (a: any, b: any) => number);\r\n        const treeDataOrGrouping = !!treeDataTreeList || !!groupingTreeList;\r\n        // If using complex objects and a comparator is provided, sort by values, otherwise need to sort by the string keys.\r\n        // Also if tree data, grouping, or date with tree list, then need to do value sort\r\n        this.compareByValue = !!(\r\n            (usingComplexObjects && keyComparator) ||\r\n            treeDataOrGrouping ||\r\n            (treeList && !treeListPathGetter)\r\n        );\r\n        if (treeDataOrGrouping && !keyComparator) {\r\n            this.entryComparator = this.createTreeDataOrGroupingComparator() as any;\r\n        } else if (treeList && !treeListPathGetter && !keyComparator) {\r\n            this.entryComparator = (\r\n                [_aKey, aValue]: [string | null, V | null],\r\n                [_bKey, bValue]: [string | null, V | null]\r\n            ) => _defaultComparator(aValue, bValue);\r\n        } else {\r\n            this.entryComparator = (\r\n                [_aKey, aValue]: [string | null, V | null],\r\n                [_bKey, bValue]: [string | null, V | null]\r\n            ) => keyComparator(aValue, bValue);\r\n        }\r\n        this.keyComparator = (keyComparator as any) ?? _defaultComparator;\r\n        this.caseSensitive = !!caseSensitive;\r\n        const groupAllowUnbalanced = gos.get('groupAllowUnbalanced');\r\n\r\n        if (_isClientSideRowModel(gos, rowModel)) {\r\n            this.clientSideValuesExtractor = new ClientSideValuesExtractor(\r\n                rowModel,\r\n                this.filterParams,\r\n                this.createKey,\r\n                this.caseFormat,\r\n                valueSvc,\r\n                treeDataOrGrouping,\r\n                !!treeDataTreeList,\r\n                groupAllowUnbalanced,\r\n                addManagedEventListeners,\r\n                rowGroupColsSvc\r\n            );\r\n        }\r\n\r\n        if (values == null) {\r\n            this.valuesType = SetFilterModelValuesType.TAKEN_FROM_GRID_VALUES;\r\n        } else {\r\n            this.valuesType = Array.isArray(values)\r\n                ? SetFilterModelValuesType.PROVIDED_LIST\r\n                : SetFilterModelValuesType.PROVIDED_CALLBACK;\r\n\r\n            this.providedValues = values;\r\n        }\r\n\r\n        this.displayValueModel = treeList\r\n            ? new TreeSetDisplayValueModel(\r\n                  this.formatter,\r\n                  treeListPathGetter,\r\n                  treeListFormatter,\r\n                  treeDataTreeList || groupingTreeList\r\n              )\r\n            : (new FlatSetDisplayValueModel<V>(valueSvc, valueFormatter, this.formatter, column as AgColumn) as any);\r\n\r\n        this.updateAllValues().then((updatedKeys) => this.resetSelectionState(updatedKeys || []));\r\n    }\r\n\r\n    public addEventListener<T extends SetValueModelEvent>(\r\n        eventType: T,\r\n        listener: IEventListener<T>,\r\n        async?: boolean\r\n    ): void {\r\n        this.localEventService.addEventListener(eventType, listener, async);\r\n    }\r\n\r\n    public removeEventListener<T extends SetValueModelEvent>(\r\n        eventType: T,\r\n        listener: IEventListener<T>,\r\n        async?: boolean\r\n    ): void {\r\n        this.localEventService.removeEventListener(eventType, listener, async);\r\n    }\r\n\r\n    public updateOnParamsChange(filterParams: SetFilterParams<any, V>): AgPromise<void> {\r\n        return new AgPromise<void>((resolve) => {\r\n            const { values, textFormatter, suppressSorting, treeListFormatter } = filterParams;\r\n\r\n            const currentProvidedValues = this.providedValues;\r\n            const currentSuppressSorting = this.suppressSorting;\r\n\r\n            this.filterParams = filterParams;\r\n            this.formatter = textFormatter ?? ((value) => value ?? null);\r\n\r\n            this.suppressSorting = suppressSorting || false;\r\n            this.providedValues = values ?? null;\r\n\r\n            if (this.displayValueModel instanceof TreeSetDisplayValueModel) {\r\n                this.displayValueModel.updateOnParamsChange(treeListFormatter);\r\n            }\r\n\r\n            // Rebuild values when values or their sort order changes\r\n            if (this.providedValues !== currentProvidedValues || this.suppressSorting !== currentSuppressSorting) {\r\n                if (!values || values.length === 0) {\r\n                    this.valuesType = SetFilterModelValuesType.TAKEN_FROM_GRID_VALUES;\r\n                    this.providedValues = null;\r\n                } else {\r\n                    this.valuesType = Array.isArray(values)\r\n                        ? SetFilterModelValuesType.PROVIDED_LIST\r\n                        : SetFilterModelValuesType.PROVIDED_CALLBACK;\r\n                }\r\n\r\n                const currentModel = this.getModel();\r\n                this.updateAllValues().then(() => {\r\n                    this.setModel(currentModel).then(() => resolve());\r\n                });\r\n            } else {\r\n                resolve();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Re-fetches the values used in the filter from the value source.\r\n     * If keepSelection is false, the filter selection will be reset to everything selected,\r\n     * otherwise the current selection will be preserved.\r\n     */\r\n    public refreshValues(): AgPromise<void> {\r\n        return new AgPromise<void>((resolve) => {\r\n            // don't get the model until values are resolved, as there could be queued setModel calls\r\n            this.allValuesPromise.then(() => {\r\n                const currentModel = this.getModel();\r\n\r\n                this.updateAllValues();\r\n\r\n                // ensure model is updated for new values\r\n                this.setModel(currentModel).then(() => resolve());\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Overrides the current values being used for the set filter.\r\n     * If keepSelection is false, the filter selection will be reset to everything selected,\r\n     * otherwise the current selection will be preserved.\r\n     */\r\n    public overrideValues(valuesToUse: (V | null)[]): AgPromise<void> {\r\n        return new AgPromise<void>((resolve) => {\r\n            // wait for any existing values to be populated before overriding\r\n            this.allValuesPromise.then(() => {\r\n                this.valuesType = SetFilterModelValuesType.PROVIDED_LIST;\r\n                this.providedValues = valuesToUse;\r\n                this.refreshValues().then(() => resolve());\r\n            });\r\n        });\r\n    }\r\n\r\n    /** @return has anything been updated */\r\n    public refreshAfterAnyFilterChanged(): AgPromise<boolean> {\r\n        if (this.showAvailableOnly()) {\r\n            return this.allValuesPromise.then((keys) => {\r\n                this.updateAvailableKeys(keys ?? [], 'otherFilter');\r\n                return true;\r\n            });\r\n        }\r\n        return AgPromise.resolve(false);\r\n    }\r\n\r\n    public isInitialised(): boolean {\r\n        return this.initialised;\r\n    }\r\n\r\n    private updateAllValues(): AgPromise<(string | null)[]> {\r\n        this.allValuesPromise = new AgPromise<(string | null)[]>((resolve) => {\r\n            switch (this.valuesType) {\r\n                case SetFilterModelValuesType.TAKEN_FROM_GRID_VALUES:\r\n                    this.getValuesFromRowsAsync(false).then((values) => resolve(this.processAllValues(values)));\r\n\r\n                    break;\r\n                case SetFilterModelValuesType.PROVIDED_LIST: {\r\n                    resolve(\r\n                        this.processAllValues(\r\n                            this.uniqueValues(this.validateProvidedValues(this.providedValues as (V | null)[]))\r\n                        )\r\n                    );\r\n\r\n                    break;\r\n                }\r\n\r\n                case SetFilterModelValuesType.PROVIDED_CALLBACK: {\r\n                    this.setIsLoading(true);\r\n\r\n                    const callback = this.providedValues as SetFilterValuesFunc<any, V>;\r\n                    const { column, colDef } = this.filterParams;\r\n                    const params: SetFilterValuesFuncParams<any, V> = this.gos.addGridCommonParams({\r\n                        success: (values) => {\r\n                            this.setIsLoading(false);\r\n\r\n                            resolve(this.processAllValues(this.uniqueValues(this.validateProvidedValues(values))));\r\n                        },\r\n                        colDef,\r\n                        column,\r\n                    });\r\n\r\n                    window.setTimeout(() => callback(params), 0);\r\n\r\n                    break;\r\n                }\r\n            }\r\n        });\r\n\r\n        this.allValuesPromise\r\n            .then((values) => this.updateAvailableKeys(values || [], 'reload'))\r\n            .then(() => (this.initialised = true));\r\n\r\n        return this.allValuesPromise;\r\n    }\r\n\r\n    private processAllValues(values: Map<string | null, V | null> | null): (string | null)[] {\r\n        const sortedKeys = this.sortKeys(values);\r\n\r\n        this.allValues = values ?? new Map();\r\n\r\n        return sortedKeys;\r\n    }\r\n\r\n    private validateProvidedValues(values: (V | null)[]): (V | null)[] {\r\n        if (this.usingComplexObjects && values?.length) {\r\n            const firstValue = values[0];\r\n            if (firstValue && typeof firstValue !== 'object' && typeof firstValue !== 'function') {\r\n                const firstKey = this.createKey(firstValue);\r\n                if (firstKey == null) {\r\n                    _warn(209);\r\n                } else {\r\n                    _warn(210);\r\n                }\r\n            }\r\n        }\r\n        return values;\r\n    }\r\n\r\n    public setValuesType(value: SetFilterModelValuesType) {\r\n        this.valuesType = value;\r\n    }\r\n\r\n    public getValuesType(): SetFilterModelValuesType {\r\n        return this.valuesType;\r\n    }\r\n\r\n    public isKeyAvailable(key: string | null): boolean {\r\n        return this.availableKeys.has(key);\r\n    }\r\n\r\n    private showAvailableOnly(): boolean {\r\n        return this.valuesType === SetFilterModelValuesType.TAKEN_FROM_GRID_VALUES;\r\n    }\r\n\r\n    private updateAvailableKeys(allKeys: (string | null)[], source: 'reload' | 'otherFilter'): void {\r\n        const availableKeys = this.showAvailableOnly() ? this.sortKeys(this.getValuesFromRows(true)) : allKeys;\r\n\r\n        this.availableKeys = new Set(availableKeys);\r\n        this.localEventService.dispatchEvent({ type: 'availableValuesChanged' });\r\n\r\n        this.updateDisplayedValues(source, allKeys);\r\n    }\r\n\r\n    public sortKeys(nullableValues: Map<string | null, V | null> | null): (string | null)[] {\r\n        const values = nullableValues ?? new Map();\r\n\r\n        if (this.suppressSorting) {\r\n            return Array.from(values.keys());\r\n        }\r\n\r\n        let sortedKeys;\r\n        if (this.compareByValue) {\r\n            sortedKeys = Array.from(values.entries())\r\n                .sort(this.entryComparator)\r\n                .map(([key]) => key);\r\n        } else {\r\n            sortedKeys = Array.from(values.keys()).sort(this.keyComparator);\r\n        }\r\n\r\n        if (this.filterParams.excelMode && values.has(null)) {\r\n            // ensure the blank value always appears last\r\n            sortedKeys = sortedKeys.filter((v) => v != null);\r\n            sortedKeys.push(null);\r\n        }\r\n\r\n        return sortedKeys;\r\n    }\r\n\r\n    private getParamsForValuesFromRows(removeUnavailableValues = false): {\r\n        predicate: (node: RowNode) => boolean;\r\n        existingValues?: Map<string | null, V | null>;\r\n    } | null {\r\n        if (!this.clientSideValuesExtractor) {\r\n            _error(113);\r\n            return null;\r\n        }\r\n\r\n        const predicate = (node: RowNode) => !removeUnavailableValues || this.doesRowPassOtherFilters(node);\r\n\r\n        const existingValues = removeUnavailableValues && !this.caseSensitive ? this.allValues : undefined;\r\n\r\n        return { predicate, existingValues };\r\n    }\r\n\r\n    private getValuesFromRows(removeUnavailableValues = false): Map<string | null, V | null> | null {\r\n        const params = this.getParamsForValuesFromRows(removeUnavailableValues);\r\n        if (!params) {\r\n            return null;\r\n        }\r\n\r\n        return this.clientSideValuesExtractor.extractUniqueValues(params.predicate, params.existingValues);\r\n    }\r\n\r\n    private getValuesFromRowsAsync(removeUnavailableValues = false): AgPromise<Map<string | null, V | null> | null> {\r\n        const params = this.getParamsForValuesFromRows(removeUnavailableValues);\r\n        if (!params) {\r\n            return AgPromise.resolve(null);\r\n        }\r\n\r\n        return this.clientSideValuesExtractor.extractUniqueValuesAsync(params.predicate, params.existingValues);\r\n    }\r\n\r\n    /** Sets mini filter value. Returns true if it changed from last value, otherwise false. */\r\n    public setMiniFilter(value?: string | null): boolean {\r\n        value = _makeNull(value);\r\n\r\n        if (this.miniFilterText === value) {\r\n            //do nothing if filter has not changed\r\n            return false;\r\n        }\r\n\r\n        if (value === null) {\r\n            // Reset 'Add current selection to filter' checkbox when clearing mini filter\r\n            this.setAddCurrentSelectionToFilter(false);\r\n        }\r\n\r\n        this.miniFilterText = value;\r\n        this.updateDisplayedValues('miniFilter');\r\n\r\n        return true;\r\n    }\r\n\r\n    public getMiniFilter(): string | null {\r\n        return this.miniFilterText;\r\n    }\r\n\r\n    public updateDisplayedValues(\r\n        source: 'reload' | 'otherFilter' | 'miniFilter' | 'expansion',\r\n        allKeys?: (string | null)[]\r\n    ): void {\r\n        if (source === 'expansion') {\r\n            this.displayValueModel.refresh();\r\n            return;\r\n        }\r\n\r\n        // if no filter, just display all available values\r\n        if (this.miniFilterText == null) {\r\n            this.displayValueModel.updateDisplayedValuesToAllAvailable(\r\n                (key: string | null) => this.getValue(key),\r\n                allKeys,\r\n                this.availableKeys,\r\n                source\r\n            );\r\n            return;\r\n        }\r\n\r\n        // if filter present, we filter down the list\r\n        // to allow for case insensitive searches, upper-case both filter text and value\r\n        const formattedFilterText = this.caseFormat(this.formatter(this.miniFilterText) || '');\r\n\r\n        const matchesFilter = (valueToCheck: string | null): boolean =>\r\n            valueToCheck != null && this.caseFormat(valueToCheck).indexOf(formattedFilterText) >= 0;\r\n\r\n        const nullMatchesFilter = !!this.filterParams.excelMode && matchesFilter(this.translate('blanks'));\r\n\r\n        this.displayValueModel.updateDisplayedValuesToMatchMiniFilter(\r\n            (key: string | null) => this.getValue(key),\r\n            allKeys,\r\n            this.availableKeys,\r\n            matchesFilter,\r\n            nullMatchesFilter,\r\n            source\r\n        );\r\n    }\r\n\r\n    public getDisplayedValueCount(): number {\r\n        return this.displayValueModel.getDisplayedValueCount();\r\n    }\r\n\r\n    public getDisplayedItem(index: number): string | SetFilterModelTreeItem | null {\r\n        return this.displayValueModel.getDisplayedItem(index);\r\n    }\r\n\r\n    public getSelectAllItem(): string | SetFilterModelTreeItem {\r\n        return this.displayValueModel.getSelectAllItem();\r\n    }\r\n\r\n    public getAddSelectionToFilterItem(): string | SetFilterModelTreeItem {\r\n        return this.displayValueModel.getAddSelectionToFilterItem();\r\n    }\r\n\r\n    public hasSelections(): boolean {\r\n        return this.filterParams.defaultToNothingSelected\r\n            ? this.selectedKeys.size > 0\r\n            : this.allValues.size !== this.selectedKeys.size;\r\n    }\r\n\r\n    public getKeys(): SetFilterModelValue {\r\n        return Array.from(this.allValues.keys());\r\n    }\r\n\r\n    public getValues(): (V | null)[] {\r\n        return Array.from(this.allValues.values());\r\n    }\r\n\r\n    public getValue(key: string | null): V | null {\r\n        return this.allValues.get(key)!;\r\n    }\r\n\r\n    public setAddCurrentSelectionToFilter(value: boolean) {\r\n        this.addCurrentSelectionToFilter = value;\r\n    }\r\n\r\n    private isInWindowsExcelMode(): boolean {\r\n        return this.filterParams.excelMode === 'windows';\r\n    }\r\n\r\n    public isAddCurrentSelectionToFilterChecked(): boolean {\r\n        return this.isInWindowsExcelMode() && this.addCurrentSelectionToFilter;\r\n    }\r\n\r\n    public showAddCurrentSelectionToFilter(): boolean {\r\n        // We only show the 'Add current selection to filter' option\r\n        // when excel mode is enabled with 'windows' mode\r\n        // and when the users types a value in the mini filter.\r\n        return this.isInWindowsExcelMode() && _exists(this.miniFilterText) && this.miniFilterText.length > 0;\r\n    }\r\n\r\n    public selectAllMatchingMiniFilter(clearExistingSelection = false): void {\r\n        if (this.miniFilterText == null) {\r\n            // ensure everything is selected\r\n            this.selectedKeys = new Set(this.allValues.keys());\r\n        } else {\r\n            // ensure everything that matches the mini filter is selected\r\n            if (clearExistingSelection) {\r\n                this.selectedKeys.clear();\r\n            }\r\n\r\n            this.displayValueModel.forEachDisplayedKey((key) => this.selectedKeys.add(key));\r\n        }\r\n    }\r\n\r\n    public deselectAllMatchingMiniFilter(): void {\r\n        if (this.miniFilterText == null) {\r\n            // ensure everything is deselected\r\n            this.selectedKeys.clear();\r\n        } else {\r\n            // ensure everything that matches the mini filter is deselected\r\n            this.displayValueModel.forEachDisplayedKey((key) => this.selectedKeys.delete(key));\r\n        }\r\n    }\r\n\r\n    public selectKey(key: string | null): void {\r\n        this.selectedKeys.add(key);\r\n    }\r\n\r\n    public deselectKey(key: string | null): void {\r\n        if (this.filterParams.excelMode && this.isEverythingVisibleSelected()) {\r\n            // ensure we're starting from the correct \"everything selected\" state\r\n            this.resetSelectionState(this.displayValueModel.getDisplayedKeys());\r\n        }\r\n\r\n        this.selectedKeys.delete(key);\r\n    }\r\n\r\n    public isKeySelected(key: string | null): boolean {\r\n        return this.selectedKeys.has(key);\r\n    }\r\n\r\n    public isEverythingVisibleSelected(): boolean {\r\n        return !this.displayValueModel.someDisplayedKey((it) => !this.isKeySelected(it));\r\n    }\r\n\r\n    public isNothingVisibleSelected(): boolean {\r\n        return !this.displayValueModel.someDisplayedKey((it) => this.isKeySelected(it));\r\n    }\r\n\r\n    public getModel(): SetFilterModelValue | null {\r\n        if (!this.hasSelections()) {\r\n            return null;\r\n        }\r\n\r\n        // When excelMode = 'windows' and the user has ticked 'Add current selection to filter'\r\n        // the filtering keys can be different from the selected keys, and they should be included\r\n        // in the model.\r\n        const filteringKeys = this.isAddCurrentSelectionToFilterChecked()\r\n            ? this.filteringKeys.allFilteringKeys()\r\n            : null;\r\n\r\n        if (filteringKeys && filteringKeys.size > 0) {\r\n            if (this.selectedKeys) {\r\n                // When existing filtering keys are present along with selected keys,\r\n                // we combine them and return the result.\r\n                // We use a set structure to avoid duplicates\r\n                const modelKeys = new Set<string | null>([\r\n                    ...Array.from(filteringKeys),\r\n                    ...Array.from(this.selectedKeys).filter((key) => !filteringKeys.has(key)),\r\n                ]);\r\n                return Array.from(modelKeys);\r\n            }\r\n\r\n            return Array.from(filteringKeys);\r\n        }\r\n\r\n        // No extra filtering keys are present - so just return the selected keys\r\n        return Array.from(this.selectedKeys);\r\n    }\r\n\r\n    public setModel(model: SetFilterModelValue | null): AgPromise<void> {\r\n        return this.allValuesPromise.then((keys) => {\r\n            if (model == null) {\r\n                this.resetSelectionState(keys ?? []);\r\n            } else {\r\n                // select all values from the model that exist in the filter\r\n                this.selectedKeys.clear();\r\n\r\n                const existingFormattedKeys: Map<string | null, string | null> = new Map();\r\n                this.allValues.forEach((_value, key) => {\r\n                    existingFormattedKeys.set(this.caseFormat(key), key);\r\n                });\r\n\r\n                model.forEach((unformattedKey) => {\r\n                    const formattedKey = this.caseFormat(_makeNull(unformattedKey));\r\n                    const existingUnformattedKey = existingFormattedKeys.get(formattedKey);\r\n                    if (existingUnformattedKey !== undefined) {\r\n                        this.selectKey(existingUnformattedKey);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    private uniqueValues(values: (V | null)[] | null): Map<string | null, V | null> {\r\n        const uniqueValues: Map<string | null, V | null> = new Map();\r\n        const formattedKeys: Set<string | null> = new Set();\r\n        (values ?? []).forEach((value) => {\r\n            const valueToUse = _makeNull(value);\r\n            const unformattedKey = this.createKey(valueToUse);\r\n            const formattedKey = this.caseFormat(unformattedKey);\r\n            if (!formattedKeys.has(formattedKey)) {\r\n                formattedKeys.add(formattedKey);\r\n                uniqueValues.set(unformattedKey, valueToUse);\r\n            }\r\n        });\r\n\r\n        return uniqueValues;\r\n    }\r\n\r\n    private resetSelectionState(keys: (string | null)[]): void {\r\n        if (this.filterParams.defaultToNothingSelected) {\r\n            this.selectedKeys.clear();\r\n        } else {\r\n            this.selectedKeys = new Set(keys);\r\n        }\r\n    }\r\n\r\n    public hasGroups(): boolean {\r\n        return this.displayValueModel.hasGroups();\r\n    }\r\n\r\n    private createTreeDataOrGroupingComparator(): (\r\n        a: [string | null, string[] | null],\r\n        b: [string | null, string[] | null]\r\n    ) => number {\r\n        return (\r\n            [_aKey, aValue]: [string | null, string[] | null],\r\n            [_bKey, bValue]: [string | null, string[] | null]\r\n        ) => {\r\n            if (aValue == null) {\r\n                return bValue == null ? 0 : -1;\r\n            } else if (bValue == null) {\r\n                return 1;\r\n            }\r\n            for (let i = 0; i < aValue.length; i++) {\r\n                if (i >= bValue.length) {\r\n                    return 1;\r\n                }\r\n                const diff = _defaultComparator(aValue[i], bValue[i]);\r\n                if (diff !== 0) {\r\n                    return diff;\r\n                }\r\n            }\r\n            return 0;\r\n        };\r\n    }\r\n\r\n    public setAppliedModelKeys(appliedModelKeys: Set<string | null> | null): void {\r\n        this.filteringKeys.setFilteringKeys(appliedModelKeys);\r\n    }\r\n\r\n    public addToAppliedModelKeys(appliedModelKey: string | null): void {\r\n        this.filteringKeys.addFilteringKey(appliedModelKey);\r\n    }\r\n\r\n    public getAppliedModelKeys(): Set<string | null> | null {\r\n        return this.filteringKeys.allFilteringKeys();\r\n    }\r\n\r\n    public getCaseFormattedAppliedModelKeys(): Set<string | null> | null {\r\n        return this.filteringKeys.allFilteringKeysCaseFormatted();\r\n    }\r\n\r\n    public hasAppliedModelKey(appliedModelKey: string | null): boolean {\r\n        return this.filteringKeys.hasCaseFormattedFilteringKey(appliedModelKey);\r\n    }\r\n\r\n    public hasAnyAppliedModelKey(): boolean {\r\n        return !this.filteringKeys.hasNoAppliedFilteringKeys;\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AgEventType,\r\n    IClientSideRowModel,\r\n    IColsService,\r\n    RowNode,\r\n    SetFilterParams,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport { AgPromise, _makeNull } from 'ag-grid-community';\r\n\r\nimport { processDataPath } from './setFilterUtils';\r\n\r\n/** @param V type of value in the Set Filter */\r\nexport class ClientSideValuesExtractor<V> {\r\n    constructor(\r\n        private readonly rowModel: IClientSideRowModel,\r\n        private readonly filterParams: SetFilterParams<any, V>,\r\n        private readonly createKey: (value: V | null | undefined, node?: RowNode) => string | null,\r\n        private readonly caseFormat: <T extends string | null>(valueToFormat: T) => typeof valueToFormat,\r\n        private readonly valueSvc: ValueService,\r\n        private readonly treeDataOrGrouping: boolean,\r\n        private readonly treeData: boolean,\r\n        private readonly groupAllowUnbalanced: boolean,\r\n        private readonly addManagedEventListeners: (\r\n            handlers: Partial<Record<AgEventType, (event?: any) => void>>\r\n        ) => (() => null)[],\r\n        private readonly rowGroupColsSvc?: IColsService\r\n    ) {}\r\n\r\n    public extractUniqueValuesAsync(\r\n        predicate: (node: RowNode) => boolean,\r\n        existingValues?: Map<string | null, V | null>\r\n    ): AgPromise<Map<string | null, V | null>> {\r\n        return new AgPromise((resolve) => {\r\n            if (this.rowModel.isRowDataLoaded()) {\r\n                resolve(this.extractUniqueValues(predicate, existingValues));\r\n            } else {\r\n                const [destroyFunc] = this.addManagedEventListeners({\r\n                    rowCountReady: () => {\r\n                        destroyFunc?.();\r\n                        resolve(this.extractUniqueValues(predicate, existingValues));\r\n                    },\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    public extractUniqueValues(\r\n        predicate: (node: RowNode) => boolean,\r\n        existingValues?: Map<string | null, V | null>\r\n    ): Map<string | null, V | null> {\r\n        const values: Map<string | null, V | null> = new Map();\r\n        const existingFormattedKeys = this.extractExistingFormattedKeys(existingValues);\r\n        const formattedKeys: Set<string | null> = new Set();\r\n        const treeData = this.treeData;\r\n        const groupedCols = this.rowGroupColsSvc?.columns;\r\n\r\n        const addValue = (unformattedKey: string | null, value: V | null | undefined) => {\r\n            const formattedKey = this.caseFormat(unformattedKey);\r\n            if (!formattedKeys.has(formattedKey)) {\r\n                formattedKeys.add(formattedKey);\r\n                let keyToAdd = unformattedKey;\r\n                let valueToAdd = _makeNull(value);\r\n                // when case insensitive, we pick the first value to use. if this is later filtered out,\r\n                // we still want to use the original value and not one with a different case\r\n                const existingUnformattedKey = existingFormattedKeys?.get(formattedKey);\r\n                if (existingUnformattedKey != null) {\r\n                    keyToAdd = existingUnformattedKey;\r\n                    valueToAdd = existingValues!.get(existingUnformattedKey)!;\r\n                }\r\n                values.set(keyToAdd, valueToAdd);\r\n            }\r\n        };\r\n\r\n        this.rowModel.forEachLeafNode((node) => {\r\n            // only pull values from rows that have data. this means we skip filler group nodes.\r\n            if (!node.data || !predicate(node)) {\r\n                return;\r\n            }\r\n            if (this.treeDataOrGrouping) {\r\n                this.addValueForTreeDataOrGrouping(node, treeData, groupedCols, addValue);\r\n                return;\r\n            }\r\n\r\n            const value = this.getValue(node);\r\n\r\n            if (value != null && Array.isArray(value)) {\r\n                value.forEach((x) => {\r\n                    addValue(this.createKey(x, node), x);\r\n                });\r\n                if (value.length === 0) {\r\n                    addValue(null, null);\r\n                }\r\n            } else {\r\n                addValue(this.createKey(value, node), value);\r\n            }\r\n        });\r\n\r\n        return values;\r\n    }\r\n\r\n    private addValueForTreeDataOrGrouping(\r\n        node: RowNode,\r\n        treeData: boolean,\r\n        groupedCols: AgColumn[] = [],\r\n        addValue: (unformattedKey: string | null, value: V | null) => void\r\n    ): void {\r\n        let dataPath: string[] | null;\r\n        if (treeData) {\r\n            if (node.childrenAfterGroup?.length) {\r\n                return;\r\n            }\r\n            dataPath = node.getRoute() ?? [node.key ?? node.id!];\r\n        } else {\r\n            dataPath = groupedCols.map((groupCol) => this.valueSvc.getKeyForNode(groupCol, node));\r\n            dataPath.push(this.getValue(node) as any);\r\n        }\r\n        const processedDataPath = processDataPath(dataPath, treeData, this.groupAllowUnbalanced);\r\n        addValue(this.createKey(processedDataPath as any), processedDataPath as any);\r\n    }\r\n\r\n    private getValue(node: RowNode): V | null | undefined {\r\n        return this.filterParams.getValue(node);\r\n    }\r\n\r\n    private extractExistingFormattedKeys(\r\n        existingValues?: Map<string | null, V | null>\r\n    ): Map<string | null, string | null> | null {\r\n        if (!existingValues) {\r\n            return null;\r\n        }\r\n        const existingFormattedKeys: Map<string | null, string | null> = new Map();\r\n        existingValues.forEach((_value, key) => {\r\n            existingFormattedKeys.set(this.caseFormat(key), key);\r\n        });\r\n        return existingFormattedKeys;\r\n    }\r\n}\r\n", "export class SetValueModelFilteringKeys {\r\n    // To make the filtering fast, we store the keys in a Set rather than using the default array.\r\n    private filteringKeys: Set<string | null> | null = null;\r\n\r\n    // This attribute contains keys that are actually used for filtering.\r\n    // These keys take into account case sensitivity:\r\n    // - When filtering is case-insensitive, all filtering keys are converted to upper case and stored here.\r\n    // - When filtering is case-sensitive, this is the same as filteringKeys.\r\n    private filteringKeysCaseFormatted: Set<string | null> | null = null;\r\n\r\n    public hasNoAppliedFilteringKeys: boolean = false;\r\n\r\n    // Function responsible for formatting the filtering keys.\r\n    private readonly caseFormat: <T extends string | null>(valueToFormat: T) => typeof valueToFormat;\r\n\r\n    constructor({ caseFormat }: { caseFormat: <T extends string | null>(valueToFormat: T) => typeof valueToFormat }) {\r\n        this.caseFormat = caseFormat;\r\n    }\r\n\r\n    public allFilteringKeys(): Set<string | null> | null {\r\n        return this.filteringKeys;\r\n    }\r\n\r\n    public allFilteringKeysCaseFormatted(): Set<string | null> | null {\r\n        return this.filteringKeysCaseFormatted;\r\n    }\r\n\r\n    public setFilteringKeys(filteringKeys: Set<string | null> | null): void {\r\n        this.filteringKeys = new Set(filteringKeys);\r\n        this.hasNoAppliedFilteringKeys = !this.filteringKeys || this.filteringKeys.size === 0;\r\n\r\n        this.filteringKeysCaseFormatted = new Set<string | null>();\r\n        this.filteringKeys.forEach((key) => this.filteringKeysCaseFormatted!.add(this.caseFormat(key)));\r\n    }\r\n\r\n    public addFilteringKey(key: string | null): void {\r\n        if (this.filteringKeys == null) {\r\n            this.filteringKeys = new Set<string | null>();\r\n            this.filteringKeysCaseFormatted = new Set<string | null>();\r\n        }\r\n\r\n        this.filteringKeys.add(key);\r\n        this.filteringKeysCaseFormatted!.add(this.caseFormat(key));\r\n\r\n        if (this.hasNoAppliedFilteringKeys) {\r\n            this.hasNoAppliedFilteringKeys = false;\r\n        }\r\n    }\r\n\r\n    public hasCaseFormattedFilteringKey(key: string | null): boolean {\r\n        return this.filteringKeysCaseFormatted!.has(this.caseFormat(key));\r\n    }\r\n\r\n    public hasFilteringKey(key: string | null): boolean {\r\n        return this.filteringKeys!.has(key);\r\n    }\r\n\r\n    public reset() {\r\n        this.filteringKeys = null;\r\n        this.filteringKeysCaseFormatted = null;\r\n        this.hasNoAppliedFilteringKeys = false;\r\n    }\r\n}\r\n", "import type { AgColumn, TextFormatter, ValueFormatterParams, ValueService } from 'ag-grid-community';\r\n\r\nimport type { ISetDisplayValueModel } from './iSetDisplayValueModel';\r\nimport { SET_FILTER_ADD_SELECTION_TO_FILTER, SET_FILTER_SELECT_ALL } from './iSetDisplayValueModel';\r\n\r\nexport class FlatSetDisplayValueModel<V> implements ISetDisplayValueModel<V> {\r\n    /** All keys that are currently displayed, after the mini-filter has been applied. */\r\n    private displayedKeys: (string | null)[] = [];\r\n\r\n    constructor(\r\n        private readonly valueSvc: ValueService,\r\n        private readonly valueFormatter: ((params: ValueFormatterParams) => string) | undefined,\r\n        private readonly formatter: TextFormatter,\r\n        private readonly column: AgColumn\r\n    ) {}\r\n\r\n    public updateDisplayedValuesToAllAvailable(\r\n        _getValue: (key: string | null) => V | null,\r\n        _allKeys: Iterable<string | null> | undefined,\r\n        availableKeys: Set<string | null>\r\n    ): void {\r\n        this.displayedKeys = Array.from(availableKeys);\r\n    }\r\n\r\n    public updateDisplayedValuesToMatchMiniFilter(\r\n        getValue: (key: string | null) => V | null,\r\n        _allKeys: Iterable<string | null> | undefined,\r\n        availableKeys: Set<string | null>,\r\n        matchesFilter: (valueToCheck: string | null) => boolean,\r\n        nullMatchesFilter: boolean\r\n    ): void {\r\n        this.displayedKeys = [];\r\n\r\n        for (const key of availableKeys) {\r\n            if (key == null) {\r\n                if (nullMatchesFilter) {\r\n                    this.displayedKeys.push(key);\r\n                }\r\n            } else {\r\n                const value = getValue(key);\r\n                const valueFormatterValue = this.valueSvc.formatValue(\r\n                    this.column,\r\n                    null,\r\n                    value,\r\n                    this.valueFormatter,\r\n                    false\r\n                );\r\n\r\n                const textFormatterValue = this.formatter(valueFormatterValue);\r\n\r\n                if (matchesFilter(textFormatterValue)) {\r\n                    this.displayedKeys.push(key);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public getDisplayedValueCount(): number {\r\n        return this.displayedKeys.length;\r\n    }\r\n\r\n    public getDisplayedItem(index: number): string | null {\r\n        return this.displayedKeys[index];\r\n    }\r\n\r\n    getSelectAllItem(): string {\r\n        return SET_FILTER_SELECT_ALL;\r\n    }\r\n\r\n    getAddSelectionToFilterItem(): string {\r\n        return SET_FILTER_ADD_SELECTION_TO_FILTER;\r\n    }\r\n\r\n    public getDisplayedKeys(): (string | null)[] {\r\n        return this.displayedKeys;\r\n    }\r\n\r\n    public forEachDisplayedKey(func: (key: string | null) => void): void {\r\n        this.displayedKeys.forEach(func);\r\n    }\r\n\r\n    public someDisplayedKey(func: (key: string | null) => boolean): boolean {\r\n        return this.displayedKeys.some(func);\r\n    }\r\n\r\n    public hasGroups(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public refresh(): void {\r\n        // not used\r\n    }\r\n}\r\n", "import type { TextFormatter } from 'ag-grid-community';\r\nimport { _warn } from 'ag-grid-community';\r\n\r\nimport type { ISetDisplayValueModel, SetFilterModelTreeItem } from './iSetDisplayValueModel';\r\nimport { SET_FILTER_ADD_SELECTION_TO_FILTER, SET_FILTER_SELECT_ALL } from './iSetDisplayValueModel';\r\n\r\nconst DATE_TREE_LIST_PATH_GETTER = (date: Date | null) =>\r\n    date ? [String(date.getFullYear()), String(date.getMonth() + 1), String(date.getDate())] : null;\r\nexport class TreeSetDisplayValueModel<V> implements ISetDisplayValueModel<V> {\r\n    /** all displayed items in a tree structure */\r\n    private allDisplayedItemsTree: SetFilterModelTreeItem[] = [];\r\n    /** all displayed items flattened and filtered */\r\n    private activeDisplayedItemsFlat: SetFilterModelTreeItem[] = [];\r\n\r\n    private groupsExist: boolean;\r\n\r\n    private readonly selectAllItem: SetFilterModelTreeItem = {\r\n        depth: 0,\r\n        filterPasses: true,\r\n        available: true,\r\n        treeKey: SET_FILTER_SELECT_ALL,\r\n        children: this.allDisplayedItemsTree,\r\n        expanded: true,\r\n        key: SET_FILTER_SELECT_ALL,\r\n        parentTreeKeys: [],\r\n    };\r\n\r\n    private readonly addSelectionToFilterItem: SetFilterModelTreeItem = {\r\n        depth: 0,\r\n        filterPasses: true,\r\n        available: true,\r\n        treeKey: SET_FILTER_ADD_SELECTION_TO_FILTER,\r\n        expanded: true,\r\n        key: SET_FILTER_ADD_SELECTION_TO_FILTER,\r\n        parentTreeKeys: [],\r\n    };\r\n\r\n    constructor(\r\n        private readonly formatter: TextFormatter,\r\n        private readonly treeListPathGetter?: (value: V | null) => string[] | null,\r\n        private treeListFormatter?: (\r\n            pathKey: string | null,\r\n            level: number,\r\n            parentPathKeys: (string | null)[]\r\n        ) => string,\r\n        private readonly treeDataOrGrouping?: boolean\r\n    ) {}\r\n\r\n    public updateOnParamsChange(\r\n        treeListFormatter?: (pathKey: string | null, level: number, parentPathKeys: (string | null)[]) => string\r\n    ) {\r\n        this.treeListFormatter = treeListFormatter;\r\n    }\r\n\r\n    public updateDisplayedValuesToAllAvailable(\r\n        getValue: (key: string | null) => V | null,\r\n        allKeys: Iterable<string | null> | undefined,\r\n        availableKeys: Set<string | null>,\r\n        source: 'reload' | 'otherFilter' | 'miniFilter'\r\n    ): void {\r\n        if (source === 'reload') {\r\n            this.generateItemTree(getValue, allKeys!, availableKeys);\r\n        } else if (source === 'otherFilter') {\r\n            this.updateAvailable(availableKeys);\r\n            this.updateExpandAll();\r\n        } else if (source === 'miniFilter') {\r\n            this.resetFilter();\r\n            this.updateExpandAll();\r\n        }\r\n\r\n        this.flattenItems();\r\n    }\r\n\r\n    public updateDisplayedValuesToMatchMiniFilter(\r\n        getValue: (key: string | null) => V | null,\r\n        allKeys: Iterable<string | null> | undefined,\r\n        availableKeys: Set<string | null>,\r\n        matchesFilter: (valueToCheck: string | null) => boolean,\r\n        nullMatchesFilter: boolean,\r\n        source: 'reload' | 'otherFilter' | 'miniFilter'\r\n    ): void {\r\n        if (source === 'reload') {\r\n            this.generateItemTree(getValue, allKeys!, availableKeys);\r\n        } else if (source === 'otherFilter') {\r\n            this.updateAvailable(availableKeys);\r\n        }\r\n\r\n        this.updateFilter(matchesFilter, nullMatchesFilter);\r\n        this.updateExpandAll();\r\n\r\n        this.flattenItems();\r\n    }\r\n\r\n    private generateItemTree(\r\n        getValue: (key: string | null) => V | null,\r\n        allKeys: Iterable<string | null>,\r\n        availableKeys: Set<string | null>\r\n    ): void {\r\n        this.allDisplayedItemsTree = [];\r\n        this.groupsExist = false;\r\n\r\n        const treeListPathGetter = this.getTreeListPathGetter(getValue, availableKeys);\r\n        for (const key of allKeys) {\r\n            const value = getValue(key)!;\r\n            const dataPath = treeListPathGetter(value) ?? [null];\r\n            if (dataPath.length > 1) {\r\n                this.groupsExist = true;\r\n            }\r\n            const available = availableKeys.has(key);\r\n            let children: SetFilterModelTreeItem[] | undefined = this.allDisplayedItemsTree;\r\n            let item: SetFilterModelTreeItem | undefined;\r\n            let parentTreeKeys: (string | null)[] = [];\r\n            dataPath.forEach((treeKey: string | null, depth: number) => {\r\n                if (!children) {\r\n                    children = [];\r\n                    item!.children = children;\r\n                }\r\n                item = children.find((child) => child.treeKey?.toUpperCase() === treeKey?.toUpperCase());\r\n                if (!item) {\r\n                    item = { treeKey, depth, filterPasses: true, expanded: false, available, parentTreeKeys };\r\n                    if (depth === dataPath.length - 1) {\r\n                        item.key = key;\r\n                    }\r\n                    children.push(item);\r\n                }\r\n                children = item.children;\r\n                parentTreeKeys = [...parentTreeKeys, treeKey];\r\n            });\r\n        }\r\n        // update the parent availability based on the children\r\n        this.updateAvailable(availableKeys);\r\n\r\n        this.selectAllItem.children = this.allDisplayedItemsTree;\r\n        this.selectAllItem.expanded = false;\r\n    }\r\n\r\n    private getTreeListPathGetter(\r\n        getValue: (key: string | null) => V | null,\r\n        availableKeys: Set<string | null>\r\n    ): (value: V | null) => string[] | null {\r\n        if (this.treeListPathGetter) {\r\n            return this.treeListPathGetter;\r\n        }\r\n        if (this.treeDataOrGrouping) {\r\n            return (value) => value as any;\r\n        }\r\n        // infer from data\r\n        let isDate = false;\r\n        for (const availableKey of availableKeys) {\r\n            // find the first non-null value\r\n            const value = getValue(availableKey);\r\n            if (value instanceof Date) {\r\n                isDate = true;\r\n                break;\r\n            } else if (value != null) {\r\n                break;\r\n            }\r\n        }\r\n        if (isDate) {\r\n            return DATE_TREE_LIST_PATH_GETTER as any;\r\n        }\r\n        _warn(211);\r\n        return (value) => [String(value)];\r\n    }\r\n\r\n    private flattenItems(): void {\r\n        this.activeDisplayedItemsFlat = [];\r\n        const recursivelyFlattenDisplayedItems = (items: SetFilterModelTreeItem[]) => {\r\n            items.forEach((item) => {\r\n                if (!item.filterPasses || !item.available) {\r\n                    return;\r\n                }\r\n                this.activeDisplayedItemsFlat.push(item);\r\n                if (item.children && item.expanded) {\r\n                    recursivelyFlattenDisplayedItems(item.children);\r\n                }\r\n            });\r\n        };\r\n        recursivelyFlattenDisplayedItems(this.allDisplayedItemsTree);\r\n    }\r\n\r\n    private resetFilter(): void {\r\n        const recursiveFilterReset = (item: SetFilterModelTreeItem) => {\r\n            if (item.children) {\r\n                item.children.forEach((child) => {\r\n                    recursiveFilterReset(child);\r\n                });\r\n            }\r\n\r\n            item.filterPasses = true;\r\n        };\r\n\r\n        this.allDisplayedItemsTree.forEach((item) => recursiveFilterReset(item));\r\n    }\r\n\r\n    private updateFilter(matchesFilter: (valueToCheck: string | null) => boolean, nullMatchesFilter: boolean): void {\r\n        const passesFilter = (item: SetFilterModelTreeItem) => {\r\n            if (!item.available) {\r\n                return false;\r\n            }\r\n            if (item.treeKey == null) {\r\n                return nullMatchesFilter;\r\n            }\r\n\r\n            return matchesFilter(\r\n                this.formatter(\r\n                    this.treeListFormatter\r\n                        ? this.treeListFormatter(item.treeKey, item.depth, item.parentTreeKeys)\r\n                        : item.treeKey\r\n                )\r\n            );\r\n        };\r\n\r\n        this.allDisplayedItemsTree.forEach((item) =>\r\n            this.recursiveItemCheck(item, false, passesFilter, 'filterPasses')\r\n        );\r\n    }\r\n\r\n    public getDisplayedValueCount(): number {\r\n        return this.activeDisplayedItemsFlat.length;\r\n    }\r\n\r\n    public getDisplayedItem(index: number): SetFilterModelTreeItem | null {\r\n        return this.activeDisplayedItemsFlat[index];\r\n    }\r\n\r\n    public getSelectAllItem(): SetFilterModelTreeItem {\r\n        return this.selectAllItem;\r\n    }\r\n\r\n    public getAddSelectionToFilterItem(): string | SetFilterModelTreeItem {\r\n        return this.addSelectionToFilterItem;\r\n    }\r\n\r\n    public getDisplayedKeys(): (string | null)[] {\r\n        const displayedKeys: (string | null)[] = [];\r\n        this.forEachDisplayedKey((key) => displayedKeys.push(key));\r\n        return displayedKeys;\r\n    }\r\n\r\n    public forEachDisplayedKey(func: (key: string | null) => void): void {\r\n        const recursiveForEachItem = (item: SetFilterModelTreeItem, topParentExpanded: boolean) => {\r\n            if (item.children) {\r\n                if (!item.expanded || !topParentExpanded) {\r\n                    // if the parent is not expanded, we need to iterate the entire tree\r\n                    item.children.forEach((child) => {\r\n                        if (child.filterPasses) {\r\n                            recursiveForEachItem(child, false);\r\n                        }\r\n                    });\r\n                }\r\n            } else {\r\n                func(item.key!);\r\n            }\r\n        };\r\n\r\n        this.activeDisplayedItemsFlat.forEach((item) => recursiveForEachItem(item, true));\r\n    }\r\n\r\n    public someDisplayedKey(func: (key: string | null) => boolean): boolean {\r\n        const recursiveSomeItem = (item: SetFilterModelTreeItem, topParentExpanded: boolean): boolean => {\r\n            if (item.children) {\r\n                if (!item.expanded || !topParentExpanded) {\r\n                    // if the parent is not expanded, we need to iterate the entire tree\r\n                    return item.children.some((child) => {\r\n                        if (child.filterPasses) {\r\n                            return recursiveSomeItem(child, false);\r\n                        }\r\n                        return false;\r\n                    });\r\n                }\r\n            } else {\r\n                return func(item.key!);\r\n            }\r\n            return false;\r\n        };\r\n\r\n        return this.activeDisplayedItemsFlat.some((item) => recursiveSomeItem(item, true));\r\n    }\r\n\r\n    public hasGroups(): boolean {\r\n        return this.groupsExist;\r\n    }\r\n\r\n    public refresh(): void {\r\n        this.updateExpandAll();\r\n        this.flattenItems();\r\n    }\r\n\r\n    private updateExpandAll(): void {\r\n        const recursiveExpansionCheck = (\r\n            items: SetFilterModelTreeItem[],\r\n            someTrue: boolean,\r\n            someFalse: boolean\r\n        ): boolean | undefined => {\r\n            for (const item of items) {\r\n                if (!item.filterPasses || !item.available || !item.children) {\r\n                    continue;\r\n                }\r\n                // indeterminate state only exists for expand all, so don't need to check for the current item\r\n                someTrue = someTrue || !!item.expanded;\r\n                someFalse = someFalse || !item.expanded;\r\n                if (someTrue && someFalse) {\r\n                    // already indeterminate. No need to check the children\r\n                    return undefined;\r\n                }\r\n                const childExpanded = recursiveExpansionCheck(item.children, someTrue, someFalse);\r\n                if (childExpanded === undefined) {\r\n                    return undefined;\r\n                } else if (childExpanded) {\r\n                    someTrue = true;\r\n                } else {\r\n                    someFalse = true;\r\n                }\r\n            }\r\n            return someTrue && someFalse ? undefined : someTrue;\r\n        };\r\n\r\n        const item = this.getSelectAllItem();\r\n        item.expanded = recursiveExpansionCheck(item.children!, false, false);\r\n    }\r\n\r\n    private recursiveItemCheck(\r\n        item: SetFilterModelTreeItem,\r\n        parentPasses: boolean,\r\n        checkFunction: (item: SetFilterModelTreeItem) => boolean,\r\n        itemProp: 'filterPasses' | 'available'\r\n    ): boolean {\r\n        let atLeastOneChildPassed = false;\r\n        if (item.children) {\r\n            item.children.forEach((child) => {\r\n                const childPasses = this.recursiveItemCheck(\r\n                    child,\r\n                    parentPasses || checkFunction(item),\r\n                    checkFunction,\r\n                    itemProp\r\n                );\r\n                atLeastOneChildPassed = atLeastOneChildPassed || childPasses;\r\n            });\r\n        }\r\n\r\n        const itemPasses = parentPasses || atLeastOneChildPassed || checkFunction(item);\r\n        item[itemProp] = itemPasses;\r\n        return itemPasses;\r\n    }\r\n\r\n    private updateAvailable(availableKeys: Set<string | null>) {\r\n        const isAvailable = (item: SetFilterModelTreeItem) => availableKeys.has(item.key!);\r\n\r\n        this.allDisplayedItemsTree.forEach((item) => this.recursiveItemCheck(item, false, isAvailable, 'available'));\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AgInputTextField,\r\n    BeanCollection,\r\n    ColumnNameService,\r\n    IFloatingFilter,\r\n    IFloatingFilterParams,\r\n    SetFilterModel,\r\n} from 'ag-grid-community';\r\nimport { AgInputTextFieldSelector, Component, RefPlaceholder, _error } from 'ag-grid-community';\r\n\r\nimport { SetFilter } from './setFilter';\r\nimport { SetFilterModelFormatter } from './setFilterModelFormatter';\r\n\r\nexport class SetFloatingFilterComp<V = string> extends Component implements IFloatingFilter {\r\n    private colNames: ColumnNameService;\r\n    private readonly eFloatingFilterText: AgInputTextField = RefPlaceholder;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colNames = beans.colNames;\r\n    }\r\n\r\n    private params: IFloatingFilterParams;\r\n    private availableValuesListenerAdded = false;\r\n    private readonly filterModelFormatter = new SetFilterModelFormatter();\r\n\r\n    constructor() {\r\n        super(\r\n            /* html */ `\r\n            <div class=\"ag-floating-filter-input ag-set-floating-filter-input\" role=\"presentation\">\r\n                <ag-input-text-field data-ref=\"eFloatingFilterText\"></ag-input-text-field>\r\n            </div>`,\r\n            [AgInputTextFieldSelector]\r\n        );\r\n    }\r\n\r\n    public init(params: IFloatingFilterParams): void {\r\n        this.params = params;\r\n\r\n        this.eFloatingFilterText.setDisabled(true).addGuiEventListener('click', () => this.params.showParentFilter());\r\n\r\n        this.setParams(params);\r\n    }\r\n\r\n    private setParams(params: IFloatingFilterParams): void {\r\n        const displayName = this.colNames.getDisplayNameForColumn(params.column as AgColumn, 'header', true);\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        this.eFloatingFilterText.setInputAriaLabel(`${displayName} ${translate('ariaFilterInput', 'Filter Input')}`);\r\n    }\r\n\r\n    public refresh(params: IFloatingFilterParams): void {\r\n        this.params = params;\r\n        this.setParams(params);\r\n    }\r\n\r\n    public onParentModelChanged(parentModel: SetFilterModel): void {\r\n        this.updateFloatingFilterText(parentModel);\r\n    }\r\n\r\n    private parentSetFilterInstance(cb: (instance: SetFilter<V>) => void): void {\r\n        this.params.parentFilterInstance((filter) => {\r\n            if (!(filter instanceof SetFilter)) {\r\n                _error(248);\r\n                return;\r\n            }\r\n\r\n            cb(filter);\r\n        });\r\n    }\r\n\r\n    private addAvailableValuesListener(): void {\r\n        this.parentSetFilterInstance((setFilter) => {\r\n            const setValueModel = setFilter.getValueModel();\r\n\r\n            if (!setValueModel) {\r\n                return;\r\n            }\r\n\r\n            // unlike other filters, what we show in the floating filter can be different, even\r\n            // if another filter changes. this is due to how set filter restricts its values based\r\n            // on selections in other filters, e.g. if you filter Language to English, then the set filter\r\n            // on Country will only show English speaking countries. Thus the list of items to show\r\n            // in the floating filter can change.\r\n            this.addManagedListeners(setValueModel, { availableValuesChanged: () => this.updateFloatingFilterText() });\r\n        });\r\n\r\n        this.availableValuesListenerAdded = true;\r\n    }\r\n\r\n    private updateFloatingFilterText(parentModel?: SetFilterModel | null): void {\r\n        if (!this.availableValuesListenerAdded) {\r\n            this.addAvailableValuesListener();\r\n        }\r\n\r\n        this.parentSetFilterInstance((setFilter) => {\r\n            this.eFloatingFilterText.setValue(this.filterModelFormatter.getModelAsString(parentModel, setFilter));\r\n        });\r\n    }\r\n}\r\n", "import type { _ModuleWithApi, _StatusBarGridApi } from 'ag-grid-community';\r\nimport { _KeyboardNavigationModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { AgStatusBarSelector } from './agStatusBar';\r\nimport { AggregationComp } from './providedPanels/aggregationComp';\r\nimport { FilteredRowsComp } from './providedPanels/filteredRowsComp';\r\nimport { SelectedRowsComp } from './providedPanels/selectedRowsComp';\r\nimport { TotalAndFilteredRowsComp } from './providedPanels/totalAndFilteredRowsComp';\r\nimport { TotalRowsComp } from './providedPanels/totalRowsComp';\r\nimport { getStatusPanel } from './statusBarApi';\r\nimport { StatusBarService } from './statusBarService';\r\n\r\n/**\r\n * @feature Accessories -> Status Bar\r\n * @gridOption statusBar\r\n */\r\nexport const StatusBarModule: _ModuleWithApi<_StatusBarGridApi> = {\r\n    moduleName: 'StatusBar',\r\n    version: VERSION,\r\n    beans: [StatusBarService],\r\n    userComponents: {\r\n        agAggregationComponent: AggregationComp,\r\n        agTotalRowCountComponent: TotalRowsComp,\r\n        agFilteredRowCountComponent: FilteredRowsComp,\r\n        agTotalAndFilteredRowCountComponent: TotalAndFilteredRowsComp,\r\n        agSelectedRowCountComponent: SelectedRowsComp,\r\n    },\r\n    selectors: [AgStatusBarSelector],\r\n    apiFunctions: {\r\n        getStatusPanel,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _KeyboardNavigationModule],\r\n};\r\n", "import type {\r\n    BeanCollection,\r\n    ComponentSelector,\r\n    ComponentType,\r\n    IStatusPanelComp,\r\n    IStatusPanelParams,\r\n    StatusPanelDef,\r\n    UserCompDetails,\r\n    UserComponentFactory,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport { AgPromise, Component, RefPlaceholder, _removeFromParent } from 'ag-grid-community';\r\n\r\nimport { agStatusBarCSS } from './agStatusBar.css-GENERATED';\r\nimport type { StatusBarService } from './statusBarService';\r\n\r\nfunction getStatusPanelCompDetails(\r\n    userCompFactory: UserComponentFactory,\r\n    def: StatusPanelDef,\r\n    params: WithoutGridCommon<IStatusPanelParams>\r\n): UserCompDetails<IStatusPanelComp> | undefined {\r\n    return userCompFactory.getCompDetails(def, StatusPanelComponent, undefined, params, true);\r\n}\r\n\r\nconst StatusPanelComponent: ComponentType = {\r\n    name: 'statusPanel',\r\n    optionalMethods: ['refresh'],\r\n};\r\n\r\nexport class AgStatusBar extends Component {\r\n    private userCompFactory: UserComponentFactory;\r\n    private statusBarSvc: StatusBarService;\r\n    private updateQueued: boolean = false;\r\n    private panelsPromise: AgPromise<(void | null)[]> = AgPromise.resolve();\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.userCompFactory = beans.userCompFactory;\r\n        this.statusBarSvc = beans.statusBarSvc as StatusBarService;\r\n    }\r\n\r\n    private readonly eStatusBarLeft: HTMLElement = RefPlaceholder;\r\n    private readonly eStatusBarCenter: HTMLElement = RefPlaceholder;\r\n    private readonly eStatusBarRight: HTMLElement = RefPlaceholder;\r\n\r\n    private compDestroyFunctions: { [key: string]: () => void } = {};\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-status-bar\">\r\n            <div data-ref=\"eStatusBarLeft\" class=\"ag-status-bar-left\" role=\"status\"></div>\r\n            <div data-ref=\"eStatusBarCenter\" class=\"ag-status-bar-center\" role=\"status\"></div>\r\n            <div data-ref=\"eStatusBarRight\" class=\"ag-status-bar-right\" role=\"status\"></div>\r\n        </div>`);\r\n        this.registerCSS(agStatusBarCSS);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.processStatusPanels(new Map());\r\n        this.addManagedPropertyListeners(['statusBar'], this.handleStatusBarChanged.bind(this));\r\n    }\r\n\r\n    private processStatusPanels(existingStatusPanelsToReuse: Map<string, IStatusPanelComp>): void {\r\n        const statusPanels = this.gos.get('statusBar')?.statusPanels;\r\n        if (statusPanels) {\r\n            const leftStatusPanelComponents = statusPanels.filter(\r\n                (componentConfig) => componentConfig.align === 'left'\r\n            );\r\n            const centerStatusPanelComponents = statusPanels.filter(\r\n                (componentConfig) => componentConfig.align === 'center'\r\n            );\r\n            const rightStatusPanelComponents = statusPanels.filter(\r\n                (componentConfig) => !componentConfig.align || componentConfig.align === 'right'\r\n            );\r\n            this.panelsPromise = AgPromise.all([\r\n                this.createAndRenderComponents(\r\n                    leftStatusPanelComponents,\r\n                    this.eStatusBarLeft,\r\n                    existingStatusPanelsToReuse\r\n                ),\r\n                this.createAndRenderComponents(\r\n                    centerStatusPanelComponents,\r\n                    this.eStatusBarCenter,\r\n                    existingStatusPanelsToReuse\r\n                ),\r\n                this.createAndRenderComponents(\r\n                    rightStatusPanelComponents,\r\n                    this.eStatusBarRight,\r\n                    existingStatusPanelsToReuse\r\n                ),\r\n            ]);\r\n        } else {\r\n            this.setDisplayed(false);\r\n        }\r\n    }\r\n\r\n    private handleStatusBarChanged(): void {\r\n        if (this.updateQueued) {\r\n            return;\r\n        }\r\n        this.updateQueued = true;\r\n        this.panelsPromise.then(() => {\r\n            this.updateStatusBar();\r\n            this.updateQueued = false;\r\n        });\r\n    }\r\n\r\n    private updateStatusBar(): void {\r\n        const statusPanels = this.gos.get('statusBar')?.statusPanels;\r\n        const validStatusBarPanelsProvided = Array.isArray(statusPanels) && statusPanels.length > 0;\r\n        this.setDisplayed(validStatusBarPanelsProvided);\r\n\r\n        const existingStatusPanelsToReuse: Map<string, IStatusPanelComp> = new Map();\r\n\r\n        if (validStatusBarPanelsProvided) {\r\n            statusPanels.forEach((statusPanelConfig) => {\r\n                const key = statusPanelConfig.key ?? statusPanelConfig.statusPanel;\r\n                const existingStatusPanel = this.statusBarSvc.getStatusPanel(key);\r\n                if (existingStatusPanel?.refresh) {\r\n                    const newParams = this.gos.addGridCommonParams(statusPanelConfig.statusPanelParams ?? {});\r\n                    const hasRefreshed = existingStatusPanel.refresh(newParams);\r\n                    if (hasRefreshed) {\r\n                        existingStatusPanelsToReuse.set(key, existingStatusPanel);\r\n                        delete this.compDestroyFunctions[key];\r\n                        _removeFromParent(existingStatusPanel.getGui());\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        this.resetStatusBar();\r\n        if (validStatusBarPanelsProvided) {\r\n            this.processStatusPanels(existingStatusPanelsToReuse);\r\n        }\r\n    }\r\n\r\n    resetStatusBar(): void {\r\n        this.eStatusBarLeft.innerHTML = '';\r\n        this.eStatusBarCenter.innerHTML = '';\r\n        this.eStatusBarRight.innerHTML = '';\r\n\r\n        this.destroyComponents();\r\n        this.statusBarSvc.unregisterAllComponents();\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyComponents();\r\n        super.destroy();\r\n    }\r\n\r\n    private destroyComponents(): void {\r\n        Object.values(this.compDestroyFunctions).forEach((func) => func());\r\n        this.compDestroyFunctions = {};\r\n    }\r\n\r\n    private createAndRenderComponents(\r\n        statusBarComponents: StatusPanelDef[],\r\n        ePanelComponent: HTMLElement,\r\n        existingStatusPanelsToReuse: Map<string, IStatusPanelComp>\r\n    ): AgPromise<void> {\r\n        const componentDetails: { key: string; promise: AgPromise<IStatusPanelComp> }[] = [];\r\n\r\n        statusBarComponents.forEach((componentConfig) => {\r\n            // default to the component name if no key supplied\r\n            const key = componentConfig.key || componentConfig.statusPanel;\r\n            const existingStatusPanel = existingStatusPanelsToReuse.get(key);\r\n            let promise: AgPromise<IStatusPanelComp>;\r\n            if (existingStatusPanel) {\r\n                promise = AgPromise.resolve(existingStatusPanel);\r\n            } else {\r\n                const params: WithoutGridCommon<IStatusPanelParams> = {};\r\n\r\n                const compDetails = getStatusPanelCompDetails(this.userCompFactory, componentConfig, params);\r\n\r\n                if (compDetails == null) {\r\n                    return;\r\n                }\r\n                promise = compDetails.newAgStackInstance();\r\n            }\r\n\r\n            componentDetails.push({\r\n                key,\r\n                promise,\r\n            });\r\n        });\r\n\r\n        return AgPromise.all(componentDetails.map((details) => details.promise)).then(() => {\r\n            componentDetails.forEach((componentDetail) => {\r\n                componentDetail.promise.then((component: IStatusPanelComp) => {\r\n                    const destroyFunc = () => {\r\n                        this.destroyBean(component);\r\n                    };\r\n\r\n                    if (this.isAlive()) {\r\n                        this.statusBarSvc.registerStatusPanel(componentDetail.key, component);\r\n                        ePanelComponent.appendChild(component.getGui());\r\n                        this.compDestroyFunctions[componentDetail.key] = destroyFunc;\r\n                    } else {\r\n                        destroyFunc();\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nexport const AgStatusBarSelector: ComponentSelector = {\r\n    selector: 'AG-STATUS-BAR',\r\n    component: AgStatusBar,\r\n};\r\n", "export const agStatusBarCSS = /*css*/ `.ag-status-bar{border-top:var(--ag-footer-row-border);display:flex;justify-content:space-between;line-height:1.5;overflow:hidden;padding-left:calc(var(--ag-spacing)*4);padding-right:calc(var(--ag-spacing)*4)}.ag-status-panel{display:inline-flex}.ag-status-name-value{font-weight:500;margin-left:var(--ag-spacing);margin-right:var(--ag-spacing);padding-bottom:var(--ag-widget-container-vertical-padding);padding-top:var(--ag-widget-container-vertical-padding);white-space:nowrap}.ag-status-bar-left{display:inline-flex}.ag-status-bar-center{display:inline-flex;text-align:center}.ag-status-bar-right{display:inline-flex}`;\n", "import type {\r\n    AgColumn,\r\n    AggregationStatusPanelAggFunc,\r\n    AggregationStatusPanelParams,\r\n    IStatusPanelComp,\r\n    LocaleTextFunc,\r\n    RowPosition,\r\n} from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    RefPlaceholder,\r\n    _createCellId,\r\n    _exists,\r\n    _formatNumberCommas,\r\n    _getRowNode,\r\n    _isClientSideRowModel,\r\n    _isRowBefore,\r\n    _isServerSideRowModel,\r\n    _missing,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { AgNameValue } from './agNameValue';\r\nimport { AgNameValueSelector } from './agNameValue';\r\n\r\nfunction _formatNumberTwoDecimalPlacesAndCommas(value: number, getLocaleTextFunc: () => LocaleTextFunc): string {\r\n    if (typeof value !== 'number') {\r\n        return '';\r\n    }\r\n\r\n    return _formatNumberCommas(Math.round(value * 100) / 100, getLocaleTextFunc);\r\n}\r\n\r\nexport class AggregationComp extends Component implements IStatusPanelComp {\r\n    private readonly sumAggregationComp: AgNameValue = RefPlaceholder;\r\n    private readonly countAggregationComp: AgNameValue = RefPlaceholder;\r\n    private readonly minAggregationComp: AgNameValue = RefPlaceholder;\r\n    private readonly maxAggregationComp: AgNameValue = RefPlaceholder;\r\n    private readonly avgAggregationComp: AgNameValue = RefPlaceholder;\r\n\r\n    private params!: AggregationStatusPanelParams;\r\n\r\n    constructor() {\r\n        super(\r\n            /* html */ `<div class=\"ag-status-panel ag-status-panel-aggregations\">\r\n            <ag-name-value data-ref=\"avgAggregationComp\"></ag-name-value>\r\n            <ag-name-value data-ref=\"countAggregationComp\"></ag-name-value>\r\n            <ag-name-value data-ref=\"minAggregationComp\"></ag-name-value>\r\n            <ag-name-value data-ref=\"maxAggregationComp\"></ag-name-value>\r\n            <ag-name-value data-ref=\"sumAggregationComp\"></ag-name-value>\r\n        </div>`,\r\n            [AgNameValueSelector]\r\n        );\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        if (!_isClientSideRowModel(this.gos) && !_isServerSideRowModel(this.gos)) {\r\n            _warn(221);\r\n            return;\r\n        }\r\n\r\n        this.avgAggregationComp.setLabel('avg', 'Average');\r\n        this.countAggregationComp.setLabel('count', 'Count');\r\n        this.minAggregationComp.setLabel('min', 'Min');\r\n        this.maxAggregationComp.setLabel('max', 'Max');\r\n        this.sumAggregationComp.setLabel('sum', 'Sum');\r\n\r\n        this.addManagedEventListeners({\r\n            cellSelectionChanged: this.onCellSelectionChanged.bind(this),\r\n            modelUpdated: this.onCellSelectionChanged.bind(this),\r\n        });\r\n    }\r\n\r\n    public init(params: AggregationStatusPanelParams) {\r\n        this.refresh(params);\r\n    }\r\n\r\n    public refresh(params: AggregationStatusPanelParams): boolean {\r\n        this.params = params;\r\n        this.onCellSelectionChanged();\r\n        return true;\r\n    }\r\n\r\n    private setAggregationComponentValue(\r\n        aggFuncName: AggregationStatusPanelAggFunc,\r\n        value: number | null,\r\n        visible: boolean\r\n    ) {\r\n        const statusBarValueComponent = this.getAllowedAggregationValueComponent(aggFuncName);\r\n        if (_exists(statusBarValueComponent) && statusBarValueComponent) {\r\n            statusBarValueComponent.setValue(\r\n                _formatNumberTwoDecimalPlacesAndCommas(value!, this.getLocaleTextFunc.bind(this))\r\n            );\r\n            statusBarValueComponent.setDisplayed(visible);\r\n        } else {\r\n            // might have previously been visible, so hide now\r\n            this.getAggregationValueComponent(aggFuncName)?.setDisplayed(false);\r\n        }\r\n    }\r\n\r\n    private getAllowedAggregationValueComponent(aggFuncName: AggregationStatusPanelAggFunc): AgNameValue | null {\r\n        // if the user has specified the agAggregationPanelComp but no aggFuncs we show the all\r\n        // if the user has specified the agAggregationPanelComp and aggFuncs, then we only show the aggFuncs listed\r\n        const { aggFuncs } = this.params;\r\n        if (!aggFuncs || aggFuncs.includes(aggFuncName)) {\r\n            return this.getAggregationValueComponent(aggFuncName);\r\n        }\r\n\r\n        // either we can't find it (which would indicate a typo or similar user side), or the user has deliberately\r\n        // not listed the component in aggFuncs\r\n        return null;\r\n    }\r\n\r\n    private getAggregationValueComponent(aggFuncName: AggregationStatusPanelAggFunc): AgNameValue {\r\n        // converts user supplied agg name to our reference - eg: sum => sumAggregationComp\r\n        const refComponentName = `${aggFuncName}AggregationComp`;\r\n        return (this as any)[refComponentName];\r\n    }\r\n\r\n    private onCellSelectionChanged(): void {\r\n        const beans = this.beans;\r\n        const { rangeSvc, valueSvc, cellNavigation } = beans;\r\n        const cellRanges = rangeSvc?.getCellRanges();\r\n\r\n        let sum = 0;\r\n        let count = 0;\r\n        let numberCount = 0;\r\n        let min: number | null = null;\r\n        let max: number | null = null;\r\n\r\n        const cellsSoFar: any = {};\r\n\r\n        if (cellRanges?.length && rangeSvc) {\r\n            for (let i = 0; i < cellRanges.length; i++) {\r\n                const cellRange = cellRanges[i];\r\n\r\n                let currentRow: RowPosition | null = rangeSvc.getRangeStartRow(cellRange);\r\n                const lastRow = rangeSvc.getRangeEndRow(cellRange);\r\n\r\n                while (true) {\r\n                    const finishedAllRows = _missing(currentRow) || !currentRow || _isRowBefore(lastRow, currentRow);\r\n                    if (finishedAllRows || !currentRow || !cellRange.columns) {\r\n                        break;\r\n                    }\r\n\r\n                    cellRange.columns.forEach((col: AgColumn) => {\r\n                        if (currentRow === null) {\r\n                            return;\r\n                        }\r\n\r\n                        // we only want to include each cell once, in case a cell is in multiple ranges\r\n                        const cellId = _createCellId({\r\n                            rowPinned: currentRow.rowPinned,\r\n                            column: col,\r\n                            rowIndex: currentRow.rowIndex,\r\n                        });\r\n                        if (cellsSoFar[cellId]) {\r\n                            return;\r\n                        }\r\n                        cellsSoFar[cellId] = true;\r\n\r\n                        const rowNode = _getRowNode(beans, currentRow);\r\n                        if (_missing(rowNode)) {\r\n                            return;\r\n                        }\r\n\r\n                        let value = valueSvc.getValue(col, rowNode);\r\n\r\n                        // if empty cell, skip it, doesn't impact count or anything\r\n                        if (_missing(value) || value === '') {\r\n                            return;\r\n                        }\r\n\r\n                        count++;\r\n\r\n                        // see if value is wrapped, can happen when doing count() or avg() functions\r\n                        if (typeof value === 'object' && 'value' in value) {\r\n                            value = value.value;\r\n\r\n                            // ensure that the new value wouldn't have been skipped by the previous check\r\n                            if (value === '') {\r\n                                return;\r\n                            }\r\n                        }\r\n\r\n                        if (typeof value === 'string') {\r\n                            value = Number(value);\r\n                        }\r\n\r\n                        if (typeof value === 'number' && !isNaN(value)) {\r\n                            sum += value;\r\n\r\n                            if (max === null || value > max) {\r\n                                max = value;\r\n                            }\r\n\r\n                            if (min === null || value < min) {\r\n                                min = value;\r\n                            }\r\n\r\n                            numberCount++;\r\n                        }\r\n                    });\r\n\r\n                    currentRow = cellNavigation!.getRowBelow(currentRow);\r\n                }\r\n            }\r\n        }\r\n\r\n        const gotResult = count > 1;\r\n        const gotNumberResult = numberCount > 1;\r\n\r\n        // we show count even if no numbers\r\n        this.setAggregationComponentValue('count', count, gotResult);\r\n\r\n        // show if numbers found\r\n        this.setAggregationComponentValue('sum', sum, gotNumberResult);\r\n        this.setAggregationComponentValue('min', min, gotNumberResult);\r\n        this.setAggregationComponentValue('max', max, gotNumberResult);\r\n        this.setAggregationComponentValue('avg', sum / numberCount, gotNumberResult);\r\n    }\r\n}\r\n", "import type { ComponentSelector } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nexport class AgNameValue extends Component {\r\n    private readonly eLabel: HTMLElement = RefPlaceholder;\r\n    private readonly eValue: HTMLElement = RefPlaceholder;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-status-name-value\">\r\n            <span data-ref=\"eLabel\"></span>:&nbsp;\r\n            <span data-ref=\"eValue\" class=\"ag-status-name-value-value\"></span>\r\n        </div>`);\r\n    }\r\n\r\n    public setLabel(key: string, defaultValue: string): void {\r\n        // we want to hide until the first value comes in\r\n        this.setDisplayed(false);\r\n\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        this.eLabel.innerHTML = localeTextFunc(key, defaultValue);\r\n    }\r\n\r\n    public setValue(value: any): void {\r\n        this.eValue.innerHTML = value;\r\n    }\r\n}\r\nexport const AgNameValueSelector: ComponentSelector = {\r\n    selector: 'AG-NAME-VALUE',\r\n    component: AgNameValue,\r\n};\r\n", "import type { IClientSideRowModel, IStatusPanelComp } from 'ag-grid-community';\r\nimport { _formatNumberCommas, _isClientSideRowModel, _warn } from 'ag-grid-community';\r\n\r\nimport { AgNameValue } from './agNameValue';\r\n\r\nexport class FilteredRowsComp extends AgNameValue implements IStatusPanelComp {\r\n    public postConstruct(): void {\r\n        this.setLabel('filteredRows', 'Filtered');\r\n\r\n        if (!_isClientSideRowModel(this.gos)) {\r\n            _warn(222);\r\n            return;\r\n        }\r\n\r\n        this.addCssClass('ag-status-panel');\r\n        this.addCssClass('ag-status-panel-filtered-row-count');\r\n\r\n        this.setDisplayed(true);\r\n\r\n        const listener = this.onDataChanged.bind(this);\r\n        this.addManagedEventListeners({ modelUpdated: listener });\r\n        listener();\r\n    }\r\n\r\n    private onDataChanged() {\r\n        const totalRowCountValue = this.getTotalRowCountValue();\r\n        const filteredRowCountValue = this.getFilteredRowCountValue();\r\n\r\n        this.setValue(_formatNumberCommas(filteredRowCountValue, this.getLocaleTextFunc.bind(this)));\r\n        this.setDisplayed(totalRowCountValue !== filteredRowCountValue);\r\n    }\r\n\r\n    private getTotalRowCountValue(): number {\r\n        let totalRowCount = 0;\r\n        this.beans.rowModel.forEachNode(() => (totalRowCount += 1));\r\n        return totalRowCount;\r\n    }\r\n\r\n    private getFilteredRowCountValue(): number {\r\n        let filteredRowCount = 0;\r\n\r\n        (this.beans.rowModel as IClientSideRowModel).forEachNodeAfterFilter((node) => {\r\n            if (!node.group) {\r\n                filteredRowCount += 1;\r\n            }\r\n        });\r\n        return filteredRowCount;\r\n    }\r\n\r\n    public init() {}\r\n\r\n    public refresh(): boolean {\r\n        return true;\r\n    }\r\n}\r\n", "import type { IStatusPanelComp } from 'ag-grid-community';\r\nimport { _formatNumberCommas, _isClientSideRowModel, _isServerSideRowModel, _warn } from 'ag-grid-community';\r\n\r\nimport { AgNameValue } from './agNameValue';\r\n\r\nexport class SelectedRowsComp extends AgNameValue implements IStatusPanelComp {\r\n    public postConstruct(): void {\r\n        const gos = this.gos;\r\n        if (!_isClientSideRowModel(gos) && !_isServerSideRowModel(gos)) {\r\n            _warn(223);\r\n            return;\r\n        }\r\n\r\n        this.setLabel('selectedRows', 'Selected');\r\n\r\n        this.addCssClass('ag-status-panel');\r\n        this.addCssClass('ag-status-panel-selected-row-count');\r\n\r\n        this.onRowSelectionChanged();\r\n\r\n        const eventListener = this.onRowSelectionChanged.bind(this);\r\n        this.addManagedEventListeners({ modelUpdated: eventListener, selectionChanged: eventListener });\r\n    }\r\n\r\n    private onRowSelectionChanged() {\r\n        const selectedRowCount = this.beans.selectionSvc?.getSelectionCount() ?? 0;\r\n        if (selectedRowCount < 0) {\r\n            this.setValue('?');\r\n            this.setDisplayed(true);\r\n            return;\r\n        }\r\n        this.setValue(_formatNumberCommas(selectedRowCount, this.getLocaleTextFunc.bind(this)));\r\n        this.setDisplayed(selectedRowCount > 0);\r\n    }\r\n\r\n    public init() {}\r\n\r\n    public refresh(): boolean {\r\n        return true;\r\n    }\r\n}\r\n", "import type { IClientSideRowModel, IStatusPanelComp } from 'ag-grid-community';\r\nimport { _formatNumberCommas, _isClientSideRowModel, _warn } from 'ag-grid-community';\r\n\r\nimport { AgNameValue } from './agNameValue';\r\n\r\nexport class TotalAndFilteredRowsComp extends AgNameValue implements IStatusPanelComp {\r\n    public postConstruct(): void {\r\n        if (!_isClientSideRowModel(this.gos)) {\r\n            _warn(224);\r\n            return;\r\n        }\r\n\r\n        this.setLabel('totalAndFilteredRows', 'Rows');\r\n\r\n        this.addCssClass('ag-status-panel');\r\n        this.addCssClass('ag-status-panel-total-and-filtered-row-count');\r\n\r\n        this.setDisplayed(true);\r\n\r\n        this.addManagedEventListeners({ modelUpdated: this.onDataChanged.bind(this) });\r\n        this.onDataChanged();\r\n    }\r\n\r\n    private onDataChanged() {\r\n        const getLocaleTextFunc = this.getLocaleTextFunc.bind(this);\r\n        const rowCount = _formatNumberCommas(this.getFilteredRowCountValue(), getLocaleTextFunc);\r\n        const totalRowCount = _formatNumberCommas(this.getTotalRowCount(), getLocaleTextFunc);\r\n\r\n        if (rowCount === totalRowCount) {\r\n            this.setValue(rowCount);\r\n        } else {\r\n            const localeTextFunc = this.getLocaleTextFunc();\r\n            this.setValue(`${rowCount} ${localeTextFunc('of', 'of')} ${totalRowCount}`);\r\n        }\r\n    }\r\n\r\n    private getFilteredRowCountValue(): number {\r\n        let filteredRowCount = 0;\r\n        (this.beans.rowModel as IClientSideRowModel).forEachNodeAfterFilter((node) => {\r\n            if (!node.group) {\r\n                filteredRowCount++;\r\n            }\r\n        });\r\n        return filteredRowCount;\r\n    }\r\n\r\n    private getTotalRowCount(): number {\r\n        let totalRowCount = 0;\r\n        this.beans.rowModel.forEachNode((node) => {\r\n            if (!node.group) {\r\n                totalRowCount++;\r\n            }\r\n        });\r\n        return totalRowCount;\r\n    }\r\n\r\n    public init() {}\r\n\r\n    public refresh(): boolean {\r\n        return true;\r\n    }\r\n}\r\n", "import type { IClientSideRowModel, IStatusPanelComp } from 'ag-grid-community';\r\nimport { _formatNumberCommas, _isClientSideRowModel, _warn } from 'ag-grid-community';\r\n\r\nimport { AgNameValue } from './agNameValue';\r\n\r\nexport class TotalRowsComp extends AgNameValue implements IStatusPanelComp {\r\n    public postConstruct(): void {\r\n        this.setLabel('totalRows', 'Total Rows');\r\n\r\n        if (!_isClientSideRowModel(this.gos)) {\r\n            _warn(225);\r\n            return;\r\n        }\r\n\r\n        this.addCssClass('ag-status-panel');\r\n        this.addCssClass('ag-status-panel-total-row-count');\r\n\r\n        this.setDisplayed(true);\r\n\r\n        this.addManagedEventListeners({ modelUpdated: this.onDataChanged.bind(this) });\r\n        this.onDataChanged();\r\n    }\r\n\r\n    private onDataChanged() {\r\n        this.setValue(_formatNumberCommas(this.getRowCountValue(), this.getLocaleTextFunc.bind(this)));\r\n    }\r\n\r\n    private getRowCountValue(): number {\r\n        let totalRowCount = 0;\r\n        (this.beans.rowModel as IClientSideRowModel).forEachLeafNode(() => (totalRowCount += 1));\r\n        return totalRowCount;\r\n    }\r\n\r\n    public init() {}\r\n\r\n    public refresh(): boolean {\r\n        return true;\r\n    }\r\n}\r\n", "import type { BeanCollection, IStatusPanel } from 'ag-grid-community';\r\nimport { _unwrapUserComp } from 'ag-grid-community';\r\n\r\nimport type { StatusBarService } from './statusBarService';\r\n\r\nexport function getStatusPanel<TStatusPanel = IStatusPanel>(\r\n    beans: BeanCollection,\r\n    key: string\r\n): TStatusPanel | undefined {\r\n    const comp = (beans.statusBarSvc as StatusBarService)?.getStatusPanel(key);\r\n    return _unwrapUserComp(comp) as any;\r\n}\r\n", "import type { IStatusPanelComp, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\nexport class StatusBarService extends BeanStub implements NamedBean {\r\n    beanName = 'statusBarSvc' as const;\r\n\r\n    private comps: Map<string, IStatusPanelComp> = new Map();\r\n\r\n    // tslint:disable-next-line\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    public registerStatusPanel(key: string, component: IStatusPanelComp): void {\r\n        this.comps.set(key, component);\r\n    }\r\n\r\n    public unregisterStatusPanel(key: string): void {\r\n        this.comps.delete(key);\r\n    }\r\n\r\n    public unregisterAllComponents(): void {\r\n        this.comps.clear();\r\n    }\r\n\r\n    public getStatusPanel(key: string): IStatusPanelComp {\r\n        return this.comps.get(key)!;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.unregisterAllComponents();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { _ExcelExportGridApi, _ModuleWithApi } from 'ag-grid-community';\r\nimport { _SharedExportModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { ExcelCreator } from './excelCreator';\r\nimport {\r\n    exportDataAsExcel,\r\n    exportMultipleSheetsAsExcel,\r\n    getDataAsExcel,\r\n    getMultipleSheetsAsExcel,\r\n    getSheetDataForExcel,\r\n} from './excelExportApi';\r\n\r\n/**\r\n * @feature Import & Export -> Excel\r\n */\r\nexport const ExcelExportModule: _ModuleWithApi<_ExcelExportGridApi> = {\r\n    moduleName: 'ExcelExport',\r\n    version: VERSION,\r\n    beans: [ExcelCreator],\r\n    apiFunctions: {\r\n        getDataAsExcel,\r\n        exportDataAsExcel,\r\n        getSheetDataForExcel,\r\n        getMultipleSheetsAsExcel,\r\n        exportMultipleSheetsAsExcel,\r\n    },\r\n    dependsOn: [_SharedExportModule, EnterpriseCoreModule],\r\n};\r\n", "import type { BeanCollection, ExcelExportMultipleSheetParams, ExcelExportParams } from 'ag-grid-community';\r\nimport { _warn } from 'ag-grid-community';\r\n\r\nfunction assertNotExcelMultiSheet(beans: BeanCollection): boolean {\r\n    if (beans.excelCreator?.getFactoryMode() === 'MULTI_SHEET') {\r\n        _warn(161);\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function getDataAsExcel(beans: BeanCollection, params?: ExcelExportParams): string | Blob | undefined {\r\n    if (assertNotExcelMultiSheet(beans)) {\r\n        return beans.excelCreator?.getDataAsExcel(params);\r\n    }\r\n    return undefined;\r\n}\r\n\r\nexport function exportDataAsExcel(beans: BeanCollection, params?: ExcelExportParams): void {\r\n    if (assertNotExcelMultiSheet(beans)) {\r\n        beans.excelCreator?.exportDataAsExcel(params);\r\n    }\r\n}\r\nexport function getSheetDataForExcel(beans: BeanCollection, params?: ExcelExportParams): string | undefined {\r\n    beans.excelCreator?.setFactoryMode('MULTI_SHEET');\r\n\r\n    return beans.excelCreator?.getSheetDataForExcel(params);\r\n}\r\n\r\nexport function getMultipleSheetsAsExcel(\r\n    beans: BeanCollection,\r\n    params: ExcelExportMultipleSheetParams\r\n): Blob | undefined {\r\n    return beans.excelCreator?.getMultipleSheetsAsExcel(params);\r\n}\r\n\r\nexport function exportMultipleSheetsAsExcel(beans: BeanCollection, params: ExcelExportMultipleSheetParams): void {\r\n    beans.excelCreator?.exportMultipleSheetsAsExcel(params);\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\nimport { _ColumnFilterModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { MenuItemModule } from '../widgets/menuItemModule';\r\nimport { MultiFilter } from './multiFilter';\r\nimport { MultiFloatingFilterComp } from './multiFloatingFilter';\r\n\r\n/**\r\n * @feature Filtering -> Multi Filter\r\n */\r\nexport const MultiFilterModule: _ModuleWithoutApi = {\r\n    moduleName: 'MultiFilter',\r\n    version: VERSION,\r\n    userComponents: { agMultiColumnFilter: MultiFilter, agMultiColumnFloatingFilter: MultiFloatingFilterComp },\r\n    dependsOn: [EnterpriseCoreModule, _ColumnFilterModule, MenuItemModule],\r\n};\r\n", "import type {\r\n    AgColumn,\r\n    ContainerType,\r\n    IAfterGuiAttachedParams,\r\n    IDoesFilterPassParams,\r\n    IFilterComp,\r\n    IFilterDef,\r\n    IFilterParams,\r\n    IMultiFilter,\r\n    IMultiFilterDef,\r\n    IMultiFilterModel,\r\n    MultiFilterParams,\r\n    ProvidedFilterModel,\r\n    RowNode,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgPromise,\r\n    KeyCode,\r\n    ProvidedFilter,\r\n    TabGuardComp,\r\n    _focusInto,\r\n    _getActiveDomElement,\r\n    _getFilterDetails,\r\n    _isNothingFocused,\r\n    _loadTemplate,\r\n    _removeFromArray,\r\n} from 'ag-grid-community';\r\n\r\nimport { AgGroupComponent } from '../widgets/agGroupComponent';\r\nimport type { MenuItemActivatedEvent } from '../widgets/agMenuItemComponent';\r\nimport { AgMenuItemComponent } from '../widgets/agMenuItemComponent';\r\nimport { AgMenuItemRenderer } from '../widgets/agMenuItemRenderer';\r\n\r\nexport function getMultiFilterDefs(params: MultiFilterParams): IMultiFilterDef[] {\r\n    const { filters } = params;\r\n\r\n    return filters && filters.length > 0\r\n        ? filters\r\n        : [{ filter: 'agTextColumnFilter' }, { filter: 'agSetColumnFilter' }];\r\n}\r\n\r\nfunction _forEachReverse<T>(list: T[] | null | undefined, action: (value: T, index: number) => void): void {\r\n    if (list == null) {\r\n        return;\r\n    }\r\n\r\n    for (let i = list.length - 1; i >= 0; i--) {\r\n        action(list[i], i);\r\n    }\r\n}\r\n\r\nfunction getFilterTitle(filter: IFilterComp, filterDef: IMultiFilterDef): string {\r\n    if (filterDef.title != null) {\r\n        return filterDef.title;\r\n    }\r\n\r\n    return filter instanceof ProvidedFilter ? filter.getFilterTitle() : 'Filter';\r\n}\r\n\r\nexport class MultiFilter extends TabGuardComp implements IFilterComp, IMultiFilter {\r\n    private filterType = 'multi' as const;\r\n\r\n    private params: MultiFilterParams;\r\n    private filterDefs: IMultiFilterDef[] = [];\r\n    private filters: IFilterComp[] | null = [];\r\n    private guiDestroyFuncs: (() => void)[] = [];\r\n    // this could be the accordion/sub menu element depending on the display type\r\n    private filterGuis: HTMLElement[] = [];\r\n    private column: AgColumn;\r\n    private filterChangedCallback: ((additionalEventAttributes?: any) => void) | null;\r\n    private lastOpenedInContainer?: ContainerType;\r\n    private activeFilterIndices: number[] = [];\r\n    private lastActivatedMenuItem: AgMenuItemComponent | null = null;\r\n    private hidePopup?: () => void;\r\n\r\n    private afterFiltersReadyFuncs: (() => void)[] = [];\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-multi-filter ag-menu-list-compact\"></div>`);\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.initialiseTabGuard({\r\n            onFocusIn: (e) => this.onFocusIn(e),\r\n        });\r\n    }\r\n\r\n    public init(params: MultiFilterParams): AgPromise<void> {\r\n        this.params = params;\r\n        this.filterDefs = getMultiFilterDefs(params);\r\n\r\n        const { column, filterChangedCallback } = params;\r\n\r\n        this.column = column as AgColumn;\r\n        this.filterChangedCallback = filterChangedCallback;\r\n\r\n        const filterPromises: AgPromise<IFilterComp>[] = [];\r\n\r\n        this.filterDefs.forEach((filterDef, index) => {\r\n            const filterPromise = this.createFilter(filterDef, index);\r\n\r\n            if (filterPromise != null) {\r\n                filterPromises.push(filterPromise);\r\n            }\r\n        });\r\n\r\n        // we have to refresh the GUI here to ensure that Angular components are not rendered in odd places\r\n        return new AgPromise<void>((resolve) => {\r\n            AgPromise.all(filterPromises).then((filters) => {\r\n                this.filters = filters as IFilterComp[];\r\n                this.refreshGui('columnMenu').then(() => {\r\n                    resolve();\r\n                });\r\n            });\r\n        }).then(() => {\r\n            this.afterFiltersReadyFuncs.forEach((f) => f());\r\n            this.afterFiltersReadyFuncs.length = 0;\r\n        });\r\n    }\r\n\r\n    private refreshGui(container: ContainerType): AgPromise<void> {\r\n        if (container === this.lastOpenedInContainer) {\r\n            return AgPromise.resolve();\r\n        }\r\n\r\n        this.tabGuardFeature.removeAllChildrenExceptTabGuards();\r\n        this.destroyChildren();\r\n\r\n        return AgPromise.all(\r\n            this.filters!.map((filter, index) => {\r\n                const filterDef = this.filterDefs[index];\r\n                const filterTitle = getFilterTitle(filter, filterDef);\r\n                let filterGuiPromise: AgPromise<HTMLElement>;\r\n\r\n                if (filterDef.display === 'subMenu' && container !== 'toolPanel') {\r\n                    // prevent sub-menu being used in tool panel\r\n                    filterGuiPromise = this.insertFilterMenu(filter, filterTitle).then((menuItem) =>\r\n                        menuItem!.getGui()\r\n                    );\r\n                } else if (filterDef.display === 'subMenu' || filterDef.display === 'accordion') {\r\n                    // sub-menus should appear as groups in the tool panel\r\n                    const group = this.insertFilterGroup(filter, filterTitle);\r\n\r\n                    filterGuiPromise = AgPromise.resolve(group.getGui());\r\n                } else {\r\n                    // display inline\r\n                    filterGuiPromise = AgPromise.resolve(filter.getGui());\r\n                }\r\n\r\n                return filterGuiPromise;\r\n            })\r\n        ).then((filterGuis) => {\r\n            filterGuis!.forEach((filterGui, index) => {\r\n                if (index > 0) {\r\n                    this.appendChild(_loadTemplate(/* html */ `<div class=\"ag-filter-separator\"></div>`));\r\n                }\r\n                this.appendChild(filterGui!);\r\n            });\r\n            this.filterGuis = filterGuis as HTMLElement[];\r\n            this.lastOpenedInContainer = container;\r\n        });\r\n    }\r\n\r\n    private destroyChildren() {\r\n        this.guiDestroyFuncs.forEach((func) => func());\r\n        this.guiDestroyFuncs.length = 0;\r\n        this.filterGuis.length = 0;\r\n    }\r\n\r\n    private insertFilterMenu(filter: IFilterComp, name: string): AgPromise<AgMenuItemComponent> {\r\n        const menuItem = this.createBean(new AgMenuItemComponent());\r\n        return menuItem\r\n            .init({\r\n                menuItemDef: {\r\n                    name,\r\n                    subMenu: [],\r\n                    cssClasses: ['ag-multi-filter-menu-item'],\r\n                    menuItem: AgMenuItemRenderer,\r\n                    menuItemParams: {\r\n                        cssClassPrefix: 'ag-compact-menu-option',\r\n                        isCompact: true,\r\n                    },\r\n                },\r\n                level: 0,\r\n                isAnotherSubMenuOpen: () => false,\r\n                childComponent: filter,\r\n                contextParams: {\r\n                    column: null,\r\n                    node: null,\r\n                    value: null,\r\n                },\r\n            })\r\n            .then(() => {\r\n                menuItem.setParentComponent(this);\r\n\r\n                this.guiDestroyFuncs.push(() => this.destroyBean(menuItem));\r\n\r\n                this.addManagedListeners(menuItem, {\r\n                    menuItemActivated: (event: MenuItemActivatedEvent) => {\r\n                        if (this.lastActivatedMenuItem && this.lastActivatedMenuItem !== event.menuItem) {\r\n                            this.lastActivatedMenuItem.deactivate();\r\n                        }\r\n\r\n                        this.lastActivatedMenuItem = event.menuItem;\r\n                    },\r\n                });\r\n\r\n                const menuItemGui = menuItem.getGui();\r\n                menuItem.addManagedElementListeners(menuItemGui, {\r\n                    // `AgMenuList` normally handles keyboard navigation, so need to do here\r\n                    keydown: (e: KeyboardEvent) => {\r\n                        const { key } = e;\r\n                        switch (key) {\r\n                            case KeyCode.UP:\r\n                            case KeyCode.RIGHT:\r\n                            case KeyCode.DOWN:\r\n                            case KeyCode.LEFT:\r\n                                e.preventDefault();\r\n                                if (key === KeyCode.RIGHT) {\r\n                                    menuItem.openSubMenu(true);\r\n                                }\r\n                                break;\r\n                        }\r\n                    },\r\n                    focusin: () => menuItem.activate(),\r\n                    focusout: () => {\r\n                        if (!menuItem.isSubMenuOpen() && !menuItem.isSubMenuOpening()) {\r\n                            menuItem.deactivate();\r\n                        }\r\n                    },\r\n                });\r\n\r\n                return menuItem;\r\n            });\r\n    }\r\n\r\n    private insertFilterGroup(filter: IFilterComp, title: string): AgGroupComponent {\r\n        const group = this.createBean(\r\n            new AgGroupComponent({\r\n                title,\r\n                cssIdentifier: 'multi-filter',\r\n            })\r\n        );\r\n\r\n        this.guiDestroyFuncs.push(() => this.destroyBean(group));\r\n\r\n        group.addItem(filter.getGui());\r\n        group.toggleGroupExpand(false);\r\n\r\n        if (filter.afterGuiAttached) {\r\n            group.addManagedListeners(group, {\r\n                expanded: () =>\r\n                    filter.afterGuiAttached!({\r\n                        container: this.lastOpenedInContainer!,\r\n                        suppressFocus: true,\r\n                        hidePopup: this.hidePopup,\r\n                    }),\r\n            });\r\n        }\r\n\r\n        return group;\r\n    }\r\n\r\n    public isFilterActive(): boolean {\r\n        return this.filters!.some((filter) => filter.isFilterActive());\r\n    }\r\n\r\n    public getLastActiveFilterIndex(): number | null {\r\n        const activeFilterIndices = this.activeFilterIndices;\r\n        return activeFilterIndices.length > 0 ? activeFilterIndices[activeFilterIndices.length - 1] : null;\r\n    }\r\n\r\n    public doesFilterPass(params: IDoesFilterPassParams, filterToSkip?: IFilterComp): boolean {\r\n        let rowPasses = true;\r\n\r\n        this.filters!.forEach((filter) => {\r\n            if (!rowPasses || filter === filterToSkip || !filter.isFilterActive()) {\r\n                return;\r\n            }\r\n\r\n            rowPasses = filter.doesFilterPass(params);\r\n        });\r\n\r\n        return rowPasses;\r\n    }\r\n\r\n    public getModelFromUi(): IMultiFilterModel | null {\r\n        const model: IMultiFilterModel = {\r\n            filterType: this.filterType,\r\n            filterModels: this.filters!.map((filter) => {\r\n                const providedFilter = filter as ProvidedFilter<IMultiFilterModel, unknown>;\r\n\r\n                if (typeof providedFilter.getModelFromUi === 'function') {\r\n                    return providedFilter.getModelFromUi();\r\n                }\r\n\r\n                return null;\r\n            }),\r\n        };\r\n\r\n        return model;\r\n    }\r\n\r\n    public getModel(): ProvidedFilterModel | null {\r\n        if (!this.isFilterActive()) {\r\n            return null;\r\n        }\r\n\r\n        const model: IMultiFilterModel = {\r\n            filterType: this.filterType,\r\n            filterModels: this.filters!.map((filter) => {\r\n                if (filter.isFilterActive()) {\r\n                    return filter.getModel();\r\n                }\r\n\r\n                return null;\r\n            }),\r\n        };\r\n\r\n        return model;\r\n    }\r\n\r\n    public setModel(model: IMultiFilterModel | null): AgPromise<void> {\r\n        const setFilterModel = (filter: IFilterComp, filterModel: any) => {\r\n            return new AgPromise<void>((resolve) => {\r\n                const promise = filter.setModel(filterModel);\r\n                promise ? promise.then(() => resolve()) : resolve();\r\n            });\r\n        };\r\n\r\n        let promises: AgPromise<void>[] = [];\r\n\r\n        if (model == null) {\r\n            promises = this.filters!.map((filter: IFilterComp, index: number) => {\r\n                const res = setFilterModel(filter, null).then(() => {\r\n                    this.updateActiveList(index);\r\n                });\r\n                return res;\r\n            })!;\r\n        } else {\r\n            this.filters!.forEach((filter, index) => {\r\n                const filterModel = model.filterModels!.length > index ? model.filterModels![index] : null;\r\n                const res = setFilterModel(filter, filterModel).then(() => {\r\n                    this.updateActiveList(index);\r\n                });\r\n                promises.push(res);\r\n            });\r\n        }\r\n\r\n        return AgPromise.all(promises).then(() => {});\r\n    }\r\n\r\n    public applyModel(source: 'api' | 'ui' | 'rowDataUpdated' = 'api'): boolean {\r\n        let result = false;\r\n\r\n        this.filters!.forEach((filter) => {\r\n            if (filter instanceof ProvidedFilter) {\r\n                result = filter.applyModel(source) || result;\r\n            }\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    public getChildFilterInstance(index: number): IFilterComp | undefined {\r\n        return this.filters![index];\r\n    }\r\n\r\n    public afterGuiAttached(params?: IAfterGuiAttachedParams): void {\r\n        let refreshPromise: AgPromise<void>;\r\n        if (params) {\r\n            this.hidePopup = params.hidePopup;\r\n            refreshPromise = this.refreshGui(params.container!);\r\n        } else {\r\n            this.hidePopup = undefined;\r\n            refreshPromise = AgPromise.resolve();\r\n        }\r\n\r\n        const suppressFocus = params?.suppressFocus;\r\n\r\n        refreshPromise.then(() => {\r\n            const { filterDefs, filters, filterGuis, beans } = this;\r\n            // don't want to focus later if focus suppressed\r\n            let hasFocused = !!suppressFocus;\r\n            if (filterDefs) {\r\n                _forEachReverse(filterDefs, (filterDef, index) => {\r\n                    const isFirst = index === 0;\r\n                    const notInlineDisplayType = filterDef.display && filterDef.display !== 'inline';\r\n                    const suppressFocusForFilter = suppressFocus || !isFirst || notInlineDisplayType;\r\n                    const afterGuiAttachedParams = { ...(params ?? {}), suppressFocus: suppressFocusForFilter };\r\n                    const filter = filters?.[index];\r\n                    if (filter) {\r\n                        this.executeFunctionIfExistsOnFilter(filter, 'afterGuiAttached', afterGuiAttachedParams);\r\n                        if (isFirst && !suppressFocusForFilter) {\r\n                            hasFocused = true;\r\n                        }\r\n                    }\r\n                    if (!suppressFocus && isFirst && notInlineDisplayType) {\r\n                        // focus the first filter container instead (accordion/sub menu)\r\n                        const filterGui = filterGuis[index];\r\n                        if (filterGui) {\r\n                            if (!_focusInto(filterGui)) {\r\n                                // menu item contains no focusable elements but is focusable itself\r\n                                filterGui.focus({ preventScroll: true });\r\n                            }\r\n                            hasFocused = true;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            const activeEl = _getActiveDomElement(beans);\r\n\r\n            // if we haven't focused the first item in the filter, we might run into two scenarios:\r\n            // 1 - we are loading the filter for the first time and the component isn't ready,\r\n            //     which means the document will have focus.\r\n            // 2 - The focus will be somewhere inside the component due to auto focus\r\n            // In both cases we need to force the focus somewhere valid but outside the filter.\r\n            if (!hasFocused && (_isNothingFocused(beans) || this.getGui().contains(activeEl))) {\r\n                // reset focus to the top of the container, and blur\r\n                this.forceFocusOutOfContainer(true);\r\n            }\r\n        });\r\n    }\r\n\r\n    public afterGuiDetached(): void {\r\n        this.executeFunctionIfExists('afterGuiDetached');\r\n    }\r\n\r\n    public onAnyFilterChanged(): void {\r\n        this.executeFunctionIfExists('onAnyFilterChanged');\r\n    }\r\n\r\n    public onNewRowsLoaded(): void {\r\n        this.executeFunctionIfExists('onNewRowsLoaded');\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.filters!.forEach((filter) => this.destroyBean(filter));\r\n\r\n        this.filters!.length = 0;\r\n        this.destroyChildren();\r\n        this.hidePopup = undefined;\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    private executeFunctionIfExists<T extends IFilterComp>(name: keyof T, ...params: any[]): void {\r\n        // The first filter is always the \"dominant\" one. By iterating in reverse order we ensure the first filter\r\n        // always gets the last say\r\n        _forEachReverse(this.filters, (filter) => {\r\n            this.executeFunctionIfExistsOnFilter(filter as T, name, params);\r\n        });\r\n    }\r\n\r\n    private executeFunctionIfExistsOnFilter<T extends IFilterComp>(filter: T, name: keyof T, ...params: any[]): void {\r\n        const func = filter[name];\r\n\r\n        if (typeof func === 'function') {\r\n            func.apply(filter, params);\r\n        }\r\n    }\r\n\r\n    private createFilter(filterDef: IFilterDef, index: number): AgPromise<IFilterComp> | null {\r\n        const { filterModifiedCallback, doesRowPassOtherFilter } = this.params;\r\n        const { filterManager, userCompFactory } = this.beans;\r\n\r\n        let filterInstance: IFilterComp;\r\n\r\n        const filterParams: IFilterParams = {\r\n            ...filterManager!.createFilterParams(this.column, this.column.getColDef()),\r\n            filterModifiedCallback,\r\n            filterChangedCallback: (additionalEventAttributes) => {\r\n                this.executeWhenAllFiltersReady(() => this.filterChanged(index, additionalEventAttributes));\r\n            },\r\n            doesRowPassOtherFilter: (node: RowNode) =>\r\n                doesRowPassOtherFilter(node) && this.doesFilterPass({ node, data: node.data }, filterInstance),\r\n        };\r\n\r\n        const compDetails = _getFilterDetails(userCompFactory, filterDef, filterParams, 'agTextColumnFilter');\r\n        if (!compDetails) {\r\n            return null;\r\n        }\r\n        const filterPromise = compDetails.newAgStackInstance();\r\n\r\n        filterPromise.then((filter) => (filterInstance = filter!));\r\n\r\n        return filterPromise;\r\n    }\r\n\r\n    private executeWhenAllFiltersReady(action: () => void): void {\r\n        if ((this.filters?.length ?? 0) > 0) {\r\n            action();\r\n        } else {\r\n            this.afterFiltersReadyFuncs.push(action);\r\n        }\r\n    }\r\n\r\n    private updateActiveList(index: number): void {\r\n        const { filters, activeFilterIndices } = this;\r\n        const changedFilter = filters![index];\r\n\r\n        _removeFromArray(activeFilterIndices, index);\r\n\r\n        if (changedFilter.isFilterActive()) {\r\n            activeFilterIndices.push(index);\r\n        }\r\n    }\r\n\r\n    private filterChanged(index: number, additionalEventAttributes: any): void {\r\n        this.updateActiveList(index);\r\n\r\n        this.filterChangedCallback!(additionalEventAttributes);\r\n        const changedFilter = this.filters![index];\r\n\r\n        this.filters!.forEach((filter) => {\r\n            if (filter === changedFilter) {\r\n                return;\r\n            }\r\n\r\n            if (typeof filter.onAnyFilterChanged === 'function') {\r\n                filter.onAnyFilterChanged();\r\n            }\r\n        });\r\n    }\r\n\r\n    protected onFocusIn(e: FocusEvent): void {\r\n        const lastActivatedMenuItem = this.lastActivatedMenuItem;\r\n        if (lastActivatedMenuItem != null && !lastActivatedMenuItem.getGui().contains(e.target as HTMLElement)) {\r\n            lastActivatedMenuItem.deactivate();\r\n            this.lastActivatedMenuItem = null;\r\n        }\r\n    }\r\n\r\n    getModelAsString(model: IMultiFilterModel): string {\r\n        if (!this.filters || !model?.filterModels?.length) {\r\n            return '';\r\n        }\r\n        const lastActiveIndex = this.getLastActiveFilterIndex() ?? 0;\r\n        const activeFilter = this.filters[lastActiveIndex];\r\n        return activeFilter.getModelAsString?.(model.filterModels[lastActiveIndex]) ?? '';\r\n    }\r\n}\r\n", "import type { AgCheckbox, AgEvent, ComponentSelector } from 'ag-grid-community';\r\nimport {\r\n    AgCheckboxSelector,\r\n    AgToggleButton,\r\n    Component,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    _createIcon,\r\n    _setAriaExpanded,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\ntype GroupItem = Component<any> | HTMLElement;\r\ntype Align = 'start' | 'end' | 'center' | 'stretch';\r\ntype Direction = 'horizontal' | 'vertical';\r\n\r\nexport interface AgGroupComponentParams {\r\n    title?: string;\r\n    enabled?: boolean;\r\n    suppressEnabledCheckbox?: boolean;\r\n    suppressOpenCloseIcons?: boolean;\r\n    suppressToggleExpandOnEnableChange?: boolean;\r\n    cssIdentifier?: string;\r\n    items?: GroupItem[];\r\n    alignItems?: Align;\r\n    direction?: Direction;\r\n    onEnableChange?: (enabled: boolean) => void;\r\n    onExpandedChange?: (expanded: boolean) => void;\r\n    expanded?: boolean;\r\n    useToggle?: boolean;\r\n    suppressKeyboardNavigation?: boolean;\r\n}\r\n\r\nexport type AgGroupComponentEvent = 'expanded' | 'collapsed' | 'enableChange';\r\nexport type ExpandedChangedEventType = 'expandedChanged';\r\n\r\ninterface ExpandChangedEvent extends AgEvent<ExpandedChangedEventType> {\r\n    expanded?: boolean;\r\n}\r\n\r\ninterface EnableChangeEvent extends AgEvent<'enableChange'> {\r\n    enabled: boolean;\r\n}\r\n\r\nfunction getAgGroupComponentTemplate(params: AgGroupComponentParams) {\r\n    const cssIdentifier = params.cssIdentifier || 'default';\r\n    const direction: Direction = params.direction || 'vertical';\r\n\r\n    return /* html */ `\r\n        <div class=\"ag-group ag-${cssIdentifier}-group\" role=\"presentation\">\r\n            <div data-ref=\"eToolbar\" class=\"ag-group-toolbar ag-${cssIdentifier}-group-toolbar\">\r\n                <ag-checkbox data-ref=\"cbGroupEnabled\"></ag-checkbox>\r\n            </div>\r\n            <div data-ref=\"eContainer\" class=\"ag-group-container ag-group-container-${direction} ag-${cssIdentifier}-group-container\"></div>\r\n        </div>\r\n    `;\r\n}\r\n\r\nexport class AgGroupComponent extends Component<AgGroupComponentEvent> {\r\n    private items: GroupItem[];\r\n    private cssIdentifier: string;\r\n    private enabled: boolean;\r\n    private expanded: boolean;\r\n    private suppressEnabledCheckbox: boolean = true;\r\n    private suppressToggleExpandOnEnableChange: boolean = false;\r\n    private alignItems: Align | undefined;\r\n    private useToggle: boolean;\r\n\r\n    private eToggle?: AgToggleButton;\r\n    private eTitleBar?: DefaultTitleBar;\r\n\r\n    private readonly eToolbar: HTMLElement = RefPlaceholder;\r\n    private readonly cbGroupEnabled: AgCheckbox = RefPlaceholder;\r\n    private readonly eContainer: HTMLElement = RefPlaceholder;\r\n\r\n    constructor(private readonly params: AgGroupComponentParams = {}) {\r\n        super(getAgGroupComponentTemplate(params), [AgCheckboxSelector]);\r\n\r\n        const {\r\n            enabled,\r\n            items,\r\n            suppressEnabledCheckbox,\r\n            expanded,\r\n            suppressToggleExpandOnEnableChange,\r\n            useToggle: toggleMode,\r\n        } = params;\r\n\r\n        this.cssIdentifier = params.cssIdentifier || 'default';\r\n        this.enabled = enabled != null ? enabled : true;\r\n        this.items = items || [];\r\n        this.useToggle = toggleMode ?? false;\r\n\r\n        this.alignItems = params.alignItems || 'center';\r\n\r\n        // expanded by default\r\n        this.expanded = expanded == null ? true : expanded;\r\n\r\n        if (suppressEnabledCheckbox != null) {\r\n            this.suppressEnabledCheckbox = suppressEnabledCheckbox;\r\n        }\r\n\r\n        if (suppressToggleExpandOnEnableChange != null) {\r\n            this.suppressToggleExpandOnEnableChange = suppressToggleExpandOnEnableChange;\r\n        }\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.setupTitleBar();\r\n\r\n        if (this.items.length) {\r\n            const initialItems = this.items;\r\n            this.items = [];\r\n\r\n            this.addItems(initialItems);\r\n        }\r\n\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        this.cbGroupEnabled.setLabel(localeTextFunc('enabled', 'Enabled'));\r\n\r\n        if (this.enabled) {\r\n            this.setEnabled(this.enabled, undefined, true);\r\n        }\r\n\r\n        this.setAlignItems(this.alignItems);\r\n\r\n        const { onEnableChange, onExpandedChange, suppressOpenCloseIcons } = this.params;\r\n\r\n        this.hideEnabledCheckbox(this.suppressEnabledCheckbox);\r\n        this.hideOpenCloseIcons(suppressOpenCloseIcons ?? false);\r\n\r\n        this.refreshChildDisplay();\r\n        _setDisplayed(this.eContainer, this.expanded);\r\n\r\n        this.cbGroupEnabled.onValueChange((newSelection: boolean) => {\r\n            this.setEnabled(newSelection, true, this.suppressToggleExpandOnEnableChange);\r\n            this.dispatchEnableChangeEvent(newSelection);\r\n        });\r\n\r\n        if (onEnableChange != null) {\r\n            this.onEnableChange(onEnableChange);\r\n        }\r\n\r\n        if (onExpandedChange != null) {\r\n            this.onExpandedChange(onExpandedChange);\r\n        }\r\n    }\r\n\r\n    private refreshChildDisplay(): void {\r\n        _setDisplayed(this.eToolbar, this.expanded && !this.suppressEnabledCheckbox);\r\n        this.eTitleBar?.refreshOnExpand(this.expanded);\r\n    }\r\n\r\n    public isExpanded(): boolean {\r\n        return this.expanded;\r\n    }\r\n\r\n    public setAlignItems(alignment: AgGroupComponentParams['alignItems']): this {\r\n        if (this.alignItems !== alignment) {\r\n            this.removeCssClass(`ag-group-item-alignment-${this.alignItems}`);\r\n        }\r\n\r\n        this.alignItems = alignment;\r\n        const newCls = `ag-group-item-alignment-${this.alignItems}`;\r\n\r\n        this.addCssClass(newCls);\r\n\r\n        return this;\r\n    }\r\n\r\n    public toggleGroupExpand(expanded?: boolean, silent?: boolean): this {\r\n        if (this.eTitleBar?.isSuppressCollapse() && !this.useToggle) {\r\n            expanded = true;\r\n            silent = true;\r\n        } else {\r\n            expanded = expanded != null ? expanded : !this.expanded;\r\n\r\n            if (this.expanded === expanded) {\r\n                return this;\r\n            }\r\n        }\r\n\r\n        this.expanded = expanded;\r\n        this.refreshChildDisplay();\r\n\r\n        _setDisplayed(this.eContainer, expanded);\r\n\r\n        if (!silent) {\r\n            this.dispatchLocalEvent({\r\n                type: expanded ? 'expanded' : 'collapsed',\r\n            });\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public addItems(items: GroupItem[]) {\r\n        items.forEach((item) => this.addItem(item));\r\n    }\r\n\r\n    public prependItem(item: GroupItem) {\r\n        this.insertItem(item, true);\r\n    }\r\n\r\n    public addItem(item: GroupItem) {\r\n        this.insertItem(item, false);\r\n    }\r\n\r\n    private insertItem(item: GroupItem, prepend?: boolean) {\r\n        const container = this.eContainer;\r\n        const el = item instanceof Component ? item.getGui() : item;\r\n\r\n        el.classList.add('ag-group-item', `ag-${this.cssIdentifier}-group-item`);\r\n\r\n        if (prepend) {\r\n            container.insertAdjacentElement('afterbegin', el);\r\n            this.items.unshift(el);\r\n        } else {\r\n            container.appendChild(el);\r\n            this.items.push(el);\r\n        }\r\n    }\r\n\r\n    public hideItem(hide: boolean, index: number) {\r\n        const itemToHide = this.items[index] as HTMLElement;\r\n        _setDisplayed(itemToHide, !hide);\r\n    }\r\n\r\n    public getItemIndex(item: GroupItem): number | -1 {\r\n        const el = item instanceof Component ? item.getGui() : item;\r\n        return this.items.indexOf(el);\r\n    }\r\n\r\n    public setTitle(title: string): this {\r\n        this.eTitleBar?.setTitle(title);\r\n        return this;\r\n    }\r\n\r\n    public addTitleBarWidget(el: Element): this {\r\n        this.eTitleBar?.addWidget(el);\r\n        return this;\r\n    }\r\n\r\n    public addCssClassToTitleBar(cssClass: string) {\r\n        this.eTitleBar?.addCssClass(cssClass);\r\n    }\r\n\r\n    private dispatchEnableChangeEvent(enabled: boolean): void {\r\n        const event: EnableChangeEvent = {\r\n            type: 'enableChange',\r\n            enabled,\r\n        };\r\n        this.dispatchLocalEvent(event);\r\n    }\r\n\r\n    public setEnabled(enabled: boolean, skipToggle?: boolean, skipExpand?: boolean): this {\r\n        this.enabled = enabled;\r\n        this.refreshDisabledStyles();\r\n\r\n        if (!skipExpand) {\r\n            this.toggleGroupExpand(enabled);\r\n        }\r\n\r\n        if (!skipToggle) {\r\n            this.cbGroupEnabled.setValue(enabled);\r\n            this.eToggle?.setValue(enabled);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public isEnabled(): boolean {\r\n        return this.enabled;\r\n    }\r\n\r\n    public onEnableChange(callbackFn: (enabled: boolean) => void): this {\r\n        this.addManagedListeners(this, { enableChange: (event: EnableChangeEvent) => callbackFn(event.enabled) });\r\n\r\n        return this;\r\n    }\r\n\r\n    public onExpandedChange(callbackFn: (expanded: boolean) => void): this {\r\n        this.addManagedListeners(this, {\r\n            expanded: () => callbackFn(true),\r\n            collapsed: () => callbackFn(false),\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    public hideEnabledCheckbox(hide: boolean): this {\r\n        this.suppressEnabledCheckbox = hide;\r\n        this.refreshChildDisplay();\r\n        this.refreshDisabledStyles();\r\n        return this;\r\n    }\r\n\r\n    public hideOpenCloseIcons(hide: boolean): this {\r\n        this.eTitleBar?.hideOpenCloseIcons(hide);\r\n\r\n        return this;\r\n    }\r\n\r\n    private refreshDisabledStyles() {\r\n        const disabled = !this.enabled;\r\n        this.eContainer.classList.toggle('ag-disabled', disabled);\r\n        this.eTitleBar?.refreshDisabledStyles(this.suppressEnabledCheckbox && disabled);\r\n        this.eContainer.classList.toggle('ag-disabled-group-container', disabled);\r\n    }\r\n\r\n    private setupTitleBar(): void {\r\n        const titleBar = this.useToggle ? this.createToggleTitleBar() : this.createDefaultTitleBar();\r\n        this.eToolbar.insertAdjacentElement('beforebegin', titleBar.getGui());\r\n    }\r\n\r\n    private createDefaultTitleBar(): DefaultTitleBar {\r\n        const titleBar = this.createManagedBean(new DefaultTitleBar(this.params));\r\n        this.eTitleBar = titleBar;\r\n        titleBar.refreshOnExpand(this.expanded);\r\n        this.addManagedListeners(titleBar, {\r\n            expandedChanged: (event: ExpandChangedEvent) => this.toggleGroupExpand(event.expanded),\r\n        });\r\n        return titleBar;\r\n    }\r\n\r\n    private createToggleTitleBar(): AgToggleButton {\r\n        const eToggle = this.createManagedBean(\r\n            new AgToggleButton({\r\n                value: this.enabled,\r\n                label: this.params.title,\r\n                labelAlignment: 'left',\r\n                labelWidth: 'flex',\r\n                onValueChange: (enabled) => {\r\n                    this.setEnabled(enabled, true);\r\n                    this.dispatchEnableChangeEvent(enabled);\r\n                },\r\n            })\r\n        );\r\n        eToggle.addCssClass('ag-group-title-bar');\r\n        eToggle.addCssClass(`ag-${this.params.cssIdentifier ?? 'default'}-group-title-bar ag-unselectable`);\r\n        this.eToggle = eToggle;\r\n        this.toggleGroupExpand(this.enabled);\r\n        return eToggle;\r\n    }\r\n}\r\n\r\nconst TITLE_BAR_DISABLED_CLASS = 'ag-disabled-group-title-bar';\r\nfunction getDefaultTitleBarTemplate(params: AgGroupComponentParams) {\r\n    const cssIdentifier = params.cssIdentifier ?? 'default';\r\n\r\n    const role = params.suppressKeyboardNavigation ? 'presentation' : 'role';\r\n\r\n    return /* html */ `\r\n        <div class=\"ag-group-title-bar ag-${cssIdentifier}-group-title-bar ag-unselectable\" role=\"${role}\">\r\n            <span class=\"ag-group-title-bar-icon ag-${cssIdentifier}-group-title-bar-icon\" data-ref=\"eGroupOpenedIcon\" role=\"presentation\"></span>\r\n            <span class=\"ag-group-title-bar-icon ag-${cssIdentifier}-group-title-bar-icon\" data-ref=\"eGroupClosedIcon\" role=\"presentation\"></span>\r\n            <span data-ref=\"eTitle\" class=\"ag-group-title ag-${cssIdentifier}-group-title\"></span>\r\n        </div>\r\n    `;\r\n}\r\nclass DefaultTitleBar extends Component<ExpandedChangedEventType> {\r\n    private title: string | undefined;\r\n    private suppressOpenCloseIcons: boolean = false;\r\n    private suppressKeyboardNavigation: boolean = false;\r\n\r\n    private readonly eGroupOpenedIcon: HTMLElement = RefPlaceholder;\r\n    private readonly eGroupClosedIcon: HTMLElement = RefPlaceholder;\r\n    private readonly eTitle: HTMLElement = RefPlaceholder;\r\n\r\n    constructor(params: AgGroupComponentParams = {}) {\r\n        super(getDefaultTitleBarTemplate(params));\r\n\r\n        const { title, suppressOpenCloseIcons, suppressKeyboardNavigation } = params;\r\n\r\n        if (!!title && title.length > 0) {\r\n            this.title = title;\r\n        }\r\n\r\n        if (suppressOpenCloseIcons != null) {\r\n            this.suppressOpenCloseIcons = suppressOpenCloseIcons;\r\n        }\r\n\r\n        this.suppressKeyboardNavigation = suppressKeyboardNavigation ?? false;\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.setTitle(this.title);\r\n\r\n        this.hideOpenCloseIcons(this.suppressOpenCloseIcons);\r\n\r\n        this.setupExpandContract();\r\n    }\r\n\r\n    private setupExpandContract(): void {\r\n        this.eGroupClosedIcon.appendChild(_createIcon('accordionClosed', this.beans, null));\r\n        this.eGroupOpenedIcon.appendChild(_createIcon('accordionOpen', this.beans, null));\r\n        this.addManagedElementListeners(this.getGui(), {\r\n            click: () => this.dispatchExpandChanged(),\r\n            keydown: (e: KeyboardEvent) => {\r\n                switch (e.key) {\r\n                    case KeyCode.ENTER:\r\n                    case KeyCode.SPACE:\r\n                        e.preventDefault();\r\n                        this.dispatchExpandChanged();\r\n                        break;\r\n                    case KeyCode.RIGHT:\r\n                    case KeyCode.LEFT:\r\n                        e.preventDefault();\r\n                        this.dispatchExpandChanged(e.key === KeyCode.RIGHT);\r\n                        break;\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    public refreshOnExpand(expanded: boolean): void {\r\n        this.refreshAriaStatus(expanded);\r\n        this.refreshOpenCloseIcons(expanded);\r\n    }\r\n\r\n    private refreshAriaStatus(expanded: boolean): void {\r\n        if (!this.suppressOpenCloseIcons) {\r\n            _setAriaExpanded(this.getGui(), expanded);\r\n        }\r\n    }\r\n\r\n    private refreshOpenCloseIcons(expanded: boolean): void {\r\n        const showIcon = !this.suppressOpenCloseIcons;\r\n\r\n        _setDisplayed(this.eGroupOpenedIcon, showIcon && expanded);\r\n        _setDisplayed(this.eGroupClosedIcon, showIcon && !expanded);\r\n    }\r\n\r\n    public isSuppressCollapse(): boolean {\r\n        return this.suppressOpenCloseIcons;\r\n    }\r\n\r\n    private dispatchExpandChanged(expanded?: boolean): void {\r\n        const event: ExpandChangedEvent = {\r\n            type: 'expandedChanged',\r\n            expanded,\r\n        };\r\n        this.dispatchLocalEvent(event);\r\n    }\r\n\r\n    public setTitle(title: string | undefined): this {\r\n        const eGui = this.getGui();\r\n        const hasTitle = !!title && title.length > 0;\r\n        title = hasTitle ? title : undefined;\r\n\r\n        this.eTitle.textContent = title ?? '';\r\n        _setDisplayed(eGui, hasTitle);\r\n\r\n        if (title !== this.title) {\r\n            this.title = title;\r\n        }\r\n\r\n        const disabled = eGui.classList.contains(TITLE_BAR_DISABLED_CLASS);\r\n        this.refreshDisabledStyles(disabled);\r\n\r\n        return this;\r\n    }\r\n\r\n    public addWidget(el: Element): this {\r\n        this.getGui().appendChild(el);\r\n\r\n        return this;\r\n    }\r\n\r\n    public hideOpenCloseIcons(hide: boolean): this {\r\n        this.suppressOpenCloseIcons = hide;\r\n\r\n        if (hide) {\r\n            this.dispatchExpandChanged(true);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public refreshDisabledStyles(disabled: boolean) {\r\n        const eGui = this.getGui();\r\n        if (disabled) {\r\n            eGui.classList.add(TITLE_BAR_DISABLED_CLASS);\r\n            eGui.removeAttribute('tabindex');\r\n        } else {\r\n            eGui.classList.remove(TITLE_BAR_DISABLED_CLASS);\r\n            if (typeof this.title === 'string' && !this.suppressKeyboardNavigation) {\r\n                eGui.setAttribute('tabindex', '0');\r\n            } else {\r\n                eGui.removeAttribute('tabindex');\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport const AgGroupComponentSelector: ComponentSelector = {\r\n    selector: 'AG-GROUP-COMPONENT',\r\n    component: AgGroupComponent,\r\n};\r\n", "import type {\r\n    AgColumn,\r\n    FilterChangedEvent,\r\n    IFilter,\r\n    IFilterDef,\r\n    IFloatingFilterComp,\r\n    IFloatingFilterParams,\r\n    IMultiFilterModel,\r\n    MultiFilterParams,\r\n    UserCompDetails,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgPromise,\r\n    Component,\r\n    _clearElement,\r\n    _error,\r\n    _getDefaultFloatingFilterType,\r\n    _getFloatingFilterCompDetails,\r\n    _mergeDeep,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport { MultiFilter, getMultiFilterDefs } from './multiFilter';\r\n\r\nexport class MultiFloatingFilterComp extends Component implements IFloatingFilterComp<MultiFilter> {\r\n    private floatingFilters: IFloatingFilterComp[] = [];\r\n    private compDetailsList: UserCompDetails[] = [];\r\n    private params: IFloatingFilterParams<MultiFilter>;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-multi-floating-filter ag-floating-filter-input\"></div>`);\r\n    }\r\n\r\n    public init(params: IFloatingFilterParams<MultiFilter>): AgPromise<void> {\r\n        this.params = params;\r\n\r\n        const { compDetailsList } = this.getCompDetailsList(params);\r\n        return this.setParams(compDetailsList);\r\n    }\r\n\r\n    private setParams(compDetailsList: UserCompDetails[]): AgPromise<void> {\r\n        const floatingFilterPromises: AgPromise<IFloatingFilterComp>[] = [];\r\n\r\n        compDetailsList.forEach((compDetails) => {\r\n            const floatingFilterPromise = compDetails?.newAgStackInstance();\r\n\r\n            if (floatingFilterPromise != null) {\r\n                this.compDetailsList.push(compDetails!);\r\n                floatingFilterPromises.push(floatingFilterPromise);\r\n            }\r\n        });\r\n\r\n        return AgPromise.all(floatingFilterPromises).then((floatingFilters) => {\r\n            floatingFilters!.forEach((floatingFilter, index) => {\r\n                this.floatingFilters.push(floatingFilter!);\r\n\r\n                const gui = floatingFilter!.getGui();\r\n\r\n                this.appendChild(gui);\r\n\r\n                if (index > 0) {\r\n                    _setDisplayed(gui, false);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    public refresh(params: IFloatingFilterParams<MultiFilter>): void {\r\n        this.params = params;\r\n        const { compDetailsList: newCompDetailsList, floatingFilterParamsList } = this.getCompDetailsList(params);\r\n        const allFloatingFilterCompsUnchanged =\r\n            newCompDetailsList.length === this.compDetailsList.length &&\r\n            newCompDetailsList.every(\r\n                (newCompDetails, index) =>\r\n                    !this.beans.filterManager?.areFilterCompsDifferent(this.compDetailsList[index], newCompDetails)\r\n            );\r\n\r\n        if (allFloatingFilterCompsUnchanged) {\r\n            floatingFilterParamsList.forEach((floatingFilterParams, index) => {\r\n                const floatingFilter = this.floatingFilters[index] as IFloatingFilterComp<IFilter>;\r\n                floatingFilter.refresh?.(floatingFilterParams);\r\n            });\r\n        } else {\r\n            _clearElement(this.getGui());\r\n            this.destroyBeans(this.floatingFilters);\r\n            this.floatingFilters = [];\r\n            this.compDetailsList = [];\r\n            this.setParams(newCompDetailsList);\r\n        }\r\n    }\r\n\r\n    private getCompDetailsList(params: IFloatingFilterParams<MultiFilter>): {\r\n        compDetailsList: UserCompDetails[];\r\n        floatingFilterParamsList: IFloatingFilterParams<IFilter>[];\r\n    } {\r\n        const compDetailsList: UserCompDetails[] = [];\r\n        const floatingFilterParamsList: IFloatingFilterParams<IFilter>[] = [];\r\n        const filterParams = params.filterParams as MultiFilterParams;\r\n        const currentParentModel = params.currentParentModel;\r\n\r\n        getMultiFilterDefs(filterParams).forEach((filterDef, index) => {\r\n            const floatingFilterParams: IFloatingFilterParams<IFilter> = {\r\n                ...params,\r\n                // set the parent filter instance for each floating filter to the relevant child filter instance\r\n                parentFilterInstance: (callback) => {\r\n                    this.parentMultiFilterInstance((parent) => {\r\n                        const child = parent.getChildFilterInstance(index);\r\n                        if (child == null) {\r\n                            return;\r\n                        }\r\n\r\n                        callback(child);\r\n                    });\r\n                },\r\n                // return the parent model for the specific filter\r\n                currentParentModel: () => currentParentModel()?.filterModels?.[index] ?? null,\r\n            };\r\n            _mergeDeep(floatingFilterParams.filterParams, filterDef.filterParams);\r\n\r\n            const compDetails = this.getCompDetails(filterDef, floatingFilterParams);\r\n            if (compDetails) {\r\n                compDetailsList.push(compDetails);\r\n                floatingFilterParamsList.push(floatingFilterParams);\r\n            }\r\n        });\r\n        return { compDetailsList, floatingFilterParamsList };\r\n    }\r\n\r\n    public onParentModelChanged(model: IMultiFilterModel, event: FilterChangedEvent): void {\r\n        // We don't want to update the floating filter if the floating filter caused the change,\r\n        // because the UI is already in sync. if we didn't do this, the UI would behave strangely\r\n        // as it would be updating as the user is typing\r\n        if (event && event.afterFloatingFilter) {\r\n            return;\r\n        }\r\n\r\n        this.parentMultiFilterInstance((parent) => {\r\n            if (model == null) {\r\n                this.floatingFilters.forEach((filter, i) => {\r\n                    filter.onParentModelChanged(null, event);\r\n                    _setDisplayed(filter.getGui(), i === 0);\r\n                });\r\n            } else {\r\n                const lastActiveFloatingFilterIndex = parent.getLastActiveFilterIndex();\r\n\r\n                this.floatingFilters.forEach((filter, i) => {\r\n                    const filterModel = model.filterModels!.length > i ? model.filterModels![i] : null;\r\n\r\n                    filter.onParentModelChanged(filterModel, event);\r\n\r\n                    const shouldShow =\r\n                        lastActiveFloatingFilterIndex == null ? i === 0 : i === lastActiveFloatingFilterIndex;\r\n\r\n                    _setDisplayed(filter.getGui(), shouldShow);\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyBeans(this.floatingFilters);\r\n        this.floatingFilters.length = 0;\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    private getCompDetails(filterDef: IFilterDef, params: IFloatingFilterParams<IFilter>): UserCompDetails | undefined {\r\n        const { filterManager, frameworkOverrides, userCompFactory } = this.beans;\r\n        const defaultComponentName =\r\n            _getDefaultFloatingFilterType(frameworkOverrides, filterDef, () =>\r\n                filterManager!.getDefaultFloatingFilter(this.params.column as AgColumn)\r\n            ) ?? 'agReadOnlyFloatingFilter';\r\n\r\n        return _getFloatingFilterCompDetails(userCompFactory, filterDef, params, defaultComponentName);\r\n    }\r\n\r\n    private parentMultiFilterInstance(cb: (instance: MultiFilter) => void): void {\r\n        this.params.parentFilterInstance((parent) => {\r\n            if (!(parent instanceof MultiFilter)) {\r\n                _error(120);\r\n            }\r\n\r\n            cb(parent);\r\n        });\r\n    }\r\n}\r\n", "import type { _ModuleWithApi, _ModuleWithoutApi, _RowGroupingGridApi } from 'ag-grid-community';\r\nimport { _ColumnFilterModule, _PopupModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { AggregationModule, SharedAggregationModule } from '../aggregation/aggregationModule';\r\nimport {\r\n    ClientSideRowModelHierarchyModule,\r\n    GroupColumnModule,\r\n    StickyRowModule,\r\n} from '../rowHierarchy/rowHierarchyModule';\r\nimport { VERSION } from '../version';\r\nimport { AgGridHeaderDropZonesSelector } from './columnDropZones/agGridHeaderDropZones';\r\nimport { GroupFilter } from './groupFilter/groupFilter';\r\nimport { GroupFloatingFilterComp } from './groupFilter/groupFloatingFilter';\r\nimport { GroupHideOpenParentsService } from './groupHideOpenParentsService';\r\nimport { GroupStage } from './groupStage/groupStage';\r\nimport {\r\n    addRowGroupColumns,\r\n    getRowGroupColumns,\r\n    moveRowGroupColumn,\r\n    removeRowGroupColumns,\r\n    setRowGroupColumns,\r\n} from './rowGroupingApi';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const SharedRowGroupingModule: _ModuleWithApi<_RowGroupingGridApi> = {\r\n    moduleName: 'SharedRowGrouping',\r\n    version: VERSION,\r\n    beans: [GroupHideOpenParentsService],\r\n    apiFunctions: {\r\n        setRowGroupColumns,\r\n        removeRowGroupColumns,\r\n        addRowGroupColumns,\r\n        getRowGroupColumns,\r\n        moveRowGroupColumn,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, SharedAggregationModule, GroupColumnModule, StickyRowModule],\r\n};\r\n\r\n/**\r\n * @feature Row Grouping\r\n * @colDef enableRowGroup, rowGroup, rowGroupIndex\r\n */\r\nexport const RowGroupingModule: _ModuleWithoutApi = {\r\n    moduleName: 'RowGrouping',\r\n    version: VERSION,\r\n    beans: [GroupStage],\r\n    rowModels: ['clientSide'],\r\n    dependsOn: [SharedRowGroupingModule, AggregationModule, ClientSideRowModelHierarchyModule],\r\n};\r\n\r\n/**\r\n * @feature Row Grouping -> Row Group Panel\r\n */\r\nexport const RowGroupingPanelModule: _ModuleWithoutApi = {\r\n    moduleName: 'RowGroupingPanel',\r\n    version: VERSION,\r\n    selectors: [AgGridHeaderDropZonesSelector],\r\n    icons: {\r\n        // identifies the pivot drop zone\r\n        pivotPanel: 'pivot',\r\n        // \"Row groups\" drop zone in column tool panel\r\n        rowGroupPanel: 'group',\r\n        // separator between column 'pills' when you add multiple columns to the header drop zone\r\n        panelDelimiter: 'small-right',\r\n        // version of panelDelimiter used in RTL mode\r\n        panelDelimiterRtl: 'small-left',\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _PopupModule],\r\n};\r\n\r\n/**\r\n * @feature Row Grouping -> Filtering\r\n */\r\nexport const GroupFilterModule: _ModuleWithoutApi = {\r\n    moduleName: 'GroupFilter',\r\n    version: VERSION,\r\n    userComponents: { agGroupColumnFilter: GroupFilter, agGroupColumnFloatingFilter: GroupFloatingFilterComp },\r\n    dependsOn: [EnterpriseCoreModule, _ColumnFilterModule],\r\n};\r\n", "import type { AgColumn, IAggColumnNameService, IAggFunc, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub, _exists } from 'ag-grid-community';\r\n\r\nexport class AggColumnNameService extends BeanStub implements NamedBean, IAggColumnNameService {\r\n    beanName = 'aggColNameSvc' as const;\r\n\r\n    public getHeaderName(column: AgColumn, headerName: string | null): string | null {\r\n        if (this.gos.get('suppressAggFuncInHeader')) {\r\n            return headerName;\r\n        }\r\n\r\n        const { valueColsSvc, colModel, rowGroupColsSvc } = this.beans;\r\n\r\n        // only columns with aggregation active can have aggregations\r\n        const pivotValueColumn = column.getColDef().pivotValueColumn;\r\n        const pivotActiveOnThisColumn = _exists(pivotValueColumn);\r\n        let aggFunc: string | IAggFunc | null | undefined = null;\r\n        let aggFuncFound: boolean;\r\n\r\n        // otherwise we have a measure that is active, and we are doing aggregation on it\r\n        if (pivotActiveOnThisColumn) {\r\n            const valueColumns = valueColsSvc?.columns ?? [];\r\n            const isCollapsedHeaderEnabled =\r\n                this.gos.get('removePivotHeaderRowWhenSingleValueColumn') && valueColumns.length === 1;\r\n            const isTotalColumn = column.getColDef().pivotTotalColumnIds !== undefined;\r\n            if (isCollapsedHeaderEnabled && !isTotalColumn) {\r\n                return headerName; // Skip decorating the header - in this case the label is the pivot key, not the value col\r\n            }\r\n            aggFunc = pivotValueColumn ? pivotValueColumn.getAggFunc() : null;\r\n            aggFuncFound = true;\r\n        } else {\r\n            const measureActive = column.isValueActive();\r\n            const aggregationPresent = colModel.isPivotMode() || rowGroupColsSvc?.columns.length !== 0;\r\n\r\n            if (measureActive && aggregationPresent) {\r\n                aggFunc = column.getAggFunc();\r\n                aggFuncFound = true;\r\n            } else {\r\n                aggFuncFound = false;\r\n            }\r\n        }\r\n\r\n        if (aggFuncFound) {\r\n            const aggFuncString = typeof aggFunc === 'string' ? aggFunc : 'func';\r\n            const localeTextFunc = this.getLocaleTextFunc();\r\n            const aggFuncStringTranslated = localeTextFunc(aggFuncString, aggFuncString);\r\n            return `${aggFuncStringTranslated}(${headerName})`;\r\n        }\r\n\r\n        return headerName;\r\n    }\r\n}\r\n", "import type { AgColumn, IAggFunc, IAggFuncParams, IAggFuncService, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub, _exists, _last } from 'ag-grid-community';\r\n\r\nconst defaultAggFuncNames = {\r\n    sum: 'Sum',\r\n    first: 'First',\r\n    last: 'Last',\r\n    min: 'Min',\r\n    max: 'Max',\r\n    count: 'Count',\r\n    avg: 'Average',\r\n} as const;\r\ntype DefaultAggFuncName = keyof typeof defaultAggFuncNames;\r\n\r\nexport class AggFuncService extends BeanStub implements NamedBean, IAggFuncService {\r\n    beanName = 'aggFuncSvc' as const;\r\n\r\n    private aggFuncsMap: { [key in string]: IAggFunc } = {};\r\n    private initialised = false;\r\n\r\n    public postConstruct(): void {\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        if (this.initialised) {\r\n            return;\r\n        }\r\n\r\n        this.initialiseWithDefaultAggregations();\r\n        this.addAggFuncs(this.gos.get('aggFuncs'));\r\n    }\r\n\r\n    private initialiseWithDefaultAggregations(): void {\r\n        const aggMap = this.aggFuncsMap as { [key in DefaultAggFuncName]: IAggFunc };\r\n        aggMap['sum'] = aggSum;\r\n        aggMap['first'] = aggFirst;\r\n        aggMap['last'] = aggLast;\r\n        aggMap['min'] = aggMin;\r\n        aggMap['max'] = aggMax;\r\n        aggMap['count'] = aggCount;\r\n        aggMap['avg'] = aggAvg;\r\n        this.initialised = true;\r\n    }\r\n\r\n    private isAggFuncPossible(column: AgColumn, func: string): boolean {\r\n        const allKeys = this.getFuncNames(column);\r\n        const allowed = allKeys.includes(func);\r\n        const funcExists = _exists(this.aggFuncsMap[func]);\r\n        return allowed && funcExists;\r\n    }\r\n\r\n    public getDefaultFuncLabel(fctName: DefaultAggFuncName): string {\r\n        return defaultAggFuncNames[fctName] ?? fctName;\r\n    }\r\n\r\n    public getDefaultAggFunc(column: AgColumn): string | null {\r\n        const defaultAgg = column.getColDef().defaultAggFunc;\r\n\r\n        if (_exists(defaultAgg) && this.isAggFuncPossible(column, defaultAgg)) {\r\n            return defaultAgg;\r\n        }\r\n\r\n        if (this.isAggFuncPossible(column, 'sum')) {\r\n            return 'sum';\r\n        }\r\n\r\n        const allKeys = this.getFuncNames(column);\r\n        return allKeys?.length ? allKeys[0] : null;\r\n    }\r\n\r\n    public addAggFuncs(aggFuncs?: { [key: string]: IAggFunc }): void {\r\n        this.init();\r\n        if (!aggFuncs) {\r\n            return;\r\n        }\r\n        Object.entries(aggFuncs).forEach(([key, aggFunc]) => {\r\n            this.aggFuncsMap[key] = aggFunc;\r\n        });\r\n    }\r\n\r\n    public getAggFunc(name: string): IAggFunc {\r\n        this.init();\r\n        return this.aggFuncsMap[name];\r\n    }\r\n\r\n    public getFuncNames(column: AgColumn): string[] {\r\n        const userAllowedFuncs = column.getColDef().allowedAggFuncs;\r\n\r\n        return userAllowedFuncs == null ? Object.keys(this.aggFuncsMap).sort() : userAllowedFuncs;\r\n    }\r\n\r\n    public clear(): void {\r\n        this.aggFuncsMap = {};\r\n    }\r\n}\r\n\r\nfunction aggSum(params: IAggFuncParams): number | bigint {\r\n    const { values } = params;\r\n    let result: any = null; // the logic ensures that we never combine bigint arithmetic with numbers, but TS is hard to please\r\n\r\n    // for optimum performance, we use a for loop here rather than calling any helper methods or using functional code\r\n    for (let i = 0; i < values.length; i++) {\r\n        const value = values[i];\r\n\r\n        if (typeof value === 'number') {\r\n            if (result === null) {\r\n                result = value;\r\n            } else {\r\n                result += typeof result === 'number' ? value : BigInt(value);\r\n            }\r\n        } else if (typeof value === 'bigint') {\r\n            if (result === null) {\r\n                result = value;\r\n            } else {\r\n                result = (typeof result === 'bigint' ? result : BigInt(result)) + value;\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction aggFirst(params: IAggFuncParams): any {\r\n    return params.values.length > 0 ? params.values[0] : null;\r\n}\r\n\r\nfunction aggLast(params: IAggFuncParams): any {\r\n    return params.values.length > 0 ? _last(params.values) : null;\r\n}\r\n\r\nfunction aggMin(params: IAggFuncParams): number | bigint | null {\r\n    const { values } = params;\r\n    let result: number | bigint | null = null;\r\n\r\n    // for optimum performance, we use a for loop here rather than calling any helper methods or using functional code\r\n    for (let i = 0; i < values.length; i++) {\r\n        const value = values[i];\r\n\r\n        if ((typeof value === 'number' || typeof value === 'bigint') && (result === null || result > value)) {\r\n            result = value;\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction aggMax(params: IAggFuncParams): number | bigint | null {\r\n    const { values } = params;\r\n    let result: number | bigint | null = null;\r\n\r\n    // for optimum performance, we use a for loop here rather than calling any helper methods or using functional code\r\n    for (let i = 0; i < values.length; i++) {\r\n        const value = values[i];\r\n\r\n        if ((typeof value === 'number' || typeof value === 'bigint') && (result === null || result < value)) {\r\n            result = value;\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction aggCount(params: IAggFuncParams) {\r\n    const { values } = params;\r\n    let result = 0;\r\n\r\n    // for optimum performance, we use a for loop here rather than calling any helper methods or using functional code\r\n    for (let i = 0; i < values.length; i++) {\r\n        const value = values[i];\r\n\r\n        // check if the value is from a group, in which case use the group's count\r\n        result += value != null && typeof value.value === 'number' ? value.value : 1;\r\n    }\r\n\r\n    // the previous aggregation data\r\n    const existingAggData = params.rowNode?.aggData?.[params.column.getColId()];\r\n    if (existingAggData && existingAggData.value === result) {\r\n        // the underlying values haven't changed, return the old object to avoid triggering change detection\r\n        return existingAggData;\r\n    }\r\n\r\n    // it's important to wrap it in the object so we can determine if this is a group level\r\n    return {\r\n        value: result,\r\n        toString: function () {\r\n            return this.value.toString();\r\n        },\r\n        // used for sorting\r\n        toNumber: function () {\r\n            return this.value;\r\n        },\r\n    };\r\n}\r\n\r\n// the average function is tricky as the multiple levels require weighted averages\r\n// for the non-leaf node aggregations.\r\nfunction aggAvg(params: IAggFuncParams): {\r\n    value: number | bigint | null;\r\n    count: number;\r\n    toString(): string;\r\n    toNumber(): number;\r\n} {\r\n    const { values } = params;\r\n    let sum: any = 0; // the logic ensures that we never combine bigint arithmetic with numbers, but TS is hard to please\r\n    let count = 0;\r\n\r\n    // for optimum performance, we use a for loop here rather than calling any helper methods or using functional code\r\n    for (let i = 0; i < values.length; i++) {\r\n        const currentValue = values[i];\r\n        let valueToAdd: number | bigint | null = null;\r\n\r\n        if (typeof currentValue === 'number' || typeof currentValue === 'bigint') {\r\n            valueToAdd = currentValue;\r\n            count++;\r\n        } else if (\r\n            currentValue != null &&\r\n            (typeof currentValue.value === 'number' || typeof currentValue.value === 'bigint') &&\r\n            typeof currentValue.count === 'number'\r\n        ) {\r\n            // we are aggregating groups, so we take the aggregated values to calculated a weighted average\r\n            valueToAdd =\r\n                currentValue.value *\r\n                (typeof currentValue.value === 'number' ? currentValue.count : BigInt(currentValue.count));\r\n            count += currentValue.count;\r\n        }\r\n\r\n        if (typeof valueToAdd === 'number') {\r\n            sum += typeof sum === 'number' ? valueToAdd : BigInt(valueToAdd);\r\n        } else if (typeof valueToAdd === 'bigint') {\r\n            sum = (typeof sum === 'bigint' ? sum : BigInt(sum)) + valueToAdd;\r\n        }\r\n    }\r\n\r\n    let value: null | number = null;\r\n\r\n    // avoid divide by zero error\r\n    if (count > 0) {\r\n        value = sum / ((typeof sum === 'number' ? count : BigInt(count)) as any);\r\n    }\r\n\r\n    // the previous aggregation data\r\n    const existingAggData = params.rowNode?.aggData?.[params.column?.getColId()];\r\n    if (existingAggData && existingAggData.count === count && existingAggData.value === value) {\r\n        // the underlying values haven't changed, return the old object to avoid triggering change detection\r\n        return existingAggData;\r\n    }\r\n\r\n    // the result will be an object. when this cell is rendered, only the avg is shown.\r\n    // however when this cell is part of another aggregation, the count is also needed\r\n    // to create a weighted average for the next level.\r\n    return {\r\n        count,\r\n        value,\r\n        // the grid by default uses toString to render values for an object, so this\r\n        // is a trick to get the default cellRenderer to display the avg value\r\n        toString: function () {\r\n            return typeof this.value === 'number' || typeof this.value === 'bigint' ? this.value.toString() : '';\r\n        },\r\n        // used for sorting\r\n        toNumber: function () {\r\n            return this.value as any;\r\n        },\r\n    };\r\n}\r\n", "import type { BeanCollection, ColDef, Column, IAggFunc } from 'ag-grid-community';\r\n\r\nimport type { ValueColsSvc } from './valueColsSvc';\r\n\r\nexport function addAggFuncs(beans: BeanCollection, aggFuncs: { [key: string]: IAggFunc }): void {\r\n    if (beans.aggFuncSvc) {\r\n        beans.aggFuncSvc.addAggFuncs(aggFuncs);\r\n    }\r\n}\r\n\r\nexport function clearAggFuncs(beans: BeanCollection): void {\r\n    if (beans.aggFuncSvc) {\r\n        beans.aggFuncSvc.clear();\r\n    }\r\n}\r\n\r\nexport function setColumnAggFunc(\r\n    beans: BeanCollection,\r\n    key: string | ColDef | Column,\r\n    aggFunc: string | IAggFunc | null | undefined\r\n): void {\r\n    (beans.valueColsSvc as ValueColsSvc)?.setColumnAggFunc?.(key, aggFunc, 'api');\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    ChangedPath,\r\n    ClientSideRowModelStage,\r\n    ColumnModel,\r\n    GetGroupRowAggParams,\r\n    GridOptions,\r\n    IAggFunc,\r\n    IAggFuncParams,\r\n    IColsService,\r\n    IPivotResultColsService,\r\n    IRowNodeStage,\r\n    NamedBean,\r\n    RowNode,\r\n    StageExecuteParams,\r\n    ValueService,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _error, _getGrandTotalRow, _getGroupAggFiltering } from 'ag-grid-community';\r\n\r\nimport type { AggFuncService } from './aggFuncService';\r\n\r\ninterface AggregationDetails {\r\n    alwaysAggregateAtRootLevel: boolean;\r\n    groupIncludeTotalFooter: boolean;\r\n    changedPath: ChangedPath;\r\n    valueColumns: AgColumn[];\r\n    pivotColumns: AgColumn[];\r\n    filteredOnly: boolean;\r\n    userAggFunc: ((params: WithoutGridCommon<GetGroupRowAggParams<any, any>>) => any) | undefined;\r\n}\r\n\r\nexport class AggregationStage extends BeanStub implements NamedBean, IRowNodeStage {\r\n    beanName = 'aggStage' as const;\r\n\r\n    public refreshProps: Set<keyof GridOptions<any>> = new Set([\r\n        'getGroupRowAgg',\r\n        'alwaysAggregateAtRootLevel',\r\n        'suppressAggFilteredOnly',\r\n        'grandTotalRow',\r\n    ]);\r\n    public step: ClientSideRowModelStage = 'aggregate';\r\n\r\n    private colModel: ColumnModel;\r\n    private valueSvc: ValueService;\r\n    private aggFuncSvc: AggFuncService;\r\n    private pivotColsSvc?: IColsService;\r\n    private valueColsSvc?: IColsService;\r\n    private pivotResultCols?: IPivotResultColsService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n        this.aggFuncSvc = beans.aggFuncSvc as AggFuncService;\r\n        this.pivotColsSvc = beans.pivotColsSvc;\r\n        this.valueColsSvc = beans.valueColsSvc;\r\n        this.pivotResultCols = beans.pivotResultCols;\r\n        this.valueSvc = beans.valueSvc;\r\n    }\r\n\r\n    // it's possible to recompute the aggregate without doing the other parts\r\n    // + api.refreshClientSideRowModel('aggregate')\r\n    public execute(params: StageExecuteParams): any {\r\n        // if changed path is active, it means we came from a) change detection or b) transaction update.\r\n        // for both of these, if no value columns are present, it means there is nothing to aggregate now\r\n        // and there is no cleanup to be done (as value columns don't change between transactions or change\r\n        // detections). if no value columns and no changed path, means we have to go through all nodes in\r\n        // case we need to clean up agg data from before.\r\n        const noValueColumns = !this.valueColsSvc?.columns?.length;\r\n        const noUserAgg = !this.gos.getCallback('getGroupRowAgg');\r\n        if (noValueColumns && noUserAgg && params.changedPath?.active) {\r\n            return;\r\n        }\r\n\r\n        const aggDetails = this.createAggDetails(params);\r\n\r\n        this.recursivelyCreateAggData(aggDetails);\r\n    }\r\n\r\n    private createAggDetails(params: StageExecuteParams): AggregationDetails {\r\n        const pivotActive = this.colModel.isPivotActive();\r\n\r\n        const measureColumns = this.valueColsSvc?.columns;\r\n        const pivotColumns = pivotActive && this.pivotColsSvc ? this.pivotColsSvc.columns : [];\r\n\r\n        const aggDetails: AggregationDetails = {\r\n            alwaysAggregateAtRootLevel: this.gos.get('alwaysAggregateAtRootLevel'),\r\n            groupIncludeTotalFooter: !!_getGrandTotalRow(this.gos),\r\n            changedPath: params.changedPath!,\r\n            valueColumns: measureColumns ?? [],\r\n            pivotColumns: pivotColumns,\r\n            filteredOnly: !this.isSuppressAggFilteredOnly(),\r\n            userAggFunc: this.gos.getCallback('getGroupRowAgg') as any,\r\n        };\r\n\r\n        return aggDetails;\r\n    }\r\n\r\n    private isSuppressAggFilteredOnly() {\r\n        const isGroupAggFiltering = _getGroupAggFiltering(this.gos) !== undefined;\r\n        return isGroupAggFiltering || this.gos.get('suppressAggFilteredOnly');\r\n    }\r\n\r\n    private recursivelyCreateAggData(aggDetails: AggregationDetails) {\r\n        const callback = (rowNode: RowNode) => {\r\n            const hasNoChildren = !rowNode.hasChildren();\r\n            if (hasNoChildren) {\r\n                // this check is needed for TreeData, in case the node is no longer a child,\r\n                // but it was a child previously.\r\n                if (rowNode.aggData) {\r\n                    this.setAggData(rowNode, null);\r\n                }\r\n                // never agg data for leaf nodes\r\n                return;\r\n            }\r\n\r\n            //Optionally enable the aggregation at the root Node\r\n            const isRootNode = rowNode.level === -1;\r\n            // if total footer is displayed, the value is in use\r\n            if (isRootNode && !aggDetails.groupIncludeTotalFooter) {\r\n                const notPivoting = !this.colModel.isPivotMode();\r\n                if (!aggDetails.alwaysAggregateAtRootLevel && notPivoting) {\r\n                    this.setAggData(rowNode, null);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            this.aggregateRowNode(rowNode, aggDetails);\r\n        };\r\n\r\n        aggDetails.changedPath.forEachChangedNodeDepthFirst(callback, true);\r\n    }\r\n\r\n    private aggregateRowNode(rowNode: RowNode, aggDetails: AggregationDetails): void {\r\n        const measureColumnsMissing = aggDetails.valueColumns.length === 0;\r\n        const pivotColumnsMissing = aggDetails.pivotColumns.length === 0;\r\n\r\n        let aggResult: any;\r\n        if (aggDetails.userAggFunc) {\r\n            aggResult = aggDetails.userAggFunc({ nodes: rowNode.childrenAfterFilter! });\r\n        } else if (measureColumnsMissing) {\r\n            aggResult = null;\r\n        } else if (pivotColumnsMissing) {\r\n            aggResult = this.aggregateRowNodeUsingValuesOnly(rowNode, aggDetails);\r\n        } else {\r\n            aggResult = this.aggregateRowNodeUsingValuesAndPivot(rowNode);\r\n        }\r\n\r\n        this.setAggData(rowNode, aggResult);\r\n\r\n        // if we are grouping, then it's possible there is a sibling footer\r\n        // to the group, so update the data here also if there is one\r\n        if (rowNode.sibling) {\r\n            this.setAggData(rowNode.sibling, aggResult);\r\n        }\r\n    }\r\n\r\n    private aggregateRowNodeUsingValuesAndPivot(rowNode: RowNode): any {\r\n        const result: any = {};\r\n\r\n        const secondaryColumns = this.pivotResultCols?.getPivotResultCols()?.list ?? [];\r\n        let canSkipTotalColumns = true;\r\n        for (let i = 0; i < secondaryColumns.length; i++) {\r\n            const secondaryCol = secondaryColumns[i];\r\n            const colDef = secondaryCol.getColDef();\r\n\r\n            if (colDef.pivotTotalColumnIds != null) {\r\n                canSkipTotalColumns = false;\r\n                continue;\r\n            }\r\n\r\n            const keys: string[] = colDef.pivotKeys ?? [];\r\n            let values: any[];\r\n\r\n            if (rowNode.leafGroup) {\r\n                // lowest level group, get the values from the mapped set\r\n                values = this.getValuesFromMappedSet(rowNode.childrenMapped, keys, colDef.pivotValueColumn as AgColumn);\r\n            } else {\r\n                // value columns and pivot columns, non-leaf group\r\n                values = this.getValuesPivotNonLeaf(rowNode, colDef.colId!);\r\n            }\r\n\r\n            // bit of a memory drain storing null/undefined, but seems to speed up performance.\r\n            result[colDef.colId!] = this.aggregateValues(\r\n                values,\r\n                colDef.pivotValueColumn!.getAggFunc()!,\r\n                colDef.pivotValueColumn as AgColumn,\r\n                rowNode,\r\n                secondaryCol\r\n            );\r\n        }\r\n\r\n        if (!canSkipTotalColumns) {\r\n            for (let i = 0; i < secondaryColumns.length; i++) {\r\n                const secondaryCol = secondaryColumns[i];\r\n                const colDef = secondaryCol.getColDef();\r\n\r\n                if (colDef.pivotTotalColumnIds == null || !colDef.pivotTotalColumnIds.length) {\r\n                    continue;\r\n                }\r\n\r\n                const aggResults: any[] = colDef.pivotTotalColumnIds.map(\r\n                    (currentColId: string) => result[currentColId]\r\n                );\r\n                // bit of a memory drain storing null/undefined, but seems to speed up performance.\r\n                result[colDef.colId!] = this.aggregateValues(\r\n                    aggResults,\r\n                    colDef.pivotValueColumn!.getAggFunc()!,\r\n                    colDef.pivotValueColumn as AgColumn,\r\n                    rowNode,\r\n                    secondaryCol\r\n                );\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private aggregateRowNodeUsingValuesOnly(rowNode: RowNode, aggDetails: AggregationDetails): any {\r\n        const result: any = {};\r\n\r\n        const { changedPath, valueColumns, filteredOnly } = aggDetails;\r\n\r\n        const changedValueColumns = changedPath.active\r\n            ? changedPath.getValueColumnsForNode(rowNode, valueColumns)\r\n            : valueColumns;\r\n\r\n        const notChangedValueColumns = changedPath.active\r\n            ? changedPath.getNotValueColumnsForNode(rowNode, valueColumns)\r\n            : null;\r\n\r\n        const values2d = this.getValuesNormal(rowNode, changedValueColumns, filteredOnly);\r\n        const oldValues = rowNode.aggData;\r\n\r\n        changedValueColumns.forEach((valueColumn, index) => {\r\n            result[valueColumn.getId()] = this.aggregateValues(\r\n                values2d[index],\r\n                valueColumn.getAggFunc()!,\r\n                valueColumn,\r\n                rowNode\r\n            );\r\n        });\r\n\r\n        if (notChangedValueColumns && oldValues) {\r\n            notChangedValueColumns.forEach((valueColumn) => {\r\n                result[valueColumn.getId()] = oldValues[valueColumn.getId()];\r\n            });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private getValuesPivotNonLeaf(rowNode: RowNode, colId: string): any[] {\r\n        return rowNode.childrenAfterFilter!.map((childNode: RowNode) => childNode.aggData[colId]);\r\n    }\r\n\r\n    private getValuesFromMappedSet(mappedSet: any, keys: string[], valueColumn: AgColumn): any[] {\r\n        let mapPointer = mappedSet;\r\n        for (let i = 0; i < keys.length; i++) {\r\n            const key = keys[i];\r\n            mapPointer = mapPointer ? mapPointer[key] : null;\r\n        }\r\n\r\n        if (!mapPointer) {\r\n            return [];\r\n        }\r\n\r\n        return mapPointer.map((rowNode: RowNode) => this.valueSvc.getValue(valueColumn, rowNode));\r\n    }\r\n\r\n    private getValuesNormal(rowNode: RowNode, valueColumns: AgColumn[], filteredOnly: boolean): any[][] {\r\n        // create 2d array, of all values for all valueColumns\r\n        const values: any[][] = [];\r\n        valueColumns.forEach(() => values.push([]));\r\n\r\n        const valueColumnCount = valueColumns.length;\r\n\r\n        const nodeList = filteredOnly ? rowNode.childrenAfterFilter : rowNode.childrenAfterGroup;\r\n        const rowCount = nodeList!.length;\r\n\r\n        for (let i = 0; i < rowCount; i++) {\r\n            const childNode = nodeList![i];\r\n            for (let j = 0; j < valueColumnCount; j++) {\r\n                const valueColumn = valueColumns[j];\r\n                // if the row is a group, then it will only have an agg result value,\r\n                // which means valueGetter is never used.\r\n                const value = this.valueSvc.getValue(valueColumn, childNode);\r\n                values[j].push(value);\r\n            }\r\n        }\r\n\r\n        return values;\r\n    }\r\n\r\n    public aggregateValues(\r\n        values: any[],\r\n        aggFuncOrString: string | IAggFunc,\r\n        column?: AgColumn,\r\n        rowNode?: RowNode,\r\n        pivotResultColumn?: AgColumn\r\n    ): any {\r\n        const aggFunc =\r\n            typeof aggFuncOrString === 'string' ? this.aggFuncSvc.getAggFunc(aggFuncOrString) : aggFuncOrString;\r\n\r\n        if (typeof aggFunc !== 'function') {\r\n            _error(109, { aggFuncOrString });\r\n            return null;\r\n        }\r\n\r\n        const aggFuncAny = aggFunc;\r\n        const params: IAggFuncParams = this.gos.addGridCommonParams({\r\n            values: values,\r\n            column: column,\r\n            colDef: column ? column.getColDef() : undefined,\r\n            pivotResultColumn: pivotResultColumn,\r\n            rowNode: rowNode,\r\n            data: rowNode ? rowNode.data : undefined,\r\n        } as any); // the \"as any\" is needed to allow the deprecation warning messages\r\n\r\n        return aggFuncAny(params);\r\n    }\r\n\r\n    private setAggData(rowNode: RowNode, newAggData: any): void {\r\n        const oldAggData = rowNode.aggData;\r\n        rowNode.aggData = newAggData;\r\n\r\n        // if no event service, nobody has registered for events, so no need fire event\r\n        if (rowNode.__localEventService) {\r\n            const eventFunc = (colId: string) => {\r\n                const value = rowNode.aggData ? rowNode.aggData[colId] : undefined;\r\n                const oldValue = oldAggData ? oldAggData[colId] : undefined;\r\n\r\n                if (value === oldValue) {\r\n                    return;\r\n                }\r\n\r\n                // do a quick lookup - despite the event it's possible the column no longer exists\r\n                const column = this.colModel.getCol(colId)!;\r\n                if (!column) {\r\n                    return;\r\n                }\r\n\r\n                rowNode.dispatchCellChangedEvent(column, value, oldValue);\r\n            };\r\n\r\n            if (oldAggData) {\r\n                for (const key of Object.keys(oldAggData)) {\r\n                    eventFunc(key); // raise for old keys\r\n                }\r\n            }\r\n            if (newAggData) {\r\n                for (const key of Object.keys(newAggData)) {\r\n                    if (!oldAggData || !(key in oldAggData)) {\r\n                        eventFunc(key); // new key, event not yet raised\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    ClientSideRowModelStage,\r\n    FilterManager,\r\n    GridOptions,\r\n    IRowNodeStage,\r\n    NamedBean,\r\n    RowNode,\r\n    StageExecuteParams,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _getGroupAggFiltering } from 'ag-grid-community';\r\n\r\nexport class FilterAggregatesStage extends BeanStub implements NamedBean, IRowNodeStage {\r\n    beanName = 'filterAggStage' as const;\r\n\r\n    public refreshProps: Set<keyof GridOptions<any>> = new Set([]);\r\n    public step: ClientSideRowModelStage = 'filter_aggregates';\r\n\r\n    private filterManager?: FilterManager;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.filterManager = beans.filterManager;\r\n    }\r\n\r\n    public execute(params: StageExecuteParams): void {\r\n        const isPivotMode = this.beans.colModel.isPivotMode();\r\n        const isAggFilterActive =\r\n            this.filterManager?.isAggregateFilterPresent() || this.filterManager?.isAggregateQuickFilterPresent();\r\n\r\n        // This is the default filter for applying only to leaf nodes, realistically this should not apply as primary agg columns,\r\n        // should not be applied by the filterManager if getGroupAggFiltering is missing. Predicate will apply filters to leaf level.\r\n        const defaultPrimaryColumnPredicate = (params: { node: RowNode }) => !params.node.group;\r\n\r\n        // Default secondary column predicate, selecting only leaf level groups.\r\n        const defaultSecondaryColumnPredicate = (params: { node: RowNode }) => params.node.leafGroup;\r\n\r\n        // The predicate to determine whether filters should apply to this row. Either defined by the user in groupAggFiltering or a default depending\r\n        // on current pivot mode status.\r\n        const applyFilterToNode =\r\n            _getGroupAggFiltering(this.gos) ||\r\n            (isPivotMode ? defaultSecondaryColumnPredicate : defaultPrimaryColumnPredicate);\r\n\r\n        const { changedPath } = params;\r\n\r\n        const preserveChildren = (node: RowNode, recursive = false) => {\r\n            if (node.childrenAfterFilter) {\r\n                node.childrenAfterAggFilter = node.childrenAfterFilter;\r\n                if (recursive) {\r\n                    node.childrenAfterAggFilter.forEach((child) => preserveChildren(child, recursive));\r\n                }\r\n                this.setAllChildrenCount(node);\r\n            }\r\n\r\n            if (node.sibling) {\r\n                node.sibling.childrenAfterAggFilter = node.childrenAfterAggFilter;\r\n            }\r\n        };\r\n\r\n        const filterChildren = (node: RowNode) => {\r\n            node.childrenAfterAggFilter =\r\n                node.childrenAfterFilter?.filter((child: RowNode) => {\r\n                    const shouldFilterRow = applyFilterToNode({ node: child });\r\n                    if (shouldFilterRow) {\r\n                        const doesNodePassFilter = this.filterManager!.doesRowPassAggregateFilters({ rowNode: child });\r\n                        if (doesNodePassFilter) {\r\n                            // Node has passed, so preserve children\r\n                            preserveChildren(child, true);\r\n                            return true;\r\n                        }\r\n                    }\r\n                    const hasChildPassed = child.childrenAfterAggFilter?.length;\r\n                    return hasChildPassed;\r\n                }) || null;\r\n\r\n            this.setAllChildrenCount(node);\r\n            if (node.sibling) {\r\n                node.sibling.childrenAfterAggFilter = node.childrenAfterAggFilter;\r\n            }\r\n        };\r\n\r\n        changedPath!.forEachChangedNodeDepthFirst(isAggFilterActive ? filterChildren : preserveChildren, true);\r\n    }\r\n\r\n    /** for tree data, we include all children, groups and leafs */\r\n    private setAllChildrenCountTreeData(rowNode: RowNode): void {\r\n        const childrenAfterAggFilter = rowNode.childrenAfterAggFilter;\r\n        let allChildrenCount = 0;\r\n        if (childrenAfterAggFilter) {\r\n            const length = childrenAfterAggFilter.length;\r\n            allChildrenCount = length; // include direct children too\r\n            for (let i = 0; i < length; ++i) {\r\n                allChildrenCount += childrenAfterAggFilter[i].allChildrenCount ?? 0; // include children of children\r\n            }\r\n        }\r\n        rowNode.setAllChildrenCount(\r\n            // Maintain the historical behaviour:\r\n            // - allChildrenCount is 0 in the root if there are no children\r\n            // - allChildrenCount is null in any non-root row if there are no children\r\n            allChildrenCount === 0 && rowNode.level >= 0 ? null : allChildrenCount\r\n        );\r\n    }\r\n\r\n    /* for grid data, we only count the leafs */\r\n    private setAllChildrenCountGridGrouping(rowNode: RowNode) {\r\n        let allChildrenCount = 0;\r\n        rowNode.childrenAfterAggFilter!.forEach((child: RowNode) => {\r\n            if (child.group) {\r\n                allChildrenCount += child.allChildrenCount as any;\r\n            } else {\r\n                allChildrenCount++;\r\n            }\r\n        });\r\n        rowNode.setAllChildrenCount(allChildrenCount);\r\n    }\r\n\r\n    private setAllChildrenCount(rowNode: RowNode) {\r\n        if (!rowNode.hasChildren()) {\r\n            rowNode.setAllChildrenCount(null);\r\n            return;\r\n        }\r\n\r\n        if (this.gos.get('treeData')) {\r\n            this.setAllChildrenCountTreeData(rowNode);\r\n        } else {\r\n            this.setAllChildrenCountGridGrouping(rowNode);\r\n        }\r\n    }\r\n}\r\n", "import type { IFooterService, NamedBean, RowNode } from 'ag-grid-community';\r\nimport { BeanStub, _getGrandTotalRow, _getGroupTotalRowCallback } from 'ag-grid-community';\r\n\r\nimport { _createRowNodeFooter } from './footerUtils';\r\n\r\nexport class FooterService extends BeanStub implements NamedBean, IFooterService {\r\n    beanName = 'footerSvc' as const;\r\n\r\n    public addNodes(\r\n        params: {\r\n            index: number;\r\n        },\r\n        nodes: RowNode[],\r\n        callback: (node: RowNode, index: number) => void,\r\n        includeFooterNodes: boolean,\r\n        rootNode: RowNode | null,\r\n        position: 'top' | 'bottom'\r\n    ): void {\r\n        const parentNode = nodes[0]?.parent;\r\n\r\n        if (!parentNode) return;\r\n\r\n        let { index } = params;\r\n\r\n        const grandTotal = includeFooterNodes && _getGrandTotalRow(this.gos);\r\n        const isGroupIncludeFooter = _getGroupTotalRowCallback(this.gos);\r\n        const groupTotal = includeFooterNodes && isGroupIncludeFooter({ node: parentNode });\r\n\r\n        const isRootNode = parentNode === rootNode;\r\n        if (isRootNode) {\r\n            if (grandTotal === position) {\r\n                _createRowNodeFooter(parentNode, this.beans);\r\n                callback(parentNode.sibling, index++);\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (groupTotal === position) {\r\n            _createRowNodeFooter(parentNode, this.beans);\r\n            callback(parentNode.sibling, index++);\r\n        }\r\n    }\r\n\r\n    public getTopDisplayIndex(\r\n        rowsToDisplay: RowNode[],\r\n        topLevelIndex: number,\r\n        childrenAfterSort: RowNode[],\r\n        getDefaultIndex: (adjustedIndex: number) => number\r\n    ): number {\r\n        let adjustedIndex = topLevelIndex;\r\n        if (rowsToDisplay[0].footer) {\r\n            // if footer is first displayed row and looking for first row, return footer\r\n            if (topLevelIndex === 0) {\r\n                return 0;\r\n            }\r\n\r\n            // if first row is footer, offset index to check sorted rows by 1\r\n            adjustedIndex -= 1;\r\n        }\r\n\r\n        const lastRow = rowsToDisplay[rowsToDisplay.length - 1];\r\n        const indexOutsideGroupBounds = adjustedIndex >= childrenAfterSort.length;\r\n        // if last row is footer, and attempting to retrieve row of too high index, return footer row index\r\n        if (lastRow.footer && indexOutsideGroupBounds) {\r\n            return lastRow.rowIndex!;\r\n        }\r\n\r\n        return getDefaultIndex(adjustedIndex);\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { RowNode } from 'ag-grid-community';\r\n\r\n/**\r\n * When creating sibling nodes (e.g. footers), we don't copy these properties as they\r\n * cause the sibling to have properties which should be unique to the row.\r\n *\r\n * Note that `keyof T` does not include private members of `T`, so these need to be\r\n * added explicitly to this list. Take care when adding or renaming private properties\r\n * of `RowNode`.\r\n */\r\nconst IGNORED_SIBLING_PROPERTIES = new Set<\r\n    keyof RowNode | '__localEventService' | '__autoHeights' | '__checkAutoHeightsDebounced'\r\n>(['__localEventService', '__objectId', 'sticky', '__autoHeights', '__checkAutoHeightsDebounced']);\r\n\r\nexport function _createRowNodeFooter(rowNode: RowNode, beans: BeanCollection): void {\r\n    // only create footer node once, otherwise we have daemons and\r\n    // the animate screws up with the daemons hanging around\r\n    if (rowNode.sibling) {\r\n        return;\r\n    }\r\n\r\n    const footerNode = new RowNode(beans);\r\n\r\n    Object.keys(rowNode).forEach((key: keyof RowNode) => {\r\n        if (IGNORED_SIBLING_PROPERTIES.has(key)) {\r\n            return;\r\n        }\r\n        (footerNode as any)[key] = (rowNode as any)[key];\r\n    });\r\n\r\n    footerNode.footer = true;\r\n    footerNode.setRowTop(null);\r\n    footerNode.setRowIndex(null);\r\n\r\n    // manually set oldRowTop to null so we discard any\r\n    // previous information about its position.\r\n    footerNode.oldRowTop = null;\r\n\r\n    footerNode.id = 'rowGroupFooter_' + rowNode.id;\r\n\r\n    // get both header and footer to reference each other as siblings. this is never undone,\r\n    // only overwritten. so if a group is expanded, then contracted, it will have a ghost\r\n    // sibling - but that's fine, as we can ignore this if the header is contracted.\r\n    footerNode.sibling = rowNode;\r\n    rowNode.sibling = footerNode;\r\n}\r\n\r\nexport function _destroyRowNodeFooter(rowNode: RowNode): void {\r\n    if (!rowNode.sibling) {\r\n        return;\r\n    }\r\n\r\n    rowNode.sibling.setRowTop(null);\r\n    rowNode.sibling.setRowIndex(null);\r\n\r\n    rowNode.sibling = undefined as any;\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    ColDef,\r\n    ColKey,\r\n    ColumnEventType,\r\n    ColumnStateParams,\r\n    IAggFunc,\r\n    IColsService,\r\n    NamedBean,\r\n} from 'ag-grid-community';\r\nimport { BaseColsService, _exists, _removeFromArray, _warn } from 'ag-grid-community';\r\n\r\nexport class ValueColsSvc extends BaseColsService implements NamedBean, IColsService {\r\n    beanName = 'valueColsSvc' as const;\r\n    eventName = 'columnValueChanged' as const;\r\n\r\n    override columnProcessors = {\r\n        set: (column: AgColumn, added: boolean, source: ColumnEventType) => this.setValueActive(added, column, source),\r\n        add: (column: AgColumn, added: boolean, source: ColumnEventType) => this.setValueActive(true, column, source),\r\n        remove: (column: AgColumn, added: boolean, source: ColumnEventType) =>\r\n            this.setValueActive(false, column, source),\r\n    } as const;\r\n\r\n    override columnExtractors = {\r\n        setFlagFunc: (col: AgColumn, flag: boolean, source: ColumnEventType) =>\r\n            this.setColValueActive(col, flag, source),\r\n        getIndexFunc: () => undefined,\r\n        getInitialIndexFunc: () => undefined,\r\n        getValueFunc: (colDef: ColDef) => {\r\n            const aggFunc = colDef.aggFunc;\r\n            // null or empty string means clear\r\n            if (aggFunc === null || aggFunc === '') {\r\n                return null;\r\n            }\r\n            if (aggFunc === undefined) {\r\n                return;\r\n            }\r\n\r\n            return !!aggFunc;\r\n        },\r\n        getInitialValueFunc: (colDef: ColDef) => {\r\n            // return false if any of the following: null, undefined, empty string\r\n            return colDef.initialAggFunc != null && colDef.initialAggFunc != '';\r\n        },\r\n    } as const;\r\n\r\n    private modifyColumnsNoEventsCallbacks = {\r\n        addCol: (column: AgColumn) => this.columns.push(column),\r\n        removeCol: (column: AgColumn) => _removeFromArray(this.columns, column),\r\n    };\r\n\r\n    public override extractCols(source: ColumnEventType, oldProvidedCols: AgColumn[] | undefined): AgColumn[] {\r\n        this.columns = super.extractCols(source, oldProvidedCols);\r\n\r\n        // all new columns added will have aggFunc missing, so set it to what is in the colDef\r\n        this.columns.forEach((col) => {\r\n            const colDef = col.getColDef();\r\n            // if aggFunc provided, we always override, as reactive property\r\n            if (colDef.aggFunc != null && colDef.aggFunc != '') {\r\n                this.setColAggFunc(col, colDef.aggFunc);\r\n            } else {\r\n                // otherwise we use initialAggFunc only if no agg func set - which happens when new column only\r\n                if (!col.getAggFunc()) {\r\n                    this.setColAggFunc(col, colDef.initialAggFunc);\r\n                }\r\n            }\r\n        });\r\n\r\n        return this.columns;\r\n    }\r\n\r\n    public setColumnAggFunc(\r\n        key: ColKey | undefined,\r\n        aggFunc: string | IAggFunc | null | undefined,\r\n        source: ColumnEventType\r\n    ): void {\r\n        if (!key) {\r\n            return;\r\n        }\r\n\r\n        const column = this.colModel.getColDefCol(key);\r\n        if (!column) {\r\n            return;\r\n        }\r\n\r\n        this.setColAggFunc(column, aggFunc);\r\n\r\n        this.dispatchColumnChangedEvent(this.eventSvc, this.eventName, [column], source);\r\n    }\r\n\r\n    public override syncColumnWithState(\r\n        column: AgColumn,\r\n        source: ColumnEventType,\r\n        getValue: <U extends keyof ColumnStateParams, S extends keyof ColumnStateParams>(\r\n            key1: U,\r\n            key2?: S\r\n        ) => { value1: ColumnStateParams[U] | undefined; value2: ColumnStateParams[S] | undefined }\r\n    ): void {\r\n        // noop\r\n        const aggFunc = getValue('aggFunc').value1;\r\n        if (aggFunc !== undefined) {\r\n            if (typeof aggFunc === 'string') {\r\n                this.setColAggFunc(column, aggFunc);\r\n                if (!column.isValueActive()) {\r\n                    this.setColValueActive(column, true, source);\r\n                    this.modifyColumnsNoEventsCallbacks.addCol(column);\r\n                }\r\n            } else {\r\n                if (_exists(aggFunc)) {\r\n                    // stateItem.aggFunc must be a string\r\n                    _warn(33);\r\n                }\r\n                // Note: we do not call column.setAggFunc(null), so that next time we aggregate\r\n                // by this column (eg drag the column to the agg section int he toolpanel) it will\r\n                // default to the last aggregation function.\r\n\r\n                if (column.isValueActive()) {\r\n                    this.setColValueActive(column, false, source);\r\n                    this.modifyColumnsNoEventsCallbacks.removeCol(column);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private setValueActive(active: boolean, column: AgColumn, source: ColumnEventType): void {\r\n        if (active === column.isValueActive()) {\r\n            return;\r\n        }\r\n\r\n        this.setColValueActive(column, active, source);\r\n\r\n        if (active && !column.getAggFunc() && this.aggFuncSvc) {\r\n            const initialAggFunc = this.aggFuncSvc.getDefaultAggFunc(column);\r\n            this.setColAggFunc(column, initialAggFunc);\r\n        }\r\n    }\r\n\r\n    private setColAggFunc(column: AgColumn, aggFunc: string | IAggFunc | null | undefined): void {\r\n        column.aggFunc = aggFunc;\r\n        column.dispatchStateUpdatedEvent('aggFunc');\r\n    }\r\n\r\n    private setColValueActive(column: AgColumn, value: boolean, source: ColumnEventType): void {\r\n        if (column.aggregationActive !== value) {\r\n            column.aggregationActive = value;\r\n            column.dispatchColEvent('columnValueChanged', source);\r\n        }\r\n    }\r\n}\r\n", "import type { _AggregationGridApi, _ModuleWithApi } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { AggColumnNameService } from './aggColumnNameService';\r\nimport { AggFuncService } from './aggFuncService';\r\nimport { addAggFuncs, clearAggFuncs, setColumnAggFunc } from './aggregationApi';\r\nimport { AggregationStage } from './aggregationStage';\r\nimport { FilterAggregatesStage } from './filterAggregatesStage';\r\nimport { FooterService } from './footerService';\r\nimport { ValueColsSvc } from './valueColsSvc';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const SharedAggregationModule: _ModuleWithApi<_AggregationGridApi<any>> = {\r\n    moduleName: 'SharedAggregation',\r\n    version: VERSION,\r\n    beans: [AggFuncService, AggColumnNameService, FooterService, ValueColsSvc],\r\n    apiFunctions: {\r\n        addAggFuncs,\r\n        clearAggFuncs,\r\n        setColumnAggFunc,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule],\r\n};\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const AggregationModule: _ModuleWithApi<_AggregationGridApi<any>> = {\r\n    moduleName: 'Aggregation',\r\n    version: VERSION,\r\n    beans: [AggregationStage, FilterAggregatesStage],\r\n    rowModels: ['clientSide'],\r\n    dependsOn: [SharedAggregationModule],\r\n};\r\n", "import type { AgColumn, ColDef, ColumnEventType, ColumnStateParams, IColsService, NamedBean } from 'ag-grid-community';\r\nimport { BaseColsService, _removeFromArray } from 'ag-grid-community';\r\n\r\nexport class PivotColsSvc extends BaseColsService implements NamedBean, IColsService {\r\n    beanName = 'pivotColsSvc' as const;\r\n    eventName = 'columnPivotChanged' as const;\r\n    override columnProcessors = {\r\n        set: (column: AgColumn, added: boolean, source: ColumnEventType) =>\r\n            this.setColPivotActive(column, added, source),\r\n        add: (column: AgColumn, added: boolean, source: ColumnEventType) =>\r\n            this.setColPivotActive(column, true, source),\r\n        remove: (column: AgColumn, added: boolean, source: ColumnEventType) =>\r\n            this.setColPivotActive(column, false, source),\r\n    } as const;\r\n\r\n    override columnOrdering = {\r\n        enableProp: 'pivot',\r\n        initialEnableProp: 'initialPivot',\r\n        indexProp: 'pivotIndex',\r\n        initialIndexProp: 'initialPivotIndex',\r\n    } as const;\r\n\r\n    override columnExtractors = {\r\n        setFlagFunc: (col: AgColumn, flag: boolean, source: ColumnEventType) =>\r\n            this.setColPivotActive(col, flag, source),\r\n        getIndexFunc: (colDef: ColDef) => colDef.pivotIndex,\r\n        getInitialIndexFunc: (colDef: ColDef) => colDef.initialPivotIndex,\r\n        getValueFunc: (colDef: ColDef) => colDef.pivot,\r\n        getInitialValueFunc: (colDef: ColDef) => colDef.initialPivot,\r\n    } as const;\r\n\r\n    private modifyColumnsNoEventsCallbacks = {\r\n        addCol: (column: AgColumn) => this.columns.push(column),\r\n        removeCol: (column: AgColumn) => _removeFromArray(this.columns, column),\r\n    };\r\n\r\n    public syncColumnWithState(\r\n        column: AgColumn,\r\n        source: ColumnEventType,\r\n        getValue: <U extends keyof ColumnStateParams, S extends keyof ColumnStateParams>(\r\n            key1: U,\r\n            key2?: S\r\n        ) => { value1: ColumnStateParams[U] | undefined; value2: ColumnStateParams[S] | undefined },\r\n        rowIndex: { [key: string]: number } | null\r\n    ): void {\r\n        const { value1: pivot, value2: pivotIndex } = getValue('pivot', 'pivotIndex');\r\n        if (pivot !== undefined || pivotIndex !== undefined) {\r\n            if (typeof pivotIndex === 'number' || pivot) {\r\n                if (!column.isPivotActive()) {\r\n                    this.setColPivotActive(column, true, source);\r\n                    this.modifyColumnsNoEventsCallbacks.addCol(column);\r\n                }\r\n                if (rowIndex && typeof pivotIndex === 'number') {\r\n                    rowIndex[column.getId()] = pivotIndex;\r\n                }\r\n            } else {\r\n                if (column.isPivotActive()) {\r\n                    this.setColPivotActive(column, false, source);\r\n                    this.modifyColumnsNoEventsCallbacks.removeCol(column);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private setColPivotActive(column: AgColumn, pivot: boolean, source: ColumnEventType): void {\r\n        if (column.pivotActive !== pivot) {\r\n            column.pivotActive = pivot;\r\n            column.dispatchColEvent('columnPivotChanged', source);\r\n        }\r\n        column.dispatchStateUpdatedEvent('pivot');\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AllEventsWithoutGridCommon,\r\n    ColDef,\r\n    ColumnEventType,\r\n    ColumnStateParams,\r\n    IColsService,\r\n    NamedBean,\r\n} from 'ag-grid-community';\r\nimport { BaseColsService, _removeFromArray, _shouldUpdateColVisibilityAfterGroup } from 'ag-grid-community';\r\n\r\nexport class RowGroupColsSvc extends BaseColsService implements NamedBean, IColsService {\r\n    beanName = 'rowGroupColsSvc' as const;\r\n    eventName = 'columnRowGroupChanged' as const;\r\n\r\n    override columnProcessors = {\r\n        set: (column: AgColumn, added: boolean, source: ColumnEventType) => this.setActive(added, column, source),\r\n        add: (column: AgColumn, added: boolean, source: ColumnEventType) => this.setActive(true, column, source),\r\n        remove: (column: AgColumn, added: boolean, source: ColumnEventType) => this.setActive(false, column, source),\r\n    } as const;\r\n\r\n    override columnOrdering = {\r\n        enableProp: 'rowGroup',\r\n        initialEnableProp: 'initialRowGroup',\r\n        indexProp: 'rowGroupIndex',\r\n        initialIndexProp: 'initialRowGroupIndex',\r\n    } as const;\r\n\r\n    override columnExtractors = {\r\n        setFlagFunc: (col: AgColumn, flag: boolean, source: ColumnEventType) =>\r\n            this.setColRowGroupActive(col, flag, source),\r\n        getIndexFunc: (colDef: ColDef) => colDef.rowGroupIndex,\r\n        getInitialIndexFunc: (colDef: ColDef) => colDef.initialRowGroupIndex,\r\n        getValueFunc: (colDef: ColDef) => colDef.rowGroup,\r\n        getInitialValueFunc: (colDef: ColDef) => colDef.initialRowGroup,\r\n    } as const;\r\n\r\n    private modifyColumnsNoEventsCallbacks = {\r\n        addCol: (column: AgColumn) => this.columns.push(column),\r\n        removeCol: (column: AgColumn) => _removeFromArray(this.columns, column),\r\n    };\r\n\r\n    public moveColumn(fromIndex: number, toIndex: number, source: ColumnEventType): void {\r\n        if (this.columns.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const column = this.columns[fromIndex];\r\n\r\n        const impactedColumns = this.columns.slice(fromIndex, toIndex);\r\n        this.columns.splice(fromIndex, 1);\r\n        this.columns.splice(toIndex, 0, column);\r\n\r\n        this.eventSvc.dispatchEvent({\r\n            type: this.eventName,\r\n            columns: impactedColumns,\r\n            column: impactedColumns.length === 1 ? impactedColumns[0] : null,\r\n            source,\r\n        } as AllEventsWithoutGridCommon);\r\n    }\r\n\r\n    public syncColumnWithState(\r\n        column: AgColumn,\r\n        source: ColumnEventType,\r\n        getValue: <U extends keyof ColumnStateParams, S extends keyof ColumnStateParams>(\r\n            key1: U,\r\n            key2?: S\r\n        ) => { value1: ColumnStateParams[U] | undefined; value2: ColumnStateParams[S] | undefined },\r\n        rowIndex: { [key: string]: number } | null\r\n    ): void {\r\n        const { value1: rowGroup, value2: rowGroupIndex } = getValue('rowGroup', 'rowGroupIndex');\r\n        if (rowGroup !== undefined || rowGroupIndex !== undefined) {\r\n            if (typeof rowGroupIndex === 'number' || rowGroup) {\r\n                if (!column.isRowGroupActive()) {\r\n                    this.setColRowGroupActive(column, true, source);\r\n                    this.modifyColumnsNoEventsCallbacks.addCol(column);\r\n                }\r\n                if (rowIndex && typeof rowGroupIndex === 'number') {\r\n                    rowIndex[column.getId()] = rowGroupIndex;\r\n                }\r\n            } else {\r\n                if (column.isRowGroupActive()) {\r\n                    this.setColRowGroupActive(column, false, source);\r\n                    this.modifyColumnsNoEventsCallbacks.removeCol(column);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private setActive(active: boolean, column: AgColumn, source: ColumnEventType): void {\r\n        if (active === column.isRowGroupActive()) {\r\n            return;\r\n        }\r\n\r\n        this.setColRowGroupActive(column, active, source);\r\n\r\n        if (_shouldUpdateColVisibilityAfterGroup(this.gos, active)) {\r\n            this.colModel.setColsVisible([column], !active, source);\r\n        }\r\n    }\r\n\r\n    private setColRowGroupActive(column: AgColumn, rowGroup: boolean, source: ColumnEventType): void {\r\n        if (column.rowGroupActive !== rowGroup) {\r\n            column.rowGroupActive = rowGroup;\r\n            column.dispatchColEvent('columnRowGroupChanged', source);\r\n        }\r\n        column.dispatchStateUpdatedEvent('rowGroup');\r\n    }\r\n}\r\n", "import type {\r\n    ColDef,\r\n    ColKey,\r\n    ColumnEventType,\r\n    IAutoColService,\r\n    NamedBean,\r\n    _ColumnCollections,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgColumn,\r\n    BeanStub,\r\n    GROUP_AUTO_COLUMN_ID,\r\n    _addColumnDefaultAndTypes,\r\n    _areColIdsEqual,\r\n    _columnsMatch,\r\n    _convertColumnEventSourceType,\r\n    _destroyColumnTree,\r\n    _isColumnsSortingCoupledToGroup,\r\n    _isGroupMultiAutoColumn,\r\n    _isGroupUseEntireRow,\r\n    _mergeDeep,\r\n    _missing,\r\n    _updateColsMap,\r\n    _updateColumnState,\r\n    _warn,\r\n    isColumnGroupAutoCol,\r\n} from 'ag-grid-community';\r\n\r\nexport class AutoColService extends BeanStub implements NamedBean, IAutoColService {\r\n    beanName = 'autoColSvc' as const;\r\n\r\n    // group auto columns\r\n    public autoCols: _ColumnCollections | null;\r\n\r\n    public postConstruct(): void {\r\n        this.addManagedPropertyListener('autoGroupColumnDef', (event) =>\r\n            this.onAutoGroupColumnDefChanged(_convertColumnEventSourceType(event.source))\r\n        );\r\n    }\r\n\r\n    public addAutoCols(cols: _ColumnCollections): void {\r\n        if (this.autoCols == null) {\r\n            return;\r\n        }\r\n        cols.list = this.autoCols.list.concat(cols.list);\r\n        cols.tree = this.autoCols.tree.concat(cols.tree);\r\n        _updateColsMap(cols);\r\n    }\r\n\r\n    public createAutoCols(\r\n        cols: _ColumnCollections,\r\n        updateOrders: (callback: (cols: AgColumn[] | null) => AgColumn[] | null) => void\r\n    ): void {\r\n        const beans = this.beans;\r\n        const { colModel, gos, rowGroupColsSvc, colGroupSvc } = beans;\r\n        const isPivotMode = colModel.isPivotMode();\r\n        const groupFullWidthRow = _isGroupUseEntireRow(gos, isPivotMode);\r\n        // we need to allow suppressing auto-column separately for group and pivot as the normal situation\r\n        // is CSRM and user provides group column themselves for normal view, but when they go into pivot the\r\n        // columns are generated by the grid so no opportunity for user to provide group column. so need a way\r\n        // to suppress auto-col for grouping only, and not pivot.\r\n        // however if using Viewport RM or SSRM and user is providing the columns, the user may wish full control\r\n        // of the group column in this instance.\r\n        const suppressAutoColumn = isPivotMode ? gos.get('pivotSuppressAutoColumn') : this.isSuppressAutoCol();\r\n\r\n        const rowGroupCols = rowGroupColsSvc?.columns;\r\n\r\n        const groupingActive = (rowGroupCols && rowGroupCols.length > 0) || gos.get('treeData');\r\n\r\n        const noAutoCols = !groupingActive || suppressAutoColumn || groupFullWidthRow;\r\n\r\n        const destroyPrevious = () => {\r\n            if (this.autoCols) {\r\n                _destroyColumnTree(beans, this.autoCols.tree);\r\n                this.autoCols = null;\r\n            }\r\n        };\r\n\r\n        // function\r\n        if (noAutoCols) {\r\n            destroyPrevious();\r\n            return;\r\n        }\r\n\r\n        const list = this.generateAutoCols(rowGroupCols);\r\n        const autoColsSame = _areColIdsEqual(list, this.autoCols?.list || null);\r\n\r\n        // the new tree dept will equal the current tree dept of cols\r\n        const newTreeDepth = cols.treeDepth;\r\n        const oldTreeDepth = this.autoCols ? this.autoCols.treeDepth : -1;\r\n        const treeDeptSame = oldTreeDepth == newTreeDepth;\r\n\r\n        if (autoColsSame && treeDeptSame) {\r\n            return;\r\n        }\r\n\r\n        destroyPrevious();\r\n        const treeDepth = colGroupSvc?.findDepth(cols.tree) ?? 0;\r\n        const tree = colGroupSvc?.balanceTreeForAutoCols(list, treeDepth) ?? [];\r\n        this.autoCols = {\r\n            list,\r\n            tree,\r\n            treeDepth,\r\n            map: {},\r\n        };\r\n\r\n        const putAutoColsFirstInList = (cols: AgColumn[] | null): AgColumn[] | null => {\r\n            if (!cols) {\r\n                return null;\r\n            }\r\n            // we use colId, and not instance, to remove old autoGroupCols\r\n            const colsFiltered = cols.filter((col) => !isColumnGroupAutoCol(col));\r\n            return [...list, ...colsFiltered];\r\n        };\r\n\r\n        updateOrders(putAutoColsFirstInList);\r\n    }\r\n\r\n    public getAutoCol(key: ColKey): AgColumn | null {\r\n        return this.autoCols?.list.find((groupCol) => _columnsMatch(groupCol, key)) ?? null;\r\n    }\r\n\r\n    public getAutoCols(): AgColumn[] | null {\r\n        return this.autoCols?.list ?? null;\r\n    }\r\n\r\n    private generateAutoCols(rowGroupCols: AgColumn[] = []): AgColumn[] {\r\n        const autoCols: AgColumn[] = [];\r\n\r\n        const doingTreeData = this.gos.get('treeData');\r\n        let doingMultiAutoColumn = _isGroupMultiAutoColumn(this.gos);\r\n\r\n        if (doingTreeData && doingMultiAutoColumn) {\r\n            _warn(182);\r\n            doingMultiAutoColumn = false;\r\n        }\r\n\r\n        // if doing groupDisplayType = \"multipleColumns\", then we call the method multiple times, once\r\n        // for each column we are grouping by\r\n        if (doingMultiAutoColumn) {\r\n            rowGroupCols.forEach((rowGroupCol, index) => {\r\n                autoCols.push(this.createOneAutoCol(rowGroupCol, index));\r\n            });\r\n        } else {\r\n            autoCols.push(this.createOneAutoCol());\r\n        }\r\n\r\n        return autoCols;\r\n    }\r\n\r\n    public updateAutoCols(source: ColumnEventType) {\r\n        this.autoCols?.list.forEach((col, index) => this.updateOneAutoCol(col, index, source));\r\n    }\r\n\r\n    private isSuppressAutoCol() {\r\n        const gos = this.gos;\r\n        const groupDisplayType = gos.get('groupDisplayType');\r\n        const isCustomRowGroups = groupDisplayType === 'custom';\r\n        if (isCustomRowGroups) {\r\n            return true;\r\n        }\r\n\r\n        const treeDataDisplayType = gos.get('treeDataDisplayType');\r\n        return treeDataDisplayType === 'custom';\r\n    }\r\n\r\n    // rowGroupCol and index are missing if groupDisplayType != \"multipleColumns\"\r\n    private createOneAutoCol(rowGroupCol?: AgColumn, index?: number): AgColumn {\r\n        // if doing multi, set the field\r\n        let colId: string;\r\n        if (rowGroupCol) {\r\n            colId = `${GROUP_AUTO_COLUMN_ID}-${rowGroupCol.getId()}`;\r\n        } else {\r\n            colId = GROUP_AUTO_COLUMN_ID;\r\n        }\r\n\r\n        const colDef = this.createAutoColDef(colId, rowGroupCol, index);\r\n        colDef.colId = colId;\r\n\r\n        const newCol = new AgColumn(colDef, null, colId, true);\r\n        this.createBean(newCol);\r\n        return newCol;\r\n    }\r\n\r\n    /**\r\n     * Refreshes an auto group col to load changes from defaultColDef or autoGroupColDef\r\n     */\r\n    private updateOneAutoCol(colToUpdate: AgColumn, index: number, source: ColumnEventType) {\r\n        const oldColDef = colToUpdate.getColDef();\r\n        const underlyingColId = typeof oldColDef.showRowGroup == 'string' ? oldColDef.showRowGroup : undefined;\r\n        const beans = this.beans;\r\n        const underlyingColumn = underlyingColId != null ? beans.colModel.getColDefCol(underlyingColId) : undefined;\r\n        const colDef = this.createAutoColDef(colToUpdate.getId(), underlyingColumn ?? undefined, index);\r\n\r\n        colToUpdate.setColDef(colDef, null, source);\r\n        _updateColumnState(beans, colToUpdate, colDef, source);\r\n    }\r\n\r\n    private createAutoColDef(colId: string, underlyingColumn?: AgColumn, index?: number): ColDef {\r\n        // if one provided by user, use it, otherwise create one\r\n        let res: ColDef = this.createBaseColDef(underlyingColumn);\r\n\r\n        const autoGroupColumnDef = this.gos.get('autoGroupColumnDef');\r\n        _mergeDeep(res, autoGroupColumnDef);\r\n\r\n        res = _addColumnDefaultAndTypes(this.beans, res, colId, true);\r\n\r\n        // For tree data the filter is always allowed\r\n        if (!this.gos.get('treeData')) {\r\n            // we would only allow filter if the user has provided field or value getter. otherwise the filter\r\n            // would not be able to work.\r\n            const noFieldOrValueGetter =\r\n                _missing(res.field) &&\r\n                _missing(res.valueGetter) &&\r\n                _missing(res.filterValueGetter) &&\r\n                res.filter !== 'agGroupColumnFilter';\r\n            if (noFieldOrValueGetter) {\r\n                res.filter = false;\r\n            }\r\n        }\r\n\r\n        // if showing many cols, we don't want to show more than one with a checkbox for selection\r\n        if (index && index > 0) {\r\n            res.headerCheckboxSelection = false;\r\n        }\r\n\r\n        const isSortingCoupled = _isColumnsSortingCoupledToGroup(this.gos);\r\n        const hasOwnData = res.valueGetter || res.field != null;\r\n        if (isSortingCoupled && !hasOwnData) {\r\n            // if col is coupled sorting, and has sort attribute, we want to ignore this\r\n            // because we only accept the sort on creation of the col\r\n            res.sortIndex = undefined;\r\n            res.initialSort = undefined;\r\n        }\r\n\r\n        return res;\r\n    }\r\n\r\n    private createBaseColDef(rowGroupCol?: AgColumn): ColDef {\r\n        const userDef = this.gos.get('autoGroupColumnDef');\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n\r\n        const res: ColDef = {\r\n            headerName: localeTextFunc('group', 'Group'),\r\n        };\r\n\r\n        const userHasProvidedGroupCellRenderer = userDef && (userDef.cellRenderer || userDef.cellRendererSelector);\r\n\r\n        // only add the default group cell renderer if user hasn't provided one\r\n        if (!userHasProvidedGroupCellRenderer) {\r\n            res.cellRenderer = 'agGroupCellRenderer';\r\n        }\r\n\r\n        if (rowGroupCol) {\r\n            const colDef = rowGroupCol.getColDef();\r\n            Object.assign(res, {\r\n                headerName: this.beans.colNames.getDisplayNameForColumn(rowGroupCol, 'header'),\r\n                headerValueGetter: colDef.headerValueGetter,\r\n            });\r\n\r\n            if (colDef.cellRenderer) {\r\n                Object.assign(res, {\r\n                    cellRendererParams: {\r\n                        innerRenderer: colDef.cellRenderer,\r\n                        innerRendererParams: colDef.cellRendererParams,\r\n                    },\r\n                });\r\n            }\r\n            res.showRowGroup = rowGroupCol.getColId();\r\n        } else {\r\n            res.showRowGroup = true;\r\n        }\r\n\r\n        return res;\r\n    }\r\n\r\n    private onAutoGroupColumnDefChanged(source: ColumnEventType) {\r\n        this.updateAutoCols(source);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        _destroyColumnTree(this.beans, this.autoCols?.tree);\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    IClientSideRowModel,\r\n    IExpansionService,\r\n    NamedBean,\r\n    RowGroupOpenedEvent,\r\n    RowNode,\r\n} from 'ag-grid-community';\r\nimport { _exists } from 'ag-grid-community';\r\n\r\nimport { BaseExpansionService } from './baseExpansionService';\r\n\r\nexport class ClientSideExpansionService extends BaseExpansionService implements NamedBean, IExpansionService {\r\n    beanName = 'expansionSvc' as const;\r\n\r\n    private rowModel: IClientSideRowModel;\r\n\r\n    private events: RowGroupOpenedEvent[] = [];\r\n    private dispatchExpandedDebounced: () => void;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.rowModel = beans.rowModel as IClientSideRowModel;\r\n    }\r\n\r\n    public expandRows(rowIds: string[]): void {\r\n        const rowIdSet = new Set(rowIds);\r\n        this.rowModel.forEachNode((node) => {\r\n            if (node.id && rowIdSet.has(node.id)) {\r\n                node.expanded = true;\r\n            }\r\n        });\r\n        this.onGroupExpandedOrCollapsed();\r\n    }\r\n\r\n    public expandAll(expand: boolean): void {\r\n        const { gos, colModel, eventSvc } = this.beans;\r\n        const rowModel = this.rowModel;\r\n        const usingTreeData = gos.get('treeData');\r\n        const usingPivotMode = colModel.isPivotActive();\r\n\r\n        const recursiveExpandOrCollapse = (rowNodes: RowNode[] | null): void => {\r\n            if (!rowNodes) {\r\n                return;\r\n            }\r\n            rowNodes.forEach((rowNode) => {\r\n                const actionRow = () => {\r\n                    rowNode.expanded = expand;\r\n                    recursiveExpandOrCollapse(rowNode.childrenAfterGroup);\r\n                };\r\n\r\n                if (usingTreeData) {\r\n                    const hasChildren = _exists(rowNode.childrenAfterGroup);\r\n                    if (hasChildren) {\r\n                        actionRow();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                if (usingPivotMode) {\r\n                    const notLeafGroup = !rowNode.leafGroup;\r\n                    if (notLeafGroup) {\r\n                        actionRow();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                const isRowGroup = rowNode.group;\r\n                if (isRowGroup) {\r\n                    actionRow();\r\n                }\r\n            });\r\n        };\r\n\r\n        const rootNode = rowModel.rootNode;\r\n        if (rootNode) {\r\n            recursiveExpandOrCollapse(rootNode.childrenAfterGroup);\r\n        }\r\n\r\n        rowModel.refreshModel({ step: 'map' });\r\n\r\n        eventSvc.dispatchEvent({\r\n            type: 'expandOrCollapseAll',\r\n            source: expand ? 'expandAll' : 'collapseAll',\r\n        });\r\n    }\r\n\r\n    public onGroupExpandedOrCollapsed(): void {\r\n        // we don't really want the user calling this if only one rowNode was expanded, instead they should be\r\n        // calling rowNode.setExpanded(boolean) - this way we do a 'keepRenderedRows=false' so that the whole\r\n        // grid gets refreshed again - otherwise the row with the rowNodes that were changed won't get updated,\r\n        // and thus the expand icon in the group cell won't get 'opened' or 'closed'.\r\n        this.rowModel.refreshModel({ step: 'map' });\r\n    }\r\n\r\n    // because the user can call rowNode.setExpanded() many times in one VM turn,\r\n    // we throttle the calls to ClientSideRowModel using animationFrameSvc. this means for 100\r\n    // row nodes getting expanded, we only update the CSRM once, and then we fire all events after\r\n    // CSRM has updated.\r\n    //\r\n    // if we did not do this, then the user could call setExpanded on 100+ rows, causing the grid\r\n    // to re-render 100+ times, which would be a performance lag.\r\n    //\r\n    // we use animationFrameService\r\n    // rather than debounce() so this will get done if anyone flushes the animationFrameService\r\n    // (eg user calls api.ensureRowVisible(), which in turn flushes ).\r\n    protected override dispatchExpandedEvent(event: RowGroupOpenedEvent, forceSync?: boolean): void {\r\n        this.events.push(event);\r\n\r\n        const func = () => {\r\n            this.rowModel.onRowGroupOpened();\r\n            this.events.forEach((e) => this.eventSvc.dispatchEvent(e));\r\n            this.events = [];\r\n        };\r\n\r\n        if (forceSync) {\r\n            func();\r\n        } else {\r\n            if (this.dispatchExpandedDebounced == null) {\r\n                this.dispatchExpandedDebounced = this.debounce(func);\r\n            }\r\n            this.dispatchExpandedDebounced();\r\n        }\r\n    }\r\n\r\n    // the advantage over normal debounce is the client can call flushAllFrames()\r\n    // to make sure all rendering is complete. we don't wait any milliseconds,\r\n    // as this is intended to batch calls in one VM turn.\r\n    private debounce(func: () => void) {\r\n        const animationFrameSvc = this.beans.animationFrameSvc;\r\n        if (!animationFrameSvc) {\r\n            return () => window.setTimeout(func, 0);\r\n        }\r\n        let pending = false;\r\n        return () => {\r\n            if (!animationFrameSvc!.active) {\r\n                window.setTimeout(func, 0);\r\n                return;\r\n            }\r\n            if (pending) {\r\n                return;\r\n            }\r\n            pending = true;\r\n            animationFrameSvc!.addDestroyTask(() => {\r\n                pending = false;\r\n                func();\r\n            });\r\n        };\r\n    }\r\n}\r\n", "import type { RowCtrl, RowGroupOpenedEvent, RowNode } from 'ag-grid-community';\r\nimport { BeanStub, _createGlobalRowEvent, _setAriaExpanded } from 'ag-grid-community';\r\n\r\nexport abstract class BaseExpansionService extends BeanStub {\r\n    protected abstract dispatchExpandedEvent(event: RowGroupOpenedEvent, forceSync?: boolean): void;\r\n\r\n    public addExpandedCss(classes: string[], rowNode: RowNode): void {\r\n        if (rowNode.isExpandable()) {\r\n            classes.push('ag-row-group');\r\n            classes.push(rowNode.expanded ? 'ag-row-group-expanded' : 'ag-row-group-contracted');\r\n        }\r\n    }\r\n\r\n    public getRowExpandedListeners(rowCtrl: RowCtrl): {\r\n        expandedChanged: () => void;\r\n        hasChildrenChanged: () => void;\r\n    } {\r\n        const { rowNode } = rowCtrl;\r\n        const updateExpandedCss = this.updateExpandedCss.bind(this, rowCtrl, rowNode);\r\n        return {\r\n            expandedChanged: updateExpandedCss,\r\n            hasChildrenChanged: updateExpandedCss,\r\n        };\r\n    }\r\n\r\n    public setExpanded(rowNode: RowNode, expanded: boolean, e?: MouseEvent | KeyboardEvent, forceSync?: boolean): void {\r\n        if (rowNode.expanded === expanded) {\r\n            return;\r\n        }\r\n\r\n        rowNode.expanded = expanded;\r\n\r\n        rowNode.dispatchRowEvent('expandedChanged');\r\n\r\n        const event = { ..._createGlobalRowEvent(rowNode, this.gos, 'rowGroupOpened'), expanded, event: e || null };\r\n\r\n        this.dispatchExpandedEvent(event, forceSync);\r\n\r\n        // when using footers we need to refresh the group row, as the aggregation\r\n        // values jump between group and footer, because the footer can be callback\r\n        // we refresh regardless as the output of the callback could be a moving target\r\n        this.beans.rowRenderer.refreshCells({ rowNodes: [rowNode] });\r\n    }\r\n\r\n    public isExpandable(rowNode: RowNode): boolean {\r\n        if (rowNode.footer) {\r\n            return false;\r\n        }\r\n\r\n        if (this.beans.colModel.isPivotMode()) {\r\n            // master detail and leaf groups aren't expandable in pivot mode.\r\n            return rowNode.hasChildren() && !rowNode.leafGroup;\r\n        }\r\n        return rowNode.hasChildren() || rowNode.master;\r\n    }\r\n\r\n    private updateExpandedCss(rowCtrl: RowCtrl, rowNode: RowNode): void {\r\n        const expandable = rowNode.isExpandable();\r\n        const expanded = rowNode.expanded == true;\r\n\r\n        rowCtrl.forEachGui(undefined, (gui) => {\r\n            const rowComp = gui.rowComp;\r\n            rowComp.addOrRemoveCssClass('ag-row-group', expandable);\r\n            rowComp.addOrRemoveCssClass('ag-row-group-expanded', expandable && expanded);\r\n            rowComp.addOrRemoveCssClass('ag-row-group-contracted', expandable && !expanded);\r\n            _setAriaExpanded(gui.element, expandable && expanded);\r\n        });\r\n    }\r\n}\r\n", "import type {\r\n    ClientSideRowModelStage,\r\n    GetGroupIncludeFooterParams,\r\n    GridOptions,\r\n    IRowNodeStage,\r\n    NamedBean,\r\n    RowNode,\r\n    StageExecuteParams,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _getGrandTotalRow, _getGroupTotalRowCallback, _isGroupMultiAutoColumn } from 'ag-grid-community';\r\n\r\nimport { _createRowNodeFooter, _destroyRowNodeFooter } from '../aggregation/footerUtils';\r\n\r\ninterface FlattenDetails {\r\n    hideOpenParents: boolean;\r\n    groupHideParentOfSingleChild: GridOptions['groupHideParentOfSingleChild'];\r\n    isGroupMultiAutoColumn: boolean;\r\n    grandTotalRow: 'top' | 'bottom' | undefined;\r\n    groupTotalRow: (params: WithoutGridCommon<GetGroupIncludeFooterParams<any, any>>) => 'top' | 'bottom' | undefined;\r\n}\r\n\r\nexport class FlattenStage extends BeanStub implements IRowNodeStage<RowNode[]>, NamedBean {\r\n    beanName = 'flattenStage' as const;\r\n\r\n    public refreshProps: Set<keyof GridOptions<any>> = new Set([\r\n        'groupHideParentOfSingleChild',\r\n        'groupRemoveSingleChildren',\r\n        'groupRemoveLowestSingleChildren',\r\n        'groupTotalRow',\r\n        'masterDetail',\r\n    ]);\r\n    public step: ClientSideRowModelStage = 'map';\r\n\r\n    public execute(params: StageExecuteParams): RowNode[] {\r\n        const rootNode = params.rowNode;\r\n\r\n        // even if not doing grouping, we do the mapping, as the client might\r\n        // of passed in data that already has a grouping in it somewhere\r\n        const result: RowNode[] = [];\r\n        const skipLeafNodes = this.beans.colModel.isPivotMode();\r\n        // if we are reducing, and not grouping, then we want to show the root node, as that\r\n        // is where the pivot values are\r\n        const showRootNode = skipLeafNodes && rootNode.leafGroup;\r\n        const topList = showRootNode ? [rootNode] : rootNode.childrenAfterSort;\r\n\r\n        const details = this.getFlattenDetails();\r\n\r\n        this.recursivelyAddToRowsToDisplay(details, topList, result, skipLeafNodes, 0);\r\n\r\n        // we do not want the footer total if the gris is empty\r\n        const atLeastOneRowPresent = result.length > 0;\r\n\r\n        const includeGrandTotalRow =\r\n            !showRootNode &&\r\n            // don't show total footer when showRootNode is true (i.e. in pivot mode and no groups)\r\n            atLeastOneRowPresent &&\r\n            details.grandTotalRow;\r\n\r\n        if (includeGrandTotalRow) {\r\n            _createRowNodeFooter(rootNode, this.beans);\r\n            const addToTop = details.grandTotalRow === 'top';\r\n            this.addRowNodeToRowsToDisplay(details, rootNode.sibling, result, 0, addToTop);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private getFlattenDetails(): FlattenDetails {\r\n        let groupHideParentOfSingleChild = this.gos.get('groupHideParentOfSingleChild');\r\n        if (!groupHideParentOfSingleChild) {\r\n            groupHideParentOfSingleChild = this.gos.get('groupRemoveSingleChildren');\r\n            if (!groupHideParentOfSingleChild && this.gos.get('groupRemoveLowestSingleChildren')) {\r\n                groupHideParentOfSingleChild = 'leafGroupsOnly';\r\n            }\r\n        }\r\n        return {\r\n            groupHideParentOfSingleChild,\r\n            isGroupMultiAutoColumn: _isGroupMultiAutoColumn(this.gos),\r\n            hideOpenParents: this.gos.get('groupHideOpenParents'),\r\n            grandTotalRow: _getGrandTotalRow(this.gos),\r\n            groupTotalRow: _getGroupTotalRowCallback(this.gos),\r\n        };\r\n    }\r\n\r\n    private recursivelyAddToRowsToDisplay(\r\n        details: FlattenDetails,\r\n        rowsToFlatten: RowNode[] | null,\r\n        result: RowNode[],\r\n        skipLeafNodes: boolean,\r\n        uiLevel: number\r\n    ) {\r\n        if (!rowsToFlatten?.length) {\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < rowsToFlatten!.length; i++) {\r\n            const rowNode = rowsToFlatten![i];\r\n\r\n            // check all these cases, for working out if this row should be included in the final mapped list\r\n            const isParent = rowNode.hasChildren();\r\n\r\n            const isSkippedLeafNode = skipLeafNodes && !isParent;\r\n\r\n            const isRemovedSingleChildrenGroup =\r\n                details.groupHideParentOfSingleChild === true && isParent && rowNode.childrenAfterGroup!.length === 1;\r\n\r\n            const isRemovedLowestSingleChildrenGroup =\r\n                details.groupHideParentOfSingleChild === 'leafGroupsOnly' &&\r\n                isParent &&\r\n                rowNode.leafGroup &&\r\n                rowNode.childrenAfterGroup!.length === 1;\r\n\r\n            // hide open parents means when group is open, we don't show it. we also need to make sure the\r\n            // group is expandable in the first place (as leaf groups are not expandable if pivot mode is on).\r\n            // the UI will never allow expanding leaf  groups, however the user might via the API (or menu option 'expand all row groups')\r\n            const neverAllowToExpand = skipLeafNodes && rowNode.leafGroup;\r\n\r\n            const isHiddenOpenParent =\r\n                details.hideOpenParents && rowNode.expanded && !rowNode.master && !neverAllowToExpand;\r\n\r\n            const thisRowShouldBeRendered =\r\n                !isSkippedLeafNode &&\r\n                !isHiddenOpenParent &&\r\n                !isRemovedSingleChildrenGroup &&\r\n                !isRemovedLowestSingleChildrenGroup;\r\n\r\n            if (thisRowShouldBeRendered) {\r\n                this.addRowNodeToRowsToDisplay(details, rowNode, result, uiLevel);\r\n            }\r\n\r\n            // if we are pivoting, we never map below the leaf group\r\n            if (skipLeafNodes && rowNode.leafGroup) {\r\n                continue;\r\n            }\r\n\r\n            if (isParent) {\r\n                const excludedParent = isRemovedSingleChildrenGroup || isRemovedLowestSingleChildrenGroup;\r\n\r\n                // we traverse the group if it is expended, however we always traverse if the parent node\r\n                // was removed (as the group will never be opened if it is not displayed, we show the children instead)\r\n                if (rowNode.expanded || excludedParent) {\r\n                    const doesRowShowFooter = details.groupTotalRow({ node: rowNode });\r\n                    if (!doesRowShowFooter) {\r\n                        _destroyRowNodeFooter(rowNode);\r\n                    }\r\n\r\n                    // if the parent was excluded, then ui level is that of the parent\r\n                    const uiLevelForChildren = excludedParent ? uiLevel : uiLevel + 1;\r\n                    if (doesRowShowFooter === 'top') {\r\n                        _createRowNodeFooter(rowNode, this.beans);\r\n                        this.addRowNodeToRowsToDisplay(details, rowNode.sibling, result, uiLevelForChildren);\r\n                    }\r\n\r\n                    this.recursivelyAddToRowsToDisplay(\r\n                        details,\r\n                        rowNode.childrenAfterSort,\r\n                        result,\r\n                        skipLeafNodes,\r\n                        uiLevelForChildren\r\n                    );\r\n\r\n                    if (doesRowShowFooter === 'bottom') {\r\n                        _createRowNodeFooter(rowNode, this.beans);\r\n                        this.addRowNodeToRowsToDisplay(details, rowNode.sibling, result, uiLevelForChildren);\r\n                    }\r\n                }\r\n            } else {\r\n                const detailNode = this.beans.masterDetailSvc?.getDetail(rowNode);\r\n                if (detailNode) {\r\n                    this.addRowNodeToRowsToDisplay(details, detailNode, result, uiLevel);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // duplicated method, it's also in floatingRowModel\r\n    private addRowNodeToRowsToDisplay(\r\n        details: FlattenDetails,\r\n        rowNode: RowNode,\r\n        result: RowNode[],\r\n        uiLevel: number,\r\n        addToTop?: boolean\r\n    ): void {\r\n        if (addToTop) {\r\n            result.unshift(rowNode);\r\n        } else {\r\n            result.push(rowNode);\r\n        }\r\n        rowNode.setUiLevel(details.isGroupMultiAutoColumn ? 0 : uiLevel);\r\n    }\r\n}\r\n", "import type {\r\n    GroupCellRendererParams,\r\n    ICellRendererComp,\r\n    IGroupCellRenderer,\r\n    UserCompDetails,\r\n} from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _setAriaRole, _setDisplayed } from 'ag-grid-community';\r\n\r\nimport { GroupCellRendererCtrl } from './groupCellRendererCtrl';\r\n\r\nconst groupTemplate =\r\n    /* html */\r\n    `<span class=\"ag-cell-wrapper\">\r\n        <span class=\"ag-group-expanded\" data-ref=\"eExpanded\"></span>\r\n        <span class=\"ag-group-contracted\" data-ref=\"eContracted\"></span>\r\n        <span class=\"ag-group-checkbox ag-invisible\" data-ref=\"eCheckbox\"></span>\r\n        <span class=\"ag-group-value\" data-ref=\"eValue\"></span>\r\n        <span class=\"ag-group-child-count\" data-ref=\"eChildCount\"></span>\r\n    </span>`;\r\n\r\nexport class GroupCellRenderer extends Component implements ICellRendererComp {\r\n    private readonly eExpanded: HTMLElement = RefPlaceholder;\r\n    private readonly eContracted: HTMLElement = RefPlaceholder;\r\n    private readonly eCheckbox: HTMLElement = RefPlaceholder;\r\n    private readonly eValue: HTMLElement = RefPlaceholder;\r\n    private readonly eChildCount: HTMLElement = RefPlaceholder;\r\n\r\n    // this cell renderer\r\n    private innerCellRenderer: ICellRendererComp;\r\n\r\n    constructor() {\r\n        super(groupTemplate);\r\n    }\r\n\r\n    public init(params: GroupCellRendererParams): void {\r\n        const compProxy: IGroupCellRenderer = {\r\n            setInnerRenderer: (compDetails, valueToDisplay) => this.setRenderDetails(compDetails, valueToDisplay),\r\n            setChildCount: (count) => (this.eChildCount.textContent = count),\r\n            addOrRemoveCssClass: (cssClass, value) => this.addOrRemoveCssClass(cssClass, value),\r\n            setContractedDisplayed: (expanded) => _setDisplayed(this.eContracted, expanded),\r\n            setExpandedDisplayed: (expanded) => _setDisplayed(this.eExpanded, expanded),\r\n            setCheckboxVisible: (visible) => this.eCheckbox.classList.toggle('ag-invisible', !visible),\r\n        };\r\n\r\n        const ctrl = this.createManagedBean(new GroupCellRendererCtrl());\r\n        const fullWidth = !params.colDef;\r\n        const eGui = this.getGui();\r\n        ctrl.init(compProxy, eGui, this.eCheckbox, this.eExpanded, this.eContracted, this.constructor, params);\r\n\r\n        if (fullWidth) {\r\n            _setAriaRole(eGui, ctrl.getCellAriaRole());\r\n        }\r\n    }\r\n\r\n    private setRenderDetails(compDetails: UserCompDetails | undefined, valueToDisplay: any): void {\r\n        if (compDetails) {\r\n            compDetails.newAgStackInstance().then((comp) => {\r\n                if (!comp) {\r\n                    return;\r\n                }\r\n                const destroyComp = () => this.destroyBean(comp);\r\n                if (this.isAlive()) {\r\n                    this.eValue.appendChild(comp.getGui());\r\n                    this.addDestroyFunc(destroyComp);\r\n                } else {\r\n                    destroyComp();\r\n                }\r\n            });\r\n        } else {\r\n            this.eValue.innerText = valueToDisplay;\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyBean(this.innerCellRenderer);\r\n        super.destroy();\r\n    }\r\n\r\n    public refresh(): boolean {\r\n        return false;\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    CheckboxSelectionComponent,\r\n    ColumnModel,\r\n    CtrlsService,\r\n    ExpressionService,\r\n    GroupCellRendererParams,\r\n    IColsService,\r\n    IGroupCellRenderer,\r\n    IGroupCellRendererCtrl,\r\n    IGroupHideOpenParentsService,\r\n    IRowNode,\r\n    ISelectionService,\r\n    RowDragService,\r\n    RowNode,\r\n    UserCompDetails,\r\n    UserComponentFactory,\r\n    ValueService,\r\n    VisibleColsService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    KeyCode,\r\n    _createIconNoSpan,\r\n    _getCellRendererDetails,\r\n    _getCheckboxLocation,\r\n    _getCheckboxes,\r\n    _getGrandTotalRow,\r\n    _getInnerCellRendererDetails,\r\n    _isElementInEventPath,\r\n    _isRowSelection,\r\n    _isStopPropagationForAgGrid,\r\n    _missing,\r\n    _removeAriaExpanded,\r\n    _setAriaExpanded,\r\n    _stopPropagationForAgGrid,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nexport class GroupCellRendererCtrl extends BeanStub implements IGroupCellRendererCtrl {\r\n    private expressionSvc?: ExpressionService;\r\n    private valueSvc: ValueService;\r\n    private colModel: ColumnModel;\r\n    private visibleCols: VisibleColsService;\r\n    private userCompFactory: UserComponentFactory;\r\n    private ctrlsSvc: CtrlsService;\r\n    private rowGroupColsSvc?: IColsService;\r\n    private rowDragSvc?: RowDragService;\r\n    private selectionSvc?: ISelectionService;\r\n    private groupHideOpenParentsSvc?: IGroupHideOpenParentsService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.expressionSvc = beans.expressionSvc;\r\n        this.valueSvc = beans.valueSvc;\r\n        this.colModel = beans.colModel;\r\n        this.visibleCols = beans.visibleCols;\r\n        this.userCompFactory = beans.userCompFactory;\r\n        this.ctrlsSvc = beans.ctrlsSvc;\r\n        this.rowGroupColsSvc = beans.rowGroupColsSvc;\r\n        this.selectionSvc = beans.selectionSvc;\r\n        this.groupHideOpenParentsSvc = beans.groupHideOpenParentsSvc;\r\n    }\r\n\r\n    private params: GroupCellRendererParams;\r\n\r\n    // will be true if the node was pulled down\r\n    private showingValueForOpenedParent: boolean;\r\n\r\n    // this is normally the rowNode of this row, however when doing hideOpenParents, it will\r\n    // be the parent who's details we are actually showing if the data was pulled down.\r\n    private displayedGroupNode: RowNode;\r\n\r\n    private eGui: HTMLElement;\r\n    private eExpanded: HTMLElement;\r\n    private eContracted: HTMLElement;\r\n    private eCheckbox: HTMLElement;\r\n    private expandListener: (() => null) | null;\r\n\r\n    // keep reference to this, so we can remove again when indent changes\r\n    private indentClass: string;\r\n\r\n    private comp: IGroupCellRenderer;\r\n    private compClass: any;\r\n    private cbComp?: CheckboxSelectionComponent;\r\n\r\n    public init(\r\n        comp: IGroupCellRenderer,\r\n        eGui: HTMLElement,\r\n        eCheckbox: HTMLElement,\r\n        eExpanded: HTMLElement,\r\n        eContracted: HTMLElement,\r\n        compClass: any,\r\n        params: GroupCellRendererParams\r\n    ): void {\r\n        this.params = params;\r\n        this.eGui = eGui;\r\n        this.eCheckbox = eCheckbox;\r\n        this.eExpanded = eExpanded;\r\n        this.eContracted = eContracted;\r\n        this.comp = comp;\r\n        this.compClass = compClass;\r\n\r\n        const { node, colDef } = params;\r\n        const topLevelFooter = this.isTopLevelFooter();\r\n\r\n        // logic for skipping cells follows, never skip top level footer cell.\r\n        if (!topLevelFooter) {\r\n            const embeddedRowMismatch = this.isEmbeddedRowMismatch();\r\n            if (embeddedRowMismatch) {\r\n                return;\r\n            }\r\n\r\n            // this footer should only be non-top level.\r\n            // as we won't have footer rows in that instance.\r\n            if (node.footer && this.gos.get('groupHideOpenParents')) {\r\n                const showRowGroup = colDef?.showRowGroup;\r\n                const rowGroupColumnId = node.rowGroupColumn?.getColId();\r\n\r\n                // if the groupCellRenderer is inside of a footer and groupHideOpenParents is true\r\n                // we should only display the groupCellRenderer if the current column is the rowGroupedColumn\r\n                if (showRowGroup !== rowGroupColumnId) {\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        this.setupShowingValueForOpenedParent();\r\n        this.findDisplayedGroupNode();\r\n\r\n        if (!topLevelFooter) {\r\n            const showingFooterTotal =\r\n                this.rowGroupColsSvc &&\r\n                node.footer &&\r\n                node.rowGroupIndex ===\r\n                    this.rowGroupColsSvc.columns.findIndex((c) => c.getColId() === colDef?.showRowGroup);\r\n            // if we're always showing a group value\r\n            const isAlwaysShowing = this.gos.get('groupDisplayType') != 'multipleColumns' || this.gos.get('treeData');\r\n            // if the cell is populated with a parent value due to `showOpenedGroup`\r\n            const showOpenGroupValue =\r\n                isAlwaysShowing ||\r\n                (this.gos.get('showOpenedGroup') &&\r\n                    this.rowGroupColsSvc &&\r\n                    !node.footer &&\r\n                    (!node.group ||\r\n                        (node.rowGroupIndex != null &&\r\n                            node.rowGroupIndex >\r\n                                this.rowGroupColsSvc?.columns.findIndex(\r\n                                    (c) => c.getColId() === colDef?.showRowGroup\r\n                                ))));\r\n            // not showing a leaf value (field/valueGetter)\r\n            const leafWithValues = !node.group && (colDef?.field || colDef?.valueGetter);\r\n            // doesn't have expand/collapse chevron\r\n            const isExpandable = this.isExpandable();\r\n            // is showing pivot leaf cell\r\n            const showPivotModeLeafValue =\r\n                this.colModel.isPivotMode() &&\r\n                node.leafGroup &&\r\n                node.rowGroupColumn?.getColId() === colDef?.showRowGroup;\r\n\r\n            // if not showing any values or chevron, skip cell.\r\n            const canSkipRenderingCell =\r\n                !this.showingValueForOpenedParent &&\r\n                !isExpandable &&\r\n                !leafWithValues &&\r\n                !showOpenGroupValue &&\r\n                !showingFooterTotal &&\r\n                !showPivotModeLeafValue;\r\n            if (canSkipRenderingCell) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.addExpandAndContract();\r\n        this.addFullWidthRowDraggerIfNeeded();\r\n        this.addCheckboxIfNeeded();\r\n        this.addValueElement();\r\n        this.setupIndent();\r\n        this.refreshAriaExpanded();\r\n\r\n        this.addManagedPropertyListener('rowSelection', ({ currentValue, previousValue }) => {\r\n            const curr = typeof currentValue === 'object' ? currentValue : undefined;\r\n            const prev = typeof previousValue === 'object' ? previousValue : undefined;\r\n\r\n            if (curr?.checkboxLocation !== prev?.checkboxLocation) {\r\n                this.refreshCheckbox();\r\n            }\r\n        });\r\n    }\r\n\r\n    public getCellAriaRole(): string {\r\n        const colDefAriaRole = this.params.colDef?.cellAriaRole;\r\n        const columnColDefAriaRole = this.params.column?.getColDef().cellAriaRole;\r\n        return colDefAriaRole || columnColDefAriaRole || 'gridcell';\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n        // property cleanup to avoid memory leaks\r\n        this.expandListener = null;\r\n        this.destroyCheckbox();\r\n    }\r\n\r\n    private refreshAriaExpanded(): void {\r\n        const { node, eGridCell } = this.params;\r\n\r\n        if (this.expandListener) {\r\n            this.expandListener = this.expandListener();\r\n        }\r\n\r\n        if (!this.isExpandable()) {\r\n            _removeAriaExpanded(eGridCell);\r\n            return;\r\n        }\r\n\r\n        const listener = () => {\r\n            // for react, we don't use JSX, as setting attributes via jsx is slower\r\n            _setAriaExpanded(eGridCell, this.showingValueForOpenedParent || !!node.expanded);\r\n        };\r\n\r\n        [this.expandListener] = this.addManagedListeners(node, { expandedChanged: listener }) || null;\r\n        listener();\r\n    }\r\n\r\n    private isTopLevelFooter(): boolean {\r\n        const totalRow = _getGrandTotalRow(this.gos);\r\n        if (!totalRow) {\r\n            return false;\r\n        }\r\n\r\n        if (this.params.value != null || this.params.node.level != -1) {\r\n            return false;\r\n        }\r\n\r\n        // at this point, we know it's the root node and there is no value present, so it's a footer cell.\r\n        // the only thing to work out is if we are displaying groups  across multiple\r\n        // columns (groupDisplayType: 'multipleColumns'), we only want 'total' to appear in the first column.\r\n\r\n        const colDef = this.params.colDef;\r\n        const doingFullWidth = colDef == null;\r\n        if (doingFullWidth) {\r\n            return true;\r\n        }\r\n\r\n        if (colDef.showRowGroup === true) {\r\n            return true;\r\n        }\r\n\r\n        const rowGroupCols = this.rowGroupColsSvc?.columns;\r\n        // this is a sanity check, rowGroupCols should always be present\r\n        if (!rowGroupCols || rowGroupCols.length === 0) {\r\n            return true;\r\n        }\r\n\r\n        return rowGroupCols[0].getId() === colDef.showRowGroup;\r\n    }\r\n\r\n    // if we are doing embedded full width rows, we only show the renderer when\r\n    // in the body, or if pinning in the pinned section, or if pinning and RTL,\r\n    // in the right section. otherwise we would have the cell repeated in each section.\r\n    private isEmbeddedRowMismatch(): boolean {\r\n        if (!this.params.fullWidth || !this.gos.get('embedFullWidthRows')) {\r\n            return false;\r\n        }\r\n\r\n        const pinnedLeftCell = this.params.pinned === 'left';\r\n        const pinnedRightCell = this.params.pinned === 'right';\r\n        const bodyCell = !pinnedLeftCell && !pinnedRightCell;\r\n\r\n        if (this.gos.get('enableRtl')) {\r\n            if (this.visibleCols.isPinningLeft()) {\r\n                return !pinnedRightCell;\r\n            }\r\n            return !bodyCell;\r\n        }\r\n\r\n        if (this.visibleCols.isPinningLeft()) {\r\n            return !pinnedLeftCell;\r\n        }\r\n\r\n        return !bodyCell;\r\n    }\r\n\r\n    private findDisplayedGroupNode(): void {\r\n        const column = this.params.column;\r\n        const rowNode = this.params.node as RowNode;\r\n\r\n        if (this.showingValueForOpenedParent) {\r\n            let pointer = rowNode.parent;\r\n\r\n            while (pointer != null) {\r\n                if (pointer.rowGroupColumn && column!.isRowGroupDisplayed(pointer.rowGroupColumn.getId())) {\r\n                    this.displayedGroupNode = pointer;\r\n                    break;\r\n                }\r\n                pointer = pointer.parent;\r\n            }\r\n        }\r\n\r\n        // if we didn't find a displayed group, set it to the row node\r\n        if (_missing(this.displayedGroupNode)) {\r\n            this.displayedGroupNode = rowNode;\r\n        }\r\n    }\r\n\r\n    private setupShowingValueForOpenedParent(): void {\r\n        this.showingValueForOpenedParent =\r\n            this.groupHideOpenParentsSvc?.isShowingValueForOpenedParent(this.params.node, this.params.column!) ?? false;\r\n    }\r\n\r\n    private addValueElement(): void {\r\n        if (this.displayedGroupNode.footer) {\r\n            this.addFooterValue();\r\n        } else {\r\n            this.addGroupValue();\r\n            this.addChildCount();\r\n        }\r\n    }\r\n\r\n    private addGroupValue(): void {\r\n        // we try and use the cellRenderer of the column used for the grouping if we can\r\n        const paramsAdjusted = this.adjustParamsWithDetailsFromRelatedColumn();\r\n        const innerCompDetails = this.getInnerCompDetails(paramsAdjusted);\r\n\r\n        const { valueFormatted, value } = paramsAdjusted;\r\n\r\n        let valueWhenNoRenderer = valueFormatted;\r\n        if (valueWhenNoRenderer == null) {\r\n            const isGroupColForNode =\r\n                this.displayedGroupNode.rowGroupColumn &&\r\n                this.params.column?.isRowGroupDisplayed(this.displayedGroupNode.rowGroupColumn.getId());\r\n\r\n            if (this.displayedGroupNode.key === '' && this.displayedGroupNode.group && isGroupColForNode) {\r\n                const localeTextFunc = this.getLocaleTextFunc();\r\n                valueWhenNoRenderer = localeTextFunc('blanks', '(Blanks)');\r\n            } else {\r\n                valueWhenNoRenderer = value ?? null;\r\n            }\r\n        }\r\n\r\n        this.comp.setInnerRenderer(innerCompDetails, valueWhenNoRenderer);\r\n    }\r\n\r\n    private adjustParamsWithDetailsFromRelatedColumn(): GroupCellRendererParams {\r\n        const relatedColumn = this.displayedGroupNode.rowGroupColumn;\r\n        const column = this.params.column;\r\n\r\n        if (!relatedColumn) {\r\n            return this.params;\r\n        }\r\n\r\n        const notFullWidth = column != null;\r\n        if (notFullWidth) {\r\n            const showingThisRowGroup = column!.isRowGroupDisplayed(relatedColumn.getId());\r\n            if (!showingThisRowGroup) {\r\n                return this.params;\r\n            }\r\n        }\r\n\r\n        const params = this.params;\r\n\r\n        const { value, node } = this.params;\r\n        const valueFormatted = this.valueSvc.formatValue(relatedColumn, node, value);\r\n\r\n        // we don't update the original params, as they could of come through React,\r\n        // as react has RowGroupCellRenderer, which means the params could be props which\r\n        // would be read only\r\n        const paramsAdjusted = {\r\n            ...params,\r\n            valueFormatted: valueFormatted,\r\n        };\r\n\r\n        return paramsAdjusted;\r\n    }\r\n\r\n    private addFooterValue(): void {\r\n        const totalValueGetter = this.params.totalValueGetter;\r\n        let footerValue = '';\r\n\r\n        if (totalValueGetter) {\r\n            // params is same as we were given, except we set the value as the item to display\r\n            const paramsClone = {\r\n                ...this.params,\r\n                value: this.params.value,\r\n            };\r\n\r\n            if (typeof totalValueGetter === 'function') {\r\n                footerValue = totalValueGetter(paramsClone);\r\n            } else if (typeof totalValueGetter === 'string') {\r\n                footerValue = this.expressionSvc ? this.expressionSvc.evaluate(totalValueGetter, paramsClone) : '';\r\n            } else {\r\n                _warn(179);\r\n            }\r\n        } else {\r\n            const localeTextFunc = this.getLocaleTextFunc();\r\n            const footerTotalPrefix = localeTextFunc('footerTotal', 'Total');\r\n            footerValue = footerTotalPrefix + ' ' + (this.params.value != null ? this.params.value : '');\r\n        }\r\n\r\n        const innerCompDetails = this.getInnerCompDetails(this.params);\r\n\r\n        this.comp.setInnerRenderer(innerCompDetails, footerValue);\r\n    }\r\n\r\n    private getInnerCompDetails(params: GroupCellRendererParams): UserCompDetails | undefined {\r\n        // for full width rows, we don't do any of the below\r\n        if (params.fullWidth) {\r\n            return _getInnerCellRendererDetails(this.userCompFactory, this.gos.get('groupRowRendererParams'), params);\r\n        }\r\n\r\n        // when grouping, the normal case is we use the cell renderer of the grouped column. eg if grouping by country\r\n        // and then rating, we will use the country cell renderer for each country group row and likewise the rating\r\n        // cell renderer for each rating group row.\r\n        //\r\n        // however if the user has innerCellRenderer defined, this gets preference and we don't use cell renderers\r\n        // of the grouped columns.\r\n        //\r\n        // so we check and use in the following order:\r\n        //\r\n        // 1) thisColDef.cellRendererParams.innerRenderer of the column showing the groups (eg auto group column)\r\n        // 2) groupedColDef.cellRenderer of the grouped column\r\n        // 3) groupedColDef.cellRendererParams.innerRenderer\r\n\r\n        // we check if cell renderer provided for the group cell renderer, eg colDef.cellRendererParams.innerRenderer\r\n        const innerCompDetails = _getInnerCellRendererDetails<GroupCellRendererParams>(\r\n            this.userCompFactory,\r\n            params,\r\n            params\r\n        );\r\n\r\n        // avoid using GroupCellRenderer again, otherwise stack overflow, as we insert same renderer again and again.\r\n        // this covers off chance user is grouping by a column that is also configured with GroupCellRenderer\r\n        const isGroupRowRenderer = (details: UserCompDetails | undefined) =>\r\n            details && details.componentClass == this.compClass;\r\n\r\n        if (innerCompDetails && !isGroupRowRenderer(innerCompDetails)) {\r\n            // use the renderer defined in cellRendererParams.innerRenderer\r\n            return innerCompDetails;\r\n        }\r\n\r\n        const relatedColumn = this.displayedGroupNode.rowGroupColumn;\r\n        const relatedColDef = relatedColumn?.getColDef();\r\n\r\n        if (!relatedColDef) {\r\n            return;\r\n        }\r\n\r\n        // otherwise see if we can use the cellRenderer of the column we are grouping by\r\n        const relatedCompDetails = _getCellRendererDetails(this.userCompFactory, relatedColDef, params);\r\n\r\n        if (relatedCompDetails && !isGroupRowRenderer(relatedCompDetails)) {\r\n            // Only if the original column is using a specific renderer, it it is a using a DEFAULT one ignore it\r\n            return relatedCompDetails;\r\n        }\r\n\r\n        if (\r\n            isGroupRowRenderer(relatedCompDetails) &&\r\n            relatedColDef.cellRendererParams &&\r\n            relatedColDef.cellRendererParams.innerRenderer\r\n        ) {\r\n            // edge case - this comes from a column which has been grouped dynamically, that has a renderer 'group'\r\n            // and has an inner cell renderer\r\n            return _getInnerCellRendererDetails<GroupCellRendererParams>(\r\n                this.userCompFactory,\r\n                relatedColDef.cellRendererParams,\r\n                params\r\n            );\r\n        }\r\n    }\r\n\r\n    private addChildCount(): void {\r\n        // only include the child count if it's included, eg if user doing custom aggregation,\r\n        // then this could be left out, or set to -1, ie no child count\r\n        if (this.params.suppressCount) {\r\n            return;\r\n        }\r\n\r\n        this.addManagedListeners(this.displayedGroupNode, {\r\n            allChildrenCountChanged: this.updateChildCount.bind(this),\r\n        });\r\n\r\n        // filtering changes the child count, so need to cater for it\r\n        this.updateChildCount();\r\n    }\r\n\r\n    private updateChildCount(): void {\r\n        const allChildrenCount = this.displayedGroupNode.allChildrenCount;\r\n        const showingGroupForThisNode = this.isShowRowGroupForThisRow();\r\n        const showCount = showingGroupForThisNode && allChildrenCount != null && allChildrenCount >= 0;\r\n        const countString = showCount ? `(${allChildrenCount})` : ``;\r\n        this.comp.setChildCount(countString);\r\n    }\r\n\r\n    private isShowRowGroupForThisRow(): boolean {\r\n        if (this.gos.get('treeData')) {\r\n            return true;\r\n        }\r\n\r\n        const rowGroupColumn = this.displayedGroupNode.rowGroupColumn;\r\n\r\n        if (!rowGroupColumn) {\r\n            return false;\r\n        }\r\n\r\n        // column is null for fullWidthRows\r\n        const column = this.params.column;\r\n        const thisColumnIsInterested = column == null || column.isRowGroupDisplayed(rowGroupColumn.getId());\r\n\r\n        return thisColumnIsInterested;\r\n    }\r\n\r\n    private addExpandAndContract(): void {\r\n        const params = this.params;\r\n\r\n        const setupIcon = (iconName: 'groupExpanded' | 'groupContracted', element: HTMLElement) => {\r\n            const icon = _createIconNoSpan(iconName, this.beans, null);\r\n            if (icon) {\r\n                element.appendChild(icon);\r\n                this.addDestroyFunc(() => element.removeChild(icon));\r\n            }\r\n        };\r\n\r\n        setupIcon('groupExpanded', this.eExpanded);\r\n        setupIcon('groupContracted', this.eContracted);\r\n\r\n        const eGroupCell = params.eGridCell;\r\n\r\n        // if editing groups, then double click is to start editing\r\n        const isDoubleClickEdit = this.params.column?.isCellEditable(params.node) && this.gos.get('enableGroupEdit');\r\n        if (!isDoubleClickEdit && this.isExpandable() && !params.suppressDoubleClickExpand) {\r\n            this.addManagedListeners(eGroupCell, { dblclick: this.onCellDblClicked.bind(this) });\r\n        }\r\n\r\n        this.addManagedListeners(this.eExpanded, { click: this.onExpandClicked.bind(this) });\r\n        this.addManagedListeners(this.eContracted, { click: this.onExpandClicked.bind(this) });\r\n\r\n        // expand / contract as the user hits enter\r\n        this.addManagedListeners(eGroupCell, { keydown: this.onKeyDown.bind(this) });\r\n        this.addManagedListeners(params.node, { expandedChanged: this.showExpandAndContractIcons.bind(this) });\r\n\r\n        this.showExpandAndContractIcons();\r\n\r\n        // because we don't show the expand / contract when there are no children, we need to check every time\r\n        // the number of children change.\r\n        const expandableChangedListener = this.onRowNodeIsExpandableChanged.bind(this);\r\n        this.addManagedListeners(this.displayedGroupNode, {\r\n            allChildrenCountChanged: expandableChangedListener,\r\n            masterChanged: expandableChangedListener,\r\n            groupChanged: expandableChangedListener,\r\n            hasChildrenChanged: expandableChangedListener,\r\n        });\r\n    }\r\n\r\n    private onExpandClicked(mouseEvent: MouseEvent): void {\r\n        if (_isStopPropagationForAgGrid(mouseEvent)) {\r\n            return;\r\n        }\r\n\r\n        // so if we expand a node, it does not also get selected.\r\n        _stopPropagationForAgGrid(mouseEvent);\r\n\r\n        this.onExpandOrContract(mouseEvent);\r\n    }\r\n\r\n    private onExpandOrContract(e: MouseEvent | KeyboardEvent): void {\r\n        // must use the displayedGroup, so if data was dragged down, we expand the parent, not this row\r\n        const rowNode: RowNode = this.displayedGroupNode;\r\n        const nextExpandState = !rowNode.expanded;\r\n\r\n        if (!nextExpandState && rowNode.sticky) {\r\n            this.scrollToStickyNode(rowNode);\r\n        }\r\n\r\n        rowNode.setExpanded(nextExpandState, e);\r\n    }\r\n\r\n    private scrollToStickyNode(rowNode: RowNode): void {\r\n        this.ctrlsSvc.getScrollFeature().setVerticalScrollPosition(rowNode.rowTop! - rowNode.stickyRowTop);\r\n    }\r\n\r\n    private isExpandable(): boolean {\r\n        if (this.showingValueForOpenedParent) {\r\n            return true;\r\n        }\r\n\r\n        const rowNode = this.displayedGroupNode;\r\n        const reducedLeafNode = this.colModel.isPivotMode() && rowNode.leafGroup;\r\n        const expandableGroup = rowNode.isExpandable() && !rowNode.footer && !reducedLeafNode;\r\n\r\n        if (!expandableGroup) {\r\n            return false;\r\n        }\r\n\r\n        // column is null for fullWidthRows\r\n        const column = this.params.column;\r\n        const displayingForOneColumnOnly = column != null && typeof column.getColDef().showRowGroup === 'string';\r\n\r\n        if (displayingForOneColumnOnly) {\r\n            const showing = this.isShowRowGroupForThisRow();\r\n            return showing;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private showExpandAndContractIcons(): void {\r\n        const { params, displayedGroupNode: displayedGroup, colModel } = this;\r\n        const { node } = params;\r\n\r\n        const isExpandable = this.isExpandable();\r\n\r\n        if (isExpandable) {\r\n            // if expandable, show one based on expand state.\r\n            // if we were dragged down, means our parent is always expanded\r\n            const expanded = this.showingValueForOpenedParent ? true : node.expanded;\r\n            this.comp.setExpandedDisplayed(expanded);\r\n            this.comp.setContractedDisplayed(!expanded);\r\n        } else {\r\n            // it not expandable, show neither\r\n            this.comp.setExpandedDisplayed(false);\r\n            this.comp.setContractedDisplayed(false);\r\n        }\r\n\r\n        // compensation padding for leaf nodes, so there is blank space instead of the expand icon\r\n        const pivotMode = colModel.isPivotMode();\r\n        const pivotModeAndLeafGroup = pivotMode && displayedGroup.leafGroup;\r\n        const addExpandableCss = isExpandable && !pivotModeAndLeafGroup;\r\n        const isTotalFooterNode = node.footer && node.level === -1;\r\n\r\n        this.comp.addOrRemoveCssClass('ag-cell-expandable', addExpandableCss);\r\n        this.comp.addOrRemoveCssClass('ag-row-group', addExpandableCss);\r\n\r\n        if (pivotMode) {\r\n            this.comp.addOrRemoveCssClass('ag-pivot-leaf-group', !!pivotModeAndLeafGroup);\r\n        } else if (!isTotalFooterNode) {\r\n            this.comp.addOrRemoveCssClass('ag-row-group-leaf-indent', !addExpandableCss);\r\n        }\r\n    }\r\n\r\n    private onRowNodeIsExpandableChanged(): void {\r\n        // maybe if no children now, we should hide the expand / contract icons\r\n        this.showExpandAndContractIcons();\r\n\r\n        // if we have no children, this impacts the indent\r\n        this.setIndent();\r\n\r\n        this.refreshAriaExpanded();\r\n    }\r\n\r\n    private setupIndent(): void {\r\n        // only do this if an indent - as this overwrites the padding that\r\n        // the theme set, which will make things look 'not aligned' for the\r\n        // first group level.\r\n        const node: RowNode = this.params.node as RowNode;\r\n        const suppressPadding = this.params.suppressPadding;\r\n\r\n        if (!suppressPadding) {\r\n            this.addManagedListeners(node, { uiLevelChanged: this.setIndent.bind(this) });\r\n            this.setIndent();\r\n        }\r\n    }\r\n\r\n    private setIndent(): void {\r\n        if (this.gos.get('groupHideOpenParents')) {\r\n            return;\r\n        }\r\n\r\n        const params = this.params;\r\n        const rowNode: IRowNode = params.node;\r\n        // if we are only showing one group column, we don't want to be indenting based on level\r\n        const fullWithRow = !!params.colDef;\r\n        const treeData = this.gos.get('treeData');\r\n        const manyDimensionThisColumn = !fullWithRow || treeData || params.colDef!.showRowGroup === true;\r\n        const paddingCount = manyDimensionThisColumn ? rowNode.uiLevel : 0;\r\n\r\n        if (this.indentClass) {\r\n            this.comp.addOrRemoveCssClass(this.indentClass, false);\r\n        }\r\n\r\n        this.indentClass = 'ag-row-group-indent-' + paddingCount;\r\n        this.comp.addOrRemoveCssClass(this.indentClass, true);\r\n        this.eGui.style.setProperty('--ag-indentation-level', String(paddingCount));\r\n    }\r\n\r\n    private addFullWidthRowDraggerIfNeeded(): void {\r\n        if (!this.params.fullWidth || !this.params.rowDrag || !this.rowDragSvc) {\r\n            return;\r\n        }\r\n\r\n        const rowDragComp = this.rowDragSvc.createRowDragComp(() => this.params.value, this.params.node as RowNode);\r\n        this.createManagedBean(rowDragComp);\r\n\r\n        this.eGui.insertAdjacentElement('afterbegin', rowDragComp.getGui());\r\n    }\r\n\r\n    private addCheckboxIfNeeded(): void {\r\n        const rowNode = this.displayedGroupNode;\r\n        const rowSelection = this.gos.get('rowSelection');\r\n        const checkboxLocation = _getCheckboxLocation(rowSelection);\r\n        const checkboxes =\r\n            typeof rowSelection === 'object'\r\n                ? checkboxLocation === 'autoGroupColumn' && _getCheckboxes(rowSelection)\r\n                : this.params.checkbox;\r\n        const userWantsSelected = typeof checkboxes === 'function' || checkboxes === true;\r\n\r\n        const checkboxNeeded =\r\n            userWantsSelected &&\r\n            // footers cannot be selected\r\n            !rowNode.footer &&\r\n            // pinned rows cannot be selected\r\n            !rowNode.rowPinned &&\r\n            // details cannot be selected\r\n            !rowNode.detail &&\r\n            !!this.selectionSvc &&\r\n            _isRowSelection(this.gos);\r\n\r\n        if (checkboxNeeded) {\r\n            const cbSelectionComponent = this.selectionSvc!.createCheckboxSelectionComponent();\r\n            this.cbComp = cbSelectionComponent;\r\n            this.createBean(cbSelectionComponent);\r\n\r\n            cbSelectionComponent.init({\r\n                rowNode: this.params.node as RowNode, // when groupHideOpenParents = true and group expanded, we want the checkbox to refer to leaf node state (not group node state)\r\n                column: this.params.column as AgColumn,\r\n                overrides: {\r\n                    isVisible: checkboxes,\r\n                    callbackParams: this.params,\r\n                    removeHidden: true,\r\n                },\r\n            });\r\n            this.eCheckbox.appendChild(cbSelectionComponent.getGui());\r\n        }\r\n\r\n        this.comp.setCheckboxVisible(checkboxNeeded);\r\n    }\r\n\r\n    private destroyCheckbox(): void {\r\n        this.cbComp && this.eCheckbox.removeChild(this.cbComp.getGui());\r\n        this.cbComp = this.destroyBean(this.cbComp);\r\n    }\r\n\r\n    private refreshCheckbox(): void {\r\n        this.destroyCheckbox();\r\n        this.addCheckboxIfNeeded();\r\n    }\r\n\r\n    private onKeyDown(event: KeyboardEvent): void {\r\n        const isEnterKey = event.key === KeyCode.ENTER;\r\n\r\n        if (!isEnterKey || this.params.suppressEnterExpand) {\r\n            return;\r\n        }\r\n\r\n        const cellEditable = this.params.column && this.params.column.isCellEditable(this.params.node);\r\n\r\n        if (cellEditable) {\r\n            return;\r\n        }\r\n\r\n        this.onExpandOrContract(event);\r\n    }\r\n\r\n    private onCellDblClicked(mouseEvent: MouseEvent): void {\r\n        if (_isStopPropagationForAgGrid(mouseEvent)) {\r\n            return;\r\n        }\r\n\r\n        // we want to avoid acting on double click events on the expand / contract icon,\r\n        // as that icons already has expand / collapse functionality on it. otherwise if\r\n        // the icon was double clicked, we would get 'click', 'click', 'dblclick' which\r\n        // is open->close->open, however double click should be open->close only.\r\n        const targetIsExpandIcon =\r\n            _isElementInEventPath(this.eExpanded, mouseEvent) || _isElementInEventPath(this.eContracted, mouseEvent);\r\n\r\n        if (!targetIsExpandIcon) {\r\n            this.onExpandOrContract(mouseEvent);\r\n        }\r\n    }\r\n}\r\n", "import { BeanStub } from 'ag-grid-community';\r\nimport type { AgColumn, IShowRowGroupColsService, NamedBean } from 'ag-grid-community';\r\n\r\nexport class ShowRowGroupColsService extends BeanStub implements NamedBean, IShowRowGroupColsService {\r\n    beanName = 'showRowGroupCols' as const;\r\n\r\n    private showRowGroupCols: AgColumn[];\r\n    private showRowGroupColsMap: { [originalColumnId: string]: AgColumn };\r\n\r\n    public refresh(): void {\r\n        this.showRowGroupCols = [];\r\n        this.showRowGroupColsMap = {};\r\n\r\n        const { colModel, rowGroupColsSvc } = this.beans;\r\n\r\n        colModel.getCols().forEach((col) => {\r\n            const colDef = col.getColDef();\r\n            const showRowGroup = colDef.showRowGroup;\r\n\r\n            const isString = typeof showRowGroup === 'string';\r\n            const isTrue = showRowGroup === true;\r\n\r\n            if (!isString && !isTrue) {\r\n                return;\r\n            }\r\n\r\n            this.showRowGroupCols.push(col);\r\n\r\n            if (isString) {\r\n                this.showRowGroupColsMap[showRowGroup] = col;\r\n            } else if (rowGroupColsSvc) {\r\n                rowGroupColsSvc.columns.forEach((rowGroupCol) => {\r\n                    this.showRowGroupColsMap[rowGroupCol.getId()] = col;\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    public getShowRowGroupCols(): AgColumn[] {\r\n        return this.showRowGroupCols;\r\n    }\r\n\r\n    public getShowRowGroupCol(id: string): AgColumn | undefined {\r\n        return this.showRowGroupColsMap[id];\r\n    }\r\n\r\n    public getSourceColumnsForGroupColumn(groupCol: AgColumn): AgColumn[] | null {\r\n        const sourceColumnId = groupCol.getColDef().showRowGroup;\r\n        if (!sourceColumnId) {\r\n            return null;\r\n        }\r\n\r\n        const { rowGroupColsSvc, colModel } = this.beans;\r\n        if (sourceColumnId === true && rowGroupColsSvc) {\r\n            return rowGroupColsSvc.columns.slice(0);\r\n        }\r\n\r\n        const column = colModel.getColDefCol(sourceColumnId as string);\r\n        return column ? [column] : null;\r\n    }\r\n\r\n    public isRowGroupDisplayed(column: AgColumn, colId: string): boolean {\r\n        const { colDef } = column;\r\n        if (colDef?.showRowGroup == null) {\r\n            return false;\r\n        }\r\n\r\n        const showingAllGroups = colDef.showRowGroup === true;\r\n        const showingThisGroup = colDef.showRowGroup === colId;\r\n\r\n        return showingAllGroups || showingThisGroup;\r\n    }\r\n}\r\n", "import type { IStickyRowService, NamedBean, RowCtrl, RowNode } from 'ag-grid-community';\r\nimport { BeanStub, _isClientSideRowModel, _isGroupRowsSticky, _isServerSideRowModel } from 'ag-grid-community';\r\n\r\nimport { StickyRowFeature } from './stickyRowFeature';\r\n\r\nexport class StickyRowService extends BeanStub implements NamedBean, IStickyRowService {\r\n    beanName = 'stickyRowSvc' as const;\r\n\r\n    public createStickyRowFeature(\r\n        ctrl: BeanStub,\r\n        createRowCon: (rowNode: RowNode, animate: boolean, afterScroll: boolean) => RowCtrl,\r\n        destroyRowCtrls: (rowCtrlsMap: Record<string, RowCtrl> | null | undefined, animate: boolean) => void\r\n    ): StickyRowFeature | undefined {\r\n        const gos = this.gos;\r\n        if ((_isGroupRowsSticky(gos) && _isClientSideRowModel(gos)) || _isServerSideRowModel(gos)) {\r\n            return ctrl.createManagedBean(new StickyRowFeature(createRowCon, destroyRowCtrls));\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n", "import type { GridBodyCtrl, IStickyRowFeature, RowCtrl, RowNode } from 'ag-grid-community';\r\nimport { BeanStub, _getRowHeightForNode, _isClientSideRowModel, _isGroupRowsSticky, _last } from 'ag-grid-community';\r\n\r\nexport class StickyRowFeature extends BeanStub implements IStickyRowFeature {\r\n    public stickyTopRowCtrls: RowCtrl[] = [];\r\n    public stickyBottomRowCtrls: RowCtrl[] = [];\r\n    private gridBodyCtrl: GridBodyCtrl;\r\n    private topContainerHeight: number;\r\n    private bottomContainerHeight: number;\r\n    private isClientSide: boolean;\r\n\r\n    // sticky rows pulls in extra rows from other pages which impacts row position\r\n    public extraTopHeight = 0;\r\n    public extraBottomHeight = 0;\r\n\r\n    constructor(\r\n        private readonly createRowCon: (rowNode: RowNode, animate: boolean, afterScroll: boolean) => RowCtrl,\r\n        private readonly destroyRowCtrls: (\r\n            rowCtrlsMap: Record<string, RowCtrl> | null | undefined,\r\n            animate: boolean\r\n        ) => void\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.isClientSide = _isClientSideRowModel(this.gos);\r\n\r\n        this.beans.ctrlsSvc.whenReady(this, (params) => {\r\n            this.gridBodyCtrl = params.gridBodyCtrl;\r\n        });\r\n\r\n        this.resetStickyContainers();\r\n    }\r\n\r\n    private setOffsetTop(offset: number): void {\r\n        if (this.extraTopHeight === offset) {\r\n            return;\r\n        }\r\n        this.extraTopHeight = offset;\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'stickyTopOffsetChanged',\r\n            offset,\r\n        });\r\n    }\r\n\r\n    private setOffsetBottom(offset: number): void {\r\n        if (this.extraBottomHeight === offset) {\r\n            return;\r\n        }\r\n        this.extraBottomHeight = offset;\r\n    }\r\n\r\n    public resetOffsets() {\r\n        this.setOffsetBottom(0);\r\n        this.setOffsetTop(0);\r\n    }\r\n\r\n    /**\r\n     * Get the last pixel of the group, this pixel is used to push the sticky node up out of the viewport.\r\n     */\r\n    private getLastPixelOfGroup(row: RowNode): number {\r\n        return this.isClientSide ? getClientSideLastPixelOfGroup(row) : getServerSideLastPixelOfGroup(row);\r\n    }\r\n\r\n    /**\r\n     * Get the first pixel of the group, this pixel is used to push the sticky node down out of the viewport\r\n     */\r\n    private getFirstPixelOfGroup(row: RowNode): number {\r\n        if (row.footer) {\r\n            return row.sibling!.rowTop! + row.sibling!.rowHeight! - 1;\r\n        }\r\n\r\n        if (row.hasChildren()) {\r\n            return row.rowTop! - 1;\r\n        }\r\n\r\n        // only footer nodes stick bottom, so shouldn't reach this.\r\n        return 0;\r\n    }\r\n\r\n    private updateStickyRows(container: 'top' | 'bottom'): boolean {\r\n        const isTop = container === 'top';\r\n        let newStickyContainerHeight = 0;\r\n\r\n        if (!this.canRowsBeSticky()) {\r\n            return this.refreshNodesAndContainerHeight(container, new Set(), newStickyContainerHeight);\r\n        }\r\n\r\n        const { rowModel, rowRenderer } = this.beans;\r\n\r\n        const pixelAtContainerBoundary = isTop\r\n            ? rowRenderer.firstVisibleVPixel - this.extraTopHeight\r\n            : rowRenderer.lastVisibleVPixel - this.extraTopHeight;\r\n        const newStickyRows = new Set<RowNode>();\r\n\r\n        const addStickyRow = (stickyRow: RowNode) => {\r\n            newStickyRows.add(stickyRow);\r\n\r\n            if (isTop) {\r\n                // get the pixel which stops this node being sticky.\r\n                const lastChildBottom = this.getLastPixelOfGroup(stickyRow);\r\n                const stickRowBottom = pixelAtContainerBoundary + newStickyContainerHeight + stickyRow.rowHeight!;\r\n                if (lastChildBottom < stickRowBottom) {\r\n                    stickyRow.stickyRowTop = newStickyContainerHeight + (lastChildBottom - stickRowBottom);\r\n                } else {\r\n                    stickyRow.stickyRowTop = newStickyContainerHeight;\r\n                }\r\n            } else {\r\n                // get the pixel which stops this node being sticky.\r\n                const lastChildBottom = this.getFirstPixelOfGroup(stickyRow);\r\n                const stickRowTop = pixelAtContainerBoundary - (newStickyContainerHeight + stickyRow.rowHeight!);\r\n                if (lastChildBottom > stickRowTop) {\r\n                    stickyRow.stickyRowTop = newStickyContainerHeight - (lastChildBottom - stickRowTop);\r\n                } else {\r\n                    stickyRow.stickyRowTop = newStickyContainerHeight;\r\n                }\r\n            }\r\n\r\n            // have to recalculate height after each row has been added, to allow\r\n            // calculating the next sticky row\r\n            newStickyContainerHeight = 0;\r\n            newStickyRows.forEach((rowNode) => {\r\n                const thisRowLastPx = rowNode.stickyRowTop + rowNode.rowHeight!;\r\n                if (newStickyContainerHeight < thisRowLastPx) {\r\n                    newStickyContainerHeight = thisRowLastPx;\r\n                }\r\n            });\r\n        };\r\n\r\n        const suppressFootersSticky = this.areFooterRowsStickySuppressed();\r\n        const suppressGroupsSticky = this.gos.get('suppressGroupRowsSticky');\r\n        const isRowSticky = (row: RowNode) => {\r\n            if (!row.displayed) {\r\n                return false;\r\n            }\r\n\r\n            if (row.footer) {\r\n                if (suppressFootersSticky === true) {\r\n                    return false;\r\n                }\r\n                if (suppressFootersSticky === 'grand' && row.level === -1) {\r\n                    return false;\r\n                }\r\n                if (suppressFootersSticky === 'group' && row.level > -1) {\r\n                    return false;\r\n                }\r\n                const isFooterFirstRowInGroup = row.sibling.rowIndex\r\n                    ? row.sibling.rowIndex + 1 === row.rowIndex\r\n                    : false;\r\n                if (container === 'bottom' && isFooterFirstRowInGroup) {\r\n                    return false;\r\n                }\r\n\r\n                const alreadySticking = newStickyRows.has(row);\r\n                return !alreadySticking;\r\n            }\r\n\r\n            if (row.isExpandable()) {\r\n                if (suppressGroupsSticky === true) {\r\n                    return false;\r\n                }\r\n                if (container === 'bottom') {\r\n                    // Group rows should never stick to the bottom of the viewport\r\n                    return false;\r\n                }\r\n                const alreadySticking = newStickyRows.has(row);\r\n                return !alreadySticking && row.expanded;\r\n            }\r\n\r\n            return false;\r\n        };\r\n\r\n        // arbitrary counter to prevent infinite loop break out of the loop when the row calculation\r\n        // changes while rows are becoming sticky (happens with auto height)\r\n        for (let i = 0; i < 100; i++) {\r\n            let firstPixelAfterStickyRows = pixelAtContainerBoundary + newStickyContainerHeight;\r\n            if (!isTop) {\r\n                firstPixelAfterStickyRows = pixelAtContainerBoundary - newStickyContainerHeight;\r\n            }\r\n            const firstIndex = rowModel.getRowIndexAtPixel(firstPixelAfterStickyRows);\r\n            const firstRow = rowModel.getRow(firstIndex);\r\n\r\n            if (firstRow == null) {\r\n                break;\r\n            }\r\n\r\n            const ancestors: RowNode[] = this.getStickyAncestors(firstRow);\r\n            const firstMissingParent = ancestors.find(\r\n                (parent) =>\r\n                    (isTop ? parent.rowIndex! < firstIndex : parent.rowIndex! > firstIndex) && isRowSticky(parent)\r\n            );\r\n            if (firstMissingParent) {\r\n                addStickyRow(firstMissingParent);\r\n                continue;\r\n            }\r\n\r\n            const isFirstRowOutsideViewport = isTop\r\n                ? firstRow.rowTop! < firstPixelAfterStickyRows\r\n                : firstRow.rowTop! + firstRow.rowHeight! > firstPixelAfterStickyRows;\r\n            // if first row is an open group, and partially shown, it needs\r\n            // to be stuck\r\n            if (isFirstRowOutsideViewport && isRowSticky(firstRow)) {\r\n                addStickyRow(firstRow);\r\n                continue;\r\n            }\r\n\r\n            break;\r\n        }\r\n\r\n        if (!isTop) {\r\n            // Because sticky bottom rows are calculated inverted, we need to invert the top position\r\n            newStickyRows.forEach((rowNode) => {\r\n                rowNode.stickyRowTop = newStickyContainerHeight - (rowNode.stickyRowTop + rowNode.rowHeight!);\r\n            });\r\n        }\r\n\r\n        return this.refreshNodesAndContainerHeight(container, newStickyRows, newStickyContainerHeight);\r\n    }\r\n\r\n    private areFooterRowsStickySuppressed(): boolean | 'grand' | 'group' {\r\n        const suppressFootersSticky = this.gos.get('suppressStickyTotalRow');\r\n        if (suppressFootersSticky === true) {\r\n            return true;\r\n        }\r\n\r\n        const suppressGroupRows = suppressFootersSticky === 'group';\r\n        const suppressGrandRows = suppressFootersSticky === 'grand';\r\n        if (suppressGroupRows && suppressGrandRows) {\r\n            return true;\r\n        }\r\n\r\n        if (suppressGrandRows) {\r\n            return 'grand';\r\n        }\r\n\r\n        if (suppressGroupRows) {\r\n            return 'group';\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private canRowsBeSticky(): boolean {\r\n        const isStickyEnabled = _isGroupRowsSticky(this.gos);\r\n        const suppressFootersSticky = this.areFooterRowsStickySuppressed();\r\n        const suppressGroupsSticky = this.gos.get('suppressGroupRowsSticky');\r\n        return isStickyEnabled && (!suppressFootersSticky || !suppressGroupsSticky);\r\n    }\r\n\r\n    private getStickyAncestors(rowNode: RowNode): RowNode[] {\r\n        const ancestors: RowNode[] = [];\r\n        let p = rowNode.footer ? rowNode.sibling : rowNode.parent;\r\n        while (p) {\r\n            if (p.sibling) {\r\n                ancestors.push(p.sibling);\r\n            }\r\n            ancestors.push(p);\r\n            p = p.parent!;\r\n        }\r\n        return ancestors.reverse();\r\n    }\r\n\r\n    public checkStickyRows(): boolean {\r\n        const hasTopUpdated = this.updateStickyRows('top');\r\n        const hasBottomUpdated = this.updateStickyRows('bottom');\r\n        return hasTopUpdated || hasBottomUpdated;\r\n    }\r\n\r\n    public destroyStickyCtrls(): void {\r\n        this.resetStickyContainers();\r\n    }\r\n\r\n    private resetStickyContainers(): void {\r\n        this.refreshNodesAndContainerHeight('top', new Set(), 0);\r\n        this.refreshNodesAndContainerHeight('bottom', new Set(), 0);\r\n    }\r\n\r\n    public refreshStickyNode(stickRowNode: RowNode): void {\r\n        const allStickyNodes = new Set<RowNode>();\r\n        if (this.stickyTopRowCtrls.some((ctrl) => ctrl.rowNode === stickRowNode)) {\r\n            for (let i = 0; i < this.stickyTopRowCtrls.length; i++) {\r\n                const currentNode = this.stickyTopRowCtrls[i].rowNode;\r\n                if (currentNode !== stickRowNode) {\r\n                    allStickyNodes.add(currentNode);\r\n                }\r\n            }\r\n\r\n            if (this.refreshNodesAndContainerHeight('top', allStickyNodes, this.topContainerHeight)) {\r\n                this.checkStickyRows();\r\n            }\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < this.stickyBottomRowCtrls.length; i++) {\r\n            const currentNode = this.stickyBottomRowCtrls[i].rowNode;\r\n            if (currentNode !== stickRowNode) {\r\n                allStickyNodes.add(currentNode);\r\n            }\r\n        }\r\n\r\n        if (this.refreshNodesAndContainerHeight('bottom', allStickyNodes, this.bottomContainerHeight)) {\r\n            this.checkStickyRows();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Destroy old ctrls and create new ctrls where necessary.\r\n     */\r\n    private refreshNodesAndContainerHeight(\r\n        container: 'top' | 'bottom',\r\n        newStickyNodes: Set<RowNode>,\r\n        height: number\r\n    ): boolean {\r\n        const isTop = container === 'top';\r\n        const previousCtrls = isTop ? this.stickyTopRowCtrls : this.stickyBottomRowCtrls;\r\n\r\n        // find removed ctrls and remaining ctrls\r\n        const removedCtrlsMap: Record<string, RowCtrl> = {};\r\n        const remainingCtrls: RowCtrl[] = [];\r\n        for (let i = 0; i < previousCtrls.length; i++) {\r\n            const node = previousCtrls[i].rowNode;\r\n            const hasBeenRemoved = !newStickyNodes.has(node);\r\n            if (hasBeenRemoved) {\r\n                removedCtrlsMap[node.id!] = previousCtrls[i];\r\n\r\n                // if no longer sticky, remove sticky flag.\r\n                node.sticky = false;\r\n                continue;\r\n            }\r\n\r\n            remainingCtrls.push(previousCtrls[i]);\r\n        }\r\n\r\n        // get set of existing nodes for quick lookup\r\n        const existingNodes = new Set<RowNode>();\r\n        for (let i = 0; i < remainingCtrls.length; i++) {\r\n            existingNodes.add(remainingCtrls[i].rowNode);\r\n        }\r\n\r\n        // find the new ctrls to add\r\n        const newCtrls: RowCtrl[] = [];\r\n        newStickyNodes.forEach((node) => {\r\n            if (existingNodes.has(node)) {\r\n                return;\r\n            }\r\n            // ensure new node is set to sticky and create the new ctrl\r\n            node.sticky = true;\r\n            newCtrls.push(this.createRowCon(node, false, false));\r\n        });\r\n\r\n        // check if anything has changed\r\n        let hasSomethingChanged = !!newCtrls.length || remainingCtrls.length !== previousCtrls.length;\r\n        if (isTop) {\r\n            if (this.topContainerHeight !== height) {\r\n                this.topContainerHeight = height;\r\n                this.gridBodyCtrl.setStickyTopHeight(height);\r\n                hasSomethingChanged = true;\r\n            }\r\n        } else {\r\n            if (this.bottomContainerHeight !== height) {\r\n                this.bottomContainerHeight = height;\r\n                this.gridBodyCtrl.setStickyBottomHeight(height);\r\n                hasSomethingChanged = true;\r\n            }\r\n        }\r\n\r\n        // clean up removed ctrls\r\n        this.destroyRowCtrls(removedCtrlsMap, false);\r\n\r\n        // set up new ctrls list\r\n        const newCtrlsList = [...remainingCtrls, ...newCtrls];\r\n        newCtrlsList.sort((a, b) => b.rowNode.rowIndex! - a.rowNode.rowIndex!);\r\n        if (!isTop) {\r\n            newCtrlsList.reverse();\r\n        }\r\n        newCtrlsList.forEach((ctrl) => ctrl.setRowTop(ctrl.rowNode.stickyRowTop));\r\n\r\n        const pageBounds = this.beans.pageBounds;\r\n        let extraHeight = 0;\r\n        if (isTop) {\r\n            newStickyNodes.forEach((node) => {\r\n                if (node.rowIndex! < pageBounds.getFirstRow()) {\r\n                    extraHeight += node.rowHeight!;\r\n                }\r\n            });\r\n            if (extraHeight > this.topContainerHeight) {\r\n                extraHeight = this.topContainerHeight;\r\n            }\r\n            this.setOffsetTop(extraHeight);\r\n        } else {\r\n            newStickyNodes.forEach((node) => {\r\n                if (node.rowIndex! > pageBounds.getLastRow()) {\r\n                    extraHeight += node.rowHeight!;\r\n                }\r\n            });\r\n            if (extraHeight > this.bottomContainerHeight) {\r\n                extraHeight = this.bottomContainerHeight;\r\n            }\r\n            this.setOffsetBottom(extraHeight);\r\n        }\r\n\r\n        if (!hasSomethingChanged) {\r\n            return false;\r\n        }\r\n\r\n        if (isTop) {\r\n            this.stickyTopRowCtrls = newCtrlsList;\r\n        } else {\r\n            this.stickyBottomRowCtrls = newCtrlsList;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    public ensureRowHeightsValid(): boolean {\r\n        let anyChange = false;\r\n        const updateRowHeight = (ctrl: RowCtrl) => {\r\n            const rowNode = ctrl.rowNode;\r\n            if (rowNode.rowHeightEstimated) {\r\n                const rowHeight = _getRowHeightForNode(this.beans, rowNode);\r\n                rowNode.setRowHeight(rowHeight.height);\r\n                anyChange = true;\r\n            }\r\n        };\r\n        this.stickyTopRowCtrls.forEach(updateRowHeight);\r\n        this.stickyBottomRowCtrls.forEach(updateRowHeight);\r\n        return anyChange;\r\n    }\r\n}\r\n\r\nfunction getServerSideLastPixelOfGroup(row: RowNode): number {\r\n    if (row.isExpandable() || row.footer) {\r\n        if (row.master) {\r\n            return row.detailNode.rowTop! + row.detailNode.rowHeight!;\r\n        }\r\n\r\n        const noOrContiguousSiblings = !row.sibling || Math.abs(row.sibling.rowIndex! - row.rowIndex!) === 1;\r\n        if (noOrContiguousSiblings) {\r\n            let storeBounds = row.childStore?.getStoreBounds();\r\n            if (row.footer) {\r\n                storeBounds = row.sibling.childStore?.getStoreBounds();\r\n            }\r\n            return (storeBounds?.heightPx ?? 0) + (storeBounds?.topPx ?? 0);\r\n        }\r\n\r\n        if (row.footer) {\r\n            return row.rowTop! + row.rowHeight!;\r\n        }\r\n\r\n        return row.sibling!.rowTop! + row.sibling!.rowHeight!;\r\n    }\r\n    // if not a group, then this row shouldn't be sticky currently.\r\n    return Number.MAX_SAFE_INTEGER;\r\n}\r\n\r\nfunction getClientSideLastPixelOfGroup(row: RowNode): number {\r\n    if (row.isExpandable() || row.footer) {\r\n        // grand total row at top, nothing can push it out of sticky.\r\n        const grandTotalAtTop = row.footer && row.rowIndex === 0;\r\n        if (grandTotalAtTop) {\r\n            return Number.MAX_SAFE_INTEGER;\r\n        }\r\n\r\n        // if no siblings, we search the children for the last displayed row, to get last px.\r\n        // equally, if sibling but sibling is contiguous ('top') then sibling cannot be used\r\n        // to find last px\r\n        const noOrContiguousSiblings = !row.sibling || Math.abs(row.sibling.rowIndex! - row.rowIndex!) === 1;\r\n        if (noOrContiguousSiblings) {\r\n            let lastAncestor = row.footer ? row.sibling : row;\r\n            while (lastAncestor.isExpandable() && lastAncestor.expanded) {\r\n                if (lastAncestor.master) {\r\n                    lastAncestor = lastAncestor.detailNode;\r\n                } else if (lastAncestor.childrenAfterSort) {\r\n                    // Tree Data will have `childrenAfterSort` without any nodes, but\r\n                    // the current node will still be marked as expansible.\r\n                    if (lastAncestor.childrenAfterSort.length === 0) {\r\n                        break;\r\n                    }\r\n                    lastAncestor = _last(lastAncestor.childrenAfterSort);\r\n                }\r\n            }\r\n            return lastAncestor.rowTop! + lastAncestor.rowHeight!;\r\n        }\r\n\r\n        // if siblings not contiguous, footer is last row and easiest way for last px\r\n        if (row.footer) {\r\n            return row.rowTop! + row.rowHeight!;\r\n        }\r\n        return row.sibling!.rowTop! + row.sibling!.rowHeight!;\r\n    }\r\n    // if not expandable, then this row shouldn't be sticky currently.\r\n    return Number.MAX_SAFE_INTEGER;\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { ValueColsSvc } from '../aggregation/valueColsSvc';\r\nimport { PivotColsSvc } from '../pivot/pivotColsSvc';\r\nimport { RowGroupColsSvc } from '../rowGrouping/rowGroupColsSvc';\r\nimport { VERSION } from '../version';\r\nimport { AutoColService } from './autoColService';\r\nimport { ClientSideExpansionService } from './clientSideExpansionService';\r\nimport { FlattenStage } from './flattenStage';\r\nimport { GroupCellRenderer } from './rendering/groupCellRenderer';\r\nimport { GroupCellRendererCtrl } from './rendering/groupCellRendererCtrl';\r\nimport { ShowRowGroupColsService } from './showRowGroupColsService';\r\nimport { StickyRowService } from './stickyRowService';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const GroupCellRendererModule: _ModuleWithoutApi = {\r\n    moduleName: 'GroupCellRenderer',\r\n    version: VERSION,\r\n    userComponents: {\r\n        agGroupRowRenderer: GroupCellRenderer,\r\n        agGroupCellRenderer: GroupCellRenderer,\r\n    },\r\n    dynamicBeans: { groupCellRendererCtrl: GroupCellRendererCtrl },\r\n    icons: {\r\n        // shown on row group when contracted (click to expand)\r\n        groupContracted: 'tree-closed',\r\n        // shown on row group when expanded (click to contract)\r\n        groupExpanded: 'tree-open',\r\n    },\r\n    dependsOn: [EnterpriseCoreModule],\r\n};\r\n\r\n/**\r\n * Shared between row grouping and tree data\r\n * @internal\r\n */\r\nexport const GroupColumnModule: _ModuleWithoutApi = {\r\n    moduleName: 'GroupColumn',\r\n    version: VERSION,\r\n    beans: [AutoColService, ShowRowGroupColsService, RowGroupColsSvc, PivotColsSvc, ValueColsSvc],\r\n    dependsOn: [EnterpriseCoreModule, GroupCellRendererModule],\r\n};\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const ClientSideRowModelHierarchyModule: _ModuleWithoutApi = {\r\n    moduleName: 'ClientSideRowModelHierarchy',\r\n    version: VERSION,\r\n    rowModels: ['clientSide'],\r\n    beans: [FlattenStage, ClientSideExpansionService],\r\n    dependsOn: [EnterpriseCoreModule],\r\n};\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const StickyRowModule: _ModuleWithoutApi = {\r\n    moduleName: 'StickyRow',\r\n    version: VERSION,\r\n    beans: [StickyRowService],\r\n};\r\n", "import type { ComponentSelector } from 'ag-grid-community';\r\nimport { Component, _setAriaRole } from 'ag-grid-community';\r\n\r\nimport { PivotDropZonePanel } from './pivotDropZonePanel';\r\nimport { RowGroupDropZonePanel } from './rowGroupDropZonePanel';\r\n\r\nexport class AgGridHeaderDropZones extends Component {\r\n    private rowGroupComp: Component;\r\n    private pivotComp: Component;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.setGui(this.createNorthPanel());\r\n        const onRowGroupChanged = this.onRowGroupChanged.bind(this);\r\n        this.addManagedEventListeners({\r\n            columnRowGroupChanged: onRowGroupChanged,\r\n            newColumnsLoaded: onRowGroupChanged,\r\n        });\r\n        this.addManagedPropertyListener('rowGroupPanelShow', onRowGroupChanged);\r\n        this.addManagedPropertyListener('pivotPanelShow', () => this.onPivotPanelShow());\r\n\r\n        this.onRowGroupChanged();\r\n    }\r\n\r\n    private createNorthPanel(): HTMLElement {\r\n        const topPanelGui = document.createElement('div');\r\n\r\n        topPanelGui.classList.add('ag-column-drop-wrapper');\r\n        _setAriaRole(topPanelGui, 'presentation');\r\n\r\n        const rowGroupComp = new RowGroupDropZonePanel(true);\r\n        this.rowGroupComp = this.createManagedBean(rowGroupComp);\r\n\r\n        const pivotComp = new PivotDropZonePanel(true);\r\n        this.pivotComp = this.createManagedBean(pivotComp);\r\n\r\n        topPanelGui.appendChild(rowGroupComp.getGui());\r\n        topPanelGui.appendChild(pivotComp.getGui());\r\n\r\n        const listener = this.onDropPanelVisible.bind(this);\r\n        this.addManagedListeners(rowGroupComp, {\r\n            displayChanged: listener,\r\n        });\r\n        this.addManagedListeners(pivotComp, {\r\n            displayChanged: listener,\r\n        });\r\n\r\n        this.onDropPanelVisible();\r\n\r\n        return topPanelGui;\r\n    }\r\n\r\n    private onDropPanelVisible(): void {\r\n        const { rowGroupComp, pivotComp } = this;\r\n        const bothDisplayed = rowGroupComp.isDisplayed() && pivotComp.isDisplayed();\r\n        const classStr = 'ag-column-drop-horizontal-half-width';\r\n        rowGroupComp.addOrRemoveCssClass(classStr, bothDisplayed);\r\n        pivotComp.addOrRemoveCssClass(classStr, bothDisplayed);\r\n    }\r\n\r\n    private onRowGroupChanged(): void {\r\n        const rowGroupComp = this.rowGroupComp;\r\n        if (!rowGroupComp) {\r\n            return;\r\n        }\r\n\r\n        const rowGroupPanelShow = this.gos.get('rowGroupPanelShow');\r\n\r\n        if (rowGroupPanelShow === 'always') {\r\n            rowGroupComp.setDisplayed(true);\r\n        } else if (rowGroupPanelShow === 'onlyWhenGrouping') {\r\n            const grouping = this.beans.rowGroupColsSvc?.columns?.length !== 0;\r\n            rowGroupComp.setDisplayed(grouping);\r\n        } else {\r\n            rowGroupComp.setDisplayed(false);\r\n        }\r\n    }\r\n\r\n    private onPivotPanelShow() {\r\n        const pivotComp = this.pivotComp;\r\n        if (!pivotComp) {\r\n            return;\r\n        }\r\n\r\n        const pivotPanelShow = this.gos.get('pivotPanelShow');\r\n\r\n        if (pivotPanelShow === 'always') {\r\n            pivotComp.setDisplayed(true);\r\n        } else if (pivotPanelShow === 'onlyWhenPivoting') {\r\n            const pivoting = this.beans.colModel.isPivotActive();\r\n            pivotComp.setDisplayed(pivoting);\r\n        } else {\r\n            pivotComp.setDisplayed(false);\r\n        }\r\n    }\r\n}\r\n\r\nexport const AgGridHeaderDropZonesSelector: ComponentSelector = {\r\n    selector: 'AG-GRID-HEADER-DROP-ZONES',\r\n    component: AgGridHeaderDropZones,\r\n};\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    FilterDestroyedEvent,\r\n    FilterManager,\r\n    IAfterGuiAttachedParams,\r\n    IFilterComp,\r\n    IFilterParams,\r\n    IShowRowGroupColsService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgPromise,\r\n    AgSelect,\r\n    FilterWrapperComp,\r\n    RefPlaceholder,\r\n    TabGuardComp,\r\n    _clearElement,\r\n    _loadTemplate,\r\n    _setDisplayed,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\ninterface FilterColumnPair {\r\n    filter: IFilterComp;\r\n    column: AgColumn;\r\n}\r\n\r\nexport type GroupFilterEvent = 'columnRowGroupChanged' | 'selectedColumnChanged';\r\nexport class GroupFilter extends TabGuardComp<GroupFilterEvent> implements IFilterComp {\r\n    private filterManager?: FilterManager;\r\n    private showRowGroupCols?: IShowRowGroupColsService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.filterManager = beans.filterManager;\r\n        this.showRowGroupCols = beans.showRowGroupCols;\r\n    }\r\n\r\n    private readonly eGroupField: HTMLElement = RefPlaceholder;\r\n    private readonly eUnderlyingFilter: HTMLElement = RefPlaceholder;\r\n\r\n    private params: IFilterParams;\r\n    private groupColumn: AgColumn;\r\n    private selectedColumn: AgColumn | undefined;\r\n    private selectedFilter: IFilterComp | undefined;\r\n    private filterColumnPairs: FilterColumnPair[] | undefined;\r\n    private eGroupFieldSelect: AgSelect;\r\n    private afterGuiAttachedParams: IAfterGuiAttachedParams | undefined;\r\n    private filterWrapperComp?: FilterWrapperComp;\r\n\r\n    constructor() {\r\n        super(/* html */ `\r\n            <div class=\"ag-group-filter\">\r\n                <div data-ref=\"eGroupField\"></div>\r\n                <div data-ref=\"eUnderlyingFilter\"></div>\r\n            </div>\r\n        `);\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.initialiseTabGuard({});\r\n    }\r\n\r\n    public init(params: IFilterParams): AgPromise<void> {\r\n        return this.updateParams(params).then(() => {\r\n            this.addManagedEventListeners({\r\n                columnRowGroupChanged: () => this.onColumnRowGroupChanged(),\r\n                filterDestroyed: (event) => this.onFilterDestroyed(event),\r\n            });\r\n        });\r\n    }\r\n\r\n    public refresh(params: IFilterParams): boolean {\r\n        this.updateParams(params);\r\n        return true;\r\n    }\r\n\r\n    private updateParams(params: IFilterParams): AgPromise<void> {\r\n        this.params = params;\r\n        this.validateParams();\r\n        return this.updateGroups();\r\n    }\r\n\r\n    private validateParams(): void {\r\n        const { colDef } = this.params;\r\n        if (colDef.field) {\r\n            _warn(234);\r\n        }\r\n        if (colDef.filterValueGetter) {\r\n            _warn(235);\r\n        }\r\n        if (colDef.filterParams) {\r\n            _warn(236);\r\n        }\r\n    }\r\n\r\n    private updateGroups(): AgPromise<void> {\r\n        const sourceColumns = this.updateGroupField();\r\n        return this.getUnderlyingFilters(sourceColumns);\r\n    }\r\n\r\n    private getSourceColumns(): AgColumn[] {\r\n        this.groupColumn = this.params.column as AgColumn;\r\n        if (this.gos.get('treeData')) {\r\n            _warn(237);\r\n            return [];\r\n        }\r\n        const sourceColumns = this.showRowGroupCols?.getSourceColumnsForGroupColumn(this.groupColumn);\r\n        if (!sourceColumns) {\r\n            _warn(183);\r\n            return [];\r\n        }\r\n        return sourceColumns;\r\n    }\r\n\r\n    private updateGroupField(): AgColumn[] | null {\r\n        const eGroupField = this.eGroupField;\r\n        _clearElement(eGroupField);\r\n        if (this.eGroupFieldSelect) {\r\n            this.destroyBean(this.eGroupFieldSelect);\r\n        }\r\n        const allSourceColumns = this.getSourceColumns();\r\n        const sourceColumns = allSourceColumns.filter((sourceColumn) => sourceColumn.isFilterAllowed());\r\n        if (!sourceColumns.length) {\r\n            this.selectedColumn = undefined;\r\n            _setDisplayed(eGroupField, false);\r\n            return null;\r\n        }\r\n        if (allSourceColumns.length === 1) {\r\n            // we only want to hide the group field element if there's only one group column.\r\n            // If there's one group column that has a filter, but multiple columns in total,\r\n            // we should still show the select so the user knows which column it's for.\r\n            this.selectedColumn = sourceColumns[0];\r\n            _setDisplayed(eGroupField, false);\r\n        } else {\r\n            // keep the old selected column if it's still valid\r\n            if (\r\n                !this.selectedColumn ||\r\n                !sourceColumns.some((column) => column.getId() === this.selectedColumn!.getId())\r\n            ) {\r\n                this.selectedColumn = sourceColumns[0];\r\n            }\r\n            this.createGroupFieldSelectElement(sourceColumns);\r\n            eGroupField.appendChild(this.eGroupFieldSelect.getGui());\r\n            eGroupField.appendChild(_loadTemplate(/* html */ `<div class=\"ag-filter-separator\"></div>`));\r\n            _setDisplayed(eGroupField, true);\r\n        }\r\n\r\n        return sourceColumns;\r\n    }\r\n\r\n    private createGroupFieldSelectElement(sourceColumns: AgColumn[]): void {\r\n        const eGroupFieldSelect = this.createManagedBean(new AgSelect());\r\n        this.eGroupFieldSelect = eGroupFieldSelect;\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        eGroupFieldSelect.setLabel(localeTextFunc('groupFilterSelect', 'Select field:'));\r\n        eGroupFieldSelect.setLabelAlignment('top');\r\n        eGroupFieldSelect.addOptions(\r\n            sourceColumns.map((sourceColumn) => ({\r\n                value: sourceColumn.getId(),\r\n                text: this.beans.colNames.getDisplayNameForColumn(sourceColumn, 'groupFilter', false) ?? undefined,\r\n            }))\r\n        );\r\n        eGroupFieldSelect.setValue(this.selectedColumn!.getId());\r\n        eGroupFieldSelect.onValueChange((newValue) => this.updateSelectedColumn(newValue));\r\n        eGroupFieldSelect.addCssClass('ag-group-filter-field-select-wrapper');\r\n        if (sourceColumns.length === 1) {\r\n            eGroupFieldSelect.setDisabled(true);\r\n        }\r\n    }\r\n\r\n    private getUnderlyingFilters(sourceColumns: AgColumn[] | null): AgPromise<void> {\r\n        if (!sourceColumns) {\r\n            this.filterColumnPairs = undefined;\r\n            this.selectedFilter = undefined;\r\n            this.beans.colFilter?.setColFilterActive(this.groupColumn, false, 'columnRowGroupChanged');\r\n            return AgPromise.resolve();\r\n        }\r\n        const filterPromises: AgPromise<IFilterComp>[] = [];\r\n        const filterColumnPairs: FilterColumnPair[] = [];\r\n        sourceColumns.forEach((column) => {\r\n            const filterWrapper = this.filterManager!.getOrCreateFilterWrapper(column);\r\n            if (filterWrapper?.filterPromise) {\r\n                filterPromises.push(\r\n                    filterWrapper.filterPromise.then((filter) => {\r\n                        if (filter) {\r\n                            filterColumnPairs.push({\r\n                                filter,\r\n                                column,\r\n                            });\r\n                        }\r\n                        if (column.getId() === this.selectedColumn!.getId()) {\r\n                            this.selectedFilter = filter ?? undefined;\r\n                        }\r\n                        return filter!;\r\n                    })\r\n                );\r\n            }\r\n        });\r\n        return AgPromise.all(filterPromises).then(() => {\r\n            this.filterColumnPairs = filterColumnPairs;\r\n            this.beans.colFilter?.setColFilterActive(this.groupColumn, this.isFilterActive(), 'columnRowGroupChanged');\r\n        });\r\n    }\r\n\r\n    private addUnderlyingFilterElement(): AgPromise<void> {\r\n        _clearElement(this.eUnderlyingFilter);\r\n        if (!this.selectedColumn) {\r\n            return AgPromise.resolve();\r\n        }\r\n        const comp = this.createManagedBean(new FilterWrapperComp(this.selectedColumn, 'COLUMN_MENU'));\r\n        this.filterWrapperComp = comp;\r\n        if (!comp.hasFilter()) {\r\n            return AgPromise.resolve();\r\n        }\r\n        this.eUnderlyingFilter.appendChild(comp.getGui());\r\n\r\n        return (\r\n            comp.getFilter()?.then(() => {\r\n                comp.afterGuiAttached?.(this.afterGuiAttachedParams);\r\n                if (\r\n                    !this.afterGuiAttachedParams?.suppressFocus &&\r\n                    this.eGroupFieldSelect &&\r\n                    !this.eGroupFieldSelect.isDisabled()\r\n                ) {\r\n                    this.eGroupFieldSelect.getFocusableElement().focus();\r\n                }\r\n            }) ?? AgPromise.resolve()\r\n        );\r\n    }\r\n\r\n    private updateSelectedColumn(columnId: string | null | undefined): void {\r\n        if (!columnId) {\r\n            return;\r\n        }\r\n        this.filterWrapperComp?.afterGuiDetached();\r\n        this.destroyBean(this.filterWrapperComp);\r\n        const selectedFilterColumnPair = this.getFilterColumnPair(columnId);\r\n        this.selectedColumn = selectedFilterColumnPair?.column;\r\n        this.selectedFilter = selectedFilterColumnPair?.filter;\r\n\r\n        this.dispatchLocalEvent({\r\n            type: 'selectedColumnChanged',\r\n        });\r\n        this.addUnderlyingFilterElement();\r\n    }\r\n\r\n    public isFilterActive(): boolean {\r\n        return !!this.filterColumnPairs?.some(({ filter }) => filter.isFilterActive());\r\n    }\r\n\r\n    public doesFilterPass(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public getModel(): null {\r\n        return null;\r\n    }\r\n\r\n    public setModel(): AgPromise<void> {\r\n        return AgPromise.resolve();\r\n    }\r\n\r\n    public afterGuiAttached(params?: IAfterGuiAttachedParams): void {\r\n        this.afterGuiAttachedParams = params;\r\n        this.addUnderlyingFilterElement();\r\n    }\r\n\r\n    public afterGuiDetached(): void {\r\n        _clearElement(this.eUnderlyingFilter);\r\n        this.selectedFilter?.afterGuiDetached?.();\r\n    }\r\n\r\n    private onColumnRowGroupChanged(): void {\r\n        this.updateGroups().then(() => {\r\n            this.dispatchLocalEvent({\r\n                type: 'columnRowGroupChanged',\r\n            });\r\n        });\r\n    }\r\n\r\n    private onFilterDestroyed({ column: eventColumn, source }: FilterDestroyedEvent): void {\r\n        if (source === 'gridDestroyed') {\r\n            return;\r\n        }\r\n        const colId = eventColumn.getColId();\r\n        if (this.filterColumnPairs?.some(({ column }) => column.getColId() === colId)) {\r\n            // filter may already be getting recreated, so wait before updating\r\n            setTimeout(() => {\r\n                if (this.isAlive()) {\r\n                    this.updateGroups();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    private getFilterColumnPair(columnId: string | undefined): FilterColumnPair | undefined {\r\n        if (!columnId) {\r\n            return undefined;\r\n        }\r\n        return this.filterColumnPairs?.find(({ column }) => column.getId() === columnId);\r\n    }\r\n\r\n    public getSelectedFilter(): IFilterComp | undefined {\r\n        return this.selectedFilter;\r\n    }\r\n\r\n    public getSelectedColumn(): AgColumn | undefined {\r\n        return this.selectedColumn;\r\n    }\r\n\r\n    public isFilterAllowed(): boolean {\r\n        return !!this.selectedColumn;\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    ColumnEvent,\r\n    FilterChangedEvent,\r\n    FilterManager,\r\n    IFloatingFilterComp,\r\n    IFloatingFilterParams,\r\n} from 'ag-grid-community';\r\nimport { AgInputTextField, AgPromise, Component, RefPlaceholder, _clearElement } from 'ag-grid-community';\r\n\r\nimport type { GroupFilter } from './groupFilter';\r\n\r\nexport class GroupFloatingFilterComp extends Component implements IFloatingFilterComp<GroupFilter> {\r\n    private filterManager?: FilterManager;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.filterManager = beans.filterManager;\r\n    }\r\n\r\n    private readonly eFloatingFilter: HTMLElement = RefPlaceholder;\r\n\r\n    private params: IFloatingFilterParams<GroupFilter>;\r\n    private eFloatingFilterText: AgInputTextField;\r\n    private parentFilterInstance: GroupFilter;\r\n    private underlyingFloatingFilter: IFloatingFilterComp | undefined;\r\n    private showingUnderlyingFloatingFilter: boolean;\r\n    private haveAddedColumnListeners: boolean = false;\r\n\r\n    constructor() {\r\n        super(/* html */ `\r\n            <div data-ref=\"eFloatingFilter\" class=\"ag-group-floating-filter ag-floating-filter-input\" role=\"presentation\"></div>\r\n        `);\r\n    }\r\n\r\n    public init(params: IFloatingFilterParams<GroupFilter>): AgPromise<void> {\r\n        this.params = params;\r\n\r\n        // we only support showing the underlying floating filter for multiple group columns\r\n        const canShowUnderlyingFloatingFilter = this.gos.get('groupDisplayType') === 'multipleColumns';\r\n\r\n        return new AgPromise<void>((resolve) => {\r\n            this.params.parentFilterInstance((parentFilterInstance) => {\r\n                this.parentFilterInstance = parentFilterInstance;\r\n\r\n                if (canShowUnderlyingFloatingFilter) {\r\n                    this.setupUnderlyingFloatingFilterElement().then(() => resolve());\r\n                } else {\r\n                    this.setupReadOnlyFloatingFilterElement();\r\n                    resolve();\r\n                }\r\n            });\r\n        }).then(() => {\r\n            const onColChange = this.onColChange.bind(this);\r\n            this.addManagedListeners(this.parentFilterInstance, {\r\n                selectedColumnChanged: onColChange,\r\n                columnRowGroupChanged: onColChange,\r\n            });\r\n        });\r\n    }\r\n\r\n    public refresh(params: IFloatingFilterParams<GroupFilter>): void {\r\n        this.params = params;\r\n        this.setParams();\r\n    }\r\n\r\n    private setParams(): void {\r\n        const displayName = this.beans.colNames.getDisplayNameForColumn(this.params.column as AgColumn, 'header', true);\r\n        const translate = this.getLocaleTextFunc();\r\n        this.eFloatingFilterText?.setInputAriaLabel(`${displayName} ${translate('ariaFilterInput', 'Filter Input')}`);\r\n    }\r\n\r\n    private setupReadOnlyFloatingFilterElement(): void {\r\n        if (!this.eFloatingFilterText) {\r\n            this.eFloatingFilterText = this.createManagedBean(new AgInputTextField());\r\n\r\n            this.eFloatingFilterText\r\n                .setDisabled(true)\r\n                .addGuiEventListener('click', () => this.params.showParentFilter());\r\n\r\n            this.setParams();\r\n        }\r\n\r\n        this.updateDisplayedValue();\r\n\r\n        this.eFloatingFilter.appendChild(this.eFloatingFilterText.getGui());\r\n    }\r\n\r\n    private setupUnderlyingFloatingFilterElement(): AgPromise<void> {\r\n        this.showingUnderlyingFloatingFilter = false;\r\n        this.underlyingFloatingFilter = undefined;\r\n        _clearElement(this.eFloatingFilter);\r\n        const column = this.parentFilterInstance.getSelectedColumn();\r\n        // we can only show the underlying filter if there is one instance (e.g. the underlying column is not visible)\r\n        if (column && !column.isVisible()) {\r\n            const compDetails = this.filterManager!.getFloatingFilterCompDetails(column, this.params.showParentFilter);\r\n            if (compDetails) {\r\n                if (!this.haveAddedColumnListeners) {\r\n                    this.haveAddedColumnListeners = true;\r\n                    this.addManagedListeners(column, {\r\n                        visibleChanged: this.onColumnVisibleChanged.bind(this),\r\n                        colDefChanged: this.onColDefChanged.bind(this),\r\n                    });\r\n                }\r\n                return compDetails.newAgStackInstance().then((floatingFilter) => {\r\n                    this.underlyingFloatingFilter = floatingFilter;\r\n                    this.underlyingFloatingFilter?.onParentModelChanged(\r\n                        this.parentFilterInstance.getSelectedFilter()?.getModel()\r\n                    );\r\n                    this.appendChild(floatingFilter.getGui());\r\n                    this.showingUnderlyingFloatingFilter = true;\r\n                });\r\n            }\r\n        }\r\n        // fallback to the read-only version\r\n        this.setupReadOnlyFloatingFilterElement();\r\n        return AgPromise.resolve();\r\n    }\r\n\r\n    private onColumnVisibleChanged(): void {\r\n        this.setupUnderlyingFloatingFilterElement();\r\n    }\r\n\r\n    private onColDefChanged(event: ColumnEvent): void {\r\n        if (!event.column) {\r\n            return;\r\n        }\r\n        const compDetails = this.filterManager!.getFloatingFilterCompDetails(\r\n            event.column as AgColumn,\r\n            this.params.showParentFilter\r\n        );\r\n        if (compDetails) {\r\n            this.underlyingFloatingFilter?.refresh?.(compDetails.params);\r\n        }\r\n    }\r\n\r\n    public onParentModelChanged(_model: null, event: FilterChangedEvent): void {\r\n        if (this.showingUnderlyingFloatingFilter) {\r\n            this.underlyingFloatingFilter?.onParentModelChanged(\r\n                this.parentFilterInstance.getSelectedFilter()?.getModel(),\r\n                event\r\n            );\r\n        } else {\r\n            this.updateDisplayedValue();\r\n        }\r\n    }\r\n\r\n    private updateDisplayedValue(): void {\r\n        const { eFloatingFilterText, parentFilterInstance } = this;\r\n        if (!parentFilterInstance || !eFloatingFilterText) {\r\n            return;\r\n        }\r\n        const selectedFilter = parentFilterInstance.getSelectedFilter();\r\n        if (!selectedFilter) {\r\n            eFloatingFilterText.setValue('');\r\n            eFloatingFilterText.setDisplayed(false);\r\n            return;\r\n        }\r\n        eFloatingFilterText.setDisplayed(true);\r\n        if (selectedFilter.getModelAsString) {\r\n            const filterModel = selectedFilter.getModel();\r\n            eFloatingFilterText.setValue(filterModel == null ? '' : selectedFilter.getModelAsString(filterModel));\r\n        } else {\r\n            eFloatingFilterText.setValue('');\r\n        }\r\n    }\r\n\r\n    private onColChange(): void {\r\n        if (!this.showingUnderlyingFloatingFilter) {\r\n            this.updateDisplayedValue();\r\n        }\r\n    }\r\n}\r\n", "import type { AgColumn, ChangedPath, Column, IGroupHideOpenParentsService, IRowNode, RowNode } from 'ag-grid-community';\r\nimport { BeanStub, _error, _missing } from 'ag-grid-community';\r\n\r\nimport { setRowNodeGroupValue } from './rowGroupingUtils';\r\n\r\nexport class GroupHideOpenParentsService extends BeanStub implements IGroupHideOpenParentsService {\r\n    beanName = 'groupHideOpenParentsSvc' as const;\r\n\r\n    public updateGroupDataForHideOpenParents(changedPath?: ChangedPath): void {\r\n        if (!this.gos.get('groupHideOpenParents') || this.gos.get('treeData')) {\r\n            return;\r\n        }\r\n\r\n        // recurse breadth first over group nodes after sort to 'pull down' group data to child groups\r\n        const callback = (rowNode: RowNode) => {\r\n            this.pullDownGroupDataForHideOpenParents(rowNode.childrenAfterSort, false);\r\n            rowNode.childrenAfterSort!.forEach((child) => {\r\n                if (child.hasChildren()) {\r\n                    callback(child);\r\n                }\r\n            });\r\n        };\r\n\r\n        if (changedPath) {\r\n            changedPath.executeFromRootNode((rowNode) => callback(rowNode));\r\n        }\r\n    }\r\n\r\n    public pullDownGroupDataForHideOpenParents(rowNodes: RowNode[] | null, clearOperation: boolean): void {\r\n        if (!this.gos.get('groupHideOpenParents') || _missing(rowNodes)) {\r\n            return;\r\n        }\r\n\r\n        const { colModel, showRowGroupCols } = this.beans;\r\n\r\n        rowNodes.forEach((childRowNode) => {\r\n            const groupDisplayCols = showRowGroupCols?.getShowRowGroupCols() ?? [];\r\n            groupDisplayCols.forEach((groupDisplayCol) => {\r\n                const showRowGroup = groupDisplayCol.getColDef().showRowGroup;\r\n                if (typeof showRowGroup !== 'string') {\r\n                    _error(110);\r\n                    return;\r\n                }\r\n\r\n                const displayingGroupKey = showRowGroup;\r\n                const rowGroupColumn = colModel.getColDefCol(displayingGroupKey);\r\n                const thisRowNodeMatches = rowGroupColumn === childRowNode.rowGroupColumn;\r\n\r\n                if (thisRowNodeMatches) {\r\n                    return;\r\n                }\r\n\r\n                if (clearOperation) {\r\n                    // if doing a clear operation, we clear down the value for every possible group column\r\n                    setRowNodeGroupValue(childRowNode, colModel, groupDisplayCol.getId(), undefined);\r\n                } else {\r\n                    // if doing a set operation, we set only where the pull down is to occur\r\n                    const parentToStealFrom = this.getFirstChildOfFirstChild(childRowNode, rowGroupColumn);\r\n                    if (parentToStealFrom) {\r\n                        setRowNodeGroupValue(childRowNode, colModel, groupDisplayCol.getId(), parentToStealFrom.key);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    public isShowingValueForOpenedParent(rowNode: IRowNode, column: Column): boolean {\r\n        // note - this code depends on updateGroupDataForHideOpenParents, where group data\r\n        // is updated to reflect the dragged down parents\r\n\r\n        if (!this.gos.get('groupHideOpenParents')) {\r\n            return false;\r\n        }\r\n\r\n        // hideOpenParents means rowNode.groupData can have data for the group this column is displaying, even though\r\n        // this rowNode isn't grouping by the column we are displaying\r\n\r\n        // if no groupData at all, we are not showing a parent value\r\n        if (!rowNode.groupData) {\r\n            return false;\r\n        }\r\n\r\n        // this is the normal case, in that we are showing a group for which this column is configured. note that\r\n        // this means the Row Group is closed (if it was open, we would not be displaying it)\r\n        const showingGroupNode = rowNode.rowGroupColumn != null;\r\n        if (showingGroupNode) {\r\n            const keyOfGroupingColumn = rowNode.rowGroupColumn!.getId();\r\n            const configuredToShowThisGroupLevel = column.isRowGroupDisplayed(keyOfGroupingColumn);\r\n            // if showing group as normal, we didn't take group info from parent\r\n            if (configuredToShowThisGroupLevel) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // see if we are showing a Group Value for the Displayed Group. if we are showing a group value, and this Row Node\r\n        // is not grouping by this Displayed Group, we must of gotten the value from a parent node\r\n        return rowNode.groupData[column.getId()] != null;\r\n    }\r\n\r\n    private getFirstChildOfFirstChild(node: RowNode, rowGroupColumn: AgColumn | null): RowNode | null {\r\n        let currentRowNode: RowNode | null = node;\r\n\r\n        // if we are hiding groups, then if we are the first child, of the first child,\r\n        // all the way up to the column we are interested in, then we show the group cell.\r\n        while (currentRowNode) {\r\n            const parentRowNode: RowNode | null = currentRowNode.parent;\r\n\r\n            if (parentRowNode?.childrenAfterSort && currentRowNode === parentRowNode.childrenAfterSort[0]) {\r\n                if (parentRowNode.rowGroupColumn === rowGroupColumn) {\r\n                    return parentRowNode;\r\n                }\r\n            } else {\r\n                return null;\r\n            }\r\n\r\n            currentRowNode = parentRowNode;\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    ChangedPath,\r\n    ClientSideRowModelStage,\r\n    ColumnModel,\r\n    GridOptions,\r\n    IColsService,\r\n    IRowNodeStage,\r\n    ISelectionService,\r\n    IShowRowGroupColsService,\r\n    InitialGroupOrderComparatorParams,\r\n    IsGroupOpenByDefaultParams,\r\n    KeyCreatorParams,\r\n    NamedBean,\r\n    RowNodeTransaction,\r\n    StageExecuteParams,\r\n    ValueService,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    RowNode,\r\n    _ROW_ID_PREFIX_ROW_GROUP,\r\n    _areEqual,\r\n    _exists,\r\n    _removeFromArray,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { setRowNodeGroup } from '../rowGroupingUtils';\r\nimport { BatchRemover } from './batchRemover';\r\nimport type { GroupRow } from './groupRow';\r\nimport { sortGroupChildren } from './sortGroupChildren';\r\n\r\ninterface GroupInfo {\r\n    key: string; // e.g. 'Ireland'\r\n    field: string | null; // e.g. 'country'\r\n    rowGroupColumn: AgColumn | null;\r\n    leafNode?: RowNode;\r\n}\r\n\r\ninterface GroupingDetails {\r\n    pivotMode: boolean;\r\n    expandByDefault: number;\r\n    changedPath: ChangedPath;\r\n    rootNode: RowNode;\r\n    groupedCols: AgColumn[];\r\n    groupedColCount: number;\r\n    transactions: RowNodeTransaction[];\r\n    rowNodesOrderChanged: boolean;\r\n\r\n    groupAllowUnbalanced: boolean;\r\n    isGroupOpenByDefault: (params: WithoutGridCommon<IsGroupOpenByDefaultParams>) => boolean;\r\n    initialGroupOrderComparator: (params: WithoutGridCommon<InitialGroupOrderComparatorParams>) => number;\r\n\r\n    keyCreators: (((params: KeyCreatorParams) => string) | undefined)[];\r\n}\r\n\r\nexport class GroupStage extends BeanStub implements NamedBean, IRowNodeStage {\r\n    beanName = 'groupStage' as const;\r\n\r\n    public refreshProps: Set<keyof GridOptions<any>> = new Set([\r\n        'groupDefaultExpanded',\r\n        'groupAllowUnbalanced',\r\n        'initialGroupOrderComparator',\r\n        'groupHideOpenParents',\r\n        'groupDisplayType',\r\n    ]);\r\n    public step: ClientSideRowModelStage = 'group';\r\n\r\n    private colModel: ColumnModel;\r\n    private rowGroupColsSvc?: IColsService;\r\n    private valueSvc: ValueService;\r\n    private selectionSvc?: ISelectionService;\r\n    private showRowGroupCols: IShowRowGroupColsService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n        this.rowGroupColsSvc = beans.rowGroupColsSvc;\r\n        this.valueSvc = beans.valueSvc;\r\n        this.selectionSvc = beans.selectionSvc;\r\n        this.showRowGroupCols = beans.showRowGroupCols!;\r\n    }\r\n\r\n    // when grouping, these items are of note:\r\n    // rowNode.parent: RowNode: set to the parent\r\n    // rowNode.childrenAfterGroup: RowNode[] = the direct children of this group\r\n    // rowNode.childrenMapped: string=>RowNode = children mapped by group key (when groups) or an empty map if leaf group (this is then used by pivot)\r\n    // for leaf groups, rowNode.childrenAfterGroup = rowNode.allLeafChildren;\r\n\r\n    private oldGroupingDetails: GroupingDetails;\r\n    private oldGroupDisplayColIds: string;\r\n\r\n    public execute(params: StageExecuteParams): void {\r\n        const details = this.createGroupingDetails(params);\r\n\r\n        if (details.transactions) {\r\n            this.handleTransaction(details);\r\n        } else {\r\n            const afterColsChanged = params.afterColumnsChanged === true;\r\n            this.shotgunResetEverything(details, afterColsChanged);\r\n        }\r\n\r\n        const changedPath = params.changedPath!;\r\n\r\n        this.positionLeafsAndGroups(changedPath);\r\n        this.orderGroups(details);\r\n\r\n        this.selectionSvc?.updateSelectableAfterGrouping(changedPath);\r\n    }\r\n\r\n    private positionLeafsAndGroups(changedPath: ChangedPath) {\r\n        changedPath.forEachChangedNodeDepthFirst((group: GroupRow) => {\r\n            if (group.childrenAfterGroup) {\r\n                const leafNodes: RowNode[] = [];\r\n                const groupNodes: RowNode[] = [];\r\n                let unbalancedNode: RowNode | undefined;\r\n\r\n                group.childrenAfterGroup.forEach((row) => {\r\n                    if (!row.childrenAfterGroup?.length) {\r\n                        leafNodes.push(row);\r\n                    } else {\r\n                        if (row.key === '' && !unbalancedNode) {\r\n                            unbalancedNode = row;\r\n                        } else {\r\n                            groupNodes.push(row);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (unbalancedNode) {\r\n                    groupNodes.push(unbalancedNode);\r\n                }\r\n\r\n                group.childrenAfterGroup = [...leafNodes, ...groupNodes];\r\n            }\r\n        }, false);\r\n    }\r\n\r\n    private createGroupingDetails(params: StageExecuteParams): GroupingDetails {\r\n        const { rowNode, changedPath, rowNodeTransactions, rowNodesOrderChanged } = params;\r\n\r\n        const groupedCols = this.rowGroupColsSvc?.columns;\r\n\r\n        const details: GroupingDetails = {\r\n            expandByDefault: this.gos.get('groupDefaultExpanded'),\r\n            groupedCols: groupedCols!,\r\n            rootNode: rowNode,\r\n            pivotMode: this.colModel.isPivotMode(),\r\n            groupedColCount: groupedCols?.length ?? 0,\r\n            transactions: rowNodeTransactions!,\r\n            rowNodesOrderChanged: !!rowNodesOrderChanged,\r\n            // if no transaction, then it's shotgun, changed path would be 'not active' at this point anyway\r\n            changedPath: changedPath!,\r\n            groupAllowUnbalanced: this.gos.get('groupAllowUnbalanced'),\r\n            isGroupOpenByDefault: this.gos.getCallback('isGroupOpenByDefault') as any,\r\n            initialGroupOrderComparator: this.gos.getCallback('initialGroupOrderComparator') as any,\r\n            keyCreators: groupedCols?.map((column) => column.getColDef().keyCreator) ?? [],\r\n        };\r\n\r\n        return details;\r\n    }\r\n\r\n    private handleTransaction(details: GroupingDetails): void {\r\n        details.transactions.forEach((tran) => {\r\n            const batchRemover = new BatchRemover();\r\n\r\n            // the order here of [add, remove, update] needs to be the same as in ClientSideNodeManager,\r\n            // as the order is important when a record with the same id is added and removed in the same\r\n            // transaction.\r\n            if (tran.remove?.length) {\r\n                this.removeNodes(tran.remove as RowNode[], details, batchRemover);\r\n            }\r\n            if (tran.update?.length) {\r\n                this.moveNodesInWrongPath(tran.update as RowNode[], details, batchRemover);\r\n            }\r\n            if (tran.add?.length) {\r\n                this.insertNodes(tran.add as RowNode[], details);\r\n            }\r\n\r\n            // must flush here, and not allow another transaction to be applied,\r\n            // as each transaction must finish leaving the data in a consistent state.\r\n            const parentsWithChildrenRemoved = batchRemover.getAllParents().slice();\r\n            batchRemover.flush();\r\n            this.removeEmptyGroups(parentsWithChildrenRemoved, details);\r\n        });\r\n\r\n        if (details.rowNodesOrderChanged) {\r\n            this.sortChildren(details);\r\n        }\r\n    }\r\n\r\n    // this is used when doing delta updates, eg Redux, keeps nodes in right order\r\n    private sortChildren(details: GroupingDetails): void {\r\n        details.changedPath.forEachChangedNodeDepthFirst(\r\n            (node) => {\r\n                const didSort = sortGroupChildren(node.childrenAfterGroup);\r\n                if (didSort) {\r\n                    details.changedPath.addParentNode(node);\r\n                }\r\n            },\r\n            false,\r\n            true\r\n        );\r\n    }\r\n\r\n    private orderGroups(details: GroupingDetails): void {\r\n        const comparator = details.initialGroupOrderComparator;\r\n        if (_exists(comparator)) {\r\n            recursiveSort(details.rootNode);\r\n        }\r\n\r\n        function recursiveSort(rowNode: RowNode): void {\r\n            const doSort =\r\n                _exists(rowNode.childrenAfterGroup) &&\r\n                // we only want to sort groups, so we do not sort leafs (a leaf group has leafs as children)\r\n                !rowNode.leafGroup;\r\n\r\n            if (doSort) {\r\n                rowNode.childrenAfterGroup!.sort((nodeA, nodeB) => comparator!({ nodeA, nodeB }));\r\n                rowNode.childrenAfterGroup!.forEach((childNode: RowNode) => recursiveSort(childNode));\r\n            }\r\n        }\r\n    }\r\n\r\n    private getExistingPathForNode(node: RowNode, details: GroupingDetails): GroupInfo[] {\r\n        const res: GroupInfo[] = [];\r\n\r\n        // the node is not part of the path so we start with the parent.\r\n        let pointer = node.parent;\r\n        while (pointer && pointer !== details.rootNode) {\r\n            res.push({\r\n                key: pointer.key!,\r\n                rowGroupColumn: pointer.rowGroupColumn,\r\n                field: pointer.field,\r\n            });\r\n            pointer = pointer.parent;\r\n        }\r\n        res.reverse();\r\n        return res;\r\n    }\r\n\r\n    private moveNodesInWrongPath(\r\n        childNodes: RowNode[],\r\n        details: GroupingDetails,\r\n        batchRemover: BatchRemover | undefined\r\n    ): void {\r\n        childNodes.forEach((childNode) => {\r\n            // we add node, even if parent has not changed, as the data could have\r\n            // changed, hence aggregations will be wrong\r\n            if (details.changedPath.active) {\r\n                details.changedPath.addParentNode(childNode.parent);\r\n            }\r\n\r\n            const infoToKeyMapper = (item: GroupInfo) => item.key;\r\n            const oldPath: string[] = this.getExistingPathForNode(childNode, details).map(infoToKeyMapper);\r\n            const newPath: string[] = this.getGroupInfo(childNode, details).map(infoToKeyMapper);\r\n\r\n            const nodeInCorrectPath = _areEqual(oldPath, newPath);\r\n\r\n            if (!nodeInCorrectPath) {\r\n                this.moveNode(childNode, details, batchRemover);\r\n            }\r\n        });\r\n    }\r\n\r\n    private moveNode(childNode: RowNode, details: GroupingDetails, batchRemover: BatchRemover | undefined): void {\r\n        this.removeNodesFromParents([childNode], details, batchRemover);\r\n        this.insertOneNode(childNode, details, batchRemover);\r\n\r\n        // hack - if we didn't do this, then renaming a tree item (ie changing rowNode.key) wouldn't get\r\n        // refreshed into the gui.\r\n        // this is needed to kick off the event that rowComp listens to for refresh. this in turn\r\n        // then will get each cell in the row to refresh - which is what we need as we don't know which\r\n        // columns will be displaying the rowNode.key info.\r\n        childNode.setData(childNode.data);\r\n\r\n        // we add both old and new parents to changed path, as both will need to be refreshed.\r\n        // we already added the old parent (in calling method), so just add the new parent here\r\n        if (details.changedPath.active) {\r\n            const newParent = childNode.parent;\r\n            details.changedPath.addParentNode(newParent);\r\n        }\r\n    }\r\n\r\n    private removeNodes(\r\n        leafRowNodes: RowNode[],\r\n        details: GroupingDetails,\r\n        batchRemover: BatchRemover | undefined\r\n    ): void {\r\n        this.removeNodesFromParents(leafRowNodes, details, batchRemover);\r\n        if (details.changedPath.active) {\r\n            leafRowNodes.forEach((rowNode) => details.changedPath.addParentNode(rowNode.parent));\r\n        }\r\n    }\r\n\r\n    private forEachParentGroup(details: GroupingDetails, group: RowNode, callback: (parent: RowNode) => void): void {\r\n        let pointer: RowNode | null = group;\r\n        while (pointer && pointer !== details.rootNode) {\r\n            callback(pointer);\r\n            pointer = pointer.parent;\r\n        }\r\n    }\r\n\r\n    private removeNodesFromParents(\r\n        nodesToRemove: RowNode[],\r\n        details: GroupingDetails,\r\n        provided: BatchRemover | undefined\r\n    ): void {\r\n        // this method can be called with BatchRemover as optional. if it is missed, we created a local version\r\n        // and flush it at the end. if one is provided, we add to the provided one and it gets flushed elsewhere.\r\n        const batchRemoverIsLocal = provided == null;\r\n        const batchRemoverToUse = provided ? provided : new BatchRemover();\r\n\r\n        nodesToRemove.forEach((nodeToRemove) => {\r\n            this.removeFromParent(nodeToRemove, batchRemoverToUse);\r\n\r\n            // remove from allLeafChildren. we clear down all parents EXCEPT the Root Node, as\r\n            // the ClientSideNodeManager is responsible for the Root Node.\r\n            this.forEachParentGroup(details, nodeToRemove.parent!, (parentNode) => {\r\n                batchRemoverToUse.removeFromAllLeafChildren(parentNode, nodeToRemove);\r\n            });\r\n        });\r\n\r\n        if (batchRemoverIsLocal) {\r\n            batchRemoverToUse.flush();\r\n        }\r\n    }\r\n\r\n    private removeEmptyGroups(possibleEmptyGroups: RowNode[], details: GroupingDetails): void {\r\n        // we do this multiple times, as when we remove groups, that means the parent of just removed\r\n        // group can then be empty. to get around this, if we remove, then we check everything again for\r\n        // newly emptied groups. the max number of times this will execute is the depth of the group tree.\r\n        let checkAgain = true;\r\n\r\n        const groupShouldBeRemoved = (rowNode: RowNode): boolean => {\r\n            // because of the while loop below, it's possible we already moved the node,\r\n            // so double check before trying to remove again.\r\n            const mapKey = this.getChildrenMappedKey(rowNode.key!, rowNode.rowGroupColumn);\r\n            const parentRowNode = rowNode.parent;\r\n            const groupAlreadyRemoved = parentRowNode?.childrenMapped ? !parentRowNode.childrenMapped[mapKey] : true;\r\n\r\n            if (groupAlreadyRemoved) {\r\n                // if not linked, then group was already removed\r\n                return false;\r\n            }\r\n            // if still not removed, then we remove if this group is empty\r\n            return !!rowNode.group && (rowNode.childrenAfterGroup?.length ?? 0) === 0;\r\n        };\r\n\r\n        while (checkAgain) {\r\n            checkAgain = false;\r\n            const batchRemover = new BatchRemover();\r\n            possibleEmptyGroups.forEach((possibleEmptyGroup) => {\r\n                // remove empty groups\r\n                this.forEachParentGroup(details, possibleEmptyGroup, (rowNode) => {\r\n                    if (groupShouldBeRemoved(rowNode)) {\r\n                        checkAgain = true;\r\n\r\n                        this.removeFromParent(rowNode, batchRemover);\r\n                        // we remove selection on filler nodes here, as the selection would not be removed\r\n                        // from the RowNodeManager, as filler nodes don't exist on the RowNodeManager\r\n                        this.selectionSvc?.setNodesSelected({\r\n                            nodes: [rowNode],\r\n                            newValue: false,\r\n                            source: 'rowGroupChanged',\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n            batchRemover.flush();\r\n        }\r\n    }\r\n\r\n    // removes the node from the parent by:\r\n    // a) removing from childrenAfterGroup (using batchRemover if present, otherwise immediately)\r\n    // b) removing from childrenMapped (immediately)\r\n    // c) setRowTop(null) - as the rowRenderer uses this to know the RowNode is no longer needed\r\n    // d) setRowIndex(null) - as the rowNode will no longer be displayed.\r\n    private removeFromParent(child: RowNode, batchRemover?: BatchRemover) {\r\n        if (child.parent) {\r\n            if (batchRemover) {\r\n                batchRemover.removeFromChildrenAfterGroup(child.parent, child);\r\n            } else {\r\n                _removeFromArray(child.parent.childrenAfterGroup!, child);\r\n                child.parent.updateHasChildren();\r\n            }\r\n        }\r\n        const mapKey = this.getChildrenMappedKey(child.key!, child.rowGroupColumn);\r\n        if (child.parent?.childrenMapped) {\r\n            delete child.parent.childrenMapped[mapKey];\r\n        }\r\n        // this is important for transition, see rowComp removeFirstPassFuncs. when doing animation and\r\n        // remove, if rowTop is still present, the rowComp thinks it's just moved position.\r\n        child.setRowTop(null);\r\n        child.setRowIndex(null);\r\n    }\r\n\r\n    /**\r\n     * This is idempotent, but relies on the `key` field being the same throughout a RowNode's lifetime\r\n     */\r\n    private addToParent(child: RowNode, parent: RowNode | null) {\r\n        const mapKey = this.getChildrenMappedKey(child.key!, child.rowGroupColumn);\r\n        if (parent?.childrenMapped) {\r\n            if (parent.childrenMapped[mapKey] !== child) {\r\n                parent.childrenMapped[mapKey] = child;\r\n                parent.childrenAfterGroup!.push(child);\r\n                setRowNodeGroup(parent, this.beans, true); // calls `.updateHasChildren` internally\r\n            }\r\n        }\r\n    }\r\n\r\n    private areGroupColsEqual(d1: GroupingDetails, d2: GroupingDetails): boolean {\r\n        if (d1 == null || d2 == null || d1.pivotMode !== d2.pivotMode) {\r\n            return false;\r\n        }\r\n\r\n        return _areEqual(d1.groupedCols, d2.groupedCols) && _areEqual(d1.keyCreators, d2.keyCreators);\r\n    }\r\n\r\n    private checkAllGroupDataAfterColsChanged(details: GroupingDetails): void {\r\n        const recurse = (rowNodes: RowNode[] | null) => {\r\n            if (!rowNodes) {\r\n                return;\r\n            }\r\n            rowNodes.forEach((rowNode) => {\r\n                const isLeafNode = !rowNode.group;\r\n                if (isLeafNode) {\r\n                    return;\r\n                }\r\n                const groupInfo: GroupInfo = {\r\n                    field: rowNode.field,\r\n                    key: rowNode.key!,\r\n                    rowGroupColumn: rowNode.rowGroupColumn,\r\n                    leafNode: rowNode.allLeafChildren?.[0],\r\n                };\r\n                this.setGroupData(rowNode, groupInfo);\r\n                recurse(rowNode.childrenAfterGroup);\r\n            });\r\n        };\r\n\r\n        recurse(details.rootNode.childrenAfterGroup);\r\n    }\r\n\r\n    private shotgunResetEverything(details: GroupingDetails, afterColumnsChanged: boolean): void {\r\n        if (this.noChangeInGroupingColumns(details, afterColumnsChanged)) {\r\n            return;\r\n        }\r\n\r\n        // groups are about to get disposed, so need to deselect any that are selected\r\n        this.selectionSvc?.filterFromSelection?.((node) => !node.group);\r\n\r\n        const { groupedCols } = details;\r\n        const rootNode: GroupRow = details.rootNode;\r\n        // because we are not creating the root node each time, we have the logic\r\n        // here to change leafGroup once.\r\n        rootNode.leafGroup = groupedCols.length === 0;\r\n\r\n        // we are doing everything from scratch, so reset childrenAfterGroup and childrenMapped from the rootNode\r\n        rootNode.childrenAfterGroup = [];\r\n        rootNode.childrenMapped = {};\r\n        rootNode.updateHasChildren();\r\n\r\n        const sibling: GroupRow = rootNode.sibling;\r\n        if (sibling) {\r\n            sibling.childrenAfterGroup = rootNode.childrenAfterGroup;\r\n            sibling.childrenMapped = rootNode.childrenMapped;\r\n        }\r\n\r\n        this.insertNodes(rootNode.allLeafChildren!, details);\r\n    }\r\n\r\n    private noChangeInGroupingColumns(details: GroupingDetails, afterColumnsChanged: boolean): boolean {\r\n        let noFurtherProcessingNeeded = false;\r\n\r\n        const groupDisplayColumns = this.showRowGroupCols.getShowRowGroupCols();\r\n        const newGroupDisplayColIds = groupDisplayColumns ? groupDisplayColumns.map((c) => c.getId()).join('-') : '';\r\n\r\n        if (afterColumnsChanged) {\r\n            // we only need to redo grouping if doing normal grouping (ie not tree data)\r\n            // and the group cols have changed.\r\n            noFurtherProcessingNeeded = this.areGroupColsEqual(details, this.oldGroupingDetails);\r\n\r\n            // if the group display cols have changed, then we need to update rowNode.groupData\r\n            // (regardless of tree data or row grouping)\r\n            if (this.oldGroupDisplayColIds !== newGroupDisplayColIds) {\r\n                this.checkAllGroupDataAfterColsChanged(details);\r\n            }\r\n        }\r\n\r\n        this.oldGroupingDetails = details;\r\n        this.oldGroupDisplayColIds = newGroupDisplayColIds;\r\n\r\n        return noFurtherProcessingNeeded;\r\n    }\r\n\r\n    private insertNodes(newRowNodes: RowNode[], details: GroupingDetails): void {\r\n        newRowNodes.forEach((rowNode) => {\r\n            this.insertOneNode(rowNode, details);\r\n            if (details.changedPath.active) {\r\n                details.changedPath.addParentNode(rowNode.parent);\r\n            }\r\n        });\r\n    }\r\n\r\n    private insertOneNode(childNode: RowNode, details: GroupingDetails, batchRemover?: BatchRemover): void {\r\n        const path: GroupInfo[] = this.getGroupInfo(childNode, details);\r\n\r\n        const parentGroup = this.findParentForNode(childNode, path, details, batchRemover);\r\n\r\n        if (!parentGroup.group) {\r\n            _warn(184, { parentGroupData: parentGroup.data, childNodeData: childNode.data });\r\n        }\r\n        childNode.parent = parentGroup;\r\n        childNode.level = path.length;\r\n        parentGroup.childrenAfterGroup!.push(childNode);\r\n        parentGroup.updateHasChildren();\r\n    }\r\n\r\n    private findParentForNode(\r\n        childNode: RowNode,\r\n        path: GroupInfo[],\r\n        details: GroupingDetails,\r\n        batchRemover?: BatchRemover\r\n    ): RowNode {\r\n        let nextNode: RowNode = details.rootNode;\r\n\r\n        path.forEach((groupInfo, level) => {\r\n            nextNode = this.getOrCreateNextNode(nextNode, groupInfo, level, details);\r\n            // node gets added to all group nodes.\r\n            // note: we do not add to rootNode here, as the rootNode is the master list of rowNodes\r\n\r\n            if (!batchRemover?.isRemoveFromAllLeafChildren(nextNode, childNode)) {\r\n                nextNode.allLeafChildren!.push(childNode);\r\n            } else {\r\n                // if this node is about to be removed, prevent that\r\n                batchRemover?.preventRemoveFromAllLeafChildren(nextNode, childNode);\r\n            }\r\n        });\r\n\r\n        return nextNode;\r\n    }\r\n\r\n    private getOrCreateNextNode(\r\n        parentGroup: RowNode,\r\n        groupInfo: GroupInfo,\r\n        level: number,\r\n        details: GroupingDetails\r\n    ): RowNode {\r\n        const key = this.getChildrenMappedKey(groupInfo.key, groupInfo.rowGroupColumn);\r\n        let nextNode = parentGroup?.childrenMapped?.[key];\r\n\r\n        if (!nextNode) {\r\n            nextNode = this.createGroup(groupInfo, parentGroup, level, details);\r\n            // attach the new group to the parent\r\n            this.addToParent(nextNode, parentGroup);\r\n        }\r\n\r\n        return nextNode;\r\n    }\r\n\r\n    private createGroup(groupInfo: GroupInfo, parent: RowNode, level: number, details: GroupingDetails): RowNode {\r\n        const groupNode: GroupRow = new RowNode(this.beans);\r\n\r\n        groupNode.group = true;\r\n        groupNode.field = groupInfo.field;\r\n        groupNode.rowGroupColumn = groupInfo.rowGroupColumn;\r\n\r\n        this.setGroupData(groupNode, groupInfo);\r\n\r\n        groupNode.key = groupInfo.key;\r\n        groupNode.id = this.createGroupId(groupNode, parent, level);\r\n\r\n        groupNode.level = level;\r\n        groupNode.leafGroup = level === details.groupedColCount - 1;\r\n\r\n        groupNode.allLeafChildren = [];\r\n\r\n        // why is this done here? we are not updating the children count as we go,\r\n        // i suspect this is updated in the filter stage\r\n        groupNode.setAllChildrenCount(0);\r\n\r\n        groupNode.rowGroupIndex = level;\r\n\r\n        groupNode.childrenAfterGroup = [];\r\n        groupNode.childrenMapped = {};\r\n        groupNode.updateHasChildren();\r\n\r\n        groupNode.parent = parent;\r\n\r\n        this.setExpandedInitialValue(details, groupNode);\r\n\r\n        return groupNode;\r\n    }\r\n\r\n    private createGroupId(node: RowNode, parent: RowNode, level: number): string {\r\n        const createGroupId: (node: RowNode, parent: RowNode | null, level: number) => string | null = (\r\n            node,\r\n            parent\r\n        ) => {\r\n            if (!node.rowGroupColumn) {\r\n                return null;\r\n            } // root node\r\n            const parentId = parent ? createGroupId(parent, parent.parent, 0) : null;\r\n            return `${parentId == null ? '' : parentId + '-'}${node.rowGroupColumn.getColId()}-${node.key}`;\r\n        };\r\n\r\n        // we put 'row-group-' before the group id, so it doesn't clash with standard row id's. we also use 't-' and 'b-'\r\n        // for top pinned and bottom pinned rows.\r\n        return _ROW_ID_PREFIX_ROW_GROUP + createGroupId(node, parent, level);\r\n    }\r\n\r\n    private setGroupData(groupNode: RowNode, groupInfo: GroupInfo): void {\r\n        groupNode.groupData = {};\r\n        const groupDisplayCols = this.showRowGroupCols.getShowRowGroupCols();\r\n        groupDisplayCols.forEach((col) => {\r\n            // newGroup.rowGroupColumn=null when working off GroupInfo, and we always display the group in the group column\r\n            // if rowGroupColumn is present, then it's grid row grouping and we only include if configuration says so\r\n\r\n            const groupColumn = groupNode.rowGroupColumn;\r\n            const isRowGroupDisplayed = groupColumn !== null && col.isRowGroupDisplayed(groupColumn.getId());\r\n            if (isRowGroupDisplayed) {\r\n                // if maintain group value type, get the value from any leaf node.\r\n                groupNode.groupData![col.getColId()] = this.valueSvc.getValue(groupColumn, groupInfo.leafNode);\r\n            }\r\n        });\r\n    }\r\n\r\n    private getChildrenMappedKey(key: string, rowGroupColumn: AgColumn | null): string {\r\n        // grouping by columns\r\n        return rowGroupColumn ? rowGroupColumn.getId() + '-' + key : key;\r\n    }\r\n\r\n    private setExpandedInitialValue(details: GroupingDetails, groupNode: RowNode): void {\r\n        // if pivoting the leaf group is never expanded as we do not show leaf rows\r\n        if (details.pivotMode && groupNode.leafGroup) {\r\n            groupNode.expanded = false;\r\n            return;\r\n        }\r\n\r\n        // use callback if exists\r\n        const userCallback = details.isGroupOpenByDefault;\r\n        if (userCallback) {\r\n            const params: WithoutGridCommon<IsGroupOpenByDefaultParams> = {\r\n                rowNode: groupNode,\r\n                field: groupNode.field!,\r\n                key: groupNode.key!,\r\n                level: groupNode.level,\r\n                rowGroupColumn: groupNode.rowGroupColumn!,\r\n            };\r\n            groupNode.expanded = userCallback(params) == true;\r\n            return;\r\n        }\r\n\r\n        // use expandByDefault if exists\r\n        if (details.expandByDefault === -1) {\r\n            groupNode.expanded = true;\r\n            return;\r\n        }\r\n\r\n        // otherwise\r\n        groupNode.expanded = groupNode.level < details.expandByDefault;\r\n    }\r\n\r\n    private getGroupInfo(rowNode: RowNode, details: GroupingDetails): GroupInfo[] {\r\n        const res: GroupInfo[] = [];\r\n        details.groupedCols.forEach((groupCol) => {\r\n            let key: string = this.valueSvc.getKeyForNode(groupCol, rowNode);\r\n            let keyExists = key !== null && key !== undefined && key !== '';\r\n\r\n            // unbalanced tree and pivot mode don't work together - not because of the grid, it doesn't make\r\n            // mathematical sense as you are building up a cube. so if pivot mode, we put in a blank key where missing.\r\n            // this keeps the tree balanced and hence can be represented as a group.\r\n            const createGroupForEmpty = details.pivotMode || !details.groupAllowUnbalanced;\r\n            if (createGroupForEmpty && !keyExists) {\r\n                key = '';\r\n                keyExists = true;\r\n            }\r\n\r\n            if (keyExists) {\r\n                const item = {\r\n                    key: key,\r\n                    field: groupCol.getColDef().field,\r\n                    rowGroupColumn: groupCol,\r\n                    leafNode: rowNode,\r\n                } as GroupInfo;\r\n                res.push(item);\r\n            }\r\n        });\r\n        return res;\r\n    }\r\n}\r\n", "import type { RowNode } from 'ag-grid-community';\r\n\r\nimport type { GroupRow } from './groupRow';\r\n\r\n// doing _removeFromArray() multiple times on a large list can be a bottleneck.\r\n// when doing large deletes (eg removing 1,000 rows) then we would be calling _removeFromArray()\r\n// a thousands of times, in particular RootNode.allGroupChildren could be a large list, and\r\n// 1,000 removes is time consuming as each one requires traversing the full list.\r\n// to get around this, we do all the removes in a batch. this class manages the batch.\r\n//\r\n// This problem was brought to light by a client (AG-2879), with dataset of 20,000\r\n// in 10,000 groups (2 items per group), then deleting all rows with transaction,\r\n// it took about 20 seconds to delete. with the BathRemoved, the reduced to less than 1 second.\r\n\r\ninterface RemoveDetails {\r\n    removeFromChildrenAfterGroup: { [id: string]: boolean };\r\n    removeFromAllLeafChildren: { [id: string]: boolean };\r\n}\r\n\r\nexport class BatchRemover {\r\n    private allSets: { [parentId: string]: RemoveDetails } = {};\r\n    private allParents: RowNode[] = [];\r\n\r\n    public removeFromChildrenAfterGroup(parent: RowNode, child: RowNode): void {\r\n        const set = this.getSet(parent);\r\n        set.removeFromChildrenAfterGroup[child.id!] = true;\r\n    }\r\n\r\n    public isRemoveFromAllLeafChildren(parent: RowNode, child: RowNode): boolean {\r\n        const set = this.getSet(parent);\r\n        return !!set.removeFromAllLeafChildren[child.id!];\r\n    }\r\n\r\n    public preventRemoveFromAllLeafChildren(parent: RowNode, child: RowNode): void {\r\n        const set = this.getSet(parent);\r\n        delete set.removeFromAllLeafChildren[child.id!];\r\n    }\r\n\r\n    public removeFromAllLeafChildren(parent: RowNode, child: RowNode): void {\r\n        const set = this.getSet(parent);\r\n        set.removeFromAllLeafChildren[child.id!] = true;\r\n    }\r\n\r\n    private getSet(parent: RowNode): RemoveDetails {\r\n        if (!this.allSets[parent.id!]) {\r\n            this.allSets[parent.id!] = {\r\n                removeFromAllLeafChildren: {},\r\n                removeFromChildrenAfterGroup: {},\r\n            };\r\n            this.allParents.push(parent);\r\n        }\r\n        return this.allSets[parent.id!];\r\n    }\r\n\r\n    public getAllParents(): RowNode[] {\r\n        return this.allParents;\r\n    }\r\n\r\n    public flush(): void {\r\n        this.allParents.forEach((parent: GroupRow) => {\r\n            const nodeDetails = this.allSets[parent.id!];\r\n\r\n            parent.childrenAfterGroup = parent.childrenAfterGroup!.filter(\r\n                (child) => !nodeDetails.removeFromChildrenAfterGroup[child.id!]\r\n            );\r\n            parent.allLeafChildren =\r\n                parent.allLeafChildren?.filter((child) => !nodeDetails.removeFromAllLeafChildren[child.id!]) ?? null;\r\n            parent.updateHasChildren();\r\n\r\n            const sibling: GroupRow = parent.sibling;\r\n            if (sibling) {\r\n                sibling.childrenAfterGroup = parent.childrenAfterGroup;\r\n                sibling.allLeafChildren = parent.allLeafChildren;\r\n            }\r\n        });\r\n        this.allSets = {};\r\n        this.allParents.length = 0;\r\n    }\r\n}\r\n", "import type { RowNode } from 'ag-grid-community';\r\n\r\nexport function sortGroupChildren(rowNodes: RowNode[] | null | undefined): boolean {\r\n    if (!rowNodes) {\r\n        return false;\r\n    }\r\n    const length = rowNodes.length;\r\n    if (length < 2) {\r\n        return false;\r\n    }\r\n\r\n    let atLeastOneOutOfOrder = false;\r\n    for (let i = 1; i < length; i++) {\r\n        if (compareGroupChildren(rowNodes[i - 1], rowNodes[i]) > 0) {\r\n            atLeastOneOutOfOrder = true;\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (!atLeastOneOutOfOrder) {\r\n        return false;\r\n    }\r\n\r\n    rowNodes.sort(compareGroupChildren);\r\n    return true;\r\n}\r\n\r\nfunction compareGroupChildren(nodeA: RowNode, nodeB: RowNode): number {\r\n    const positionA = nodeA.sourceRowIndex;\r\n    const positionB = nodeB.sourceRowIndex;\r\n\r\n    const aHasIndex = positionA >= 0;\r\n    const bHasIndex = positionB >= 0;\r\n\r\n    const bothNodesAreUserNodes = aHasIndex && bHasIndex;\r\n    const bothNodesAreFillerNodes = !aHasIndex && !bHasIndex;\r\n\r\n    if (bothNodesAreUserNodes) {\r\n        // when comparing two nodes the user has provided, they always\r\n        // have indexes\r\n        return positionA - positionB;\r\n    }\r\n\r\n    if (bothNodesAreFillerNodes) {\r\n        // when comparing two filler nodes, we have no index to compare them\r\n        // against, however we want this sorting to be deterministic, so that\r\n        // the rows don't jump around as the user does delta updates. so we\r\n        // want the same sort result. so we use the __objectId - which doesn't make sense\r\n        // from a sorting point of view, but does give consistent behaviour between\r\n        // calls. otherwise groups jump around as delta updates are done.\r\n        // note: previously here we used nodeId, however this gave a strange order\r\n        // as string ordering of numbers is wrong, so using id based on creation order\r\n        // as least gives better looking order.\r\n        return nodeA.__objectId - nodeB.__objectId;\r\n    }\r\n\r\n    if (aHasIndex) {\r\n        return 1;\r\n    }\r\n\r\n    return -1;\r\n}\r\n", "import type { BeanCollection, ColDef, Column } from 'ag-grid-community';\r\n\r\nimport type { RowGroupColsSvc } from './rowGroupColsSvc';\r\n\r\nexport function setRowGroupColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.rowGroupColsSvc?.setColumns(colKeys, 'api');\r\n}\r\n\r\nexport function removeRowGroupColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.rowGroupColsSvc?.removeColumns(colKeys, 'api');\r\n}\r\n\r\nexport function addRowGroupColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.rowGroupColsSvc?.addColumns(colKeys, 'api');\r\n}\r\n\r\nexport function moveRowGroupColumn(beans: BeanCollection, fromIndex: number, toIndex: number): void {\r\n    (beans.rowGroupColsSvc as RowGroupColsSvc)?.moveColumn?.(fromIndex, toIndex, 'api');\r\n}\r\n\r\nexport function getRowGroupColumns(beans: BeanCollection): Column[] {\r\n    return beans.rowGroupColsSvc?.columns ?? [];\r\n}\r\n", "import type { IRowModel, IViewportDatasource, NamedBean, RowBounds, RowModelType } from 'ag-grid-community';\r\nimport { BeanStub, RowNode, _getRowHeightAsNumber, _missing, _warn } from 'ag-grid-community';\r\n\r\nexport class ViewportRowModel extends BeanStub implements NamedBean, IRowModel {\r\n    beanName = 'rowModel' as const;\r\n\r\n    // rowRenderer tells us these\r\n    private firstRow = -1;\r\n    private lastRow = -1;\r\n\r\n    // datasource tells us this\r\n    private rowCount = -1;\r\n    private rowNodesByIndex: { [index: number]: RowNode } = {};\r\n    private rowHeight: number;\r\n    private datasource: IViewportDatasource;\r\n\r\n    // we don't implement as lazy row heights is not supported in this row model\r\n    public ensureRowHeightsValid(\r\n        _startPixel: number,\r\n        _endPixel: number,\r\n        _startLimitIndex: number,\r\n        _endLimitIndex: number\r\n    ): boolean {\r\n        return false;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const beans = this.beans;\r\n        this.rowHeight = _getRowHeightAsNumber(beans);\r\n        this.addManagedEventListeners({ viewportChanged: this.onViewportChanged.bind(this) });\r\n        this.addManagedPropertyListener('viewportDatasource', () => this.updateDatasource());\r\n        this.addManagedPropertyListener('rowHeight', () => {\r\n            this.rowHeight = _getRowHeightAsNumber(beans);\r\n            this.updateRowHeights();\r\n        });\r\n    }\r\n\r\n    public start(): void {\r\n        this.updateDatasource();\r\n    }\r\n\r\n    public isLastRowIndexKnown(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyDatasource();\r\n        super.destroy();\r\n    }\r\n\r\n    private destroyDatasource(): void {\r\n        const datasource = this.datasource;\r\n        if (!datasource) {\r\n            return;\r\n        }\r\n\r\n        datasource.destroy?.();\r\n\r\n        this.beans.rowRenderer.datasourceChanged();\r\n        this.firstRow = -1;\r\n        this.lastRow = -1;\r\n    }\r\n\r\n    private updateDatasource(): void {\r\n        const datasource = this.gos.get('viewportDatasource');\r\n        if (datasource) {\r\n            this.setViewportDatasource(datasource);\r\n        }\r\n    }\r\n\r\n    private getPageSize(): number | undefined {\r\n        return this.gos.get('viewportRowModelPageSize');\r\n    }\r\n\r\n    private getBufferSize(): number {\r\n        return this.gos.get('viewportRowModelBufferSize');\r\n    }\r\n\r\n    private calculateFirstRow(firstRenderedRow: number): number {\r\n        const bufferSize = this.getBufferSize();\r\n        const pageSize = this.getPageSize()!;\r\n        const afterBuffer = firstRenderedRow - bufferSize;\r\n\r\n        if (afterBuffer < 0) {\r\n            return 0;\r\n        }\r\n\r\n        return Math.floor(afterBuffer / pageSize) * pageSize;\r\n    }\r\n\r\n    private calculateLastRow(lastRenderedRow: number): number {\r\n        if (lastRenderedRow === -1) {\r\n            return lastRenderedRow;\r\n        }\r\n\r\n        const bufferSize = this.getBufferSize();\r\n        const pageSize = this.getPageSize()!;\r\n        const afterBuffer = lastRenderedRow + bufferSize;\r\n        const result = Math.ceil(afterBuffer / pageSize) * pageSize;\r\n        const lastRowIndex = this.rowCount - 1;\r\n\r\n        return Math.min(result, lastRowIndex);\r\n    }\r\n\r\n    private onViewportChanged(event: any): void {\r\n        const newFirst = this.calculateFirstRow(event.firstRow);\r\n        const newLast = this.calculateLastRow(event.lastRow);\r\n\r\n        if (this.firstRow !== newFirst || this.lastRow !== newLast) {\r\n            this.firstRow = newFirst;\r\n            this.lastRow = newLast;\r\n            this.purgeRowsNotInViewport();\r\n            this.datasource?.setViewportRange(this.firstRow, this.lastRow);\r\n        }\r\n    }\r\n\r\n    public purgeRowsNotInViewport(): void {\r\n        const rowNodesByIndex = this.rowNodesByIndex;\r\n        Object.keys(rowNodesByIndex).forEach((indexStr) => {\r\n            const index = parseInt(indexStr, 10);\r\n            if (index < this.firstRow || index > this.lastRow) {\r\n                if (this.isRowFocused(index)) {\r\n                    return;\r\n                }\r\n\r\n                delete rowNodesByIndex[index];\r\n            }\r\n        });\r\n    }\r\n\r\n    private isRowFocused(rowIndex: number): boolean {\r\n        const focusedCell = this.beans.focusSvc.getFocusCellToUseAfterRefresh();\r\n        if (!focusedCell) {\r\n            return false;\r\n        }\r\n        if (focusedCell.rowPinned != null) {\r\n            return false;\r\n        }\r\n\r\n        const hasFocus = focusedCell.rowIndex === rowIndex;\r\n        return hasFocus;\r\n    }\r\n\r\n    public setViewportDatasource(viewportDatasource: IViewportDatasource): void {\r\n        this.destroyDatasource();\r\n\r\n        this.datasource = viewportDatasource;\r\n        this.rowCount = -1;\r\n\r\n        if (!viewportDatasource.init) {\r\n            _warn(226);\r\n        } else {\r\n            viewportDatasource.init({\r\n                setRowCount: this.setRowCount.bind(this),\r\n                setRowData: this.setRowData.bind(this),\r\n                getRow: this.getRow.bind(this),\r\n            });\r\n        }\r\n    }\r\n\r\n    public getType(): RowModelType {\r\n        return 'viewport';\r\n    }\r\n\r\n    public getRow(rowIndex: number): RowNode {\r\n        if (!this.rowNodesByIndex[rowIndex]) {\r\n            this.rowNodesByIndex[rowIndex] = this.createBlankRowNode(rowIndex);\r\n        }\r\n\r\n        return this.rowNodesByIndex[rowIndex];\r\n    }\r\n\r\n    public getRowNode(id: string): RowNode | undefined {\r\n        let result: RowNode | undefined;\r\n        this.forEachNode((rowNode) => {\r\n            if (rowNode.id === id) {\r\n                result = rowNode;\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    public getRowCount(): number {\r\n        return this.rowCount === -1 ? 0 : this.rowCount;\r\n    }\r\n\r\n    public getRowIndexAtPixel(pixel: number): number {\r\n        if (this.rowHeight !== 0) {\r\n            // avoid divide by zero error\r\n            return Math.floor(pixel / this.rowHeight);\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    public getRowBounds(index: number): RowBounds {\r\n        const rowHeight = this.rowHeight;\r\n        return {\r\n            rowHeight,\r\n            rowTop: rowHeight * index,\r\n        };\r\n    }\r\n\r\n    private updateRowHeights() {\r\n        const rowHeight = this.rowHeight;\r\n        this.forEachNode((node) => {\r\n            node.setRowHeight(rowHeight);\r\n            node.setRowTop(rowHeight * node.rowIndex!);\r\n        });\r\n\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'modelUpdated',\r\n            newData: false,\r\n            newPage: false,\r\n            keepRenderedRows: true,\r\n            animate: false,\r\n        });\r\n    }\r\n\r\n    public getTopLevelRowCount(): number {\r\n        return this.getRowCount();\r\n    }\r\n\r\n    public getTopLevelRowDisplayedIndex(topLevelIndex: number): number {\r\n        return topLevelIndex;\r\n    }\r\n\r\n    public isEmpty(): boolean {\r\n        return this.rowCount > 0;\r\n    }\r\n\r\n    public isRowsToRender(): boolean {\r\n        return this.rowCount > 0;\r\n    }\r\n\r\n    public getNodesInRangeForSelection(firstInRange: RowNode, lastInRange: RowNode): RowNode[] {\r\n        const firstIndex = firstInRange.rowIndex!;\r\n        const lastIndex = lastInRange.rowIndex!;\r\n\r\n        const firstNodeOutOfRange = firstIndex < this.firstRow || firstIndex > this.lastRow;\r\n        const lastNodeOutOfRange = lastIndex < this.firstRow || lastIndex > this.lastRow;\r\n\r\n        if (firstNodeOutOfRange || lastNodeOutOfRange) {\r\n            return [];\r\n        }\r\n\r\n        const result: RowNode[] = [];\r\n\r\n        const startIndex = firstIndex <= lastIndex ? firstIndex : lastIndex;\r\n        const endIndex = firstIndex <= lastIndex ? lastIndex : firstIndex;\r\n\r\n        for (let i = startIndex; i <= endIndex; i++) {\r\n            result.push(this.rowNodesByIndex[i]);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public forEachNode(callback: (rowNode: RowNode, index: number) => void): void {\r\n        let callbackCount = 0;\r\n\r\n        Object.keys(this.rowNodesByIndex).forEach((indexStr) => {\r\n            const index = parseInt(indexStr, 10);\r\n            const rowNode: RowNode = this.rowNodesByIndex[index];\r\n            callback(rowNode, callbackCount);\r\n            callbackCount++;\r\n        });\r\n    }\r\n\r\n    private setRowData(rowData: { [key: number]: any }): void {\r\n        const rowNodesByIndex = this.rowNodesByIndex;\r\n        for (const [indexStr, dataItem] of Object.entries(rowData)) {\r\n            const index = parseInt(indexStr, 10);\r\n            // we should never keep rows that we didn't specifically ask for, this\r\n            // guarantees the contract we have with the server.\r\n            if (index >= this.firstRow && index <= this.lastRow) {\r\n                let rowNode = rowNodesByIndex[index];\r\n\r\n                // the abnormal case is we requested a row even though the grid didn't need it\r\n                // as a result of the paging and buffer (ie the row is off screen), in which\r\n                // case we need to create a new node now\r\n                if (_missing(rowNode)) {\r\n                    rowNode = this.createBlankRowNode(index);\r\n                    rowNodesByIndex[index] = rowNode;\r\n                }\r\n\r\n                // now we deffo have a row node, so set in the details\r\n                // if the grid already asked for this row (the normal case), then we would\r\n                // of put a placeholder node in place.\r\n                rowNode.setDataAndId(dataItem, index.toString());\r\n            }\r\n        }\r\n    }\r\n\r\n    private createBlankRowNode(rowIndex: number): RowNode {\r\n        const rowNode = new RowNode(this.beans);\r\n\r\n        const rowHeight = this.rowHeight;\r\n        rowNode.setRowHeight(rowHeight);\r\n        rowNode.setRowTop(rowHeight * rowIndex);\r\n        rowNode.setRowIndex(rowIndex);\r\n\r\n        return rowNode;\r\n    }\r\n\r\n    public setRowCount(rowCount: number, keepRenderedRows = false): void {\r\n        if (rowCount === this.rowCount) {\r\n            return;\r\n        }\r\n\r\n        this.rowCount = rowCount;\r\n\r\n        const eventSvc = this.eventSvc;\r\n        eventSvc.dispatchEventOnce({\r\n            type: 'rowCountReady',\r\n        });\r\n\r\n        eventSvc.dispatchEvent({\r\n            type: 'modelUpdated',\r\n            newData: false,\r\n            newPage: false,\r\n            keepRenderedRows: keepRenderedRows,\r\n            animate: false,\r\n        });\r\n    }\r\n\r\n    public isRowPresent(rowNode: RowNode): boolean {\r\n        const foundRowNode = this.getRowNode(rowNode.id!);\r\n        return !!foundRowNode;\r\n    }\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { ViewportRowModel } from './viewportRowModel';\r\n\r\n/**\r\n * @feature Viewport Row Model\r\n */\r\nexport const ViewportRowModelModule: _ModuleWithoutApi = {\r\n    moduleName: 'ViewportRowModel',\r\n    version: VERSION,\r\n    rowModels: ['viewport'],\r\n    beans: [ViewportRowModel],\r\n    dependsOn: [EnterpriseCoreModule],\r\n};\r\n", "import type { _ClipboardGridApi, _ModuleWithApi } from 'ag-grid-community';\r\nimport { CsvExportModule, HighlightChangesModule, _KeyboardNavigationModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport {\r\n    copySelectedRangeDown,\r\n    copySelectedRangeToClipboard,\r\n    copySelectedRowsToClipboard,\r\n    copyToClipboard,\r\n    cutToClipboard,\r\n    pasteFromClipboard,\r\n} from './clipboardApi';\r\nimport { ClipboardService } from './clipboardService';\r\n\r\n/**\r\n * @feature Import & Export -> Clipboard\r\n */\r\nexport const ClipboardModule: _ModuleWithApi<_ClipboardGridApi> = {\r\n    moduleName: 'Clipboard',\r\n    version: VERSION,\r\n    beans: [ClipboardService],\r\n    apiFunctions: {\r\n        copyToClipboard,\r\n        cutToClipboard,\r\n        copySelectedRowsToClipboard,\r\n        copySelectedRangeToClipboard,\r\n        copySelectedRangeDown,\r\n        pasteFromClipboard,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, CsvExportModule, _KeyboardNavigationModule, HighlightChangesModule],\r\n};\r\n", "import type { BeanCollection, IClipboardCopyParams, IClipboardCopyRowsParams } from 'ag-grid-community';\r\n\r\nexport function copyToClipboard(beans: BeanCollection, params?: IClipboardCopyParams) {\r\n    beans.clipboardSvc?.copyToClipboard(params);\r\n}\r\n\r\nexport function cutToClipboard(beans: BeanCollection, params?: IClipboardCopyParams) {\r\n    beans.clipboardSvc?.cutToClipboard(params);\r\n}\r\n\r\nexport function copySelectedRowsToClipboard(beans: BeanCollection, params?: IClipboardCopyRowsParams): void {\r\n    beans.clipboardSvc?.copySelectedRowsToClipboard(params);\r\n}\r\n\r\nexport function copySelectedRangeToClipboard(beans: BeanCollection, params?: IClipboardCopyParams): void {\r\n    beans.clipboardSvc?.copySelectedRangeToClipboard(params);\r\n}\r\n\r\nexport function copySelectedRangeDown(beans: BeanCollection): void {\r\n    beans.clipboardSvc?.copyRangeDown();\r\n}\r\n\r\nexport function pasteFromClipboard(beans: BeanCollection): void {\r\n    beans.clipboardSvc?.pasteFromClipboard();\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    CellPosition,\r\n    CellRange,\r\n    CsvExportParams,\r\n    GridCtrl,\r\n    GridOptions,\r\n    IClientSideRowModel,\r\n    IClipboardCopyParams,\r\n    IClipboardCopyRowsParams,\r\n    IClipboardService,\r\n    IRangeService,\r\n    NamedBean,\r\n    ProcessCellForExportParams,\r\n    ProcessRowGroupForExportParams,\r\n    RowNode,\r\n    RowPosition,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    ChangedPath,\r\n    _createCellId,\r\n    _exists,\r\n    _getActiveDomElement,\r\n    _getDocument,\r\n    _getRowNode,\r\n    _isClientSideRowModel,\r\n    _isSameRow,\r\n    _last,\r\n    _removeFromArray,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\ninterface RowCallback {\r\n    (\r\n        gridRow: RowPosition,\r\n        rowNode: RowNode | undefined,\r\n        columns: AgColumn[],\r\n        rangeIndex: number,\r\n        isLastRow?: boolean\r\n    ): void;\r\n}\r\n\r\ninterface ColumnCallback {\r\n    (columns: AgColumn[]): void;\r\n}\r\n\r\ntype CellsToFlashType = { [key: string]: boolean };\r\ntype DataForCellRangesType = { data: string; cellsToFlash: CellsToFlashType };\r\n\r\n// Matches value in changeDetectionService\r\nconst SOURCE_PASTE = 'paste';\r\nconst EXPORT_TYPE_DRAG_COPY = 'dragCopy';\r\nconst EXPORT_TYPE_CLIPBOARD = 'clipboard';\r\n\r\nenum CellClearType {\r\n    CellRange,\r\n    SelectedRows,\r\n    FocusedCell,\r\n}\r\n\r\n// This will parse a delimited string into an array of arrays.\r\nexport function stringToArray(strData: string, delimiter = ','): string[][] {\r\n    const data: any[][] = [];\r\n    const isNewline = (char: string) => char === '\\r' || char === '\\n';\r\n\r\n    let insideQuotedField = false;\r\n\r\n    if (strData === '') {\r\n        return [['']];\r\n    }\r\n\r\n    // iterate over each character, keep track of current row and column (of the returned array)\r\n    for (let row = 0, column = 0, position = 0; position < strData.length; position++) {\r\n        const previousChar = strData[position - 1];\r\n        const currentChar = strData[position];\r\n        const nextChar = strData[position + 1];\r\n        const ensureDataExists = () => {\r\n            if (!data[row]) {\r\n                // create row if it doesn't exist\r\n                data[row] = [];\r\n            }\r\n\r\n            if (!data[row][column]) {\r\n                // create column if it doesn't exist\r\n                data[row][column] = '';\r\n            }\r\n        };\r\n\r\n        ensureDataExists();\r\n\r\n        if (currentChar === '\"') {\r\n            if (insideQuotedField) {\r\n                if (nextChar === '\"') {\r\n                    // unescape double quote\r\n                    data[row][column] += '\"';\r\n                    position++;\r\n                } else {\r\n                    // exit quoted field\r\n                    insideQuotedField = false;\r\n                }\r\n\r\n                // continue;\r\n            } else if (previousChar === undefined || previousChar === delimiter || isNewline(previousChar)) {\r\n                // enter quoted field\r\n                insideQuotedField = true;\r\n                // continue;\r\n            }\r\n        }\r\n\r\n        if (!insideQuotedField && currentChar !== '\"') {\r\n            if (currentChar === delimiter) {\r\n                // move to next column\r\n                column++;\r\n                ensureDataExists();\r\n\r\n                continue;\r\n            } else if (isNewline(currentChar)) {\r\n                // move to next row\r\n                column = 0;\r\n                row++;\r\n                ensureDataExists();\r\n\r\n                if (currentChar === '\\r' && nextChar === '\\n') {\r\n                    // skip over second newline character if it exists\r\n                    position++;\r\n                }\r\n\r\n                continue;\r\n            }\r\n        }\r\n\r\n        // add current character to current column\r\n        data[row][column] += currentChar;\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\nexport class ClipboardService extends BeanStub implements NamedBean, IClipboardService {\r\n    beanName = 'clipboardSvc' as const;\r\n\r\n    private clientSideRowModel: IClientSideRowModel | null = null;\r\n    private gridCtrl: GridCtrl | null = null;\r\n    private lastPasteOperationTime: number = 0;\r\n\r\n    private navigatorApiFailed = false;\r\n\r\n    public postConstruct(): void {\r\n        const { gos, rowModel, ctrlsSvc } = this.beans;\r\n        if (_isClientSideRowModel(gos, rowModel)) {\r\n            this.clientSideRowModel = rowModel;\r\n        }\r\n\r\n        ctrlsSvc.whenReady(this, (p) => {\r\n            this.gridCtrl = p.gridCtrl;\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n\r\n        this.clientSideRowModel = null;\r\n        this.gridCtrl = null;\r\n    }\r\n\r\n    public pasteFromClipboard(): void {\r\n        // Method 1 - native clipboard API, available in modern chrome browsers\r\n        const allowNavigator = !this.gos.get('suppressClipboardApi');\r\n        // Some browsers (Firefox) do not allow Web Applications to read from\r\n        // the clipboard so verify if not only the ClipboardAPI is available,\r\n        // but also if the `readText` method is public.\r\n        if (allowNavigator && !this.navigatorApiFailed && navigator.clipboard && navigator.clipboard.readText) {\r\n            navigator.clipboard\r\n                .readText()\r\n                .then(this.processClipboardData.bind(this))\r\n                .catch((e) => {\r\n                    _warn(40, { e, method: 'readText' });\r\n                    this.navigatorApiFailed = true;\r\n                    this.pasteFromClipboardLegacy();\r\n                });\r\n        } else {\r\n            this.pasteFromClipboardLegacy();\r\n        }\r\n    }\r\n\r\n    private pasteFromClipboardLegacy(): void {\r\n        // Method 2 - if modern API fails, the old school hack\r\n        let defaultPrevented = false;\r\n        const handlePasteEvent = (e: ClipboardEvent) => {\r\n            const currentPastOperationTime = new Date().getTime();\r\n            if (currentPastOperationTime - this.lastPasteOperationTime < 50) {\r\n                defaultPrevented = true;\r\n                e.preventDefault();\r\n            }\r\n            this.lastPasteOperationTime = currentPastOperationTime;\r\n        };\r\n\r\n        this.executeOnTempElement(\r\n            (textArea) => {\r\n                textArea.addEventListener('paste', handlePasteEvent);\r\n                textArea.focus({ preventScroll: true });\r\n            },\r\n            (element) => {\r\n                const data = element.value;\r\n                if (!defaultPrevented) {\r\n                    this.processClipboardData(data);\r\n                } else {\r\n                    this.refocusLastFocusedCell();\r\n                }\r\n                element.removeEventListener('paste', handlePasteEvent);\r\n            }\r\n        );\r\n    }\r\n\r\n    private refocusLastFocusedCell(): void {\r\n        const { focusSvc } = this.beans;\r\n        const focusedCell = focusSvc.getFocusedCell();\r\n\r\n        if (focusedCell) {\r\n            focusSvc.setFocusedCell({\r\n                rowIndex: focusedCell.rowIndex,\r\n                column: focusedCell.column,\r\n                rowPinned: focusedCell.rowPinned,\r\n                forceBrowserFocus: true,\r\n            });\r\n        }\r\n    }\r\n\r\n    private getClipboardDelimiter() {\r\n        const delimiter = this.gos.get('clipboardDelimiter');\r\n        return _exists(delimiter) ? delimiter : '\\t';\r\n    }\r\n\r\n    private processClipboardData(data: string): void {\r\n        if (data == null) {\r\n            return;\r\n        }\r\n\r\n        let parsedData: string[][] | null = stringToArray(data, this.getClipboardDelimiter());\r\n\r\n        const userFunc = this.gos.getCallback('processDataFromClipboard');\r\n\r\n        if (userFunc) {\r\n            parsedData = userFunc({ data: parsedData });\r\n        }\r\n\r\n        if (parsedData == null) {\r\n            return;\r\n        }\r\n\r\n        if (this.gos.get('suppressLastEmptyLineOnPaste')) {\r\n            this.removeLastLineIfBlank(parsedData);\r\n        }\r\n\r\n        const { rangeSvc } = this.beans;\r\n\r\n        const pasteOperation = (\r\n            cellsToFlash: any,\r\n            updatedRowNodes: RowNode[],\r\n            focusedCell: CellPosition,\r\n            changedPath: ChangedPath | undefined\r\n        ) => {\r\n            const rangeActive = rangeSvc?.isMoreThanOneCell();\r\n            const pasteIntoRange = rangeActive && !this.hasOnlyOneValueToPaste(parsedData!);\r\n\r\n            if (pasteIntoRange) {\r\n                this.pasteIntoActiveRange(rangeSvc!, parsedData!, cellsToFlash, updatedRowNodes, changedPath);\r\n            } else {\r\n                this.pasteStartingFromFocusedCell(parsedData!, cellsToFlash, updatedRowNodes, focusedCell, changedPath);\r\n            }\r\n        };\r\n\r\n        this.doPasteOperation(pasteOperation);\r\n    }\r\n\r\n    // common code to paste operations, e.g. paste to cell, paste to range, and copy range down\r\n    private doPasteOperation(\r\n        pasteOperationFunc: (\r\n            cellsToFlash: any,\r\n            updatedRowNodes: RowNode[],\r\n            focusedCell: CellPosition | null,\r\n            changedPath: ChangedPath | null | undefined\r\n        ) => void\r\n    ): void {\r\n        const source = 'clipboard';\r\n\r\n        const { eventSvc, focusSvc, rowRenderer, gos } = this.beans;\r\n\r\n        eventSvc.dispatchEvent({\r\n            type: 'pasteStart',\r\n            source,\r\n        });\r\n\r\n        const { clientSideRowModel } = this;\r\n        const rootNode = clientSideRowModel?.rootNode;\r\n        const changedPath = rootNode && new ChangedPath(gos.get('aggregateOnlyChangedColumns'), rootNode);\r\n\r\n        const cellsToFlash = {} as any;\r\n        const updatedRowNodes: RowNode[] = [];\r\n        const focusedCell = focusSvc.getFocusedCell();\r\n\r\n        pasteOperationFunc(cellsToFlash, updatedRowNodes, focusedCell, changedPath);\r\n\r\n        const nodesToRefresh: RowNode[] = [...updatedRowNodes];\r\n        if (changedPath) {\r\n            clientSideRowModel.doAggregate(changedPath);\r\n\r\n            // add all nodes impacted by aggregation, as they need refreshed also.\r\n            changedPath.forEachChangedNodeDepthFirst((rowNode) => {\r\n                nodesToRefresh.push(rowNode);\r\n            });\r\n        }\r\n\r\n        // clipboardSvc has to do changeDetection itself, to prevent repeat logic in favour of batching.\r\n        // changeDetectionSvc is disabled for this action.\r\n        rowRenderer.refreshCells({ rowNodes: nodesToRefresh });\r\n\r\n        this.dispatchFlashCells(cellsToFlash);\r\n        this.fireRowChanged(updatedRowNodes);\r\n\r\n        // if using the clipboard hack with a temp element, then the focus has been lost,\r\n        // so need to put it back. otherwise paste operation loosed focus on cell and keyboard\r\n        // navigation stops.\r\n        this.refocusLastFocusedCell();\r\n        eventSvc.dispatchEvent({\r\n            type: 'pasteEnd',\r\n            source,\r\n        });\r\n    }\r\n\r\n    private pasteIntoActiveRange(\r\n        rangeSvc: IRangeService,\r\n        clipboardData: string[][],\r\n        cellsToFlash: any,\r\n        updatedRowNodes: RowNode[],\r\n        changedPath: ChangedPath | undefined\r\n    ) {\r\n        // true if clipboard data can be evenly pasted into range, otherwise false\r\n        const abortRepeatingPasteIntoRows = this.getRangeSize(rangeSvc) % clipboardData.length != 0;\r\n\r\n        let indexOffset = 0;\r\n        let dataRowIndex = 0;\r\n\r\n        const rowCallback: RowCallback = (\r\n            currentRow: RowPosition,\r\n            rowNode: RowNode,\r\n            columns: AgColumn[],\r\n            index: number\r\n        ) => {\r\n            const atEndOfClipboardData = index - indexOffset >= clipboardData.length;\r\n\r\n            if (atEndOfClipboardData) {\r\n                if (abortRepeatingPasteIntoRows) {\r\n                    return;\r\n                }\r\n\r\n                // increment offset and reset data index to repeat paste of data\r\n                indexOffset += dataRowIndex;\r\n                dataRowIndex = 0;\r\n            }\r\n\r\n            const currentRowData = clipboardData[index - indexOffset];\r\n\r\n            // otherwise we are not the first row, so copy\r\n            updatedRowNodes.push(rowNode);\r\n\r\n            const processCellFromClipboardFunc = this.gos.getCallback('processCellFromClipboard');\r\n\r\n            columns.forEach((column, idx) => {\r\n                if (!column.isCellEditable(rowNode) || column.isSuppressPaste(rowNode)) {\r\n                    return;\r\n                }\r\n\r\n                // repeat data for columns we don't have data for - happens when to range is bigger than copied data range\r\n                if (idx >= currentRowData.length) {\r\n                    idx = idx % currentRowData.length;\r\n                }\r\n\r\n                const newValue = this.processCell(\r\n                    rowNode,\r\n                    column,\r\n                    currentRowData[idx],\r\n                    EXPORT_TYPE_DRAG_COPY,\r\n                    processCellFromClipboardFunc,\r\n                    true\r\n                );\r\n\r\n                rowNode.setDataValue(column, newValue, SOURCE_PASTE);\r\n\r\n                if (changedPath) {\r\n                    changedPath.addParentNode(rowNode.parent, [column]);\r\n                }\r\n\r\n                const { rowIndex, rowPinned } = currentRow;\r\n                const cellId = _createCellId({ rowIndex, column, rowPinned });\r\n                cellsToFlash[cellId] = true;\r\n            });\r\n\r\n            dataRowIndex++;\r\n        };\r\n\r\n        this.iterateActiveRanges(false, rowCallback);\r\n    }\r\n\r\n    private getDisplayedColumnsStartingAt(column: AgColumn): AgColumn[] {\r\n        let currentColumn: AgColumn | null = column;\r\n        const columns: AgColumn[] = [];\r\n        const visibleCols = this.beans.visibleCols;\r\n\r\n        while (currentColumn != null) {\r\n            columns.push(currentColumn);\r\n            currentColumn = visibleCols.getColAfter(currentColumn);\r\n        }\r\n\r\n        return columns;\r\n    }\r\n\r\n    private pasteStartingFromFocusedCell(\r\n        parsedData: string[][],\r\n        cellsToFlash: any,\r\n        updatedRowNodes: RowNode[],\r\n        focusedCell: CellPosition,\r\n        changedPath: ChangedPath | undefined\r\n    ) {\r\n        if (!focusedCell) {\r\n            return;\r\n        }\r\n\r\n        const currentRow: RowPosition = { rowIndex: focusedCell.rowIndex, rowPinned: focusedCell.rowPinned };\r\n        const columnsToPasteInto = this.getDisplayedColumnsStartingAt(focusedCell.column as AgColumn);\r\n\r\n        if (this.isPasteSingleValueIntoRange(parsedData)) {\r\n            this.pasteSingleValueIntoRange(parsedData, updatedRowNodes, cellsToFlash, changedPath);\r\n        } else {\r\n            this.pasteMultipleValues(\r\n                parsedData,\r\n                currentRow,\r\n                updatedRowNodes,\r\n                columnsToPasteInto,\r\n                cellsToFlash,\r\n                EXPORT_TYPE_CLIPBOARD,\r\n                changedPath\r\n            );\r\n        }\r\n    }\r\n\r\n    // if range is active, and only one cell, then we paste this cell into all cells in the active range.\r\n    private isPasteSingleValueIntoRange(parsedData: string[][]): boolean {\r\n        const rangeSvc = this.beans.rangeSvc;\r\n        return this.hasOnlyOneValueToPaste(parsedData) && !!rangeSvc && !rangeSvc.isEmpty();\r\n    }\r\n\r\n    private pasteSingleValueIntoRange(\r\n        parsedData: string[][],\r\n        updatedRowNodes: RowNode[],\r\n        cellsToFlash: any,\r\n        changedPath: ChangedPath | undefined\r\n    ) {\r\n        const value = parsedData[0][0];\r\n\r\n        const rowCallback: RowCallback = (currentRow: RowPosition, rowNode: RowNode, columns: AgColumn[]) => {\r\n            updatedRowNodes.push(rowNode);\r\n            columns.forEach((column) =>\r\n                this.updateCellValue(rowNode, column, value, cellsToFlash, EXPORT_TYPE_CLIPBOARD, changedPath)\r\n            );\r\n        };\r\n\r\n        this.iterateActiveRanges(false, rowCallback);\r\n    }\r\n\r\n    private hasOnlyOneValueToPaste(parsedData: string[][]) {\r\n        return parsedData.length === 1 && parsedData[0].length === 1;\r\n    }\r\n\r\n    public copyRangeDown(): void {\r\n        const { rangeSvc, gos, valueSvc } = this.beans;\r\n        if (!rangeSvc || rangeSvc.isEmpty()) {\r\n            return;\r\n        }\r\n\r\n        const firstRowValues: any[] = [];\r\n\r\n        const pasteOperation = (\r\n            cellsToFlash: any,\r\n            updatedRowNodes: RowNode[],\r\n            focusedCell: CellPosition,\r\n            changedPath: ChangedPath | undefined\r\n        ) => {\r\n            const processCellForClipboardFunc = gos.getCallback('processCellForClipboard');\r\n            const processCellFromClipboardFunc = gos.getCallback('processCellFromClipboard');\r\n\r\n            const rowCallback: RowCallback = (currentRow: RowPosition, rowNode: RowNode, columns: AgColumn[]) => {\r\n                // take reference of first row, this is the one we will be using to copy from\r\n                if (!firstRowValues.length) {\r\n                    // two reasons for looping through columns\r\n                    columns.forEach((column) => {\r\n                        // get the initial values to copy down\r\n                        const value = this.processCell(\r\n                            rowNode,\r\n                            column,\r\n                            valueSvc.getValue(column, rowNode),\r\n                            EXPORT_TYPE_DRAG_COPY,\r\n                            processCellForClipboardFunc,\r\n                            false,\r\n                            true\r\n                        );\r\n\r\n                        firstRowValues.push(value);\r\n                    });\r\n                } else {\r\n                    // otherwise we are not the first row, so copy\r\n                    updatedRowNodes.push(rowNode);\r\n                    columns.forEach((column, index) => {\r\n                        if (!column.isCellEditable(rowNode) || column.isSuppressPaste(rowNode)) {\r\n                            return;\r\n                        }\r\n\r\n                        const firstRowValue = this.processCell(\r\n                            rowNode,\r\n                            column,\r\n                            firstRowValues[index],\r\n                            EXPORT_TYPE_DRAG_COPY,\r\n                            processCellFromClipboardFunc,\r\n                            true\r\n                        );\r\n\r\n                        rowNode.setDataValue(column, firstRowValue, SOURCE_PASTE);\r\n\r\n                        if (changedPath) {\r\n                            changedPath.addParentNode(rowNode.parent, [column]);\r\n                        }\r\n\r\n                        const { rowIndex, rowPinned } = currentRow;\r\n                        const cellId = _createCellId({ rowIndex, column, rowPinned });\r\n                        cellsToFlash[cellId] = true;\r\n                    });\r\n                }\r\n            };\r\n\r\n            this.iterateActiveRanges(true, rowCallback);\r\n        };\r\n\r\n        this.doPasteOperation(pasteOperation);\r\n    }\r\n\r\n    private removeLastLineIfBlank(parsedData: string[][]): void {\r\n        // remove last row if empty, excel puts empty last row in\r\n        const lastLine = _last(parsedData);\r\n        const lastLineIsBlank = lastLine && lastLine.length === 1 && lastLine[0] === '';\r\n\r\n        if (lastLineIsBlank) {\r\n            // do not remove the last empty line when that is the only line pasted\r\n            if (parsedData.length === 1) {\r\n                return;\r\n            }\r\n            _removeFromArray(parsedData, lastLine);\r\n        }\r\n    }\r\n\r\n    private fireRowChanged(rowNodes: RowNode[]): void {\r\n        if (this.gos.get('editType') !== 'fullRow') {\r\n            return;\r\n        }\r\n\r\n        rowNodes.forEach((rowNode) => {\r\n            this.eventSvc.dispatchEvent({\r\n                type: 'rowValueChanged',\r\n                node: rowNode,\r\n                data: rowNode.data,\r\n                rowIndex: rowNode.rowIndex!,\r\n                rowPinned: rowNode.rowPinned,\r\n            });\r\n        });\r\n    }\r\n\r\n    private pasteMultipleValues(\r\n        clipboardGridData: string[][],\r\n        currentRow: RowPosition | null,\r\n        updatedRowNodes: RowNode[],\r\n        columnsToPasteInto: AgColumn[],\r\n        cellsToFlash: any,\r\n        type: string,\r\n        changedPath: ChangedPath | undefined\r\n    ): void {\r\n        let rowPointer = currentRow;\r\n\r\n        const beans = this.beans;\r\n        const { gos, cellNavigation } = beans;\r\n\r\n        // if doing CSRM and NOT tree data, then it means groups are aggregates, which are read only,\r\n        // so we should skip them when doing paste operations.\r\n        const skipGroupRows = this.clientSideRowModel != null && !gos.get('enableGroupEdit') && !gos.get('treeData');\r\n\r\n        const getNextGoodRowNode = () => {\r\n            while (true) {\r\n                if (!rowPointer) {\r\n                    return null;\r\n                }\r\n                const res = _getRowNode(beans, rowPointer);\r\n                // move to next row down for next set of values\r\n                rowPointer = cellNavigation!.getRowBelow({\r\n                    rowPinned: rowPointer.rowPinned,\r\n                    rowIndex: rowPointer.rowIndex,\r\n                });\r\n\r\n                // if no more rows, return null\r\n                if (res == null) {\r\n                    return null;\r\n                }\r\n\r\n                // skip details rows and footer rows, never paste into them as they don't hold data\r\n                const skipRow = res.detail || res.footer || (skipGroupRows && res.group);\r\n\r\n                // skipping row means we go into the next iteration of the while loop\r\n                if (!skipRow) {\r\n                    return res;\r\n                }\r\n            }\r\n        };\r\n\r\n        clipboardGridData.forEach((clipboardRowData) => {\r\n            const rowNode = getNextGoodRowNode();\r\n\r\n            // if we have come to end of rows in grid, then skip\r\n            if (!rowNode) {\r\n                return;\r\n            }\r\n\r\n            clipboardRowData.forEach((value, index) =>\r\n                this.updateCellValue(rowNode, columnsToPasteInto[index], value, cellsToFlash, type, changedPath)\r\n            );\r\n\r\n            updatedRowNodes.push(rowNode);\r\n        });\r\n    }\r\n\r\n    private updateCellValue(\r\n        rowNode: RowNode | null,\r\n        column: AgColumn,\r\n        value: string,\r\n        cellsToFlash: any,\r\n        type: string,\r\n        changedPath: ChangedPath | undefined\r\n    ) {\r\n        if (!rowNode || !column || !column.isCellEditable(rowNode) || column.isSuppressPaste(rowNode)) {\r\n            return;\r\n        }\r\n\r\n        const processedValue = this.processCell(\r\n            rowNode,\r\n            column,\r\n            value,\r\n            type,\r\n            this.gos.getCallback('processCellFromClipboard'),\r\n            true\r\n        );\r\n        rowNode.setDataValue(column, processedValue, SOURCE_PASTE);\r\n\r\n        const { rowIndex, rowPinned } = rowNode;\r\n        const cellId = _createCellId({ rowIndex: rowIndex!, column, rowPinned });\r\n        cellsToFlash[cellId] = true;\r\n\r\n        if (changedPath) {\r\n            changedPath.addParentNode(rowNode.parent, [column]);\r\n        }\r\n    }\r\n\r\n    public copyToClipboard(params: IClipboardCopyParams = {}): void {\r\n        this.copyOrCutToClipboard(params);\r\n    }\r\n\r\n    public cutToClipboard(params: IClipboardCopyParams = {}, source: 'api' | 'ui' | 'contextMenu' = 'api'): void {\r\n        if (this.gos.get('suppressCutToClipboard')) {\r\n            return;\r\n        }\r\n\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'cutStart',\r\n            source,\r\n        });\r\n\r\n        this.copyOrCutToClipboard(params, true);\r\n\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'cutEnd',\r\n            source,\r\n        });\r\n    }\r\n\r\n    private copyOrCutToClipboard(params: IClipboardCopyParams, cut?: boolean): void {\r\n        let { includeHeaders, includeGroupHeaders } = params;\r\n        const { gos, focusSvc } = this.beans;\r\n\r\n        // don't override 'includeHeaders' if it has been explicitly set to 'false'\r\n        if (includeHeaders == null) {\r\n            includeHeaders = gos.get('copyHeadersToClipboard');\r\n        }\r\n\r\n        if (includeGroupHeaders == null) {\r\n            includeGroupHeaders = gos.get('copyGroupHeadersToClipboard');\r\n        }\r\n\r\n        const copyParams = { includeHeaders, includeGroupHeaders };\r\n        const rowSelection = gos.get('rowSelection');\r\n        const cellSelection = gos.get('cellSelection');\r\n\r\n        let cellClearType: CellClearType | null = null;\r\n        // Copy priority is Range > Row > Focus\r\n        if (this.shouldCopyCells(cellSelection, rowSelection)) {\r\n            this.copySelectedRangeToClipboard(copyParams);\r\n            cellClearType = CellClearType.CellRange;\r\n        } else if (this.shouldCopyRows(rowSelection)) {\r\n            this.copySelectedRowsToClipboard(copyParams);\r\n            cellClearType = CellClearType.SelectedRows;\r\n        } else if (focusSvc.isAnyCellFocused()) {\r\n            this.copyFocusedCellToClipboard(copyParams);\r\n            cellClearType = CellClearType.FocusedCell;\r\n        }\r\n\r\n        if (cut && cellClearType !== null) {\r\n            this.clearCellsAfterCopy(cellClearType);\r\n        }\r\n    }\r\n\r\n    private shouldCopyCells(cellSelection?: GridOptions['cellSelection'], rowSelection?: GridOptions['rowSelection']) {\r\n        const { rangeSvc, selectionSvc, gos } = this.beans;\r\n        if (!rangeSvc || rangeSvc.isEmpty()) {\r\n            return false;\r\n        }\r\n\r\n        if (cellSelection) {\r\n            // If `cellSelection` is defined, user is using the new cell selection API, so we only copy\r\n            // cells by default.\r\n            const shouldCopyRowsInstead =\r\n                typeof rowSelection === 'object' && rowSelection.copySelectedRows && !selectionSvc?.isEmpty();\r\n            return !shouldCopyRowsInstead;\r\n        } else {\r\n            // If user is using the deprecated API, we preserve the previous behaviour\r\n            const suppressCopySingleCellRanges = gos.get('suppressCopySingleCellRanges');\r\n            const shouldSkip = !rangeSvc.isMoreThanOneCell() && suppressCopySingleCellRanges;\r\n            return !shouldSkip;\r\n        }\r\n    }\r\n\r\n    private shouldCopyRows(rowSelection?: GridOptions['rowSelection']) {\r\n        const { selectionSvc, gos } = this.beans;\r\n        if (selectionSvc?.isEmpty() ?? true) {\r\n            return false;\r\n        }\r\n\r\n        if (rowSelection && typeof rowSelection !== 'string') {\r\n            // If `rowSelection` is defined as an object, user is using the new selection API, so we determine\r\n            // behaviour based on `copySelectedRows`\r\n            return rowSelection.copySelectedRows ?? false;\r\n        } else {\r\n            // If user is using the deprecated API, we preserve the previous behaviour\r\n            return !gos.get('suppressCopyRowsToClipboard');\r\n        }\r\n    }\r\n\r\n    private clearCellsAfterCopy(type: CellClearType) {\r\n        const beans = this.beans;\r\n        const { rangeSvc, focusSvc, eventSvc } = beans;\r\n        eventSvc.dispatchEvent({ type: 'keyShortcutChangedCellStart' });\r\n        if (type === CellClearType.CellRange) {\r\n            rangeSvc!.clearCellRangeCellValues({ cellEventSource: 'clipboardSvc' });\r\n        } else if (type === CellClearType.SelectedRows) {\r\n            this.clearSelectedRows();\r\n        } else {\r\n            const focusedCell = focusSvc.getFocusedCell();\r\n            if (focusedCell == null) {\r\n                return;\r\n            }\r\n\r\n            const rowNode = _getRowNode(beans, focusedCell);\r\n            if (rowNode) {\r\n                this.clearCellValue(rowNode, focusedCell.column as AgColumn);\r\n            }\r\n        }\r\n        eventSvc.dispatchEvent({ type: 'keyShortcutChangedCellEnd' });\r\n    }\r\n\r\n    private clearSelectedRows(): void {\r\n        const { selectionSvc, visibleCols } = this.beans;\r\n        const selected = selectionSvc?.getSelectedNodes() ?? [];\r\n        const columns = visibleCols.allCols;\r\n\r\n        for (const row of selected) {\r\n            for (const col of columns) {\r\n                this.clearCellValue(row, col);\r\n            }\r\n        }\r\n    }\r\n\r\n    private clearCellValue(rowNode: RowNode, column: AgColumn): void {\r\n        if (!column.isCellEditable(rowNode)) {\r\n            return;\r\n        }\r\n        const emptyValue = this.beans.valueSvc.getDeleteValue(column, rowNode);\r\n        rowNode.setDataValue(column, emptyValue, 'clipboardSvc');\r\n    }\r\n\r\n    private iterateActiveRanges(onlyFirst: boolean, rowCallback: RowCallback, columnCallback?: ColumnCallback): void {\r\n        const rangeSvc = this.beans.rangeSvc;\r\n        if (!rangeSvc || rangeSvc.isEmpty()) {\r\n            return;\r\n        }\r\n\r\n        const cellRanges = rangeSvc.getCellRanges();\r\n\r\n        if (onlyFirst) {\r\n            this.iterateActiveRange(cellRanges[0], rowCallback, columnCallback, true);\r\n        } else {\r\n            cellRanges.forEach((range, idx) =>\r\n                this.iterateActiveRange(range, rowCallback, columnCallback, idx === cellRanges.length - 1)\r\n            );\r\n        }\r\n    }\r\n\r\n    private iterateActiveRange(\r\n        range: CellRange,\r\n        rowCallback: RowCallback,\r\n        columnCallback?: ColumnCallback,\r\n        isLastRange?: boolean\r\n    ): void {\r\n        const { rangeSvc, cellNavigation } = this.beans;\r\n        if (!rangeSvc) {\r\n            return;\r\n        }\r\n\r\n        let currentRow: RowPosition | null = rangeSvc.getRangeStartRow(range);\r\n        const lastRow = rangeSvc.getRangeEndRow(range);\r\n\r\n        if (columnCallback && range.columns) {\r\n            columnCallback(range.columns as AgColumn[]);\r\n        }\r\n\r\n        let rangeIndex = 0;\r\n        let isLastRow = false;\r\n\r\n        // the currentRow could be missing if the user sets the active range manually, and sets a range\r\n        // that is outside of the grid (eg. sets range rows 0 to 100, but grid has only 20 rows).\r\n        while (!isLastRow && currentRow != null) {\r\n            const rowNode = _getRowNode(this.beans, currentRow);\r\n            isLastRow = _isSameRow(currentRow, lastRow);\r\n\r\n            rowCallback(currentRow, rowNode, range.columns as AgColumn[], rangeIndex++, isLastRow && isLastRange);\r\n\r\n            currentRow = cellNavigation!.getRowBelow(currentRow);\r\n        }\r\n    }\r\n\r\n    public copySelectedRangeToClipboard(params: IClipboardCopyParams = {}): void {\r\n        const rangeSvc = this.beans.rangeSvc;\r\n        if (!rangeSvc || rangeSvc.isEmpty()) {\r\n            return;\r\n        }\r\n\r\n        const allRangesMerge = rangeSvc.areAllRangesAbleToMerge();\r\n        const { data, cellsToFlash } = allRangesMerge\r\n            ? this.buildDataFromMergedRanges(rangeSvc, params)\r\n            : this.buildDataFromRanges(rangeSvc, params);\r\n\r\n        this.copyDataToClipboard(data);\r\n        this.dispatchFlashCells(cellsToFlash);\r\n    }\r\n\r\n    private buildDataFromMergedRanges(rangeSvc: IRangeService, params: IClipboardCopyParams): DataForCellRangesType {\r\n        const columnsSet: Set<AgColumn> = new Set();\r\n        const ranges = rangeSvc.getCellRanges();\r\n        const rowPositionsMap: Map<string, boolean> = new Map();\r\n        const allRowPositions: RowPosition[] = [];\r\n        const allCellsToFlash: CellsToFlashType = {};\r\n\r\n        ranges.forEach((range) => {\r\n            range.columns.forEach((col: AgColumn) => columnsSet.add(col));\r\n            const { rowPositions, cellsToFlash } = this.getRangeRowPositionsAndCellsToFlash(rangeSvc, range);\r\n            rowPositions.forEach((rowPosition) => {\r\n                const rowPositionAsString = `${rowPosition.rowIndex}-${rowPosition.rowPinned || 'null'}`;\r\n                if (!rowPositionsMap.get(rowPositionAsString)) {\r\n                    rowPositionsMap.set(rowPositionAsString, true);\r\n                    allRowPositions.push(rowPosition);\r\n                }\r\n            });\r\n            Object.assign(allCellsToFlash, cellsToFlash);\r\n        });\r\n\r\n        const allColumns = this.beans.visibleCols.allCols;\r\n        const exportedColumns = Array.from(columnsSet) as AgColumn[];\r\n\r\n        exportedColumns.sort((a, b) => {\r\n            const posA = allColumns.indexOf(a);\r\n            const posB = allColumns.indexOf(b);\r\n\r\n            return posA - posB;\r\n        });\r\n\r\n        const data = this.buildExportParams({\r\n            columns: exportedColumns,\r\n            rowPositions: allRowPositions,\r\n            includeHeaders: params.includeHeaders,\r\n            includeGroupHeaders: params.includeGroupHeaders,\r\n        });\r\n\r\n        return { data, cellsToFlash: allCellsToFlash };\r\n    }\r\n\r\n    private buildDataFromRanges(rangeSvc: IRangeService, params: IClipboardCopyParams): DataForCellRangesType {\r\n        const ranges = rangeSvc.getCellRanges();\r\n        const data: string[] = [];\r\n        const allCellsToFlash: CellsToFlashType = {};\r\n\r\n        ranges.forEach((range) => {\r\n            const { rowPositions, cellsToFlash } = this.getRangeRowPositionsAndCellsToFlash(rangeSvc, range);\r\n            Object.assign(allCellsToFlash, cellsToFlash);\r\n            data.push(\r\n                this.buildExportParams({\r\n                    columns: range.columns as AgColumn[],\r\n                    rowPositions: rowPositions,\r\n                    includeHeaders: params.includeHeaders,\r\n                    includeGroupHeaders: params.includeGroupHeaders,\r\n                })\r\n            );\r\n        });\r\n\r\n        return { data: data.join('\\n'), cellsToFlash: allCellsToFlash };\r\n    }\r\n\r\n    private getRangeRowPositionsAndCellsToFlash(\r\n        rangeSvc: IRangeService,\r\n        range: CellRange\r\n    ): { rowPositions: RowPosition[]; cellsToFlash: CellsToFlashType } {\r\n        const rowPositions: RowPosition[] = [];\r\n        const cellsToFlash: CellsToFlashType = {};\r\n        const startRow = rangeSvc.getRangeStartRow(range);\r\n        const lastRow = rangeSvc.getRangeEndRow(range);\r\n\r\n        let node: RowPosition | null = startRow;\r\n\r\n        while (node) {\r\n            rowPositions.push(node);\r\n            range.columns.forEach((column) => {\r\n                const { rowIndex, rowPinned } = node!;\r\n                const cellId = _createCellId({ rowIndex, column, rowPinned });\r\n                cellsToFlash[cellId] = true;\r\n            });\r\n            if (_isSameRow(node, lastRow)) {\r\n                break;\r\n            }\r\n            node = this.beans.cellNavigation!.getRowBelow(node);\r\n        }\r\n\r\n        return { rowPositions, cellsToFlash };\r\n    }\r\n\r\n    private getCellsToFlashFromRowNodes(rowNodes: RowNode[]): CellsToFlashType {\r\n        const allDisplayedColumns = this.beans.visibleCols.allCols;\r\n        const cellsToFlash: CellsToFlashType = {};\r\n        for (let i = 0; i < rowNodes.length; i++) {\r\n            const { level, rowIndex: index, rowPinned, sibling } = rowNodes[i];\r\n\r\n            // Account for the grand total row (sibling of root node)\r\n            const rowIndex = level === -1 ? sibling.rowIndex : index;\r\n\r\n            if (rowIndex == null) {\r\n                continue;\r\n            }\r\n            for (let j = 0; j < allDisplayedColumns.length; j++) {\r\n                const column = allDisplayedColumns[j];\r\n                const cellId = _createCellId({ rowIndex, column, rowPinned });\r\n                cellsToFlash[cellId] = true;\r\n            }\r\n        }\r\n\r\n        return cellsToFlash;\r\n    }\r\n\r\n    private copyFocusedCellToClipboard(params: IClipboardCopyParams = {}): void {\r\n        const focusedCell = this.beans.focusSvc.getFocusedCell();\r\n\r\n        if (focusedCell == null) {\r\n            return;\r\n        }\r\n\r\n        const cellId = _createCellId(focusedCell);\r\n        const currentRow: RowPosition = { rowPinned: focusedCell.rowPinned, rowIndex: focusedCell.rowIndex };\r\n        const column = focusedCell.column as AgColumn;\r\n\r\n        const data = this.buildExportParams({\r\n            columns: [column],\r\n            rowPositions: [currentRow],\r\n            includeHeaders: params.includeHeaders,\r\n            includeGroupHeaders: params.includeGroupHeaders,\r\n        });\r\n\r\n        this.copyDataToClipboard(data);\r\n        this.dispatchFlashCells({ [cellId]: true });\r\n    }\r\n\r\n    public copySelectedRowsToClipboard(params: IClipboardCopyRowsParams = {}): void {\r\n        const { columnKeys, includeHeaders, includeGroupHeaders } = params;\r\n\r\n        const data = this.buildExportParams({\r\n            columns: columnKeys as (string | AgColumn)[] | undefined,\r\n            includeHeaders,\r\n            includeGroupHeaders,\r\n        });\r\n\r\n        this.copyDataToClipboard(data);\r\n        const rowNodes = this.beans.selectionSvc?.getSelectedNodes() || [];\r\n        this.dispatchFlashCells(this.getCellsToFlashFromRowNodes(rowNodes));\r\n    }\r\n\r\n    private buildExportParams(params: {\r\n        columns?: (string | AgColumn)[];\r\n        rowPositions?: RowPosition[];\r\n        includeHeaders?: boolean;\r\n        includeGroupHeaders?: boolean;\r\n    }): string {\r\n        const { columns, rowPositions, includeHeaders = false, includeGroupHeaders = false } = params;\r\n        const { gos, csvCreator } = this.beans;\r\n\r\n        const exportParams: CsvExportParams = {\r\n            columnKeys: columns,\r\n            rowPositions,\r\n            skipColumnHeaders: !includeHeaders,\r\n            skipColumnGroupHeaders: !includeGroupHeaders,\r\n            suppressQuotes: true,\r\n            columnSeparator: this.getClipboardDelimiter(),\r\n            onlySelected: !rowPositions,\r\n            processCellCallback: gos.getCallback('processCellForClipboard'),\r\n            processRowGroupCallback: (params) => this.processRowGroupCallback(params),\r\n            processHeaderCallback: gos.getCallback('processHeaderForClipboard'),\r\n            processGroupHeaderCallback: gos.getCallback('processGroupHeaderForClipboard'),\r\n        };\r\n\r\n        return csvCreator!.getDataAsCsv(exportParams, true);\r\n    }\r\n\r\n    private processRowGroupCallback({ node, column }: ProcessRowGroupForExportParams) {\r\n        const { gos, valueSvc, rowGroupColsSvc } = this.beans;\r\n\r\n        const isTreeData = gos.get('treeData');\r\n\r\n        // if not tree datathen we get the value from the group data\r\n        const getValueFromNode = () => {\r\n            if (isTreeData || !column) {\r\n                return node.key;\r\n            }\r\n            const value = node.groupData?.[column.getId()];\r\n            if (\r\n                !value ||\r\n                !node.rowGroupColumn ||\r\n                node.rowGroupColumn.getColDef().useValueFormatterForExport === false\r\n            ) {\r\n                return value;\r\n            }\r\n            return valueSvc.formatValue(node.rowGroupColumn as AgColumn, node, value) ?? value;\r\n        };\r\n        let value = getValueFromNode();\r\n\r\n        if (node.footer) {\r\n            let suffix = '';\r\n            if (value && value.length) {\r\n                suffix = ` ${value}`;\r\n            }\r\n            value = `Total${suffix}`;\r\n        }\r\n        const processCellForClipboard = gos.getCallback('processCellForClipboard');\r\n\r\n        if (processCellForClipboard) {\r\n            let column = node.rowGroupColumn as AgColumn;\r\n\r\n            if (!column && node.footer && node.level === -1 && rowGroupColsSvc) {\r\n                column = rowGroupColsSvc.columns[0];\r\n            }\r\n            return processCellForClipboard({\r\n                value,\r\n                node,\r\n                column,\r\n                type: 'clipboard',\r\n                formatValue: (valueToFormat) => valueSvc.formatValue(column, node, valueToFormat) ?? valueToFormat,\r\n                parseValue: (valueToParse) =>\r\n                    valueSvc.parseValue(column, node, valueToParse, valueSvc.getValue(column, node)),\r\n            });\r\n        }\r\n        return value;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    private dispatchFlashCells(cellsToFlash: {}): void {\r\n        window.setTimeout(() => {\r\n            this.eventSvc.dispatchEvent({\r\n                type: 'flashCells',\r\n                cells: cellsToFlash,\r\n            });\r\n        }, 0);\r\n    }\r\n\r\n    private processCell<T>(\r\n        rowNode: RowNode | undefined,\r\n        column: AgColumn,\r\n        value: T,\r\n        type: string,\r\n        func?: (params: WithoutGridCommon<ProcessCellForExportParams>) => T,\r\n        canParse?: boolean,\r\n        canFormat?: boolean\r\n    ): T {\r\n        const valueSvc = this.beans.valueSvc;\r\n        if (func) {\r\n            const params: WithoutGridCommon<ProcessCellForExportParams> = {\r\n                column,\r\n                node: rowNode,\r\n                value,\r\n                type,\r\n                formatValue: (valueToFormat: any) =>\r\n                    valueSvc.formatValue(column, rowNode ?? null, valueToFormat) ?? valueToFormat,\r\n                parseValue: (valueToParse: string) =>\r\n                    valueSvc.parseValue(column, rowNode ?? null, valueToParse, valueSvc.getValue(column, rowNode)),\r\n            };\r\n\r\n            return func(params);\r\n        }\r\n\r\n        if (canParse && column.getColDef().useValueParserForImport !== false) {\r\n            return valueSvc.parseValue(column, rowNode ?? null, value, valueSvc.getValue(column, rowNode));\r\n        }\r\n\r\n        if (canFormat && column.getColDef().useValueFormatterForExport !== false) {\r\n            return valueSvc.formatValue(column, rowNode ?? null, value) ?? (value as any);\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    private copyDataToClipboard(data: string): void {\r\n        const userProvidedFunc = this.gos.getCallback('sendToClipboard');\r\n\r\n        // method 1 - user provided func\r\n        if (userProvidedFunc) {\r\n            userProvidedFunc({ data });\r\n            return;\r\n        }\r\n\r\n        // method 2 - native clipboard API, available in modern chrome browsers\r\n        const allowNavigator = !this.gos.get('suppressClipboardApi');\r\n        if (allowNavigator && navigator.clipboard) {\r\n            navigator.clipboard.writeText(data).catch((e) => {\r\n                _warn(40, { e, method: 'writeText' });\r\n                this.copyDataToClipboardLegacy(data);\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.copyDataToClipboardLegacy(data);\r\n    }\r\n\r\n    private copyDataToClipboardLegacy(data: string): void {\r\n        // method 3 - if all else fails, the old school hack\r\n        this.executeOnTempElement((element) => {\r\n            const eDocument = _getDocument(this.beans);\r\n            const focusedElementBefore = _getActiveDomElement(this.beans) as HTMLElement;\r\n\r\n            element.value = data || ' '; // has to be non-empty value or execCommand will not do anything\r\n            element.select();\r\n            element.focus({ preventScroll: true });\r\n\r\n            const result = eDocument.execCommand('copy');\r\n\r\n            if (!result) {\r\n                _warn(41);\r\n            }\r\n\r\n            if (focusedElementBefore != null && focusedElementBefore.focus != null) {\r\n                focusedElementBefore.focus({ preventScroll: true });\r\n            }\r\n        });\r\n    }\r\n\r\n    private executeOnTempElement(\r\n        callbackNow: (element: HTMLTextAreaElement) => void,\r\n        callbackAfter?: (element: HTMLTextAreaElement) => void\r\n    ): void {\r\n        if (!this.gridCtrl) {\r\n            return;\r\n        }\r\n\r\n        const eDoc = _getDocument(this.beans);\r\n        const eTempInput = eDoc.createElement('textarea');\r\n        const style = eTempInput.style;\r\n        style.width = '1px';\r\n        style.height = '1px';\r\n\r\n        // removing items from the DOM causes the document element to scroll to the\r\n        // position where the element was positioned. Here we set scrollTop / scrollLeft\r\n        // to prevent the document element from scrolling when we remove it from the DOM.\r\n        const documentElement = eDoc.documentElement;\r\n        style.top = documentElement.scrollTop + 'px';\r\n        style.left = documentElement.scrollLeft + 'px';\r\n\r\n        style.position = 'absolute';\r\n        style.opacity = '0';\r\n\r\n        const guiRoot = this.gridCtrl.getGui();\r\n\r\n        guiRoot.appendChild(eTempInput);\r\n\r\n        try {\r\n            callbackNow(eTempInput);\r\n        } catch (err) {\r\n            _warn(42);\r\n        }\r\n\r\n        //It needs 100 otherwise OS X seemed to not always be able to paste... Go figure...\r\n        if (callbackAfter) {\r\n            window.setTimeout(() => {\r\n                callbackAfter(eTempInput);\r\n                guiRoot.removeChild(eTempInput);\r\n            }, 100);\r\n        } else {\r\n            guiRoot.removeChild(eTempInput);\r\n        }\r\n    }\r\n\r\n    private getRangeSize(rangeSvc: IRangeService): number {\r\n        const ranges = rangeSvc.getCellRanges();\r\n        let startRangeIndex = 0;\r\n        let endRangeIndex = 0;\r\n\r\n        if (ranges.length > 0) {\r\n            startRangeIndex = rangeSvc.getRangeStartRow(ranges[0]).rowIndex;\r\n            endRangeIndex = rangeSvc.getRangeEndRow(ranges[0]).rowIndex;\r\n        }\r\n\r\n        return startRangeIndex - endRangeIndex + 1;\r\n    }\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\nimport { _ColumnFilterModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { SideBarModule } from '../sideBar/sideBarModule';\r\nimport { VERSION } from '../version';\r\nimport { FiltersToolPanel } from './filtersToolPanel';\r\n\r\n/**\r\n * @feature Accessories -> Filters Tool Panel\r\n */\r\nexport const FiltersToolPanelModule: _ModuleWithoutApi = {\r\n    moduleName: 'FiltersToolPanel',\r\n    version: VERSION,\r\n    userComponents: { agFiltersToolPanel: FiltersToolPanel },\r\n    icons: {\r\n        // filter tool panel tab\r\n        filtersToolPanel: 'filter',\r\n    },\r\n    dependsOn: [SideBarModule, EnterpriseCoreModule, _ColumnFilterModule],\r\n};\r\n", "import type {\r\n    ColDef,\r\n    ColGroupDef,\r\n    FiltersToolPanelState,\r\n    IFiltersToolPanel,\r\n    IToolPanelComp,\r\n    IToolPanelFiltersCompParams,\r\n    IToolPanelParams,\r\n} from 'ag-grid-community';\r\nimport { Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgFiltersToolPanelHeader } from './agFiltersToolPanelHeader';\r\nimport { AgFiltersToolPanelHeaderSelector } from './agFiltersToolPanelHeader';\r\nimport type { AgFiltersToolPanelList } from './agFiltersToolPanelList';\r\nimport { AgFiltersToolPanelListSelector } from './agFiltersToolPanelList';\r\nimport { filtersToolPanelCSS } from './filtersToolPanel.css-GENERATED';\r\n\r\nexport interface ToolPanelFiltersCompParams<TData = any, TContext = any>\r\n    extends IToolPanelParams<TData, TContext, FiltersToolPanelState>,\r\n        IToolPanelFiltersCompParams {}\r\n\r\nexport class FiltersToolPanel extends Component implements IFiltersToolPanel, IToolPanelComp {\r\n    private readonly filtersToolPanelHeaderPanel: AgFiltersToolPanelHeader = RefPlaceholder;\r\n    private readonly filtersToolPanelListPanel: AgFiltersToolPanelList = RefPlaceholder;\r\n\r\n    private initialised = false;\r\n    private params: ToolPanelFiltersCompParams;\r\n    private listenerDestroyFuncs: (() => void)[] = [];\r\n\r\n    constructor() {\r\n        super(\r\n            /* html */ `<div class=\"ag-filter-toolpanel\">\r\n            <ag-filters-tool-panel-header data-ref=\"filtersToolPanelHeaderPanel\"></ag-filters-tool-panel-header>\r\n            <ag-filters-tool-panel-list data-ref=\"filtersToolPanelListPanel\"></ag-filters-tool-panel-list>\r\n         </div>`,\r\n            [AgFiltersToolPanelHeaderSelector, AgFiltersToolPanelListSelector]\r\n        );\r\n        this.registerCSS(filtersToolPanelCSS);\r\n    }\r\n\r\n    public init(params: ToolPanelFiltersCompParams): void {\r\n        // if initialised is true, means this is a refresh\r\n        if (this.initialised) {\r\n            this.listenerDestroyFuncs.forEach((func) => func());\r\n            this.listenerDestroyFuncs = [];\r\n        }\r\n\r\n        this.initialised = true;\r\n\r\n        const defaultParams: Partial<ToolPanelFiltersCompParams> = this.gos.addGridCommonParams({\r\n            suppressExpandAll: false,\r\n            suppressFilterSearch: false,\r\n            suppressSyncLayoutWithGrid: false,\r\n        });\r\n        const newParams = {\r\n            ...defaultParams,\r\n            ...params,\r\n        };\r\n        this.params = newParams;\r\n\r\n        const { filtersToolPanelHeaderPanel, filtersToolPanelListPanel } = this;\r\n        filtersToolPanelHeaderPanel.init(newParams);\r\n        filtersToolPanelListPanel.init(newParams);\r\n\r\n        const hideExpand = newParams.suppressExpandAll;\r\n        const hideSearch = newParams.suppressFilterSearch;\r\n\r\n        if (hideExpand && hideSearch) {\r\n            filtersToolPanelHeaderPanel.setDisplayed(false);\r\n        }\r\n\r\n        // this is necessary to prevent a memory leak while refreshing the tool panel\r\n        this.listenerDestroyFuncs.push(\r\n            ...this.addManagedListeners(filtersToolPanelHeaderPanel, {\r\n                expandAll: () => filtersToolPanelListPanel.expandFilterGroups(true),\r\n                collapseAll: () => filtersToolPanelListPanel.expandFilterGroups(false),\r\n                searchChanged: (event) => filtersToolPanelListPanel.performFilterSearch(event.searchText),\r\n            }),\r\n            ...this.addManagedListeners(filtersToolPanelListPanel, {\r\n                filterExpanded: newParams.onStateUpdated,\r\n                groupExpanded: (event) => {\r\n                    filtersToolPanelHeaderPanel.setExpandState(event.state);\r\n                    newParams.onStateUpdated();\r\n                },\r\n            })\r\n        );\r\n    }\r\n\r\n    // lazy initialise the panel\r\n    public override setVisible(visible: boolean): void {\r\n        super.setDisplayed(visible);\r\n        if (visible && !this.initialised) {\r\n            this.init(this.params);\r\n        }\r\n    }\r\n\r\n    public setFilterLayout(colDefs: (ColDef | ColGroupDef)[]): void {\r\n        this.filtersToolPanelListPanel.setFiltersLayout(colDefs);\r\n    }\r\n\r\n    public expandFilterGroups(groupIds?: string[]): void {\r\n        this.filtersToolPanelListPanel.expandFilterGroups(true, groupIds);\r\n    }\r\n\r\n    public collapseFilterGroups(groupIds?: string[]): void {\r\n        this.filtersToolPanelListPanel.expandFilterGroups(false, groupIds);\r\n    }\r\n\r\n    public expandFilters(colIds?: string[]): void {\r\n        this.filtersToolPanelListPanel.expandFilters(true, colIds);\r\n    }\r\n\r\n    public collapseFilters(colIds?: string[]): void {\r\n        this.filtersToolPanelListPanel.expandFilters(false, colIds);\r\n    }\r\n\r\n    public syncLayoutWithGrid(): void {\r\n        this.filtersToolPanelListPanel.syncFilterLayout();\r\n    }\r\n\r\n    public refresh(params: ToolPanelFiltersCompParams): boolean {\r\n        this.init(params);\r\n        return true;\r\n    }\r\n\r\n    public getState(): FiltersToolPanelState {\r\n        return this.filtersToolPanelListPanel.getExpandedFiltersAndGroups();\r\n    }\r\n}\r\n", "import type { AgColumn, AgEvent, AgInputTextField, ComponentSelector } from 'ag-grid-community';\r\nimport {\r\n    AgInputTextFieldSelector,\r\n    Component,\r\n    RefPlaceholder,\r\n    _createIconNoSpan,\r\n    _debounce,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport type { ToolPanelFiltersCompParams } from './filtersToolPanel';\r\n\r\nexport enum EXPAND_STATE {\r\n    EXPANDED,\r\n    COLLAPSED,\r\n    INDETERMINATE,\r\n}\r\nexport type AgFiltersToolPanelHeaderEvent = 'collapseAll' | 'expandAll' | 'searchChanged';\r\nexport class AgFiltersToolPanelHeader extends Component<AgFiltersToolPanelHeaderEvent> {\r\n    private readonly eExpand: Element = RefPlaceholder;\r\n    private readonly eFilterTextField: AgInputTextField = RefPlaceholder;\r\n\r\n    private eExpandChecked: Element;\r\n    private eExpandUnchecked: Element;\r\n    private eExpandIndeterminate: Element;\r\n\r\n    private onSearchTextChangedDebounced: () => void;\r\n\r\n    private currentExpandState: EXPAND_STATE;\r\n\r\n    private params: ToolPanelFiltersCompParams;\r\n\r\n    public postConstruct(): void {\r\n        this.setTemplate(\r\n            /* html */\r\n            `<div class=\"ag-filter-toolpanel-search\" role=\"presentation\">\r\n                <div data-ref=\"eExpand\" class=\"ag-filter-toolpanel-expand\"></div>\r\n                <ag-input-text-field data-ref=\"eFilterTextField\" class=\"ag-filter-toolpanel-search-input\"></ag-input-text-field>\r\n            </div>`,\r\n            [AgInputTextFieldSelector]\r\n        );\r\n\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        this.eFilterTextField\r\n            .setAutoComplete(false)\r\n            .setInputAriaLabel(translate('ariaFilterColumnsInput', 'Filter Columns Input'))\r\n            .onValueChange(this.onSearchTextChanged.bind(this));\r\n\r\n        this.createExpandIcons();\r\n        this.setExpandState(EXPAND_STATE.EXPANDED);\r\n        this.addManagedElementListeners(this.eExpand, { click: this.onExpandClicked.bind(this) });\r\n        this.addManagedEventListeners({ newColumnsLoaded: this.showOrHideOptions.bind(this) });\r\n    }\r\n\r\n    public init(params: ToolPanelFiltersCompParams): void {\r\n        this.params = params;\r\n\r\n        if (this.beans.colModel.ready) {\r\n            this.showOrHideOptions();\r\n        }\r\n    }\r\n\r\n    private createExpandIcons() {\r\n        const { eExpand, beans } = this;\r\n        eExpand.appendChild((this.eExpandChecked = _createIconNoSpan('accordionOpen', beans)!));\r\n        eExpand.appendChild((this.eExpandUnchecked = _createIconNoSpan('accordionClosed', beans)!));\r\n        eExpand.appendChild((this.eExpandIndeterminate = _createIconNoSpan('accordionIndeterminate', beans)!));\r\n    }\r\n\r\n    // we only show expand / collapse if we are showing filters\r\n    private showOrHideOptions(): void {\r\n        const { params, eFilterTextField } = this;\r\n        const showFilterSearch = !params.suppressFilterSearch;\r\n        const showExpand = !params.suppressExpandAll;\r\n        const translate = this.getLocaleTextFunc();\r\n\r\n        eFilterTextField.setInputPlaceholder(translate('searchOoo', 'Search...'));\r\n\r\n        const isFilterGroupPresent = (col: AgColumn) => col.getOriginalParent() && col.isFilterAllowed();\r\n        const filterGroupsPresent = this.beans.colModel.getCols().some(isFilterGroupPresent);\r\n\r\n        _setDisplayed(eFilterTextField.getGui(), showFilterSearch);\r\n        _setDisplayed(this.eExpand, showExpand && filterGroupsPresent);\r\n    }\r\n\r\n    private onSearchTextChanged(): void {\r\n        if (!this.onSearchTextChangedDebounced) {\r\n            this.onSearchTextChangedDebounced = _debounce(\r\n                this,\r\n                () => this.dispatchLocalEvent({ type: 'searchChanged', searchText: this.eFilterTextField.getValue() }),\r\n                300\r\n            );\r\n        }\r\n\r\n        this.onSearchTextChangedDebounced();\r\n    }\r\n\r\n    private onExpandClicked(): void {\r\n        const event: AgEvent<AgFiltersToolPanelHeaderEvent> =\r\n            this.currentExpandState === EXPAND_STATE.EXPANDED ? { type: 'collapseAll' } : { type: 'expandAll' };\r\n        this.dispatchLocalEvent(event);\r\n    }\r\n\r\n    public setExpandState(state: EXPAND_STATE): void {\r\n        this.currentExpandState = state;\r\n\r\n        _setDisplayed(this.eExpandChecked, state === EXPAND_STATE.EXPANDED);\r\n        _setDisplayed(this.eExpandUnchecked, state === EXPAND_STATE.COLLAPSED);\r\n        _setDisplayed(this.eExpandIndeterminate, state === EXPAND_STATE.INDETERMINATE);\r\n    }\r\n}\r\n\r\nexport const AgFiltersToolPanelHeaderSelector: ComponentSelector = {\r\n    selector: 'AG-FILTERS-TOOL-PANEL-HEADER',\r\n    component: AgFiltersToolPanelHeader,\r\n};\r\n", "import type {\r\n    AbstractColDef,\r\n    AgColumn,\r\n    AgProvidedColumnGroup,\r\n    BeanCollection,\r\n    ColumnModel,\r\n    ComponentSelector,\r\n    FiltersToolPanelState,\r\n} from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    _clearElement,\r\n    _exists,\r\n    _getActiveDomElement,\r\n    _mergeDeep,\r\n    _setAriaLabel,\r\n    _warn,\r\n    isProvidedColumnGroup,\r\n} from 'ag-grid-community';\r\n\r\nimport { syncLayoutWithGrid, toolPanelCreateColumnTree } from '../sideBar/common/toolPanelColDefService';\r\nimport { EXPAND_STATE } from './agFiltersToolPanelHeader';\r\nimport type { ToolPanelFiltersCompParams } from './filtersToolPanel';\r\nimport { ToolPanelFilterComp } from './toolPanelFilterComp';\r\nimport type { ToolPanelFilterItem } from './toolPanelFilterGroupComp';\r\nimport { ToolPanelFilterGroupComp } from './toolPanelFilterGroupComp';\r\n\r\nexport type AgFiltersToolPanelListEvent = 'filterExpanded' | 'groupExpanded';\r\nexport class AgFiltersToolPanelList extends Component<AgFiltersToolPanelListEvent> {\r\n    private colModel: ColumnModel;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n    }\r\n\r\n    private initialised = false;\r\n    private hasLoadedInitialState = false;\r\n    private isInitialState = false;\r\n\r\n    private params: ToolPanelFiltersCompParams;\r\n    private filterGroupComps: ToolPanelFilterGroupComp[] = [];\r\n\r\n    // null is used to check if we should search filters when new cols are loaded\r\n    private searchFilterText: string | null;\r\n\r\n    // If a column drag is happening, we suppress handling the event until it has completed\r\n    private suppressOnColumnsChanged: boolean = false;\r\n    private onColumnsChangedPending: boolean = false;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-filter-list-panel\"></div>`);\r\n    }\r\n\r\n    public init(params: ToolPanelFiltersCompParams): void {\r\n        this.initialised = true;\r\n\r\n        const defaultParams: Partial<ToolPanelFiltersCompParams> = this.gos.addGridCommonParams({\r\n            suppressExpandAll: false,\r\n            suppressFilterSearch: false,\r\n            suppressSyncLayoutWithGrid: false,\r\n        });\r\n        _mergeDeep(defaultParams, params);\r\n        this.params = defaultParams as ToolPanelFiltersCompParams;\r\n\r\n        if (!defaultParams.suppressSyncLayoutWithGrid) {\r\n            this.addManagedEventListeners({ columnMoved: () => this.onColumnsChanged() });\r\n        }\r\n\r\n        this.addManagedEventListeners({\r\n            newColumnsLoaded: () => this.onColumnsChanged(),\r\n            toolPanelVisibleChanged: (event) => {\r\n                // when re-entering the filters tool panel we need to refresh the virtual lists in the set filters in case\r\n                // filters have been changed elsewhere, i.e. via an api call.\r\n                if (event.key === 'filters') {\r\n                    this.refreshFilters(event.visible);\r\n                }\r\n            },\r\n            dragStarted: () => {\r\n                this.suppressOnColumnsChanged = true;\r\n            },\r\n            dragStopped: () => {\r\n                this.suppressOnColumnsChanged = false;\r\n                if (this.onColumnsChangedPending) {\r\n                    this.onColumnsChangedPending = false;\r\n                    this.onColumnsChanged();\r\n                }\r\n            },\r\n        });\r\n\r\n        if (this.colModel.ready) {\r\n            this.onColumnsChanged();\r\n        }\r\n    }\r\n\r\n    public onColumnsChanged(): void {\r\n        if (this.suppressOnColumnsChanged) {\r\n            this.onColumnsChangedPending = true;\r\n            return;\r\n        }\r\n        const pivotModeActive = this.colModel.isPivotMode();\r\n        const shouldSyncColumnLayoutWithGrid = !this.params.suppressSyncLayoutWithGrid && !pivotModeActive;\r\n        shouldSyncColumnLayoutWithGrid ? this.syncFilterLayout() : this.buildTreeFromProvidedColumnDefs();\r\n        this.refreshAriaLabel();\r\n    }\r\n\r\n    public syncFilterLayout(): void {\r\n        syncLayoutWithGrid(this.colModel, this.setFiltersLayout.bind(this));\r\n        this.refreshAriaLabel();\r\n    }\r\n\r\n    private buildTreeFromProvidedColumnDefs(): void {\r\n        const columnTree = this.colModel.getColDefColTree();\r\n        this.recreateFilters(columnTree);\r\n    }\r\n\r\n    public setFiltersLayout(colDefs: AbstractColDef[]): void {\r\n        const columnTree = toolPanelCreateColumnTree(this.colModel, colDefs);\r\n        this.recreateFilters(columnTree);\r\n    }\r\n\r\n    private recreateFilters(columnTree: (AgColumn | AgProvidedColumnGroup)[]): void {\r\n        // Underlying filter comp/element won't get recreated if the column still exists (the element just gets detached/re-attached).\r\n        // We can therefore restore focus if an element in the filter tool panel was focused.\r\n        const activeElement = _getActiveDomElement(this.beans) as HTMLElement;\r\n\r\n        if (!this.hasLoadedInitialState) {\r\n            this.hasLoadedInitialState = true;\r\n            this.isInitialState = !!this.params.initialState;\r\n        }\r\n\r\n        // Want to restore the expansion state where possible.\r\n        const expansionState = this.getExpansionState();\r\n\r\n        this.destroyFilters();\r\n\r\n        const filterGroupComps = this.recursivelyAddComps(columnTree, 0, expansionState) as ToolPanelFilterGroupComp[];\r\n        this.filterGroupComps = filterGroupComps;\r\n\r\n        const len = filterGroupComps.length;\r\n\r\n        if (len) {\r\n            // skip the destroy function because this will be managed\r\n            // by the `destroyFilters` function\r\n            filterGroupComps.forEach((comp) => this.appendChild(comp));\r\n            this.setFirstAndLastVisible(0, len - 1);\r\n        }\r\n\r\n        const searchFilterText = this.searchFilterText;\r\n        // perform search if searchFilterText exists\r\n        if (_exists(searchFilterText)) {\r\n            this.searchFilters(searchFilterText);\r\n        }\r\n\r\n        // notify header of expand\r\n        this.fireExpandedEvent();\r\n\r\n        // We only care about restoring focus if the originally focused element was in the filter tool panel.\r\n        if (this.getGui().contains(activeElement)) {\r\n            activeElement.focus();\r\n        }\r\n\r\n        this.isInitialState = false;\r\n        this.refreshAriaLabel();\r\n    }\r\n\r\n    private recursivelyAddComps(\r\n        tree: (AgColumn | AgProvidedColumnGroup)[],\r\n        depth: number,\r\n        expansionState: Map<string, boolean>\r\n    ): (ToolPanelFilterGroupComp | ToolPanelFilterComp)[] {\r\n        return tree\r\n            .map((child) => {\r\n                if (isProvidedColumnGroup(child)) {\r\n                    return this.recursivelyAddFilterGroupComps(child, depth, expansionState)?.flatMap((a) => a) ?? [];\r\n                }\r\n\r\n                const column = child;\r\n\r\n                if (!this.shouldDisplayFilter(column)) {\r\n                    return [];\r\n                }\r\n\r\n                const hideFilterCompHeader = depth === 0;\r\n                const filterComp = new ToolPanelFilterComp(hideFilterCompHeader, () => this.onFilterExpanded());\r\n                this.createBean(filterComp);\r\n\r\n                filterComp.setColumn(column);\r\n                if (expansionState.get(column.getId())) {\r\n                    // Default state on creation and desired state are both collapsed. Expand if expanded before.\r\n                    filterComp.expand();\r\n                }\r\n\r\n                if (depth > 0) {\r\n                    return filterComp;\r\n                }\r\n\r\n                const filterGroupComp = this.createBean(\r\n                    new ToolPanelFilterGroupComp(column, [filterComp], this.onGroupExpanded.bind(this), depth, true)\r\n                );\r\n                filterGroupComp.addCssClassToTitleBar('ag-filter-toolpanel-header');\r\n                if (!expansionState.get(filterGroupComp.getFilterGroupId())) {\r\n                    // Default state on creation is expanded. Desired initial state is collapsed. Always collapse unless expanded before.\r\n                    filterGroupComp.collapse();\r\n                }\r\n                return filterGroupComp;\r\n            })\r\n            .flatMap((a) => a);\r\n    }\r\n\r\n    private refreshAriaLabel(): void {\r\n        const translate = this.getLocaleTextFunc();\r\n        const filterListName = translate('ariaFilterPanelList', 'Filter List');\r\n        const localeFilters = translate('filters', 'Filters');\r\n\r\n        const eGui = this.getGui();\r\n        const groupSelector = '.ag-filter-toolpanel-group-wrapper';\r\n        const itemSelector = '.ag-filter-toolpanel-group-item';\r\n        const hiddenSelector = '.ag-hidden';\r\n        const visibleItems = eGui.querySelectorAll(`${itemSelector}:not(${groupSelector}, ${hiddenSelector})`);\r\n\r\n        const totalVisibleItems = visibleItems.length;\r\n\r\n        _setAriaLabel(this.getAriaElement(), `${filterListName} ${totalVisibleItems} ${localeFilters}`);\r\n    }\r\n\r\n    private recursivelyAddFilterGroupComps(\r\n        columnGroup: AgProvidedColumnGroup,\r\n        depth: number,\r\n        expansionState: Map<string, boolean>\r\n    ): (ToolPanelFilterGroupComp | ToolPanelFilterComp)[] | undefined {\r\n        if (!this.filtersExistInChildren(columnGroup.getChildren())) {\r\n            return;\r\n        }\r\n\r\n        const colGroupDef = columnGroup.getColGroupDef();\r\n        if (colGroupDef && colGroupDef.suppressFiltersToolPanel) {\r\n            return [];\r\n        }\r\n\r\n        const newDepth = columnGroup.isPadding() ? depth : depth + 1;\r\n        const childFilterComps = this.recursivelyAddComps(columnGroup.getChildren(), newDepth, expansionState).flatMap(\r\n            (a) => a\r\n        );\r\n\r\n        if (columnGroup.isPadding()) {\r\n            return childFilterComps;\r\n        }\r\n\r\n        const filterGroupComp = new ToolPanelFilterGroupComp(\r\n            columnGroup,\r\n            childFilterComps,\r\n            this.onGroupExpanded.bind(this),\r\n            depth,\r\n            false\r\n        );\r\n\r\n        this.createBean(filterGroupComp);\r\n        filterGroupComp.addCssClassToTitleBar('ag-filter-toolpanel-header');\r\n        const expansionStateValue = expansionState.get(filterGroupComp.getFilterGroupId());\r\n        if ((this.isInitialState && !expansionStateValue) || expansionStateValue === false) {\r\n            // Default state on creation is expanded. Desired initial state is expanded. Only collapse if collapsed before or using initial state.\r\n            filterGroupComp.collapse();\r\n        }\r\n        return [filterGroupComp];\r\n    }\r\n\r\n    private filtersExistInChildren(tree: (AgColumn | AgProvidedColumnGroup)[]): boolean {\r\n        return tree.some((child) => {\r\n            if (isProvidedColumnGroup(child)) {\r\n                return this.filtersExistInChildren(child.getChildren());\r\n            }\r\n\r\n            return this.shouldDisplayFilter(child);\r\n        });\r\n    }\r\n\r\n    private shouldDisplayFilter(column: AgColumn) {\r\n        const suppressFiltersToolPanel = column.getColDef() && column.getColDef().suppressFiltersToolPanel;\r\n        return column.isFilterAllowed() && !suppressFiltersToolPanel;\r\n    }\r\n\r\n    private getExpansionState(): Map<string, boolean> {\r\n        const expansionState: Map<string, boolean> = new Map();\r\n\r\n        if (this.isInitialState) {\r\n            const { expandedColIds, expandedGroupIds } = this.params.initialState as FiltersToolPanelState;\r\n            expandedColIds.forEach((id) => expansionState.set(id, true));\r\n            expandedGroupIds.forEach((id) => expansionState.set(id, true));\r\n            return expansionState;\r\n        }\r\n\r\n        const recursiveGetExpansionState = (filterGroupComp: ToolPanelFilterGroupComp) => {\r\n            expansionState.set(filterGroupComp.getFilterGroupId(), filterGroupComp.isExpanded());\r\n            filterGroupComp.getChildren().forEach((child) => {\r\n                if (child instanceof ToolPanelFilterGroupComp) {\r\n                    recursiveGetExpansionState(child);\r\n                } else {\r\n                    expansionState.set(child.getColumn().getId(), child.isExpanded());\r\n                }\r\n            });\r\n        };\r\n\r\n        this.filterGroupComps.forEach(recursiveGetExpansionState);\r\n\r\n        return expansionState;\r\n    }\r\n\r\n    // we don't support refreshing, but must implement because it's on the tool panel interface\r\n    public refresh(): void {}\r\n\r\n    // lazy initialise the panel\r\n    public override setVisible(visible: boolean): void {\r\n        super.setDisplayed(visible);\r\n        if (visible && !this.initialised) {\r\n            this.init(this.params);\r\n        }\r\n    }\r\n\r\n    public expandFilterGroups(expand: boolean, groupIds?: string[]): void {\r\n        const updatedGroupIds: string[] = [];\r\n\r\n        const updateGroupExpandState = (filterGroup: ToolPanelFilterGroupComp) => {\r\n            const groupId = filterGroup.getFilterGroupId();\r\n            const shouldExpandOrCollapse = !groupIds || groupIds.includes(groupId);\r\n            if (shouldExpandOrCollapse) {\r\n                // don't expand 'column groups', i.e. top level columns wrapped in a group\r\n                if (expand && filterGroup.isColumnGroup()) {\r\n                    filterGroup.expand();\r\n                } else {\r\n                    filterGroup.collapse();\r\n                }\r\n                updatedGroupIds.push(groupId);\r\n            }\r\n\r\n            // recursively look for more groups to expand / collapse\r\n            filterGroup.getChildren().forEach((child) => {\r\n                if (child instanceof ToolPanelFilterGroupComp) {\r\n                    updateGroupExpandState(child);\r\n                }\r\n            });\r\n        };\r\n\r\n        this.filterGroupComps.forEach(updateGroupExpandState);\r\n\r\n        // update header expand / collapse icon\r\n        this.onGroupExpanded();\r\n\r\n        if (groupIds) {\r\n            const unrecognisedGroupIds = groupIds.filter((groupId) => updatedGroupIds.indexOf(groupId) < 0);\r\n            if (unrecognisedGroupIds.length > 0) {\r\n                _warn(166, { unrecognisedGroupIds });\r\n            }\r\n        }\r\n    }\r\n\r\n    public expandFilters(expand: boolean, colIds?: string[]): void {\r\n        const updatedColIds: string[] = [];\r\n\r\n        const updateGroupExpandState = (filterComp: ToolPanelFilterGroupComp | ToolPanelFilterComp): boolean => {\r\n            if (filterComp instanceof ToolPanelFilterGroupComp) {\r\n                let anyChildrenChanged = false;\r\n                filterComp.getChildren().forEach((child) => {\r\n                    const childUpdated = updateGroupExpandState(child);\r\n                    if (childUpdated) {\r\n                        if (expand) {\r\n                            filterComp.expand();\r\n                            anyChildrenChanged = true;\r\n                        } else if (!filterComp.isColumnGroup()) {\r\n                            // we only collapse columns wrapped in groups\r\n                            filterComp.collapse();\r\n                        }\r\n                    }\r\n                });\r\n                return anyChildrenChanged;\r\n            }\r\n\r\n            const colId = filterComp.getColumn().getColId();\r\n            const updateFilterExpandState = !colIds || colIds.includes(colId);\r\n\r\n            if (updateFilterExpandState) {\r\n                expand ? filterComp.expand() : filterComp.collapse();\r\n                updatedColIds.push(colId);\r\n            }\r\n\r\n            return updateFilterExpandState;\r\n        };\r\n\r\n        this.filterGroupComps.forEach(updateGroupExpandState);\r\n\r\n        // update header expand / collapse icon\r\n        this.onGroupExpanded();\r\n\r\n        if (colIds) {\r\n            const unrecognisedColIds = colIds.filter((colId) => updatedColIds.indexOf(colId) < 0);\r\n            if (unrecognisedColIds.length > 0) {\r\n                _warn(167, { unrecognisedColIds });\r\n            }\r\n        }\r\n    }\r\n\r\n    private onGroupExpanded(): void {\r\n        this.fireExpandedEvent();\r\n    }\r\n\r\n    private onFilterExpanded(): void {\r\n        this.dispatchLocalEvent({ type: 'filterExpanded' });\r\n    }\r\n\r\n    private fireExpandedEvent(): void {\r\n        let expandedCount = 0;\r\n        let notExpandedCount = 0;\r\n\r\n        const updateExpandCounts = (filterGroup: ToolPanelFilterGroupComp) => {\r\n            if (!filterGroup.isColumnGroup()) {\r\n                return;\r\n            }\r\n\r\n            filterGroup.isExpanded() ? expandedCount++ : notExpandedCount++;\r\n\r\n            filterGroup.getChildren().forEach((child) => {\r\n                if (child instanceof ToolPanelFilterGroupComp) {\r\n                    updateExpandCounts(child);\r\n                }\r\n            });\r\n        };\r\n\r\n        this.filterGroupComps.forEach(updateExpandCounts);\r\n\r\n        let state: EXPAND_STATE;\r\n        if (expandedCount > 0 && notExpandedCount > 0) {\r\n            state = EXPAND_STATE.INDETERMINATE;\r\n        } else if (notExpandedCount > 0) {\r\n            state = EXPAND_STATE.COLLAPSED;\r\n        } else {\r\n            state = EXPAND_STATE.EXPANDED;\r\n        }\r\n\r\n        this.dispatchLocalEvent({ type: 'groupExpanded', state: state });\r\n    }\r\n\r\n    public performFilterSearch(searchText: string) {\r\n        this.searchFilterText = _exists(searchText) ? searchText.toLowerCase() : null;\r\n        this.searchFilters(this.searchFilterText);\r\n    }\r\n\r\n    private searchFilters(searchFilter: string | null) {\r\n        const passesFilter = (groupName: string) => {\r\n            return !_exists(searchFilter) || groupName.toLowerCase().indexOf(searchFilter) !== -1;\r\n        };\r\n\r\n        const recursivelySearch = (filterItem: ToolPanelFilterItem, parentPasses: boolean): boolean => {\r\n            if (!(filterItem instanceof ToolPanelFilterGroupComp)) {\r\n                return passesFilter(filterItem.getColumnFilterName() || '');\r\n            }\r\n\r\n            const children = filterItem.getChildren();\r\n            const groupNamePasses = passesFilter(filterItem.getFilterGroupName());\r\n\r\n            // if group or parent already passed - ensure this group and all children are visible\r\n            const alreadyPassed = parentPasses || groupNamePasses;\r\n            if (alreadyPassed) {\r\n                // ensure group visible\r\n                filterItem.hideGroup(false);\r\n\r\n                // ensure all children are visible\r\n                for (let i = 0; i < children.length; i++) {\r\n                    recursivelySearch(children[i], alreadyPassed);\r\n                    filterItem.hideGroupItem(false, i);\r\n                }\r\n                return true;\r\n            }\r\n\r\n            // hide group item filters\r\n            let anyChildPasses = false;\r\n            children.forEach((child: ToolPanelFilterItem, index: number) => {\r\n                const childPasses = recursivelySearch(child, parentPasses);\r\n                filterItem.hideGroupItem(!childPasses, index);\r\n                if (childPasses) {\r\n                    anyChildPasses = true;\r\n                }\r\n            });\r\n\r\n            // hide group if no children pass\r\n            filterItem.hideGroup(!anyChildPasses);\r\n\r\n            return anyChildPasses;\r\n        };\r\n\r\n        let firstVisible: number | undefined;\r\n        let lastVisible: number | undefined;\r\n\r\n        this.filterGroupComps.forEach((filterGroup, idx) => {\r\n            recursivelySearch(filterGroup, false);\r\n\r\n            if (firstVisible === undefined) {\r\n                if (!filterGroup.containsCssClass('ag-hidden')) {\r\n                    firstVisible = idx;\r\n                    lastVisible = idx;\r\n                }\r\n            } else if (!filterGroup.containsCssClass('ag-hidden') && lastVisible !== idx) {\r\n                lastVisible = idx;\r\n            }\r\n        });\r\n\r\n        this.setFirstAndLastVisible(firstVisible, lastVisible);\r\n        this.refreshAriaLabel();\r\n    }\r\n\r\n    private setFirstAndLastVisible(firstIdx?: number, lastIdx?: number) {\r\n        this.filterGroupComps.forEach((filterGroup, idx) => {\r\n            filterGroup.removeCssClass('ag-first-group-visible');\r\n            filterGroup.removeCssClass('ag-last-group-visible');\r\n\r\n            if (idx === firstIdx) {\r\n                filterGroup.addCssClass('ag-first-group-visible');\r\n            }\r\n            if (idx === lastIdx) {\r\n                filterGroup.addCssClass('ag-last-group-visible');\r\n            }\r\n        });\r\n    }\r\n\r\n    private refreshFilters(isDisplayed: boolean) {\r\n        this.filterGroupComps.forEach((filterGroupComp) => filterGroupComp.refreshFilters(isDisplayed));\r\n    }\r\n\r\n    public getExpandedFiltersAndGroups(): { expandedGroupIds: string[]; expandedColIds: string[] } {\r\n        const expandedGroupIds: string[] = [];\r\n        const expandedColIds: Set<string> = new Set();\r\n\r\n        const getExpandedFiltersAndGroups = (filterComp: ToolPanelFilterGroupComp | ToolPanelFilterComp) => {\r\n            if (filterComp instanceof ToolPanelFilterGroupComp) {\r\n                filterComp.getChildren().forEach((child) => getExpandedFiltersAndGroups(child));\r\n                const groupId = filterComp.getFilterGroupId();\r\n                if (filterComp.isExpanded() && !expandedColIds.has(groupId)) {\r\n                    expandedGroupIds.push(groupId);\r\n                }\r\n            } else {\r\n                if (filterComp.isExpanded()) {\r\n                    expandedColIds.add(filterComp.getColumn().getColId());\r\n                }\r\n            }\r\n        };\r\n\r\n        this.filterGroupComps.forEach(getExpandedFiltersAndGroups);\r\n\r\n        return { expandedGroupIds, expandedColIds: Array.from(expandedColIds) };\r\n    }\r\n\r\n    private destroyFilters() {\r\n        this.filterGroupComps = this.destroyBeans(this.filterGroupComps);\r\n        _clearElement(this.getGui());\r\n    }\r\n\r\n    public override destroy() {\r\n        this.destroyFilters();\r\n        super.destroy();\r\n    }\r\n}\r\n\r\nexport const AgFiltersToolPanelListSelector: ComponentSelector = {\r\n    selector: 'AG-FILTERS-TOOL-PANEL-LIST',\r\n    component: AgFiltersToolPanelList,\r\n};\r\n", "import type { AgColumn, FilterOpenedEvent, IFilterComp, IconName } from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    FilterWrapperComp,\r\n    KeyCode,\r\n    RefPlaceholder,\r\n    _clearElement,\r\n    _createIconNoSpan,\r\n    _loadTemplate,\r\n    _setAriaExpanded,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nexport type ToolPanelFilterCompEvent = 'filterChanged';\r\nexport class ToolPanelFilterComp extends Component<ToolPanelFilterCompEvent> {\r\n    private readonly eFilterToolPanelHeader: HTMLElement = RefPlaceholder;\r\n    private readonly eFilterName: HTMLElement = RefPlaceholder;\r\n    private readonly agFilterToolPanelBody: HTMLElement = RefPlaceholder;\r\n    private readonly eFilterIcon: Element = RefPlaceholder;\r\n    private readonly eExpand: Element = RefPlaceholder;\r\n\r\n    private eExpandChecked: Element;\r\n    private eExpandUnchecked: Element;\r\n    private column: AgColumn;\r\n    private expanded: boolean = false;\r\n    private underlyingFilter: IFilterComp | null;\r\n    private filterWrapperComp?: FilterWrapperComp;\r\n\r\n    constructor(\r\n        private hideHeader: boolean,\r\n        private readonly expandedCallback: () => void\r\n    ) {\r\n        super(/* html */ `\r\n            <div class=\"ag-filter-toolpanel-instance\">\r\n                <div class=\"ag-filter-toolpanel-header ag-filter-toolpanel-instance-header\" data-ref=\"eFilterToolPanelHeader\" role=\"button\" aria-expanded=\"false\">\r\n                    <div data-ref=\"eExpand\" class=\"ag-filter-toolpanel-expand\"></div>\r\n                    <span data-ref=\"eFilterName\" class=\"ag-header-cell-text\"></span>\r\n                    <span data-ref=\"eFilterIcon\" class=\"ag-header-icon ag-filter-icon ag-filter-toolpanel-instance-header-icon\" aria-hidden=\"true\"></span>\r\n                </div>\r\n                <div class=\"ag-filter-toolpanel-instance-body ag-filter\" data-ref=\"agFilterToolPanelBody\"></div>\r\n            </div>`);\r\n    }\r\n\r\n    public postConstruct() {\r\n        const { beans, eExpand } = this;\r\n        const eExpandChecked = _createIconNoSpan('accordionOpen', beans)!;\r\n        this.eExpandChecked = eExpandChecked;\r\n        const eExpandUnchecked = _createIconNoSpan('accordionClosed', beans)!;\r\n        this.eExpandUnchecked = eExpandUnchecked;\r\n        eExpand.appendChild(eExpandChecked);\r\n        eExpand.appendChild(eExpandUnchecked);\r\n    }\r\n\r\n    public setColumn(column: AgColumn): void {\r\n        this.column = column;\r\n        const { beans, eFilterToolPanelHeader, eFilterIcon, eExpandChecked, hideHeader } = this;\r\n        this.eFilterName.innerText = beans.colNames.getDisplayNameForColumn(column, 'filterToolPanel', false) || '';\r\n        this.addManagedListeners(eFilterToolPanelHeader, {\r\n            click: this.toggleExpanded.bind(this),\r\n            keydown: this.onKeyDown.bind(this),\r\n        });\r\n        this.addManagedEventListeners({ filterOpened: this.onFilterOpened.bind(this) });\r\n        this.addInIcon('filterActive', eFilterIcon, column);\r\n\r\n        _setDisplayed(eFilterIcon, this.isFilterActive(), { skipAriaHidden: true });\r\n        _setDisplayed(eExpandChecked, false);\r\n\r\n        if (hideHeader) {\r\n            _setDisplayed(eFilterToolPanelHeader, false);\r\n            eFilterToolPanelHeader.removeAttribute('tabindex');\r\n        } else {\r\n            eFilterToolPanelHeader.setAttribute('tabindex', '0');\r\n        }\r\n\r\n        this.addManagedListeners(column, { filterChanged: this.onFilterChanged.bind(this) });\r\n    }\r\n\r\n    private onKeyDown(e: KeyboardEvent): void {\r\n        const { key } = e;\r\n        const { ENTER, SPACE, LEFT, RIGHT } = KeyCode;\r\n\r\n        if (key !== ENTER && key !== SPACE && key !== LEFT && key !== RIGHT) {\r\n            return;\r\n        }\r\n\r\n        e.preventDefault();\r\n\r\n        if (key === ENTER || key === SPACE) {\r\n            this.toggleExpanded();\r\n        } else if (key === KeyCode.LEFT) {\r\n            this.collapse();\r\n        } else {\r\n            this.expand();\r\n        }\r\n    }\r\n\r\n    public getColumn(): AgColumn {\r\n        return this.column;\r\n    }\r\n\r\n    public getColumnFilterName(): string | null {\r\n        return this.beans.colNames.getDisplayNameForColumn(this.column, 'filterToolPanel', false);\r\n    }\r\n\r\n    public addCssClassToTitleBar(cssClass: string) {\r\n        this.eFilterToolPanelHeader.classList.add(cssClass);\r\n    }\r\n\r\n    private addInIcon(iconName: IconName, eParent: Element, column: AgColumn): void {\r\n        if (eParent == null) {\r\n            return;\r\n        }\r\n\r\n        const eIcon = _createIconNoSpan(iconName, this.beans, column)!;\r\n        eParent.appendChild(eIcon);\r\n    }\r\n\r\n    public isFilterActive(): boolean {\r\n        return !!this.beans.filterManager?.isFilterActive(this.column);\r\n    }\r\n\r\n    private onFilterChanged(): void {\r\n        _setDisplayed(this.eFilterIcon, this.isFilterActive(), { skipAriaHidden: true });\r\n        this.dispatchLocalEvent({ type: 'filterChanged' });\r\n    }\r\n\r\n    public toggleExpanded(): void {\r\n        this.expanded ? this.collapse() : this.expand();\r\n    }\r\n\r\n    public expand(): void {\r\n        if (this.expanded) {\r\n            return;\r\n        }\r\n\r\n        this.expanded = true;\r\n        _setAriaExpanded(this.eFilterToolPanelHeader, true);\r\n\r\n        _setDisplayed(this.eExpandChecked, true);\r\n        _setDisplayed(this.eExpandUnchecked, false);\r\n\r\n        this.addFilterElement();\r\n\r\n        this.expandedCallback();\r\n    }\r\n\r\n    private addFilterElement(suppressFocus?: boolean): void {\r\n        const filterPanelWrapper = _loadTemplate(/* html */ `<div class=\"ag-filter-toolpanel-instance-filter\"></div>`);\r\n        const comp = this.createManagedBean(new FilterWrapperComp(this.column, 'TOOLBAR'));\r\n        this.filterWrapperComp = comp;\r\n\r\n        if (!comp.hasFilter()) {\r\n            return;\r\n        }\r\n\r\n        comp.getFilter()?.then((filter) => {\r\n            this.underlyingFilter = filter;\r\n\r\n            if (!filter) {\r\n                return;\r\n            }\r\n            filterPanelWrapper.appendChild(comp.getGui());\r\n\r\n            this.agFilterToolPanelBody.appendChild(filterPanelWrapper);\r\n\r\n            comp.afterGuiAttached({ container: 'toolPanel', suppressFocus });\r\n        });\r\n    }\r\n\r\n    public collapse(): void {\r\n        if (!this.expanded) {\r\n            return;\r\n        }\r\n\r\n        this.expanded = false;\r\n        _setAriaExpanded(this.eFilterToolPanelHeader, false);\r\n        this.removeFilterElement();\r\n\r\n        _setDisplayed(this.eExpandChecked, false);\r\n        _setDisplayed(this.eExpandUnchecked, true);\r\n\r\n        const filterWrapperComp = this.filterWrapperComp;\r\n        filterWrapperComp?.afterGuiDetached();\r\n        this.destroyBean(filterWrapperComp);\r\n\r\n        this.expandedCallback();\r\n    }\r\n\r\n    private removeFilterElement(): void {\r\n        _clearElement(this.agFilterToolPanelBody);\r\n    }\r\n\r\n    public isExpanded(): boolean {\r\n        return this.expanded;\r\n    }\r\n\r\n    public refreshFilter(isDisplayed: boolean): void {\r\n        if (!this.expanded) {\r\n            return;\r\n        }\r\n\r\n        const filter = this.underlyingFilter as any;\r\n\r\n        if (!filter) {\r\n            return;\r\n        }\r\n\r\n        if (isDisplayed) {\r\n            // set filters should be updated when the filter has been changed elsewhere, i.e. via api. Note that we can't\r\n            // use 'afterGuiAttached' to refresh the virtual list as it also focuses on the mini filter which changes the\r\n            // scroll position in the filter list panel\r\n            if (typeof filter.refreshVirtualList === 'function') {\r\n                filter.refreshVirtualList();\r\n            }\r\n        } else {\r\n            filter.afterGuiDetached?.();\r\n        }\r\n    }\r\n\r\n    private onFilterOpened(event: FilterOpenedEvent): void {\r\n        if (event.source !== 'COLUMN_MENU') {\r\n            return;\r\n        }\r\n        if (event.column !== this.column) {\r\n            return;\r\n        }\r\n        if (!this.expanded) {\r\n            return;\r\n        }\r\n\r\n        this.collapse();\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AgProvidedColumnGroup,\r\n    FilterOpenedEvent,\r\n    ITooltipCtrl,\r\n    IconName,\r\n    TooltipFeature,\r\n} from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    RefPlaceholder,\r\n    _clearElement,\r\n    _createIconNoSpan,\r\n    _getShouldDisplayTooltip,\r\n    isProvidedColumnGroup,\r\n} from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent, AgGroupComponentParams } from '../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../widgets/agGroupComponent';\r\nimport { ToolPanelFilterComp } from './toolPanelFilterComp';\r\n\r\nexport type ToolPanelFilterItem = ToolPanelFilterGroupComp | ToolPanelFilterComp;\r\n\r\nexport class ToolPanelFilterGroupComp extends Component {\r\n    private filterGroupComp: AgGroupComponent = RefPlaceholder;\r\n\r\n    private filterGroupName: string | null;\r\n    private tooltipFeature?: TooltipFeature;\r\n\r\n    constructor(\r\n        private readonly columnGroup: AgColumn | AgProvidedColumnGroup,\r\n        private childFilterComps: (ToolPanelFilterGroupComp | ToolPanelFilterComp)[],\r\n        private readonly expandedCallback: () => void,\r\n        private readonly depth: number,\r\n        private readonly showingColumn: boolean\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const groupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'filter-toolpanel',\r\n            direction: 'vertical',\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div class=\"ag-filter-toolpanel-group-wrapper\">\r\n            <ag-group-component data-ref=\"filterGroupComp\"></ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector],\r\n            { filterGroupComp: groupParams }\r\n        );\r\n\r\n        this.setGroupTitle();\r\n        const { filterGroupComp, depth, childFilterComps, gos } = this;\r\n        filterGroupComp.setAlignItems('stretch');\r\n\r\n        filterGroupComp.addCssClass(`ag-filter-toolpanel-group-level-${depth}`);\r\n        filterGroupComp.getGui().style.setProperty('--ag-indentation-level', String(depth));\r\n        filterGroupComp.addCssClassToTitleBar(`ag-filter-toolpanel-group-level-${depth}-header`);\r\n\r\n        childFilterComps.forEach((filterComp) => {\r\n            filterGroupComp.addItem(filterComp as Component);\r\n            filterComp.addCssClassToTitleBar(`ag-filter-toolpanel-group-level-${depth + 1}-header`);\r\n            filterComp.getGui().style.setProperty('--ag-indentation-level', String(depth + 1));\r\n        });\r\n\r\n        this.tooltipFeature = this.createOptionalManagedBean(\r\n            this.beans.registry.createDynamicBean<TooltipFeature>('tooltipFeature', false, {\r\n                getGui: () => this.getGui(),\r\n                getLocation: () => 'filterToolPanelColumnGroup',\r\n                shouldDisplayTooltip: _getShouldDisplayTooltip(\r\n                    gos,\r\n                    () => filterGroupComp.getGui().querySelector('.ag-group-title') as HTMLElement | undefined\r\n                ),\r\n            } as ITooltipCtrl)\r\n        );\r\n\r\n        this.refreshFilterClass();\r\n        this.addExpandCollapseListeners();\r\n        this.addFilterChangedListeners();\r\n        this.setupTooltip();\r\n        this.addInIcon('filterActive');\r\n    }\r\n\r\n    private setupTooltip(): void {\r\n        // we don't show tooltips for groups, as when the group expands, it's div contains the columns which also\r\n        // have tooltips, so the tooltips would clash. Eg mouse over group, tooltip shows, mouse over column, another\r\n        // tooltip shows but cos we didn't leave the group the group tooltip remains. this should be fixed in the future,\r\n        // maybe the group shouldn't contain the children form a DOM perspective.\r\n        if (!this.showingColumn) {\r\n            return;\r\n        }\r\n\r\n        const refresh = () => {\r\n            this.tooltipFeature?.setTooltipAndRefresh((this.columnGroup as AgColumn).getColDef().headerTooltip);\r\n        };\r\n\r\n        refresh();\r\n\r\n        this.addManagedEventListeners({ newColumnsLoaded: refresh });\r\n    }\r\n\r\n    public addCssClassToTitleBar(cssClass: string) {\r\n        this.filterGroupComp.addCssClassToTitleBar(cssClass);\r\n    }\r\n\r\n    public refreshFilters(isDisplayed: boolean) {\r\n        this.childFilterComps.forEach((filterComp) => {\r\n            if (filterComp instanceof ToolPanelFilterGroupComp) {\r\n                filterComp.refreshFilters(isDisplayed);\r\n            } else {\r\n                filterComp.refreshFilter(isDisplayed);\r\n            }\r\n        });\r\n    }\r\n\r\n    public isColumnGroup(): boolean {\r\n        return isProvidedColumnGroup(this.columnGroup);\r\n    }\r\n\r\n    public isExpanded(): boolean {\r\n        return this.filterGroupComp.isExpanded();\r\n    }\r\n\r\n    public getChildren(): ToolPanelFilterItem[] {\r\n        return this.childFilterComps;\r\n    }\r\n\r\n    public getFilterGroupName(): string {\r\n        return this.filterGroupName ?? '';\r\n    }\r\n\r\n    public getFilterGroupId(): string {\r\n        return this.columnGroup.getId();\r\n    }\r\n\r\n    public hideGroupItem(hide: boolean, index: number) {\r\n        this.filterGroupComp.hideItem(hide, index);\r\n    }\r\n\r\n    public hideGroup(hide: boolean) {\r\n        this.setDisplayed(!hide);\r\n    }\r\n\r\n    private addInIcon(iconName: IconName): void {\r\n        const eIcon = _createIconNoSpan(iconName, this.beans)!;\r\n        if (eIcon) {\r\n            eIcon.classList.add('ag-filter-toolpanel-group-instance-header-icon');\r\n        }\r\n        this.filterGroupComp.addTitleBarWidget(eIcon);\r\n    }\r\n\r\n    private forEachToolPanelFilterChild(action: (filterComp: ToolPanelFilterItem) => void) {\r\n        this.childFilterComps.forEach((filterComp) => {\r\n            if (filterComp instanceof ToolPanelFilterComp) {\r\n                action(filterComp);\r\n            }\r\n        });\r\n    }\r\n\r\n    private addExpandCollapseListeners() {\r\n        const expandListener = this.isColumnGroup()\r\n            ? () => this.expandedCallback()\r\n            : () => this.forEachToolPanelFilterChild((filterComp) => filterComp.expand());\r\n\r\n        const collapseListener = this.isColumnGroup()\r\n            ? () => this.expandedCallback()\r\n            : () => this.forEachToolPanelFilterChild((filterComp) => filterComp.collapse());\r\n\r\n        this.addManagedListeners(this.filterGroupComp, {\r\n            expanded: expandListener,\r\n            collapsed: collapseListener,\r\n        });\r\n    }\r\n\r\n    private getColumns(): AgColumn[] {\r\n        if (isProvidedColumnGroup(this.columnGroup)) {\r\n            return this.columnGroup.getLeafColumns();\r\n        }\r\n\r\n        return [this.columnGroup];\r\n    }\r\n\r\n    private addFilterChangedListeners() {\r\n        this.getColumns().forEach((column) => {\r\n            this.addManagedListeners(column, { filterChanged: () => this.refreshFilterClass() });\r\n        });\r\n\r\n        if (!isProvidedColumnGroup(this.columnGroup)) {\r\n            this.addManagedEventListeners({ filterOpened: this.onFilterOpened.bind(this) });\r\n        }\r\n    }\r\n\r\n    private refreshFilterClass(): void {\r\n        const columns = this.getColumns();\r\n\r\n        const anyChildFiltersActive = () => columns.some((col) => col.isFilterActive());\r\n        this.filterGroupComp.addOrRemoveCssClass('ag-has-filter', anyChildFiltersActive());\r\n    }\r\n\r\n    private onFilterOpened(event: FilterOpenedEvent): void {\r\n        // when a filter is opened elsewhere, i.e. column menu we close the filter comp so we also need to collapse\r\n        // the column group. This approach means we don't need to try and sync filter models on the same column.\r\n\r\n        if (event.source !== 'COLUMN_MENU') {\r\n            return;\r\n        }\r\n        if (event.column !== this.columnGroup) {\r\n            return;\r\n        }\r\n        if (!this.isExpanded()) {\r\n            return;\r\n        }\r\n\r\n        this.collapse();\r\n    }\r\n\r\n    public expand() {\r\n        this.filterGroupComp.toggleGroupExpand(true);\r\n    }\r\n\r\n    public collapse() {\r\n        this.filterGroupComp.toggleGroupExpand(false);\r\n    }\r\n\r\n    private setGroupTitle() {\r\n        const columnGroup = this.columnGroup;\r\n        const filterGroupName = isProvidedColumnGroup(columnGroup)\r\n            ? this.getColumnGroupName(columnGroup)\r\n            : this.getColumnName(columnGroup);\r\n        this.filterGroupName = filterGroupName;\r\n\r\n        this.filterGroupComp.setTitle(filterGroupName || '');\r\n    }\r\n\r\n    private getColumnGroupName(columnGroup: AgProvidedColumnGroup): string | null {\r\n        return this.beans.colNames.getDisplayNameForProvidedColumnGroup(null, columnGroup, 'filterToolPanel');\r\n    }\r\n\r\n    private getColumnName(column: AgColumn): string | null {\r\n        return this.beans.colNames.getDisplayNameForColumn(column, 'filterToolPanel', false);\r\n    }\r\n\r\n    private destroyFilters() {\r\n        this.childFilterComps = this.destroyBeans(this.childFilterComps);\r\n        _clearElement(this.getGui());\r\n    }\r\n\r\n    public override destroy() {\r\n        this.destroyFilters();\r\n        super.destroy();\r\n    }\r\n}\r\n", "export const filtersToolPanelCSS = /*css*/ `.ag-filter-toolpanel{flex:1 1 0px;min-width:0}.ag-filter-toolpanel-header,.ag-filter-toolpanel-search{align-items:center;color:var(--ag-header-text-color);display:flex;font-weight:500;padding:0 var(--ag-spacing);>*{align-items:center;display:flex}}.ag-filter-toolpanel-header{padding-bottom:var(--ag-spacing);padding-top:var(--ag-spacing);position:relative;&:focus-visible{border-radius:var(--ag-border-radius);box-shadow:inset var(--ag-focus-shadow)}}:where(.ag-ltr) .ag-filter-toolpanel-group-instance-header-icon,:where(.ag-ltr) .ag-filter-toolpanel-instance-header-icon{margin-left:var(--ag-spacing)}:where(.ag-rtl) .ag-filter-toolpanel-group-instance-header-icon,:where(.ag-rtl) .ag-filter-toolpanel-instance-header-icon{margin-right:var(--ag-spacing)}.ag-filter-toolpanel-search{margin-bottom:var(--ag-spacing);margin-top:var(--ag-widget-container-vertical-padding)}:where(.ag-filter-toolpanel-group:not(.ag-has-filter)>.ag-group-title-bar) .ag-filter-toolpanel-group-instance-header-icon{display:none}.ag-filter-toolpanel-search-input{flex-grow:1;height:calc(var(--ag-spacing)*4)}:where(.ag-ltr) .ag-filter-toolpanel-group-title-bar-icon{margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-filter-toolpanel-group-title-bar-icon{margin-left:var(--ag-spacing)}.ag-filter-toolpanel-expand{cursor:pointer}:where(.ag-ltr) .ag-filter-toolpanel-expand{margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-filter-toolpanel-expand{margin-left:var(--ag-spacing)}:where(.ag-ltr) .ag-filter-toolpanel-group-title-bar,:where(.ag-ltr) .ag-filter-toolpanel-instance-header{padding-left:calc(var(--ag-spacing) + var(--ag-filter-tool-panel-group-indent)*var(--ag-indentation-level))}:where(.ag-rtl) .ag-filter-toolpanel-group-title-bar,:where(.ag-rtl) .ag-filter-toolpanel-instance-header{padding-right:calc(var(--ag-spacing) + var(--ag-filter-tool-panel-group-indent)*var(--ag-indentation-level))}:where(.ag-ltr) .ag-filter-toolpanel-instance-body{margin-left:var(--ag-filter-tool-panel-group-indent)}:where(.ag-rtl) .ag-filter-toolpanel-instance-body{margin-right:var(--ag-filter-tool-panel-group-indent)}.ag-filter-toolpanel-instance-filter{background-color:var(--ag-chrome-background-color)}.ag-filter-toolpanel-group-level-0{border-top:none}`;\n", "import type {\r\n    BeanCollection,\r\n    Context,\r\n    GridApi,\r\n    GridOptions,\r\n    GridParams,\r\n    ICellRenderer,\r\n    IDetailCellRenderer,\r\n    IDetailCellRendererParams,\r\n} from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _getGridRegisteredModules, _missing, _warn, createGrid } from 'ag-grid-community';\r\n\r\nimport { DetailCellRendererCtrl } from './detailCellRendererCtrl';\r\nimport { DetailFrameworkComponentWrapper } from './detailFrameworkComponentWrapper';\r\n\r\nexport class DetailCellRenderer extends Component implements ICellRenderer {\r\n    private eDetailGrid: HTMLElement = RefPlaceholder;\r\n\r\n    private detailApi: GridApi;\r\n    private params: IDetailCellRendererParams;\r\n    private ctrl: DetailCellRendererCtrl;\r\n    private context: Context;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.context = beans.context;\r\n    }\r\n\r\n    public init(params: IDetailCellRendererParams): void {\r\n        this.params = params;\r\n        this.selectAndSetTemplate();\r\n\r\n        const compProxy: IDetailCellRenderer = {\r\n            addOrRemoveCssClass: (cssClassName: string, on: boolean) => this.addOrRemoveCssClass(cssClassName, on),\r\n            addOrRemoveDetailGridCssClass: (cssClassName: string, on: boolean) =>\r\n                this.eDetailGrid.classList.toggle(cssClassName, on),\r\n            setDetailGrid: (gridOptions) => this.setDetailGrid(gridOptions),\r\n            setRowData: (rowData) => this.setRowData(rowData),\r\n            getGui: () => this.eDetailGrid,\r\n        };\r\n\r\n        this.ctrl = this.createManagedBean(new DetailCellRendererCtrl());\r\n        this.ctrl.init(compProxy, params);\r\n    }\r\n\r\n    public refresh(): boolean {\r\n        return this.ctrl && this.ctrl.refresh();\r\n    }\r\n\r\n    private selectAndSetTemplate(): void {\r\n        const params = this.params;\r\n        if (params.pinned) {\r\n            this.setTemplate(/* html*/ `<div class=\"ag-details-row\"></div>`);\r\n            return;\r\n        }\r\n\r\n        const setDefaultTemplate = () => {\r\n            this.setTemplate(/* html */ `<div class=\"ag-details-row\" role=\"gridcell\">\r\n                <div data-ref=\"eDetailGrid\" class=\"ag-details-grid\" role=\"presentation\"></div>\r\n            </div>`);\r\n        };\r\n\r\n        if (_missing(params.template)) {\r\n            // use default template\r\n            setDefaultTemplate();\r\n        } else {\r\n            // use user provided template\r\n            if (typeof params.template === 'string') {\r\n                this.setTemplate(params.template, []);\r\n            } else if (typeof params.template === 'function') {\r\n                const templateFunc = params.template;\r\n                const template = templateFunc(params);\r\n                this.setTemplate(template, []);\r\n            } else {\r\n                _warn(168);\r\n                setDefaultTemplate();\r\n            }\r\n        }\r\n\r\n        if (this.eDetailGrid == null) {\r\n            _warn(169);\r\n        }\r\n    }\r\n\r\n    private setDetailGrid(gridOptions: GridOptions): void {\r\n        if (!this.eDetailGrid) {\r\n            return;\r\n        }\r\n\r\n        // when we create detail grid, the detail grid needs frameworkCompWrapper so that\r\n        // it created child components correctly, ie  Angular detail grid can have Angular cell renderer.\r\n        // this is only used by Angular and Vue, as React uses native React AG Grid detail grids\r\n        const parentFrameworkComponentWrapper = this.context.getBean('frameworkCompWrapper');\r\n        const frameworkCompWrapper = new DetailFrameworkComponentWrapper(parentFrameworkComponentWrapper);\r\n        const { frameworkOverrides } = this.beans;\r\n\r\n        const api = createGrid(this.eDetailGrid, gridOptions, {\r\n            frameworkOverrides,\r\n            providedBeanInstances: {\r\n                frameworkCompWrapper: frameworkCompWrapper,\r\n            },\r\n            modules: _getGridRegisteredModules(this.params.api.getGridId(), gridOptions.rowModelType ?? 'clientSide'),\r\n        } as GridParams);\r\n\r\n        this.detailApi = api;\r\n        this.ctrl.registerDetailWithMaster(api);\r\n\r\n        this.addDestroyFunc(() => {\r\n            api?.destroy();\r\n        });\r\n    }\r\n\r\n    private setRowData(rowData: any[]): void {\r\n        // ensure detail grid api still exists (grid may be destroyed when async call tries to set data)\r\n        this.detailApi?.setGridOption('rowData', rowData);\r\n    }\r\n}\r\n", "import type {\r\n    DetailGridInfo,\r\n    FullWidthRowFocusedEvent,\r\n    GridApi,\r\n    IDetailCellRenderer,\r\n    IDetailCellRendererCtrl,\r\n    IDetailCellRendererParams,\r\n    RowNode,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _focusInto, _isSameRow, _missing, _warn } from 'ag-grid-community';\r\n\r\nexport class DetailCellRendererCtrl extends BeanStub implements IDetailCellRendererCtrl {\r\n    private params: IDetailCellRendererParams;\r\n\r\n    private comp: IDetailCellRenderer;\r\n\r\n    private loadRowDataVersion = 0;\r\n\r\n    private refreshStrategy: 'rows' | 'everything' | 'nothing';\r\n\r\n    public init(comp: IDetailCellRenderer, params: IDetailCellRendererParams): void {\r\n        this.params = params;\r\n        this.comp = comp;\r\n\r\n        const doNothingBecauseInsidePinnedSection = params.pinned != null;\r\n        if (doNothingBecauseInsidePinnedSection) {\r\n            return;\r\n        }\r\n\r\n        this.setAutoHeightClasses();\r\n        this.setupRefreshStrategy();\r\n        this.createDetailGrid();\r\n        this.loadRowData();\r\n\r\n        this.addManagedEventListeners({ fullWidthRowFocused: this.onFullWidthRowFocused.bind(this) });\r\n    }\r\n\r\n    private onFullWidthRowFocused(e: FullWidthRowFocusedEvent): void {\r\n        const params = this.params;\r\n        const row = { rowIndex: params.node.rowIndex!, rowPinned: params.node.rowPinned! };\r\n        const eventRow = { rowIndex: e.rowIndex!, rowPinned: e.rowPinned! };\r\n        const isSameRow = _isSameRow(row, eventRow);\r\n\r\n        if (!isSameRow) {\r\n            return;\r\n        }\r\n\r\n        _focusInto(this.comp.getGui(), e.fromBelow);\r\n    }\r\n\r\n    private setAutoHeightClasses(): void {\r\n        const autoHeight = this.gos.get('detailRowAutoHeight');\r\n\r\n        const parentClass = autoHeight ? 'ag-details-row-auto-height' : 'ag-details-row-fixed-height';\r\n        const detailClass = autoHeight ? 'ag-details-grid-auto-height' : 'ag-details-grid-fixed-height';\r\n\r\n        const comp = this.comp;\r\n        comp.addOrRemoveCssClass(parentClass, true);\r\n        comp.addOrRemoveDetailGridCssClass(detailClass, true);\r\n    }\r\n\r\n    private setupRefreshStrategy(): void {\r\n        const providedStrategy = this.params.refreshStrategy;\r\n\r\n        const validSelection =\r\n            providedStrategy == 'everything' || providedStrategy == 'nothing' || providedStrategy == 'rows';\r\n        if (validSelection) {\r\n            this.refreshStrategy = providedStrategy;\r\n            return;\r\n        }\r\n\r\n        if (providedStrategy != null) {\r\n            _warn(170, { providedStrategy });\r\n        }\r\n\r\n        this.refreshStrategy = 'rows';\r\n    }\r\n\r\n    private createDetailGrid(): void {\r\n        const { params, gos } = this;\r\n        if (_missing(params.detailGridOptions)) {\r\n            _warn(171);\r\n            return;\r\n        }\r\n\r\n        // we clone the detail grid options, as otherwise it would be shared\r\n        // across many instances, and that would be a problem because we set\r\n        // api into gridOptions\r\n        const gridOptions = { ...params.detailGridOptions };\r\n\r\n        const autoHeight = gos.get('detailRowAutoHeight');\r\n        if (autoHeight) {\r\n            gridOptions.domLayout = 'autoHeight';\r\n        }\r\n\r\n        gridOptions.theme ||= gos.get('theme');\r\n\r\n        this.comp.setDetailGrid(gridOptions);\r\n    }\r\n\r\n    public registerDetailWithMaster(api: GridApi): void {\r\n        const params = this.params;\r\n        const rowId = params.node.id!;\r\n        const masterGridApi = params.api;\r\n\r\n        const gridInfo: DetailGridInfo = {\r\n            id: rowId,\r\n            api: api,\r\n        };\r\n\r\n        const rowNode = params.node as RowNode;\r\n\r\n        // register with api if the master api is still alive\r\n        if (masterGridApi.isDestroyed()) {\r\n            return;\r\n        }\r\n        masterGridApi.addDetailGridInfo(rowId, gridInfo);\r\n\r\n        // register with node\r\n        rowNode.detailGridInfo = gridInfo;\r\n\r\n        this.addDestroyFunc(() => {\r\n            // the gridInfo can be stale if a refresh happens and\r\n            // a new row is created before the old one is destroyed.\r\n            if (rowNode.detailGridInfo !== gridInfo) {\r\n                return;\r\n            }\r\n            if (!masterGridApi.isDestroyed()) {\r\n                masterGridApi.removeDetailGridInfo(rowId); // unregister from api\r\n            }\r\n            rowNode.detailGridInfo = null; // unregister from node\r\n        });\r\n    }\r\n\r\n    private loadRowData(): void {\r\n        // in case a refresh happens before the last refresh completes (as we depend on async\r\n        // application logic) we keep track on what the latest call was.\r\n        this.loadRowDataVersion++;\r\n        const versionThisCall = this.loadRowDataVersion;\r\n\r\n        const params = this.params;\r\n        if (params.detailGridOptions?.rowModelType === 'serverSide') {\r\n            const node = params.node as RowNode;\r\n            node.detailGridInfo?.api?.refreshServerSide({ purge: true });\r\n            return;\r\n        }\r\n\r\n        const userFunc = params.getDetailRowData;\r\n        if (!userFunc) {\r\n            _warn(172);\r\n            return;\r\n        }\r\n\r\n        const successCallback = (rowData: any[]) => {\r\n            const mostRecentCall = this.loadRowDataVersion === versionThisCall;\r\n            if (mostRecentCall) {\r\n                this.comp.setRowData(rowData);\r\n            }\r\n        };\r\n\r\n        const funcParams: any = {\r\n            node: params.node,\r\n            // we take data from node, rather than params.data\r\n            // as the data could have been updated with new instance\r\n            data: params.node.data,\r\n            successCallback: successCallback,\r\n            context: this.gos.getGridCommonParams().context,\r\n        };\r\n        userFunc(funcParams);\r\n    }\r\n\r\n    public refresh(): boolean {\r\n        const GET_GRID_TO_REFRESH = false;\r\n        const GET_GRID_TO_DO_NOTHING = true;\r\n\r\n        switch (this.refreshStrategy) {\r\n            // ignore this refresh, make grid think we've refreshed but do nothing\r\n            case 'nothing':\r\n                return GET_GRID_TO_DO_NOTHING;\r\n            // grid will destroy and recreate the cell\r\n            case 'everything':\r\n                return GET_GRID_TO_REFRESH;\r\n        }\r\n\r\n        // do the refresh here, and tell the grid to do nothing\r\n        this.loadRowData();\r\n        return GET_GRID_TO_DO_NOTHING;\r\n    }\r\n}\r\n", "import type { ComponentType, FrameworkComponentWrapper, IComponent } from 'ag-grid-community';\r\n\r\n// this wrapper is to prevent detail grids from destroying the parent wrappers\r\nexport class DetailFrameworkComponentWrapper implements FrameworkComponentWrapper {\r\n    constructor(private readonly parentWrapper: FrameworkComponentWrapper) {}\r\n\r\n    public wrap<A extends IComponent<any>>(\r\n        frameworkComponent: { new (): any } | null,\r\n        mandatoryMethods: string[] | undefined,\r\n        optionalMethods: string[] | undefined,\r\n        componentType: ComponentType\r\n    ): A {\r\n        return this.parentWrapper.wrap(frameworkComponent, mandatoryMethods, optionalMethods, componentType);\r\n    }\r\n}\r\n", "import type { BeanCollection, DetailGridInfo } from 'ag-grid-community';\r\n\r\nimport type { MasterDetailService } from './masterDetailService';\r\n\r\nfunction operateOnStore<TCallbackResult>(\r\n    beans: BeanCollection,\r\n    callback: (store: { [id: string]: DetailGridInfo | undefined }) => TCallbackResult\r\n): TCallbackResult | undefined {\r\n    const store = (beans.masterDetailSvc as MasterDetailService | undefined)?.store;\r\n    return store ? callback(store) : undefined;\r\n}\r\n\r\nexport function addDetailGridInfo(beans: BeanCollection, id: string, gridInfo: DetailGridInfo): void {\r\n    operateOnStore(beans, (store) => {\r\n        store[id] = gridInfo;\r\n    });\r\n}\r\n\r\nexport function removeDetailGridInfo(beans: BeanCollection, id: string): void {\r\n    operateOnStore(beans, (store) => {\r\n        delete store[id];\r\n    });\r\n}\r\n\r\nexport function getDetailGridInfo(beans: BeanCollection, id: string): DetailGridInfo | undefined {\r\n    return operateOnStore(beans, (store) => store[id]);\r\n}\r\n\r\nexport function forEachDetailGridInfo(\r\n    beans: BeanCollection,\r\n    callback: (gridInfo: DetailGridInfo, index: number) => void\r\n) {\r\n    operateOnStore(beans, (store) => {\r\n        let index = 0;\r\n        Object.values(store).forEach((gridInfo: DetailGridInfo) => {\r\n            // check for undefined, as old references will still be lying around\r\n            if (gridInfo) {\r\n                callback(gridInfo, index++);\r\n            }\r\n        });\r\n    });\r\n}\r\n", "export const masterDetailModuleCSS = /*css*/ `.ag-details-row{width:100%}.ag-details-row-fixed-height{height:100%}.ag-details-grid{width:100%}.ag-details-grid-fixed-height{height:100%}`;\n", "import type {\r\n    BeanName,\r\n    BeforeRefreshModelEvent,\r\n    DetailGridInfo,\r\n    IChangedRowNodes,\r\n    IMasterDetailService,\r\n    NamedBean,\r\n    RowCtrl,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    RowNode,\r\n    _exists,\r\n    _getClientSideRowModel,\r\n    _isClientSideRowModel,\r\n    _isServerSideRowModel,\r\n    _observeResize,\r\n} from 'ag-grid-community';\r\n\r\nexport class MasterDetailService extends BeanStub implements NamedBean, IMasterDetailService {\r\n    beanName: BeanName = 'masterDetailSvc' as const;\r\n\r\n    public store: { [id: string]: DetailGridInfo | undefined } = {};\r\n\r\n    private enabled: boolean;\r\n\r\n    private isEnabled(): boolean {\r\n        const gos = this.gos;\r\n        return (\r\n            gos.get('masterDetail') &&\r\n            // TODO: AG-1752: [Tree Data] Allow tree data leaf rows to serve as master rows for detail grids (Tree Data hosting Master/Detail)\"\r\n            !gos.get('treeData')\r\n        );\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        if (_isClientSideRowModel(this.gos)) {\r\n            this.enabled = this.isEnabled();\r\n            this.addManagedEventListeners({ beforeRefreshModel: this.beforeRefreshModel.bind(this) });\r\n        }\r\n    }\r\n\r\n    private beforeRefreshModel({ params }: BeforeRefreshModelEvent) {\r\n        if (params.changedProps) {\r\n            const enabled = this.isEnabled();\r\n            if (this.enabled !== enabled) {\r\n                this.setMasters(null);\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (params.rowDataUpdated) {\r\n            this.setMasters(params.changedRowNodes);\r\n        }\r\n    }\r\n\r\n    private setMasters(changedRowNodes: IChangedRowNodes | null | undefined): void {\r\n        const enabled = this.isEnabled();\r\n        this.enabled = enabled;\r\n\r\n        const gos = this.gos;\r\n        const isRowMaster = gos.get('isRowMaster');\r\n        const groupDefaultExpanded = gos.get('groupDefaultExpanded');\r\n\r\n        const setMaster = (row: RowNode, created: boolean, updated: boolean) => {\r\n            const oldMaster = row.master;\r\n\r\n            let newMaster = enabled;\r\n\r\n            if (enabled) {\r\n                if (created || updated) {\r\n                    if (isRowMaster) {\r\n                        const data = row.data;\r\n                        newMaster = !!data && !!isRowMaster(data);\r\n                    }\r\n                } else {\r\n                    newMaster = oldMaster;\r\n                }\r\n            }\r\n\r\n            if (newMaster && created) {\r\n                // TODO: AG-11476 isGroupOpenByDefault callback doesn't apply to master/detail grid\r\n\r\n                if (groupDefaultExpanded === -1) {\r\n                    row.expanded = true;\r\n                } else {\r\n                    // need to take row group into account when determining level\r\n                    const masterRowLevel = this.beans.rowGroupColsSvc?.columns.length ?? 0;\r\n                    row.expanded = masterRowLevel < groupDefaultExpanded;\r\n                }\r\n            } else if (!newMaster && oldMaster) {\r\n                row.expanded = false; // if changing AWAY from master, then un-expand, otherwise next time it's shown it is expanded again\r\n            }\r\n\r\n            if (newMaster !== oldMaster) {\r\n                row.master = newMaster;\r\n\r\n                row.dispatchRowEvent('masterChanged');\r\n            }\r\n        };\r\n\r\n        if (changedRowNodes) {\r\n            const updates = changedRowNodes.updates;\r\n            for (const node of updates.keys()) {\r\n                const created = updates.get(node)!;\r\n                setMaster(node, created, !created);\r\n            }\r\n        } else {\r\n            const allLeafChildren = _getClientSideRowModel(this.beans)?.rootNode?.allLeafChildren;\r\n            if (allLeafChildren) {\r\n                for (let i = 0, len = allLeafChildren.length; i < len; ++i) {\r\n                    setMaster(allLeafChildren[i], true, false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Used by flatten stage to get or create a detail node from a master node */\r\n    public getDetail(masterNode: RowNode): RowNode | null {\r\n        if (!masterNode.master || !masterNode.expanded) {\r\n            return null;\r\n        }\r\n\r\n        let detailNode = masterNode.detailNode;\r\n        if (detailNode) {\r\n            return detailNode;\r\n        }\r\n\r\n        detailNode = new RowNode(this.beans);\r\n        detailNode.detail = true;\r\n        detailNode.selectable = false;\r\n        detailNode.parent = masterNode;\r\n\r\n        if (_exists(masterNode.id)) {\r\n            detailNode.id = 'detail_' + masterNode.id;\r\n        }\r\n\r\n        detailNode.data = masterNode.data;\r\n        detailNode.level = masterNode.level + 1;\r\n        masterNode.detailNode = detailNode;\r\n\r\n        return detailNode;\r\n    }\r\n\r\n    public setupDetailRowAutoHeight(rowCtrl: RowCtrl, eDetailGui: HTMLElement): void {\r\n        const { gos, beans } = this;\r\n        if (!gos.get('detailRowAutoHeight')) {\r\n            return;\r\n        }\r\n\r\n        const checkRowSizeFunc = () => {\r\n            const clientHeight = eDetailGui.clientHeight;\r\n\r\n            // if the UI is not ready, the height can be 0, which we ignore, as otherwise a flicker will occur\r\n            // as UI goes from the default height, to 0, then to the real height as UI becomes ready. this means\r\n            // it's not possible for have 0 as auto-height, however this is an improbable use case, as even an\r\n            // empty detail grid would still have some styling around it giving at least a few pixels.\r\n            if (clientHeight != null && clientHeight > 0) {\r\n                // we do the update in a timeout, to make sure we are not calling from inside the grid\r\n                // doing another update\r\n                const updateRowHeightFunc = () => {\r\n                    const { rowModel } = this.beans;\r\n                    const { rowNode } = rowCtrl;\r\n                    rowNode.setRowHeight(clientHeight);\r\n                    if (_isClientSideRowModel(gos, rowModel) || _isServerSideRowModel(gos, rowModel)) {\r\n                        rowModel.onRowHeightChanged();\r\n                    }\r\n                };\r\n                window.setTimeout(updateRowHeightFunc, 0);\r\n            }\r\n        };\r\n\r\n        const resizeObserverDestroyFunc = _observeResize(beans, eDetailGui, checkRowSizeFunc);\r\n\r\n        rowCtrl.addDestroyFunc(resizeObserverDestroyFunc);\r\n\r\n        checkRowSizeFunc();\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.store = {};\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { _MasterDetailGridApi, _ModuleWithApi, _ModuleWithoutApi } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport {\r\n    ClientSideRowModelHierarchyModule,\r\n    GroupCellRendererModule,\r\n    StickyRowModule,\r\n} from '../rowHierarchy/rowHierarchyModule';\r\nimport { VERSION } from '../version';\r\nimport { DetailCellRenderer } from './detailCellRenderer';\r\nimport { DetailCellRendererCtrl } from './detailCellRendererCtrl';\r\nimport { addDetailGridInfo, forEachDetailGridInfo, getDetailGridInfo, removeDetailGridInfo } from './masterDetailApi';\r\nimport { masterDetailModuleCSS } from './masterDetailModule.css-GENERATED';\r\nimport { MasterDetailService } from './masterDetailService';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const SharedMasterDetailModule: _ModuleWithApi<_MasterDetailGridApi> = {\r\n    moduleName: 'SharedMasterDetail',\r\n    version: VERSION,\r\n    beans: [MasterDetailService],\r\n    userComponents: { agDetailCellRenderer: DetailCellRenderer },\r\n    dynamicBeans: { detailCellRendererCtrl: DetailCellRendererCtrl },\r\n    apiFunctions: {\r\n        addDetailGridInfo,\r\n        removeDetailGridInfo,\r\n        getDetailGridInfo,\r\n        forEachDetailGridInfo,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, GroupCellRendererModule, StickyRowModule],\r\n    css: [masterDetailModuleCSS],\r\n};\r\n\r\n/**\r\n * @feature Master Detail\r\n * @gridOption masterDetail\r\n */\r\nexport const MasterDetailModule: _ModuleWithoutApi = {\r\n    moduleName: 'MasterDetail',\r\n    version: VERSION,\r\n    dependsOn: [SharedMasterDetailModule, ClientSideRowModelHierarchyModule],\r\n};\r\n", "import type { _CellSelectionGridApi, _ModuleWithApi, _ModuleWithoutApi } from 'ag-grid-community';\r\nimport { _DragModule, _KeyboardNavigationModule } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { AgFillHandle } from './agFillHandle';\r\nimport { AgRangeHandle } from './agRangeHandle';\r\nimport { rangeSelectionCSS } from './rangeSelection.css-GENERATED';\r\nimport { addCellRange, clearRangeSelection, getCellRanges } from './rangeSelectionApi';\r\nimport { RangeService } from './rangeService';\r\n\r\n/**\r\n * @feature Selection -> Cell Selection\r\n * @gridOption cellSelection\r\n */\r\nexport const CellSelectionModule: _ModuleWithApi<_CellSelectionGridApi> = {\r\n    moduleName: 'CellSelection',\r\n    version: VERSION,\r\n    beans: [RangeService],\r\n    dynamicBeans: { fillHandle: AgFillHandle, rangeHandle: AgRangeHandle },\r\n    apiFunctions: {\r\n        getCellRanges,\r\n        addCellRange,\r\n        clearRangeSelection,\r\n        clearCellSelection: clearRangeSelection,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _KeyboardNavigationModule, _DragModule],\r\n    css: [rangeSelectionCSS],\r\n};\r\n\r\n/**\r\n * @deprecated v33 Use `CellSelectionModule` instead\r\n */\r\nexport const RangeSelectionModule: _ModuleWithoutApi = {\r\n    moduleName: 'RangeSelection',\r\n    version: VERSION,\r\n    dependsOn: [CellSelectionModule],\r\n};\r\n", "import type {\r\n    AgColumn,\r\n    CellCtrl,\r\n    CellPosition,\r\n    CellRange,\r\n    FillOperationParams,\r\n    RowNode,\r\n    RowPosition,\r\n} from 'ag-grid-community';\r\nimport {\r\n    _getCellByPosition,\r\n    _getFillHandle,\r\n    _getNormalisedMousePosition,\r\n    _getRowNode,\r\n    _isRowBefore,\r\n    _isSameRow,\r\n    _last,\r\n    _toStringOrNull,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { AbstractSelectionHandle, SelectionHandleType } from './abstractSelectionHandle';\r\nimport { findLineByLeastSquares } from './utils';\r\n\r\ninterface FillValues {\r\n    position: CellPosition;\r\n    value: any;\r\n}\r\n\r\ninterface ValueContext {\r\n    value: any;\r\n    column: AgColumn;\r\n    rowNode: RowNode;\r\n}\r\n\r\ntype Direction = 'x' | 'y';\r\n\r\nexport class AgFillHandle extends AbstractSelectionHandle {\r\n    private initialPosition: CellPosition | undefined;\r\n    private initialXY: { x: number; y: number } | null;\r\n    private lastCellMarked: CellPosition | undefined;\r\n    private markedCells: CellCtrl[] = [];\r\n    private cellValues: FillValues[][] = [];\r\n\r\n    private dragAxis: Direction;\r\n    private isUp: boolean = false;\r\n    private isLeft: boolean = false;\r\n    private isReduce: boolean = false;\r\n\r\n    protected type = SelectionHandleType.FILL;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-fill-handle\"></div>`);\r\n    }\r\n\r\n    protected override updateValuesOnMove(e: MouseEvent) {\r\n        super.updateValuesOnMove(e);\r\n\r\n        if (!this.initialXY) {\r\n            this.initialXY = _getNormalisedMousePosition(this.beans, e);\r\n        }\r\n\r\n        const { x, y } = this.initialXY;\r\n        const { x: newX, y: newY } = _getNormalisedMousePosition(this.beans, e);\r\n        const diffX = Math.abs(x - newX);\r\n        const diffY = Math.abs(y - newY);\r\n        const allowedDirection = this.getFillHandleDirection();\r\n        let direction: Direction;\r\n\r\n        if (allowedDirection === 'xy') {\r\n            direction = diffX > diffY ? 'x' : 'y';\r\n        } else {\r\n            direction = allowedDirection;\r\n        }\r\n\r\n        if (direction !== this.dragAxis) {\r\n            this.dragAxis = direction;\r\n            this.changedCalculatedValues = true;\r\n        }\r\n    }\r\n\r\n    protected onDrag(_: MouseEvent) {\r\n        if (!this.initialPosition) {\r\n            const cellCtrl = this.cellCtrl;\r\n            if (!cellCtrl) {\r\n                return;\r\n            }\r\n\r\n            this.initialPosition = cellCtrl.cellPosition;\r\n        }\r\n\r\n        const lastCellHovered = this.getLastCellHovered();\r\n\r\n        if (lastCellHovered) {\r\n            this.markPathFrom(this.initialPosition, lastCellHovered);\r\n        }\r\n    }\r\n\r\n    protected onDragEnd(e: MouseEvent) {\r\n        this.initialXY = null;\r\n        if (!this.markedCells.length) {\r\n            return;\r\n        }\r\n\r\n        const isX = this.dragAxis === 'x';\r\n        const { cellRange: initialRange, rangeStartRow, rangeEndRow, beans } = this;\r\n        const colLen = initialRange.columns.length;\r\n\r\n        let finalRange: CellRange | undefined;\r\n\r\n        const { rangeSvc, eventSvc } = beans;\r\n\r\n        if (!this.isUp && !this.isLeft) {\r\n            finalRange = rangeSvc!.createCellRangeFromCellRangeParams({\r\n                rowStartIndex: rangeStartRow.rowIndex,\r\n                rowStartPinned: rangeStartRow.rowPinned,\r\n                columnStart: initialRange.columns[0],\r\n                rowEndIndex: isX ? rangeEndRow.rowIndex : this.lastCellMarked!.rowIndex,\r\n                rowEndPinned: isX ? rangeEndRow.rowPinned : this.lastCellMarked!.rowPinned,\r\n                columnEnd: isX ? this.lastCellMarked!.column : initialRange.columns[colLen - 1],\r\n            });\r\n        } else {\r\n            const startRow = isX ? rangeStartRow : this.lastCellMarked;\r\n\r\n            finalRange = rangeSvc!.createCellRangeFromCellRangeParams({\r\n                rowStartIndex: startRow!.rowIndex,\r\n                rowStartPinned: startRow!.rowPinned,\r\n                columnStart: isX ? this.lastCellMarked!.column : initialRange.columns[0],\r\n                rowEndIndex: rangeEndRow.rowIndex,\r\n                rowEndPinned: rangeEndRow.rowPinned,\r\n                columnEnd: initialRange.columns[colLen - 1],\r\n            });\r\n        }\r\n\r\n        if (finalRange) {\r\n            // raising fill events for undo / redo\r\n            eventSvc.dispatchEvent({\r\n                type: 'fillStart',\r\n            });\r\n\r\n            this.handleValueChanged(initialRange, finalRange, e);\r\n            rangeSvc!.setCellRanges([finalRange]);\r\n\r\n            eventSvc.dispatchEvent({\r\n                type: 'fillEnd',\r\n                initialRange: initialRange,\r\n                finalRange: finalRange,\r\n            });\r\n        }\r\n    }\r\n\r\n    protected onDragCancel(): void {\r\n        this.initialXY = null;\r\n        if (!this.markedCells.length) {\r\n            return;\r\n        }\r\n\r\n        this.clearMarkedPath();\r\n    }\r\n\r\n    private getFillHandleDirection(): 'x' | 'y' | 'xy' {\r\n        const direction = _getFillHandle(this.gos)?.direction;\r\n\r\n        if (!direction) {\r\n            return 'xy';\r\n        }\r\n\r\n        if (direction !== 'x' && direction !== 'y' && direction !== 'xy') {\r\n            _warn(177);\r\n            return 'xy';\r\n        }\r\n\r\n        return direction;\r\n    }\r\n\r\n    private handleValueChanged(initialRange: CellRange, finalRange: CellRange, e: MouseEvent) {\r\n        const { rangeSvc, gos, cellNavigation, valueSvc } = this.beans;\r\n        const initialRangeEndRow = rangeSvc!.getRangeEndRow(initialRange);\r\n        const initialRangeStartRow = rangeSvc!.getRangeStartRow(initialRange);\r\n        const finalRangeEndRow = rangeSvc!.getRangeEndRow(finalRange);\r\n        const finalRangeStartRow = rangeSvc!.getRangeStartRow(finalRange);\r\n        const isVertical = this.dragAxis === 'y';\r\n\r\n        // if the range is being reduced in size, all we need to do is\r\n        // clear the cells that are no longer part of the range\r\n        if (this.isReduce && !_getFillHandle(gos)?.suppressClearOnFillReduction) {\r\n            const columns = (\r\n                isVertical\r\n                    ? initialRange.columns\r\n                    : initialRange.columns.filter((col) => finalRange.columns.indexOf(col) < 0)\r\n            ) as AgColumn[];\r\n\r\n            const startRow = isVertical ? cellNavigation!.getRowBelow(finalRangeEndRow) : finalRangeStartRow;\r\n\r\n            if (startRow) {\r\n                this.clearCellsInRange(startRow, initialRangeEndRow, columns);\r\n            }\r\n            return;\r\n        }\r\n\r\n        const values: ValueContext[] = [];\r\n        const initialValues: any[] = [];\r\n        const initialNonAggregatedValues: any[] = [];\r\n        const initialFormattedValues: any[] = [];\r\n\r\n        let withinInitialRange = true;\r\n        let idx = 0;\r\n\r\n        const resetValues = () => {\r\n            values.length = 0;\r\n            initialValues.length = 0;\r\n            initialNonAggregatedValues.length = 0;\r\n            initialFormattedValues.length = 0;\r\n            idx = 0;\r\n        };\r\n\r\n        const iterateAcrossCells = (column?: AgColumn, columns?: AgColumn[]) => {\r\n            let currentRow: RowPosition | undefined | null = this.isUp ? initialRangeEndRow : initialRangeStartRow;\r\n            let finished = false;\r\n\r\n            if (isVertical) {\r\n                withinInitialRange = true;\r\n                resetValues();\r\n            }\r\n\r\n            while (!finished && currentRow) {\r\n                const rowNode = _getRowNode(this.beans, currentRow);\r\n                if (!rowNode) {\r\n                    break;\r\n                }\r\n\r\n                if (isVertical && column) {\r\n                    fillValues(\r\n                        values,\r\n                        column,\r\n                        rowNode,\r\n                        () => !_isSameRow(currentRow!, this.isUp ? initialRangeStartRow : initialRangeEndRow)\r\n                    );\r\n                } else if (columns) {\r\n                    withinInitialRange = true;\r\n                    resetValues();\r\n                    columns.forEach((col) =>\r\n                        fillValues(\r\n                            values,\r\n                            col,\r\n                            rowNode,\r\n                            () => col !== (this.isLeft ? initialRange.columns[0] : _last(initialRange.columns))\r\n                        )\r\n                    );\r\n                }\r\n\r\n                finished = _isSameRow(currentRow, this.isUp ? finalRangeStartRow : finalRangeEndRow);\r\n\r\n                currentRow = this.isUp\r\n                    ? cellNavigation!.getRowAbove(currentRow)\r\n                    : cellNavigation!.getRowBelow(currentRow);\r\n            }\r\n        };\r\n\r\n        const fillValues = (\r\n            currentValues: ValueContext[],\r\n            col: AgColumn,\r\n            rowNode: RowNode,\r\n            updateInitialSet: () => boolean\r\n        ) => {\r\n            let currentValue: any;\r\n            let skipValue: boolean = false;\r\n\r\n            if (withinInitialRange) {\r\n                currentValue = valueSvc.getValue(col, rowNode);\r\n                initialValues.push(currentValue);\r\n                initialNonAggregatedValues.push(valueSvc.getValue(col, rowNode, true));\r\n                initialFormattedValues.push(valueSvc.formatValue(col, rowNode, currentValue));\r\n                withinInitialRange = updateInitialSet();\r\n            } else {\r\n                const { value, fromUserFunction, sourceCol, sourceRowNode } = this.processValues({\r\n                    event: e,\r\n                    values: currentValues,\r\n                    initialValues,\r\n                    initialNonAggregatedValues,\r\n                    initialFormattedValues,\r\n                    col,\r\n                    rowNode,\r\n                    idx: idx++,\r\n                });\r\n\r\n                currentValue = value;\r\n                if (col.isCellEditable(rowNode)) {\r\n                    const cellValue = valueSvc.getValue(col, rowNode);\r\n\r\n                    if (!fromUserFunction) {\r\n                        if (sourceCol) {\r\n                            const sourceColDef = sourceCol.getColDef();\r\n                            if (sourceColDef.useValueFormatterForExport !== false && sourceColDef.valueFormatter) {\r\n                                const formattedValue = valueSvc.formatValue(sourceCol, sourceRowNode!, currentValue);\r\n\r\n                                if (formattedValue != null) {\r\n                                    currentValue = formattedValue;\r\n                                }\r\n                            }\r\n                        }\r\n                        if (col.getColDef().useValueParserForImport !== false) {\r\n                            currentValue = valueSvc.parseValue(\r\n                                col,\r\n                                rowNode,\r\n                                // if no sourceCol, then currentValue is a number\r\n                                sourceCol ? currentValue : _toStringOrNull(currentValue),\r\n                                cellValue\r\n                            );\r\n                        }\r\n                    }\r\n                    if (!fromUserFunction || cellValue !== currentValue) {\r\n                        rowNode.setDataValue(col, currentValue, 'rangeSvc');\r\n                    } else {\r\n                        skipValue = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!skipValue) {\r\n                currentValues.push({\r\n                    value: currentValue,\r\n                    column: col,\r\n                    rowNode,\r\n                });\r\n            }\r\n        };\r\n\r\n        if (isVertical) {\r\n            initialRange.columns.forEach((col: AgColumn) => {\r\n                iterateAcrossCells(col);\r\n            });\r\n        } else {\r\n            const columns = (this.isLeft ? [...finalRange.columns].reverse() : finalRange.columns) as AgColumn[];\r\n            iterateAcrossCells(undefined, columns);\r\n        }\r\n    }\r\n\r\n    private clearCellsInRange(startRow: RowPosition, endRow: RowPosition, columns: AgColumn[]) {\r\n        const cellRange: CellRange = {\r\n            startRow,\r\n            endRow,\r\n            columns,\r\n            startColumn: columns[0],\r\n        };\r\n        this.beans.rangeSvc!.clearCellRangeCellValues({ cellRanges: [cellRange] });\r\n    }\r\n\r\n    private processValues(params: {\r\n        event: MouseEvent;\r\n        values: ValueContext[];\r\n        initialValues: any[];\r\n        initialNonAggregatedValues: any[];\r\n        initialFormattedValues: any[];\r\n        col: AgColumn;\r\n        rowNode: RowNode;\r\n        idx: number;\r\n    }): { value: any; fromUserFunction: boolean; sourceCol?: AgColumn; sourceRowNode?: RowNode } {\r\n        const { event, values, initialValues, initialNonAggregatedValues, initialFormattedValues, col, rowNode, idx } =\r\n            params;\r\n\r\n        const userFillOperation = _getFillHandle(this.gos)?.setFillValue;\r\n        const isVertical = this.dragAxis === 'y';\r\n        let direction: 'up' | 'down' | 'left' | 'right';\r\n\r\n        if (isVertical) {\r\n            direction = this.isUp ? 'up' : 'down';\r\n        } else {\r\n            direction = this.isLeft ? 'left' : 'right';\r\n        }\r\n\r\n        if (userFillOperation) {\r\n            const params = this.gos.addGridCommonParams<FillOperationParams>({\r\n                event,\r\n                values: values.map(({ value }) => value),\r\n                initialValues,\r\n                initialNonAggregatedValues,\r\n                initialFormattedValues,\r\n                currentIndex: idx,\r\n                currentCellValue: this.beans.valueSvc.getValue(col, rowNode),\r\n                direction,\r\n                column: col,\r\n                rowNode: rowNode,\r\n            });\r\n            const userResult = userFillOperation(params);\r\n            if (userResult !== false) {\r\n                return { value: userResult, fromUserFunction: true };\r\n            }\r\n        }\r\n\r\n        const allNumbers = !values.some(({ value }) => {\r\n            const asFloat = parseFloat(value);\r\n            return isNaN(asFloat) || asFloat.toString() !== value.toString();\r\n        });\r\n\r\n        // values should be copied in order if the alt key is pressed\r\n        // or if the values contain strings and numbers\r\n        // However, if we only have one initial value selected, and that\r\n        // value is a number and we are also pressing alt, then we should\r\n        // increment or decrement the value by 1 based on direction.\r\n        if (event.altKey || !allNumbers) {\r\n            if (allNumbers && initialValues.length === 1) {\r\n                const multiplier = this.isUp || this.isLeft ? -1 : 1;\r\n                return { value: parseFloat(_last(values).value) + 1 * multiplier, fromUserFunction: false };\r\n            }\r\n            const { value, column: sourceCol, rowNode: sourceRowNode } = values[idx % values.length];\r\n            return { value, fromUserFunction: false, sourceCol, sourceRowNode };\r\n        }\r\n\r\n        return {\r\n            value: _last(findLineByLeastSquares(values.map(({ value }) => Number(value)))),\r\n            fromUserFunction: false,\r\n        };\r\n    }\r\n\r\n    protected override clearValues() {\r\n        this.clearMarkedPath();\r\n        this.clearCellValues();\r\n\r\n        this.lastCellMarked = undefined;\r\n\r\n        super.clearValues();\r\n    }\r\n\r\n    private clearMarkedPath() {\r\n        this.markedCells.forEach((cell) => {\r\n            if (!cell.isAlive()) {\r\n                return;\r\n            }\r\n            const { comp } = cell;\r\n            comp.addOrRemoveCssClass('ag-selection-fill-top', false);\r\n            comp.addOrRemoveCssClass('ag-selection-fill-right', false);\r\n            comp.addOrRemoveCssClass('ag-selection-fill-bottom', false);\r\n            comp.addOrRemoveCssClass('ag-selection-fill-left', false);\r\n        });\r\n\r\n        this.markedCells.length = 0;\r\n\r\n        this.isUp = false;\r\n        this.isLeft = false;\r\n        this.isReduce = false;\r\n    }\r\n\r\n    private clearCellValues() {\r\n        this.cellValues.length = 0;\r\n    }\r\n\r\n    private markPathFrom(initialPosition: CellPosition, currentPosition: CellPosition) {\r\n        this.clearMarkedPath();\r\n        this.clearCellValues();\r\n\r\n        if (this.dragAxis === 'y') {\r\n            if (_isSameRow(currentPosition, initialPosition)) {\r\n                return;\r\n            }\r\n\r\n            const isBefore = _isRowBefore(currentPosition, initialPosition);\r\n            const { rangeStartRow, rangeEndRow } = this;\r\n\r\n            if (\r\n                isBefore &&\r\n                ((currentPosition.rowPinned == rangeStartRow.rowPinned &&\r\n                    currentPosition.rowIndex >= rangeStartRow.rowIndex) ||\r\n                    (rangeStartRow.rowPinned != rangeEndRow.rowPinned &&\r\n                        currentPosition.rowPinned == rangeEndRow.rowPinned &&\r\n                        currentPosition.rowIndex <= rangeEndRow.rowIndex))\r\n            ) {\r\n                this.reduceVertical(initialPosition, currentPosition);\r\n                this.isReduce = true;\r\n            } else {\r\n                this.extendVertical(initialPosition, currentPosition, isBefore);\r\n                this.isReduce = false;\r\n            }\r\n        } else {\r\n            const initialColumn = initialPosition.column as AgColumn;\r\n            const currentColumn = currentPosition.column as AgColumn;\r\n\r\n            if (initialColumn === currentColumn) {\r\n                return;\r\n            }\r\n            const displayedColumns = this.beans.visibleCols.allCols;\r\n            const initialIndex = displayedColumns.indexOf(initialColumn);\r\n            const currentIndex = displayedColumns.indexOf(currentColumn);\r\n\r\n            if (\r\n                currentIndex <= initialIndex &&\r\n                currentIndex >= displayedColumns.indexOf(this.cellRange.columns[0] as AgColumn)\r\n            ) {\r\n                this.reduceHorizontal(initialPosition, currentPosition);\r\n                this.isReduce = true;\r\n            } else {\r\n                this.extendHorizontal(initialPosition, currentPosition, currentIndex < initialIndex);\r\n                this.isReduce = false;\r\n            }\r\n        }\r\n        this.lastCellMarked = currentPosition;\r\n    }\r\n\r\n    private extendVertical(initialPosition: CellPosition, endPosition: CellPosition, isMovingUp?: boolean) {\r\n        const beans = this.beans;\r\n        const { rangeSvc, cellNavigation } = beans;\r\n\r\n        let row: RowPosition | null = initialPosition;\r\n\r\n        do {\r\n            const cellRange = this.cellRange;\r\n            const colLen = cellRange.columns.length;\r\n\r\n            for (let i = 0; i < colLen; i++) {\r\n                const column = cellRange.columns[i];\r\n                const rowPos = { rowIndex: row.rowIndex, rowPinned: row.rowPinned };\r\n                const cellPos = { ...rowPos, column };\r\n                const cellInRange = rangeSvc!.isCellInSpecificRange(cellPos, cellRange);\r\n                const isInitialRow = _isSameRow(row, initialPosition);\r\n\r\n                if (isMovingUp) {\r\n                    this.isUp = true;\r\n                }\r\n\r\n                if (!isInitialRow) {\r\n                    const cell = _getCellByPosition(beans, cellPos);\r\n\r\n                    if (cell) {\r\n                        this.markedCells.push(cell);\r\n                        const cellComp = cell.comp;\r\n\r\n                        if (!cellInRange) {\r\n                            cellComp.addOrRemoveCssClass('ag-selection-fill-left', i === 0);\r\n                            cellComp.addOrRemoveCssClass('ag-selection-fill-right', i === colLen - 1);\r\n                        }\r\n\r\n                        cellComp.addOrRemoveCssClass(\r\n                            isMovingUp ? 'ag-selection-fill-top' : 'ag-selection-fill-bottom',\r\n                            _isSameRow(row, endPosition)\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (_isSameRow(row, endPosition)) {\r\n                break;\r\n            }\r\n        } while (\r\n            // tslint:disable-next-line\r\n            (row = isMovingUp ? cellNavigation!.getRowAbove(row) : cellNavigation!.getRowBelow(row))\r\n        );\r\n    }\r\n\r\n    private reduceVertical(initialPosition: CellPosition, endPosition: CellPosition) {\r\n        let row: RowPosition | null = initialPosition;\r\n        const beans = this.beans;\r\n        const cellNavigation = beans.cellNavigation!;\r\n\r\n        do {\r\n            const cellRange = this.cellRange;\r\n            const colLen = cellRange.columns.length;\r\n            const isLastRow = _isSameRow(row, endPosition);\r\n\r\n            for (let i = 0; i < colLen; i++) {\r\n                const rowPos = { rowIndex: row.rowIndex, rowPinned: row.rowPinned };\r\n                const celPos = { ...rowPos, column: cellRange.columns[i] };\r\n                const cell = _getCellByPosition(beans, celPos);\r\n\r\n                if (cell) {\r\n                    this.markedCells.push(cell);\r\n\r\n                    cell.comp.addOrRemoveCssClass('ag-selection-fill-bottom', _isSameRow(row, endPosition));\r\n                }\r\n            }\r\n            if (isLastRow) {\r\n                break;\r\n            }\r\n            // tslint:disable-next-line\r\n        } while ((row = cellNavigation.getRowAbove(row)));\r\n    }\r\n\r\n    private extendHorizontal(initialPosition: CellPosition, endPosition: CellPosition, isMovingLeft?: boolean) {\r\n        const beans = this.beans;\r\n        const { visibleCols, cellNavigation } = beans;\r\n        const allCols = visibleCols.allCols;\r\n        const startCol = allCols.indexOf((isMovingLeft ? endPosition.column : initialPosition.column) as AgColumn);\r\n        const endCol = allCols.indexOf((isMovingLeft ? this.cellRange.columns[0] : endPosition.column) as AgColumn);\r\n        const offset = isMovingLeft ? 0 : 1;\r\n\r\n        const colsToMark = allCols.slice(startCol + offset, endCol + offset);\r\n        const { rangeStartRow, rangeEndRow } = this;\r\n\r\n        colsToMark.forEach((column) => {\r\n            let row: RowPosition = rangeStartRow;\r\n            let isLastRow = false;\r\n\r\n            do {\r\n                isLastRow = _isSameRow(row, rangeEndRow);\r\n                const cell = _getCellByPosition(beans, {\r\n                    rowIndex: row.rowIndex,\r\n                    rowPinned: row.rowPinned,\r\n                    column: column,\r\n                });\r\n\r\n                if (cell) {\r\n                    this.markedCells.push(cell);\r\n                    const cellComp = cell.comp;\r\n\r\n                    cellComp.addOrRemoveCssClass('ag-selection-fill-top', _isSameRow(row, rangeStartRow));\r\n                    cellComp.addOrRemoveCssClass('ag-selection-fill-bottom', _isSameRow(row, rangeEndRow));\r\n                    if (isMovingLeft) {\r\n                        this.isLeft = true;\r\n                        cellComp.addOrRemoveCssClass('ag-selection-fill-left', column === colsToMark[0]);\r\n                    } else {\r\n                        cellComp.addOrRemoveCssClass('ag-selection-fill-right', column === _last(colsToMark));\r\n                    }\r\n                }\r\n\r\n                row = cellNavigation!.getRowBelow(row)!;\r\n            } while (!isLastRow);\r\n        });\r\n    }\r\n\r\n    private reduceHorizontal(initialPosition: CellPosition, endPosition: CellPosition) {\r\n        const beans = this.beans;\r\n        const { visibleCols, cellNavigation } = beans;\r\n        const allCols = visibleCols.allCols;\r\n        const startCol = allCols.indexOf(endPosition.column as AgColumn);\r\n        const endCol = allCols.indexOf(initialPosition.column as AgColumn);\r\n\r\n        const colsToMark = allCols.slice(startCol, endCol);\r\n        const { rangeStartRow, rangeEndRow } = this;\r\n\r\n        colsToMark.forEach((column) => {\r\n            let row: RowPosition = rangeStartRow;\r\n            let isLastRow: boolean = false;\r\n\r\n            do {\r\n                isLastRow = _isSameRow(row, rangeEndRow);\r\n                const cell = _getCellByPosition(this.beans, {\r\n                    rowIndex: row.rowIndex,\r\n                    rowPinned: row.rowPinned,\r\n                    column: column,\r\n                });\r\n\r\n                if (cell) {\r\n                    this.markedCells.push(cell);\r\n                    cell.comp.addOrRemoveCssClass('ag-selection-fill-right', column === colsToMark[0]);\r\n                }\r\n\r\n                row = cellNavigation!.getRowBelow(row)!;\r\n            } while (!isLastRow);\r\n        });\r\n    }\r\n\r\n    public override refresh(cellCtrl: CellCtrl) {\r\n        const cellRange = this.beans.rangeSvc!.getCellRanges()[0];\r\n        const isColumnRange = !cellRange.startRow || !cellRange.endRow;\r\n\r\n        if (isColumnRange) {\r\n            this.destroy();\r\n            return;\r\n        }\r\n\r\n        super.refresh(cellCtrl);\r\n    }\r\n}\r\n", "import type { CellCtrl, CellPosition, CellRange, RowPosition } from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    _areCellsEqual,\r\n    _getCellPositionForEvent,\r\n    _isRowBefore,\r\n    _isVisible,\r\n    _last,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport type { RangeService } from './rangeService';\r\n\r\nexport enum SelectionHandleType {\r\n    FILL,\r\n    RANGE,\r\n}\r\n\r\nexport abstract class AbstractSelectionHandle extends Component {\r\n    protected cellCtrl: CellCtrl;\r\n    protected cellRange: CellRange;\r\n\r\n    protected rangeStartRow: RowPosition;\r\n    protected rangeEndRow: RowPosition;\r\n\r\n    private cellHoverListener: (() => void) | undefined;\r\n    private lastCellHovered: CellPosition | null | undefined;\r\n    protected changedCalculatedValues: boolean = false;\r\n    private dragging: boolean = false;\r\n\r\n    protected abstract type: SelectionHandleType;\r\n    protected shouldDestroyOnEndDragging: boolean = false;\r\n\r\n    public postConstruct() {\r\n        const { dragSvc, rangeSvc } = this.beans;\r\n        dragSvc!.addDragSource({\r\n            dragStartPixels: 0,\r\n            eElement: this.getGui(),\r\n            onDragStart: this.onDragStart.bind(this),\r\n            onDragging: (e: MouseEvent | Touch) => {\r\n                this.dragging = true;\r\n                (rangeSvc as RangeService).autoScrollService.check(e as MouseEvent);\r\n\r\n                if (this.changedCalculatedValues) {\r\n                    this.onDrag(e);\r\n                    this.changedCalculatedValues = false;\r\n                }\r\n            },\r\n            onDragStop: (e: MouseEvent | Touch) => {\r\n                this.dragging = false;\r\n                this.onDragEnd(e);\r\n                this.clearDragProperties();\r\n\r\n                if (this.shouldDestroyOnEndDragging) {\r\n                    this.destroy();\r\n                }\r\n            },\r\n            onDragCancel: () => {\r\n                this.dragging = false;\r\n                this.onDragCancel();\r\n                this.clearDragProperties();\r\n            },\r\n        });\r\n\r\n        this.addManagedElementListeners(this.getGui(), { mousedown: this.preventRangeExtension.bind(this) });\r\n    }\r\n\r\n    protected abstract onDrag(e: MouseEvent | Touch): void;\r\n    protected abstract onDragEnd(e: MouseEvent | Touch): void;\r\n    protected abstract onDragCancel(): void;\r\n\r\n    protected getLastCellHovered(): CellPosition | null | undefined {\r\n        return this.lastCellHovered;\r\n    }\r\n\r\n    private preventRangeExtension(e: MouseEvent) {\r\n        e.stopPropagation();\r\n    }\r\n\r\n    protected onDragStart(_: MouseEvent) {\r\n        [this.cellHoverListener] = this.addManagedElementListeners(this.beans.ctrlsSvc.get('gridCtrl').getGui(), {\r\n            mousemove: this.updateValuesOnMove.bind(this),\r\n        });\r\n\r\n        document.body.classList.add(this.getDraggingCssClass());\r\n    }\r\n\r\n    private getDraggingCssClass(): string {\r\n        return `ag-dragging-${this.type === SelectionHandleType.FILL ? 'fill' : 'range'}-handle`;\r\n    }\r\n\r\n    protected updateValuesOnMove(e: MouseEvent) {\r\n        const cell = _getCellPositionForEvent(this.gos, e);\r\n\r\n        if (!cell || (this.lastCellHovered && _areCellsEqual(cell, this.lastCellHovered))) {\r\n            return;\r\n        }\r\n\r\n        this.lastCellHovered = cell;\r\n        this.changedCalculatedValues = true;\r\n    }\r\n\r\n    private clearDragProperties(): void {\r\n        this.clearValues();\r\n        (this.beans.rangeSvc as RangeService).autoScrollService.ensureCleared();\r\n\r\n        // TODO: this causes a bug where if there are multiple grids in the same page, all of them will\r\n        // be affected by a drag on any. Move it to the root element.\r\n        document.body.classList.remove(this.getDraggingCssClass());\r\n    }\r\n\r\n    public getType(): SelectionHandleType {\r\n        return this.type;\r\n    }\r\n\r\n    public refresh(cellCtrl: CellCtrl) {\r\n        const oldCellComp = this.cellCtrl;\r\n        const eGui = this.getGui();\r\n\r\n        const cellRange = _last(this.beans.rangeSvc!.getCellRanges());\r\n\r\n        const start = cellRange.startRow;\r\n        const end = cellRange.endRow;\r\n\r\n        if (start && end) {\r\n            const isBefore = _isRowBefore(end, start);\r\n\r\n            if (isBefore) {\r\n                this.rangeStartRow = end;\r\n                this.rangeEndRow = start;\r\n            } else {\r\n                this.rangeStartRow = start;\r\n                this.rangeEndRow = end;\r\n            }\r\n        }\r\n\r\n        if (oldCellComp !== cellCtrl || !_isVisible(eGui)) {\r\n            this.cellCtrl = cellCtrl;\r\n            const eParentOfValue = cellCtrl.comp.getParentOfValue();\r\n            if (eParentOfValue) {\r\n                eParentOfValue.appendChild(eGui);\r\n            }\r\n        }\r\n\r\n        this.cellRange = cellRange;\r\n    }\r\n\r\n    protected clearValues() {\r\n        this.lastCellHovered = undefined;\r\n        this.removeListeners();\r\n    }\r\n\r\n    private removeListeners() {\r\n        const cellHoverListener = this.cellHoverListener;\r\n        if (cellHoverListener) {\r\n            cellHoverListener();\r\n            this.cellHoverListener = undefined;\r\n        }\r\n    }\r\n\r\n    public override destroy() {\r\n        if (!this.shouldDestroyOnEndDragging && this.dragging) {\r\n            _setDisplayed(this.getGui(), false);\r\n            this.shouldDestroyOnEndDragging = true;\r\n            return;\r\n        }\r\n\r\n        this.shouldDestroyOnEndDragging = false;\r\n\r\n        super.destroy();\r\n        this.removeListeners();\r\n\r\n        const eGui = this.getGui();\r\n\r\n        eGui.parentElement?.removeChild(eGui);\r\n    }\r\n}\r\n", "export function findLineByLeastSquares(values: number[]) {\r\n    const len = values.length;\r\n    let maxDecimals = 0;\r\n\r\n    if (len <= 1) {\r\n        return values;\r\n    }\r\n\r\n    for (let i = 0; i < values.length; i++) {\r\n        const value = values[i];\r\n        const splitExponent = value.toString().split('e-');\r\n\r\n        if (splitExponent.length > 1) {\r\n            maxDecimals = Math.max(maxDecimals, parseInt(splitExponent[1], 10));\r\n            continue;\r\n        }\r\n\r\n        if (Math.floor(value) === value) {\r\n            continue;\r\n        }\r\n\r\n        maxDecimals = Math.max(maxDecimals, value.toString().split('.')[1].length);\r\n    }\r\n\r\n    let sum_x = 0;\r\n    let sum_y = 0;\r\n    let sum_xy = 0;\r\n    let sum_xx = 0;\r\n\r\n    let y = 0;\r\n\r\n    for (let x = 0; x < len; x++) {\r\n        y = values[x];\r\n        sum_x += x;\r\n        sum_y += y;\r\n        sum_xx += x * x;\r\n        sum_xy += x * y;\r\n    }\r\n\r\n    const m = (len * sum_xy - sum_x * sum_y) / (len * sum_xx - sum_x * sum_x);\r\n    const b = sum_y / len - (m * sum_x) / len;\r\n\r\n    const result: number[] = [];\r\n\r\n    for (let x = 0; x <= len; x++) {\r\n        result.push(parseFloat((x * m + b).toFixed(maxDecimals)));\r\n    }\r\n\r\n    return result;\r\n}\r\n", "import type { CellPosition, CellRange } from 'ag-grid-community';\r\nimport { CellRangeType, _isSameRow, _last } from 'ag-grid-community';\r\n\r\nimport { AbstractSelectionHandle, SelectionHandleType } from './abstractSelectionHandle';\r\n\r\nexport class AgRangeHandle extends AbstractSelectionHandle {\r\n    protected type = SelectionHandleType.RANGE;\r\n    private endPosition: CellPosition;\r\n    private rangeFixed: boolean = false;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-range-handle\"></div>`);\r\n    }\r\n\r\n    protected onDrag(_: MouseEvent) {\r\n        const lastCellHovered = this.getLastCellHovered();\r\n\r\n        if (!lastCellHovered) {\r\n            return;\r\n        }\r\n\r\n        const rangeSvc = this.beans.rangeSvc!;\r\n        const cellRanges = rangeSvc.getCellRanges();\r\n        const lastRange = _last(cellRanges);\r\n\r\n        if (!this.rangeFixed) {\r\n            this.fixRangeStartEnd(lastRange);\r\n            this.rangeFixed = true;\r\n        }\r\n\r\n        this.endPosition = {\r\n            rowIndex: lastCellHovered.rowIndex,\r\n            rowPinned: lastCellHovered.rowPinned,\r\n            column: lastCellHovered.column,\r\n        };\r\n\r\n        // check if the cell ranges are for a chart\r\n        if (\r\n            cellRanges.length === 2 &&\r\n            cellRanges[0].type === CellRangeType.DIMENSION &&\r\n            lastRange.type === CellRangeType.VALUE\r\n        ) {\r\n            const rowChanged = !_isSameRow(this.endPosition, rangeSvc.getRangeEndRow(lastRange));\r\n\r\n            if (rowChanged) {\r\n                // ensure the dimension range is kept in sync with the value range (which has the handle)\r\n                rangeSvc.updateRangeEnd(\r\n                    cellRanges[0],\r\n                    {\r\n                        ...this.endPosition,\r\n                        column: cellRanges[0].columns[0],\r\n                    },\r\n                    true\r\n                );\r\n            }\r\n        }\r\n\r\n        rangeSvc.extendLatestRangeToCell(this.endPosition);\r\n    }\r\n\r\n    protected onDragEnd(_: MouseEvent) {\r\n        const cellRange = _last(this.beans.rangeSvc!.getCellRanges())!;\r\n\r\n        this.fixRangeStartEnd(cellRange);\r\n        this.rangeFixed = false;\r\n    }\r\n\r\n    protected onDragCancel(): void {\r\n        this.rangeFixed = false;\r\n    }\r\n\r\n    private fixRangeStartEnd(cellRange: CellRange): void {\r\n        const rangeSvc = this.beans.rangeSvc!;\r\n        const startRow = rangeSvc.getRangeStartRow(cellRange);\r\n        const endRow = rangeSvc.getRangeEndRow(cellRange);\r\n        const column = cellRange.columns[0];\r\n\r\n        cellRange.startRow = startRow;\r\n        cellRange.endRow = endRow;\r\n        cellRange.startColumn = column;\r\n    }\r\n}\r\n", "export const rangeSelectionCSS = /*css*/ `.ag-body-viewport:not(.ag-has-focus) .ag-cell-range-single-cell:not(.ag-cell-inline-editing),.ag-cell-range-selected.ag-cell-range-chart,.ag-cell-range-selected:not(.ag-cell-focus){background-color:var(--ag-range-selection-background-color);&.ag-cell-range-chart{background-color:var(--ag-range-selection-chart-background-color)!important;&.ag-cell-range-chart-category{background-color:var(--ag-range-selection-chart-category-background-color)!important}}}.ag-cell-range-selected-1.ag-cell-range-chart,.ag-cell-range-selected-1:not(.ag-cell-focus),.ag-root:not(.ag-context-menu-open) .ag-body-viewport:not(.ag-has-focus) .ag-cell-range-selected-1:not(.ag-cell-inline-editing){background-color:var(--ag-range-selection-background-color)}.ag-cell-range-selected-2.ag-cell-range-chart,.ag-cell-range-selected-2:not(.ag-cell-focus){background-image:linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color))}.ag-cell-range-selected-3.ag-cell-range-chart,.ag-cell-range-selected-3:not(.ag-cell-focus){background-image:linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color)),linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color))}.ag-cell-range-selected-4.ag-cell-range-chart,.ag-cell-range-selected-4:not(.ag-cell-focus){background-image:linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color)),linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color)),linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color))}.ag-cell.ag-cell-range-selected:not(.ag-cell-range-single-cell){&.ag-cell-range-top{border-top-color:var(--ag-range-selection-border-color);border-top-style:var(--ag-range-selection-border-style)}&.ag-cell-range-right{border-right-color:var(--ag-range-selection-border-color);border-right-style:var(--ag-range-selection-border-style)}&.ag-cell-range-bottom{border-bottom-color:var(--ag-range-selection-border-color);border-bottom-style:var(--ag-range-selection-border-style)}&.ag-cell-range-left{border-left-color:var(--ag-range-selection-border-color);border-left-style:var(--ag-range-selection-border-style)}}.ag-cell.ag-selection-fill-top,.ag-cell.ag-selection-fill-top.ag-cell-range-selected{border-top:1px dashed;border-top-color:var(--ag-range-selection-border-color)}:where(.ag-ltr) .ag-cell.ag-selection-fill-right,:where(.ag-ltr) .ag-cell.ag-selection-fill-right.ag-cell-range-selected{border-right:1px dashed var(--ag-range-selection-border-color)!important}:where(.ag-rtl) .ag-cell.ag-selection-fill-right,:where(.ag-rtl) .ag-cell.ag-selection-fill-right.ag-cell-range-selected{border-left:1px dashed var(--ag-range-selection-border-color)!important}.ag-cell.ag-selection-fill-bottom,.ag-cell.ag-selection-fill-bottom.ag-cell-range-selected{border-bottom:1px dashed;border-bottom-color:var(--ag-range-selection-border-color)}:where(.ag-ltr) .ag-cell.ag-selection-fill-left,:where(.ag-ltr) .ag-cell.ag-selection-fill-left.ag-cell-range-selected{border-left:1px dashed var(--ag-range-selection-border-color)!important}:where(.ag-rtl) .ag-cell.ag-selection-fill-left,:where(.ag-rtl) .ag-cell.ag-selection-fill-left.ag-cell-range-selected{border-right:1px dashed var(--ag-range-selection-border-color)!important}.ag-fill-handle,.ag-range-handle{background-color:var(--ag-range-selection-border-color);bottom:-1px;height:6px;position:absolute;width:6px}:where(.ag-ltr) .ag-fill-handle,:where(.ag-ltr) .ag-range-handle{right:-1px}:where(.ag-rtl) .ag-fill-handle,:where(.ag-rtl) .ag-range-handle{left:-1px}.ag-fill-handle{cursor:cell}:where(.ag-ltr) .ag-range-handle{cursor:nwse-resize}:where(.ag-rtl) .ag-range-handle{cursor:nesw-resize}`;\n", "import type { BeanCollection, CellRange, CellRangeParams } from 'ag-grid-community';\r\n\r\nexport function getCellRanges(beans: BeanCollection): CellRange[] | null {\r\n    return beans.rangeSvc?.getCellRanges() ?? null;\r\n}\r\n\r\nexport function addCellRange(beans: BeanCollection, params: CellRangeParams): void {\r\n    beans.rangeSvc?.addCellRange(params);\r\n}\r\n\r\nexport function clearRangeSelection(beans: BeanCollection): void {\r\n    beans.rangeSvc?.removeAllCellRanges();\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    CellCtrl,\r\n    CellNavigationService,\r\n    CellPosition,\r\n    CellRange,\r\n    CellRangeParams,\r\n    ClearCellRangeParams,\r\n    ColumnModel,\r\n    CtrlsService,\r\n    DragService,\r\n    GridOptionsService,\r\n    ICellRangeFeature,\r\n    IRangeService,\r\n    IRowModel,\r\n    NamedBean,\r\n    PartialCellRange,\r\n    PinnedRowModel,\r\n    RowPinnedType,\r\n    RowPosition,\r\n    VisibleColsService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AutoScrollService,\r\n    BeanStub,\r\n    _areCellsEqual,\r\n    _areEqual,\r\n    _exists,\r\n    _getCellCtrlForEventTarget,\r\n    _getRowNode,\r\n    _getSuppressMultiRanges,\r\n    _isCellSelectionEnabled,\r\n    _isDomLayout,\r\n    _isRowBefore,\r\n    _isSameRow,\r\n    _isUsingNewCellSelectionAPI,\r\n    _last,\r\n    _makeNull,\r\n    _missing,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { CellRangeFeature } from './cellRangeFeature';\r\nimport { DragListenerFeature } from './dragListenerFeature';\r\n\r\nexport class RangeService extends BeanStub implements NamedBean, IRangeService {\r\n    beanName = 'rangeSvc' as const;\r\n\r\n    private rowModel: IRowModel;\r\n    private dragSvc: DragService;\r\n    private colModel: ColumnModel;\r\n    private visibleCols: VisibleColsService;\r\n    private cellNavigation: CellNavigationService;\r\n    private pinnedRowModel?: PinnedRowModel;\r\n    private ctrlsSvc: CtrlsService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.rowModel = beans.rowModel;\r\n        this.dragSvc = beans.dragSvc!;\r\n        this.colModel = beans.colModel;\r\n        this.visibleCols = beans.visibleCols;\r\n        this.cellNavigation = beans.cellNavigation!;\r\n        this.pinnedRowModel = beans.pinnedRowModel;\r\n        this.ctrlsSvc = beans.ctrlsSvc;\r\n    }\r\n\r\n    private cellRanges: CellRange[] = [];\r\n    private lastMouseEvent: MouseEvent | null;\r\n    private bodyScrollListener = this.onBodyScroll.bind(this);\r\n\r\n    private lastCellHovered: CellPosition | undefined;\r\n    private cellHasChanged: boolean;\r\n\r\n    // when a range is created, we mark the 'start cell' for further processing as follows:\r\n    // 1) if dragging, then the new range is extended from the start position\r\n    // 2) if user hits 'shift' click on a cell, the previous range is extended from the start position\r\n    private newestRangeStartCell?: CellPosition;\r\n\r\n    private dragging = false;\r\n    private draggingRange?: CellRange;\r\n\r\n    private intersectionRange = false; // When dragging ends, the current range will be used to intersect all other ranges\r\n\r\n    public autoScrollService: AutoScrollService;\r\n\r\n    public postConstruct(): void {\r\n        const onColumnsChanged = this.onColumnsChanged.bind(this);\r\n        const removeAllCellRanges = () => this.removeAllCellRanges();\r\n        const refreshLastRangeStart = this.refreshLastRangeStart.bind(this);\r\n        this.addManagedEventListeners({\r\n            newColumnsLoaded: onColumnsChanged,\r\n            columnVisible: onColumnsChanged,\r\n            columnValueChanged: onColumnsChanged,\r\n            columnPivotModeChanged: removeAllCellRanges,\r\n            columnRowGroupChanged: removeAllCellRanges,\r\n            columnPivotChanged: removeAllCellRanges,\r\n            columnGroupOpened: refreshLastRangeStart,\r\n            columnMoved: refreshLastRangeStart,\r\n            columnPinned: refreshLastRangeStart,\r\n        });\r\n\r\n        this.ctrlsSvc.whenReady(this, (p) => {\r\n            const gridBodyCtrl = p.gridBodyCtrl;\r\n            this.autoScrollService = new AutoScrollService({\r\n                scrollContainer: gridBodyCtrl.eBodyViewport!,\r\n                scrollAxis: 'xy',\r\n                getVerticalPosition: () => gridBodyCtrl.scrollFeature.getVScrollPosition().top,\r\n                setVerticalPosition: (position) => gridBodyCtrl.scrollFeature.setVerticalScrollPosition(position),\r\n                getHorizontalPosition: () => gridBodyCtrl.scrollFeature.getHScrollPosition().left,\r\n                setHorizontalPosition: (position) => gridBodyCtrl.scrollFeature.setHorizontalScrollPosition(position),\r\n                shouldSkipVerticalScroll: () => !_isDomLayout(this.gos, 'normal'),\r\n                shouldSkipHorizontalScroll: () => !gridBodyCtrl.scrollFeature.isHorizontalScrollShowing(),\r\n            });\r\n        });\r\n    }\r\n\r\n    // Called for both columns loaded & column visibility events\r\n    public onColumnsChanged(): void {\r\n        // first move start column in last cell range (i.e. series chart range)\r\n        this.refreshLastRangeStart();\r\n\r\n        const allColumns = this.visibleCols.allCols;\r\n\r\n        // check that the columns in each range still exist and are visible\r\n        this.cellRanges.forEach((cellRange) => {\r\n            const beforeCols = cellRange.columns;\r\n\r\n            // remove hidden or removed cols from cell range\r\n            cellRange.columns = cellRange.columns.filter(\r\n                (col: AgColumn) => col.isVisible() && allColumns.indexOf(col) !== -1\r\n            );\r\n\r\n            const colsInRangeChanged = !_areEqual(beforeCols, cellRange.columns);\r\n\r\n            if (colsInRangeChanged) {\r\n                // notify users and other parts of grid (i.e. status panel) that range has changed\r\n                this.dispatchChangedEvent(false, true, cellRange.id);\r\n            }\r\n        });\r\n        // Remove empty cell ranges\r\n        const countBefore = this.cellRanges.length;\r\n        this.cellRanges = this.cellRanges.filter((range) => range.columns.length > 0);\r\n        if (countBefore > this.cellRanges.length) {\r\n            this.dispatchChangedEvent(false, true);\r\n        }\r\n    }\r\n\r\n    public refreshLastRangeStart(): void {\r\n        const lastRange = _last(this.cellRanges);\r\n\r\n        if (!lastRange) {\r\n            return;\r\n        }\r\n\r\n        this.refreshRangeStart(lastRange);\r\n    }\r\n\r\n    public isContiguousRange(cellRange: CellRange): boolean {\r\n        const rangeColumns = cellRange.columns as AgColumn[];\r\n\r\n        if (!rangeColumns.length) {\r\n            return false;\r\n        }\r\n\r\n        const allColumns = this.visibleCols.allCols;\r\n        const allPositions = rangeColumns.map((c) => allColumns.indexOf(c)).sort((a, b) => a - b);\r\n\r\n        return _last(allPositions) - allPositions[0] + 1 === rangeColumns.length;\r\n    }\r\n\r\n    public getRangeStartRow(cellRange: PartialCellRange): RowPosition {\r\n        if (cellRange.startRow && cellRange.endRow) {\r\n            return _isRowBefore(cellRange.startRow, cellRange.endRow) ? cellRange.startRow : cellRange.endRow;\r\n        }\r\n\r\n        const pinnedTopRowCount = this.pinnedRowModel?.getPinnedTopRowCount() ?? 0;\r\n        const rowPinned = pinnedTopRowCount > 0 ? 'top' : null;\r\n\r\n        return { rowIndex: 0, rowPinned };\r\n    }\r\n\r\n    public getRangeEndRow(cellRange: PartialCellRange): RowPosition {\r\n        if (cellRange.startRow && cellRange.endRow) {\r\n            return _isRowBefore(cellRange.startRow, cellRange.endRow) ? cellRange.endRow : cellRange.startRow;\r\n        }\r\n\r\n        const pinnedBottomRowCount = this.pinnedRowModel?.getPinnedBottomRowCount() ?? 0;\r\n        const pinnedBottom = pinnedBottomRowCount > 0;\r\n\r\n        if (pinnedBottom) {\r\n            return {\r\n                rowIndex: pinnedBottomRowCount - 1,\r\n                rowPinned: 'bottom',\r\n            };\r\n        }\r\n\r\n        return {\r\n            rowIndex: this.rowModel.getRowCount() - 1,\r\n            rowPinned: null,\r\n        };\r\n    }\r\n\r\n    public setRangeToCell(cell: CellPosition, appendRange = false): void {\r\n        if (!_isCellSelectionEnabled(this.gos)) {\r\n            return;\r\n        }\r\n\r\n        const columns = this.calculateColumnsBetween(cell.column as AgColumn, cell.column as AgColumn);\r\n\r\n        if (!columns) {\r\n            return;\r\n        }\r\n\r\n        const suppressMultiRangeSelections = _getSuppressMultiRanges(this.gos);\r\n\r\n        // if not appending, then clear previous range selections\r\n        if (suppressMultiRangeSelections || !appendRange || _missing(this.cellRanges)) {\r\n            this.removeAllCellRanges(true);\r\n        }\r\n\r\n        const rowForCell: RowPosition = {\r\n            rowIndex: cell.rowIndex,\r\n            rowPinned: cell.rowPinned,\r\n        };\r\n\r\n        const cellRange = {\r\n            startRow: rowForCell,\r\n            endRow: rowForCell,\r\n            columns,\r\n            startColumn: cell.column,\r\n        };\r\n\r\n        this.cellRanges.push(cellRange);\r\n\r\n        this.setNewestRangeStartCell(cell);\r\n        this.onDragStop();\r\n        this.dispatchChangedEvent(true, true);\r\n    }\r\n\r\n    public extendLatestRangeToCell(cellPosition: CellPosition): void {\r\n        if (this.isEmpty() || !this.newestRangeStartCell) {\r\n            return;\r\n        }\r\n\r\n        const cellRange = _last(this.cellRanges);\r\n\r\n        this.updateRangeEnd(cellRange, cellPosition);\r\n    }\r\n\r\n    public updateRangeEnd(cellRange: CellRange, cellPosition: CellPosition, silent = false): void {\r\n        const endColumn = cellPosition.column as AgColumn;\r\n        const colsToAdd = this.calculateColumnsBetween(cellRange.startColumn as AgColumn, endColumn);\r\n\r\n        if (!colsToAdd || this.isLastCellOfRange(cellRange, cellPosition)) {\r\n            return;\r\n        }\r\n\r\n        cellRange.columns = colsToAdd;\r\n        cellRange.endRow = { rowIndex: cellPosition.rowIndex, rowPinned: cellPosition.rowPinned };\r\n\r\n        if (!silent) {\r\n            this.dispatchChangedEvent(true, true, cellRange.id);\r\n        }\r\n    }\r\n\r\n    private refreshRangeStart(cellRange: CellRange) {\r\n        const { startColumn, columns } = cellRange;\r\n\r\n        const moveColInCellRange = (colToMove: AgColumn, moveToFront: boolean) => {\r\n            const otherCols = cellRange.columns.filter((col) => col !== colToMove);\r\n\r\n            if (colToMove) {\r\n                cellRange.startColumn = colToMove;\r\n                cellRange.columns = moveToFront ? [colToMove, ...otherCols] : [...otherCols, colToMove];\r\n            } else {\r\n                cellRange.columns = otherCols;\r\n            }\r\n        };\r\n\r\n        const { left, right } = this.getRangeEdgeColumns(cellRange);\r\n        const shouldMoveLeftCol = startColumn === columns[0] && startColumn !== left;\r\n\r\n        if (shouldMoveLeftCol) {\r\n            moveColInCellRange(left, true);\r\n            return;\r\n        }\r\n\r\n        const shouldMoveRightCol = startColumn === _last(columns) && startColumn === right;\r\n\r\n        if (shouldMoveRightCol) {\r\n            moveColInCellRange(right, false);\r\n            return;\r\n        }\r\n    }\r\n\r\n    public getRangeEdgeColumns(cellRange: CellRange): { left: AgColumn; right: AgColumn } {\r\n        const allColumns = this.visibleCols.allCols;\r\n        const allIndices = cellRange.columns\r\n            .map((c: AgColumn) => allColumns.indexOf(c))\r\n            .filter((i) => i > -1)\r\n            .sort((a, b) => a - b);\r\n\r\n        return {\r\n            left: allColumns[allIndices[0]],\r\n            right: allColumns[_last(allIndices)!],\r\n        };\r\n    }\r\n\r\n    // returns true if successful, false if not successful\r\n    public extendLatestRangeInDirection(event: KeyboardEvent): CellPosition | undefined {\r\n        if (this.isEmpty() || !this.newestRangeStartCell) {\r\n            return;\r\n        }\r\n\r\n        const key = event.key;\r\n        const ctrlKey = event.ctrlKey || event.metaKey;\r\n\r\n        const lastRange = _last(this.cellRanges)!;\r\n        const startCell = this.newestRangeStartCell;\r\n        const firstCol = lastRange.columns[0];\r\n        const lastCol = _last(lastRange.columns)!;\r\n\r\n        // find the cell that is at the furthest away corner from the starting cell\r\n        const endCellIndex = lastRange.endRow!.rowIndex;\r\n        const endCellFloating = lastRange.endRow!.rowPinned;\r\n        const endCellColumn = startCell.column === firstCol ? lastCol : firstCol;\r\n\r\n        const endCell: CellPosition = { column: endCellColumn, rowIndex: endCellIndex, rowPinned: endCellFloating };\r\n        const newEndCell = this.cellNavigation.getNextCellToFocus(key, endCell, ctrlKey);\r\n\r\n        // if user is at end of grid, so no cell to extend to, we return false\r\n        if (!newEndCell) {\r\n            return;\r\n        }\r\n\r\n        this.setCellRange({\r\n            rowStartIndex: startCell.rowIndex,\r\n            rowStartPinned: startCell.rowPinned,\r\n            rowEndIndex: newEndCell.rowIndex,\r\n            rowEndPinned: newEndCell.rowPinned,\r\n            columnStart: startCell.column,\r\n            columnEnd: newEndCell.column,\r\n        });\r\n\r\n        return newEndCell;\r\n    }\r\n\r\n    public setCellRange(params: CellRangeParams): void {\r\n        if (!_isCellSelectionEnabled(this.gos)) {\r\n            return;\r\n        }\r\n\r\n        this.removeAllCellRanges(true);\r\n        this.addCellRange(params);\r\n    }\r\n\r\n    public setCellRanges(cellRanges: CellRange[]): void {\r\n        if (_areEqual(this.cellRanges, cellRanges)) {\r\n            return;\r\n        }\r\n\r\n        if (!this.verifyCellRanges(this.gos)) {\r\n            return;\r\n        }\r\n\r\n        this.removeAllCellRanges(true);\r\n\r\n        cellRanges.forEach((newRange) => {\r\n            if (newRange.columns && newRange.startRow) {\r\n                this.setNewestRangeStartCell({\r\n                    rowIndex: newRange.startRow.rowIndex,\r\n                    rowPinned: newRange.startRow.rowPinned,\r\n                    column: newRange.columns[0],\r\n                });\r\n            }\r\n\r\n            this.cellRanges.push(newRange);\r\n        });\r\n\r\n        this.dispatchChangedEvent(false, true);\r\n    }\r\n\r\n    private setNewestRangeStartCell(position: CellPosition) {\r\n        this.newestRangeStartCell = position;\r\n    }\r\n\r\n    public clearCellRangeCellValues(params: ClearCellRangeParams): void {\r\n        let { cellRanges } = params;\r\n        const { cellEventSource = 'rangeSvc', dispatchWrapperEvents, wrapperEventSource = 'deleteKey' } = params;\r\n\r\n        if (dispatchWrapperEvents) {\r\n            this.eventSvc.dispatchEvent({\r\n                type: 'cellSelectionDeleteStart',\r\n                source: wrapperEventSource,\r\n            });\r\n            this.eventSvc.dispatchEvent({\r\n                type: 'rangeDeleteStart',\r\n                source: wrapperEventSource,\r\n            });\r\n        }\r\n\r\n        if (!cellRanges) {\r\n            cellRanges = this.cellRanges;\r\n        }\r\n\r\n        cellRanges.forEach((cellRange) => {\r\n            this.forEachRowInRange(cellRange, (rowPosition) => {\r\n                const rowNode = _getRowNode(this.beans, rowPosition);\r\n                if (!rowNode) {\r\n                    return;\r\n                }\r\n                for (let i = 0; i < cellRange.columns.length; i++) {\r\n                    const column = this.colModel.getCol(cellRange.columns[i]);\r\n                    if (!column || !column.isCellEditable(rowNode)) {\r\n                        continue;\r\n                    }\r\n                    const emptyValue = this.beans.valueSvc.getDeleteValue(column, rowNode);\r\n                    rowNode.setDataValue(column, emptyValue, cellEventSource);\r\n                }\r\n            });\r\n        });\r\n\r\n        if (dispatchWrapperEvents) {\r\n            this.eventSvc.dispatchEvent({\r\n                type: 'cellSelectionDeleteEnd',\r\n                source: wrapperEventSource,\r\n            });\r\n            this.eventSvc.dispatchEvent({\r\n                type: 'rangeDeleteEnd',\r\n                source: wrapperEventSource,\r\n            });\r\n        }\r\n    }\r\n\r\n    public createCellRangeFromCellRangeParams(params: CellRangeParams): CellRange | undefined {\r\n        return this.createPartialCellRangeFromRangeParams(params, false) as CellRange | undefined;\r\n    }\r\n\r\n    // Range service can't normally support a range without columns, but charts can\r\n    public createPartialCellRangeFromRangeParams(\r\n        params: CellRangeParams,\r\n        allowEmptyColumns: boolean\r\n    ): PartialCellRange | undefined {\r\n        let columns: AgColumn[] | undefined;\r\n        let startsOnTheRight: boolean = false;\r\n\r\n        if (params.columns) {\r\n            columns = params.columns.map((c) => this.colModel.getCol(c)!).filter((c) => c);\r\n        } else {\r\n            const columnStart = this.colModel.getCol(params.columnStart);\r\n            const columnEnd = this.colModel.getCol(params.columnEnd);\r\n\r\n            if (!columnStart || !columnEnd) {\r\n                return;\r\n            }\r\n\r\n            columns = this.calculateColumnsBetween(columnStart, columnEnd);\r\n\r\n            if (columns && columns.length) {\r\n                startsOnTheRight = columns[0] !== columnStart;\r\n            }\r\n        }\r\n\r\n        if (!columns || (!allowEmptyColumns && columns.length === 0)) {\r\n            return;\r\n        }\r\n\r\n        const startRow =\r\n            params.rowStartIndex != null\r\n                ? {\r\n                      rowIndex: params.rowStartIndex,\r\n                      rowPinned: params.rowStartPinned || null,\r\n                  }\r\n                : undefined;\r\n\r\n        const endRow =\r\n            params.rowEndIndex != null\r\n                ? {\r\n                      rowIndex: params.rowEndIndex,\r\n                      rowPinned: params.rowEndPinned || null,\r\n                  }\r\n                : undefined;\r\n\r\n        return {\r\n            startRow,\r\n            endRow,\r\n            columns,\r\n            startColumn: startsOnTheRight ? _last(columns) : columns[0],\r\n        };\r\n    }\r\n\r\n    private verifyCellRanges(gos: GridOptionsService): boolean {\r\n        const invalid = _isUsingNewCellSelectionAPI(gos) && _getSuppressMultiRanges(gos) && this.cellRanges.length > 0;\r\n        if (invalid) {\r\n            _warn(93);\r\n        }\r\n\r\n        return !invalid;\r\n    }\r\n\r\n    public addCellRange(params: CellRangeParams): void {\r\n        const gos = this.gos;\r\n        if (!_isCellSelectionEnabled(gos) || !this.verifyCellRanges(gos)) {\r\n            return;\r\n        }\r\n\r\n        const newRange = this.createCellRangeFromCellRangeParams(params);\r\n\r\n        if (newRange) {\r\n            if (newRange.startRow) {\r\n                this.setNewestRangeStartCell({\r\n                    rowIndex: newRange.startRow.rowIndex,\r\n                    rowPinned: newRange.startRow.rowPinned,\r\n                    column: newRange.startColumn,\r\n                });\r\n            }\r\n\r\n            this.cellRanges.push(newRange);\r\n            this.dispatchChangedEvent(false, true, newRange.id);\r\n        }\r\n    }\r\n\r\n    public getCellRanges(): CellRange[] {\r\n        return this.cellRanges;\r\n    }\r\n\r\n    public isEmpty(): boolean {\r\n        return this.cellRanges.length === 0;\r\n    }\r\n\r\n    public isMoreThanOneCell(): boolean {\r\n        const len = this.cellRanges.length;\r\n\r\n        if (len === 0) {\r\n            return false;\r\n        }\r\n        if (len > 1) {\r\n            return true; // Assumes a cell range must contain at least one cell\r\n        }\r\n\r\n        // only one range, return true if range has more than one\r\n        const range = this.cellRanges[0];\r\n        const startRow = this.getRangeStartRow(range);\r\n        const endRow = this.getRangeEndRow(range);\r\n\r\n        return (\r\n            startRow.rowPinned !== endRow.rowPinned ||\r\n            startRow.rowIndex !== endRow.rowIndex ||\r\n            range.columns.length !== 1\r\n        );\r\n    }\r\n\r\n    public areAllRangesAbleToMerge(): boolean {\r\n        const rowToColumnMap: Map<string, string[]> = new Map();\r\n        const len = this.cellRanges.length;\r\n\r\n        if (len <= 1) return true;\r\n\r\n        this.cellRanges.forEach((range) => {\r\n            this.forEachRowInRange(range, (row) => {\r\n                const rowName = `${row.rowPinned || 'normal'}_${row.rowIndex}`;\r\n                const columns = rowToColumnMap.get(rowName);\r\n                const currentRangeColIds = range.columns.map((col) => col.getId());\r\n                if (columns) {\r\n                    const filteredColumns = currentRangeColIds.filter((col) => columns.indexOf(col) === -1);\r\n                    columns.push(...filteredColumns);\r\n                } else {\r\n                    rowToColumnMap.set(rowName, currentRangeColIds);\r\n                }\r\n            });\r\n        });\r\n\r\n        let columnsString: string | undefined;\r\n\r\n        for (const val of rowToColumnMap.values()) {\r\n            const currentValString = val.sort().join();\r\n            if (columnsString === undefined) {\r\n                columnsString = currentValString;\r\n                continue;\r\n            }\r\n            if (columnsString !== currentValString) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private forEachRowInRange(cellRange: CellRange, callback: (row: RowPosition) => void) {\r\n        const topRow = this.getRangeStartRow(cellRange);\r\n        const bottomRow = this.getRangeEndRow(cellRange);\r\n        let currentRow: RowPosition | null = topRow;\r\n\r\n        while (currentRow) {\r\n            callback(currentRow);\r\n\r\n            if (_isSameRow(currentRow, bottomRow)) {\r\n                break;\r\n            }\r\n            currentRow = this.cellNavigation.getRowBelow(currentRow);\r\n        }\r\n    }\r\n\r\n    public removeAllCellRanges(silent?: boolean): void {\r\n        if (this.isEmpty()) {\r\n            return;\r\n        }\r\n\r\n        this.onDragStop();\r\n        this.cellRanges.length = 0;\r\n\r\n        if (!silent) {\r\n            this.dispatchChangedEvent(false, true);\r\n        }\r\n    }\r\n\r\n    // as the user is dragging outside of the panel, the div starts to scroll, which in turn\r\n    // means we are selection more (or less) cells, but the mouse isn't moving, so we recalculate\r\n    // the selection my mimicking a new mouse event\r\n    private onBodyScroll(): void {\r\n        if (this.dragging && this.lastMouseEvent) {\r\n            this.onDragging(this.lastMouseEvent);\r\n        }\r\n    }\r\n\r\n    public isCellInAnyRange(cell: CellPosition): boolean {\r\n        return this.getCellRangeCount(cell) > 0;\r\n    }\r\n\r\n    public isCellInSpecificRange(cell: CellPosition, range: CellRange): boolean {\r\n        const columnInRange = range.columns !== null && range.columns.includes(cell.column);\r\n        const rowInRange = this.isRowInRange(cell.rowIndex, cell.rowPinned, range);\r\n\r\n        return columnInRange && rowInRange;\r\n    }\r\n\r\n    private isLastCellOfRange(cellRange: CellRange, cell: CellPosition): boolean {\r\n        const { startRow, endRow } = cellRange;\r\n        const lastRow = _isRowBefore(startRow!, endRow!) ? endRow : startRow;\r\n        const isLastRow = cell.rowIndex === lastRow!.rowIndex && cell.rowPinned === lastRow!.rowPinned;\r\n        const rangeFirstIndexColumn = cellRange.columns[0];\r\n        const rangeLastIndexColumn = _last(cellRange.columns);\r\n        const lastRangeColumn =\r\n            cellRange.startColumn === rangeFirstIndexColumn ? rangeLastIndexColumn : rangeFirstIndexColumn;\r\n        const isLastColumn = cell.column === lastRangeColumn;\r\n\r\n        return isLastColumn && isLastRow;\r\n    }\r\n\r\n    public isBottomRightCell(cellRange: CellRange, cell: CellPosition): boolean {\r\n        const allColumns = this.visibleCols.allCols;\r\n        const allPositions = cellRange.columns.map((c: AgColumn) => allColumns.indexOf(c)).sort((a, b) => a - b);\r\n        const { startRow, endRow } = cellRange;\r\n        const lastRow = _isRowBefore(startRow!, endRow!) ? endRow : startRow;\r\n\r\n        const isRightColumn = allColumns.indexOf(cell.column as AgColumn) === _last(allPositions);\r\n        const isLastRow =\r\n            cell.rowIndex === lastRow!.rowIndex && _makeNull(cell.rowPinned) === _makeNull(lastRow!.rowPinned);\r\n\r\n        return isRightColumn && isLastRow;\r\n    }\r\n\r\n    // returns the number of ranges this cell is in\r\n    public getCellRangeCount(cell: CellPosition): number {\r\n        if (this.isEmpty()) {\r\n            return 0;\r\n        }\r\n\r\n        return this.cellRanges.filter((cellRange) => this.isCellInSpecificRange(cell, cellRange)).length;\r\n    }\r\n\r\n    private isRowInRange(rowIndex: number, rowPinned: RowPinnedType, cellRange: CellRange): boolean {\r\n        const firstRow = this.getRangeStartRow(cellRange);\r\n        const lastRow = this.getRangeEndRow(cellRange);\r\n        const thisRow: RowPosition = { rowIndex, rowPinned: rowPinned || null };\r\n\r\n        // compare rowPinned with == instead of === because it can be `null` or `undefined`\r\n        const equalsFirstRow = thisRow.rowIndex === firstRow.rowIndex && thisRow.rowPinned == firstRow.rowPinned;\r\n        const equalsLastRow = thisRow.rowIndex === lastRow.rowIndex && thisRow.rowPinned == lastRow.rowPinned;\r\n\r\n        if (equalsFirstRow || equalsLastRow) {\r\n            return true;\r\n        }\r\n\r\n        const afterFirstRow = !_isRowBefore(thisRow, firstRow);\r\n        const beforeLastRow = _isRowBefore(thisRow, lastRow);\r\n\r\n        return afterFirstRow && beforeLastRow;\r\n    }\r\n\r\n    public getDraggingRange(): CellRange | undefined {\r\n        return this.draggingRange;\r\n    }\r\n\r\n    public onDragStart(mouseEvent: MouseEvent): void {\r\n        if (!_isCellSelectionEnabled(this.gos)) {\r\n            return;\r\n        }\r\n\r\n        const { ctrlKey, metaKey, shiftKey } = mouseEvent;\r\n\r\n        // ctrlKey for windows, metaKey for Apple\r\n        const isMultiKey = ctrlKey || metaKey;\r\n        const allowMulti = !_getSuppressMultiRanges(this.gos);\r\n        const isMultiSelect = allowMulti ? isMultiKey : false;\r\n        const extendRange = shiftKey && !!this.cellRanges?.length;\r\n\r\n        if (!isMultiSelect && (!extendRange || _exists(_last(this.cellRanges)!.type))) {\r\n            this.removeAllCellRanges(true);\r\n        }\r\n\r\n        // The browser changes the Event target of cached events when working with the ShadowDOM\r\n        // so we need to retrieve the initial DragStartTarget.\r\n        const startTarget = this.dragSvc.startTarget;\r\n\r\n        if (startTarget) {\r\n            this.updateValuesOnMove(startTarget);\r\n        }\r\n\r\n        if (!this.lastCellHovered) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = true;\r\n        this.lastMouseEvent = mouseEvent;\r\n        this.intersectionRange = isMultiSelect && this.getCellRangeCount(this.lastCellHovered) > 1;\r\n\r\n        if (!extendRange) {\r\n            this.setNewestRangeStartCell(this.lastCellHovered);\r\n        }\r\n\r\n        // if we didn't clear the ranges, then dragging means the user clicked, and when the\r\n        // user clicks it means a range of one cell was created. we need to extend this range\r\n        // rather than creating another range. otherwise we end up with two distinct ranges\r\n        // from a drag operation (one from click, and one from drag).\r\n        if (this.cellRanges.length > 0) {\r\n            this.draggingRange = _last(this.cellRanges);\r\n        } else {\r\n            const mouseRowPosition: RowPosition = {\r\n                rowIndex: this.lastCellHovered.rowIndex,\r\n                rowPinned: this.lastCellHovered.rowPinned,\r\n            };\r\n\r\n            this.draggingRange = {\r\n                startRow: mouseRowPosition,\r\n                endRow: mouseRowPosition,\r\n                columns: [this.lastCellHovered.column],\r\n                startColumn: this.newestRangeStartCell!.column,\r\n            };\r\n\r\n            this.cellRanges.push(this.draggingRange);\r\n        }\r\n\r\n        this.ctrlsSvc\r\n            .getGridBodyCtrl()\r\n            .eBodyViewport.addEventListener('scroll', this.bodyScrollListener, { passive: true });\r\n\r\n        this.dispatchChangedEvent(true, false, this.draggingRange.id);\r\n    }\r\n\r\n    public intersectLastRange(fromMouseClick?: boolean) {\r\n        // when ranges are created due to a mouse click without drag (happens in cellMouseListener)\r\n        // this method will be called with `fromMouseClick=true`.\r\n        if (fromMouseClick && this.dragging) {\r\n            return;\r\n        }\r\n        if (_getSuppressMultiRanges(this.gos)) {\r\n            return;\r\n        }\r\n        if (this.isEmpty()) {\r\n            return;\r\n        }\r\n        const lastRange = _last(this.cellRanges);\r\n\r\n        const intersectionStartRow = this.getRangeStartRow(lastRange);\r\n        const intersectionEndRow = this.getRangeEndRow(lastRange);\r\n\r\n        const newRanges: CellRange[] = [];\r\n\r\n        this.cellRanges.slice(0, -1).forEach((range) => {\r\n            const startRow = this.getRangeStartRow(range);\r\n            const endRow = this.getRangeEndRow(range);\r\n            const cols = range.columns;\r\n            const intersectCols = cols.filter((col) => lastRange.columns.indexOf(col) === -1);\r\n            if (intersectCols.length === cols.length) {\r\n                // No overlapping columns, retain previous range\r\n                newRanges.push(range);\r\n                return;\r\n            }\r\n            if (_isRowBefore(intersectionEndRow, startRow) || _isRowBefore(endRow, intersectionStartRow)) {\r\n                // No overlapping rows, retain previous range\r\n                newRanges.push(range);\r\n                return;\r\n            }\r\n            const rangeCountBefore = newRanges.length;\r\n            // Top\r\n            if (_isRowBefore(startRow, intersectionStartRow)) {\r\n                const top: CellRange = {\r\n                    columns: [...cols],\r\n                    startColumn: lastRange.startColumn,\r\n                    startRow: { ...startRow },\r\n                    endRow: this.cellNavigation.getRowAbove(intersectionStartRow)!,\r\n                };\r\n                newRanges.push(top);\r\n            }\r\n            // Left & Right (not contiguous with columns)\r\n            if (intersectCols.length > 0) {\r\n                const middle: CellRange = {\r\n                    columns: intersectCols,\r\n                    startColumn: intersectCols.includes(lastRange.startColumn)\r\n                        ? lastRange.startColumn\r\n                        : intersectCols[0],\r\n                    startRow: this.rowMax([{ ...intersectionStartRow }, { ...startRow }]),\r\n                    endRow: this.rowMin([{ ...intersectionEndRow }, { ...endRow }]),\r\n                };\r\n                newRanges.push(middle);\r\n            }\r\n            // Bottom\r\n            if (_isRowBefore(intersectionEndRow, endRow)) {\r\n                newRanges.push({\r\n                    columns: [...cols],\r\n                    startColumn: lastRange.startColumn,\r\n                    startRow: this.cellNavigation.getRowBelow(intersectionEndRow)!,\r\n                    endRow: { ...endRow },\r\n                });\r\n            }\r\n            if (newRanges.length - rangeCountBefore === 1) {\r\n                // Only one range result from the intersection.\r\n                // Copy the source range's id, since essentially we just reduced it's size\r\n                newRanges[newRanges.length - 1].id = range.id;\r\n            }\r\n        });\r\n        this.cellRanges = newRanges;\r\n\r\n        // when this is called because of a clickEvent and the ranges were changed\r\n        // we need to force a dragEnd event to update the UI.\r\n        if (fromMouseClick) {\r\n            this.dispatchChangedEvent(false, true);\r\n        }\r\n    }\r\n\r\n    private rowMax(rows: RowPosition[]): RowPosition | undefined {\r\n        let max: RowPosition | undefined;\r\n        rows.forEach((row) => {\r\n            if (max === undefined || _isRowBefore(max, row)) {\r\n                max = row;\r\n            }\r\n        });\r\n        return max;\r\n    }\r\n\r\n    private rowMin(rows: RowPosition[]): RowPosition | undefined {\r\n        let min: RowPosition | undefined;\r\n        rows.forEach((row) => {\r\n            if (min === undefined || _isRowBefore(row, min)) {\r\n                min = row;\r\n            }\r\n        });\r\n        return min;\r\n    }\r\n\r\n    private updateValuesOnMove(eventTarget: EventTarget | null) {\r\n        const cellCtrl = _getCellCtrlForEventTarget(this.gos, eventTarget);\r\n        const cell = cellCtrl?.cellPosition;\r\n\r\n        this.cellHasChanged = false;\r\n\r\n        if (!cell || (this.lastCellHovered && _areCellsEqual(cell, this.lastCellHovered))) {\r\n            return;\r\n        }\r\n\r\n        if (cellCtrl?.editing) {\r\n            this.dragSvc.cancelDrag(eventTarget as HTMLElement);\r\n            return;\r\n        }\r\n\r\n        if (this.lastCellHovered) {\r\n            this.cellHasChanged = true;\r\n        }\r\n\r\n        this.lastCellHovered = cell;\r\n    }\r\n\r\n    public onDragging(mouseEvent: MouseEvent | null): void {\r\n        if (!this.dragging || !mouseEvent) {\r\n            return;\r\n        }\r\n\r\n        this.updateValuesOnMove(mouseEvent.target);\r\n\r\n        this.lastMouseEvent = mouseEvent;\r\n\r\n        const cellPosition = this.lastCellHovered!;\r\n        const isMouseAndStartInPinned = (position: string) =>\r\n            cellPosition && cellPosition.rowPinned === position && this.newestRangeStartCell!.rowPinned === position;\r\n\r\n        const skipVerticalScroll = isMouseAndStartInPinned('top') || isMouseAndStartInPinned('bottom');\r\n\r\n        this.autoScrollService.check(mouseEvent, skipVerticalScroll!);\r\n\r\n        if (!this.cellHasChanged) {\r\n            return;\r\n        }\r\n\r\n        const columns = this.calculateColumnsBetween(\r\n            this.newestRangeStartCell!.column as AgColumn,\r\n            cellPosition.column as AgColumn\r\n        );\r\n\r\n        if (!columns) {\r\n            return;\r\n        }\r\n\r\n        this.draggingRange!.endRow = {\r\n            rowIndex: cellPosition.rowIndex,\r\n            rowPinned: cellPosition.rowPinned,\r\n        };\r\n\r\n        this.draggingRange!.columns = columns;\r\n\r\n        this.dispatchChangedEvent(false, false, this.draggingRange!.id);\r\n    }\r\n\r\n    public onDragStop(): void {\r\n        if (!this.dragging) {\r\n            return;\r\n        }\r\n\r\n        const { id } = this.draggingRange!;\r\n\r\n        this.autoScrollService.ensureCleared();\r\n\r\n        this.ctrlsSvc.getGridBodyCtrl().eBodyViewport.removeEventListener('scroll', this.bodyScrollListener);\r\n        this.lastMouseEvent = null;\r\n        this.dragging = false;\r\n        this.draggingRange = undefined;\r\n        this.lastCellHovered = undefined;\r\n\r\n        if (this.intersectionRange) {\r\n            this.intersectionRange = false;\r\n            this.intersectLastRange();\r\n        }\r\n\r\n        this.dispatchChangedEvent(false, true, id);\r\n    }\r\n\r\n    private dispatchChangedEvent(started: boolean, finished: boolean, id?: string): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'cellSelectionChanged',\r\n            started,\r\n            finished,\r\n            id,\r\n        });\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'rangeSelectionChanged',\r\n            started,\r\n            finished,\r\n            id,\r\n        });\r\n    }\r\n\r\n    private calculateColumnsBetween(columnFrom: AgColumn, columnTo: AgColumn): AgColumn[] | undefined {\r\n        const allColumns = this.visibleCols.allCols;\r\n        const isSameColumn = columnFrom === columnTo;\r\n        const fromIndex = allColumns.indexOf(columnFrom as AgColumn);\r\n\r\n        if (fromIndex < 0) {\r\n            _warn(178, { colId: columnFrom.getId() });\r\n            return;\r\n        }\r\n\r\n        const toIndex = isSameColumn ? fromIndex : allColumns.indexOf(columnTo as AgColumn);\r\n\r\n        if (toIndex < 0) {\r\n            _warn(178, { colId: columnTo.getId() });\r\n            return;\r\n        }\r\n\r\n        if (isSameColumn) {\r\n            return [columnFrom];\r\n        }\r\n\r\n        const firstIndex = Math.min(fromIndex, toIndex);\r\n        const lastIndex = firstIndex === fromIndex ? toIndex : fromIndex;\r\n        const columns: AgColumn[] = [];\r\n\r\n        for (let i = firstIndex; i <= lastIndex; i++) {\r\n            columns.push(allColumns[i]);\r\n        }\r\n\r\n        return columns;\r\n    }\r\n\r\n    public createDragListenerFeature(eContainer: HTMLElement): BeanStub {\r\n        return new DragListenerFeature(eContainer);\r\n    }\r\n\r\n    public createCellRangeFeature(beans: BeanCollection, ctrl: CellCtrl): ICellRangeFeature {\r\n        return new CellRangeFeature(beans, ctrl);\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    CellCtrl,\r\n    GridOptionsService,\r\n    ICellComp,\r\n    ICellRangeFeature,\r\n    IRangeService,\r\n} from 'ag-grid-community';\r\nimport { CellRangeType, _isSameRow, _last, _missing, _setAriaSelected } from 'ag-grid-community';\r\n\r\nimport { SelectionHandleType } from './abstractSelectionHandle';\r\nimport type { AgFillHandle } from './agFillHandle';\r\nimport type { AgRangeHandle } from './agRangeHandle';\r\n\r\nconst CSS_CELL_RANGE_SELECTED = 'ag-cell-range-selected';\r\nconst CSS_CELL_RANGE_CHART = 'ag-cell-range-chart';\r\nconst CSS_CELL_RANGE_SINGLE_CELL = 'ag-cell-range-single-cell';\r\nconst CSS_CELL_RANGE_CHART_CATEGORY = 'ag-cell-range-chart-category';\r\nconst CSS_CELL_RANGE_HANDLE = 'ag-cell-range-handle';\r\nconst CSS_CELL_RANGE_TOP = 'ag-cell-range-top';\r\nconst CSS_CELL_RANGE_RIGHT = 'ag-cell-range-right';\r\nconst CSS_CELL_RANGE_BOTTOM = 'ag-cell-range-bottom';\r\nconst CSS_CELL_RANGE_LEFT = 'ag-cell-range-left';\r\n\r\nfunction _isRangeHandleEnabled(gos: GridOptionsService): boolean {\r\n    const selection = gos.get('cellSelection');\r\n    const useNewAPI = selection !== undefined;\r\n\r\n    if (!useNewAPI) {\r\n        return gos.get('enableRangeHandle');\r\n    }\r\n\r\n    return typeof selection !== 'boolean' ? selection.handle?.mode === 'range' : false;\r\n}\r\nfunction _isFillHandleEnabled(gos: GridOptionsService): boolean {\r\n    const selection = gos.get('cellSelection');\r\n    const useNewAPI = selection !== undefined;\r\n\r\n    if (!useNewAPI) {\r\n        return gos.get('enableFillHandle');\r\n    }\r\n\r\n    return typeof selection !== 'boolean' ? selection.handle?.mode === 'fill' : false;\r\n}\r\n\r\nexport class CellRangeFeature implements ICellRangeFeature {\r\n    private rangeSvc: IRangeService;\r\n    private cellComp: ICellComp;\r\n    private eGui: HTMLElement;\r\n\r\n    private rangeCount: number;\r\n    private hasChartRange: boolean;\r\n\r\n    private selectionHandle: AgFillHandle | AgRangeHandle | null | undefined;\r\n\r\n    constructor(\r\n        private readonly beans: BeanCollection,\r\n        private readonly cellCtrl: CellCtrl\r\n    ) {\r\n        // We know these are defined otherwise the feature wouldn't be registered\r\n        this.rangeSvc = beans.rangeSvc!;\r\n    }\r\n\r\n    public setComp(cellComp: ICellComp, eGui: HTMLElement): void {\r\n        this.cellComp = cellComp;\r\n        this.eGui = eGui;\r\n        this.onCellSelectionChanged();\r\n    }\r\n\r\n    public onCellSelectionChanged(): void {\r\n        const cellComp = this.cellComp;\r\n        // when using reactUi, given UI is async, it's possible this method is called before the comp is registered\r\n        if (!cellComp) {\r\n            return;\r\n        }\r\n\r\n        const { rangeSvc, cellCtrl, eGui } = this;\r\n\r\n        const rangeCount = rangeSvc.getCellRangeCount(cellCtrl.cellPosition);\r\n        this.rangeCount = rangeCount;\r\n        const hasChartRange = this.getHasChartRange();\r\n        this.hasChartRange = hasChartRange;\r\n\r\n        cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SELECTED, rangeCount !== 0);\r\n        cellComp.addOrRemoveCssClass(`${CSS_CELL_RANGE_SELECTED}-1`, rangeCount === 1);\r\n        cellComp.addOrRemoveCssClass(`${CSS_CELL_RANGE_SELECTED}-2`, rangeCount === 2);\r\n        cellComp.addOrRemoveCssClass(`${CSS_CELL_RANGE_SELECTED}-3`, rangeCount === 3);\r\n        cellComp.addOrRemoveCssClass(`${CSS_CELL_RANGE_SELECTED}-4`, rangeCount >= 4);\r\n        cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_CHART, hasChartRange);\r\n\r\n        _setAriaSelected(eGui, rangeCount > 0 ? true : undefined);\r\n        cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SINGLE_CELL, this.isSingleCell());\r\n\r\n        this.updateRangeBorders();\r\n\r\n        this.refreshHandle();\r\n    }\r\n\r\n    private updateRangeBorders(): void {\r\n        const rangeBorders = this.getRangeBorders();\r\n        const isSingleCell = this.isSingleCell();\r\n        const isTop = !isSingleCell && rangeBorders.top;\r\n        const isRight = !isSingleCell && rangeBorders.right;\r\n        const isBottom = !isSingleCell && rangeBorders.bottom;\r\n        const isLeft = !isSingleCell && rangeBorders.left;\r\n\r\n        const cellComp = this.cellComp;\r\n        cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_TOP, isTop);\r\n        cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_RIGHT, isRight);\r\n        cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_BOTTOM, isBottom);\r\n        cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_LEFT, isLeft);\r\n    }\r\n\r\n    private isSingleCell(): boolean {\r\n        const { rangeSvc } = this;\r\n        return this.rangeCount === 1 && !!rangeSvc && !rangeSvc.isMoreThanOneCell();\r\n    }\r\n\r\n    private getHasChartRange(): boolean {\r\n        const { rangeSvc } = this;\r\n\r\n        if (!this.rangeCount || !rangeSvc) {\r\n            return false;\r\n        }\r\n\r\n        const cellRanges = rangeSvc.getCellRanges();\r\n\r\n        return (\r\n            cellRanges.length > 0 &&\r\n            cellRanges.every((range) => [CellRangeType.DIMENSION, CellRangeType.VALUE].includes(range.type!))\r\n        );\r\n    }\r\n\r\n    public updateRangeBordersIfRangeCount(): void {\r\n        // we only need to update range borders if we are in a range\r\n        if (this.rangeCount > 0) {\r\n            this.updateRangeBorders();\r\n            this.refreshHandle();\r\n        }\r\n    }\r\n\r\n    private getRangeBorders(): {\r\n        top: boolean;\r\n        right: boolean;\r\n        bottom: boolean;\r\n        left: boolean;\r\n    } {\r\n        const isRtl = this.beans.gos.get('enableRtl');\r\n\r\n        let top = false;\r\n        let right = false;\r\n        let bottom = false;\r\n        let left = false;\r\n\r\n        const {\r\n            rangeSvc,\r\n            beans: { visibleCols },\r\n            cellCtrl: { cellPosition },\r\n        } = this;\r\n        const thisCol = cellPosition.column as AgColumn;\r\n\r\n        let leftCol: AgColumn | null;\r\n        let rightCol: AgColumn | null;\r\n\r\n        if (isRtl) {\r\n            leftCol = visibleCols.getColAfter(thisCol);\r\n            rightCol = visibleCols.getColBefore(thisCol);\r\n        } else {\r\n            leftCol = visibleCols.getColBefore(thisCol);\r\n            rightCol = visibleCols.getColAfter(thisCol);\r\n        }\r\n\r\n        const ranges = rangeSvc.getCellRanges().filter((range) => rangeSvc.isCellInSpecificRange(cellPosition, range));\r\n\r\n        // this means we are the first column in the grid\r\n        if (!leftCol) {\r\n            left = true;\r\n        }\r\n\r\n        // this means we are the last column in the grid\r\n        if (!rightCol) {\r\n            right = true;\r\n        }\r\n\r\n        for (let i = 0; i < ranges.length; i++) {\r\n            if (top && right && bottom && left) {\r\n                break;\r\n            }\r\n\r\n            const range = ranges[i];\r\n            const startRow = rangeSvc.getRangeStartRow(range);\r\n            const endRow = rangeSvc.getRangeEndRow(range);\r\n\r\n            if (!top && _isSameRow(startRow, cellPosition)) {\r\n                top = true;\r\n            }\r\n\r\n            if (!bottom && _isSameRow(endRow, cellPosition)) {\r\n                bottom = true;\r\n            }\r\n\r\n            if (!left && leftCol && range.columns.indexOf(leftCol) < 0) {\r\n                left = true;\r\n            }\r\n\r\n            if (!right && rightCol && range.columns.indexOf(rightCol) < 0) {\r\n                right = true;\r\n            }\r\n        }\r\n\r\n        return { top, right, bottom, left };\r\n    }\r\n\r\n    public refreshHandle(): void {\r\n        if (this.beans.context.isDestroyed()) {\r\n            return;\r\n        }\r\n\r\n        const shouldHaveSelectionHandle = this.shouldHaveSelectionHandle();\r\n\r\n        if (this.selectionHandle && !shouldHaveSelectionHandle) {\r\n            this.selectionHandle = this.beans.context.destroyBean(this.selectionHandle);\r\n        }\r\n\r\n        if (shouldHaveSelectionHandle) {\r\n            this.addSelectionHandle();\r\n        }\r\n\r\n        this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_HANDLE, !!this.selectionHandle);\r\n    }\r\n\r\n    private shouldHaveSelectionHandle(): boolean {\r\n        const gos = this.beans.gos;\r\n        const rangeSvc = this.rangeSvc;\r\n        const cellRanges = rangeSvc.getCellRanges();\r\n        const rangesLen = cellRanges.length;\r\n\r\n        if (this.rangeCount < 1 || rangesLen < 1) {\r\n            return false;\r\n        }\r\n\r\n        const cellRange = _last(cellRanges);\r\n        const { cellPosition } = this.cellCtrl;\r\n        const isFillHandleAvailable = _isFillHandleEnabled(gos) && !this.cellCtrl.column.isSuppressFillHandle();\r\n        const isRangeHandleAvailable = _isRangeHandleEnabled(gos);\r\n\r\n        let handleIsAvailable =\r\n            rangesLen === 1 && !this.cellCtrl.editing && (isFillHandleAvailable || isRangeHandleAvailable);\r\n\r\n        if (this.hasChartRange) {\r\n            const hasCategoryRange = cellRanges[0].type === CellRangeType.DIMENSION;\r\n            const isCategoryCell = hasCategoryRange && rangeSvc.isCellInSpecificRange(cellPosition, cellRanges[0]);\r\n\r\n            this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_CHART_CATEGORY, isCategoryCell);\r\n            handleIsAvailable = cellRange.type === CellRangeType.VALUE;\r\n        }\r\n\r\n        return (\r\n            handleIsAvailable &&\r\n            cellRange.endRow != null &&\r\n            rangeSvc.isContiguousRange(cellRange) &&\r\n            rangeSvc.isBottomRightCell(cellRange, cellPosition)\r\n        );\r\n    }\r\n\r\n    private addSelectionHandle() {\r\n        const { beans, rangeSvc } = this;\r\n        const cellRangeType = _last(rangeSvc.getCellRanges()).type;\r\n        const selectionHandleFill = _isFillHandleEnabled(beans.gos) && _missing(cellRangeType);\r\n        const type = selectionHandleFill ? SelectionHandleType.FILL : SelectionHandleType.RANGE;\r\n\r\n        if (this.selectionHandle && this.selectionHandle.getType() !== type) {\r\n            this.selectionHandle = beans.context.destroyBean(this.selectionHandle);\r\n        }\r\n\r\n        if (!this.selectionHandle) {\r\n            const selectionHandle = beans.registry.createDynamicBean<AgFillHandle | AgRangeHandle>(\r\n                type === SelectionHandleType.FILL ? 'fillHandle' : 'rangeHandle',\r\n                false\r\n            );\r\n            if (selectionHandle) {\r\n                this.selectionHandle = beans.context.createBean(selectionHandle);\r\n            }\r\n        }\r\n\r\n        this.selectionHandle?.refresh(this.cellCtrl);\r\n    }\r\n\r\n    public destroy(): void {\r\n        this.beans.context.destroyBean(this.selectionHandle);\r\n    }\r\n}\r\n", "import { BeanStub, _isCellSelectionEnabled } from 'ag-grid-community';\r\n\r\nexport class DragListenerFeature extends BeanStub {\r\n    constructor(private readonly eContainer: HTMLElement) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const { beans, gos, eContainer } = this;\r\n        const rangeSvc = beans.rangeSvc!;\r\n        const params = {\r\n            eElement: eContainer,\r\n            onDragStart: rangeSvc.onDragStart.bind(rangeSvc),\r\n            onDragStop: rangeSvc.onDragStop.bind(rangeSvc),\r\n            onDragging: rangeSvc.onDragging.bind(rangeSvc),\r\n        };\r\n\r\n        const dragSvc = beans.dragSvc!;\r\n        const enableFeature = dragSvc.addDragSource.bind(dragSvc, params);\r\n        const disableFeature = dragSvc.removeDragSource.bind(dragSvc, params);\r\n\r\n        this.addManagedPropertyListeners(['enableRangeSelection', 'cellSelection'], () => {\r\n            if (_isCellSelectionEnabled(gos)) {\r\n                enableFeature();\r\n            } else {\r\n                disableFeature();\r\n            }\r\n        });\r\n\r\n        this.addDestroyFunc(disableFeature);\r\n\r\n        if (_isCellSelectionEnabled(gos)) {\r\n            enableFeature();\r\n        }\r\n    }\r\n}\r\n", "import type { _ModuleWithApi, _ModuleWithoutApi, _ServerSideRowModelGridApi } from 'ag-grid-community';\r\nimport {\r\n    _CsrmSsrmSharedApiModule,\r\n    _SharedRowSelectionModule,\r\n    _SortModule,\r\n    _SsrmInfiniteSharedApiModule,\r\n} from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { LoadingCellRendererModule, SkeletonCellRendererModule } from '../cellRenderers/enterpriseCellRendererModule';\r\nimport { SharedPivotModule } from '../pivot/pivotModule';\r\nimport { SharedTreeDataModule } from '../treeData/treeDataModule';\r\nimport { VERSION } from '../version';\r\nimport { BlockUtils } from './blocks/blockUtils';\r\nimport { ExpandListener } from './listeners/expandListener';\r\nimport { FilterListener } from './listeners/filterListener';\r\nimport { ListenerUtils } from './listeners/listenerUtils';\r\nimport { SortListener } from './listeners/sortListener';\r\nimport { NodeManager } from './nodeManager';\r\nimport { ServerSideRowModel } from './serverSideRowModel';\r\nimport {\r\n    applyServerSideRowData,\r\n    applyServerSideTransaction,\r\n    applyServerSideTransactionAsync,\r\n    flushServerSideAsyncTransactions,\r\n    getServerSideGroupLevelState,\r\n    getServerSideSelectionState,\r\n    refreshServerSide,\r\n    retryServerSideLoads,\r\n    setServerSideSelectionState,\r\n} from './serverSideRowModelApi';\r\nimport { ServerSideExpansionService } from './services/serverSideExpansionService';\r\nimport { ServerSideSelectionService } from './services/serverSideSelectionService';\r\nimport { SsrmRowChildrenService } from './services/ssrmRowChildrenService';\r\nimport { LazyBlockLoadingService } from './stores/lazy/lazyBlockLoadingService';\r\nimport { StoreFactory } from './stores/storeFactory';\r\nimport { StoreUtils } from './stores/storeUtils';\r\nimport { TransactionManager } from './transactionManager';\r\n\r\n/**\r\n * @feature Server-Side Row Model\r\n */\r\nexport const ServerSideRowModelModule: _ModuleWithoutApi = {\r\n    moduleName: 'ServerSideRowModel',\r\n    version: VERSION,\r\n    rowModels: ['serverSide'],\r\n    beans: [\r\n        ServerSideRowModel,\r\n        ExpandListener,\r\n        StoreUtils,\r\n        BlockUtils,\r\n        NodeManager,\r\n        TransactionManager,\r\n        FilterListener,\r\n        StoreFactory,\r\n        ListenerUtils,\r\n        ServerSideSelectionService,\r\n        LazyBlockLoadingService,\r\n        SsrmRowChildrenService,\r\n        ServerSideExpansionService,\r\n        SortListener,\r\n    ],\r\n    dependsOn: [\r\n        EnterpriseCoreModule,\r\n        _SortModule,\r\n        _SharedRowSelectionModule,\r\n        SharedPivotModule,\r\n        SharedTreeDataModule,\r\n        LoadingCellRendererModule,\r\n        SkeletonCellRendererModule,\r\n    ],\r\n};\r\n\r\n/**\r\n * @feature Server-Side Row Model\r\n */\r\nexport const ServerSideRowModelApiModule: _ModuleWithApi<_ServerSideRowModelGridApi<any>> = {\r\n    moduleName: 'ServerSideRowModelApi',\r\n    version: VERSION,\r\n    rowModels: ['serverSide'],\r\n    apiFunctions: {\r\n        getServerSideSelectionState,\r\n        setServerSideSelectionState,\r\n        applyServerSideTransaction,\r\n        applyServerSideTransactionAsync,\r\n        applyServerSideRowData,\r\n        retryServerSideLoads,\r\n        flushServerSideAsyncTransactions,\r\n        refreshServerSide,\r\n        getServerSideGroupLevelState,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule, _CsrmSsrmSharedApiModule, _SsrmInfiniteSharedApiModule],\r\n};\r\n", "import type { ILoadingCellRendererComp, ILoadingCellRendererParams } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _createIconNoSpan } from 'ag-grid-community';\r\n\r\nexport class LoadingCellRenderer extends Component implements ILoadingCellRendererComp {\r\n    private readonly eLoadingIcon: HTMLElement = RefPlaceholder;\r\n    private readonly eLoadingText: HTMLElement = RefPlaceholder;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-loading\">\r\n            <span class=\"ag-loading-icon\" data-ref=\"eLoadingIcon\"></span>\r\n            <span class=\"ag-loading-text\" data-ref=\"eLoadingText\"></span>\r\n        </div>`);\r\n    }\r\n\r\n    public init(params: ILoadingCellRendererParams): void {\r\n        params.node.failedLoad ? this.setupFailed() : this.setupLoading();\r\n    }\r\n\r\n    private setupFailed(): void {\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        this.eLoadingText.innerText = localeTextFunc('loadingError', 'ERR');\r\n    }\r\n\r\n    private setupLoading(): void {\r\n        const eLoadingIcon = _createIconNoSpan('groupLoading', this.beans, null);\r\n        if (eLoadingIcon) {\r\n            this.eLoadingIcon.appendChild(eLoadingIcon);\r\n        }\r\n\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        this.eLoadingText.innerText = localeTextFunc('loadingOoo', 'Loading');\r\n    }\r\n\r\n    public refresh(_params: ILoadingCellRendererParams): boolean {\r\n        return false;\r\n    }\r\n}\r\n", "import type { ILoadingCellRendererComp, ILoadingCellRendererParams } from 'ag-grid-community';\r\nimport { Component, _getDocument, _setAriaLabel, _setAriaLabelledBy } from 'ag-grid-community';\r\n\r\nexport class SkeletonCellRenderer extends Component implements ILoadingCellRendererComp {\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-skeleton-container\"></div>`);\r\n    }\r\n\r\n    public init(params: ILoadingCellRendererParams): void {\r\n        const id = `ag-cell-skeleton-renderer-${this.getCompId()}`;\r\n        this.getGui().setAttribute('id', id);\r\n        this.addDestroyFunc(() => _setAriaLabelledBy(params.eParentOfValue));\r\n        _setAriaLabelledBy(params.eParentOfValue, id);\r\n\r\n        params.node.failedLoad ? this.setupFailed() : this.setupLoading(params);\r\n    }\r\n\r\n    private setupFailed(): void {\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        this.getGui().innerText = localeTextFunc('loadingError', 'ERR');\r\n\r\n        const ariaFailed = localeTextFunc('ariaSkeletonCellLoadingFailed', 'Row failed to load');\r\n        _setAriaLabel(this.getGui(), ariaFailed);\r\n    }\r\n\r\n    private setupLoading(params: ILoadingCellRendererParams): void {\r\n        const eDocument = _getDocument(this.beans);\r\n        const skeletonEffect = eDocument.createElement('div');\r\n        skeletonEffect.classList.add('ag-skeleton-effect');\r\n\r\n        // Use the row index to derive a width value for the skeleton cell\r\n        // to avoid them having uniform width when rendering\r\n        const rowIndex = params.node.rowIndex;\r\n        if (rowIndex != null) {\r\n            // Base value of 75% with variation between [-25%, 25%]. We alternate between sin and\r\n            // cos to achieve a semi-random appearance without actually needing a random number.\r\n            // We avoid using random numbers because then skeletons have consistent widths after\r\n            // being scrolled on and off screen.\r\n            const width = 75 + 25 * (rowIndex % 2 === 0 ? Math.sin(rowIndex) : Math.cos(rowIndex));\r\n            skeletonEffect.style.width = `${width}%`;\r\n        }\r\n\r\n        this.getGui().appendChild(skeletonEffect);\r\n\r\n        const localeTextFunc = this.getLocaleTextFunc();\r\n        const ariaLoading = localeTextFunc('ariaSkeletonCellLoading', 'Row data is loading');\r\n        _setAriaLabel(this.getGui(), ariaLoading);\r\n    }\r\n\r\n    public refresh(_params: ILoadingCellRendererParams): boolean {\r\n        return false;\r\n    }\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { LoadingCellRenderer } from './loadingCellRenderer';\r\nimport { SkeletonCellRenderer } from './skeletonCellRenderer';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const LoadingCellRendererModule: _ModuleWithoutApi = {\r\n    moduleName: 'LoadingCellRenderer',\r\n    version: VERSION,\r\n    userComponents: {\r\n        agLoadingCellRenderer: LoadingCellRenderer,\r\n    },\r\n    icons: {\r\n        // rotating spinner shown by the loading cell renderer\r\n        groupLoading: 'loading',\r\n    },\r\n    dependsOn: [EnterpriseCoreModule],\r\n};\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const SkeletonCellRendererModule: _ModuleWithoutApi = {\r\n    moduleName: 'SkeletonCellRenderer',\r\n    version: VERSION,\r\n    userComponents: {\r\n        agSkeletonCellRenderer: SkeletonCellRenderer,\r\n    },\r\n    dependsOn: [EnterpriseCoreModule],\r\n};\r\n", "import type { _ModuleWithApi, _ModuleWithoutApi, _PivotGridApi } from 'ag-grid-community';\r\nimport { _ColumnGroupModule } from 'ag-grid-community';\r\n\r\nimport { RowGroupingModule, SharedRowGroupingModule } from '../rowGrouping/rowGroupingModule';\r\nimport { ClientSideRowModelHierarchyModule } from '../rowHierarchy/rowHierarchyModule';\r\nimport { VERSION } from '../version';\r\nimport {\r\n    addPivotColumns,\r\n    addValueColumns,\r\n    getPivotColumns,\r\n    getPivotResultColumn,\r\n    getPivotResultColumns,\r\n    getValueColumns,\r\n    isPivotMode,\r\n    removePivotColumns,\r\n    removeValueColumns,\r\n    setPivotColumns,\r\n    setPivotResultColumns,\r\n    setValueColumns,\r\n} from './pivotApi';\r\nimport { PivotColDefService } from './pivotColDefService';\r\nimport { PivotColsSvc } from './pivotColsSvc';\r\nimport { PivotResultColsService } from './pivotResultColsService';\r\nimport { PivotStage } from './pivotStage';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const SharedPivotModule: _ModuleWithApi<_PivotGridApi<any>> = {\r\n    moduleName: 'SharedPivot',\r\n    version: VERSION,\r\n    beans: [PivotResultColsService, PivotColDefService, PivotColsSvc],\r\n    apiFunctions: {\r\n        isPivotMode,\r\n        getPivotResultColumn,\r\n        setValueColumns,\r\n        getValueColumns,\r\n        removeValueColumns,\r\n        addValueColumns,\r\n        setPivotColumns,\r\n        removePivotColumns,\r\n        addPivotColumns,\r\n        getPivotColumns,\r\n        setPivotResultColumns,\r\n        getPivotResultColumns,\r\n    },\r\n    dependsOn: [SharedRowGroupingModule, _ColumnGroupModule],\r\n};\r\n\r\n/**\r\n * @feature Pivoting\r\n * @colDef pivot, enablePivot\r\n * @gridOption pivotMode\r\n */\r\nexport const PivotModule: _ModuleWithoutApi = {\r\n    moduleName: 'Pivot',\r\n    version: VERSION,\r\n    rowModels: ['clientSide'],\r\n    beans: [PivotStage],\r\n    dependsOn: [SharedPivotModule, RowGroupingModule, ClientSideRowModelHierarchyModule],\r\n};\r\n", "import type { BeanCollection, ColDef, ColGroupDef, Column } from 'ag-grid-community';\r\n\r\nexport function isPivotMode(beans: BeanCollection): boolean {\r\n    return beans.colModel.isPivotMode();\r\n}\r\n\r\nexport function getPivotResultColumn<TValue = any, TData = any>(\r\n    beans: BeanCollection,\r\n    pivotKeys: string[],\r\n    valueColKey: string | ColDef<TData, TValue> | Column<TValue>\r\n): Column<TValue> | null {\r\n    return beans.pivotResultCols?.lookupPivotResultCol(pivotKeys, valueColKey) ?? null;\r\n}\r\n\r\nexport function setValueColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.valueColsSvc?.setColumns(colKeys, 'api');\r\n}\r\n\r\nexport function getValueColumns(beans: BeanCollection): Column[] {\r\n    return beans.valueColsSvc?.columns ?? [];\r\n}\r\n\r\nexport function removeValueColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.valueColsSvc?.removeColumns(colKeys, 'api');\r\n}\r\n\r\nexport function addValueColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.valueColsSvc?.addColumns(colKeys, 'api');\r\n}\r\n\r\nexport function setPivotColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.pivotColsSvc?.setColumns(colKeys, 'api');\r\n}\r\n\r\nexport function removePivotColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.pivotColsSvc?.removeColumns(colKeys, 'api');\r\n}\r\n\r\nexport function addPivotColumns(beans: BeanCollection, colKeys: (string | ColDef | Column)[]): void {\r\n    beans.pivotColsSvc?.addColumns(colKeys, 'api');\r\n}\r\n\r\nexport function getPivotColumns(beans: BeanCollection): Column[] {\r\n    return beans.pivotColsSvc?.columns ?? [];\r\n}\r\n\r\nexport function setPivotResultColumns(beans: BeanCollection, colDefs: (ColDef | ColGroupDef)[] | null): void {\r\n    beans.pivotResultCols?.setPivotResultCols(colDefs, 'api');\r\n}\r\n\r\nexport function getPivotResultColumns(beans: BeanCollection): Column[] | null {\r\n    const pivotResultCols = beans.pivotResultCols?.getPivotResultCols();\r\n    return pivotResultCols ? pivotResultCols.list : null;\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    ColDef,\r\n    ColGroupDef,\r\n    ColumnModel,\r\n    ColumnNameService,\r\n    IColsService,\r\n    IPivotColDefService,\r\n    NamedBean,\r\n} from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\nexport interface PivotColDefServiceResult {\r\n    pivotColumnGroupDefs: (ColDef | ColGroupDef)[];\r\n    pivotColumnDefs: ColDef[];\r\n}\r\n\r\nconst PIVOT_ROW_TOTAL_PREFIX = 'PivotRowTotal_';\r\nexport class PivotColDefService extends BeanStub implements NamedBean, IPivotColDefService {\r\n    beanName = 'pivotColDefSvc' as const;\r\n\r\n    private colModel: ColumnModel;\r\n    private pivotColsSvc?: IColsService;\r\n    private valueColsSvc?: IColsService;\r\n    private colNames: ColumnNameService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n        this.pivotColsSvc = beans.pivotColsSvc;\r\n        this.valueColsSvc = beans.valueColsSvc;\r\n        this.colNames = beans.colNames;\r\n    }\r\n\r\n    private fieldSeparator: string;\r\n    private pivotDefaultExpanded: number;\r\n\r\n    public postConstruct(): void {\r\n        const getFieldSeparator = () => this.gos.get('serverSidePivotResultFieldSeparator') ?? '_';\r\n        this.fieldSeparator = getFieldSeparator();\r\n        this.addManagedPropertyListener('serverSidePivotResultFieldSeparator', () => {\r\n            this.fieldSeparator = getFieldSeparator();\r\n        });\r\n\r\n        const getPivotDefaultExpanded = () => this.gos.get('pivotDefaultExpanded');\r\n        this.pivotDefaultExpanded = getPivotDefaultExpanded();\r\n        this.addManagedPropertyListener('pivotDefaultExpanded', () => {\r\n            this.pivotDefaultExpanded = getPivotDefaultExpanded();\r\n        });\r\n    }\r\n\r\n    public createPivotColumnDefs(uniqueValues: any): PivotColDefServiceResult {\r\n        // this is passed to the colModel, to configure the columns and groups we show\r\n\r\n        const pivotColumnGroupDefs: (ColDef | ColGroupDef)[] = this.createPivotColumnsFromUniqueValues(uniqueValues);\r\n\r\n        function extractColDefs(input: (ColDef | ColGroupDef)[], arr: ColDef[] = []): ColDef[] {\r\n            input.forEach((def: any) => {\r\n                if (def.children !== undefined) {\r\n                    extractColDefs(def.children, arr);\r\n                } else {\r\n                    arr.push(def);\r\n                }\r\n            });\r\n            return arr;\r\n        }\r\n        const pivotColumnDefs = extractColDefs(pivotColumnGroupDefs);\r\n\r\n        // additional columns that contain the aggregated total for each value column per row\r\n        this.addRowGroupTotals(pivotColumnGroupDefs, pivotColumnDefs);\r\n\r\n        // additional group columns that contain child totals for each collapsed child column / group\r\n        this.addExpandablePivotGroups(pivotColumnGroupDefs, pivotColumnDefs);\r\n\r\n        // additional group columns that contain an aggregated total across all child columns\r\n        this.addPivotTotalsToGroups(pivotColumnGroupDefs, pivotColumnDefs);\r\n\r\n        // we clone, so the colDefs in pivotColumnsGroupDefs and pivotColumnDefs are not shared. this is so that\r\n        // any changes the user makes (via processSecondaryColumnDefinitions) don't impact the internal aggregations,\r\n        // as these use the col defs also\r\n        const pivotColumnDefsClone: ColDef[] = pivotColumnDefs.map((colDef) => ({ ...colDef }));\r\n\r\n        return {\r\n            pivotColumnGroupDefs: pivotColumnGroupDefs,\r\n            pivotColumnDefs: pivotColumnDefsClone,\r\n        };\r\n    }\r\n\r\n    private createPivotColumnsFromUniqueValues(uniqueValues: any): (ColDef | ColGroupDef)[] {\r\n        const pivotColumns = this.pivotColsSvc?.columns ?? [];\r\n        const maxDepth = pivotColumns.length;\r\n\r\n        const pivotColumnGroupDefs: (ColDef | ColGroupDef)[] = this.recursivelyBuildGroup(\r\n            0,\r\n            uniqueValues,\r\n            [],\r\n            maxDepth,\r\n            pivotColumns\r\n        );\r\n        return pivotColumnGroupDefs;\r\n    }\r\n\r\n    private recursivelyBuildGroup(\r\n        index: number,\r\n        uniqueValue: any,\r\n        pivotKeys: string[],\r\n        maxDepth: number,\r\n        primaryPivotColumns: AgColumn[]\r\n    ): ColGroupDef[] | ColDef[] {\r\n        const measureColumns = this.valueColsSvc?.columns;\r\n        if (index >= maxDepth) {\r\n            // Base case - build the measure columns\r\n            return this.buildMeasureCols(pivotKeys);\r\n        }\r\n\r\n        // sort by either user provided comparator, or our own one\r\n        const primaryPivotColumnDefs = primaryPivotColumns[index].getColDef();\r\n        const comparator = this.headerNameComparator.bind(this, primaryPivotColumnDefs.pivotComparator);\r\n\r\n        // Base case for the compact layout, instead of recursing build the last layer of groups as measure columns instead\r\n        if (\r\n            measureColumns?.length === 1 &&\r\n            this.gos.get('removePivotHeaderRowWhenSingleValueColumn') &&\r\n            index === maxDepth - 1\r\n        ) {\r\n            const leafCols: ColDef[] = [];\r\n\r\n            for (const key of Object.keys(uniqueValue)) {\r\n                const newPivotKeys = [...pivotKeys, key];\r\n                const colDef = this.createColDef(measureColumns[0], key, newPivotKeys);\r\n                colDef.columnGroupShow = 'open';\r\n                leafCols.push(colDef);\r\n            }\r\n            leafCols.sort(comparator);\r\n            return leafCols;\r\n        }\r\n        // Recursive case\r\n        const groups: ColGroupDef[] = [];\r\n        for (const [key, value] of Object.entries(uniqueValue)) {\r\n            // expand group by default based on depth of group. (pivotDefaultExpanded provides desired level of depth for expanding group by default)\r\n            const openByDefault = this.pivotDefaultExpanded === -1 || index < this.pivotDefaultExpanded;\r\n\r\n            const newPivotKeys = [...pivotKeys, key];\r\n            groups.push({\r\n                children: this.recursivelyBuildGroup(index + 1, value, newPivotKeys, maxDepth, primaryPivotColumns),\r\n                headerName: key,\r\n                pivotKeys: newPivotKeys,\r\n                columnGroupShow: 'open',\r\n                openByDefault: openByDefault,\r\n                groupId: this.generateColumnGroupId(newPivotKeys),\r\n            });\r\n        }\r\n        groups.sort(comparator);\r\n        return groups;\r\n    }\r\n\r\n    private buildMeasureCols(pivotKeys: string[]): ColDef[] {\r\n        const measureColumns = this.valueColsSvc?.columns ?? [];\r\n        if (measureColumns.length === 0) {\r\n            // if no value columns selected, then we insert one blank column, so the user at least sees columns\r\n            // rendered. otherwise the grid would render with no columns (just empty groups) which would give the\r\n            // impression that the grid is broken\r\n            return [this.createColDef(null, '-', pivotKeys)];\r\n        }\r\n        return measureColumns.map((measureCol) => {\r\n            const columnName = this.colNames.getDisplayNameForColumn(measureCol, 'header');\r\n            return {\r\n                ...this.createColDef(measureCol, columnName, pivotKeys),\r\n                columnGroupShow: 'open',\r\n            };\r\n        });\r\n    }\r\n\r\n    private addExpandablePivotGroups(pivotColumnGroupDefs: (ColDef | ColGroupDef)[], pivotColumnDefs: ColDef[]) {\r\n        const isSuppressExpand = this.gos.get('suppressExpandablePivotGroups');\r\n        if (isSuppressExpand || this.gos.get('pivotColumnGroupTotals')) {\r\n            return;\r\n        }\r\n\r\n        const recursivelyAddSubTotals = (\r\n            def: ColGroupDef | ColDef,\r\n            currentPivotColumnDefs: ColDef[],\r\n            acc: Map<string, string[]>\r\n        ) => {\r\n            if ('children' in def) {\r\n                const childAcc = new Map();\r\n\r\n                def.children.forEach((grp: ColDef | ColGroupDef) => {\r\n                    recursivelyAddSubTotals(grp, currentPivotColumnDefs, childAcc);\r\n                });\r\n\r\n                const leafGroup = !def.children.some((child) => (child as ColGroupDef).children);\r\n\r\n                this.valueColsSvc?.columns.forEach((valueColumn) => {\r\n                    const columnName: string | null = this.colNames.getDisplayNameForColumn(valueColumn, 'header');\r\n                    const totalColDef = this.createColDef(valueColumn, columnName, def.pivotKeys);\r\n                    totalColDef.pivotTotalColumnIds = childAcc.get(valueColumn.getColId());\r\n\r\n                    totalColDef.columnGroupShow = !isSuppressExpand ? 'closed' : 'open';\r\n\r\n                    totalColDef.aggFunc = valueColumn.getAggFunc();\r\n\r\n                    if (!leafGroup) {\r\n                        // add total colDef to group and pivot colDefs array\r\n                        const children = def.children;\r\n                        children.push(totalColDef);\r\n                        currentPivotColumnDefs.push(totalColDef);\r\n                    }\r\n                });\r\n\r\n                this.merge(acc, childAcc);\r\n\r\n                return;\r\n            }\r\n\r\n            // check that value column exists, i.e. aggFunc is supplied\r\n            if (!def.pivotValueColumn) {\r\n                return;\r\n            }\r\n\r\n            const pivotValueColId = def.pivotValueColumn.getColId();\r\n\r\n            const exists = acc.has(pivotValueColId);\r\n            if (exists) {\r\n                const arr = acc.get(pivotValueColId)!;\r\n                arr.push(def.colId!);\r\n            } else {\r\n                acc.set(pivotValueColId, [def.colId!]);\r\n            }\r\n        };\r\n\r\n        pivotColumnGroupDefs.forEach((groupDef: ColGroupDef | ColDef) => {\r\n            recursivelyAddSubTotals(groupDef, pivotColumnDefs, new Map());\r\n        });\r\n    }\r\n\r\n    private addPivotTotalsToGroups(pivotColumnGroupDefs: (ColDef | ColGroupDef)[], pivotColumnDefs: ColDef[]) {\r\n        if (!this.gos.get('pivotColumnGroupTotals')) {\r\n            return;\r\n        }\r\n\r\n        const insertAfter = this.gos.get('pivotColumnGroupTotals') === 'after';\r\n\r\n        const valueCols = this.valueColsSvc?.columns;\r\n        const aggFuncs = valueCols?.map((valueCol) => valueCol.getAggFunc());\r\n\r\n        // don't add pivot totals if there is less than 1 aggFunc or they are not all the same\r\n        if (!aggFuncs || aggFuncs.length < 1 || !this.sameAggFuncs(aggFuncs)) {\r\n            // console.warn('AG Grid: aborting adding pivot total columns - value columns require same aggFunc');\r\n            return;\r\n        }\r\n\r\n        if (valueCols) {\r\n            // arbitrarily select a value column to use as a template for pivot columns\r\n            const valueColumn = valueCols[0];\r\n\r\n            pivotColumnGroupDefs.forEach((groupDef: ColGroupDef | ColDef) => {\r\n                this.recursivelyAddPivotTotal(groupDef, pivotColumnDefs, valueColumn, insertAfter);\r\n            });\r\n        }\r\n    }\r\n\r\n    private recursivelyAddPivotTotal(\r\n        groupDef: ColGroupDef | ColDef,\r\n        pivotColumnDefs: ColDef[],\r\n        valueColumn: AgColumn,\r\n        insertAfter: boolean\r\n    ): string[] | null {\r\n        const group = groupDef as ColGroupDef;\r\n        if (!group.children) {\r\n            const def: ColDef = groupDef as ColDef;\r\n            return def.colId ? [def.colId] : null;\r\n        }\r\n\r\n        let colIds: string[] = [];\r\n\r\n        // need to recurse children first to obtain colIds used in the aggregation stage\r\n        group.children.forEach((grp: ColDef | ColGroupDef) => {\r\n            const childColIds = this.recursivelyAddPivotTotal(grp, pivotColumnDefs, valueColumn, insertAfter);\r\n            if (childColIds) {\r\n                colIds = colIds.concat(childColIds);\r\n            }\r\n        });\r\n\r\n        // only add total colDef if there is more than 1 child node\r\n        if (group.children.length > 1) {\r\n            const localeTextFunc = this.getLocaleTextFunc();\r\n            const headerName = localeTextFunc('pivotColumnGroupTotals', 'Total');\r\n\r\n            //create total colDef using an arbitrary value column as a template\r\n            const totalColDef = this.createColDef(valueColumn, headerName, groupDef.pivotKeys, true);\r\n            totalColDef.pivotTotalColumnIds = colIds;\r\n            totalColDef.aggFunc = valueColumn.getAggFunc();\r\n            totalColDef.columnGroupShow = this.gos.get('suppressExpandablePivotGroups') ? 'open' : undefined;\r\n\r\n            // add total colDef to group and pivot colDefs array\r\n            const children = (groupDef as ColGroupDef).children;\r\n            insertAfter ? children.push(totalColDef) : children.unshift(totalColDef);\r\n            pivotColumnDefs.push(totalColDef);\r\n        }\r\n\r\n        return colIds;\r\n    }\r\n\r\n    private addRowGroupTotals(pivotColumnGroupDefs: (ColDef | ColGroupDef)[], pivotColumnDefs: ColDef[]) {\r\n        if (!this.gos.get('pivotRowTotals')) {\r\n            return;\r\n        }\r\n\r\n        const insertAtEnd = this.gos.get('pivotRowTotals') === 'after';\r\n\r\n        const valueColumns = this.valueColsSvc?.columns ?? [];\r\n        const valueCols = valueColumns.slice();\r\n\r\n        if (!insertAtEnd) {\r\n            // if inserting before, we use unshift to insert at the start, so reverse the order to maintain the order of value cols\r\n            valueCols.reverse();\r\n        }\r\n\r\n        const isCreateTotalGroups = valueCols.length > 1 || !this.gos.get('removePivotHeaderRowWhenSingleValueColumn');\r\n        for (let i = 0; i < valueCols.length; i++) {\r\n            const valueCol = valueCols[i];\r\n\r\n            const columnName: string | null = this.colNames.getDisplayNameForColumn(valueCol, 'header');\r\n            const colDef = this.createColDef(valueCol, columnName, []);\r\n\r\n            const colIds: string[] = [];\r\n            for (let i = 0; i < pivotColumnDefs.length; i++) {\r\n                const colDef = pivotColumnDefs[i];\r\n                if (colDef.pivotValueColumn === valueCol) {\r\n                    colIds.push(colDef.colId!);\r\n                }\r\n            }\r\n\r\n            colDef.pivotTotalColumnIds = colIds;\r\n            colDef.colId = PIVOT_ROW_TOTAL_PREFIX + colDef.colId;\r\n\r\n            const valueGroup: ColGroupDef | ColDef = isCreateTotalGroups\r\n                ? {\r\n                      children: [colDef],\r\n                      pivotKeys: [],\r\n                      groupId: `${PIVOT_ROW_TOTAL_PREFIX}_pivotGroup_${valueCol.getColId()}`,\r\n                  }\r\n                : colDef;\r\n\r\n            pivotColumnDefs.push(colDef);\r\n            insertAtEnd ? pivotColumnGroupDefs.push(valueGroup) : pivotColumnGroupDefs.unshift(valueGroup);\r\n        }\r\n    }\r\n\r\n    private createColDef(\r\n        valueColumn: AgColumn | null,\r\n        headerName: any,\r\n        pivotKeys: string[] | undefined,\r\n        totalColumn: boolean = false\r\n    ): ColDef {\r\n        const colDef: ColDef = {};\r\n\r\n        // This is null when there are no measure columns and we're creating placeholder columns\r\n        if (valueColumn) {\r\n            const colDefToCopy = valueColumn.getColDef();\r\n            Object.assign(colDef, colDefToCopy);\r\n            // even if original column was hidden, we always show the pivot value column, otherwise it would be\r\n            // very confusing for people thinking the pivot is broken\r\n            colDef.hide = false;\r\n        }\r\n\r\n        colDef.headerName = headerName;\r\n        colDef.colId = this.generateColumnId(\r\n            pivotKeys || [],\r\n            valueColumn && !totalColumn ? valueColumn.getColId() : ''\r\n        );\r\n\r\n        // pivot columns repeat over field, so it makes sense to use the unique id instead. For example if you want to\r\n        // assign values to pinned bottom rows using setPinnedBottomRowData the value service will use this colId.\r\n        colDef.field = colDef.colId;\r\n        // this is to support using pinned rows, normally the data will be extracted from the aggData object using the colId\r\n        // however pinned rows still access the data object by field, this prevents values with dots from being treated as complex objects\r\n        colDef.valueGetter = (params) => params.data?.[params.colDef.field!];\r\n\r\n        colDef.pivotKeys = pivotKeys;\r\n        colDef.pivotValueColumn = valueColumn;\r\n        if (colDef.filter === true) {\r\n            colDef.filter = 'agNumberColumnFilter';\r\n        }\r\n\r\n        return colDef;\r\n    }\r\n\r\n    private sameAggFuncs(aggFuncs: any[]) {\r\n        if (aggFuncs.length == 1) {\r\n            return true;\r\n        }\r\n        //check if all aggFunc's match\r\n        for (let i = 1; i < aggFuncs.length; i++) {\r\n            if (aggFuncs[i] !== aggFuncs[0]) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private headerNameComparator(\r\n        userComparator: (a: string | undefined, b: string | undefined) => number,\r\n        a: ColGroupDef | ColDef,\r\n        b: ColGroupDef | ColDef\r\n    ): number {\r\n        if (userComparator) {\r\n            return userComparator(a.headerName, b.headerName);\r\n        } else {\r\n            if (a.headerName && !b.headerName) {\r\n                return 1;\r\n            } else if (!a.headerName && b.headerName) {\r\n                return -1;\r\n            }\r\n\r\n            // slightly naff here - just to satify typescript\r\n            // really should be &&, but if so ts complains\r\n            // the above if/else checks would deal with either being falsy, so at this stage if either are falsy, both are\r\n            // ..still naff though\r\n            if (!a.headerName || !b.headerName) {\r\n                return 0;\r\n            }\r\n\r\n            if (a.headerName < b.headerName) {\r\n                return -1;\r\n            }\r\n\r\n            if (a.headerName > b.headerName) {\r\n                return 1;\r\n            }\r\n\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    private merge(m1: Map<string, string[]>, m2: Map<any, any>) {\r\n        m2.forEach((value, key) => {\r\n            const existingList = m1.has(key) ? m1.get(key) : [];\r\n            const updatedList = [...existingList!, ...value];\r\n            m1.set(key, updatedList);\r\n        });\r\n    }\r\n\r\n    private generateColumnGroupId(pivotKeys: string[]): string {\r\n        const pivotCols = (this.pivotColsSvc?.columns ?? []).map((col) => col.getColId());\r\n        return `pivotGroup_${pivotCols.join('-')}_${pivotKeys.join('-')}`;\r\n    }\r\n\r\n    private generateColumnId(pivotKeys: string[], measureColumnId: string) {\r\n        const pivotCols = (this.pivotColsSvc?.columns ?? []).map((col) => col.getColId());\r\n        return `pivot_${pivotCols.join('-')}_${pivotKeys.join('-')}_${measureColumnId}`;\r\n    }\r\n\r\n    /**\r\n     * Used by the SSRM to create secondary columns from provided fields\r\n     * @param fields\r\n     */\r\n    public createColDefsFromFields(fields: string[]): (ColDef | ColGroupDef)[] {\r\n        interface UniqueValue {\r\n            [key: string]: UniqueValue;\r\n        }\r\n        // tear the ids down into groups, while this could be done in-step with the next stage, the lookup is faster\r\n        // than searching col group children array for the right group\r\n        const uniqueValues: UniqueValue = {};\r\n        for (let i = 0; i < fields.length; i++) {\r\n            const field = fields[i];\r\n            const parts = field.split(this.fieldSeparator);\r\n\r\n            let level: UniqueValue = uniqueValues;\r\n            for (let p = 0; p < parts.length; p++) {\r\n                const part = parts[p];\r\n                if (level[part] == null) {\r\n                    level[part] = {};\r\n                }\r\n                level = level[part];\r\n            }\r\n        }\r\n\r\n        const uniqueValuesToGroups = (\r\n            id: string,\r\n            key: string,\r\n            uniqueValues: UniqueValue,\r\n            depth: number\r\n        ): ColDef | ColGroupDef => {\r\n            const children: (ColDef | ColGroupDef)[] = [];\r\n            for (const key of Object.keys(uniqueValues)) {\r\n                const item = uniqueValues[key];\r\n                const child = uniqueValuesToGroups(`${id}${this.fieldSeparator}${key}`, key, item, depth + 1);\r\n                children.push(child);\r\n            }\r\n\r\n            if (children.length === 0) {\r\n                const potentialAggCol = this.colModel.getColDefCol(key);\r\n                if (potentialAggCol) {\r\n                    const headerName = this.colNames.getDisplayNameForColumn(potentialAggCol, 'header') ?? key;\r\n                    const colDef = this.createColDef(potentialAggCol, headerName, undefined, false);\r\n                    colDef.colId = id;\r\n                    colDef.aggFunc = potentialAggCol.getAggFunc();\r\n                    colDef.valueGetter = (params) => params.data?.[id];\r\n                    return colDef;\r\n                }\r\n\r\n                const col: ColDef = {\r\n                    colId: id,\r\n                    headerName: key,\r\n                    // this is to support using pinned rows, normally the data will be extracted from the aggData object using the colId\r\n                    // however pinned rows still access the data object by field, this prevents values with dots from being treated as complex objects\r\n                    valueGetter: (params) => params.data?.[id],\r\n                };\r\n                return col;\r\n            }\r\n\r\n            // this is a bit sketchy. As the fields can be anything we just build groups as deep as the fields go.\r\n            // nothing says user has to give us groups the same depth.\r\n            const collapseSingleChildren = this.gos.get('removePivotHeaderRowWhenSingleValueColumn');\r\n            if (collapseSingleChildren && children.length === 1 && 'colId' in children[0]) {\r\n                children[0].headerName = key;\r\n                return children[0];\r\n            }\r\n\r\n            const group: ColGroupDef = {\r\n                openByDefault: this.pivotDefaultExpanded === -1 || depth < this.pivotDefaultExpanded,\r\n                groupId: id,\r\n                headerName: key,\r\n                children,\r\n            };\r\n            return group;\r\n        };\r\n\r\n        const res: (ColDef | ColGroupDef)[] = [];\r\n        for (const key of Object.keys(uniqueValues)) {\r\n            const item = uniqueValues[key];\r\n            const col = uniqueValuesToGroups(key, key, item, 0);\r\n            res.push(col);\r\n        }\r\n        return res;\r\n    }\r\n}\r\n", "import type {\r\n    AbstractColDef,\r\n    AgColumn,\r\n    AgProvidedColumnGroup,\r\n    BeanCollection,\r\n    ColDef,\r\n    ColGroupDef,\r\n    ColKey,\r\n    ColumnEventType,\r\n    ColumnModel,\r\n    IPivotResultColsService,\r\n    NamedBean,\r\n    VisibleColsService,\r\n    _ColumnCollections,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    _areEqual,\r\n    _createColumnTree,\r\n    _destroyColumnTree,\r\n    _exists,\r\n    _getColumnsFromTree,\r\n} from 'ag-grid-community';\r\n\r\nexport class PivotResultColsService extends BeanStub implements NamedBean, IPivotResultColsService {\r\n    beanName = 'pivotResultCols' as const;\r\n\r\n    private colModel: ColumnModel;\r\n    private visibleCols: VisibleColsService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.colModel = beans.colModel;\r\n        this.visibleCols = beans.visibleCols;\r\n    }\r\n\r\n    // if pivoting, these are the generated columns as a result of the pivot\r\n    private pivotResultCols: _ColumnCollections | null;\r\n\r\n    // Saved when pivot is disabled, available to re-use when pivot is restored\r\n    private previousPivotResultCols: (AgColumn | AgProvidedColumnGroup)[] | null;\r\n\r\n    public override destroy(): void {\r\n        _destroyColumnTree(this.beans, this.pivotResultCols?.tree);\r\n        super.destroy();\r\n    }\r\n\r\n    public isPivotResultColsPresent(): boolean {\r\n        return this.pivotResultCols != null;\r\n    }\r\n\r\n    public lookupPivotResultCol(pivotKeys: string[], valueColKey: ColKey): AgColumn | null {\r\n        if (this.pivotResultCols == null) {\r\n            return null;\r\n        }\r\n\r\n        const valueColumnToFind = this.colModel.getColDefCol(valueColKey);\r\n\r\n        let foundColumn: AgColumn | null = null;\r\n\r\n        this.pivotResultCols.list.forEach((column) => {\r\n            const thisPivotKeys = column.getColDef().pivotKeys;\r\n            const pivotValueColumn = column.getColDef().pivotValueColumn;\r\n\r\n            const pivotKeyMatches = _areEqual(thisPivotKeys, pivotKeys);\r\n            const pivotValueMatches = pivotValueColumn === valueColumnToFind;\r\n\r\n            if (pivotKeyMatches && pivotValueMatches) {\r\n                foundColumn = column;\r\n            }\r\n        });\r\n\r\n        return foundColumn;\r\n    }\r\n\r\n    public getPivotResultCols(): _ColumnCollections | null {\r\n        return this.pivotResultCols;\r\n    }\r\n\r\n    public getPivotResultCol(key: ColKey): AgColumn | null {\r\n        if (!this.pivotResultCols) {\r\n            return null;\r\n        }\r\n        return this.colModel.getColFromCollection(key, this.pivotResultCols);\r\n    }\r\n\r\n    public setPivotResultCols(colDefs: (ColDef | ColGroupDef)[] | null, source: ColumnEventType): void {\r\n        if (!this.colModel.ready) {\r\n            return;\r\n        }\r\n\r\n        // if no cols passed, and we had no cols anyway, then do nothing\r\n        if (colDefs == null && this.pivotResultCols == null) {\r\n            return;\r\n        }\r\n\r\n        if (colDefs) {\r\n            this.processPivotResultColDef(colDefs);\r\n            const balancedTreeResult = _createColumnTree(\r\n                this.beans,\r\n                colDefs,\r\n                false,\r\n                this.pivotResultCols?.tree || this.previousPivotResultCols || undefined,\r\n                source\r\n            );\r\n            _destroyColumnTree(this.beans, this.pivotResultCols?.tree, balancedTreeResult.columnTree);\r\n\r\n            const tree = balancedTreeResult.columnTree;\r\n            const treeDepth = balancedTreeResult.treeDept;\r\n            const list = _getColumnsFromTree(tree);\r\n            const map = {};\r\n\r\n            this.pivotResultCols = { tree, treeDepth, list, map };\r\n            this.pivotResultCols.list.forEach((col) => (this.pivotResultCols!.map[col.getId()] = col));\r\n            const hasPreviousCols = !!this.previousPivotResultCols;\r\n            this.previousPivotResultCols = null;\r\n            this.colModel.refreshCols(!hasPreviousCols);\r\n        } else {\r\n            this.previousPivotResultCols = this.pivotResultCols ? this.pivotResultCols.tree : null;\r\n            this.pivotResultCols = null;\r\n\r\n            this.colModel.refreshCols(false);\r\n        }\r\n        this.visibleCols.refresh(source);\r\n    }\r\n\r\n    private processPivotResultColDef(colDefs: (ColDef | ColGroupDef)[] | null) {\r\n        const columnCallback = this.gos.get('processPivotResultColDef');\r\n        const groupCallback = this.gos.get('processPivotResultColGroupDef');\r\n\r\n        if (!columnCallback && !groupCallback) {\r\n            return undefined;\r\n        }\r\n\r\n        const searchForColDefs = (colDefs2: (ColDef | ColGroupDef)[]): void => {\r\n            colDefs2.forEach((abstractColDef: AbstractColDef) => {\r\n                const isGroup = _exists((abstractColDef as any).children);\r\n                if (isGroup) {\r\n                    const colGroupDef = abstractColDef as ColGroupDef;\r\n                    if (groupCallback) {\r\n                        groupCallback(colGroupDef);\r\n                    }\r\n                    searchForColDefs(colGroupDef.children);\r\n                } else {\r\n                    const colDef = abstractColDef as ColDef;\r\n                    if (columnCallback) {\r\n                        columnCallback(colDef);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        if (colDefs) {\r\n            searchForColDefs(colDefs);\r\n        }\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    ChangedPath,\r\n    ClientSideRowModelStage,\r\n    ColDef,\r\n    ColumnModel,\r\n    GridOptions,\r\n    IColsService,\r\n    IPivotResultColsService,\r\n    IRowNodeStage,\r\n    NamedBean,\r\n    RowNode,\r\n    StageExecuteParams,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _missing } from 'ag-grid-community';\r\n\r\nimport type { PivotColDefService } from './pivotColDefService';\r\n\r\nconst EXCEEDED_MAX_UNIQUE_VALUES = 'Exceeded maximum allowed pivot column count.';\r\n\r\nexport class PivotStage extends BeanStub implements NamedBean, IRowNodeStage {\r\n    beanName = 'pivotStage' as const;\r\n\r\n    public refreshProps: Set<keyof GridOptions<any>> = new Set([\r\n        'removePivotHeaderRowWhenSingleValueColumn',\r\n        'pivotRowTotals',\r\n        'pivotColumnGroupTotals',\r\n        'suppressExpandablePivotGroups',\r\n    ]);\r\n    public step: ClientSideRowModelStage = 'pivot';\r\n\r\n    private valueSvc: ValueService;\r\n    private colModel: ColumnModel;\r\n    private pivotResultCols: IPivotResultColsService;\r\n    private rowGroupColsSvc?: IColsService;\r\n    private valueColsSvc?: IColsService;\r\n    private pivotColsSvc?: IColsService;\r\n    private pivotColDefSvc: PivotColDefService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.valueSvc = beans.valueSvc;\r\n        this.colModel = beans.colModel;\r\n        this.pivotResultCols = beans.pivotResultCols!;\r\n        this.rowGroupColsSvc = beans.rowGroupColsSvc;\r\n        this.valueColsSvc = beans.valueColsSvc;\r\n        this.pivotColsSvc = beans.pivotColsSvc;\r\n        this.pivotColDefSvc = beans.pivotColDefSvc as PivotColDefService;\r\n    }\r\n\r\n    private uniqueValues: any = {};\r\n\r\n    private pivotColumnDefs: ColDef[];\r\n\r\n    private aggregationColumnsHashLastTime: string | null;\r\n    private aggregationFuncsHashLastTime: string;\r\n\r\n    private groupColumnsHashLastTime: string | null;\r\n\r\n    private pivotRowTotalsLastTime: GridOptions['pivotRowTotals'];\r\n    private pivotColumnGroupTotalsLastTime: GridOptions['pivotColumnGroupTotals'];\r\n    private suppressExpandablePivotGroupsLastTime: GridOptions['suppressExpandablePivotGroups'];\r\n    private removePivotHeaderRowWhenSingleValueColumnLastTime: GridOptions['removePivotHeaderRowWhenSingleValueColumn'];\r\n\r\n    private lastTimeFailed = false;\r\n\r\n    private maxUniqueValues: number = -1;\r\n\r\n    public execute(params: StageExecuteParams): void {\r\n        const changedPath = params.changedPath;\r\n        if (this.colModel.isPivotActive()) {\r\n            this.executePivotOn(changedPath!);\r\n        } else {\r\n            this.executePivotOff(changedPath!);\r\n        }\r\n    }\r\n\r\n    private executePivotOff(changedPath: ChangedPath): void {\r\n        this.aggregationColumnsHashLastTime = null;\r\n        this.uniqueValues = {};\r\n        if (this.pivotResultCols.isPivotResultColsPresent()) {\r\n            this.pivotResultCols.setPivotResultCols(null, 'rowModelUpdated');\r\n            if (changedPath) {\r\n                changedPath.active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    private executePivotOn(changedPath: ChangedPath): void {\r\n        const numberOfAggregationColumns = this.valueColsSvc?.columns.length ?? 1;\r\n\r\n        // As unique values creates one column per aggregation column, divide max columns by number of aggregation columns\r\n        // to get the max number of unique values.\r\n        const configuredMaxCols = this.gos.get('pivotMaxGeneratedColumns');\r\n        this.maxUniqueValues = configuredMaxCols === -1 ? -1 : configuredMaxCols / numberOfAggregationColumns;\r\n        let uniqueValues;\r\n        try {\r\n            // try catch is used to force execution to stop when the max count is exceeded.\r\n            uniqueValues = this.bucketUpRowNodes(changedPath);\r\n        } catch (e) {\r\n            // message is checked rather than inheritance as the build seems to break instanceof\r\n            if (e.message === EXCEEDED_MAX_UNIQUE_VALUES) {\r\n                this.pivotResultCols.setPivotResultCols([], 'rowModelUpdated');\r\n                this.eventSvc.dispatchEvent({\r\n                    type: 'pivotMaxColumnsExceeded',\r\n                    message: e.message,\r\n                });\r\n                this.lastTimeFailed = true;\r\n                return;\r\n            }\r\n            throw e;\r\n        }\r\n\r\n        const uniqueValuesChanged = this.setUniqueValues(uniqueValues);\r\n\r\n        const aggregationColumns = this.valueColsSvc?.columns ?? [];\r\n        const aggregationColumnsHash = aggregationColumns\r\n            .map((column) => `${column.getId()}-${column.getColDef().headerName}`)\r\n            .join('#');\r\n        const aggregationFuncsHash = aggregationColumns.map((column) => column.getAggFunc()!.toString()).join('#');\r\n\r\n        const aggregationColumnsChanged = this.aggregationColumnsHashLastTime !== aggregationColumnsHash;\r\n        const aggregationFuncsChanged = this.aggregationFuncsHashLastTime !== aggregationFuncsHash;\r\n        this.aggregationColumnsHashLastTime = aggregationColumnsHash;\r\n        this.aggregationFuncsHashLastTime = aggregationFuncsHash;\r\n\r\n        const groupColumnsHash = (this.rowGroupColsSvc?.columns ?? []).map((column) => column.getId()).join('#');\r\n        const groupColumnsChanged = groupColumnsHash !== this.groupColumnsHashLastTime;\r\n        this.groupColumnsHashLastTime = groupColumnsHash;\r\n\r\n        const pivotRowTotals = this.gos.get('pivotRowTotals');\r\n        const pivotColumnGroupTotals = this.gos.get('pivotColumnGroupTotals');\r\n        const suppressExpandablePivotGroups = this.gos.get('suppressExpandablePivotGroups');\r\n        const removePivotHeaderRowWhenSingleValueColumn = this.gos.get('removePivotHeaderRowWhenSingleValueColumn');\r\n\r\n        const anyGridOptionsChanged =\r\n            pivotRowTotals !== this.pivotRowTotalsLastTime ||\r\n            pivotColumnGroupTotals !== this.pivotColumnGroupTotalsLastTime ||\r\n            suppressExpandablePivotGroups !== this.suppressExpandablePivotGroupsLastTime ||\r\n            removePivotHeaderRowWhenSingleValueColumn !== this.removePivotHeaderRowWhenSingleValueColumnLastTime;\r\n\r\n        this.pivotRowTotalsLastTime = pivotRowTotals;\r\n        this.pivotColumnGroupTotalsLastTime = pivotColumnGroupTotals;\r\n        this.suppressExpandablePivotGroupsLastTime = suppressExpandablePivotGroups;\r\n        this.removePivotHeaderRowWhenSingleValueColumnLastTime = removePivotHeaderRowWhenSingleValueColumn;\r\n\r\n        if (\r\n            this.lastTimeFailed ||\r\n            uniqueValuesChanged ||\r\n            aggregationColumnsChanged ||\r\n            groupColumnsChanged ||\r\n            aggregationFuncsChanged ||\r\n            anyGridOptionsChanged\r\n        ) {\r\n            const { pivotColumnGroupDefs, pivotColumnDefs } = this.pivotColDefSvc.createPivotColumnDefs(\r\n                this.uniqueValues\r\n            );\r\n            this.pivotColumnDefs = pivotColumnDefs;\r\n            this.pivotResultCols.setPivotResultCols(pivotColumnGroupDefs, 'rowModelUpdated');\r\n            // because the secondary columns have changed, then the aggregation needs to visit the whole\r\n            // tree again, so we make the changedPath not active, to force aggregation to visit all paths.\r\n            if (changedPath) {\r\n                changedPath.active = false;\r\n            }\r\n        }\r\n        this.lastTimeFailed = false;\r\n    }\r\n\r\n    private setUniqueValues(newValues: any): boolean {\r\n        const json1 = JSON.stringify(newValues);\r\n        const json2 = JSON.stringify(this.uniqueValues);\r\n\r\n        const uniqueValuesChanged = json1 !== json2;\r\n\r\n        // we only continue the below if the unique values are different, as otherwise\r\n        // the result will be the same as the last time we did it\r\n        if (uniqueValuesChanged) {\r\n            this.uniqueValues = newValues;\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private currentUniqueCount = 0;\r\n    private bucketUpRowNodes(changedPath: ChangedPath): any {\r\n        this.currentUniqueCount = 0;\r\n        // accessed from inside inner function\r\n        const uniqueValues: any = {};\r\n\r\n        // ensure childrenMapped is cleared, as if a node has been filtered out it should not have mapped children.\r\n        changedPath.forEachChangedNodeDepthFirst((node) => {\r\n            if (node.leafGroup) {\r\n                node.childrenMapped = null;\r\n            }\r\n        });\r\n\r\n        const recursivelyBucketFilteredChildren = (node: RowNode) => {\r\n            if (node.leafGroup) {\r\n                this.bucketRowNode(node, uniqueValues);\r\n            } else {\r\n                node.childrenAfterFilter?.forEach(recursivelyBucketFilteredChildren);\r\n            }\r\n        };\r\n\r\n        changedPath.executeFromRootNode(recursivelyBucketFilteredChildren);\r\n\r\n        return uniqueValues;\r\n    }\r\n\r\n    private bucketRowNode(rowNode: RowNode, uniqueValues: any): void {\r\n        const pivotColumns = this.pivotColsSvc?.columns;\r\n\r\n        if (pivotColumns?.length === 0) {\r\n            rowNode.childrenMapped = null;\r\n        } else {\r\n            rowNode.childrenMapped = this.bucketChildren(rowNode.childrenAfterFilter!, pivotColumns, 0, uniqueValues);\r\n        }\r\n\r\n        if (rowNode.sibling) {\r\n            rowNode.sibling.childrenMapped = rowNode.childrenMapped;\r\n        }\r\n    }\r\n\r\n    private bucketChildren(\r\n        children: RowNode[],\r\n        pivotColumns: AgColumn[] = [],\r\n        pivotIndex: number,\r\n        uniqueValues: any\r\n    ): Record<string, any> {\r\n        const mappedChildren: Record<string, RowNode[]> = {};\r\n        const pivotColumn = pivotColumns[pivotIndex];\r\n\r\n        // map the children out based on the pivot column\r\n        children.forEach((child: RowNode) => {\r\n            let key: string = this.valueSvc.getKeyForNode(pivotColumn, child);\r\n\r\n            if (_missing(key)) {\r\n                key = '';\r\n            }\r\n\r\n            if (!uniqueValues[key]) {\r\n                this.currentUniqueCount += 1;\r\n                uniqueValues[key] = {};\r\n\r\n                const doesGeneratedColMaxExist = this.maxUniqueValues !== -1;\r\n                const hasExceededColMax = this.currentUniqueCount > this.maxUniqueValues;\r\n                if (doesGeneratedColMaxExist && hasExceededColMax) {\r\n                    // throw an error to prevent all additional execution and escape the loops.\r\n                    throw Error(EXCEEDED_MAX_UNIQUE_VALUES);\r\n                }\r\n            }\r\n\r\n            if (!mappedChildren[key]) {\r\n                mappedChildren[key] = [];\r\n            }\r\n            mappedChildren[key].push(child);\r\n        });\r\n\r\n        // if it's the last pivot column, return as is, otherwise go one level further in the map\r\n        if (pivotIndex === pivotColumns.length - 1) {\r\n            return mappedChildren;\r\n        } else {\r\n            const result: Record<string, any> = {};\r\n\r\n            for (const [key, value] of Object.entries(mappedChildren)) {\r\n                result[key] = this.bucketChildren(value, pivotColumns, pivotIndex + 1, uniqueValues[key]);\r\n            }\r\n\r\n            return result;\r\n        }\r\n    }\r\n\r\n    public getPivotColumnDefs(): ColDef[] {\r\n        return this.pivotColumnDefs;\r\n    }\r\n}\r\n", "import type {\r\n    AbstractClientSideNodeManager,\r\n    IClientSideNodeManager,\r\n    NamedBean,\r\n    RefreshModelParams,\r\n    RowNode,\r\n} from 'ag-grid-community';\r\nimport { ChangedPath, _error, _getRowIdCallback, _warn } from 'ag-grid-community';\r\n\r\nimport { AbstractClientSideTreeNodeManager } from './abstractClientSideTreeNodeManager';\r\nimport { makeFieldPathGetter } from './fieldAccess';\r\nimport type { DataFieldGetter } from './fieldAccess';\r\nimport type { TreeNode } from './treeNode';\r\nimport type { TreeRow } from './treeRow';\r\n\r\nexport class ClientSideChildrenTreeNodeManager<TData>\r\n    extends AbstractClientSideTreeNodeManager<TData>\r\n    implements IClientSideNodeManager<TData>, NamedBean\r\n{\r\n    beanName = 'csrmChildrenTreeNodeSvc' as const;\r\n\r\n    private childrenGetter: DataFieldGetter<TData, TData[] | null | undefined> | null = null;\r\n\r\n    public override get treeData(): boolean {\r\n        return this.gos.get('treeData');\r\n    }\r\n\r\n    public override extractRowData(): TData[] | null | undefined {\r\n        const treeRoot = this.treeRoot;\r\n        return treeRoot && Array.from(treeRoot.enumChildren(), (node) => node.row!.data);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n\r\n        // Forcefully deallocate memory\r\n        this.childrenGetter = null;\r\n    }\r\n\r\n    public override activate(rootNode: RowNode<TData>): void {\r\n        const oldChildrenGetter = this.childrenGetter;\r\n        const childrenField = this.gos.get('treeDataChildrenField' as any);\r\n        if (!oldChildrenGetter || oldChildrenGetter.path !== childrenField) {\r\n            this.childrenGetter = makeFieldPathGetter(childrenField);\r\n        }\r\n\r\n        super.activate(rootNode);\r\n    }\r\n\r\n    protected override loadNewRowData(rowData: TData[]): void {\r\n        const treeRoot = this.treeRoot!;\r\n        const rootNode = this.rootNode!;\r\n        const childrenGetter = this.childrenGetter;\r\n\r\n        const processedData = new Map<TData, RowNode<TData>>();\r\n        const allLeafChildren: TreeRow<TData>[] = [];\r\n\r\n        rootNode.allLeafChildren = allLeafChildren;\r\n\r\n        this.treeClear(treeRoot);\r\n        treeRoot.setRow(rootNode);\r\n\r\n        const processChild = (node: TreeNode, data: TData) => {\r\n            let row = processedData.get(data);\r\n            if (row !== undefined) {\r\n                _error(2, { nodeId: row.id }); // Duplicate node\r\n                return;\r\n            }\r\n\r\n            row = this.createRowNode(data, allLeafChildren.length);\r\n            processedData.set(data, row);\r\n            allLeafChildren.push(row);\r\n\r\n            node = node.upsertKey(row.id!);\r\n            this.treeSetRow(node, row, true);\r\n            const children = childrenGetter?.(data);\r\n            if (children) {\r\n                for (let i = 0, len = children.length; i < len; ++i) {\r\n                    processChild(node, children[i]);\r\n                }\r\n            }\r\n        };\r\n        for (let i = 0, len = rowData.length; i < len; ++i) {\r\n            processChild(treeRoot, rowData[i]);\r\n        }\r\n\r\n        this.treeCommit();\r\n    }\r\n\r\n    public override setImmutableRowData(params: RefreshModelParams<TData>, rowData: TData[]): void {\r\n        const gos = this.gos;\r\n        const treeRoot = this.treeRoot!;\r\n        const rootNode = this.rootNode!;\r\n        const childrenGetter = this.childrenGetter;\r\n        const getRowIdFunc = _getRowIdCallback(gos)!;\r\n        const canReorder = !gos.get('suppressMaintainUnsortedOrder');\r\n\r\n        const processedData = new Map<TData, AbstractClientSideNodeManager.RowNode<TData>>();\r\n\r\n        const changedPath = new ChangedPath(false, rootNode);\r\n        params.changedPath = changedPath;\r\n\r\n        const changedRowNodes = params.changedRowNodes!;\r\n\r\n        const oldAllLeafChildren = rootNode.allLeafChildren;\r\n        const allLeafChildren: TreeRow[] = [];\r\n        const nodesToUnselect: TreeRow<TData>[] = [];\r\n\r\n        let orderChanged = false;\r\n        let rowsChanged = false;\r\n\r\n        const processChildrenNoReorder = (node: TreeNode, children: TData[]): void => {\r\n            for (let i = 0, len = children.length; i < len; ++i) {\r\n                processChild(node, children[i]);\r\n            }\r\n        };\r\n\r\n        const processChildrenReOrder = (node: TreeNode, children: TData[]): void => {\r\n            const childrenLen = children?.length;\r\n            let inOrder = true;\r\n            let prevIndex = -1;\r\n            for (let i = 0; i < childrenLen; ++i) {\r\n                const oldSourceRowIndex = processChild(node, children[i]);\r\n                if (oldSourceRowIndex >= 0) {\r\n                    if (oldSourceRowIndex < prevIndex) {\r\n                        inOrder = false;\r\n                    }\r\n                    prevIndex = oldSourceRowIndex;\r\n                }\r\n            }\r\n            if (!inOrder) {\r\n                orderChanged = true;\r\n                if (!node.childrenChanged) {\r\n                    node.childrenChanged = true;\r\n                    node.invalidate();\r\n                }\r\n            }\r\n        };\r\n\r\n        const processChildren = canReorder ? processChildrenReOrder : processChildrenNoReorder;\r\n\r\n        const processChild = (parent: TreeNode, data: TData): number => {\r\n            let row = processedData.get(data);\r\n            if (row !== undefined) {\r\n                _warn(2, { nodeId: row.id }); // Duplicate node\r\n                return -1;\r\n            }\r\n\r\n            const id = getRowIdFunc({ data, level: parent.level + 1 });\r\n\r\n            let created = false;\r\n            row = this.getRowNode(id) as TreeRow<TData> | undefined;\r\n            if (row) {\r\n                if (row.data !== data) {\r\n                    changedRowNodes.update(row);\r\n                    row.updateData(data);\r\n                    if (!row.selectable && row.isSelected()) {\r\n                        nodesToUnselect.push(row);\r\n                    }\r\n                }\r\n            } else {\r\n                row = this.createRowNode(data, -1);\r\n                changedRowNodes.add(row);\r\n                created = true;\r\n            }\r\n\r\n            processedData.set(data, row);\r\n\r\n            let oldSourceRowIndex: number;\r\n            let node: TreeNode;\r\n            if (canReorder) {\r\n                node = parent.appendKey(row.id!);\r\n                oldSourceRowIndex = row.sourceRowIndex;\r\n                row.sourceRowIndex = allLeafChildren.push(row) - 1;\r\n            } else {\r\n                node = parent.upsertKey(row.id!);\r\n                oldSourceRowIndex = -1;\r\n            }\r\n\r\n            if (this.treeSetRow(node, row, created)) {\r\n                rowsChanged = true;\r\n            }\r\n\r\n            const children = childrenGetter?.(data);\r\n            if (children) {\r\n                processChildren(node, children);\r\n            }\r\n\r\n            return oldSourceRowIndex;\r\n        };\r\n\r\n        processChildren(treeRoot, rowData);\r\n\r\n        if (oldAllLeafChildren) {\r\n            for (let i = 0, len = oldAllLeafChildren.length; i < len; ++i) {\r\n                const row = oldAllLeafChildren[i];\r\n                const node = row.treeNode as TreeNode | null;\r\n                if (node) {\r\n                    const data = row.data;\r\n                    if (data && !processedData.has(data)) {\r\n                        changedRowNodes.remove(row);\r\n                        this.treeRemove(node, row);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!canReorder) {\r\n            // To maintain the old order, we need to process all children as they appear in the node, recursively\r\n            const appendChildren = (node: TreeNode): void => {\r\n                for (const child of node.enumChildren()) {\r\n                    const row = child.row;\r\n                    if (row) {\r\n                        row.sourceRowIndex = allLeafChildren.push(row) - 1;\r\n                        appendChildren(child);\r\n                    }\r\n                }\r\n            };\r\n            appendChildren(treeRoot);\r\n        }\r\n\r\n        rootNode.allLeafChildren = allLeafChildren;\r\n        treeRoot.allLeafChildren = allLeafChildren;\r\n\r\n        if (nodesToUnselect.length) {\r\n            this.deselectNodes(nodesToUnselect);\r\n        }\r\n\r\n        this.treeCommit(changedPath);\r\n\r\n        const sibling = rootNode.sibling;\r\n        if (sibling) {\r\n            sibling.allLeafChildren = allLeafChildren;\r\n        }\r\n\r\n        if (rowsChanged || orderChanged) {\r\n            params.step = 'group';\r\n            params.rowDataUpdated = true;\r\n            params.rowNodesOrderChanged = orderChanged;\r\n        }\r\n    }\r\n\r\n    public override refreshModel(params: RefreshModelParams<TData>): void {\r\n        const { rootNode, treeRoot } = this;\r\n        if (!treeRoot) {\r\n            return; // Not active, destroyed\r\n        }\r\n\r\n        if (params.changedProps?.has('treeData') && !params.newData) {\r\n            treeRoot.setRow(rootNode);\r\n            const allLeafChildren = rootNode?.allLeafChildren;\r\n            if (allLeafChildren) {\r\n                for (let i = 0, len = allLeafChildren.length; i < len; ++i) {\r\n                    const row = allLeafChildren[i];\r\n                    row.groupData = null;\r\n                    row.treeNode?.invalidate();\r\n                }\r\n            }\r\n            this.treeCommit();\r\n        }\r\n\r\n        super.refreshModel(params);\r\n    }\r\n}\r\n", "import type {\r\n    ChangedPath,\r\n    InitialGroupOrderComparatorParams,\r\n    IsGroupOpenByDefaultParams,\r\n    RefreshModelParams,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport { AbstractClientSideNodeManager, RowNode, _ROW_ID_PREFIX_ROW_GROUP, _warn } from 'ag-grid-community';\r\n\r\nimport { setRowNodeGroup } from '../rowGrouping/rowGroupingUtils';\r\nimport { TreeNode } from './treeNode';\r\nimport type { TreeRow } from './treeRow';\r\nimport {\r\n    clearTreeRowFlags,\r\n    isTreeRowCommitted,\r\n    isTreeRowExpandedInitialized,\r\n    isTreeRowKeyChanged,\r\n    isTreeRowPathChanged,\r\n    isTreeRowUpdated,\r\n    markTreeRowCommitted,\r\n    markTreeRowPathChanged,\r\n    setTreeRowExpandedInitialized,\r\n    setTreeRowKeyChanged,\r\n    setTreeRowUpdated,\r\n} from './treeRow';\r\n\r\ninterface TreeCommitDetails<TData = any> {\r\n    rootNode: AbstractClientSideNodeManager.RootNode<TData>;\r\n    changedPath: ChangedPath | undefined;\r\n    treeData: boolean;\r\n    expandByDefault: number;\r\n    isGroupOpenByDefault: IsGroupOpenByDefaultCallback;\r\n}\r\n\r\nconst getExpandedInitialValue = (details: TreeCommitDetails, oldRow: RowNode | null, row: RowNode): boolean => {\r\n    if (\r\n        oldRow !== row &&\r\n        oldRow !== null &&\r\n        oldRow.group &&\r\n        isTreeRowExpandedInitialized(oldRow) &&\r\n        !details.isGroupOpenByDefault // If we have a callback, we use that instead\r\n    ) {\r\n        // When removing a group and so it gets replaced by a filler or new node, its expanded state is retained. See AG-12591\r\n        return oldRow.expanded;\r\n    }\r\n\r\n    const userCallback = details.isGroupOpenByDefault;\r\n    return userCallback\r\n        ? userCallback({\r\n              rowNode: row,\r\n              field: row.field!,\r\n              key: row.key!,\r\n              level: row.level,\r\n              rowGroupColumn: row.rowGroupColumn!,\r\n          }) == true\r\n        : details.expandByDefault === -1 || row.level < details.expandByDefault;\r\n};\r\n\r\nexport type IsGroupOpenByDefaultCallback =\r\n    | ((params: WithoutGridCommon<IsGroupOpenByDefaultParams>) => boolean)\r\n    | undefined;\r\n\r\nexport type InitialGroupOrderComparatorCallback =\r\n    | ((params: WithoutGridCommon<InitialGroupOrderComparatorParams>) => number)\r\n    | undefined;\r\n\r\nexport abstract class AbstractClientSideTreeNodeManager<TData> extends AbstractClientSideNodeManager<TData> {\r\n    private oldGroupDisplayColIds: string = '';\r\n\r\n    /** Rows that are pending deletion, this.commitDeletedRows() will finalize removal. */\r\n    private rowsPendingDestruction: Set<TreeRow> | null = null;\r\n\r\n    /** The root node of the tree. */\r\n    public treeRoot: TreeNode | null = null;\r\n\r\n    public override activate(rootNode: RowNode<TData>): void {\r\n        super.activate(rootNode);\r\n        (this.treeRoot ??= new TreeNode(null, '', -1)).setRow(rootNode);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n\r\n        // Forcefully deallocate memory\r\n        this.treeRoot = null;\r\n        this.rowsPendingDestruction = null;\r\n        this.oldGroupDisplayColIds = '';\r\n    }\r\n\r\n    public override deactivate(): void {\r\n        const treeRoot = this.treeRoot;\r\n        if (treeRoot) {\r\n            const rootRow = treeRoot.row;\r\n            if (rootRow !== null) {\r\n                treeRoot.removeRow(rootRow);\r\n                clearTreeRowFlags(rootRow);\r\n            }\r\n            this.treeDestroy(treeRoot);\r\n        }\r\n        this.commitDestroyedRows();\r\n\r\n        super.deactivate();\r\n        this.treeRoot = null;\r\n        this.oldGroupDisplayColIds = '';\r\n    }\r\n\r\n    /** Add or updates the row to a non-root node, preparing the tree correctly for the commit. */\r\n    protected treeSetRow(node: TreeNode, newRow: RowNode, created: boolean): boolean {\r\n        const { level, row: oldRow } = node;\r\n        if (level < 0) {\r\n            return false; // Cannot overwrite the root row\r\n        }\r\n\r\n        let invalidate = false;\r\n        if (oldRow !== newRow) {\r\n            const prevNode = newRow.treeNode as TreeNode | null;\r\n            if (prevNode !== null && prevNode !== node) {\r\n                // The new row is somewhere else in the tree, we need to move it.\r\n                prevNode.removeRow(newRow);\r\n                prevNode.invalidate();\r\n            }\r\n\r\n            if (oldRow === null) {\r\n                // No previous row, just set the new row.\r\n                node.setRow(newRow);\r\n                invalidate = true;\r\n            } else if (!oldRow.data) {\r\n                // We are replacing a filler row with a real row.\r\n                node.setRow(newRow);\r\n                this.destroyRow(oldRow, true); // Delete the filler node\r\n                invalidate = true;\r\n            } else {\r\n                // We have a new non-filler row, but we had already one, this is a duplicate\r\n                if (node.addDuplicateRow(newRow)) {\r\n                    invalidate = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!created && !isTreeRowUpdated(newRow)) {\r\n            setTreeRowUpdated(newRow);\r\n            invalidate = true;\r\n        }\r\n\r\n        if (invalidate) {\r\n            node.invalidate();\r\n        }\r\n\r\n        this.rowsPendingDestruction?.delete(newRow); // This row is not deleted.\r\n\r\n        return invalidate;\r\n    }\r\n\r\n    /**\r\n     * Overwrites the row property of a non-root node to null.\r\n     * @returns The previous row, if any, that was overwritten.\r\n     */\r\n    protected treeRemove(node: TreeNode, oldRow: RowNode): void {\r\n        const { parent, level } = node;\r\n\r\n        if (level < 0) {\r\n            return; // Cannot overwrite a null node or the root row\r\n        }\r\n\r\n        let invalidate = false;\r\n\r\n        if (node.removeRow(oldRow)) {\r\n            invalidate = true;\r\n            if (parent) {\r\n                parent.childrenChanged = true;\r\n            }\r\n            this.destroyRow(oldRow, !oldRow.data);\r\n        }\r\n\r\n        if (invalidate) {\r\n            node.invalidate();\r\n        }\r\n    }\r\n\r\n    /** Commit the changes performed to the tree */\r\n    protected treeCommit(changedPath?: ChangedPath): void {\r\n        const { treeRoot, rootNode } = this;\r\n        if (!treeRoot || !rootNode) {\r\n            return;\r\n        }\r\n\r\n        const treeData = this.treeData;\r\n\r\n        const details: TreeCommitDetails<TData> = {\r\n            rootNode,\r\n            changedPath,\r\n            treeData,\r\n            expandByDefault: this.gos.get('groupDefaultExpanded'),\r\n            isGroupOpenByDefault: this.gos.getCallback('isGroupOpenByDefault'),\r\n        };\r\n\r\n        this.treeCommitChildren(details, treeRoot, false);\r\n\r\n        const rootRow = treeRoot.row;\r\n        if (rootRow) {\r\n            if (treeData) {\r\n                rootRow.leafGroup = false; // no pivoting with tree data\r\n            }\r\n\r\n            if (treeRoot.childrenChanged) {\r\n                if (treeRoot.updateChildrenAfterGroup(treeData)) {\r\n                    markTreeRowPathChanged(rootRow);\r\n                }\r\n            }\r\n\r\n            if (isTreeRowPathChanged(rootRow)) {\r\n                if (details.changedPath?.active) {\r\n                    details.changedPath.addParentNode(rootRow);\r\n                }\r\n            }\r\n\r\n            markTreeRowCommitted(rootRow);\r\n\r\n            rootRow.updateHasChildren();\r\n        }\r\n\r\n        this.commitDestroyedRows();\r\n\r\n        this.beans.selectionSvc?.updateSelectableAfterGrouping(changedPath);\r\n    }\r\n\r\n    /** Calls commitChild for each invalidated child, recursively. We commit only the invalidated paths. */\r\n    private treeCommitChildren(details: TreeCommitDetails, parent: TreeNode, collapsed: boolean): void {\r\n        while (true) {\r\n            const child = parent.dequeueInvalidated();\r\n            if (child === null) {\r\n                break;\r\n            }\r\n            if (child.parent === parent) {\r\n                this.treeCommitChild(details, child, collapsed || !(parent.row?.expanded ?? true));\r\n            }\r\n        }\r\n\r\n        // Ensure the childrenAfterGroup array is up to date with treeData flag\r\n        parent.childrenChanged ||= (details.treeData ? parent.size : 0) !== parent.row!.childrenAfterGroup?.length;\r\n    }\r\n\r\n    /** Commit the changes performed to a node and its children */\r\n    private treeCommitChild(details: TreeCommitDetails, node: TreeNode, collapsed: boolean): void {\r\n        if (node.isEmptyFillerNode()) {\r\n            this.treeClear(node);\r\n            return; // Removed. No need to process children.\r\n        }\r\n\r\n        this.treeCommitPreOrder(details, node);\r\n        this.treeCommitChildren(details, node, collapsed);\r\n\r\n        if (node.isEmptyFillerNode()) {\r\n            this.treeClear(node);\r\n            return; // Removed. No need to process further\r\n        }\r\n\r\n        this.treeCommitPostOrder(details, node, collapsed);\r\n    }\r\n\r\n    private treeCommitPreOrder(details: TreeCommitDetails, node: TreeNode): void {\r\n        let row = node.row;\r\n\r\n        if (row === null) {\r\n            row = this.createFillerRow(node);\r\n            node.setRow(row);\r\n        } else {\r\n            row = node.sortFirstDuplicateRow()!; // The main row must have the smallest sourceRowIndex of duplicates\r\n\r\n            if (row.allChildrenCount === undefined) {\r\n                row.allChildrenCount = null; // initialize to null if this field wasn't initialized yet\r\n            }\r\n        }\r\n\r\n        if (details.treeData) {\r\n            row.parent = node.parent!.row;\r\n            if (node.oldRow !== row) {\r\n                // We need to update children rows parents, as the row changed\r\n                for (const child of node.enumChildren()) {\r\n                    const childRow = child.row;\r\n                    if (childRow !== null) {\r\n                        childRow.parent = row;\r\n                    }\r\n                }\r\n            }\r\n\r\n            const key = node.key;\r\n            if (row.key !== key) {\r\n                row.key = key;\r\n                setTreeRowKeyChanged(row);\r\n                this.setGroupData(row, key);\r\n            } else if (!row.groupData) {\r\n                this.setGroupData(row, key);\r\n            }\r\n        } else {\r\n            row.key = node.key;\r\n            row.parent = details.rootNode;\r\n        }\r\n    }\r\n\r\n    private treeCommitPostOrder(details: TreeCommitDetails, node: TreeNode, collapsed: boolean): void {\r\n        const parent = node.parent!;\r\n        const row = node.row!;\r\n        const oldRow = node.oldRow;\r\n        const treeData = details.treeData;\r\n\r\n        if (node.childrenChanged) {\r\n            if (node.updateChildrenAfterGroup(treeData)) {\r\n                markTreeRowPathChanged(row);\r\n            }\r\n        }\r\n\r\n        if (node.leafChildrenChanged) {\r\n            node.updateAllLeafChildren();\r\n        }\r\n\r\n        const hasChildren = !!row.childrenAfterGroup?.length;\r\n        const group = hasChildren || !row.data;\r\n        const oldGroup = row.group;\r\n\r\n        if (oldGroup !== group) {\r\n            markTreeRowPathChanged(row);\r\n            setRowNodeGroup(row, this.beans, group); // Internally calls updateHasChildren\r\n            if (!group && !row.expanded) {\r\n                setTreeRowExpandedInitialized(row, false);\r\n            }\r\n        } else if (row.hasChildren() !== hasChildren) {\r\n            markTreeRowPathChanged(row);\r\n            row.updateHasChildren();\r\n        }\r\n\r\n        if (group && !isTreeRowExpandedInitialized(row)) {\r\n            row.expanded = getExpandedInitialValue(details, oldRow, row);\r\n            setTreeRowExpandedInitialized(row, true);\r\n        }\r\n\r\n        if (isTreeRowUpdated(row)) {\r\n            markTreeRowPathChanged(parent.row!);\r\n\r\n            if (isTreeRowKeyChanged(row)) {\r\n                // hack - if we didn't do this, then renaming a tree item (ie changing rowNode.key) wouldn't get\r\n                // refreshed into the gui.\r\n                // this is needed to kick off the event that rowComp listens to for refresh. this in turn\r\n                // then will get each cell in the row to refresh - which is what we need as we don't know which\r\n                // columns will be displaying the rowNode.key info.\r\n                row.setData(row.data);\r\n            }\r\n        }\r\n\r\n        if (oldRow !== row) {\r\n            node.oldRow = row;\r\n            if (oldRow !== null && (oldGroup || node.size !== 0)) {\r\n                markTreeRowPathChanged(row);\r\n            }\r\n            parent.childrenChanged = true;\r\n            markTreeRowPathChanged(parent.row!);\r\n        }\r\n\r\n        if (isTreeRowPathChanged(row)) {\r\n            if (treeData && details.changedPath?.active) {\r\n                details.changedPath.addParentNode(row);\r\n            } else {\r\n                markTreeRowPathChanged(details.rootNode);\r\n            }\r\n        }\r\n\r\n        markTreeRowCommitted(row);\r\n\r\n        if (node.duplicateRows?.size && !node.duplicateRowsWarned) {\r\n            node.duplicateRowsWarned = true;\r\n            _warn(186, {\r\n                rowId: row.id,\r\n                rowData: row.data,\r\n                duplicateRowsData: Array.from(node.duplicateRows).map((r) => r.data),\r\n            });\r\n        }\r\n\r\n        if (collapsed && row.rowIndex !== null) {\r\n            row.clearRowTopAndRowIndex(); // Hidden.\r\n        }\r\n\r\n        const sourceIdx = node.getNewSourceIdx();\r\n        const prevRowIdx = node.sourceIdx;\r\n        if (prevRowIdx !== sourceIdx) {\r\n            node.sourceIdx = sourceIdx;\r\n            if (prevRowIdx !== -1) {\r\n                // TODO: this is not optimal, it has false positives.\r\n                // we could optimize it if we have a way to know if a node\r\n                // is out of order, we could do this by using a linked list instead of a map, so\r\n                // we can directly know if a node is out of order in O(1)\r\n                parent.childrenChanged = true; // The order of children in parent might have changed\r\n            }\r\n        }\r\n    }\r\n\r\n    private createFillerRow(node: TreeNode): RowNode {\r\n        const row = new RowNode(this.beans); // Create a filler node\r\n        row.key = node.key;\r\n        row.group = true;\r\n        row.field = null;\r\n        row.leafGroup = false;\r\n        row.rowGroupIndex = null;\r\n        row.allChildrenCount = null;\r\n\r\n        // Generate a unique id for the filler row\r\n        let id = node.level + '-' + node.key;\r\n        let p = node.parent;\r\n        while (p !== null) {\r\n            const parent = p.parent;\r\n            if (parent === null) {\r\n                break;\r\n            }\r\n            id = `${p.level}-${p.key}-${id}`;\r\n            p = parent;\r\n        }\r\n        row.id = _ROW_ID_PREFIX_ROW_GROUP + id;\r\n\r\n        return row;\r\n    }\r\n\r\n    private setGroupData(row: RowNode, key: string): void {\r\n        const groupData: Record<string, string> = {};\r\n        row.groupData = groupData;\r\n        const groupDisplayCols = this.beans.showRowGroupCols?.getShowRowGroupCols();\r\n        if (groupDisplayCols) {\r\n            for (const col of groupDisplayCols) {\r\n                // newGroup.rowGroupColumn=null when working off GroupInfo, and we always display the group in the group column\r\n                // if rowGroupColumn is present, then it's grid row grouping and we only include if configuration says so\r\n                groupData[col.getColId()] = key;\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Called to clear a subtree. */\r\n    public treeClear(node: TreeNode): void {\r\n        const { parent, oldRow, row, level } = node;\r\n        if (parent !== null && oldRow !== null) {\r\n            parent.childrenChanged = true;\r\n            if (parent.row !== null) {\r\n                markTreeRowPathChanged(parent.row);\r\n            }\r\n        }\r\n        if (row !== null) {\r\n            if (level >= 0) {\r\n                let row = node.row;\r\n                while (row !== null && node.removeRow(row)) {\r\n                    this.destroyRow(row, !row.data);\r\n                    row = node.row;\r\n                }\r\n            }\r\n        }\r\n        for (const child of node.enumChildren()) {\r\n            this.treeClear(child);\r\n        }\r\n        node.destroy();\r\n    }\r\n\r\n    /** Called by the deactivate, to destroy the whole tree. */\r\n    private treeDestroy(node: TreeNode): void {\r\n        const { row, level, duplicateRows } = node;\r\n        if (row) {\r\n            if (level >= 0 && !row.data) {\r\n                this.destroyRow(row, true); // Delete the filler node\r\n            } else {\r\n                clearTreeRowFlags(row); // Just clear the flags\r\n            }\r\n        }\r\n        if (duplicateRows) {\r\n            for (const row of duplicateRows) {\r\n                if (level >= 0 && !row.data) {\r\n                    this.destroyRow(row, true); // Delete filler nodes\r\n                } else {\r\n                    clearTreeRowFlags(row); // Just clear the flags\r\n                }\r\n            }\r\n        }\r\n        for (const child of node.enumChildren()) {\r\n            this.treeDestroy(child);\r\n        }\r\n        node.destroy();\r\n    }\r\n\r\n    /**\r\n     * Finalizes the deletion of a row.\r\n     * @param immediate If true, the row is deleted immediately.\r\n     * If false, the row is marked for deletion, and will be deleted later with this.deleteDeletedRows()\r\n     */\r\n    private destroyRow(row: RowNode, immediate: boolean): void {\r\n        if (row.isSelected()) {\r\n            immediate = false; // Need to be deleted later as we need to unselect it first\r\n        } else if (!isTreeRowCommitted(row)) {\r\n            clearTreeRowFlags(row);\r\n            return; // Never committed, or already deleted, and not selected. Nothing to do.\r\n        }\r\n\r\n        if (!immediate) {\r\n            (this.rowsPendingDestruction ??= new Set()).add(row);\r\n            return; // We will delete it later with commitDeletedRows\r\n        }\r\n\r\n        clearTreeRowFlags(row);\r\n\r\n        // We execute this only if the row was committed at least once before, and not already deleted.\r\n        // this is important for transition, see rowComp removeFirstPassFuncs. when doing animation and\r\n        // remove, if rowTop is still present, the rowComp thinks it's just moved position.\r\n        row.clearRowTopAndRowIndex();\r\n\r\n        row.groupData = null;\r\n    }\r\n\r\n    /**\r\n     * destroyRow can defer the deletion to the end of the commit stage.\r\n     * This method finalizes the deletion of rows that were marked for deletion.\r\n     */\r\n    private commitDestroyedRows() {\r\n        const { rowsPendingDestruction } = this;\r\n        let nodesToUnselect: RowNode[] | null = null;\r\n        if (rowsPendingDestruction !== null) {\r\n            for (const row of rowsPendingDestruction) {\r\n                this.destroyRow(row, true);\r\n                if (row.isSelected()) {\r\n                    (nodesToUnselect ??= []).push(row);\r\n                }\r\n            }\r\n            this.rowsPendingDestruction = null;\r\n        }\r\n        if (nodesToUnselect) {\r\n            this.deselectNodes(nodesToUnselect);\r\n        }\r\n    }\r\n\r\n    public refreshModel(params: RefreshModelParams<TData>): void {\r\n        if (!params.afterColumnsChanged) {\r\n            return; // nothing to do\r\n        }\r\n\r\n        // Check if group data need to be recomputed due to group columns change\r\n\r\n        if (this.treeData) {\r\n            const newGroupDisplayColIds =\r\n                this.beans.showRowGroupCols\r\n                    ?.getShowRowGroupCols()\r\n                    ?.map((c) => c.getId())\r\n                    .join('-') ?? '';\r\n\r\n            // if the group display cols have changed, then we need to update rowNode.groupData\r\n            // (regardless of tree data or row grouping)\r\n            if (this.oldGroupDisplayColIds !== newGroupDisplayColIds) {\r\n                this.oldGroupDisplayColIds = newGroupDisplayColIds;\r\n                const rowNodes = this.rootNode?.childrenAfterGroup;\r\n                if (rowNodes) {\r\n                    for (let i = 0, len = rowNodes.length ?? 0; i < len; ++i) {\r\n                        const rowNode = rowNodes[i];\r\n                        const treeNode = rowNode.treeNode;\r\n                        if (treeNode) {\r\n                            this.setGroupData(rowNode, treeNode.key);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            this.oldGroupDisplayColIds = '';\r\n        }\r\n    }\r\n}\r\n", "import { _EmptyArray } from 'ag-grid-community';\r\nimport type { ITreeNode, RowNode } from 'ag-grid-community';\r\n\r\nimport type { TreeRow } from './treeRow';\r\n\r\nconst treeNodePositionComparer = (a: RowNode, b: RowNode): number => a.treeNode!.sourceIdx - b.treeNode!.sourceIdx;\r\n\r\n/** An empty iterator, to avoid null checking when we iterate the children map */\r\nconst EMPTY_CHILDREN = (_EmptyArray as TreeNode[]).values();\r\n\r\n/** Disassociate a node from a row, breaking the association to the node. Only the row is modified, not the TreeNode. */\r\nconst orphanRow = (row: TreeRow, root: boolean): void => {\r\n    row.parent = null;\r\n    row.treeNode = null;\r\n    if (root) {\r\n        row.childrenAfterGroup = [];\r\n    } else {\r\n        row.level = 0;\r\n        row.childrenAfterGroup = null;\r\n        row.allLeafChildren = null;\r\n    }\r\n};\r\n\r\n/**\r\n * We keep a secondary tree data structure based on TreeNode together with the RowNodes.\r\n * We associate a RowNode with a TreeNode, both storing the row in node.row and by storing the TreeNode in row.treeNode field.\r\n * We break the association when the row is removed or the TreeStrategy destroyed.\r\n * Consider that a TreeNode can contain more than one RowNode if there are duplicates keys in the same group,\r\n * in this case it means that the rows will have the same TreeNode.\r\n *\r\n * TreeStrategy uses a two stage approach both for first time creation and updates.\r\n * Multiple updates interact with the tree, and a commit stage commits all updates reducing expensive computations.\r\n *\r\n * Operations that do not affect the order will invalidate only the affected paths with node.invalidate(),\r\n * so that the commit operation will only update the affected paths without traversing the whole tree.\r\n * Consider that order of invalidated items is not deterministic, so the commit operation should be able to handle any order.\r\n *\r\n * During commit, the childrenAfterGroup and allLeafChildren arrays are rebuilt, and the updates are applied.\r\n * The empty filler nodes nodes are removed.\r\n * Before commit those arrays are NOT representing the truth, so they should not be used.\r\n */\r\nexport class TreeNode implements ITreeNode {\r\n    /** Contains all the children by their key */\r\n    private children: Map<string, TreeNode> | null = null;\r\n\r\n    /**\r\n     * The head of the singly linked list of direct children nodes that are invalidated and need to be committed.\r\n     * We use this so we can invalidate just the path and explore only the invalidated during commit.\r\n     * Also, once a path is invalidated the next invalidation will not add the same node again and stop the recursion quickly.\r\n     */\r\n    private invalidatedHead: TreeNode | null = null;\r\n\r\n    /**\r\n     * The next node in the linked list of parent.invalidatedHead.\r\n     * - undefined: the node is not invalidated (not present in the parent linked list)\r\n     * - null: this is the first and last node in the linked list\r\n     * - TreeNode instance: is the next node in the linked list\r\n     */\r\n    private invalidatedNext: TreeNode | null | undefined = undefined;\r\n\r\n    /** The RowNode associated to this tree node */\r\n    public row: TreeRow | null = null;\r\n\r\n    /** We use this during commit to understand if the row changed. After commit, it will be the same as this.row. */\r\n    public oldRow: TreeRow | null = null;\r\n\r\n    /**\r\n     * There may be duplicate rows if they have the same key.\r\n     * This is NOT an edge case, temporarily duplicates may arise during transactions.\r\n     * For example, think about swapping the paths of two nodes, they will have the same key for a short while.\r\n     */\r\n    public duplicateRows: Set<TreeRow> | null = null;\r\n\r\n    /** We keep the row.childrenAfterGroup here, we just swap arrays when we assign rows */\r\n    public childrenAfterGroup: TreeRow[] = _EmptyArray;\r\n\r\n    /**\r\n     * We keep the row.allLeafChildren here, we just swap arrays when we assign or swap the row to this node.\r\n     * If this is null, we are borrowing the allLeafChildren array from one of the children,\r\n     * in this case the row.allLeafChildren will be the same as one of the childrenAfterGroup[x].allLeafChildren,\r\n     * to get the allLeafChildren if is null, do node.allLeafChildren ?? node.row.allLeafChildren.\r\n     */\r\n    public allLeafChildren: TreeRow[] | null = _EmptyArray;\r\n\r\n    /** Indicates whether childrenAfterGroup might need to be recomputed and sorted. Reset during commit. */\r\n    public childrenChanged: boolean = false;\r\n\r\n    /** Indicates whether allLeafChildren should be recomputed. Reset to false during commit. */\r\n    public leafChildrenChanged: boolean = false;\r\n\r\n    /** This is set if the duplicate key warning was already raised for this node, to reduce the performance hit */\r\n    public duplicateRowsWarned?: boolean;\r\n\r\n    /** The ordering this node had in the previous commit. */\r\n    public sourceIdx: number = -1;\r\n\r\n    public constructor(\r\n        /** The parent node of this node. Is null if destroyed or if is the root. */\r\n        public parent: TreeNode | null,\r\n\r\n        /** The key of this node. */\r\n        public readonly key: string,\r\n\r\n        /** The level of this node. Root has level -1 */\r\n        public readonly level: number\r\n    ) {}\r\n\r\n    /** Returns the number of children in this node */\r\n    public get size(): number {\r\n        return this.children?.size ?? 0;\r\n    }\r\n\r\n    public isEmptyFillerNode(): boolean {\r\n        return !this.row?.data && !this.children?.size;\r\n    }\r\n\r\n    /** Returns an iterator able to iterate all children in this node, in order of insertion */\r\n    public enumChildren(): IterableIterator<TreeNode> {\r\n        return this.children?.values() ?? EMPTY_CHILDREN;\r\n    }\r\n\r\n    /**\r\n     * Gets a node a key in the given parent. If the node does not exists, creates a filler node, with null row.\r\n     * We cast to string just to be sure the user passed a string correctly and not a number or something else.\r\n     * @param key - The key of the node to get.\r\n     * @param append - If true, the node will be moved to the end of the children list.\r\n     * @returns the node at the given key, or a new filler node inserted there if it does not exist.\r\n     */\r\n    public upsertKey(key: string | number): TreeNode {\r\n        if (typeof key !== 'string') {\r\n            key = String(key);\r\n        }\r\n        let node = this.children?.get(key);\r\n        if (!node) {\r\n            node = new TreeNode(this, key, this.level + 1);\r\n            (this.children ??= new Map())?.set(node.key, node); // Add to the map\r\n        }\r\n        return node;\r\n    }\r\n\r\n    /** Same as upsertKey, but moves the node to the end no matter what. */\r\n    public appendKey(key: string | number): TreeNode {\r\n        const children = this.children;\r\n        if (typeof key !== 'string') {\r\n            key = String(key);\r\n        }\r\n        let node = children?.get(key);\r\n        if (node) {\r\n            children!.delete(key); // Remove from the map\r\n            children!.set(key, node); // Reinsert to the map\r\n        } else {\r\n            node = new TreeNode(this, key, this.level + 1);\r\n            (this.children ??= new Map())?.set(node.key, node); // Add to the map\r\n        }\r\n        return node;\r\n    }\r\n\r\n    /** Removes this node from the parent, and free memory. This node cannot be used after this. */\r\n    public destroy(): void {\r\n        const { row, parent } = this;\r\n        if (parent === null) {\r\n            return;\r\n        }\r\n        parent?.children?.delete(this.key);\r\n        if (row !== null) {\r\n            orphanRow(row, true);\r\n        }\r\n        this.parent = null;\r\n    }\r\n\r\n    /**\r\n     * Sets the row for the TreeNode.\r\n     * If the row is already set, it will be replaced with the new row, and the old row will be orphaned.\r\n     * childrenAfterGroup and allLeafChildren will be reassigned.\r\n     * @returns True if the row changed\r\n     */\r\n    public setRow(newRow: TreeRow | null): boolean {\r\n        const { level, row: oldRow, childrenAfterGroup } = this;\r\n        if (level < 0) {\r\n            if (oldRow !== null && oldRow !== newRow) {\r\n                orphanRow(oldRow, true);\r\n            }\r\n        } else {\r\n            if (oldRow === newRow) {\r\n                return false; // Already the same row\r\n            }\r\n            if (oldRow !== null) {\r\n                if (newRow !== null) {\r\n                    newRow.allLeafChildren = oldRow.allLeafChildren ?? this.allLeafChildren ?? _EmptyArray;\r\n                }\r\n                orphanRow(oldRow, false); // Unlink the old row, is being replaced\r\n            } else if (newRow !== null) {\r\n                newRow.allLeafChildren = this.allLeafChildren ?? _EmptyArray;\r\n            }\r\n        }\r\n        if (newRow !== null) {\r\n            newRow.level = level;\r\n            newRow.childrenAfterGroup = childrenAfterGroup;\r\n            newRow.treeNode = this;\r\n        }\r\n        this.row = newRow;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Removes a row from the tree node.\r\n     * If the row is the main row, it will be replaced with the first row in the duplicate rows, if any.\r\n     * If the row is a duplicate row, it will be removed from the duplicate rows.\r\n     * @param rowToRemove - The row to be removed.\r\n     * @returns `true` if the row was successfully removed, `false` if the row was not found.\r\n     */\r\n    public removeRow(rowToRemove: TreeRow): boolean {\r\n        const { level, row, duplicateRows, childrenAfterGroup } = this;\r\n        if (row === rowToRemove) {\r\n            const duplicate = this.popDuplicateRow();\r\n            if (duplicate) {\r\n                this.row = duplicate;\r\n                duplicate.childrenAfterGroup = childrenAfterGroup;\r\n                if (level >= 0) {\r\n                    duplicate.allLeafChildren = row.allLeafChildren ?? this.allLeafChildren ?? _EmptyArray;\r\n                }\r\n            } else {\r\n                this.row = null;\r\n            }\r\n        } else {\r\n            // Delete from the duplicate rows\r\n            if (!duplicateRows?.delete(rowToRemove)) {\r\n                return false; // Not found\r\n            }\r\n            if (duplicateRows.size === 0) {\r\n                this.duplicateRows = null; // Free memory\r\n            }\r\n        }\r\n        orphanRow(rowToRemove, level < 0);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Adds a duplicate row to the tree node.\r\n     * @param newRow - The new row to be added.\r\n     * @returns A boolean indicating whether the row was successfully added.\r\n     */\r\n    public addDuplicateRow(newRow: TreeRow): boolean {\r\n        const { level } = this;\r\n        let duplicateRows = this.duplicateRows;\r\n        if (duplicateRows === null) {\r\n            duplicateRows = new Set();\r\n            this.duplicateRows = duplicateRows;\r\n        } else if (duplicateRows.has(newRow)) {\r\n            return false; // Already present\r\n        }\r\n        duplicateRows.add(newRow);\r\n        newRow.treeNode = this;\r\n        newRow.level = level;\r\n        if (level >= 0) {\r\n            newRow.allLeafChildren = _EmptyArray;\r\n        }\r\n        newRow.childrenAfterGroup = _EmptyArray;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * This is needed to be sure that the row is the duplicate row with the smallest sourceRowIndex, in O(n).\r\n     * @returns this.row\r\n     */\r\n    public sortFirstDuplicateRow(): TreeRow | null {\r\n        const duplicateRows = this.duplicateRows;\r\n        const oldRow = this.row;\r\n        if (!oldRow || !duplicateRows) {\r\n            return oldRow;\r\n        }\r\n        let newRow = oldRow;\r\n        for (const row of duplicateRows) {\r\n            if (row.sourceRowIndex < newRow.sourceRowIndex) {\r\n                newRow = row; // found a smaller one\r\n            }\r\n        }\r\n        if (newRow !== oldRow) {\r\n            // Swap the rows\r\n            newRow.childrenAfterGroup = this.childrenAfterGroup;\r\n            newRow.allLeafChildren = oldRow.allLeafChildren ?? this.allLeafChildren ?? _EmptyArray;\r\n            oldRow.childrenAfterGroup = _EmptyArray;\r\n            oldRow.allLeafChildren = _EmptyArray;\r\n            duplicateRows.delete(newRow);\r\n            duplicateRows.add(oldRow);\r\n            this.row = newRow;\r\n        }\r\n        return newRow;\r\n    }\r\n\r\n    /** Pops the first duplicate row from the list of duplicates */\r\n    private popDuplicateRow(): TreeRow | null {\r\n        let result: TreeRow | null = null;\r\n        const duplicateRows = this.duplicateRows;\r\n        if (duplicateRows !== null) {\r\n            result = duplicateRows.values().next().value;\r\n            if (result !== null && duplicateRows.delete(result) && duplicateRows.size === 0) {\r\n                this.duplicateRows = null; // Free memory\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Dequeues the next child invalidated node to be committed. Order is not deterministic.\r\n     * @returns the next child node to be committed, or null if all children were already dequeued.\r\n     */\r\n    public dequeueInvalidated(): TreeNode | null {\r\n        const node = this.invalidatedHead;\r\n        if (node !== null) {\r\n            this.invalidatedHead = node.invalidatedNext ?? null;\r\n            node.invalidatedNext = undefined; // Mark as not invalidated\r\n        }\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * Invalidates this node and all its parents until the root is reached.\r\n     * Order of invalidated nodes is not deterministic.\r\n     * The root itself cannot be invalidated, as it has no parents.\r\n     * If a node is already invalidated, it will stop the recursion.\r\n     */\r\n    public invalidate(): void {\r\n        let node: TreeNode | null = this;\r\n        let parent = this.parent;\r\n        while (parent !== null && node.invalidatedNext === undefined) {\r\n            node.invalidatedNext = parent.invalidatedHead;\r\n            parent.invalidatedHead = node;\r\n            node = parent;\r\n            parent = node.parent;\r\n        }\r\n    }\r\n\r\n    /** Marks childrenChanged in the parent, so the childrenAfterGroup will be recomputed and invalidates the parent. */\r\n    public invalidateOrder(): void {\r\n        const parent = this.parent;\r\n        if (parent !== null && !parent.childrenChanged && ((this.children?.size ?? 0) > 1 || !parent.row?.data)) {\r\n            parent.childrenChanged = true;\r\n            parent.invalidate();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * When we receive rowNodeOrder not undefined, we need to update the rowPosition of the node,\r\n     * to ensure it will be sorted in the right order in childrenAfterGroup.\r\n     * This function makes sense to be called only in the post-order commit DFS\r\n     * as it assumes children's childrenAfterGroup is already updated.\r\n     * @returns the rowPosition the node should have.\r\n     */\r\n    public getNewSourceIdx(): number {\r\n        const row = this.row;\r\n        if (row?.data) {\r\n            return row.sourceRowIndex;\r\n        }\r\n        // This is a filler node, return the rowPosition of the first child\r\n        return this.childrenAfterGroup[0]?.treeNode?.sourceIdx ?? this.sourceIdx;\r\n    }\r\n\r\n    /**\r\n     * This is called in post order during commit to update the childrenAfterGroup array.\r\n     * It uses the rowNodeOrder map to sort the children in the right order, if is passed.\r\n     * It assumes all children childrenAfterGroup are up to date and rows all created.\r\n     *\r\n     * It replaces the array with _EmptyArray if there are no children, to reduce memory usage and GC pressure.\r\n     * It does sort the children only if strictly needed, to avoid unnecessary work.\r\n     *\r\n     * If the order changes, also the order in the children map will be updated,\r\n     * so the next call to enumChildren() will return the children in the right order.\r\n     */\r\n    public updateChildrenAfterGroup(treeData: boolean): boolean {\r\n        this.childrenChanged = false; // Reset the flag for this node\r\n        const childrenCount = (treeData && this.children?.size) || 0;\r\n        if (childrenCount === 0) {\r\n            this.row!.childrenAfterGroup = _EmptyArray;\r\n\r\n            if (this.childrenAfterGroup.length === 0) {\r\n                return false; // No children\r\n            }\r\n\r\n            this.leafChildrenChanged = true;\r\n            this.childrenAfterGroup = _EmptyArray;\r\n            return true; // Children cleared\r\n        }\r\n\r\n        let nodesChanged = false;\r\n\r\n        let childrenAfterGroup = this.childrenAfterGroup;\r\n        if (childrenAfterGroup === _EmptyArray) {\r\n            childrenAfterGroup = new Array(childrenCount);\r\n            this.childrenAfterGroup = childrenAfterGroup;\r\n            this.row!.childrenAfterGroup = childrenAfterGroup;\r\n            nodesChanged = true;\r\n        } else if (childrenAfterGroup.length !== childrenCount) {\r\n            childrenAfterGroup.length = childrenCount;\r\n            nodesChanged = true;\r\n        }\r\n\r\n        let index = 0;\r\n        let prevPosition = -1;\r\n        let needSort = false;\r\n        for (const child of this.enumChildren()) {\r\n            const nextPosition = child.getNewSourceIdx();\r\n            if (nextPosition < prevPosition) {\r\n                needSort = true;\r\n            }\r\n            prevPosition = nextPosition;\r\n            child.sourceIdx = nextPosition;\r\n            const row = child.row;\r\n            if (childrenAfterGroup[index] !== row) {\r\n                childrenAfterGroup[index] = row!;\r\n                nodesChanged = true;\r\n            }\r\n            ++index;\r\n        }\r\n\r\n        if (nodesChanged) {\r\n            this.leafChildrenChanged = true; // Note: we are not invalidating this if order only changes\r\n        }\r\n\r\n        if (needSort) {\r\n            this.reorderChildrenList(childrenAfterGroup);\r\n        }\r\n\r\n        return nodesChanged || needSort;\r\n    }\r\n\r\n    /** This reorders the given array and rebuild the children map. */\r\n    private reorderChildrenList(childrenAfterGroup: TreeRow[]) {\r\n        const childrenCount = childrenAfterGroup.length;\r\n        const children = this.children!;\r\n        childrenAfterGroup.sort(treeNodePositionComparer);\r\n        // We need to rebuild the children map in the right order\r\n        children.clear();\r\n        for (let i = 0; i < childrenCount; ++i) {\r\n            const node = childrenAfterGroup[i].treeNode! as TreeNode;\r\n            children.set(node.key, node);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Rebuild the allLeafChildren rows array of a node. It uses childrenAfterGroup, we assume to be already updated.\r\n     * This is called in post order during commit, after the childrenAfterGroup are updated with updateChildrenAfterGroup().\r\n     * It uses the childrenAfterGroup and allLeafChildren of all the children, we assume they are updated.\r\n     */\r\n    public updateAllLeafChildren(): void {\r\n        const { parent, row, childrenAfterGroup } = this;\r\n\r\n        this.leafChildrenChanged = false; // Reset the flag for this node\r\n\r\n        let nodesChanged = false;\r\n        const childrenAfterGroupLen = childrenAfterGroup.length;\r\n        if (childrenAfterGroupLen === 0) {\r\n            // No children, no leaf nodes.\r\n            nodesChanged = row!.allLeafChildren?.length !== 0;\r\n            row!.allLeafChildren = _EmptyArray;\r\n            this.allLeafChildren = _EmptyArray;\r\n        } else if (childrenAfterGroupLen === 1 && childrenAfterGroup[0].allLeafChildren?.length) {\r\n            // We can avoid building the leaf children array if we are a node with just one child that has leafs\r\n            // In this case we use the allLeafChildren of the child by assigning it to this.row.allLeafChildren in O(1)\r\n            // and without occupying any extra memory.\r\n\r\n            row!.allLeafChildren = childrenAfterGroup[0].allLeafChildren; // Use the same array\r\n\r\n            // Set allLeafChildren to null as indicator that we are borrowing the array from one of the children\r\n            // This is used to prevent `updateAllLeafChildren` modifying this array in a future pass, if this nodes\r\n            // direct children have been updated.\r\n            // In this case we will have to use this.row.allLeafChildren to access the allLeafChildren array.\r\n            this.allLeafChildren = null;\r\n\r\n            nodesChanged = true; // This must be true as this may come from a child that changed\r\n        } else {\r\n            // We need to rebuild the allLeafChildren array, we use children allLeafChildren arrays\r\n\r\n            let allLeafChildren = this.allLeafChildren;\r\n            if (allLeafChildren === _EmptyArray || allLeafChildren === null) {\r\n                allLeafChildren = [];\r\n                this.allLeafChildren = allLeafChildren;\r\n            }\r\n            const oldAllLeafChildrenLength = allLeafChildren.length;\r\n\r\n            let writeIdx = 0;\r\n            for (let i = 0; i < childrenAfterGroupLen; ++i) {\r\n                const childRow = childrenAfterGroup[i];\r\n                const childAllLeafChildren = childRow.allLeafChildren!;\r\n                const childAllLeafChildrenLen = childAllLeafChildren.length;\r\n                if (childAllLeafChildrenLen) {\r\n                    for (let j = 0; j < childAllLeafChildrenLen; ++j) {\r\n                        const leaf = childAllLeafChildren[j];\r\n                        if (writeIdx >= oldAllLeafChildrenLength || allLeafChildren[writeIdx] !== leaf) {\r\n                            allLeafChildren[writeIdx] = leaf;\r\n                            nodesChanged = true;\r\n                        }\r\n                        ++writeIdx;\r\n                    }\r\n                } else {\r\n                    if ((writeIdx >= oldAllLeafChildrenLength || allLeafChildren[writeIdx] !== childRow) && childRow) {\r\n                        allLeafChildren[writeIdx] = childRow;\r\n                        nodesChanged = true;\r\n                    }\r\n                    ++writeIdx;\r\n                }\r\n            }\r\n            if (oldAllLeafChildrenLength !== writeIdx) {\r\n                allLeafChildren.length = writeIdx;\r\n                nodesChanged = true;\r\n            }\r\n            if (row!.allLeafChildren !== allLeafChildren) {\r\n                row!.allLeafChildren = allLeafChildren;\r\n                nodesChanged = true;\r\n            }\r\n        }\r\n\r\n        if (nodesChanged && parent) {\r\n            parent.leafChildrenChanged = true; // Propagate to the parent, as it may need to rebuild its allLeafChildren too\r\n        }\r\n    }\r\n}\r\n", "import type { ITreeNode, RowNode } from 'ag-grid-community';\r\n\r\n/**\r\n * This is the type of any row processed by the TreeStrategy.\r\n *\r\n * TreeStrategy can modify:\r\n * - allLeafChildren\r\n * - childrenAfterGroup\r\n * - treeNode\r\n * - treeNodeFlags\r\n */\r\nexport interface TreeRow<TData = any> extends RowNode<TData> {\r\n    allLeafChildren: TreeRow<TData>[] | null;\r\n    childrenAfterGroup: TreeRow<TData>[] | null;\r\n    treeNode: ITreeNode | null;\r\n    treeNodeFlags: number;\r\n    sibling: TreeRow<TData>;\r\n    sourceRowIndex: number;\r\n}\r\n\r\nconst enum Flags {\r\n    None = 0,\r\n    Committed = 0x01,\r\n    ExpandedInitialized = 0x02,\r\n    RowUpdated = 0x04,\r\n    KeyChanged = 0x08,\r\n    PathChanged = 0x10,\r\n}\r\n\r\n/** We set this on the first time the node is committed. We unset this if the row gets deleted. */\r\nexport const isTreeRowCommitted = (row: RowNode): boolean => (row.treeNodeFlags & Flags.Committed) !== 0;\r\n\r\n/** Check if the expanded state needs to be initialized, first time for a node, or again if the node was removed */\r\nexport const isTreeRowExpandedInitialized = (row: RowNode): boolean =>\r\n    (row.treeNodeFlags & Flags.ExpandedInitialized) !== 0;\r\n\r\n/** We use this to mark a row as updated by an updated transaction */\r\nexport const isTreeRowUpdated = (row: RowNode): boolean => (row.treeNodeFlags & Flags.RowUpdated) !== 0;\r\n\r\n/** We use this to see if a row changed key during commit */\r\nexport const isTreeRowKeyChanged = (row: RowNode): boolean => (row.treeNodeFlags & Flags.KeyChanged) !== 0;\r\n\r\n/** Returns true if markTreeRowPathChanged was called. Reset during commit.  */\r\nexport const isTreeRowPathChanged = (row: TreeRow): boolean => (row.treeNodeFlags & Flags.PathChanged) !== 0;\r\n\r\n/** Changes the expanded initialized state, so it can be recomputed again. */\r\nexport const setTreeRowExpandedInitialized = (row: TreeRow, value: boolean): void => {\r\n    if (value) {\r\n        row.treeNodeFlags |= Flags.ExpandedInitialized;\r\n    } else {\r\n        row.treeNodeFlags &= ~Flags.ExpandedInitialized;\r\n    }\r\n};\r\n\r\n/**\r\n * We use this to mark a row as updated by an updated transaction.\r\n * This will be set only if the row was committed at least once before.\r\n */\r\nexport const setTreeRowUpdated = (row: TreeRow): void => {\r\n    const flags = row.treeNodeFlags;\r\n    if ((flags & Flags.Committed) !== 0) {\r\n        row.treeNodeFlags = flags | Flags.RowUpdated;\r\n    }\r\n};\r\n\r\n/**\r\n * We use this to mark that a row changed key during commit.\r\n * This will be set only if the row was committed at least once before.\r\n */\r\nexport const setTreeRowKeyChanged = (row: TreeRow): void => {\r\n    const flags = row.treeNodeFlags;\r\n    if ((flags & Flags.Committed) !== 0) {\r\n        row.treeNodeFlags = flags | (Flags.KeyChanged | Flags.RowUpdated);\r\n    }\r\n};\r\n\r\n/** If this is true, commit stage must invoke changedPath.addParentNode */\r\nexport const markTreeRowPathChanged = (row: TreeRow): void => {\r\n    row.treeNodeFlags |= Flags.PathChanged;\r\n};\r\n\r\n/** Called when the row is committed. */\r\nexport const markTreeRowCommitted = (row: TreeRow): void => {\r\n    const isRoot = row.level < 0;\r\n    const oldFlags = row.treeNodeFlags;\r\n    const wasCommitted = (oldFlags & Flags.Committed) !== 0;\r\n    row.treeNodeFlags = Flags.Committed | (oldFlags & ~(Flags.RowUpdated | Flags.KeyChanged | Flags.PathChanged));\r\n    if (!wasCommitted || isRoot) {\r\n        // We need to ensure that arrays are not null if the row was never committed or is the root\r\n        const childrenAfterGroup = row.childrenAfterGroup;\r\n        row.childrenAfterFilter = childrenAfterGroup;\r\n        row.childrenAfterAggFilter = childrenAfterGroup;\r\n        row.childrenAfterSort = childrenAfterGroup;\r\n    }\r\n\r\n    if (isRoot) {\r\n        const sibling = row.sibling;\r\n        if (sibling) {\r\n            sibling.childrenAfterGroup = row.childrenAfterGroup;\r\n            sibling.childrenMapped = row.childrenMapped;\r\n        }\r\n    }\r\n};\r\n\r\n/** Clears all the flags, called when the row is deleted from the tree */\r\nexport const clearTreeRowFlags = (row: TreeRow): void => {\r\n    row.treeNodeFlags = 0;\r\n};\r\n", "export type DataFieldGetter<TData = any, TResult = unknown> = {\r\n    (data: TData | null | undefined): TResult | null | undefined;\r\n    path: string | null | undefined;\r\n};\r\n\r\nconst parseFieldPath = (fieldPath: string | null | undefined): string[] => {\r\n    if (typeof fieldPath !== 'string' || !fieldPath.length) {\r\n        return [];\r\n    }\r\n    const segments = fieldPath.split('.');\r\n    if (segments.includes('__proto__')) {\r\n        // TODO: maybe we should raise an error like 'Field path contains restricted keyword \"__proto__\"'\r\n        return []; // Avoid the risk of accessing prototype\r\n    }\r\n    return segments;\r\n};\r\n\r\n/**\r\n * Precompiles a field getter function for a given field path.\r\n * Note: the result should be cached, as it can be reused for multiple objects.\r\n * @param fieldPath The field path to compile, for example 'a.b.c'.\r\n * @returns A function that retrieves the value of the field from an object.\r\n */\r\nexport const makeFieldPathGetter = <TData = any, TResult = unknown>(\r\n    fieldPath: string | null | undefined\r\n): DataFieldGetter<TData, TResult> => {\r\n    const splitPath = parseFieldPath(fieldPath);\r\n    let result: DataFieldGetter<TData, TResult> | null = null;\r\n\r\n    const last = splitPath.length - 1;\r\n\r\n    if (last === 0) {\r\n        result = ((data: TData | null | undefined) => (data as any)?.[fieldPath!]) as DataFieldGetter<TData, TResult>;\r\n    } else if (last > 0) {\r\n        result = ((data: TData | null | undefined) => {\r\n            let value: any = data;\r\n            for (let i = 0; i <= last && value !== null && value !== undefined; ++i) {\r\n                value = value[splitPath[i]];\r\n                if (i < last && typeof value !== 'object' && value !== undefined) {\r\n                    // TODO: maybe we should raise an error like 'Accessing a ' + typeof value + ' not allowed in field path'\r\n                    return null;\r\n                }\r\n            }\r\n            return value;\r\n        }) as DataFieldGetter<TData, TResult>;\r\n    } else {\r\n        result = (() => undefined) as unknown as DataFieldGetter<TData, TResult>;\r\n    }\r\n\r\n    result.path = fieldPath;\r\n    return result;\r\n};\r\n", "import { _warn } from 'ag-grid-community';\r\nimport type {\r\n    ChangedPath,\r\n    GetDataPath,\r\n    IChangedRowNodes,\r\n    NamedBean,\r\n    RefreshModelParams,\r\n    RowNode,\r\n} from 'ag-grid-community';\r\n\r\nimport { AbstractClientSideTreeNodeManager } from './abstractClientSideTreeNodeManager';\r\nimport type { TreeNode } from './treeNode';\r\n\r\nexport class ClientSidePathTreeNodeManager<TData>\r\n    extends AbstractClientSideTreeNodeManager<TData>\r\n    implements NamedBean\r\n{\r\n    beanName = 'csrmPathTreeNodeSvc' as const;\r\n\r\n    protected override loadNewRowData(rowData: TData[]): void {\r\n        const rootNode = this.rootNode!;\r\n        const treeRoot = this.treeRoot!;\r\n\r\n        this.treeClear(treeRoot);\r\n        treeRoot.setRow(rootNode);\r\n\r\n        super.loadNewRowData(rowData);\r\n\r\n        const allLeafChildren = rootNode.allLeafChildren!;\r\n        const getDataPath = this.gos.get('getDataPath');\r\n        for (let i = 0, len = allLeafChildren.length; i < len; ++i) {\r\n            this.addOrUpdateRow(getDataPath, allLeafChildren[i], true);\r\n        }\r\n\r\n        this.treeCommit();\r\n    }\r\n\r\n    public override get treeData(): boolean {\r\n        const gos = this.gos;\r\n        return gos.get('treeData') && !!gos.get('getDataPath');\r\n    }\r\n\r\n    public override refreshModel(params: RefreshModelParams<TData>): void {\r\n        const changedRowNodes = params.changedRowNodes;\r\n        if (changedRowNodes) {\r\n            this.executeTransactions(changedRowNodes, params.changedPath, params.rowNodesOrderChanged);\r\n        }\r\n\r\n        super.refreshModel(params);\r\n    }\r\n\r\n    private executeTransactions(\r\n        changedRowNodes: IChangedRowNodes,\r\n        changedPath: ChangedPath | undefined,\r\n        rowNodesOrderMaybeChanged: boolean | undefined\r\n    ): void {\r\n        const treeRoot = this.treeRoot;\r\n        if (!treeRoot) {\r\n            return; // Destroyed or not active\r\n        }\r\n\r\n        treeRoot.setRow(this.rootNode);\r\n\r\n        for (const row of changedRowNodes.removals) {\r\n            const node = row.treeNode as TreeNode | null;\r\n            if (node) {\r\n                this.treeRemove(node, row);\r\n            }\r\n        }\r\n\r\n        const updates = changedRowNodes.updates;\r\n        const getDataPath = this.gos.get('getDataPath');\r\n        for (const row of updates.keys()) {\r\n            this.addOrUpdateRow(getDataPath, row, updates.get(row)!);\r\n        }\r\n\r\n        const rows = treeRoot.row?.allLeafChildren;\r\n        if (rowNodesOrderMaybeChanged && rows) {\r\n            for (let rowIdx = 0, rowsLen = rows.length; rowIdx < rowsLen; ++rowIdx) {\r\n                const node = rows[rowIdx].treeNode as TreeNode | null;\r\n                if (node && node.sourceIdx !== rowIdx) {\r\n                    node.invalidateOrder(); // Order might have changed\r\n                }\r\n            }\r\n        }\r\n\r\n        this.treeCommit(changedPath); // One single commit for all the transactions\r\n    }\r\n\r\n    private addOrUpdateRow(getDataPath: GetDataPath | undefined, row: RowNode, created: boolean): void {\r\n        const treeRoot = this.treeRoot!;\r\n        if (!this.treeData) {\r\n            // We assume that the data is flat and we use id as the key for the tree nodes.\r\n            // This happens when treeData is false and getDataPath is undefined/null.\r\n            this.treeSetRow(treeRoot.upsertKey(row.id!), row, created);\r\n            return;\r\n        }\r\n\r\n        const path = getDataPath?.(row.data);\r\n        const pathLength = path?.length;\r\n        if (!pathLength) {\r\n            _warn(185, { data: row.data });\r\n        } else {\r\n            // Gets the last node of a path. Inserts filler nodes where needed.\r\n            let level = 0;\r\n            let node = treeRoot;\r\n            do {\r\n                node = node.upsertKey(path[level++]);\r\n            } while (level < pathLength);\r\n            this.treeSetRow(node, row, created);\r\n        }\r\n    }\r\n}\r\n", "import type { _ModuleWithoutApi } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { AggregationModule, SharedAggregationModule } from '../aggregation/aggregationModule';\r\nimport {\r\n    ClientSideRowModelHierarchyModule,\r\n    GroupColumnModule,\r\n    StickyRowModule,\r\n} from '../rowHierarchy/rowHierarchyModule';\r\nimport { VERSION } from '../version';\r\nimport { ClientSideChildrenTreeNodeManager } from './clientSideChildrenTreeNodeManager';\r\nimport { ClientSidePathTreeNodeManager } from './clientSidePathTreeNodeManager';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const SharedTreeDataModule: _ModuleWithoutApi = {\r\n    moduleName: 'SharedTreeData',\r\n    version: VERSION,\r\n    dependsOn: [EnterpriseCoreModule, SharedAggregationModule, GroupColumnModule, StickyRowModule],\r\n};\r\n\r\n/**\r\n * @feature Tree Data\r\n * @gridOption treeData\r\n */\r\nexport const TreeDataModule: _ModuleWithoutApi = {\r\n    moduleName: 'TreeData',\r\n    version: VERSION,\r\n    beans: [ClientSidePathTreeNodeManager, ClientSideChildrenTreeNodeManager],\r\n    rowModels: ['clientSide'],\r\n    dependsOn: [SharedTreeDataModule, AggregationModule, ClientSideRowModelHierarchyModule],\r\n};\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    IShowRowGroupColsService,\r\n    NamedBean,\r\n    RowBounds,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    RowNode,\r\n    _doOnce,\r\n    _exists,\r\n    _getGroupTotalRowCallback,\r\n    _getRowHeightAsNumber,\r\n    _getRowHeightForNode,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { _createRowNodeFooter, _destroyRowNodeFooter } from '../../aggregation/footerUtils';\r\nimport type { NodeManager } from '../nodeManager';\r\nimport type { ServerSideRowModel } from '../serverSideRowModel';\r\nimport type { ServerSideExpansionService } from '../services/serverSideExpansionService';\r\nimport type { LazyStore } from '../stores/lazy/lazyStore';\r\nimport type { StoreFactory } from '../stores/storeFactory';\r\n\r\nexport const GROUP_MISSING_KEY_ID = 'ag-Grid-MissingKey' as const;\r\n\r\nexport class BlockUtils extends BeanStub implements NamedBean {\r\n    beanName = 'ssrmBlockUtils' as const;\r\n\r\n    private valueSvc: ValueService;\r\n    private showRowGroupCols?: IShowRowGroupColsService;\r\n    private nodeManager: NodeManager;\r\n    private expansionSvc?: ServerSideExpansionService;\r\n    private serverSideRowModel: ServerSideRowModel;\r\n    private storeFactory: StoreFactory;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.valueSvc = beans.valueSvc;\r\n        this.showRowGroupCols = beans.showRowGroupCols;\r\n        this.nodeManager = beans.ssrmNodeManager as NodeManager;\r\n        this.expansionSvc = beans.expansionSvc as ServerSideExpansionService;\r\n        this.serverSideRowModel = beans.rowModel as ServerSideRowModel;\r\n        this.storeFactory = beans.ssrmStoreFactory as StoreFactory;\r\n    }\r\n\r\n    public createRowNode(params: {\r\n        group: boolean;\r\n        leafGroup: boolean;\r\n        level: number;\r\n        parent: RowNode;\r\n        field: string;\r\n        rowGroupColumn: AgColumn;\r\n        rowHeight?: number;\r\n    }): RowNode {\r\n        const rowNode = new RowNode(this.beans);\r\n\r\n        const rowHeight = params.rowHeight != null ? params.rowHeight : _getRowHeightAsNumber(this.beans);\r\n        rowNode.setRowHeight(rowHeight);\r\n\r\n        rowNode.group = params.group;\r\n        rowNode.leafGroup = params.leafGroup;\r\n        rowNode.level = params.level;\r\n        rowNode.uiLevel = params.level;\r\n        rowNode.parent = params.parent;\r\n\r\n        // stub gets set to true here, and then false when this rowNode gets it's data\r\n        rowNode.stub = true;\r\n        rowNode.__needsRefreshWhenVisible = false;\r\n\r\n        if (rowNode.group) {\r\n            rowNode.expanded = false;\r\n            rowNode.field = params.field;\r\n            rowNode.rowGroupColumn = params.rowGroupColumn;\r\n        }\r\n\r\n        return rowNode;\r\n    }\r\n\r\n    public destroyRowNode(rowNode: RowNode, preserveStore: boolean = false): void {\r\n        if (rowNode.childStore && !preserveStore) {\r\n            this.destroyBean(rowNode.childStore);\r\n            rowNode.childStore = null;\r\n        }\r\n\r\n        // if this has a footer, destroy that too\r\n        if (rowNode.sibling && !rowNode.footer) {\r\n            this.destroyRowNode(rowNode.sibling, false);\r\n        }\r\n\r\n        // this is needed, so row render knows to fade out the row, otherwise it\r\n        // sees row top is present, and thinks the row should be shown. maybe\r\n        // rowNode should have a flag on whether it is visible???\r\n        rowNode.clearRowTopAndRowIndex();\r\n        if (rowNode.id != null) {\r\n            this.nodeManager.removeNode(rowNode);\r\n        }\r\n    }\r\n\r\n    private setTreeGroupInfo(rowNode: RowNode): void {\r\n        rowNode.updateHasChildren();\r\n\r\n        const getKeyFunc = this.gos.get('getServerSideGroupKey');\r\n        const hasChildren = rowNode.hasChildren();\r\n        if (hasChildren && getKeyFunc != null) {\r\n            rowNode.key = getKeyFunc(rowNode.data);\r\n        }\r\n\r\n        if (!hasChildren && rowNode.childStore != null) {\r\n            this.destroyBean(rowNode.childStore);\r\n            rowNode.childStore = null;\r\n            rowNode.expanded = false;\r\n        }\r\n    }\r\n\r\n    private setRowGroupInfo(rowNode: RowNode): void {\r\n        rowNode.key = this.valueSvc.getValue(rowNode.rowGroupColumn!, rowNode);\r\n\r\n        if (rowNode.key === null || rowNode.key === undefined) {\r\n            _doOnce(() => {\r\n                _warn(190, { rowGroupId: rowNode.rowGroupColumn?.getId(), data: rowNode.data });\r\n            }, 'SSBlock-BadKey');\r\n        }\r\n\r\n        const isUnbalancedGroup = this.gos.get('groupAllowUnbalanced') && rowNode.key === '';\r\n        if (isUnbalancedGroup) {\r\n            const storeParams = this.serverSideRowModel.getParams();\r\n            rowNode.childStore = this.createBean(this.storeFactory.createStore(storeParams, rowNode));\r\n        }\r\n\r\n        const getGroupIncludeFooter = _getGroupTotalRowCallback(this.beans.gos);\r\n        const doesRowShowFooter = getGroupIncludeFooter({ node: rowNode });\r\n        if (doesRowShowFooter) {\r\n            _createRowNodeFooter(rowNode, this.beans);\r\n            if (rowNode.sibling) {\r\n                rowNode.sibling.uiLevel = rowNode.uiLevel + 1;\r\n            }\r\n        }\r\n    }\r\n\r\n    private setMasterDetailInfo(rowNode: RowNode): void {\r\n        const isMasterFunc = this.gos.get('isRowMaster');\r\n        if (isMasterFunc != null) {\r\n            rowNode.master = isMasterFunc(rowNode.data);\r\n        } else {\r\n            rowNode.master = true;\r\n        }\r\n    }\r\n\r\n    public updateDataIntoRowNode(rowNode: RowNode, data: any): void {\r\n        rowNode.updateData(data);\r\n\r\n        if (this.gos.get('treeData')) {\r\n            this.setTreeGroupInfo(rowNode);\r\n            this.setChildCountIntoRowNode(rowNode);\r\n        } else if (rowNode.group) {\r\n            this.setChildCountIntoRowNode(rowNode);\r\n\r\n            if (!rowNode.footer) {\r\n                const getGroupIncludeFooter = _getGroupTotalRowCallback(this.beans.gos);\r\n                const doesRowShowFooter = getGroupIncludeFooter({ node: rowNode });\r\n                if (doesRowShowFooter) {\r\n                    if (rowNode.sibling) {\r\n                        rowNode.sibling.updateData(data);\r\n                    } else {\r\n                        _createRowNodeFooter(rowNode, this.beans);\r\n                    }\r\n                } else if (rowNode.sibling) {\r\n                    _destroyRowNodeFooter(rowNode);\r\n                }\r\n            }\r\n\r\n            // it's not possible for a node to change whether it's a group or not\r\n            // when doing row grouping (as only rows at certain levels are groups),\r\n            // so nothing to do here\r\n        } else if (this.gos.get('masterDetail')) {\r\n            // this should be implemented, however it's not the use case i'm currently\r\n            // programming, so leaving for another day. to test this, create an example\r\n            // where whether a master row is expandable or not is dynamic\r\n        }\r\n    }\r\n\r\n    public setDataIntoRowNode(\r\n        rowNode: RowNode,\r\n        data: any,\r\n        defaultId: string,\r\n        cachedRowHeight: number | undefined\r\n    ): void {\r\n        rowNode.stub = false;\r\n        const treeData = this.gos.get('treeData');\r\n\r\n        rowNode.setDataAndId(data, defaultId);\r\n\r\n        if (treeData) {\r\n            this.setTreeGroupInfo(rowNode);\r\n        } else if (rowNode.group) {\r\n            this.setRowGroupInfo(rowNode);\r\n        } else if (this.gos.get('masterDetail')) {\r\n            this.setMasterDetailInfo(rowNode);\r\n        }\r\n\r\n        if (treeData || rowNode.group) {\r\n            this.setGroupDataIntoRowNode(rowNode);\r\n            this.setChildCountIntoRowNode(rowNode);\r\n        }\r\n\r\n        // this needs to be done AFTER setGroupDataIntoRowNode(), as the height can depend on the group data\r\n        // getting set, if it's a group node and colDef.autoHeight=true\r\n        if (_exists(data)) {\r\n            rowNode.setRowHeight(_getRowHeightForNode(this.beans, rowNode, false, cachedRowHeight).height);\r\n            rowNode.sibling?.setRowHeight(\r\n                _getRowHeightForNode(this.beans, rowNode.sibling, false, cachedRowHeight).height\r\n            );\r\n        }\r\n    }\r\n\r\n    private setChildCountIntoRowNode(rowNode: RowNode): void {\r\n        const getChildCount = this.gos.get('getChildCount');\r\n        if (getChildCount) {\r\n            rowNode.setAllChildrenCount(getChildCount(rowNode.data));\r\n        }\r\n    }\r\n\r\n    private setGroupDataIntoRowNode(rowNode: RowNode): void {\r\n        const groupDisplayCols = this.showRowGroupCols?.getShowRowGroupCols() ?? [];\r\n\r\n        const usingTreeData = this.gos.get('treeData');\r\n\r\n        groupDisplayCols.forEach((col) => {\r\n            if (rowNode.groupData == null) {\r\n                rowNode.groupData = {};\r\n            }\r\n            if (usingTreeData) {\r\n                rowNode.groupData[col.getColId()] = rowNode.key;\r\n            } else if (col.isRowGroupDisplayed(rowNode.rowGroupColumn!.getId())) {\r\n                const groupValue = this.valueSvc.getValue(rowNode.rowGroupColumn!, rowNode);\r\n                rowNode.groupData[col.getColId()] = groupValue;\r\n            }\r\n        });\r\n    }\r\n\r\n    public clearDisplayIndex(rowNode: RowNode): void {\r\n        rowNode.clearRowTopAndRowIndex();\r\n\r\n        const hasChildStore = rowNode.hasChildren() && !!rowNode.childStore;\r\n        if (hasChildStore) {\r\n            (rowNode.childStore as LazyStore | undefined)?.clearDisplayIndexes();\r\n        }\r\n\r\n        const hasDetailNode = rowNode.master && rowNode.detailNode;\r\n        if (hasDetailNode) {\r\n            rowNode.detailNode.clearRowTopAndRowIndex();\r\n        }\r\n    }\r\n\r\n    public setDisplayIndex(\r\n        rowNode: RowNode,\r\n        displayIndexSeq: { value: number },\r\n        nextRowTop: { value: number },\r\n        uiLevel: number\r\n    ): void {\r\n        const isUnbalancedGroup = this.gos.get('groupAllowUnbalanced') && rowNode.group && rowNode.key === '';\r\n        const isHiddenOpenGroup = this.gos.get('groupHideOpenParents') && rowNode.group && rowNode.expanded;\r\n        if (isHiddenOpenGroup || isUnbalancedGroup) {\r\n            rowNode.setRowIndex(null);\r\n            rowNode.setRowTop(null);\r\n        } else {\r\n            // set this row\r\n            rowNode.setRowIndex(displayIndexSeq.value++);\r\n            rowNode.setRowTop(nextRowTop.value);\r\n            nextRowTop.value += rowNode.rowHeight!;\r\n        }\r\n        rowNode.setUiLevel(uiLevel);\r\n\r\n        if (rowNode.footer) {\r\n            return;\r\n        }\r\n\r\n        // set child for master / detail\r\n        const hasDetailRow = rowNode.master;\r\n        if (hasDetailRow) {\r\n            if (rowNode.expanded && rowNode.detailNode) {\r\n                rowNode.detailNode.setRowIndex(displayIndexSeq.value++);\r\n                rowNode.detailNode.setRowTop(nextRowTop.value);\r\n                nextRowTop.value += rowNode.detailNode.rowHeight!;\r\n            } else if (rowNode.detailNode) {\r\n                rowNode.detailNode.clearRowTopAndRowIndex();\r\n            }\r\n        }\r\n\r\n        // set children for SSRM child rows\r\n        const hasChildStore = rowNode.hasChildren() && !!rowNode.childStore;\r\n        if (hasChildStore) {\r\n            const childStore = rowNode.childStore as LazyStore;\r\n            // unbalanced group always behaves as if it was expanded\r\n            if (rowNode.expanded || isUnbalancedGroup) {\r\n                childStore!.setDisplayIndexes(displayIndexSeq, nextRowTop, isUnbalancedGroup ? uiLevel : uiLevel + 1);\r\n            } else {\r\n                // we need to clear the row tops, as the row renderer depends on\r\n                // this to know if the row should be faded out\r\n                childStore!.clearDisplayIndexes();\r\n            }\r\n        }\r\n    }\r\n\r\n    public extractRowBounds(rowNode: RowNode, index: number): RowBounds | undefined {\r\n        const extractRowBounds = (currentRowNode: RowNode): RowBounds => ({\r\n            rowHeight: currentRowNode.rowHeight!,\r\n            rowTop: currentRowNode.rowTop!,\r\n        });\r\n\r\n        if (rowNode.rowIndex === index) {\r\n            return extractRowBounds(rowNode);\r\n        }\r\n\r\n        if (rowNode.hasChildren() && rowNode.expanded && !!rowNode.childStore) {\r\n            const childStore = rowNode.childStore as LazyStore;\r\n            if (childStore.isDisplayIndexInStore(index)) {\r\n                return childStore.getRowBounds(index)!;\r\n            }\r\n        } else if (rowNode.master && rowNode.expanded && rowNode.detailNode) {\r\n            if (rowNode.detailNode.rowIndex === index) {\r\n                return extractRowBounds(rowNode.detailNode);\r\n            }\r\n        }\r\n    }\r\n\r\n    private isPixelInNodeRange(node: RowNode, pixel: number): boolean {\r\n        if (!_exists(node.rowTop) || !_exists(node.rowHeight)) {\r\n            return false;\r\n        }\r\n        return pixel >= node.rowTop && pixel < node.rowTop + node.rowHeight;\r\n    }\r\n\r\n    public getIndexAtPixel(rowNode: RowNode, pixel: number): number | null {\r\n        // first check if pixel is in range of current row\r\n        if (this.isPixelInNodeRange(rowNode, pixel)) {\r\n            return rowNode.rowIndex;\r\n        }\r\n\r\n        // then check if current row contains a detail row with pixel in range\r\n        const expandedMasterRow = rowNode.master && rowNode.expanded;\r\n        const detailNode = rowNode.detailNode;\r\n\r\n        if (expandedMasterRow && detailNode && this.isPixelInNodeRange(detailNode, pixel)) {\r\n            return rowNode.detailNode.rowIndex;\r\n        }\r\n\r\n        // then check if it's a group row with a child cache with pixel in range\r\n        if (rowNode.hasChildren() && rowNode.expanded && !!rowNode.childStore) {\r\n            const childStore = rowNode.childStore as LazyStore;\r\n            if (childStore.isPixelInRange(pixel)) {\r\n                return childStore.getRowIndexAtPixel(pixel);\r\n            }\r\n        }\r\n\r\n        return null;\r\n        // pixel is not within this row node or it's children / detail, so return undefined\r\n    }\r\n\r\n    public createNodeIdPrefix(parentRowNode: RowNode): string | undefined {\r\n        const parts: string[] = [];\r\n        let rowNode: RowNode | null = parentRowNode;\r\n        // pull keys from all parent nodes, but do not include the root node\r\n        while (rowNode && rowNode.level >= 0) {\r\n            if (rowNode.key === '') {\r\n                parts.push(GROUP_MISSING_KEY_ID);\r\n            } else {\r\n                parts.push(rowNode.key!);\r\n            }\r\n            rowNode = rowNode.parent;\r\n        }\r\n\r\n        if (parts.length > 0) {\r\n            return parts.reverse().join('-');\r\n        }\r\n        // no prefix, so node id's are left as they are\r\n        return undefined;\r\n    }\r\n\r\n    public checkOpenByDefault(rowNode: RowNode): void {\r\n        return this.expansionSvc?.checkOpenByDefault(rowNode);\r\n    }\r\n}\r\n", "import type { BeanCollection, NamedBean, RowGroupOpenedEvent } from 'ag-grid-community';\r\nimport { BeanStub, RowNode, _exists, _getRowHeightForNode, _isServerSideRowModel, _missing } from 'ag-grid-community';\r\n\r\nimport type { ServerSideRowModel } from '../serverSideRowModel';\r\nimport type { StoreFactory } from '../stores/storeFactory';\r\n\r\nexport class ExpandListener extends BeanStub implements NamedBean {\r\n    beanName = 'ssrmExpandListener' as const;\r\n\r\n    private serverSideRowModel: ServerSideRowModel;\r\n    private storeFactory: StoreFactory;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.serverSideRowModel = beans.rowModel as ServerSideRowModel;\r\n        this.storeFactory = beans.ssrmStoreFactory as StoreFactory;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        // only want to be active if SSRM active, otherwise would be interfering with other row models\r\n        if (!_isServerSideRowModel(this.gos)) {\r\n            return;\r\n        }\r\n\r\n        this.addManagedEventListeners({ rowGroupOpened: this.onRowGroupOpened.bind(this) });\r\n    }\r\n\r\n    private onRowGroupOpened(event: RowGroupOpenedEvent): void {\r\n        const rowNode = event.node as RowNode;\r\n\r\n        if (rowNode.expanded) {\r\n            if (rowNode.master) {\r\n                this.createDetailNode(rowNode);\r\n            } else if (_missing(rowNode.childStore)) {\r\n                const storeParams = this.serverSideRowModel.getParams();\r\n                rowNode.childStore = this.createBean(this.storeFactory.createStore(storeParams, rowNode));\r\n            }\r\n        } else if (this.gos.get('purgeClosedRowNodes') && _exists(rowNode.childStore)) {\r\n            rowNode.childStore = this.destroyBean(rowNode.childStore)!;\r\n        }\r\n\r\n        this.eventSvc.dispatchEvent({ type: 'storeUpdated' });\r\n    }\r\n\r\n    private createDetailNode(masterNode: RowNode): RowNode {\r\n        if (_exists(masterNode.detailNode)) {\r\n            return masterNode.detailNode;\r\n        }\r\n\r\n        const detailNode = new RowNode(this.beans);\r\n\r\n        detailNode.detail = true;\r\n        detailNode.selectable = false;\r\n        detailNode.parent = masterNode;\r\n\r\n        if (_exists(masterNode.id)) {\r\n            detailNode.id = 'detail_' + masterNode.id;\r\n        }\r\n\r\n        detailNode.data = masterNode.data;\r\n        detailNode.level = masterNode.level + 1;\r\n\r\n        const defaultDetailRowHeight = 200;\r\n        const rowHeight = _getRowHeightForNode(this.beans, detailNode).height;\r\n\r\n        detailNode.rowHeight = rowHeight ? rowHeight : defaultDetailRowHeight;\r\n        masterNode.detailNode = detailNode;\r\n\r\n        return detailNode;\r\n    }\r\n}\r\n", "import type {\r\n    AdvancedFilterModel,\r\n    BeanCollection,\r\n    FilterManager,\r\n    FilterModel,\r\n    NamedBean,\r\n    StoreRefreshAfterParams,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _isServerSideRowModel } from 'ag-grid-community';\r\n\r\nimport type { ServerSideRowModel } from '../serverSideRowModel';\r\nimport type { ListenerUtils } from './listenerUtils';\r\n\r\nexport class FilterListener extends BeanStub implements NamedBean {\r\n    beanName = 'ssrmFilterListener' as const;\r\n\r\n    private serverSideRowModel: ServerSideRowModel;\r\n    private filterManager?: FilterManager;\r\n    private listenerUtils: ListenerUtils;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.serverSideRowModel = beans.rowModel as ServerSideRowModel;\r\n        this.filterManager = beans.filterManager;\r\n        this.listenerUtils = beans.ssrmListenerUtils as ListenerUtils;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        // only want to be active if SSRM active, otherwise would be interfering with other row models\r\n        if (!_isServerSideRowModel(this.gos)) {\r\n            return;\r\n        }\r\n\r\n        this.addManagedEventListeners({\r\n            advancedFilterEnabledChanged: () => this.onFilterChanged(true),\r\n            filterChanged: () => this.onFilterChanged(),\r\n        });\r\n    }\r\n\r\n    private onFilterChanged(advancedFilterEnabledChanged?: boolean): void {\r\n        const storeParams = this.serverSideRowModel.getParams();\r\n        if (!storeParams) {\r\n            return;\r\n        } // params is undefined if no datasource set\r\n\r\n        const oldModel = storeParams.filterModel;\r\n        let newModel: FilterModel | AdvancedFilterModel | null;\r\n        let changedColumns: string[];\r\n\r\n        if (this.filterManager?.isAdvFilterEnabled()) {\r\n            newModel = this.filterManager.getAdvFilterModel();\r\n            // if advancedFilterEnabledChanged, old model is of type `FilterModel`\r\n            const oldColumns = advancedFilterEnabledChanged\r\n                ? Object.keys(oldModel ?? {})\r\n                : this.getAdvancedFilterColumns(oldModel as AdvancedFilterModel | null);\r\n            const newColumns = this.getAdvancedFilterColumns(newModel as AdvancedFilterModel | null);\r\n            oldColumns.forEach((column) => newColumns.add(column));\r\n            changedColumns = Array.from(newColumns);\r\n        } else {\r\n            newModel = this.filterManager?.getFilterModel() ?? {};\r\n            if (advancedFilterEnabledChanged) {\r\n                // old model is of type `AdvancedFilterModel | null`\r\n                const oldColumns = this.getAdvancedFilterColumns(oldModel as AdvancedFilterModel | null);\r\n                Object.keys(newModel).forEach((column) => oldColumns.add(column));\r\n                changedColumns = Array.from(oldColumns);\r\n            } else {\r\n                changedColumns = this.findChangedColumns(oldModel as FilterModel, newModel as FilterModel);\r\n            }\r\n        }\r\n\r\n        const valueColChanged = this.listenerUtils.isSortingWithValueColumn(changedColumns);\r\n        const secondaryColChanged = this.listenerUtils.isSortingWithSecondaryColumn(changedColumns);\r\n\r\n        const params: StoreRefreshAfterParams = {\r\n            valueColChanged,\r\n            secondaryColChanged,\r\n            changedColumns,\r\n        };\r\n\r\n        this.serverSideRowModel.refreshAfterFilter(newModel, params);\r\n    }\r\n\r\n    private findChangedColumns(oldModel: FilterModel, newModel: FilterModel): string[] {\r\n        const allColKeysMap: { [key: string]: boolean } = {};\r\n\r\n        Object.keys(oldModel).forEach((key) => (allColKeysMap[key] = true));\r\n        Object.keys(newModel).forEach((key) => (allColKeysMap[key] = true));\r\n\r\n        const res: string[] = [];\r\n\r\n        Object.keys(allColKeysMap).forEach((key) => {\r\n            const oldJson = JSON.stringify(oldModel[key]);\r\n            const newJson = JSON.stringify(newModel[key]);\r\n            const filterChanged = oldJson != newJson;\r\n            if (filterChanged) {\r\n                res.push(key);\r\n            }\r\n        });\r\n\r\n        return res;\r\n    }\r\n\r\n    private getAdvancedFilterColumns(model: AdvancedFilterModel | null): Set<string> {\r\n        const columns = new Set<string>();\r\n        if (!model) {\r\n            return columns;\r\n        }\r\n\r\n        const processAdvancedFilterModel = (filterModel: AdvancedFilterModel) => {\r\n            if (filterModel.filterType === 'join') {\r\n                filterModel.conditions.forEach((condition) => processAdvancedFilterModel(condition));\r\n            } else {\r\n                columns.add(filterModel.colId);\r\n            }\r\n        };\r\n\r\n        processAdvancedFilterModel(model);\r\n\r\n        return columns;\r\n    }\r\n}\r\n", "import type { BeanCollection, IColsService, IPivotResultColsService, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\nexport class ListenerUtils extends BeanStub implements NamedBean {\r\n    beanName = 'ssrmListenerUtils' as const;\r\n\r\n    private pivotResultCols?: IPivotResultColsService;\r\n    private valueColsSvc?: IColsService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.pivotResultCols = beans.pivotResultCols;\r\n        this.valueColsSvc = beans.valueColsSvc;\r\n    }\r\n\r\n    public isSortingWithValueColumn(changedColumnsInSort: string[]): boolean {\r\n        const valueColIds = (this.valueColsSvc?.columns ?? []).map((col) => col.getColId());\r\n\r\n        for (let i = 0; i < changedColumnsInSort.length; i++) {\r\n            if (valueColIds.indexOf(changedColumnsInSort[i]) > -1) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public isSortingWithSecondaryColumn(changedColumnsInSort: string[]): boolean {\r\n        const pivotResultCols = this.pivotResultCols?.getPivotResultCols();\r\n        if (!pivotResultCols) {\r\n            return false;\r\n        }\r\n\r\n        const secondaryColIds = pivotResultCols.list.map((col) => col.getColId());\r\n\r\n        for (let i = 0; i < changedColumnsInSort.length; i++) {\r\n            if (secondaryColIds.indexOf(changedColumnsInSort[i]) > -1) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n", "import type { BeanCollection, NamedBean, SortModelItem, SortService, StoreRefreshAfterParams } from 'ag-grid-community';\r\nimport { BeanStub, _isServerSideRowModel } from 'ag-grid-community';\r\n\r\nimport type { ServerSideRowModel } from '../serverSideRowModel';\r\nimport type { ListenerUtils } from './listenerUtils';\r\n\r\nexport class SortListener extends BeanStub implements NamedBean {\r\n    beanName = 'ssrmSortSvc' as const;\r\n\r\n    private sortSvc: SortService;\r\n    private serverSideRowModel: ServerSideRowModel;\r\n    private listenerUtils: ListenerUtils;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.sortSvc = beans.sortSvc!;\r\n        this.serverSideRowModel = beans.rowModel as ServerSideRowModel;\r\n        this.listenerUtils = beans.ssrmListenerUtils as ListenerUtils;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        // only want to be active if SSRM active, otherwise would be interfering with other row models\r\n        if (!_isServerSideRowModel(this.gos)) {\r\n            return;\r\n        }\r\n\r\n        this.addManagedEventListeners({ sortChanged: this.onSortChanged.bind(this) });\r\n    }\r\n\r\n    private onSortChanged(): void {\r\n        const storeParams = this.serverSideRowModel.getParams();\r\n        if (!storeParams) {\r\n            return;\r\n        } // params is undefined if no datasource set\r\n\r\n        const newSortModel = this.sortSvc.getSortModel();\r\n        const oldSortModel = storeParams.sortModel;\r\n\r\n        const changedColumns = this.findChangedColumnsInSort(newSortModel, oldSortModel);\r\n        const valueColChanged = this.listenerUtils.isSortingWithValueColumn(changedColumns);\r\n        const secondaryColChanged = this.listenerUtils.isSortingWithSecondaryColumn(changedColumns);\r\n\r\n        const params: StoreRefreshAfterParams = {\r\n            valueColChanged,\r\n            secondaryColChanged,\r\n            changedColumns,\r\n        };\r\n\r\n        this.serverSideRowModel.refreshAfterSort(newSortModel, params);\r\n    }\r\n\r\n    // returns back all the cols that were effected by the sorting. eg if we were sorting by col A,\r\n    // and now we are sorting by col B, the list of impacted cols should be A and B. so if a cache\r\n    // is impacted by sorting on A or B then it needs to be refreshed. this includes where the cache\r\n    // was previously sorted by A and then the A sort now needs to be cleared.\r\n    private findChangedColumnsInSort(newSortModel: SortModelItem[], oldSortModel: SortModelItem[]): string[] {\r\n        let allColsInBothSorts: string[] = [];\r\n\r\n        [newSortModel, oldSortModel].forEach((sortModel) => {\r\n            if (sortModel) {\r\n                const ids = sortModel.map((sm) => sm.colId);\r\n                allColsInBothSorts = allColsInBothSorts.concat(ids);\r\n            }\r\n        });\r\n\r\n        const differentSorts = (oldSortItem: SortModelItem | undefined, newSortItem: SortModelItem | undefined) => {\r\n            const oldSort = oldSortItem ? oldSortItem.sort : null;\r\n            const newSort = newSortItem ? newSortItem.sort : null;\r\n            return oldSort !== newSort;\r\n        };\r\n\r\n        const differentIndexes = (oldSortItem: SortModelItem | undefined, newSortItem: SortModelItem | undefined) => {\r\n            const oldIndex = oldSortItem ? oldSortModel.indexOf(oldSortItem) : -1;\r\n            const newIndex = newSortItem ? newSortModel.indexOf(newSortItem) : -1;\r\n            return oldIndex !== newIndex;\r\n        };\r\n\r\n        return allColsInBothSorts.filter((colId) => {\r\n            const oldSortItem = oldSortModel.find((sm) => sm.colId === colId);\r\n            const newSortItem = newSortModel.find((sm) => sm.colId === colId);\r\n            return differentSorts(oldSortItem, newSortItem) || differentIndexes(oldSortItem, newSortItem);\r\n        });\r\n    }\r\n}\r\n", "import type { NamedBean, RowNode } from 'ag-grid-community';\r\nimport { BeanStub, _warn } from 'ag-grid-community';\r\n\r\nexport class NodeManager extends BeanStub implements NamedBean {\r\n    beanName = 'ssrmNodeManager' as const;\r\n\r\n    private rowNodes: { [id: string]: RowNode | undefined } = {};\r\n\r\n    public addRowNode(rowNode: RowNode): void {\r\n        const id = rowNode.id!;\r\n        if (this.rowNodes[id]) {\r\n            _warn(187, {\r\n                rowId: id,\r\n                firstData: this.rowNodes[id]!.data,\r\n                secondData: rowNode.data,\r\n            });\r\n        }\r\n\r\n        this.rowNodes[id] = rowNode;\r\n    }\r\n\r\n    public removeNode(rowNode: RowNode): void {\r\n        const id = rowNode.id!;\r\n        if (this.rowNodes[id]) {\r\n            this.rowNodes[id] = undefined;\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.clear();\r\n        super.destroy();\r\n    }\r\n\r\n    public clear(): void {\r\n        this.rowNodes = {};\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type {\r\n    AdvancedFilterModel,\r\n    AgColumn,\r\n    BeanCollection,\r\n    ColumnModel,\r\n    ColumnNameService,\r\n    ColumnVO,\r\n    FilterManager,\r\n    FilterModel,\r\n    IColsService,\r\n    IPivotColDefService,\r\n    IPivotResultColsService,\r\n    IServerSideDatasource,\r\n    IServerSideRowModel,\r\n    LoadSuccessParams,\r\n    NamedBean,\r\n    RefreshServerSideParams,\r\n    RowBounds,\r\n    RowModelType,\r\n    RowRenderer,\r\n    ServerSideGroupLevelState,\r\n    SortModelItem,\r\n    SortService,\r\n    StoreRefreshAfterParams,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    RowNode,\r\n    _debounce,\r\n    _getRowHeightAsNumber,\r\n    _getRowHeightForNode,\r\n    _isGetRowHeightFunction,\r\n    _isRowSelection,\r\n    _jsonEquals,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport type { NodeManager } from './nodeManager';\r\nimport type { LazyStore } from './stores/lazy/lazyStore';\r\nimport type { StoreFactory } from './stores/storeFactory';\r\n\r\nexport interface SSRMParams {\r\n    sortModel: SortModelItem[];\r\n    filterModel: FilterModel | AdvancedFilterModel | null;\r\n    lastAccessedSequence: { value: number };\r\n    dynamicRowHeight: boolean;\r\n    rowGroupCols: ColumnVO[];\r\n    valueCols: ColumnVO[];\r\n    pivotCols: ColumnVO[];\r\n    pivotMode: boolean;\r\n    datasource?: IServerSideDatasource;\r\n}\r\n\r\nexport class ServerSideRowModel extends BeanStub implements NamedBean, IServerSideRowModel {\r\n    beanName = 'rowModel' as const;\r\n\r\n    private colModel: ColumnModel;\r\n    private colNames: ColumnNameService;\r\n    private pivotResultCols?: IPivotResultColsService;\r\n    private rowGroupColsSvc?: IColsService;\r\n    private pivotColsSvc?: IColsService;\r\n    private valueColsSvc?: IColsService;\r\n    private filterManager?: FilterManager;\r\n    private sortSvc?: SortService;\r\n    private rowRenderer: RowRenderer;\r\n    private nodeManager: NodeManager;\r\n    private storeFactory: StoreFactory;\r\n    private pivotColDefSvc?: IPivotColDefService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n        this.colNames = beans.colNames;\r\n        this.pivotResultCols = beans.pivotResultCols;\r\n        this.rowGroupColsSvc = beans.rowGroupColsSvc;\r\n        this.pivotColsSvc = beans.pivotColsSvc;\r\n        this.valueColsSvc = beans.valueColsSvc;\r\n        this.filterManager = beans.filterManager;\r\n        this.sortSvc = beans.sortSvc;\r\n        this.rowRenderer = beans.rowRenderer;\r\n        this.nodeManager = beans.ssrmNodeManager as NodeManager;\r\n        this.storeFactory = beans.ssrmStoreFactory as StoreFactory;\r\n        this.pivotColDefSvc = beans.pivotColDefSvc;\r\n    }\r\n\r\n    private onRowHeightChanged_debounced = _debounce(this, this.onRowHeightChanged.bind(this), 100);\r\n\r\n    public rootNode: RowNode;\r\n    private datasource: IServerSideDatasource | undefined;\r\n\r\n    private storeParams: SSRMParams;\r\n\r\n    private pauseStoreUpdateListening = false;\r\n\r\n    private started = false;\r\n\r\n    private managingPivotResultColumns = false;\r\n\r\n    // we don't implement as lazy row heights is not supported in this row model\r\n    public ensureRowHeightsValid(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public start(): void {\r\n        this.started = true;\r\n        this.updateDatasource();\r\n    }\r\n\r\n    private destroyDatasource(): void {\r\n        if (!this.datasource) {\r\n            return;\r\n        }\r\n\r\n        if (this.datasource.destroy) {\r\n            this.datasource.destroy();\r\n        }\r\n\r\n        this.rowRenderer.datasourceChanged();\r\n        this.datasource = undefined;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const resetListener = this.resetRootStore.bind(this);\r\n        this.addManagedEventListeners({\r\n            newColumnsLoaded: this.onColumnEverything.bind(this),\r\n            storeUpdated: this.onStoreUpdated.bind(this),\r\n            columnValueChanged: resetListener,\r\n            columnPivotChanged: resetListener,\r\n            columnRowGroupChanged: resetListener,\r\n            columnPivotModeChanged: resetListener,\r\n        });\r\n\r\n        this.addManagedPropertyListeners(\r\n            [\r\n                /**\r\n                 * Following properties omitted as they are likely to come with undesired  side effects.\r\n                 * 'getRowId', 'isRowMaster', 'getRowHeight', 'isServerSideGroup', 'getServerSideGroupKey',\r\n                 * */\r\n                'masterDetail',\r\n                'treeData',\r\n                'removePivotHeaderRowWhenSingleValueColumn',\r\n                'cacheBlockSize',\r\n            ],\r\n            resetListener\r\n        );\r\n        this.addManagedPropertyListener('groupAllowUnbalanced', () => this.onStoreUpdated());\r\n        this.addManagedPropertyListener('rowHeight', () => this.resetRowHeights());\r\n        this.verifyProps();\r\n\r\n        this.addManagedPropertyListener('serverSideDatasource', () => this.updateDatasource());\r\n    }\r\n\r\n    private updateDatasource(): void {\r\n        const datasource = this.gos.get('serverSideDatasource');\r\n\r\n        if (datasource) {\r\n            this.setDatasource(datasource);\r\n        }\r\n    }\r\n\r\n    private verifyProps(): void {\r\n        if (_isRowSelection(this.gos) && !this.gos.exists('getRowId')) {\r\n            _warn(188);\r\n        }\r\n    }\r\n\r\n    public setDatasource(datasource: IServerSideDatasource): void {\r\n        // sometimes React, due to async, can call gridApi.setDatasource() before we have started.\r\n        // this happens when React app does this:\r\n        //      useEffect(() => setDatasource(ds), []);\r\n        // thus if we set the datasource before the grid UI has finished initialising, we do not set it,\r\n        // and the ssrm.start() method will set the datasoure when the grid is ready.\r\n        if (!this.started) {\r\n            return;\r\n        }\r\n\r\n        this.destroyDatasource();\r\n        this.datasource = datasource;\r\n        this.resetRootStore();\r\n    }\r\n\r\n    public applyRowData(rowDataParams: LoadSuccessParams, startRow: number, route: string[]) {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return;\r\n        }\r\n\r\n        const storeToExecuteOn = rootStore.getChildStore(route);\r\n\r\n        if (!storeToExecuteOn) {\r\n            return;\r\n        }\r\n\r\n        storeToExecuteOn.applyRowData(rowDataParams, startRow, rowDataParams.rowData.length);\r\n    }\r\n\r\n    public isLastRowIndexKnown(): boolean {\r\n        const cache = this.getRootStore();\r\n        if (!cache) {\r\n            return false;\r\n        }\r\n        return cache.isLastRowIndexKnown();\r\n    }\r\n\r\n    private onColumnEverything(): void {\r\n        // if first time, always reset\r\n        if (!this.storeParams) {\r\n            this.resetRootStore();\r\n            return;\r\n        }\r\n\r\n        // check if anything pertaining to fetching data has changed, and if it has, reset, but if\r\n        // it has not, don't reset\r\n        const rowGroupColumnVos = this.columnsToValueObjects(this.rowGroupColsSvc?.columns);\r\n        const valueColumnVos = this.columnsToValueObjects(this.valueColsSvc?.columns);\r\n        const pivotColumnVos = this.columnsToValueObjects(this.pivotColsSvc?.columns);\r\n\r\n        // compares two sets of columns, ensuring no columns have been added or removed (unless specified via allowRemovedColumns)\r\n        // if the columns are found, also ensures the field and aggFunc properties have not been changed.\r\n        const areColsSame = (params: { oldCols: ColumnVO[]; newCols: ColumnVO[]; allowRemovedColumns?: boolean }) => {\r\n            const oldColsMap: { [key: string]: ColumnVO } = {};\r\n            params.oldCols.forEach((col) => (oldColsMap[col.id] = col));\r\n\r\n            const allColsUnchanged = params.newCols.every((col) => {\r\n                const equivalentCol = oldColsMap[col.id];\r\n                if (equivalentCol) {\r\n                    delete oldColsMap[col.id];\r\n                }\r\n                return equivalentCol && equivalentCol.field === col.field && equivalentCol.aggFunc === col.aggFunc;\r\n            });\r\n\r\n            const missingCols = !params.allowRemovedColumns && !!Object.values(oldColsMap).length;\r\n            return allColsUnchanged && !missingCols;\r\n        };\r\n\r\n        const sortModelDifferent = !_jsonEquals(this.storeParams.sortModel, this.sortSvc?.getSortModel() ?? []);\r\n        const rowGroupDifferent = !areColsSame({\r\n            oldCols: this.storeParams.rowGroupCols,\r\n            newCols: rowGroupColumnVos,\r\n        });\r\n        const pivotDifferent = !areColsSame({\r\n            oldCols: this.storeParams.pivotCols,\r\n            newCols: pivotColumnVos,\r\n        });\r\n        const valuesDifferent =\r\n            !!rowGroupColumnVos?.length &&\r\n            !areColsSame({\r\n                oldCols: this.storeParams.valueCols,\r\n                newCols: valueColumnVos,\r\n                allowRemovedColumns: true,\r\n            });\r\n\r\n        const resetRequired = sortModelDifferent || rowGroupDifferent || pivotDifferent || valuesDifferent;\r\n\r\n        if (resetRequired) {\r\n            this.resetRootStore();\r\n        } else {\r\n            // cols may have changed even if we didn't do a reset. storeParams ref will be provided when getRows\r\n            // is called, so it's important to keep it up to date.\r\n            const newParams = this.createStoreParams();\r\n            this.storeParams.rowGroupCols = newParams.rowGroupCols;\r\n            this.storeParams.pivotCols = newParams.pivotCols;\r\n            this.storeParams.valueCols = newParams.valueCols;\r\n        }\r\n    }\r\n\r\n    private destroyRootStore(): void {\r\n        if (!this.rootNode || !this.rootNode.childStore) {\r\n            return;\r\n        }\r\n        this.rootNode.childStore = this.destroyBean(this.rootNode.childStore)!;\r\n        this.nodeManager.clear();\r\n    }\r\n\r\n    public refreshAfterSort(newSortModel: SortModelItem[], params: StoreRefreshAfterParams): void {\r\n        if (this.storeParams) {\r\n            this.storeParams.sortModel = newSortModel;\r\n        }\r\n\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return;\r\n        }\r\n\r\n        rootStore.refreshAfterSort(params);\r\n\r\n        this.onStoreUpdated();\r\n    }\r\n\r\n    public generateSecondaryColumns(pivotFields: string[]) {\r\n        if (!this.pivotColDefSvc) {\r\n            this.gos.assertModuleRegistered('SharedPivot', 2);\r\n            return;\r\n        }\r\n\r\n        const pivotColumnGroupDefs = this.pivotColDefSvc.createColDefsFromFields(pivotFields);\r\n        this.managingPivotResultColumns = true;\r\n        this.pivotResultCols?.setPivotResultCols(pivotColumnGroupDefs, 'rowModelUpdated');\r\n    }\r\n\r\n    public resetRowHeights(): void {\r\n        const atLeastOne = this.resetRowHeightsForAllRowNodes();\r\n\r\n        const rootNodeHeight = _getRowHeightForNode(this.beans, this.rootNode);\r\n        this.rootNode.setRowHeight(rootNodeHeight.height, rootNodeHeight.estimated);\r\n        if (this.rootNode.sibling) {\r\n            const rootNodeSibling = _getRowHeightForNode(this.beans, this.rootNode.sibling);\r\n            this.rootNode.sibling.setRowHeight(rootNodeSibling.height, rootNodeSibling.estimated);\r\n        }\r\n\r\n        // when pivotMode but pivot not active, root node is displayed on its own\r\n        // because it's only ever displayed alone, refreshing the model (onRowHeightChanged) is not required\r\n        if (atLeastOne) {\r\n            this.onRowHeightChanged();\r\n        }\r\n    }\r\n\r\n    private resetRowHeightsForAllRowNodes(): boolean {\r\n        let atLeastOne = false;\r\n        this.forEachNode((rowNode) => {\r\n            const rowHeightForNode = _getRowHeightForNode(this.beans, rowNode);\r\n            rowNode.setRowHeight(rowHeightForNode.height, rowHeightForNode.estimated);\r\n            // we keep the height each row is at, however we set estimated=true rather than clear the height.\r\n            // this means the grid will not reset the row heights back to defaults, rather it will re-calc\r\n            // the height for each row as the row is displayed. otherwise the scroll will jump when heights are reset.\r\n            const detailNode = rowNode.detailNode;\r\n            if (detailNode) {\r\n                const detailRowHeight = _getRowHeightForNode(this.beans, detailNode);\r\n                detailNode.setRowHeight(detailRowHeight.height, detailRowHeight.estimated);\r\n            }\r\n\r\n            if (rowNode.sibling) {\r\n                const siblingRowHeight = _getRowHeightForNode(this.beans, rowNode.sibling);\r\n                detailNode.setRowHeight(siblingRowHeight.height, siblingRowHeight.estimated);\r\n            }\r\n            atLeastOne = true;\r\n        });\r\n\r\n        return atLeastOne;\r\n    }\r\n\r\n    public resetRootStore(): void {\r\n        this.destroyRootStore();\r\n\r\n        this.rootNode = new RowNode(this.beans);\r\n        this.rootNode.group = true;\r\n        this.rootNode.level = -1;\r\n\r\n        if (this.datasource) {\r\n            this.storeParams = this.createStoreParams();\r\n            this.rootNode.childStore = this.createBean(this.storeFactory.createStore(this.storeParams, this.rootNode));\r\n            this.updateRowIndexesAndBounds();\r\n        }\r\n\r\n        if (this.managingPivotResultColumns) {\r\n            // if managing pivot columns, also reset secondary columns.\r\n            this.pivotResultCols?.setPivotResultCols(null, 'api');\r\n            this.managingPivotResultColumns = false;\r\n        }\r\n\r\n        // this gets the row to render rows (or remove the previously rendered rows, as it's blank to start).\r\n        // important to NOT pass in an event with keepRenderedRows or animate, as we want the renderer\r\n        // to treat the rows as new rows, as it's all new data\r\n        this.dispatchModelUpdated(true);\r\n    }\r\n\r\n    public columnsToValueObjects(columns: AgColumn[] = []): ColumnVO[] {\r\n        return columns.map(\r\n            (col) =>\r\n                ({\r\n                    id: col.getId(),\r\n                    aggFunc: col.getAggFunc(),\r\n                    displayName: this.colNames.getDisplayNameForColumn(col, 'model'),\r\n                    field: col.getColDef().field,\r\n                }) as ColumnVO\r\n        );\r\n    }\r\n\r\n    private createStoreParams(): SSRMParams {\r\n        const rowGroupColumnVos = this.columnsToValueObjects(this.rowGroupColsSvc?.columns);\r\n        const valueColumnVos = this.columnsToValueObjects(this.valueColsSvc?.columns);\r\n        const pivotColumnVos = this.columnsToValueObjects(this.pivotColsSvc?.columns);\r\n\r\n        const dynamicRowHeight = _isGetRowHeightFunction(this.gos);\r\n\r\n        const params: SSRMParams = {\r\n            // the columns the user has grouped and aggregated by\r\n            valueCols: valueColumnVos,\r\n            rowGroupCols: rowGroupColumnVos,\r\n            pivotCols: pivotColumnVos,\r\n            pivotMode: this.colModel.isPivotMode(),\r\n\r\n            // sort and filter model\r\n            filterModel: this.filterManager?.isAdvFilterEnabled()\r\n                ? this.filterManager?.getAdvFilterModel()\r\n                : this.filterManager?.getFilterModel() ?? {},\r\n            sortModel: this.sortSvc?.getSortModel() ?? [],\r\n\r\n            datasource: this.datasource,\r\n            lastAccessedSequence: { value: 0 },\r\n            // blockSize: blockSize == null ? 100 : blockSize,\r\n            dynamicRowHeight: dynamicRowHeight,\r\n        };\r\n\r\n        return params;\r\n    }\r\n\r\n    public getParams(): SSRMParams {\r\n        return this.storeParams;\r\n    }\r\n\r\n    private dispatchModelUpdated(reset = false): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'modelUpdated',\r\n            animate: !reset,\r\n            keepRenderedRows: !reset,\r\n            newPage: false,\r\n            newData: false,\r\n        });\r\n    }\r\n\r\n    private onStoreUpdated(): void {\r\n        // sometimes if doing a batch update, we do the batch first,\r\n        // then call onStoreUpdated manually. eg expandAll() method.\r\n        if (this.pauseStoreUpdateListening) {\r\n            return;\r\n        }\r\n\r\n        this.updateRowIndexesAndBounds();\r\n        this.dispatchModelUpdated();\r\n    }\r\n\r\n    /** This method is debounced. It is used for row auto-height. If we don't debounce,\r\n     * then the Row Models will end up recalculating each row position\r\n     * for each row height change and result in the Row Renderer laying out rows.\r\n     * This is particularly bad if using print layout, and showing eg 1,000 rows,\r\n     * each row will change it's height, causing Row Model to update 1,000 times.\r\n     */\r\n    public onRowHeightChangedDebounced(): void {\r\n        this.onRowHeightChanged_debounced();\r\n    }\r\n\r\n    public onRowHeightChanged(): void {\r\n        this.updateRowIndexesAndBounds();\r\n        this.dispatchModelUpdated();\r\n    }\r\n\r\n    public updateRowIndexesAndBounds(): void {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return;\r\n        }\r\n        rootStore.setDisplayIndexes({ value: 0 }, { value: 0 }, 0);\r\n    }\r\n\r\n    public retryLoads(): void {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return;\r\n        }\r\n        rootStore.retryLoads();\r\n        this.onStoreUpdated();\r\n    }\r\n\r\n    public getRow(index: number): RowNode | undefined {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return undefined;\r\n        }\r\n        return rootStore.getRowUsingDisplayIndex(index) as RowNode;\r\n    }\r\n\r\n    /**\r\n     * Pauses the store, to prevent it updating the UI. This is used when doing batch updates to the store.\r\n     */\r\n    public setPaused(paused: boolean): void {\r\n        this.pauseStoreUpdateListening = paused;\r\n    }\r\n\r\n    public expandAll(value: boolean): void {\r\n        // if we don't pause store updating, we are needlessly\r\n        // recalculating row-indexes etc, and also getting rendering\r\n        // engine to re-render (listens on ModelUpdated event)\r\n        this.pauseStoreUpdateListening = true;\r\n        this.forEachNode((node) => {\r\n            if (node.stub) {\r\n                return;\r\n            }\r\n\r\n            if (node.hasChildren()) {\r\n                node.setExpanded(value);\r\n            }\r\n        });\r\n        this.pauseStoreUpdateListening = false;\r\n        this.onStoreUpdated();\r\n    }\r\n\r\n    public refreshAfterFilter(\r\n        newFilterModel: FilterModel | AdvancedFilterModel | null,\r\n        params: StoreRefreshAfterParams\r\n    ): void {\r\n        if (this.storeParams) {\r\n            this.storeParams.filterModel = newFilterModel;\r\n        }\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return;\r\n        }\r\n        rootStore.refreshAfterFilter(params);\r\n\r\n        this.onStoreUpdated();\r\n    }\r\n\r\n    public getRootStore(): LazyStore | undefined {\r\n        return this.rootNode?.childStore as LazyStore | undefined;\r\n    }\r\n\r\n    public getRowCount(): number {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return 0;\r\n        }\r\n\r\n        return rootStore.getDisplayIndexEnd()!;\r\n    }\r\n\r\n    public getTopLevelRowCount(): number {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return 1;\r\n        }\r\n        return rootStore.getRowCount();\r\n    }\r\n\r\n    public getTopLevelRowDisplayedIndex(topLevelIndex: number): number {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return topLevelIndex;\r\n        }\r\n        return rootStore.getTopLevelRowDisplayedIndex(topLevelIndex);\r\n    }\r\n\r\n    public getRowBounds(index: number): RowBounds {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            const rowHeight = _getRowHeightAsNumber(this.beans);\r\n            return {\r\n                rowTop: 0,\r\n                rowHeight: rowHeight,\r\n            };\r\n        }\r\n        return rootStore.getRowBounds(index)!;\r\n    }\r\n\r\n    public getBlockStates() {\r\n        const root = this.getRootStore();\r\n        if (!root) {\r\n            return undefined;\r\n        }\r\n\r\n        const states: any = {};\r\n        root.forEachStoreDeep((store) => {\r\n            Object.entries(store.getBlockStates()).forEach(([block, state]) => {\r\n                states[block] = state;\r\n            });\r\n        });\r\n        return states;\r\n    }\r\n\r\n    public getRowIndexAtPixel(pixel: number): number {\r\n        const rootStore = this.getRootStore();\r\n        if (pixel <= 0 || !rootStore) {\r\n            return 0;\r\n        }\r\n\r\n        return rootStore.getRowIndexAtPixel(pixel)!;\r\n    }\r\n\r\n    public isEmpty(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public isRowsToRender(): boolean {\r\n        return this.getRootStore() != null && this.getRowCount() > 0;\r\n    }\r\n\r\n    public getType(): RowModelType {\r\n        return 'serverSide';\r\n    }\r\n\r\n    public forEachNode(callback: (rowNode: RowNode, index: number) => void): void {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return;\r\n        }\r\n        rootStore.forEachNodeDeep(callback);\r\n    }\r\n\r\n    public forEachNodeAfterFilterAndSort(\r\n        callback: (node: RowNode, index: number) => void,\r\n        includeFooterNodes = false\r\n    ): void {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return;\r\n        }\r\n        rootStore.forEachNodeDeepAfterFilterAndSort(callback, undefined, includeFooterNodes);\r\n    }\r\n\r\n    /** @return false if store hasn't started */\r\n    public executeOnStore(route: string[], callback: (cache: LazyStore) => void): boolean {\r\n        if (!this.started) {\r\n            return false;\r\n        }\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return true;\r\n        }\r\n\r\n        const storeToExecuteOn = rootStore.getChildStore(route);\r\n\r\n        if (storeToExecuteOn) {\r\n            callback(storeToExecuteOn);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public refreshStore(params: RefreshServerSideParams = {}): void {\r\n        const route = params.route ? params.route : [];\r\n        this.executeOnStore(route, (store) => store.refreshStore(params.purge == true));\r\n    }\r\n\r\n    public getStoreState(): ServerSideGroupLevelState[] {\r\n        const res: ServerSideGroupLevelState[] = [];\r\n        const rootStore = this.getRootStore();\r\n        if (rootStore) {\r\n            rootStore.addStoreStates(res);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    public getNodesInRangeForSelection(firstInRange: RowNode, lastInRange: RowNode): RowNode[] | null {\r\n        const startIndex = firstInRange.rowIndex;\r\n        const endIndex = lastInRange.rowIndex;\r\n\r\n        if (startIndex === null && endIndex === null) {\r\n            return [];\r\n        }\r\n\r\n        if (endIndex === null) {\r\n            return firstInRange ? [firstInRange] : [];\r\n        }\r\n\r\n        if (startIndex === null) {\r\n            return [lastInRange];\r\n        }\r\n\r\n        const nodeRange: RowNode[] = [];\r\n        const [firstIndex, lastIndex] = [startIndex, endIndex].sort((a, b) => a - b);\r\n        this.forEachNode((node) => {\r\n            const thisRowIndex = node.rowIndex;\r\n            if (thisRowIndex == null || node.stub) {\r\n                return;\r\n            }\r\n\r\n            if (thisRowIndex >= firstIndex && thisRowIndex <= lastIndex) {\r\n                nodeRange.push(node);\r\n            }\r\n        });\r\n\r\n        // don't allow range selection if we don't have the full range of rows\r\n        if (nodeRange.length !== lastIndex - firstIndex + 1) {\r\n            return null;\r\n        }\r\n\r\n        return nodeRange;\r\n    }\r\n\r\n    public getRowNode(id: string): RowNode | undefined {\r\n        let result: RowNode | undefined;\r\n        this.forEachNode((rowNode) => {\r\n            if (rowNode.id === id) {\r\n                result = rowNode;\r\n            }\r\n            if (rowNode.detailNode && rowNode.detailNode.id === id) {\r\n                result = rowNode.detailNode;\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    public isRowPresent(rowNode: RowNode): boolean {\r\n        const foundRowNode = this.getRowNode(rowNode.id!);\r\n        return !!foundRowNode;\r\n    }\r\n\r\n    public setRowCount(rowCount: number, lastRowIndexKnown?: boolean): void {\r\n        const rootStore = this.getRootStore();\r\n        if (!rootStore) {\r\n            return;\r\n        }\r\n        rootStore.setRowCount(rowCount, lastRowIndexKnown);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyDatasource();\r\n        this.destroyRootStore();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    IServerSideGroupSelectionState,\r\n    IServerSideSelectionState,\r\n    LoadSuccessParams,\r\n    RefreshServerSideParams,\r\n    ServerSideGroupLevelState,\r\n    ServerSideTransaction,\r\n    ServerSideTransactionResult,\r\n} from 'ag-grid-community';\r\nimport { _getServerSideRowModel, _warn } from 'ag-grid-community';\r\n\r\nexport function getServerSideSelectionState(\r\n    beans: BeanCollection\r\n): IServerSideSelectionState | IServerSideGroupSelectionState | null {\r\n    return (beans.selectionSvc?.getSelectionState() ?? null) as\r\n        | IServerSideSelectionState\r\n        | IServerSideGroupSelectionState\r\n        | null;\r\n}\r\n\r\nexport function setServerSideSelectionState(\r\n    beans: BeanCollection,\r\n    state: IServerSideSelectionState | IServerSideGroupSelectionState\r\n) {\r\n    beans.selectionSvc?.setSelectionState(state, 'api');\r\n}\r\n\r\nexport function applyServerSideTransaction<TData = any>(\r\n    beans: BeanCollection,\r\n    transaction: ServerSideTransaction<TData>\r\n): ServerSideTransactionResult<TData> | undefined {\r\n    return beans.ssrmTxnManager?.applyTransaction(transaction);\r\n}\r\n\r\nexport function applyServerSideRowData<TData = any>(\r\n    beans: BeanCollection,\r\n    params: { successParams: LoadSuccessParams<TData>; route?: string[]; startRow?: number }\r\n): void {\r\n    const startRow = params.startRow ?? 0;\r\n    const route = params.route ?? [];\r\n    if (startRow < 0) {\r\n        _warn(189, { startRow });\r\n        return;\r\n    }\r\n\r\n    _getServerSideRowModel(beans)?.applyRowData(params.successParams, startRow, route);\r\n}\r\n\r\nexport function applyServerSideTransactionAsync<TData = any>(\r\n    beans: BeanCollection,\r\n    transaction: ServerSideTransaction<TData>,\r\n    callback?: (res: ServerSideTransactionResult<TData>) => void\r\n): void {\r\n    return beans.ssrmTxnManager?.applyTransactionAsync(transaction, callback);\r\n}\r\n\r\nexport function retryServerSideLoads(beans: BeanCollection): void {\r\n    _getServerSideRowModel(beans)?.retryLoads();\r\n}\r\n\r\nexport function flushServerSideAsyncTransactions(beans: BeanCollection): void {\r\n    return beans.ssrmTxnManager?.flushAsyncTransactions();\r\n}\r\n\r\nexport function refreshServerSide(beans: BeanCollection, params?: RefreshServerSideParams): void {\r\n    _getServerSideRowModel(beans)?.refreshStore(params);\r\n}\r\n\r\nexport function getServerSideGroupLevelState(beans: BeanCollection): ServerSideGroupLevelState[] {\r\n    return _getServerSideRowModel(beans)?.getStoreState() ?? [];\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    IExpansionService,\r\n    IsServerSideGroupOpenByDefaultParams,\r\n    NamedBean,\r\n    RowGroupOpenedEvent,\r\n    RowNode,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\n\r\nimport { BaseExpansionService } from '../../rowHierarchy/baseExpansionService';\r\nimport type { ServerSideRowModel } from '../serverSideRowModel';\r\n\r\nexport class ServerSideExpansionService extends BaseExpansionService implements NamedBean, IExpansionService {\r\n    beanName = 'expansionSvc' as const;\r\n\r\n    private serverSideRowModel: ServerSideRowModel;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.serverSideRowModel = beans.rowModel as ServerSideRowModel;\r\n    }\r\n\r\n    private queuedRowIds: Set<string> = new Set();\r\n\r\n    public postConstruct(): void {\r\n        this.addManagedEventListeners({\r\n            columnRowGroupChanged: () => {\r\n                this.queuedRowIds.clear();\r\n            },\r\n        });\r\n    }\r\n\r\n    public checkOpenByDefault(rowNode: RowNode): void {\r\n        if (!rowNode.isExpandable()) {\r\n            return;\r\n        }\r\n\r\n        if (this.queuedRowIds.has(rowNode.id!)) {\r\n            this.queuedRowIds.delete(rowNode.id!);\r\n            rowNode.setExpanded(true);\r\n            return;\r\n        }\r\n\r\n        const userFunc = this.gos.getCallback('isServerSideGroupOpenByDefault');\r\n        if (!userFunc) {\r\n            return;\r\n        }\r\n\r\n        const params: WithoutGridCommon<IsServerSideGroupOpenByDefaultParams> = {\r\n            data: rowNode.data,\r\n            rowNode,\r\n        };\r\n\r\n        const userFuncRes = userFunc(params);\r\n\r\n        if (userFuncRes) {\r\n            rowNode.setExpanded(true);\r\n        }\r\n    }\r\n\r\n    public expandRows(rowIds: string[]): void {\r\n        rowIds.forEach((rowId) => {\r\n            const rowNode = this.serverSideRowModel.getRowNode(rowId);\r\n            if (rowNode) {\r\n                rowNode.setExpanded(true);\r\n            } else {\r\n                this.queuedRowIds.add(rowId);\r\n            }\r\n        });\r\n    }\r\n\r\n    public expandAll(value: boolean): void {\r\n        this.serverSideRowModel.expandAll(value);\r\n    }\r\n\r\n    public onGroupExpandedOrCollapsed(): void {\r\n        // do nothing\r\n    }\r\n\r\n    protected override dispatchExpandedEvent(event: RowGroupOpenedEvent): void {\r\n        this.eventSvc.dispatchEvent(event);\r\n    }\r\n}\r\n", "import type {\r\n    ISelectionService,\r\n    ISetNodesSelectedParams,\r\n    NamedBean,\r\n    RowNode,\r\n    RowSelectionMode,\r\n    SelectAllMode,\r\n    SelectionEventSourceType,\r\n    ServerSideRowGroupSelectionState,\r\n    ServerSideRowSelectionState,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BaseSelectionService,\r\n    _error,\r\n    _getGroupSelectsDescendants,\r\n    _getRowSelectionMode,\r\n    _isMultiRowSelection,\r\n    _isRowSelection,\r\n    _isUsingNewRowSelectionAPI,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { DefaultStrategy } from './selection/strategies/defaultStrategy';\r\nimport { GroupSelectsChildrenStrategy } from './selection/strategies/groupSelectsChildrenStrategy';\r\nimport type { ISelectionStrategy } from './selection/strategies/iSelectionStrategy';\r\n\r\nexport class ServerSideSelectionService extends BaseSelectionService implements NamedBean, ISelectionService {\r\n    beanName = 'selectionSvc' as const;\r\n\r\n    private selectionStrategy: ISelectionStrategy;\r\n    private selectionMode?: RowSelectionMode;\r\n\r\n    public override postConstruct(): void {\r\n        super.postConstruct();\r\n        this.addManagedPropertyListeners(['groupSelectsChildren', 'rowSelection'], () => {\r\n            const groupSelectsChildren = _getGroupSelectsDescendants(this.gos);\r\n\r\n            // Only switch strategies when value of groupSelectsChildren actually changes, not just any part of selection options\r\n            const Strategy =\r\n                groupSelectsChildren && this.selectionStrategy instanceof DefaultStrategy\r\n                    ? GroupSelectsChildrenStrategy\r\n                    : !groupSelectsChildren && this.selectionStrategy instanceof GroupSelectsChildrenStrategy\r\n                      ? DefaultStrategy\r\n                      : undefined;\r\n\r\n            if (Strategy) {\r\n                this.destroyBean(this.selectionStrategy);\r\n\r\n                this.selectionStrategy = this.createManagedBean(new Strategy());\r\n\r\n                this.shotgunResetNodeSelectionState();\r\n                this.dispatchSelectionChanged('api');\r\n            }\r\n        });\r\n\r\n        this.addManagedPropertyListeners(['rowSelection'], () => {\r\n            // Only reset selection when selection mode changes, not just any part of selection options\r\n            const rowSelection = _getRowSelectionMode(this.gos);\r\n            if (rowSelection !== this.selectionMode) {\r\n                this.selectionMode = rowSelection;\r\n                this.deselectAllRowNodes({ source: 'api' });\r\n            }\r\n        });\r\n\r\n        this.selectionMode = _getRowSelectionMode(this.gos);\r\n        const groupSelectsChildren = _getGroupSelectsDescendants(this.gos);\r\n        const Strategy = !groupSelectsChildren ? DefaultStrategy : GroupSelectsChildrenStrategy;\r\n        this.selectionStrategy = this.createManagedBean(new Strategy());\r\n    }\r\n\r\n    public handleSelectionEvent(\r\n        event: MouseEvent | KeyboardEvent,\r\n        rowNode: RowNode<any>,\r\n        source: SelectionEventSourceType\r\n    ): number {\r\n        if (this.isRowSelectionBlocked(rowNode)) return 0;\r\n\r\n        let updatedRows = 0;\r\n\r\n        const selection = this.inferNodeSelections(rowNode, event.shiftKey, event.metaKey || event.ctrlKey, source);\r\n\r\n        if (selection == null) {\r\n            return 0;\r\n        }\r\n\r\n        if ('select' in selection) {\r\n            if (selection.reset) {\r\n                this.selectionStrategy.deselectAllRowNodes({ source: 'api' });\r\n            } else {\r\n                this.selectionStrategy.setNodesSelected({ nodes: selection.deselect, newValue: false, source });\r\n            }\r\n            updatedRows = this.selectionStrategy.setNodesSelected({ nodes: selection.select, newValue: true, source });\r\n        } else {\r\n            updatedRows = this.selectionStrategy.setNodesSelected({\r\n                nodes: [selection.node],\r\n                newValue: selection.newValue,\r\n                clearSelection: selection.clearSelection,\r\n                event,\r\n                source,\r\n            });\r\n        }\r\n\r\n        this.shotgunResetNodeSelectionState();\r\n        this.dispatchSelectionChanged(source);\r\n\r\n        return updatedRows;\r\n    }\r\n\r\n    public getSelectionState(): string[] | ServerSideRowSelectionState | ServerSideRowGroupSelectionState | null {\r\n        return this.selectionStrategy.getSelectedState();\r\n    }\r\n\r\n    public setSelectionState(\r\n        state: string[] | ServerSideRowSelectionState | ServerSideRowGroupSelectionState,\r\n        source: SelectionEventSourceType\r\n    ): void {\r\n        if (!_isRowSelection(this.gos)) {\r\n            _warn(132);\r\n            return;\r\n        }\r\n        if (Array.isArray(state)) {\r\n            return;\r\n        }\r\n        this.selectionStrategy.setSelectedState(state);\r\n        this.shotgunResetNodeSelectionState();\r\n\r\n        this.dispatchSelectionChanged(source);\r\n    }\r\n\r\n    public setNodesSelected(params: ISetNodesSelectedParams): number {\r\n        if (!_isRowSelection(this.gos) && params.newValue) {\r\n            _warn(132);\r\n            return 0;\r\n        }\r\n\r\n        const { nodes, ...otherParams } = params;\r\n\r\n        if (nodes.length > 1 && this.selectionMode !== 'multiRow') {\r\n            _warn(130);\r\n            return 0;\r\n        }\r\n\r\n        const adjustedParams = {\r\n            nodes: nodes.filter((node) => node.selectable),\r\n            ...otherParams,\r\n        };\r\n\r\n        // if no selectable nodes, then return 0\r\n        if (!adjustedParams.nodes.length) {\r\n            return 0;\r\n        }\r\n\r\n        const changedNodes = this.selectionStrategy.setNodesSelected(adjustedParams);\r\n        this.shotgunResetNodeSelectionState(adjustedParams.source);\r\n        this.dispatchSelectionChanged(adjustedParams.source);\r\n        return changedNodes;\r\n    }\r\n\r\n    /**\r\n     * Deletes the selection state for a set of nodes, for use after deleting nodes via\r\n     * transaction. As this is designed for transactions, all nodes should belong to the same group.\r\n     */\r\n    public deleteSelectionStateFromParent(storeRoute: string[], removedNodeIds: string[]) {\r\n        const stateChanged = this.selectionStrategy.deleteSelectionStateFromParent(storeRoute, removedNodeIds);\r\n        if (!stateChanged) {\r\n            return;\r\n        }\r\n\r\n        this.shotgunResetNodeSelectionState();\r\n        this.dispatchSelectionChanged('api');\r\n    }\r\n\r\n    private shotgunResetNodeSelectionState(source?: SelectionEventSourceType) {\r\n        this.beans.rowModel.forEachNode((node) => {\r\n            if (node.stub) {\r\n                return;\r\n            }\r\n\r\n            const isNodeSelected = this.selectionStrategy.isNodeSelected(node);\r\n            if (isNodeSelected !== node.isSelected()) {\r\n                this.selectRowNode(node, isNodeSelected, undefined, source);\r\n            }\r\n        });\r\n    }\r\n\r\n    public getSelectedNodes(): RowNode<any>[] {\r\n        return this.selectionStrategy.getSelectedNodes();\r\n    }\r\n\r\n    public getSelectedRows(): any[] {\r\n        return this.selectionStrategy.getSelectedRows();\r\n    }\r\n\r\n    public getSelectionCount(): number {\r\n        return this.selectionStrategy.getSelectionCount();\r\n    }\r\n\r\n    public syncInRowNode(rowNode: RowNode<any>): void {\r\n        // update any refs being held in the strategies\r\n        this.selectionStrategy.processNewRow(rowNode);\r\n\r\n        const isNodeSelected = this.selectionStrategy.isNodeSelected(rowNode);\r\n\r\n        // if the node was selected but node is not selectable, we deselect the node.\r\n        // (could be due to user applying selected state directly, or a change in selectable)\r\n        if (isNodeSelected != false && !rowNode.selectable) {\r\n            this.selectionStrategy.setNodesSelected({\r\n                nodes: [rowNode],\r\n                newValue: false,\r\n                source: 'api',\r\n            });\r\n\r\n            // we need to shotgun reset here as if this was hierarchical, some group nodes\r\n            // may be changing from indeterminate to unchecked.\r\n            this.shotgunResetNodeSelectionState();\r\n            this.dispatchSelectionChanged('api');\r\n            return;\r\n        }\r\n        rowNode.__selected = isNodeSelected;\r\n    }\r\n\r\n    public reset(): void {\r\n        this.selectionStrategy.deselectAllRowNodes({ source: 'api' });\r\n        this.selectionCtx.reset();\r\n    }\r\n\r\n    public isEmpty(): boolean {\r\n        return this.selectionStrategy.isEmpty();\r\n    }\r\n\r\n    public hasNodesToSelect() {\r\n        return true;\r\n    }\r\n\r\n    public selectAllRowNodes(params: { source: SelectionEventSourceType; selectAll?: SelectAllMode }): void {\r\n        if (!_isRowSelection(this.gos)) {\r\n            _warn(132);\r\n            return;\r\n        }\r\n\r\n        validateSelectionParameters(params);\r\n        if (_isUsingNewRowSelectionAPI(this.gos) && !_isMultiRowSelection(this.gos)) {\r\n            return _warn(130);\r\n        }\r\n\r\n        this.selectionStrategy.selectAllRowNodes(params);\r\n        this.selectionCtx.reset();\r\n\r\n        this.beans.rowModel.forEachNode((node) => {\r\n            if (node.stub) {\r\n                return;\r\n            }\r\n\r\n            this.selectRowNode(node, true, undefined, params.source);\r\n        });\r\n\r\n        this.dispatchSelectionChanged(params.source);\r\n    }\r\n\r\n    public deselectAllRowNodes(params: { source: SelectionEventSourceType; selectAll?: SelectAllMode }): void {\r\n        validateSelectionParameters(params);\r\n\r\n        this.selectionStrategy.deselectAllRowNodes(params);\r\n        this.selectionCtx.reset();\r\n\r\n        this.beans.rowModel.forEachNode((node) => {\r\n            if (node.stub) {\r\n                return;\r\n            }\r\n\r\n            this.selectRowNode(node, false, undefined, params.source);\r\n        });\r\n\r\n        this.dispatchSelectionChanged(params.source);\r\n    }\r\n\r\n    public getSelectAllState(selectAll?: SelectAllMode): boolean | null {\r\n        return this.selectionStrategy.getSelectAllState(selectAll);\r\n    }\r\n\r\n    // used by CSRM\r\n    public getBestCostNodeSelection(): RowNode<any>[] | undefined {\r\n        return _warn(194, { method: 'getBestCostNodeSelection' }) as undefined;\r\n    }\r\n\r\n    /**\r\n     * Updates the selectable state for a node by invoking isRowSelectable callback.\r\n     * If the node is not selectable, it will be deselected.\r\n     *\r\n     * Callers:\r\n     *  - property isRowSelectable changed\r\n     *  - after grouping / treeData\r\n     */\r\n    protected override updateSelectable(): void {\r\n        if (!_isRowSelection(this.gos)) {\r\n            return;\r\n        }\r\n\r\n        const nodesToDeselect: RowNode[] = [];\r\n\r\n        this.beans.rowModel.forEachNode((node) => {\r\n            const rowSelectable = this.updateRowSelectable(node, true);\r\n\r\n            if (!rowSelectable && node.isSelected()) {\r\n                nodesToDeselect.push(node);\r\n            }\r\n        });\r\n\r\n        if (nodesToDeselect.length) {\r\n            this.setNodesSelected({\r\n                nodes: nodesToDeselect,\r\n                newValue: false,\r\n                source: 'selectableChanged',\r\n            });\r\n        }\r\n    }\r\n\r\n    public updateSelectableAfterGrouping(): void {\r\n        return _error(194, { method: 'updateSelectableAfterGrouping' }) as undefined;\r\n    }\r\n}\r\nfunction validateSelectionParameters({ selectAll }: { source: SelectionEventSourceType; selectAll?: SelectAllMode }) {\r\n    if (selectAll === 'filtered' || selectAll === 'currentPage') {\r\n        _warn(195, { justCurrentPage: selectAll === 'currentPage' });\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    IRowModel,\r\n    ISelectionService,\r\n    IServerSideGroupSelectionState,\r\n    IServerSideSelectionState,\r\n    ISetNodesSelectedParams,\r\n    RowNode,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _error, _isMultiRowSelection, _isUsingNewRowSelectionAPI, _warn } from 'ag-grid-community';\r\n\r\nimport type { ISelectionStrategy } from './iSelectionStrategy';\r\n\r\ninterface SelectedState {\r\n    selectAll: boolean;\r\n    toggledNodes: Set<string>;\r\n}\r\n\r\nexport class DefaultStrategy extends BeanStub implements ISelectionStrategy {\r\n    private rowModel: IRowModel;\r\n    private selectionSvc?: ISelectionService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.rowModel = beans.rowModel;\r\n        this.selectionSvc = beans.selectionSvc;\r\n    }\r\n\r\n    private selectedState: SelectedState = { selectAll: false, toggledNodes: new Set() };\r\n\r\n    private selectAllUsed: boolean = false;\r\n    // this is to prevent regressions, default selectionSvc retains reference of clicked nodes.\r\n    private selectedNodes: { [key: string]: RowNode } = {};\r\n\r\n    public getSelectedState(): IServerSideSelectionState {\r\n        return {\r\n            selectAll: this.selectedState.selectAll,\r\n            toggledNodes: [...this.selectedState.toggledNodes],\r\n        };\r\n    }\r\n\r\n    public setSelectedState(state: IServerSideSelectionState | IServerSideGroupSelectionState): void {\r\n        if (typeof state !== 'object') {\r\n            // The provided selection state should be an object\r\n            _error(115);\r\n            return;\r\n        }\r\n\r\n        if (!('selectAll' in state)) {\r\n            //'Invalid selection state. The state must conform to `IServerSideSelectionState`.'\r\n            _error(116);\r\n            return;\r\n        }\r\n\r\n        if (typeof state.selectAll !== 'boolean') {\r\n            //selectAll must be of boolean type.\r\n            _error(117);\r\n            return;\r\n        }\r\n\r\n        if (!('toggledNodes' in state) || !Array.isArray(state.toggledNodes)) {\r\n            return _warn(197);\r\n        }\r\n\r\n        const newState: SelectedState = {\r\n            selectAll: state.selectAll,\r\n            toggledNodes: new Set(),\r\n        };\r\n\r\n        state.toggledNodes.forEach((key: any) => {\r\n            if (typeof key === 'string') {\r\n                newState.toggledNodes.add(key);\r\n            } else {\r\n                _warn(196, { key });\r\n            }\r\n        });\r\n\r\n        const isSelectingMultipleRows = newState.selectAll || newState.toggledNodes.size > 1;\r\n        if (_isUsingNewRowSelectionAPI(this.gos) && !_isMultiRowSelection(this.gos) && isSelectingMultipleRows) {\r\n            _warn(198);\r\n            return;\r\n        }\r\n\r\n        this.selectedState = newState;\r\n    }\r\n\r\n    public deleteSelectionStateFromParent(parentPath: string[], removedNodeIds: string[]): boolean {\r\n        if (this.selectedState.toggledNodes.size === 0) {\r\n            return false;\r\n        }\r\n\r\n        let anyNodesToggled = false;\r\n\r\n        removedNodeIds.forEach((id) => {\r\n            if (this.selectedState.toggledNodes.delete(id)) {\r\n                anyNodesToggled = true;\r\n            }\r\n        });\r\n\r\n        return anyNodesToggled;\r\n    }\r\n\r\n    public setNodesSelected(params: ISetNodesSelectedParams): number {\r\n        const { nodes, clearSelection, newValue } = params;\r\n        if (nodes.length === 0) return 0;\r\n\r\n        const onlyThisNode = clearSelection && newValue;\r\n        if (!_isMultiRowSelection(this.gos) || onlyThisNode) {\r\n            if (nodes.length > 1) {\r\n                _error(241);\r\n                return 0;\r\n            }\r\n            const rowNode = nodes[0];\r\n            const node = rowNode.footer ? rowNode.sibling : rowNode;\r\n            if (newValue && node.selectable) {\r\n                this.selectedNodes = { [node.id!]: node };\r\n                this.selectedState = {\r\n                    selectAll: false,\r\n                    toggledNodes: new Set([node.id!]),\r\n                };\r\n            } else {\r\n                this.selectedNodes = {};\r\n                this.selectedState = {\r\n                    selectAll: false,\r\n                    toggledNodes: new Set(),\r\n                };\r\n            }\r\n            return 1;\r\n        }\r\n\r\n        const updateNodeState = (rowNode: RowNode, value = newValue) => {\r\n            const node = rowNode.footer ? rowNode.sibling : rowNode;\r\n            if (value && node.selectable) {\r\n                this.selectedNodes[node.id!] = node;\r\n            } else {\r\n                delete this.selectedNodes[node.id!];\r\n            }\r\n\r\n            const doesNodeConform = value === this.selectedState.selectAll;\r\n            if (doesNodeConform || !node.selectable) {\r\n                this.selectedState.toggledNodes.delete(node.id!);\r\n            } else {\r\n                this.selectedState.toggledNodes.add(node.id!);\r\n            }\r\n        };\r\n\r\n        nodes.forEach((node) => updateNodeState(node));\r\n        return 1;\r\n    }\r\n\r\n    public processNewRow(node: RowNode<any>): void {\r\n        if (this.selectedNodes[node.id!]) {\r\n            this.selectedNodes[node.id!] = node;\r\n        }\r\n    }\r\n\r\n    public isNodeSelected(node: RowNode): boolean | undefined {\r\n        const isToggled = this.selectedState.toggledNodes.has(node.id!);\r\n        return this.selectedState.selectAll ? !isToggled : isToggled;\r\n    }\r\n\r\n    public getSelectedNodes(): RowNode<any>[] {\r\n        if (this.selectAllUsed) {\r\n            _warn(199);\r\n        }\r\n        return Object.values(this.selectedNodes);\r\n    }\r\n\r\n    public getSelectedRows(): any[] {\r\n        return this.getSelectedNodes().map((node) => node.data);\r\n    }\r\n\r\n    public getSelectionCount(): number {\r\n        if (this.selectedState.selectAll) {\r\n            return -1;\r\n        }\r\n        return this.selectedState.toggledNodes.size;\r\n    }\r\n\r\n    public isEmpty(): boolean {\r\n        return !this.selectedState.selectAll && !this.selectedState.toggledNodes?.size;\r\n    }\r\n\r\n    public selectAllRowNodes(): void {\r\n        this.selectedState = { selectAll: true, toggledNodes: new Set() };\r\n        this.selectedNodes = {};\r\n        this.selectAllUsed = true;\r\n    }\r\n\r\n    public deselectAllRowNodes(): void {\r\n        this.selectedState = { selectAll: false, toggledNodes: new Set() };\r\n        this.selectedNodes = {};\r\n    }\r\n\r\n    public getSelectAllState(): boolean | null {\r\n        if (this.selectedState.selectAll) {\r\n            if (this.selectedState.toggledNodes.size > 0) {\r\n                return null;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        if (this.selectedState.toggledNodes.size > 0) {\r\n            return null;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    FilterManager,\r\n    IColsService,\r\n    IRowModel,\r\n    IRowNode,\r\n    ISelectionService,\r\n    IServerSideGroupSelectionState,\r\n    IServerSideSelectionState,\r\n    ISetNodesSelectedParams,\r\n    RowNode,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _error, _isMultiRowSelection, _warn } from 'ag-grid-community';\r\n\r\nimport type { LazyStore } from '../../../stores/lazy/lazyStore';\r\nimport type { ISelectionStrategy } from './iSelectionStrategy';\r\n\r\ninterface SelectionState {\r\n    selectAllChildren: boolean;\r\n    toggledNodes: Map<string, SelectionState>;\r\n}\r\n\r\nexport class GroupSelectsChildrenStrategy extends BeanStub implements ISelectionStrategy {\r\n    private rowModel: IRowModel;\r\n    private rowGroupColsSvc?: IColsService;\r\n    private filterManager?: FilterManager;\r\n    private selectionSvc: ISelectionService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.rowModel = beans.rowModel;\r\n        this.rowGroupColsSvc = beans.rowGroupColsSvc;\r\n        this.filterManager = beans.filterManager;\r\n        this.selectionSvc = beans.selectionSvc!;\r\n    }\r\n\r\n    private selectedState: SelectionState = { selectAllChildren: false, toggledNodes: new Map() };\r\n\r\n    public postConstruct(): void {\r\n        this.addManagedEventListeners({\r\n            // if model has updated, a store may now be fully loaded to clean up indeterminate states\r\n            modelUpdated: () => this.removeRedundantState(),\r\n            // when the grouping changes, the state no longer makes sense, so reset the state.\r\n            columnRowGroupChanged: () => this.selectionSvc.reset('rowGroupChanged'),\r\n        });\r\n    }\r\n\r\n    public getSelectedState() {\r\n        const treeData = this.gos.get('treeData');\r\n        const recursivelySerializeState = (state: SelectionState, level: number, nodeId?: string) => {\r\n            const normalisedState: IServerSideGroupSelectionState = {\r\n                nodeId,\r\n            };\r\n\r\n            if (treeData || (this.rowGroupColsSvc && level <= this.rowGroupColsSvc?.columns.length)) {\r\n                normalisedState.selectAllChildren = state.selectAllChildren;\r\n            }\r\n\r\n            // omit toggledNodes if empty\r\n            if (state.toggledNodes.size) {\r\n                const toggledNodes: IServerSideGroupSelectionState[] = [];\r\n                state.toggledNodes.forEach((value, key) => {\r\n                    const newState = recursivelySerializeState(value, level + 1, key);\r\n                    toggledNodes.push(newState);\r\n                });\r\n                normalisedState.toggledNodes = toggledNodes;\r\n            }\r\n\r\n            return normalisedState;\r\n        };\r\n        return recursivelySerializeState(this.selectedState, 0);\r\n    }\r\n\r\n    public setSelectedState(state: IServerSideSelectionState | IServerSideGroupSelectionState): void {\r\n        if ('selectAll' in state) {\r\n            // 'Invalid selection state. When `groupSelectsChildren` is enabled, the state must conform to `IServerSideGroupSelectionState`.'\r\n            _error(111);\r\n            return;\r\n        }\r\n\r\n        const recursivelyDeserializeState = (\r\n            normalisedState: IServerSideGroupSelectionState,\r\n            parentSelected: boolean\r\n        ): SelectionState => {\r\n            if (typeof normalisedState !== 'object') {\r\n                _error(243);\r\n                throw new Error();\r\n            }\r\n            if ('selectAllChildren' in normalisedState && typeof normalisedState.selectAllChildren !== 'boolean') {\r\n                _error(244);\r\n                throw new Error();\r\n            }\r\n            if ('toggledNodes' in normalisedState) {\r\n                if (!Array.isArray(normalisedState.toggledNodes)) {\r\n                    _error(245);\r\n                    throw new Error();\r\n                }\r\n                const allHaveIds = normalisedState.toggledNodes.every(\r\n                    (innerState) =>\r\n                        typeof innerState === 'object' &&\r\n                        'nodeId' in innerState &&\r\n                        typeof innerState.nodeId === 'string'\r\n                );\r\n                if (!allHaveIds) {\r\n                    _error(246);\r\n                    throw new Error();\r\n                }\r\n            }\r\n            const isThisNodeSelected = normalisedState.selectAllChildren ?? !parentSelected;\r\n            const convertedChildren = normalisedState.toggledNodes?.map<[string, SelectionState]>((innerState) => [\r\n                innerState.nodeId!,\r\n                recursivelyDeserializeState(innerState, isThisNodeSelected),\r\n            ]);\r\n            const doesRedundantStateExist = convertedChildren?.some(\r\n                ([, innerState]) =>\r\n                    isThisNodeSelected === innerState.selectAllChildren && innerState.toggledNodes.size === 0\r\n            );\r\n            if (doesRedundantStateExist) {\r\n                _error(247);\r\n                throw new Error();\r\n            }\r\n            return {\r\n                selectAllChildren: isThisNodeSelected,\r\n                toggledNodes: new Map(convertedChildren),\r\n            };\r\n        };\r\n\r\n        try {\r\n            this.selectedState = recursivelyDeserializeState(state, !!state.selectAllChildren);\r\n        } catch (e) {\r\n            // do nothing - error already logged\r\n        }\r\n    }\r\n\r\n    public deleteSelectionStateFromParent(parentRoute: string[], removedNodeIds: string[]): boolean {\r\n        let parentState: SelectionState | undefined = this.selectedState;\r\n        const remainingRoute = [...parentRoute];\r\n        while (parentState && remainingRoute.length) {\r\n            parentState = parentState.toggledNodes.get(remainingRoute.pop()!);\r\n        }\r\n\r\n        // parent has no explicit state, nothing to remove\r\n        if (!parentState) {\r\n            return false;\r\n        }\r\n\r\n        let anyStateChanged = false;\r\n        removedNodeIds.forEach((id) => {\r\n            if (parentState?.toggledNodes.delete(id)) {\r\n                anyStateChanged = true;\r\n            }\r\n        });\r\n\r\n        if (anyStateChanged) {\r\n            this.removeRedundantState();\r\n        }\r\n        return anyStateChanged;\r\n    }\r\n\r\n    public setNodesSelected({ nodes, newValue, clearSelection }: ISetNodesSelectedParams): number {\r\n        if (nodes.length === 0) return 0;\r\n\r\n        const onlyThisNode = clearSelection && newValue;\r\n        if (!_isMultiRowSelection(this.gos) || onlyThisNode) {\r\n            if (nodes.length > 1) {\r\n                _error(241);\r\n                return 0;\r\n            }\r\n            this.deselectAllRowNodes();\r\n        }\r\n\r\n        nodes.forEach((rowNode) => {\r\n            const node = rowNode.footer ? rowNode.sibling : rowNode;\r\n            const idPathToNode = this.getRouteToNode(node);\r\n            this.recursivelySelectNode(idPathToNode, this.selectedState, newValue);\r\n        });\r\n        this.removeRedundantState();\r\n        return 1;\r\n    }\r\n\r\n    public isNodeSelected(node: RowNode): boolean | undefined {\r\n        const path = this.getRouteToNode(node);\r\n        return this.isNodePathSelected(path, this.selectedState);\r\n    }\r\n\r\n    private isNodePathSelected([nextNode, ...nodes]: RowNode[], state: SelectionState): boolean | undefined {\r\n        if (nodes.length === 0) {\r\n            const isToggled = state.toggledNodes.has(nextNode.id!);\r\n            if (nextNode.hasChildren()) {\r\n                const groupState = state.toggledNodes.get(nextNode.id!);\r\n                if (groupState && groupState.toggledNodes.size) {\r\n                    return undefined;\r\n                }\r\n            }\r\n            return state.selectAllChildren ? !isToggled : isToggled;\r\n        }\r\n\r\n        // if there's a deeper level, check recursively\r\n        if (state.toggledNodes.has(nextNode.id!)) {\r\n            const nextState = state.toggledNodes.get(nextNode.id!);\r\n            if (nextState) {\r\n                return this.isNodePathSelected(nodes, nextState);\r\n            }\r\n        }\r\n\r\n        // no deeper custom state, respect the closest default\r\n        return state.selectAllChildren;\r\n    }\r\n\r\n    private getRouteToNode(node: RowNode) {\r\n        const pathToNode = [];\r\n        let tempNode = node;\r\n        while (tempNode.parent) {\r\n            pathToNode.push(tempNode);\r\n            tempNode = tempNode.parent;\r\n        }\r\n        return pathToNode.reverse();\r\n    }\r\n\r\n    private removeRedundantState() {\r\n        if (this.filterManager?.isAnyFilterPresent()) {\r\n            return;\r\n        }\r\n\r\n        const forEachNodeStateDepthFirst = (\r\n            state = this.selectedState,\r\n            thisKey?: string,\r\n            parentState?: SelectionState\r\n        ) => {\r\n            // clean up lowest level state first in order to calculate this levels state\r\n            // from updated child state\r\n            state.toggledNodes.forEach((value, key) => {\r\n                forEachNodeStateDepthFirst(value, key, state);\r\n            });\r\n\r\n            if (thisKey) {\r\n                const thisRow = this.rowModel.getRowNode(thisKey);\r\n                const thisRowStore = thisRow?.childStore as LazyStore | undefined;\r\n                const isStoreSizeKnown = thisRowStore?.isLastRowIndexKnown();\r\n                if (isStoreSizeKnown) {\r\n                    // have to check greater than, as we may have stale state still, if so all visible rows may not be\r\n                    // toggled\r\n                    const possibleAllNodesToggled = state.toggledNodes.size >= thisRowStore!.getRowCount();\r\n                    if (possibleAllNodesToggled) {\r\n                        // more complex checks nested for performance\r\n                        for (const childState of state.toggledNodes.entries()) {\r\n                            const [key, value] = childState;\r\n                            // if any child has toggled rows, then this row is indeterminate\r\n                            // and the state is relevant.\r\n                            if (value.toggledNodes.size > 0) {\r\n                                return;\r\n                            }\r\n\r\n                            const rowDoesNotExist = !this.rowModel.getRowNode(key);\r\n                            if (rowDoesNotExist) {\r\n                                // if row doesn't exist, it's not toggled.\r\n                                return;\r\n                            }\r\n                        }\r\n\r\n                        // no indeterminate rows, and all rows are toggled, flip this row state\r\n                        // and clear child states.\r\n                        state.selectAllChildren = !state.selectAllChildren;\r\n                        state.toggledNodes.clear();\r\n                    }\r\n                }\r\n            }\r\n\r\n            // if this has no toggled rows, and is identical to parent state, it's redundant and can be removed.\r\n            const hasNoToggledRows = state.toggledNodes.size === 0;\r\n            const isIdenticalToParent = parentState?.selectAllChildren === state.selectAllChildren;\r\n            if (hasNoToggledRows && isIdenticalToParent) {\r\n                parentState?.toggledNodes.delete(thisKey!);\r\n            }\r\n        };\r\n        forEachNodeStateDepthFirst();\r\n    }\r\n\r\n    private recursivelySelectNode([nextNode, ...nodes]: IRowNode[], selectedState: SelectionState, newValue: boolean) {\r\n        if (!nextNode) {\r\n            return;\r\n        }\r\n\r\n        // if this is the last node, hard add/remove based on its selectAllChildren state\r\n        const isLastNode = !nodes.length;\r\n        if (isLastNode) {\r\n            // if the node is not selectable, we should never have it in selection state\r\n            const isNodeSelectable = nextNode.selectable;\r\n            const doesNodeConform = selectedState.selectAllChildren === newValue;\r\n            if (doesNodeConform || !isNodeSelectable) {\r\n                selectedState.toggledNodes.delete(nextNode.id!);\r\n                return;\r\n            }\r\n            const newState: SelectionState = {\r\n                selectAllChildren: newValue,\r\n                toggledNodes: new Map(),\r\n            };\r\n            selectedState.toggledNodes.set(nextNode.id!, newState);\r\n            return;\r\n        }\r\n\r\n        const doesStateAlreadyExist = selectedState.toggledNodes.has(nextNode.id!);\r\n        const childState: SelectionState = selectedState.toggledNodes.get(nextNode.id!) ?? {\r\n            selectAllChildren: selectedState.selectAllChildren,\r\n            toggledNodes: new Map(),\r\n        };\r\n\r\n        if (!doesStateAlreadyExist) {\r\n            selectedState.toggledNodes.set(nextNode.id!, childState);\r\n        }\r\n\r\n        this.recursivelySelectNode(nodes, childState, newValue);\r\n\r\n        // cleans out groups which have no toggled nodes and an equivalent default to its parent\r\n        if (selectedState.selectAllChildren === childState.selectAllChildren && childState.toggledNodes.size === 0) {\r\n            selectedState.toggledNodes.delete(nextNode.id!);\r\n        }\r\n    }\r\n\r\n    public getSelectedNodes(): RowNode<any>[] {\r\n        _warn(202);\r\n\r\n        const selectedNodes: RowNode[] = [];\r\n        this.rowModel.forEachNode((node) => {\r\n            if (node.isSelected()) {\r\n                selectedNodes.push(node);\r\n            }\r\n        });\r\n        return selectedNodes;\r\n    }\r\n\r\n    public processNewRow(): void {\r\n        // This is used for updating outdated node refs, as this model entirely uses ids it's irrelevant\r\n    }\r\n\r\n    public getSelectedRows(): any[] {\r\n        return this.getSelectedNodes().map((node) => node.data);\r\n    }\r\n\r\n    public getSelectionCount(): number {\r\n        return -1;\r\n    }\r\n\r\n    public isEmpty(): boolean {\r\n        return !this.selectedState.selectAllChildren && !this.selectedState.toggledNodes?.size;\r\n    }\r\n\r\n    public selectAllRowNodes(): void {\r\n        this.selectedState = { selectAllChildren: true, toggledNodes: new Map() };\r\n    }\r\n\r\n    public deselectAllRowNodes(): void {\r\n        this.selectedState = { selectAllChildren: false, toggledNodes: new Map() };\r\n    }\r\n\r\n    public getSelectAllState(): boolean | null {\r\n        if (this.selectedState.selectAllChildren) {\r\n            if (this.selectedState.toggledNodes.size > 0) {\r\n                return null;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        if (this.selectedState.toggledNodes.size > 0) {\r\n            return null;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n", "import type { IRowChildrenService, NamedBean, RowNode } from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\n/** handles row grouping and tree data logic */\r\nexport class SsrmRowChildrenService extends BeanStub implements NamedBean, IRowChildrenService {\r\n    beanName = 'rowChildrenSvc' as const;\r\n\r\n    public getHasChildrenValue(rowNode: RowNode): boolean | null {\r\n        const isTreeData = this.gos.get('treeData');\r\n        const isGroupFunc = this.gos.get('isServerSideGroup');\r\n        // stubs and footers can never have children, as they're grid rows. if tree data the presence of children\r\n        // is determined by the isServerSideGroup callback, if not tree data then the rows group property will be set.\r\n        return (\r\n            !rowNode.stub &&\r\n            !rowNode.footer &&\r\n            (isTreeData ? !!isGroupFunc && isGroupFunc(rowNode.data) : !!rowNode.group)\r\n        );\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    IServerSideGetRowsParams,\r\n    IServerSideGetRowsRequest,\r\n    LoadSuccessParams,\r\n    NamedBean,\r\n    RowNode,\r\n    RowRenderer,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _getMaxConcurrentDatasourceRequests } from 'ag-grid-community';\r\n\r\nimport type { ServerSideRowModel } from '../../serverSideRowModel';\r\nimport type { LazyCache } from './lazyCache';\r\nimport type { LazyStore } from './lazyStore';\r\n\r\nexport class LazyBlockLoadingService extends BeanStub implements NamedBean {\r\n    beanName = 'lazyBlockLoadingSvc' as const;\r\n\r\n    private outboundRequests: number = 0;\r\n    private maxOutboundRequests: number | undefined;\r\n\r\n    private rowRenderer: RowRenderer;\r\n    private rowModel: ServerSideRowModel;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.rowRenderer = beans.rowRenderer;\r\n        this.rowModel = beans.rowModel as ServerSideRowModel;\r\n    }\r\n\r\n    // a map of caches to loading nodes\r\n    private cacheLoadingNodesMap: Map<LazyCache, Set<number>> = new Map();\r\n\r\n    // if a check is queued to happen this cycle\r\n    private isCheckQueued = false;\r\n\r\n    // this is cached for blockLoadDebounce\r\n    private nextBlockToLoad?: { cache: LazyCache; index: number } = undefined;\r\n    private loaderTimeout?: number;\r\n\r\n    public postConstruct() {\r\n        this.maxOutboundRequests = _getMaxConcurrentDatasourceRequests(this.gos);\r\n    }\r\n\r\n    public subscribe(cache: LazyCache) {\r\n        this.cacheLoadingNodesMap.set(cache, new Set());\r\n    }\r\n\r\n    public unsubscribe(cache: LazyCache) {\r\n        this.cacheLoadingNodesMap.delete(cache);\r\n    }\r\n\r\n    /**\r\n     * Queues a microtask to check if any blocks need to be loaded.\r\n     */\r\n    public queueLoadCheck() {\r\n        if (this.isCheckQueued) {\r\n            return;\r\n        }\r\n        this.isCheckQueued = true;\r\n        window.queueMicrotask(() => {\r\n            this.queueLoadAction();\r\n            this.isCheckQueued = false;\r\n        });\r\n    }\r\n\r\n    private onLoadComplete(): void {\r\n        this.outboundRequests -= 1;\r\n        this.queueLoadCheck();\r\n    }\r\n\r\n    private hasAvailableLoadBandwidth() {\r\n        if (this.maxOutboundRequests === undefined) {\r\n            return true;\r\n        }\r\n        return this.outboundRequests < this.maxOutboundRequests;\r\n    }\r\n\r\n    private queueLoadAction() {\r\n        const nextBlockToLoad = this.getBlockToLoad();\r\n        if (!nextBlockToLoad) {\r\n            return;\r\n        }\r\n\r\n        // for blockLoadDebounceMillis, if the next block to load is the same as the last block to load, ignore\r\n        // otherwise cancel existing timeout and requeue\r\n        const isSameBlock =\r\n            this.nextBlockToLoad &&\r\n            this.nextBlockToLoad.cache === nextBlockToLoad.cache &&\r\n            this.nextBlockToLoad.index === nextBlockToLoad.index;\r\n        if (isSameBlock) {\r\n            return;\r\n        }\r\n\r\n        if (!this.nextBlockToLoad || !isSameBlock) {\r\n            this.nextBlockToLoad = nextBlockToLoad;\r\n            window.clearTimeout(this.loaderTimeout);\r\n\r\n            const startRow = Number(this.nextBlockToLoad.index);\r\n            const cache = this.nextBlockToLoad.cache;\r\n            const endRow = nextBlockToLoad.index + nextBlockToLoad.cache.getBlockSize();\r\n            this.loaderTimeout = window.setTimeout(() => {\r\n                if (!cache.isAlive()) {\r\n                    return;\r\n                }\r\n                this.loaderTimeout = undefined;\r\n                this.attemptLoad(cache, startRow, endRow);\r\n                this.nextBlockToLoad = undefined;\r\n            }, this.gos.get('blockLoadDebounceMillis'));\r\n        }\r\n    }\r\n\r\n    private attemptLoad(cache: LazyCache, start: number, end: number) {\r\n        const hasBandwidth = this.hasAvailableLoadBandwidth();\r\n        // too many loads already, ignore the request as a successful request will requeue itself anyway\r\n        if (!hasBandwidth) {\r\n            return;\r\n        }\r\n\r\n        this.executeLoad(cache, start, end);\r\n\r\n        // requeue a load action before waiting for a response, this is to enable\r\n        // more than one block to load simultaneously due to maxConcurrentDatasourceRequests\r\n        this.queueLoadCheck();\r\n    }\r\n\r\n    private executeLoad(cache: LazyCache, startRow: number, endRow: number) {\r\n        const ssrmParams = cache.getSsrmParams();\r\n        const request: IServerSideGetRowsRequest = {\r\n            startRow,\r\n            endRow,\r\n            rowGroupCols: ssrmParams.rowGroupCols,\r\n            valueCols: ssrmParams.valueCols,\r\n            pivotCols: ssrmParams.pivotCols,\r\n            pivotMode: ssrmParams.pivotMode,\r\n            groupKeys: (cache as any).store.getParentNode().getRoute() ?? [],\r\n            filterModel: ssrmParams.filterModel,\r\n            sortModel: ssrmParams.sortModel,\r\n        };\r\n\r\n        const loadingNodes = this.cacheLoadingNodesMap.get(cache)!;\r\n        const removeNodesFromLoadingMap = () => {\r\n            for (let i = 0; i < endRow - startRow; i++) {\r\n                loadingNodes.delete(startRow + i);\r\n            }\r\n        };\r\n\r\n        const addNodesToLoadingMap = () => {\r\n            for (let i = 0; i < endRow - startRow; i++) {\r\n                loadingNodes.add(startRow + i);\r\n            }\r\n        };\r\n\r\n        const success = (params: LoadSuccessParams) => {\r\n            this.onLoadComplete();\r\n            cache.onLoadSuccess(startRow, endRow - startRow, params);\r\n            removeNodesFromLoadingMap();\r\n        };\r\n\r\n        const fail = () => {\r\n            this.onLoadComplete();\r\n            cache.onLoadFailed(startRow, endRow - startRow);\r\n            removeNodesFromLoadingMap();\r\n        };\r\n\r\n        const params: IServerSideGetRowsParams = this.gos.addGridCommonParams({\r\n            request,\r\n            success,\r\n            fail,\r\n            parentNode: (cache as any).store.getParentNode(),\r\n        });\r\n\r\n        addNodesToLoadingMap();\r\n        this.outboundRequests += 1;\r\n        cache.getSsrmParams().datasource?.getRows(params);\r\n    }\r\n\r\n    private getBlockToLoad() {\r\n        const firstRowInViewport = this.rowRenderer.firstRenderedRow;\r\n        const lastRowInViewport = this.rowRenderer.lastRenderedRow;\r\n\r\n        // quick look-up for priority rows needing loading in viewport.\r\n        for (let i = firstRowInViewport; i <= lastRowInViewport; i++) {\r\n            const row = this.rowModel.getRow(i);\r\n            if (!row) {\r\n                continue;\r\n            }\r\n\r\n            const store = row.parent?.childStore as LazyStore | undefined;\r\n            if (!store) {\r\n                continue;\r\n            }\r\n\r\n            const cache: LazyCache = store.getCache();\r\n            const lazyNode = cache.getNodes().getBy('node', row);\r\n            if (!lazyNode) {\r\n                continue;\r\n            }\r\n\r\n            const loadingNodes = this.cacheLoadingNodesMap.get(cache);\r\n            if (loadingNodes?.has(lazyNode.index)) {\r\n                continue;\r\n            }\r\n\r\n            if (row.__needsRefreshWhenVisible || (row.stub && !row.failedLoad)) {\r\n                return {\r\n                    cache: cache,\r\n                    index: cache.getBlockStartIndex(lazyNode.index),\r\n                };\r\n            }\r\n        }\r\n\r\n        let cacheToRefresh: LazyCache | null = null;\r\n        let nodeToRefresh: RowNode | null = null;\r\n        let nodeToRefreshDist: number = Number.MAX_SAFE_INTEGER;\r\n\r\n        for (const cache of this.cacheLoadingNodesMap.keys()) {\r\n            const nodesToRefresh = cache.getNodesToRefresh();\r\n            nodesToRefresh.forEach((node) => {\r\n                if (node.rowIndex == null) {\r\n                    nodeToRefresh = node;\r\n                    cacheToRefresh = cache;\r\n                    return;\r\n                }\r\n\r\n                const lazyNode = cache.getNodes().getBy('node', node);\r\n                if (!lazyNode) {\r\n                    return;\r\n                }\r\n\r\n                const loadingNodes = this.cacheLoadingNodesMap.get(cache);\r\n                if (loadingNodes?.has(lazyNode.index)) {\r\n                    return;\r\n                }\r\n\r\n                const distToViewportTop = Math.abs(firstRowInViewport - node.rowIndex);\r\n                const distToViewportBottom = Math.abs(node.rowIndex - lastRowInViewport);\r\n                if (distToViewportTop < nodeToRefreshDist) {\r\n                    nodeToRefresh = node;\r\n                    nodeToRefreshDist = distToViewportTop;\r\n                    cacheToRefresh = cache;\r\n                }\r\n\r\n                if (distToViewportBottom < nodeToRefreshDist) {\r\n                    nodeToRefresh = node;\r\n                    nodeToRefreshDist = distToViewportBottom;\r\n                    cacheToRefresh = cache;\r\n                }\r\n            });\r\n        }\r\n\r\n        if (!cacheToRefresh) {\r\n            return undefined;\r\n        }\r\n\r\n        const lazyCache = cacheToRefresh as LazyCache;\r\n\r\n        const lazyIndex = lazyCache.getNodes().getBy('node', nodeToRefresh)?.index;\r\n        return lazyIndex == null\r\n            ? undefined\r\n            : {\r\n                  cache: lazyCache,\r\n                  index: lazyCache.getBlockStartIndex(lazyIndex),\r\n              };\r\n    }\r\n\r\n    public isRowLoading(cache: LazyCache, index: number) {\r\n        return this.cacheLoadingNodesMap.get(cache)?.has(index) ?? false;\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    ColumnModel,\r\n    GetServerSideGroupLevelParamsParams,\r\n    IColsService,\r\n    NamedBean,\r\n    RowAutoHeightService,\r\n    RowNode,\r\n    ServerSideGroupLevelParams,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _warn } from 'ag-grid-community';\r\n\r\nimport type { SSRMParams } from '../serverSideRowModel';\r\nimport { LazyStore } from './lazy/lazyStore';\r\n\r\nexport class StoreFactory extends BeanStub implements NamedBean {\r\n    beanName = 'ssrmStoreFactory' as const;\r\n\r\n    private colModel: ColumnModel;\r\n    private rowGroupColsSvc?: IColsService;\r\n    private pivotColsSvc?: IColsService;\r\n    private rowAutoHeight?: RowAutoHeightService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n        this.rowGroupColsSvc = beans.rowGroupColsSvc;\r\n        this.pivotColsSvc = beans.pivotColsSvc;\r\n        this.rowAutoHeight = beans.rowAutoHeight;\r\n    }\r\n\r\n    public createStore(ssrmParams: SSRMParams, parentNode: RowNode): LazyStore {\r\n        const storeParams = this.getStoreParams(ssrmParams, parentNode);\r\n\r\n        return new LazyStore(ssrmParams, storeParams, parentNode);\r\n    }\r\n\r\n    private getStoreParams(ssrmParams: SSRMParams, parentNode: RowNode): ServerSideGroupLevelParams {\r\n        const userStoreParams = this.getLevelSpecificParams(parentNode);\r\n\r\n        // if user provided overrideParams, we take infiniteScroll from there if it exists\r\n        const cacheBlockSize = this.getBlockSize(userStoreParams);\r\n        const maxBlocksInCache = this.getMaxBlocksInCache(ssrmParams, userStoreParams);\r\n\r\n        const storeParams: ServerSideGroupLevelParams = {\r\n            cacheBlockSize,\r\n            maxBlocksInCache,\r\n        };\r\n\r\n        return storeParams;\r\n    }\r\n\r\n    private getMaxBlocksInCache(\r\n        ssrmParams: SSRMParams,\r\n        userStoreParams?: ServerSideGroupLevelParams\r\n    ): number | undefined {\r\n        const maxBlocksInCache =\r\n            userStoreParams && userStoreParams.maxBlocksInCache != null\r\n                ? userStoreParams.maxBlocksInCache\r\n                : this.gos.get('maxBlocksInCache');\r\n\r\n        const maxBlocksActive = maxBlocksInCache != null && maxBlocksInCache >= 0;\r\n\r\n        if (!maxBlocksActive) {\r\n            return;\r\n        }\r\n\r\n        if (ssrmParams.dynamicRowHeight) {\r\n            _warn(203);\r\n            return;\r\n        }\r\n\r\n        if (this.rowAutoHeight?.active) {\r\n            _warn(204);\r\n            return undefined;\r\n        }\r\n\r\n        return maxBlocksInCache;\r\n    }\r\n\r\n    private getBlockSize(userStoreParams?: ServerSideGroupLevelParams): number | undefined {\r\n        const blockSize =\r\n            userStoreParams && userStoreParams.cacheBlockSize != null\r\n                ? userStoreParams.cacheBlockSize\r\n                : this.gos.get('cacheBlockSize');\r\n\r\n        if (blockSize != null && blockSize > 0) {\r\n            return blockSize;\r\n        } else {\r\n            return 100;\r\n        }\r\n    }\r\n\r\n    private getLevelSpecificParams(parentNode: RowNode): ServerSideGroupLevelParams | undefined {\r\n        const callback = this.gos.getCallback('getServerSideGroupLevelParams');\r\n        if (!callback) {\r\n            return undefined;\r\n        }\r\n\r\n        const params: WithoutGridCommon<GetServerSideGroupLevelParamsParams> = {\r\n            level: parentNode.level + 1,\r\n            parentRowNode: parentNode.level >= 0 ? parentNode : undefined,\r\n            rowGroupColumns: this.rowGroupColsSvc?.columns ?? [],\r\n            pivotColumns: this.pivotColsSvc?.columns ?? [],\r\n            pivotMode: this.colModel.isPivotMode(),\r\n        };\r\n\r\n        const res = callback(params);\r\n\r\n        return res;\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    IColsService,\r\n    IRowNode,\r\n    ISelectionService,\r\n    IServerSideStore,\r\n    IsApplyServerSideTransactionParams,\r\n    LoadSuccessParams,\r\n    RowBounds,\r\n    RowNode,\r\n    ServerSideGroupLevelParams,\r\n    ServerSideGroupLevelState,\r\n    ServerSideTransaction,\r\n    ServerSideTransactionResult,\r\n    StoreRefreshAfterParams,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    ServerSideTransactionResultStatus,\r\n    _getGroupTotalRowCallback,\r\n    _getRowHeightAsNumber,\r\n    _getRowIdCallback,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { _createRowNodeFooter, _destroyRowNodeFooter } from '../../../aggregation/footerUtils';\r\nimport type { BlockUtils } from '../../blocks/blockUtils';\r\nimport type { SSRMParams } from '../../serverSideRowModel';\r\nimport type { StoreUtils } from '../storeUtils';\r\nimport { LazyCache } from './lazyCache';\r\n\r\nexport class LazyStore extends BeanStub implements IServerSideStore {\r\n    private blockUtils: BlockUtils;\r\n    private storeUtils: StoreUtils;\r\n    private selectionSvc?: ISelectionService;\r\n    private rowGroupColsSvc?: IColsService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.blockUtils = beans.ssrmBlockUtils as BlockUtils;\r\n        this.storeUtils = beans.ssrmStoreUtils as StoreUtils;\r\n        this.selectionSvc = beans.selectionSvc;\r\n        this.rowGroupColsSvc = beans.rowGroupColsSvc;\r\n    }\r\n\r\n    // display indexes\r\n    private displayIndexStart: number | undefined;\r\n    private displayIndexEnd: number | undefined;\r\n\r\n    // group positioning\r\n    private topPx: number;\r\n    private heightPx: number;\r\n\r\n    // group details\r\n    private readonly level: number;\r\n    private readonly group: boolean;\r\n    private readonly leafGroup: boolean;\r\n    private readonly ssrmParams: SSRMParams;\r\n    private readonly storeParams: ServerSideGroupLevelParams;\r\n    private readonly parentRowNode: RowNode;\r\n    private groupField: string | undefined;\r\n    private rowGroupColumn: AgColumn;\r\n\r\n    private idSequence = { value: 0 };\r\n    private cache: LazyCache;\r\n    private info: any;\r\n\r\n    constructor(ssrmParams: SSRMParams, storeParams: ServerSideGroupLevelParams, parentRowNode: RowNode) {\r\n        super();\r\n        this.ssrmParams = ssrmParams;\r\n        this.parentRowNode = parentRowNode;\r\n        this.storeParams = storeParams;\r\n        this.level = parentRowNode.level + 1;\r\n        this.group = ssrmParams.rowGroupCols ? this.level < ssrmParams.rowGroupCols.length : false;\r\n        this.leafGroup = ssrmParams.rowGroupCols ? this.level === ssrmParams.rowGroupCols.length - 1 : false;\r\n        this.info = {};\r\n    }\r\n\r\n    public postConstruct() {\r\n        let numberOfRows = 1;\r\n        if (this.level === 0) {\r\n            numberOfRows = this.storeUtils.getServerSideInitialRowCount() ?? 1;\r\n\r\n            this.eventSvc.dispatchEventOnce({\r\n                type: 'rowCountReady',\r\n            });\r\n        }\r\n        this.cache = this.createManagedBean(new LazyCache(this, numberOfRows, false, this.storeParams));\r\n\r\n        const usingTreeData = this.gos.get('treeData');\r\n\r\n        if (!usingTreeData && this.group && this.rowGroupColsSvc) {\r\n            const groupColVo = this.ssrmParams.rowGroupCols[this.level];\r\n            this.groupField = groupColVo.field!;\r\n            this.rowGroupColumn = this.rowGroupColsSvc.columns[this.level];\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.displayIndexStart = undefined;\r\n        this.displayIndexEnd = undefined;\r\n        this.destroyBean(this.cache);\r\n        super.destroy();\r\n    }\r\n\r\n    /**\r\n     * Given a server response, ingest the rows outside of the data source lifecycle.\r\n     *\r\n     * @param rowDataParams the server response containing the rows to ingest\r\n     * @param startRow the index to start ingesting rows\r\n     * @param expectedRows the expected number of rows in the response (used to determine if the last row index is known)\r\n     */\r\n    applyRowData(rowDataParams: LoadSuccessParams, startRow: number, expectedRows: number) {\r\n        this.cache.onLoadSuccess(startRow, expectedRows, rowDataParams);\r\n    }\r\n\r\n    /**\r\n     * Applies a given transaction to the data set within this store\r\n     *\r\n     * @param transaction an object containing delta instructions determining the changes to apply to this store\r\n     * @returns an object determining the status of this transaction and effected nodes\r\n     */\r\n    applyTransaction(transaction: ServerSideTransaction): ServerSideTransactionResult {\r\n        const idFunc = _getRowIdCallback(this.gos);\r\n        if (!idFunc) {\r\n            _warn(206);\r\n            return {\r\n                status: ServerSideTransactionResultStatus.Cancelled,\r\n            };\r\n        }\r\n\r\n        const applyCallback = this.gos.getCallback('isApplyServerSideTransaction');\r\n        if (applyCallback) {\r\n            const params: WithoutGridCommon<IsApplyServerSideTransactionParams> = {\r\n                transaction: transaction,\r\n                parentNode: this.parentRowNode,\r\n                groupLevelInfo: this.info,\r\n            };\r\n            const apply = applyCallback(params);\r\n            if (!apply) {\r\n                return { status: ServerSideTransactionResultStatus.Cancelled };\r\n            }\r\n        }\r\n\r\n        // needs checked before transactions are applied, as rows won't be contiguous immediately\r\n        // after\r\n        const allRowsLoaded = this.cache.isStoreFullyLoaded();\r\n\r\n        let updatedNodes: RowNode[] | undefined = undefined;\r\n        if (transaction.update?.length) {\r\n            updatedNodes = this.cache.updateRowNodes(transaction.update);\r\n        }\r\n\r\n        let insertedNodes: RowNode[] | undefined = undefined;\r\n        if (transaction.add?.length) {\r\n            let addIndex = transaction.addIndex;\r\n            if (addIndex != null && addIndex < 0) {\r\n                addIndex = undefined;\r\n            }\r\n            insertedNodes = this.cache.insertRowNodes(transaction.add, addIndex);\r\n        }\r\n\r\n        let removedNodes: RowNode[] | undefined = undefined;\r\n        if (transaction.remove?.length) {\r\n            const allIdsToRemove = transaction.remove.map((data) =>\r\n                idFunc({ level: this.level, parentKeys: this.parentRowNode.getRoute() ?? [], data })\r\n            );\r\n            const allUniqueIdsToRemove = [...new Set(allIdsToRemove)];\r\n            removedNodes = this.cache.removeRowNodes(allUniqueIdsToRemove);\r\n        }\r\n\r\n        const isClientSideSortingEnabled = this.gos.get('serverSideEnableClientSideSort');\r\n\r\n        const isUpdateOrAdd = updatedNodes?.length || insertedNodes?.length;\r\n        const isClientSideSort = allRowsLoaded && isClientSideSortingEnabled;\r\n        if (isClientSideSort && isUpdateOrAdd) {\r\n            // if client side sorting, we need to sort the rows after the transaction\r\n            this.cache.clientSideSortRows();\r\n        }\r\n\r\n        this.updateSelectionAfterTransaction(updatedNodes, removedNodes);\r\n        return {\r\n            status: ServerSideTransactionResultStatus.Applied,\r\n            update: updatedNodes,\r\n            add: insertedNodes,\r\n            remove: removedNodes,\r\n        };\r\n    }\r\n\r\n    private updateSelectionAfterTransaction(updatedNodes?: RowNode[], removedNodes?: RowNode[]) {\r\n        if (!this.selectionSvc) {\r\n            return;\r\n        }\r\n        const nodesToDeselect: RowNode[] = [];\r\n        updatedNodes?.forEach((node) => {\r\n            if (node.isSelected() && !node.selectable) {\r\n                nodesToDeselect.push(node);\r\n            }\r\n        });\r\n\r\n        removedNodes?.forEach((node) => {\r\n            if (node.isSelected()) {\r\n                nodesToDeselect.push(node);\r\n            }\r\n        });\r\n\r\n        if (nodesToDeselect.length) {\r\n            this.selectionSvc.setNodesSelected({\r\n                newValue: false,\r\n                clearSelection: false,\r\n                nodes: nodesToDeselect,\r\n                source: 'rowDataChanged',\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear the display indexes, used for fading rows out when stores are not being destroyed\r\n     */\r\n    clearDisplayIndexes(): void {\r\n        this.displayIndexStart = undefined;\r\n        this.displayIndexEnd = undefined;\r\n        this.cache.getNodes().forEach((lazyNode) => this.blockUtils.clearDisplayIndex(lazyNode.node));\r\n\r\n        if (this.parentRowNode.sibling) {\r\n            this.blockUtils.clearDisplayIndex(this.parentRowNode.sibling);\r\n        }\r\n        this.cache.clearDisplayIndexes();\r\n    }\r\n\r\n    /**\r\n     * @returns an index representing the last sequentially displayed row in the grid for this store\r\n     */\r\n    getDisplayIndexStart(): number | undefined {\r\n        return this.displayIndexStart;\r\n    }\r\n\r\n    /**\r\n     * @returns the index representing one after the last sequentially displayed row in the grid for this store\r\n     */\r\n    getDisplayIndexEnd(): number | undefined {\r\n        return this.displayIndexEnd;\r\n    }\r\n\r\n    /**\r\n     * @returns the virtual size of this store\r\n     */\r\n    getRowCount(): number {\r\n        if (this.parentRowNode.sibling) {\r\n            return this.cache.getRowCount() + 1;\r\n        }\r\n        return this.cache.getRowCount();\r\n    }\r\n\r\n    /**\r\n     * Sets the current row count of the store, and whether the last row index is known\r\n     */\r\n    setRowCount(rowCount: number, isLastRowIndexKnown?: boolean): void {\r\n        this.cache.setRowCount(rowCount, isLastRowIndexKnown);\r\n    }\r\n\r\n    /**\r\n     * Given a display index, returns whether that row is within this store or a child store of this store\r\n     *\r\n     * @param displayIndex the visible index of a row\r\n     * @returns whether or not the row exists within this store\r\n     */\r\n    isDisplayIndexInStore(displayIndex: number): boolean {\r\n        if (this.cache.getRowCount() === 0) return false;\r\n\r\n        return this.displayIndexStart! <= displayIndex && displayIndex < this.getDisplayIndexEnd()!;\r\n    }\r\n\r\n    /**\r\n     * Recursively sets up the display indexes and top position of every node belonging to this store.\r\n     *\r\n     * Called after a row height changes, or a store updated event.\r\n     *\r\n     * @param displayIndexSeq the number sequence for generating the display index of each row\r\n     * @param nextRowTop an object containing the next row top value intended to be modified by ref per row\r\n     */\r\n    setDisplayIndexes(displayIndexSeq: { value: number }, nextRowTop: { value: number }, uiLevel: number): void {\r\n        this.displayIndexStart = displayIndexSeq.value;\r\n        this.topPx = nextRowTop.value;\r\n\r\n        const footerNode =\r\n            this.parentRowNode.level > -1 && _getGroupTotalRowCallback(this.gos)({ node: this.parentRowNode });\r\n        if (!footerNode) {\r\n            _destroyRowNodeFooter(this.parentRowNode);\r\n        }\r\n\r\n        if (footerNode === 'top') {\r\n            _createRowNodeFooter(this.parentRowNode, this.beans);\r\n            this.blockUtils.setDisplayIndex(this.parentRowNode.sibling, displayIndexSeq, nextRowTop, uiLevel);\r\n        }\r\n\r\n        // delegate to the store to set the row display indexes\r\n        this.cache.setDisplayIndexes(displayIndexSeq, nextRowTop, uiLevel);\r\n\r\n        if (footerNode === 'bottom') {\r\n            _createRowNodeFooter(this.parentRowNode, this.beans);\r\n            this.blockUtils.setDisplayIndex(this.parentRowNode.sibling, displayIndexSeq, nextRowTop, uiLevel);\r\n        }\r\n\r\n        this.displayIndexEnd = displayIndexSeq.value;\r\n        this.heightPx = nextRowTop.value - this.topPx;\r\n    }\r\n\r\n    /**\r\n     * Recursively applies a provided function to every node\r\n     *\r\n     * For the purpose of exclusively server side filtered stores, this is the same as getNodes().forEachDeepAfterFilterAndSort\r\n     */\r\n    forEachStoreDeep(callback: (store: LazyStore, index: number) => void, sequence = { value: 0 }): void {\r\n        callback(this, sequence.value++);\r\n        this.cache.getNodes().forEach((lazyNode) => {\r\n            const childCache = lazyNode.node.childStore as LazyStore | undefined;\r\n            if (childCache) {\r\n                childCache.forEachStoreDeep(callback, sequence);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Recursively applies a provided function to every node\r\n     *\r\n     * For the purpose of exclusively server side filtered stores, this is the same as getNodes().forEachDeepAfterFilterAndSort\r\n     */\r\n    forEachNodeDeep(callback: (rowNode: RowNode<any>, index: number) => void, sequence = { value: 0 }): void {\r\n        this.cache.getNodes().forEach((lazyNode) => {\r\n            callback(lazyNode.node, sequence.value++);\r\n            const childCache = lazyNode.node.childStore as LazyStore | undefined;\r\n            if (childCache) {\r\n                childCache.forEachNodeDeep(callback, sequence);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Recursively applies a provided function to every node\r\n     *\r\n     * For the purpose of exclusively server side filtered stores, this is the same as getNodes().forEachDeep\r\n     */\r\n    forEachNodeDeepAfterFilterAndSort(\r\n        callback: (rowNode: RowNode<any>, index: number) => void,\r\n        sequence = { value: 0 },\r\n        includeFooterNodes = false\r\n    ): void {\r\n        const footerNode =\r\n            this.parentRowNode.level > -1 && _getGroupTotalRowCallback(this.gos)({ node: this.parentRowNode });\r\n        if (footerNode === 'top') {\r\n            callback(this.parentRowNode.sibling, sequence.value++);\r\n        }\r\n\r\n        const orderedNodes = this.cache.getOrderedNodeMap();\r\n        for (const lazyNode of Object.values(orderedNodes)) {\r\n            callback(lazyNode.node, sequence.value++);\r\n            const childCache = lazyNode.node.childStore as LazyStore | undefined;\r\n            if (childCache) {\r\n                childCache.forEachNodeDeepAfterFilterAndSort(callback, sequence, includeFooterNodes);\r\n            }\r\n        }\r\n\r\n        if (footerNode === 'bottom') {\r\n            callback(this.parentRowNode.sibling, sequence.value++);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes the failed status from all nodes, and marks them as stub to encourage reloading\r\n     */\r\n    retryLoads(): void {\r\n        this.cache.getNodes().forEach(({ node }) => {\r\n            if (node.failedLoad) {\r\n                node.failedLoad = false;\r\n                node.__needsRefreshWhenVisible = true;\r\n                node.stub = true;\r\n            }\r\n        });\r\n        this.forEachChildStoreShallow((store) => store.retryLoads());\r\n        this.fireStoreUpdatedEvent();\r\n    }\r\n\r\n    /**\r\n     * Given a display index, returns the row at that location.\r\n     *\r\n     * @param displayRowIndex the displayed index within the grid to search for\r\n     * @returns the row node if the display index falls within the store, if it didn't exist this will create a new stub to return\r\n     */\r\n    getRowUsingDisplayIndex(displayRowIndex: number): IRowNode<any> | undefined {\r\n        if (this.parentRowNode.sibling && displayRowIndex === this.parentRowNode.sibling.rowIndex) {\r\n            return this.parentRowNode.sibling;\r\n        }\r\n        return this.cache.getRowByDisplayIndex(displayRowIndex);\r\n    }\r\n\r\n    /**\r\n     * Given a display index, returns the row top and height for the row at that index.\r\n     *\r\n     * @param displayIndex the display index of the node\r\n     * @returns an object containing the rowTop and rowHeight of the node at the given displayIndex\r\n     */\r\n    getRowBounds(displayIndex: number): RowBounds | null {\r\n        if (!this.isDisplayIndexInStore(displayIndex)) {\r\n            return null;\r\n        }\r\n\r\n        const thisNode = this.cache.getNodeCachedByDisplayIndex(displayIndex);\r\n        if (thisNode) {\r\n            const boundsFromRow = this.blockUtils.extractRowBounds(thisNode, displayIndex);\r\n            if (boundsFromRow) {\r\n                return boundsFromRow;\r\n            }\r\n        }\r\n\r\n        const { previousNode, nextNode } = this.cache.getSurroundingNodesByDisplayIndex(displayIndex) ?? {};\r\n\r\n        // previous node may equal, or catch via detail node or child of group\r\n        if (previousNode) {\r\n            const boundsFromRow = this.blockUtils.extractRowBounds(previousNode.node, displayIndex);\r\n            if (boundsFromRow != null) {\r\n                return boundsFromRow;\r\n            }\r\n        }\r\n\r\n        const defaultRowHeight = _getRowHeightAsNumber(this.beans);\r\n        // if node after this, can calculate backwards (and ignore detail/grouping)\r\n        if (nextNode) {\r\n            const numberOfRowDiff = (nextNode.node.rowIndex! - displayIndex) * defaultRowHeight;\r\n            return {\r\n                rowTop: nextNode.node.rowTop! - numberOfRowDiff,\r\n                rowHeight: defaultRowHeight,\r\n            };\r\n        }\r\n\r\n        // otherwise calculate from end of store\r\n        const lastTop = this.topPx + this.heightPx;\r\n        const numberOfRowDiff = (this.getDisplayIndexEnd()! - displayIndex) * defaultRowHeight;\r\n        return {\r\n            rowTop: lastTop - numberOfRowDiff,\r\n            rowHeight: defaultRowHeight,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Given a vertical pixel, determines whether this store contains a row at that pixel\r\n     *\r\n     * @param pixel a vertical pixel position from the grid\r\n     * @returns whether that pixel points to a virtual space belonging to this store\r\n     */\r\n    isPixelInRange(pixel: number): boolean {\r\n        return pixel >= this.topPx && pixel < this.topPx + this.heightPx;\r\n    }\r\n\r\n    /**\r\n     * Given a vertical pixel, returns the row existing at that pixel location\r\n     *\r\n     * @param pixel a vertical pixel position from the grid\r\n     * @returns the display index at the given pixel location\r\n     */\r\n    getRowIndexAtPixel(pixel: number): number | null {\r\n        if (pixel < this.topPx) {\r\n            return this.getDisplayIndexStart()!;\r\n        }\r\n\r\n        if (pixel >= this.topPx + this.heightPx) {\r\n            return this.getDisplayIndexEnd()! - 1;\r\n        }\r\n\r\n        if (\r\n            this.parentRowNode.sibling &&\r\n            pixel > this.parentRowNode.sibling.rowTop! &&\r\n            pixel < this.parentRowNode.sibling.rowTop! + this.parentRowNode.sibling.rowHeight!\r\n        ) {\r\n            return this.parentRowNode.sibling.rowIndex!;\r\n        }\r\n\r\n        let distToPreviousNodeTop: number = Number.MAX_SAFE_INTEGER;\r\n        let previousNode: RowNode | null = null;\r\n        let distToNextNodeTop: number = Number.MAX_SAFE_INTEGER;\r\n        let nextNode: RowNode | null = null;\r\n\r\n        this.cache.getNodes().forEach(({ node }) => {\r\n            const distBetween = Math.abs(pixel - node.rowTop!);\r\n\r\n            // previous node\r\n            if (node.rowTop! < pixel) {\r\n                if (distBetween < distToPreviousNodeTop) {\r\n                    distToPreviousNodeTop = distBetween;\r\n                    previousNode = node;\r\n                }\r\n                return;\r\n            }\r\n            // next node\r\n            if (distBetween < distToNextNodeTop) {\r\n                distToNextNodeTop = distBetween;\r\n                nextNode = node;\r\n            }\r\n        });\r\n\r\n        // cast these back as typescript doesn't understand the forEach above\r\n        previousNode = previousNode as RowNode | null;\r\n        nextNode = nextNode as RowNode | null;\r\n\r\n        // previous node may equal, or catch via detail node or child of group\r\n        if (previousNode) {\r\n            const indexOfRow = this.blockUtils.getIndexAtPixel(previousNode, pixel);\r\n            if (indexOfRow != null) {\r\n                return indexOfRow;\r\n            }\r\n        }\r\n\r\n        const defaultRowHeight = _getRowHeightAsNumber(this.beans);\r\n        // if node after this, can calculate backwards (and ignore detail/grouping)\r\n        if (nextNode) {\r\n            const nextTop = nextNode.rowTop!;\r\n            const numberOfRowDiff = Math.ceil((nextTop - pixel) / defaultRowHeight);\r\n            return nextNode.rowIndex! - numberOfRowDiff;\r\n        }\r\n\r\n        // otherwise calculate from end of store\r\n        const nextTop = this.topPx + this.heightPx;\r\n        const numberOfRowDiff = Math.floor((nextTop - pixel) / defaultRowHeight);\r\n        return this.getDisplayIndexEnd()! - numberOfRowDiff;\r\n    }\r\n\r\n    /**\r\n     * Given a path of group keys, returns the child store for that group.\r\n     *\r\n     * @param keys the grouping path to the desired store\r\n     * @returns the child store for the given keys, or null if not found\r\n     */\r\n    getChildStore(keys: string[]): LazyStore | null {\r\n        return this.storeUtils.getChildStore(keys, this, (key: string) => {\r\n            const lazyNode = this.cache.getNodes().find((lazyNode) => lazyNode.node.key == key);\r\n            if (!lazyNode) {\r\n                return null;\r\n            }\r\n            return lazyNode.node;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Executes a provided callback on each child store belonging to this store\r\n     *\r\n     * @param cb the callback to execute\r\n     */\r\n    private forEachChildStoreShallow(cb: (store: LazyStore) => void) {\r\n        this.cache.getNodes().forEach(({ node }) => {\r\n            if (node.childStore) {\r\n                cb(node.childStore as LazyStore);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Executes after a change to sorting, determines recursively whether this store or a child requires refreshed.\r\n     *\r\n     * If a purge refresh occurs, the row count is preserved.\r\n     *\r\n     * @param params a set of properties pertaining to the sort changes\r\n     */\r\n    refreshAfterSort(params: StoreRefreshAfterParams) {\r\n        const serverSortsAllLevels = this.storeUtils.isServerSideSortAllLevels();\r\n        if (\r\n            serverSortsAllLevels ||\r\n            this.storeUtils.isServerRefreshNeeded(this.parentRowNode, this.ssrmParams.rowGroupCols, params)\r\n        ) {\r\n            const allRowsLoaded = this.cache.isStoreFullyLoaded();\r\n            const isClientSideSortingEnabled = this.gos.get('serverSideEnableClientSideSort');\r\n\r\n            const isClientSideSort = allRowsLoaded && isClientSideSortingEnabled;\r\n            if (!isClientSideSort) {\r\n                // if last row index was known, add a row back for lazy loading.\r\n                const oldCount = this.cache.getRowCount();\r\n                const lastKnown = this.cache.isLastRowIndexKnown();\r\n                this.destroyBean(this.cache);\r\n                this.cache = this.createManagedBean(new LazyCache(this, oldCount, lastKnown, this.storeParams));\r\n                return;\r\n            }\r\n\r\n            // client side sorting only handles one level, so allow it to pass through\r\n            // to recursive sort.\r\n            this.cache.clientSideSortRows();\r\n        }\r\n\r\n        // call refreshAfterSort on children, as we did not purge.\r\n        // if we did purge, no need to do this as all children were destroyed\r\n        this.forEachChildStoreShallow((store) => store.refreshAfterSort(params));\r\n    }\r\n\r\n    /**\r\n     * Executes after a change to filtering, determines recursively whether this store or a child requires refreshed.\r\n     *\r\n     * If a refresh occurs, the row count is reset.\r\n     *\r\n     * @param params a set of properties pertaining to the filter changes\r\n     */\r\n    refreshAfterFilter(params: StoreRefreshAfterParams) {\r\n        const serverFiltersAllLevels = !this.storeUtils.isServerSideOnlyRefreshFilteredGroups();\r\n        if (\r\n            serverFiltersAllLevels ||\r\n            this.storeUtils.isServerRefreshNeeded(this.parentRowNode, this.ssrmParams.rowGroupCols, params)\r\n        ) {\r\n            this.refreshStore(true);\r\n            return;\r\n        }\r\n\r\n        // call refreshAfterFilter on children, as we did not purge.\r\n        // if we did purge, no need to do this as all children were destroyed\r\n        this.forEachChildStoreShallow((store) => store.refreshAfterFilter(params));\r\n    }\r\n\r\n    /**\r\n     * Marks all existing nodes as requiring reloaded, and triggers a load check\r\n     *\r\n     * @param purge whether to remove all nodes and data in favour of stub nodes\r\n     */\r\n    refreshStore(purge: boolean) {\r\n        if (purge) {\r\n            this.destroyBean(this.cache);\r\n            this.cache = this.createManagedBean(new LazyCache(this, 1, false, this.storeParams));\r\n            this.fireStoreUpdatedEvent();\r\n            return;\r\n        }\r\n\r\n        this.cache.markNodesForRefresh();\r\n    }\r\n\r\n    /**\r\n     * Used for pagination, given a local/store index, returns the display index of that row\r\n     *\r\n     * @param topLevelIndex the store index of a row\r\n     * @returns the display index for the given store index\r\n     */\r\n    getTopLevelRowDisplayedIndex(topLevelIndex: number): number {\r\n        const displayIndex = this.cache.getDisplayIndexFromStoreIndex(topLevelIndex);\r\n        return displayIndex ?? topLevelIndex;\r\n    }\r\n\r\n    /**\r\n     * Used for pagination to determine if the last page is known, and for aria to determine if the last grid row is known\r\n     *\r\n     * @returns whether the last index of this store is known, or if lazy loading still required\r\n     */\r\n    isLastRowIndexKnown(): boolean {\r\n        return this.cache.isLastRowIndexKnown();\r\n    }\r\n\r\n    /**\r\n     * Used by the selection service to select a range of nodes\r\n     *\r\n     * @param firstInRange the first node in the range to find\r\n     * @param lastInRange the last node in the range to find\r\n     * @returns a range of nodes between firstInRange and lastInRange inclusive\r\n     */\r\n    getRowNodesInRange(firstInRange: RowNode<any>, lastInRange: RowNode<any>): RowNode<any>[] {\r\n        return this.cache\r\n            .getNodes()\r\n            .filter(({ node }) => {\r\n                return node.rowIndex! >= firstInRange.rowIndex! && node.rowIndex! <= lastInRange.rowIndex!;\r\n            })\r\n            .map(({ node }) => node);\r\n    }\r\n\r\n    /**\r\n     * Mutates a given array to add this stores state, and recursively add all the children store states.\r\n     *\r\n     * @param result a mutable results array\r\n     */\r\n    addStoreStates(result: ServerSideGroupLevelState[]) {\r\n        result.push({\r\n            route: this.parentRowNode.getRoute() ?? [],\r\n            rowCount: this.getRowCount(),\r\n            lastRowIndexKnown: this.isLastRowIndexKnown(),\r\n            info: this.info,\r\n            maxBlocksInCache: this.storeParams.maxBlocksInCache,\r\n            cacheBlockSize: this.storeParams.cacheBlockSize,\r\n        });\r\n        this.forEachChildStoreShallow((childStore) => childStore.addStoreStates(result));\r\n    }\r\n\r\n    public getIdSequence(): { value: number } {\r\n        return this.idSequence;\r\n    }\r\n\r\n    public getParentNode() {\r\n        return this.parentRowNode;\r\n    }\r\n\r\n    public getRowDetails() {\r\n        return {\r\n            field: this.groupField!,\r\n            group: this.group,\r\n            leafGroup: this.leafGroup,\r\n            level: this.level,\r\n            parent: this.parentRowNode,\r\n            rowGroupColumn: this.rowGroupColumn,\r\n        };\r\n    }\r\n\r\n    public getSsrmParams() {\r\n        return this.ssrmParams;\r\n    }\r\n\r\n    public setStoreInfo(info: any) {\r\n        if (info) {\r\n            Object.assign(this.info, info);\r\n        }\r\n    }\r\n\r\n    // gets called 1) row count changed 2) cache purged\r\n    public fireStoreUpdatedEvent(): void {\r\n        // this results in row model firing ModelUpdated.\r\n        // server side row model also updates the row indexes first\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'storeUpdated',\r\n        });\r\n    }\r\n\r\n    // gets called when row data updated, and no more refreshing needed\r\n    public fireRefreshFinishedEvent(): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'storeRefreshed',\r\n            route: this.parentRowNode.getRoute(),\r\n        });\r\n    }\r\n\r\n    public getBlockStates() {\r\n        return this.cache.getBlockStates();\r\n    }\r\n\r\n    public getStoreBounds() {\r\n        return {\r\n            topPx: this.topPx,\r\n            heightPx: this.heightPx,\r\n        };\r\n    }\r\n\r\n    public getCache() {\r\n        return this.cache;\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    ColumnModel,\r\n    FocusService,\r\n    GetRowIdParams,\r\n    IRowNode,\r\n    LoadSuccessParams,\r\n    RowNode,\r\n    RowNodeSorter,\r\n    RowRenderer,\r\n    ServerSideGroupLevelParams,\r\n    SortService,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _getRowHeightAsNumber, _getRowIdCallback, _warn } from 'ag-grid-community';\r\n\r\nimport { setRowNodeGroupValue } from '../../../rowGrouping/rowGroupingUtils';\r\nimport type { BlockUtils } from '../../blocks/blockUtils';\r\nimport type { NodeManager } from '../../nodeManager';\r\nimport type { ServerSideRowModel } from '../../serverSideRowModel';\r\nimport type { LazyBlockLoadingService } from './lazyBlockLoadingService';\r\nimport type { LazyStore } from './lazyStore';\r\nimport { MultiIndexMap } from './multiIndexMap';\r\n\r\ninterface LazyStoreNode {\r\n    id: string;\r\n    index: number;\r\n    node: RowNode;\r\n}\r\n\r\nconst DEFAULT_BLOCK_SIZE = 100 as const;\r\n\r\nexport class LazyCache extends BeanStub {\r\n    private rowRenderer: RowRenderer;\r\n    private blockUtils: BlockUtils;\r\n    private focusSvc: FocusService;\r\n    private nodeManager: NodeManager;\r\n    private serverSideRowModel: ServerSideRowModel;\r\n    private rowNodeSorter?: RowNodeSorter;\r\n    private sortSvc?: SortService;\r\n    private lazyBlockLoadingSvc: LazyBlockLoadingService;\r\n    private colModel: ColumnModel;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.rowRenderer = beans.rowRenderer;\r\n        this.blockUtils = beans.ssrmBlockUtils as BlockUtils;\r\n        this.focusSvc = beans.focusSvc;\r\n        this.nodeManager = beans.ssrmNodeManager as NodeManager;\r\n        this.serverSideRowModel = beans.rowModel as ServerSideRowModel;\r\n        this.rowNodeSorter = beans.rowNodeSorter;\r\n        this.sortSvc = beans.sortSvc;\r\n        this.lazyBlockLoadingSvc = beans.lazyBlockLoadingSvc as LazyBlockLoadingService;\r\n        this.colModel = beans.colModel;\r\n    }\r\n\r\n    /**\r\n     * Indicates whether this is still the live dataset for this store (used for ignoring old requests after purge)\r\n     */\r\n    private live = true;\r\n\r\n    /**\r\n     * A node map indexed by the node's id, index, and node.\r\n     */\r\n    private nodeMap: MultiIndexMap<LazyStoreNode, 'index' | 'id' | 'node'>;\r\n\r\n    /**\r\n     * A map of nodes indexed by the display index.\r\n     */\r\n    private nodeDisplayIndexMap: Map<number, RowNode>;\r\n\r\n    /**\r\n     * A set of nodes waiting to be refreshed\r\n     */\r\n    private nodesToRefresh: Set<RowNode>;\r\n\r\n    /**\r\n     * End of store properties\r\n     */\r\n    private numberOfRows: number;\r\n    private isLastRowKnown: boolean;\r\n\r\n    /**\r\n     * The prefix to use for node ids, this is used to ensure that node ids are unique across stores\r\n     */\r\n    private defaultNodeIdPrefix: string | undefined;\r\n\r\n    /**\r\n     * Sibling services - 1-1 relationships.\r\n     */\r\n    private store: LazyStore;\r\n    private storeParams: ServerSideGroupLevelParams;\r\n\r\n    /**\r\n     * Grid options properties - stored locally for access speed.\r\n     */\r\n    private getRowIdFunc?: (params: WithoutGridCommon<GetRowIdParams>) => string;\r\n    private isMasterDetail: boolean;\r\n\r\n    /**\r\n     * A cache of removed group nodes, this is retained for preserving group\r\n     * state when the node moves in and out of the cache. Generally caused by\r\n     * rows moving blocks.\r\n     */\r\n    private removedNodeCache = new Map<string, RowNode>();\r\n\r\n    constructor(\r\n        store: LazyStore,\r\n        numberOfRows: number,\r\n        isLastRowKnown: boolean,\r\n        storeParams: ServerSideGroupLevelParams\r\n    ) {\r\n        super();\r\n        this.store = store;\r\n        this.numberOfRows = numberOfRows;\r\n        this.isLastRowKnown = isLastRowKnown;\r\n        this.storeParams = storeParams;\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.lazyBlockLoadingSvc.subscribe(this);\r\n        // initiate the node map to be indexed at 'index', 'id' and 'node' for quick look-up.\r\n        // it's important id isn't first, as stub nodes overwrite each-other, and the first index is\r\n        // used for iteration.\r\n        this.nodeMap = new MultiIndexMap('index', 'id', 'node');\r\n\r\n        this.nodeDisplayIndexMap = new Map();\r\n        this.nodesToRefresh = new Set();\r\n\r\n        this.defaultNodeIdPrefix = this.blockUtils.createNodeIdPrefix(this.store.getParentNode());\r\n        this.getRowIdFunc = _getRowIdCallback(this.gos);\r\n        this.isMasterDetail = this.gos.get('masterDetail');\r\n    }\r\n\r\n    public override destroy() {\r\n        this.lazyBlockLoadingSvc.unsubscribe(this);\r\n        this.numberOfRows = 0;\r\n        this.nodeMap.forEach((node) => this.blockUtils.destroyRowNode(node.node));\r\n        this.nodeMap.clear();\r\n        this.nodeDisplayIndexMap.clear();\r\n        this.nodesToRefresh.clear();\r\n        this.live = false;\r\n        super.destroy();\r\n    }\r\n\r\n    /**\r\n     * Get the row node for a specific display index from this store\r\n     * @param displayIndex the display index of the node to find\r\n     * @returns undefined if the node is not in the store bounds, otherwise will always return a node\r\n     */\r\n    public getRowByDisplayIndex(displayIndex: number): IRowNode | undefined {\r\n        // if index isn't in store, nothing to return\r\n        if (!this.store.isDisplayIndexInStore(displayIndex)) {\r\n            return undefined;\r\n        }\r\n\r\n        // first try to directly look this node up in the display index map\r\n        const node = this.nodeDisplayIndexMap.get(displayIndex);\r\n        if (node) {\r\n            // if we have the node, check if it needs refreshed when rendered\r\n            if (node.stub || node.__needsRefreshWhenVisible) {\r\n                this.lazyBlockLoadingSvc.queueLoadCheck();\r\n            }\r\n            return node;\r\n        }\r\n\r\n        const hideOpenGroups = this.gos.get('groupHideOpenParents') || this.gos.get('groupAllowUnbalanced');\r\n        if (hideOpenGroups) {\r\n            // if hiding open groups, the first node in this expanded store may not be\r\n            // the first displayed node, as it could be hidden, so need to DFS first.\r\n            const nextParent = this.nodeMap.find(\r\n                (lazyNode) => !!(lazyNode.node.childStore as LazyStore | undefined)?.isDisplayIndexInStore(displayIndex)\r\n            );\r\n            // if belongs to child store, search that first\r\n            if (nextParent) {\r\n                return (nextParent.node.childStore as LazyStore | undefined)?.getRowUsingDisplayIndex(displayIndex);\r\n            }\r\n        }\r\n\r\n        // next check if this is the first row, if so return a stub node\r\n        // this is a performance optimisation, as it is the most common scenario\r\n        // and enables the node - 1 check to kick in more often.\r\n        if (displayIndex === this.store.getDisplayIndexStart()) {\r\n            return this.createStubNode(0, displayIndex);\r\n        }\r\n\r\n        // check if the row immediately prior is available in the store\r\n        const contiguouslyPreviousNode = this.nodeDisplayIndexMap.get(displayIndex - 1);\r\n        if (contiguouslyPreviousNode) {\r\n            // if previous row is master detail, and expanded, this node must be detail\r\n            if (this.isMasterDetail && contiguouslyPreviousNode.master && contiguouslyPreviousNode.expanded) {\r\n                return contiguouslyPreviousNode.detailNode;\r\n            }\r\n\r\n            // if previous row is expanded group, this node will belong to that group.\r\n            if (\r\n                contiguouslyPreviousNode.expanded &&\r\n                (contiguouslyPreviousNode.childStore as LazyStore | undefined)?.isDisplayIndexInStore(displayIndex)\r\n            ) {\r\n                return (contiguouslyPreviousNode.childStore as LazyStore | undefined)?.getRowUsingDisplayIndex(\r\n                    displayIndex\r\n                );\r\n            }\r\n\r\n            // otherwise, row must be a stub node\r\n            const lazyCacheNode = this.nodeMap.getBy('node', contiguouslyPreviousNode)!;\r\n            return this.createStubNode(lazyCacheNode.index + 1, displayIndex);\r\n        }\r\n\r\n        const adjacentNodes = this.getSurroundingNodesByDisplayIndex(displayIndex);\r\n\r\n        // if no bounds skipped includes this, calculate from end index\r\n        if (adjacentNodes == null) {\r\n            const storeIndexFromEndIndex = this.store.getRowCount() - (this.store.getDisplayIndexEnd()! - displayIndex);\r\n            return this.createStubNode(storeIndexFromEndIndex, displayIndex);\r\n        }\r\n\r\n        const { previousNode, nextNode } = adjacentNodes;\r\n\r\n        // if the node before this node is expanded, this node might be a child of that node\r\n        if (\r\n            previousNode &&\r\n            previousNode.node.expanded &&\r\n            (previousNode.node.childStore as LazyStore | undefined)?.isDisplayIndexInStore(displayIndex)\r\n        ) {\r\n            return (previousNode.node.childStore as LazyStore | undefined)?.getRowUsingDisplayIndex(displayIndex);\r\n        }\r\n\r\n        // if we have the node after this node, we can calculate the store index of this node by the difference\r\n        // in display indexes between the two nodes.\r\n        if (nextNode) {\r\n            const displayIndexDiff = nextNode.node.rowIndex! - displayIndex;\r\n            const newStoreIndex = nextNode.index - displayIndexDiff;\r\n            return this.createStubNode(newStoreIndex, displayIndex);\r\n        }\r\n\r\n        // if no next node, calculate from end index of this store\r\n        const storeIndexFromEndIndex = this.store.getRowCount() - (this.store.getDisplayIndexEnd()! - displayIndex);\r\n        return this.createStubNode(storeIndexFromEndIndex, displayIndex);\r\n    }\r\n\r\n    /**\r\n     * Used for creating and positioning a stub node without firing a store updated event\r\n     */\r\n    private createStubNode(storeIndex: number, displayIndex: number): RowNode {\r\n        // bounds are acquired before creating the node, as otherwise it'll use it's own empty self to calculate\r\n        const rowBounds = this.store.getRowBounds(displayIndex!);\r\n        const newNode = this.createRowAtIndex(storeIndex, null, (node) => {\r\n            node.setRowIndex(displayIndex);\r\n            node.setRowTop(rowBounds!.rowTop);\r\n            this.nodeDisplayIndexMap.set(displayIndex, node);\r\n        });\r\n        // if group hide open parents we need to populate with the parent group data for the first stub node\r\n        if (storeIndex === 0 && this.gos.get('groupHideOpenParents')) {\r\n            const parentGroupData = this.store.getParentNode().groupData;\r\n            if (parentGroupData) {\r\n                for (const key of Object.keys(parentGroupData)) {\r\n                    setRowNodeGroupValue(newNode, this.colModel, key, parentGroupData[key]);\r\n                }\r\n            }\r\n        }\r\n        this.lazyBlockLoadingSvc.queueLoadCheck();\r\n        return newNode;\r\n    }\r\n\r\n    /**\r\n     * @param index The row index relative to this store\r\n     * @returns A rowNode at the given store index\r\n     */\r\n    public getRowByStoreIndex(index: number) {\r\n        return this.nodeMap.getBy('index', index)?.node;\r\n    }\r\n\r\n    /**\r\n     * Given a number of rows, skips through the given sequence & row top reference (using default row height)\r\n     * @param numberOfRowsToSkip number of rows to skip over in the given sequence\r\n     * @param displayIndexSeq the sequence in which to skip\r\n     * @param nextRowTop the row top reference in which to skip\r\n     */\r\n    private skipDisplayIndexes(\r\n        numberOfRowsToSkip: number,\r\n        displayIndexSeq: { value: number },\r\n        nextRowTop: { value: number }\r\n    ) {\r\n        if (numberOfRowsToSkip === 0) {\r\n            return;\r\n        }\r\n        const defaultRowHeight = _getRowHeightAsNumber(this.beans);\r\n\r\n        displayIndexSeq.value += numberOfRowsToSkip;\r\n        nextRowTop.value += numberOfRowsToSkip * defaultRowHeight;\r\n    }\r\n\r\n    /**\r\n     * @param displayIndexSeq the number sequence for generating the display index of each row\r\n     * @param nextRowTop an object containing the next row top value intended to be modified by ref per row\r\n     */\r\n    public setDisplayIndexes(displayIndexSeq: { value: number }, nextRowTop: { value: number }, uiLevel: number): void {\r\n        // Create a map of display index nodes for access speed\r\n        this.nodeDisplayIndexMap.clear();\r\n\r\n        // create an object indexed by store index, as this will sort all of the nodes when we iterate\r\n        // the object\r\n        const orderedMap: { [key: number]: RowNode } = {};\r\n        this.nodeMap.forEach((lazyNode) => {\r\n            orderedMap[lazyNode.index] = lazyNode.node;\r\n        });\r\n\r\n        let lastIndex = -1;\r\n        // iterate over the nodes in order, setting the display index on each node.\r\n        for (const stringIndex of Object.keys(orderedMap)) {\r\n            const node = orderedMap[stringIndex as any];\r\n            const numericIndex = Number(stringIndex);\r\n\r\n            // if any nodes aren't currently in the store, skip the display indexes too\r\n            const numberOfRowsToSkip = numericIndex - 1 - lastIndex;\r\n            this.skipDisplayIndexes(numberOfRowsToSkip, displayIndexSeq, nextRowTop);\r\n\r\n            const isFirstChild = numericIndex === 0;\r\n            node.setFirstChild(isFirstChild);\r\n            // if hiding open parents, then the first node should inherit the group values\r\n            if (isFirstChild && this.gos.get('groupHideOpenParents')) {\r\n                const parentGroupData = this.store.getParentNode().groupData;\r\n                if (parentGroupData) {\r\n                    for (const key of Object.keys(parentGroupData)) {\r\n                        setRowNodeGroupValue(node, this.colModel, key, isFirstChild ? parentGroupData[key] : undefined);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set this nodes index and row top\r\n            this.blockUtils.setDisplayIndex(node, displayIndexSeq, nextRowTop, uiLevel);\r\n            if (node.rowIndex != null) {\r\n                this.nodeDisplayIndexMap.set(node.rowIndex, node);\r\n            }\r\n\r\n            // store this index for skipping after this\r\n            lastIndex = numericIndex;\r\n        }\r\n\r\n        // need to skip rows until the end of this store\r\n        const numberOfRowsToSkip = this.numberOfRows - 1 - lastIndex;\r\n        this.skipDisplayIndexes(numberOfRowsToSkip, displayIndexSeq, nextRowTop);\r\n\r\n        // this is not terribly efficient, and could probs be improved\r\n        this.purgeExcessRows();\r\n    }\r\n\r\n    public getRowCount(): number {\r\n        return this.numberOfRows;\r\n    }\r\n\r\n    setRowCount(rowCount: number, isLastRowIndexKnown?: boolean): void {\r\n        this.numberOfRows = rowCount;\r\n\r\n        if (isLastRowIndexKnown != null) {\r\n            this.isLastRowKnown = isLastRowIndexKnown;\r\n\r\n            if (isLastRowIndexKnown === false) {\r\n                this.numberOfRows += 1;\r\n            }\r\n        }\r\n\r\n        this.fireStoreUpdatedEvent();\r\n    }\r\n\r\n    public getNodes() {\r\n        return this.nodeMap;\r\n    }\r\n\r\n    public getNodeCachedByDisplayIndex(displayIndex: number): RowNode | null {\r\n        return this.nodeDisplayIndexMap.get(displayIndex) ?? null;\r\n    }\r\n\r\n    public getNodesToRefresh(): Set<RowNode> {\r\n        return this.nodesToRefresh;\r\n    }\r\n\r\n    /**\r\n     * @returns the previous and next loaded row nodes surrounding the given display index\r\n     */\r\n    public getSurroundingNodesByDisplayIndex(displayIndex: number) {\r\n        let nextNode: LazyStoreNode | undefined;\r\n        let previousNode: LazyStoreNode | undefined;\r\n        this.nodeMap.forEach((lazyNode) => {\r\n            // previous node\r\n            if (displayIndex > lazyNode.node.rowIndex!) {\r\n                // get the largest previous node\r\n                if (previousNode == null || previousNode.node.rowIndex! < lazyNode.node.rowIndex!) {\r\n                    previousNode = lazyNode;\r\n                }\r\n                return;\r\n            }\r\n            // next node\r\n            // get the smallest next node\r\n            if (nextNode == null || nextNode.node.rowIndex! > lazyNode.node.rowIndex!) {\r\n                nextNode = lazyNode;\r\n                return;\r\n            }\r\n        });\r\n        if (!previousNode && !nextNode) return null;\r\n        return { previousNode, nextNode };\r\n    }\r\n\r\n    /**\r\n     * Get or calculate the display index for a given store index\r\n     * @param storeIndex the rows index within this store\r\n     * @returns the rows visible display index relative to the grid\r\n     */\r\n    public getDisplayIndexFromStoreIndex(storeIndex: number): number | null {\r\n        const nodeAtIndex = this.nodeMap.getBy('index', storeIndex);\r\n        if (nodeAtIndex) {\r\n            return nodeAtIndex.node.rowIndex!;\r\n        }\r\n\r\n        let nextNode: LazyStoreNode | undefined;\r\n        let previousNode: LazyStoreNode | undefined;\r\n        this.nodeMap.forEach((lazyNode) => {\r\n            // previous node\r\n            if (storeIndex > lazyNode.index) {\r\n                // get the largest previous node\r\n                if (previousNode == null || previousNode.index < lazyNode.index) {\r\n                    previousNode = lazyNode;\r\n                }\r\n                return;\r\n            }\r\n            // next node\r\n            // get the smallest next node\r\n            if (nextNode == null || nextNode.index > lazyNode.index) {\r\n                nextNode = lazyNode;\r\n                return;\r\n            }\r\n        });\r\n\r\n        if (!nextNode) {\r\n            return this.store.getDisplayIndexEnd()! - (this.numberOfRows - storeIndex);\r\n        }\r\n\r\n        if (!previousNode) {\r\n            return this.store.getDisplayIndexStart()! + storeIndex;\r\n        }\r\n\r\n        const storeIndexDiff = storeIndex - previousNode.index;\r\n        const previousDisplayIndex =\r\n            (previousNode.node.childStore as LazyStore | undefined)?.getDisplayIndexEnd() ??\r\n            previousNode.node.rowIndex!;\r\n        return previousDisplayIndex + storeIndexDiff;\r\n    }\r\n\r\n    /**\r\n     * Creates a new row and inserts it at the given index\r\n     * @param atStoreIndex the node index relative to this store\r\n     * @param data the data object to populate the node with\r\n     * @returns the new row node\r\n     */\r\n    private createRowAtIndex(atStoreIndex: number, data?: any, createNodeCallback?: (node: RowNode) => void): RowNode {\r\n        // make sure an existing node isn't being overwritten\r\n        const lazyNode = this.nodeMap.getBy('index', atStoreIndex);\r\n\r\n        // if node already exists, update it or destroy it\r\n        if (lazyNode) {\r\n            const { node } = lazyNode;\r\n            node.__needsRefreshWhenVisible = false;\r\n\r\n            // if the node is the same, just update the content\r\n            if (this.doesNodeMatch(data, node)) {\r\n                this.blockUtils.updateDataIntoRowNode(node, data);\r\n                this.nodesToRefresh.delete(node);\r\n                return node;\r\n            }\r\n\r\n            // if there's no id and this is an open group, protect this node from changes\r\n            // hasChildren also checks for tree data and master detail\r\n            if (this.getRowIdFunc == null && node.hasChildren() && node.expanded) {\r\n                this.nodesToRefresh.delete(node);\r\n                return node;\r\n            }\r\n\r\n            // destroy the old node, might be worth caching state here\r\n            this.destroyRowAtIndex(atStoreIndex);\r\n        }\r\n\r\n        // if the node already exists elsewhere, update it and move it to the new location\r\n        if (data && this.getRowIdFunc != null) {\r\n            const id = this.getRowId(data);\r\n\r\n            // the node was deleted at some point, but as we're refreshing\r\n            // it's been cached and we can retrieve it for reuse.\r\n            const deletedNode = id && this.removedNodeCache?.get(id);\r\n            if (deletedNode) {\r\n                this.removedNodeCache?.delete(id!);\r\n                this.blockUtils.updateDataIntoRowNode(deletedNode, data);\r\n                this.nodeMap.set({\r\n                    id: deletedNode.id!,\r\n                    node: deletedNode,\r\n                    index: atStoreIndex,\r\n                });\r\n                this.nodesToRefresh.delete(deletedNode);\r\n                deletedNode.__needsRefreshWhenVisible = false;\r\n                return deletedNode;\r\n            }\r\n\r\n            const lazyNode = this.nodeMap.getBy('id', id);\r\n            if (lazyNode) {\r\n                // delete old lazy node so we can insert it at different location\r\n                this.nodeMap.delete(lazyNode);\r\n\r\n                const { node, index } = lazyNode;\r\n                this.blockUtils.updateDataIntoRowNode(node, data);\r\n                this.nodeMap.set({\r\n                    id: node.id!,\r\n                    node,\r\n                    index: atStoreIndex,\r\n                });\r\n                this.nodesToRefresh.delete(node);\r\n                node.__needsRefreshWhenVisible = false;\r\n\r\n                if (this.getBlockStartIndex(index) === this.getBlockStartIndex(atStoreIndex)) {\r\n                    // if the block hasn't changed and we have a nodes map, we don't need to refresh the original block, as this block\r\n                    // has just been refreshed.\r\n                    return node;\r\n                }\r\n\r\n                // mark all of the old block as needsVerify to trigger it for a refresh, as nodes\r\n                // should not be out of place\r\n                this.markBlockForVerify(index);\r\n\r\n                return node;\r\n            }\r\n        }\r\n\r\n        // node doesn't exist, create a new one\r\n        const newNode = this.blockUtils.createRowNode(this.store.getRowDetails());\r\n        if (data != null) {\r\n            const defaultId = this.getPrefixedId(this.store.getIdSequence().value++);\r\n            this.blockUtils.setDataIntoRowNode(newNode, data, defaultId, undefined);\r\n\r\n            // don't allow the SSRM to listen to the dispatched row event, as it will\r\n            // compute extra unnecessary row updates\r\n            this.serverSideRowModel.setPaused(true);\r\n            this.blockUtils.checkOpenByDefault(newNode);\r\n            this.serverSideRowModel.setPaused(false);\r\n            this.nodeManager.addRowNode(newNode);\r\n        }\r\n\r\n        // add the new node to the store, has to be done after the display index is calculated so it doesn't take itself into account\r\n        this.nodeMap.set({\r\n            id: newNode.id!,\r\n            node: newNode,\r\n            index: atStoreIndex,\r\n        });\r\n\r\n        if (createNodeCallback) {\r\n            createNodeCallback(newNode);\r\n        }\r\n\r\n        return newNode;\r\n    }\r\n\r\n    public getBlockStates() {\r\n        const blockCounts: { [key: string]: number } = {};\r\n        const blockStates: { [key: string]: Set<string> } = {};\r\n\r\n        this.nodeMap.forEach(({ node, index }) => {\r\n            const blockStart = this.getBlockStartIndex(index);\r\n\r\n            if (!node.stub && !node.failedLoad) {\r\n                blockCounts[blockStart] = (blockCounts[blockStart] ?? 0) + 1;\r\n            }\r\n\r\n            let rowState = 'loaded';\r\n            if (node.failedLoad) {\r\n                rowState = 'failed';\r\n            } else if (this.lazyBlockLoadingSvc.isRowLoading(this, blockStart)) {\r\n                rowState = 'loading';\r\n            } else if (this.nodesToRefresh.has(node) || node.stub) {\r\n                rowState = 'needsLoading';\r\n            }\r\n\r\n            if (!blockStates[blockStart]) {\r\n                blockStates[blockStart] = new Set<string>();\r\n            }\r\n            blockStates[blockStart].add(rowState);\r\n        });\r\n\r\n        const statePriorityMap: { [key: string]: number } = {\r\n            loading: 4,\r\n            failed: 3,\r\n            needsLoading: 2,\r\n            loaded: 1,\r\n        };\r\n\r\n        const blockPrefix = this.blockUtils.createNodeIdPrefix(this.store.getParentNode());\r\n\r\n        const results: { [key: string]: any } = {};\r\n        Object.entries(blockStates).forEach(([blockStart, uniqueStates]) => {\r\n            const sortedStates = [...uniqueStates].sort(\r\n                (a, b) => (statePriorityMap[a] ?? 0) - (statePriorityMap[b] ?? 0)\r\n            );\r\n            const priorityState = sortedStates[0];\r\n\r\n            const blockNumber = Number(blockStart) / this.getBlockSize();\r\n\r\n            const blockId = blockPrefix ? `${blockPrefix}-${blockNumber}` : String(blockNumber);\r\n            results[blockId] = {\r\n                blockNumber,\r\n                startRow: Number(blockStart),\r\n                endRow: Number(blockStart) + this.getBlockSize(),\r\n                pageStatus: priorityState,\r\n                loadedRowCount: blockCounts[blockStart] ?? 0,\r\n            };\r\n        });\r\n        return results;\r\n    }\r\n\r\n    public destroyRowAtIndex(atStoreIndex: number) {\r\n        const lazyNode = this.nodeMap.getBy('index', atStoreIndex);\r\n        if (!lazyNode) {\r\n            return;\r\n        }\r\n\r\n        this.nodeMap.delete(lazyNode);\r\n\r\n        this.nodeDisplayIndexMap.delete(lazyNode.node.rowIndex!);\r\n\r\n        if (this.nodesToRefresh.size > 0) {\r\n            // while refreshing, we retain the group nodes so they can be moved\r\n            // without losing state\r\n            this.removedNodeCache.set(lazyNode.node.id!, lazyNode.node);\r\n        } else {\r\n            this.blockUtils.destroyRowNode(lazyNode.node);\r\n        }\r\n\r\n        this.nodesToRefresh.delete(lazyNode.node);\r\n    }\r\n\r\n    public getSsrmParams() {\r\n        return this.store.getSsrmParams();\r\n    }\r\n\r\n    /**\r\n     * @param id the base id to be prefixed\r\n     * @returns a node id with prefix if required\r\n     */\r\n    private getPrefixedId(id: number): string {\r\n        if (this.defaultNodeIdPrefix) {\r\n            return this.defaultNodeIdPrefix + '-' + id;\r\n        } else {\r\n            return id.toString();\r\n        }\r\n    }\r\n\r\n    private markBlockForVerify(rowIndex: number) {\r\n        const [start, end] = this.getBlockBounds(rowIndex);\r\n        const lazyNodesInRange = this.nodeMap.filter((lazyNode) => lazyNode.index >= start && lazyNode.index < end);\r\n        lazyNodesInRange.forEach(({ node }) => {\r\n            node.__needsRefreshWhenVisible = true;\r\n        });\r\n    }\r\n\r\n    private doesNodeMatch(data: any, node: RowNode): boolean {\r\n        if (node.stub) {\r\n            return false;\r\n        }\r\n        const id = this.getRowId(data);\r\n        return id === null ? node.data === data : node.id === id;\r\n    }\r\n\r\n    /**\r\n     * Deletes any stub nodes not within the given range\r\n     */\r\n    public purgeStubsOutsideOfViewport() {\r\n        const { firstRenderedRow, lastRenderedRow } = this.rowRenderer;\r\n        const firstRowBlockStart = this.getBlockStartIndex(firstRenderedRow);\r\n        const [, lastRowBlockEnd] = this.getBlockBounds(lastRenderedRow);\r\n\r\n        this.nodeMap.forEach((lazyNode) => {\r\n            // failed loads are still useful, so we don't purge them\r\n            if (this.lazyBlockLoadingSvc.isRowLoading(this, lazyNode.index) || lazyNode.node.failedLoad) {\r\n                return;\r\n            }\r\n            if (lazyNode.node.stub && (lazyNode.index < firstRowBlockStart || lazyNode.index > lastRowBlockEnd)) {\r\n                this.destroyRowAtIndex(lazyNode.index);\r\n            }\r\n        });\r\n    }\r\n\r\n    private getBlocksDistanceFromRow(nodes: LazyStoreNode[], otherDisplayIndex: number) {\r\n        const blockDistanceToMiddle: { [key: number]: number } = {};\r\n        nodes.forEach(({ node, index }) => {\r\n            const [blockStart, blockEnd] = this.getBlockBounds(index);\r\n            if (blockStart in blockDistanceToMiddle) {\r\n                return;\r\n            }\r\n            const distStart = Math.abs(node.rowIndex! - otherDisplayIndex);\r\n            let distEnd;\r\n            // may not have an end node if the block came back small\r\n            const lastLazyNode = this.nodeMap.getBy('index', [blockEnd - 1]);\r\n            if (lastLazyNode) distEnd = Math.abs(lastLazyNode.node.rowIndex! - otherDisplayIndex);\r\n            const farthest = distEnd == null || distStart < distEnd ? distStart : distEnd;\r\n\r\n            blockDistanceToMiddle[blockStart] = farthest;\r\n        });\r\n        return Object.entries(blockDistanceToMiddle);\r\n    }\r\n\r\n    private purgeExcessRows() {\r\n        // Delete all stub nodes which aren't in the viewport or already loading\r\n        this.purgeStubsOutsideOfViewport();\r\n\r\n        if (this.store.getDisplayIndexEnd() == null || this.storeParams.maxBlocksInCache == null) {\r\n            // if group is collapsed, or max blocks missing, ignore the event\r\n            return;\r\n        }\r\n\r\n        const { firstRenderedRow, lastRenderedRow } = this.rowRenderer;\r\n\r\n        // the start storeIndex of every block in this store\r\n        const allLoadedBlocks: Set<number> = new Set();\r\n        // the start storeIndex of every displayed block in this store\r\n        const blocksInViewport: Set<number> = new Set();\r\n        this.nodeMap.forEach(({ index, node }) => {\r\n            const blockStart = this.getBlockStartIndex(index);\r\n            allLoadedBlocks.add(blockStart);\r\n\r\n            const isInViewport = node.rowIndex! >= firstRenderedRow && node.rowIndex! <= lastRenderedRow;\r\n            if (isInViewport) {\r\n                blocksInViewport.add(blockStart);\r\n            }\r\n        });\r\n\r\n        // if the viewport is larger than the max blocks, then the viewport size is minimum cache size\r\n        const numberOfBlocksToRetain = Math.max(blocksInViewport.size, this.storeParams.maxBlocksInCache ?? 0);\r\n\r\n        // ensure there is blocks that can be removed\r\n        const loadedBlockCount = allLoadedBlocks.size;\r\n        const blocksToRemove = loadedBlockCount - numberOfBlocksToRetain;\r\n        if (blocksToRemove <= 0) {\r\n            return;\r\n        }\r\n\r\n        // the first and last block in the viewport\r\n        let firstRowBlockStart = Number.MAX_SAFE_INTEGER;\r\n        let lastRowBlockStart = Number.MIN_SAFE_INTEGER;\r\n        blocksInViewport.forEach((blockStart) => {\r\n            if (firstRowBlockStart > blockStart) {\r\n                firstRowBlockStart = blockStart;\r\n            }\r\n\r\n            if (lastRowBlockStart < blockStart) {\r\n                lastRowBlockStart = blockStart;\r\n            }\r\n        });\r\n\r\n        // all nodes which aren't cached or in the viewport, and so can be removed\r\n        const disposableNodes = this.nodeMap.filter(({ node, index }) => {\r\n            const rowBlockStart = this.getBlockStartIndex(index);\r\n            const rowBlockInViewport = rowBlockStart >= firstRowBlockStart && rowBlockStart <= lastRowBlockStart;\r\n\r\n            return !rowBlockInViewport && !this.isNodeCached(node);\r\n        });\r\n\r\n        if (disposableNodes.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const midViewportRow = firstRenderedRow + (lastRenderedRow - firstRenderedRow) / 2;\r\n        const blockDistanceArray = this.getBlocksDistanceFromRow(disposableNodes, midViewportRow);\r\n        const blockSize = this.getBlockSize();\r\n\r\n        // sort the blocks by distance from middle of viewport\r\n        blockDistanceArray.sort((a, b) => Math.sign(b[1] - a[1]));\r\n\r\n        // remove excess blocks, starting from furthest from viewport\r\n        for (let i = 0; i < Math.min(blocksToRemove, blockDistanceArray.length); i++) {\r\n            const blockStart = Number(blockDistanceArray[i][0]);\r\n            for (let x = blockStart; x < blockStart + blockSize; x++) {\r\n                const lazyNode = this.nodeMap.getBy('index', x);\r\n                if (!lazyNode || this.isNodeCached(lazyNode.node)) {\r\n                    continue;\r\n                }\r\n                this.destroyRowAtIndex(x);\r\n            }\r\n        }\r\n    }\r\n\r\n    private isNodeFocused(node: RowNode): boolean {\r\n        const focusedCell = this.focusSvc.getFocusCellToUseAfterRefresh();\r\n        if (!focusedCell) {\r\n            return false;\r\n        }\r\n        if (focusedCell.rowPinned != null) {\r\n            return false;\r\n        }\r\n\r\n        const hasFocus = focusedCell.rowIndex === node.rowIndex;\r\n        return hasFocus;\r\n    }\r\n\r\n    private isNodeCached(node: RowNode): boolean {\r\n        const isUnbalancedNode = this.gos.get('groupAllowUnbalanced') && node.key === '';\r\n        return (node.isExpandable() && node.expanded) || this.isNodeFocused(node) || isUnbalancedNode;\r\n    }\r\n\r\n    private extractDuplicateIds(rows: any[]) {\r\n        if (this.getRowIdFunc == null) {\r\n            return [];\r\n        }\r\n\r\n        const newIds = new Set();\r\n        const duplicates = new Set();\r\n        rows.forEach((data) => {\r\n            const id = this.getRowId(data);\r\n            if (newIds.has(id)) {\r\n                duplicates.add(id);\r\n                return;\r\n            }\r\n            newIds.add(id);\r\n        });\r\n\r\n        return [...duplicates];\r\n    }\r\n\r\n    public onLoadSuccess(firstRowIndex: number, numberOfRowsExpected: number, response: LoadSuccessParams) {\r\n        if (!this.live) return;\r\n\r\n        const info = response.groupLevelInfo;\r\n        this.store.setStoreInfo(info);\r\n\r\n        if (this.getRowIdFunc != null) {\r\n            const duplicates = this.extractDuplicateIds(response.rowData);\r\n            if (duplicates.length > 0) {\r\n                const duplicateIdText = duplicates.join(', ');\r\n                _warn(205, { duplicateIdText });\r\n                this.onLoadFailed(firstRowIndex, numberOfRowsExpected);\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (response.pivotResultFields) {\r\n            this.serverSideRowModel.generateSecondaryColumns(response.pivotResultFields);\r\n        }\r\n\r\n        const wasRefreshing = this.nodesToRefresh.size > 0;\r\n        response.rowData.forEach((data, responseRowIndex) => {\r\n            const rowIndex = firstRowIndex + responseRowIndex;\r\n            const nodeFromCache = this.nodeMap.getBy('index', rowIndex);\r\n\r\n            // if stub, overwrite\r\n            if (nodeFromCache?.node?.stub) {\r\n                this.createRowAtIndex(rowIndex, data);\r\n                return;\r\n            }\r\n\r\n            // node already exists, and same as node at designated position, update data\r\n            if (nodeFromCache && this.doesNodeMatch(data, nodeFromCache.node)) {\r\n                this.blockUtils.updateDataIntoRowNode(nodeFromCache.node, data);\r\n                this.nodesToRefresh.delete(nodeFromCache.node);\r\n                nodeFromCache.node.__needsRefreshWhenVisible = false;\r\n                return;\r\n            }\r\n            // create row will handle deleting the overwritten row\r\n            this.createRowAtIndex(rowIndex, data);\r\n        });\r\n\r\n        if (response.rowCount != undefined && response.rowCount !== -1) {\r\n            // if the rowCount has been provided, set the row count\r\n            this.numberOfRows = response.rowCount;\r\n            this.isLastRowKnown = true;\r\n        } else if (numberOfRowsExpected > response.rowData.length) {\r\n            // infer the last row as the response came back short\r\n            this.numberOfRows = firstRowIndex + response.rowData.length;\r\n            this.isLastRowKnown = true;\r\n        } else if (!this.isLastRowKnown) {\r\n            // add 1 for loading row, as we don't know the last row\r\n            const lastInferredRow = firstRowIndex + response.rowData.length + 1;\r\n            if (lastInferredRow > this.numberOfRows) {\r\n                this.numberOfRows = lastInferredRow;\r\n            }\r\n        }\r\n\r\n        if (this.isLastRowKnown) {\r\n            // delete any rows after the last index\r\n            const lazyNodesAfterStoreEnd = this.nodeMap.filter((lazyNode) => lazyNode.index >= this.numberOfRows);\r\n            lazyNodesAfterStoreEnd.forEach((lazyNode) => this.destroyRowAtIndex(lazyNode.index));\r\n        }\r\n\r\n        this.fireStoreUpdatedEvent();\r\n\r\n        // Happens after store updated, as store updating can clear our excess rows.\r\n        const finishedRefreshing = this.nodesToRefresh.size === 0;\r\n        if (wasRefreshing && finishedRefreshing) {\r\n            this.fireRefreshFinishedEvent();\r\n        }\r\n    }\r\n\r\n    public fireRefreshFinishedEvent() {\r\n        const finishedRefreshing = this.nodesToRefresh.size === 0;\r\n        // if anything refreshing currently, skip.\r\n        if (!finishedRefreshing) {\r\n            return;\r\n        }\r\n\r\n        // any nodes left in the map need to be cleaned up, this prevents us preserving nodes\r\n        // indefinitely\r\n        this.removedNodeCache.forEach((node) => {\r\n            this.blockUtils.destroyRowNode(node);\r\n        });\r\n        this.removedNodeCache = new Map();\r\n\r\n        this.store.fireRefreshFinishedEvent();\r\n    }\r\n\r\n    /**\r\n     * @returns true if all rows are loaded\r\n     */\r\n    public isStoreFullyLoaded() {\r\n        const knowsSize = this.isLastRowKnown;\r\n        const hasCorrectRowCount = this.nodeMap.getSize() === this.numberOfRows;\r\n        if (!knowsSize || !hasCorrectRowCount) {\r\n            return;\r\n        }\r\n\r\n        if (this.nodesToRefresh.size > 0) {\r\n            return;\r\n        }\r\n\r\n        // nodeMap find cancels early when it finds a matching record.\r\n        // better to use this than forEach\r\n        let index = -1;\r\n        const firstOutOfPlaceNode = this.nodeMap.find((lazyNode) => {\r\n            index += 1;\r\n            // node not contiguous, nodes must be missing\r\n            if (lazyNode.index !== index) {\r\n                return true;\r\n            }\r\n            // node data is out of date\r\n            if (lazyNode.node.__needsRefreshWhenVisible) {\r\n                return true;\r\n            }\r\n            // node not yet loaded\r\n            if (lazyNode.node.stub) {\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        return firstOutOfPlaceNode == null;\r\n    }\r\n\r\n    public isLastRowIndexKnown() {\r\n        return this.isLastRowKnown;\r\n    }\r\n\r\n    public onLoadFailed(firstRowIndex: number, numberOfRowsExpected: number) {\r\n        if (!this.live) return;\r\n        const wasRefreshing = this.nodesToRefresh.size > 0;\r\n\r\n        for (let i = firstRowIndex; i < firstRowIndex + numberOfRowsExpected && i < this.getRowCount(); i++) {\r\n            let { node }: { node?: RowNode } = this.nodeMap.getBy('index', i) ?? {};\r\n            if (node) {\r\n                this.nodesToRefresh.delete(node);\r\n            }\r\n            if (!node || !node.stub) {\r\n                if (node && !node.stub) {\r\n                    // if node is not a stub, we destroy it and recreate as nodes can't go from data to stub\r\n                    this.destroyRowAtIndex(i);\r\n                }\r\n                node = this.createRowAtIndex(i);\r\n            }\r\n            // this node has been refreshed, even if it wasn't successful\r\n            node.__needsRefreshWhenVisible = false;\r\n            node.failedLoad = true;\r\n        }\r\n\r\n        const finishedRefreshing = this.nodesToRefresh.size === 0;\r\n        if (wasRefreshing && finishedRefreshing) {\r\n            this.fireRefreshFinishedEvent();\r\n        }\r\n\r\n        this.fireStoreUpdatedEvent();\r\n    }\r\n\r\n    public markNodesForRefresh() {\r\n        this.nodeMap.forEach((lazyNode) => {\r\n            if (lazyNode.node.stub && !lazyNode.node.failedLoad) {\r\n                return;\r\n            }\r\n            this.nodesToRefresh.add(lazyNode.node);\r\n        });\r\n        this.lazyBlockLoadingSvc.queueLoadCheck();\r\n\r\n        if (this.isLastRowKnown && this.numberOfRows === 0) {\r\n            this.numberOfRows = 1;\r\n            this.isLastRowKnown = false;\r\n            this.fireStoreUpdatedEvent();\r\n        }\r\n    }\r\n\r\n    public isNodeInCache(id: string): boolean {\r\n        return !!this.nodeMap.getBy('id', id);\r\n    }\r\n\r\n    // gets called 1) row count changed 2) cache purged 3) items inserted\r\n    private fireStoreUpdatedEvent(): void {\r\n        if (!this.live) {\r\n            return;\r\n        }\r\n\r\n        this.store.fireStoreUpdatedEvent();\r\n    }\r\n\r\n    private getRowId(data: any): string | null {\r\n        if (this.getRowIdFunc == null) {\r\n            return null;\r\n        }\r\n\r\n        // find rowNode using id\r\n        const { level } = this.store.getRowDetails();\r\n        const parentKeys = this.store.getParentNode().getRoute() ?? [];\r\n        return this.getRowIdFunc({\r\n            data,\r\n            parentKeys: parentKeys.length > 0 ? parentKeys : undefined,\r\n            level,\r\n        });\r\n    }\r\n\r\n    public getOrderedNodeMap() {\r\n        const obj: { [key: number]: LazyStoreNode } = {};\r\n        this.nodeMap.forEach((node) => (obj[node.index] = node));\r\n        return obj;\r\n    }\r\n\r\n    public clearDisplayIndexes() {\r\n        this.nodeDisplayIndexMap.clear();\r\n    }\r\n\r\n    /**\r\n     * Client side sorting\r\n     */\r\n    public clientSideSortRows() {\r\n        const sortOptions = this.sortSvc?.getSortOptions() ?? [];\r\n        const isAnySort = sortOptions.some((opt) => opt.sort != null);\r\n        if (!isAnySort || !this.rowNodeSorter) {\r\n            return;\r\n        }\r\n\r\n        // the node map does not need entirely recreated, only the indexes need updated.\r\n        const allNodes = new Array(this.nodeMap.getSize());\r\n        this.nodeMap.forEach((lazyNode) => (allNodes[lazyNode.index] = lazyNode.node));\r\n        this.nodeMap.clear();\r\n\r\n        const sortedNodes = this.rowNodeSorter.doFullSort(allNodes, sortOptions);\r\n        sortedNodes.forEach((node, index) => {\r\n            this.nodeMap.set({\r\n                id: node.id!,\r\n                node,\r\n                index,\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Transaction Support here\r\n     */\r\n    public updateRowNodes(updates: any[]): RowNode[] {\r\n        const updatedNodes: RowNode[] = [];\r\n        updates.forEach((data) => {\r\n            const id = this.getRowId(data);\r\n            const lazyNode = this.nodeMap.getBy('id', id);\r\n            if (lazyNode) {\r\n                this.blockUtils.updateDataIntoRowNode(lazyNode.node, data);\r\n                updatedNodes.push(lazyNode.node);\r\n            }\r\n        });\r\n        return updatedNodes;\r\n    }\r\n\r\n    public insertRowNodes(inserts: any[], indexToAdd?: number): RowNode[] {\r\n        // adjust row count to allow for footer row\r\n        const realRowCount = this.store.getRowCount() - (this.store.getParentNode().sibling ? 1 : 0);\r\n\r\n        // if missing and we know the last row, we're inserting at the end\r\n        const addIndex = indexToAdd == null && this.isLastRowKnown ? realRowCount : indexToAdd;\r\n\r\n        // can't insert nodes past the end of the store\r\n        if (addIndex == null || realRowCount < addIndex) {\r\n            return [];\r\n        }\r\n\r\n        const uniqueInsertsMap: { [id: string]: any } = {};\r\n\r\n        inserts.forEach((data) => {\r\n            const dataId = this.getRowId(data)!;\r\n            if (dataId && this.isNodeInCache(dataId)) {\r\n                return;\r\n            }\r\n\r\n            uniqueInsertsMap[dataId] = data;\r\n        });\r\n\r\n        const uniqueInserts = Object.values(uniqueInsertsMap);\r\n\r\n        const numberOfInserts = uniqueInserts.length;\r\n        if (numberOfInserts === 0) {\r\n            return [];\r\n        }\r\n\r\n        const nodesToMove = this.nodeMap.filter((node) => node.index >= addIndex);\r\n        // delete all nodes which need moved first, so they don't get overwritten\r\n        nodesToMove.forEach((lazyNode) => this.nodeMap.delete(lazyNode));\r\n        // then move the nodes to their new locations\r\n        nodesToMove.forEach((lazyNode) => {\r\n            this.nodeMap.set({\r\n                node: lazyNode.node,\r\n                index: lazyNode.index + numberOfInserts,\r\n                id: lazyNode.id,\r\n            });\r\n        });\r\n\r\n        // increase the store size to accommodate\r\n        this.numberOfRows += numberOfInserts;\r\n\r\n        // finally insert the new rows\r\n        return uniqueInserts.map((data, uniqueInsertOffset) =>\r\n            this.createRowAtIndex(addIndex + uniqueInsertOffset, data)\r\n        );\r\n    }\r\n\r\n    public removeRowNodes(idsToRemove: string[]): RowNode[] {\r\n        const removedNodes: RowNode[] = [];\r\n        const nodesToVerify: RowNode[] = [];\r\n\r\n        // track how many nodes have been deleted, as when we pass other nodes we need to shift them up\r\n        let deletedNodeCount = 0;\r\n\r\n        const remainingIdsToRemove = [...idsToRemove];\r\n\r\n        const allNodes = this.getOrderedNodeMap();\r\n        let contiguousIndex = -1;\r\n        for (const stringIndex of Object.keys(allNodes)) {\r\n            contiguousIndex += 1;\r\n            const node = allNodes[stringIndex as any];\r\n\r\n            // finding the index allows the use of splice which should be slightly faster than both a check and filter\r\n            const matchIndex = remainingIdsToRemove.findIndex((idToRemove) => idToRemove === node.id);\r\n            if (matchIndex !== -1) {\r\n                // found node, remove it from nodes to remove\r\n                remainingIdsToRemove.splice(matchIndex, 1);\r\n\r\n                this.destroyRowAtIndex(Number(stringIndex));\r\n                removedNodes.push(node.node);\r\n                deletedNodeCount += 1;\r\n                continue;\r\n            }\r\n\r\n            // no nodes removed and this node doesn't match, so no need to shift\r\n            if (deletedNodeCount === 0) {\r\n                continue;\r\n            }\r\n\r\n            const numericStoreIndex = Number(stringIndex);\r\n            if (contiguousIndex !== numericStoreIndex) {\r\n                nodesToVerify.push(node.node);\r\n            }\r\n\r\n            // shift normal node up by number of deleted prior to this point\r\n            this.nodeMap.delete(node);\r\n            this.nodeMap.set({\r\n                id: node.id!,\r\n                node: node.node,\r\n                index: numericStoreIndex - deletedNodeCount,\r\n            });\r\n        }\r\n\r\n        this.numberOfRows -= this.isLastRowIndexKnown() ? idsToRemove.length : deletedNodeCount;\r\n\r\n        if (remainingIdsToRemove.length > 0 && nodesToVerify.length > 0) {\r\n            nodesToVerify.forEach((node) => (node.__needsRefreshWhenVisible = true));\r\n            this.lazyBlockLoadingSvc.queueLoadCheck();\r\n        }\r\n\r\n        return removedNodes;\r\n    }\r\n\r\n    /**\r\n     * Return the block size configured for this cache\r\n     */\r\n    public getBlockSize() {\r\n        return this.storeParams.cacheBlockSize || DEFAULT_BLOCK_SIZE;\r\n    }\r\n\r\n    /**\r\n     * Get the start index of the loading block for a given index\r\n     */\r\n    public getBlockStartIndex(storeIndex: number): number {\r\n        const blockSize = this.getBlockSize();\r\n        return storeIndex - (storeIndex % blockSize);\r\n    }\r\n\r\n    /**\r\n     * Get the start and end index of a block, given a row store index\r\n     */\r\n    public getBlockBounds(storeIndex: number): [number, number] {\r\n        const startOfBlock = this.getBlockStartIndex(storeIndex);\r\n        const blockSize = this.getBlockSize();\r\n        return [startOfBlock, startOfBlock + blockSize];\r\n    }\r\n}\r\n", "export class MultiIndexMap<K, I extends keyof K> {\r\n    private indexes: I[];\r\n    private maps: Map<I, Map<any, K>>;\r\n\r\n    constructor(...indexes: I[]) {\r\n        this.indexes = indexes;\r\n        this.maps = new Map(this.indexes.map((index) => [index, new Map()]));\r\n    }\r\n\r\n    public getSize(): number {\r\n        return this.maps.get(this.indexes[0])!.size;\r\n    }\r\n\r\n    public getBy(index: I, key: any): K | undefined {\r\n        const map = this.maps.get(index)!;\r\n        return map.get(key);\r\n    }\r\n\r\n    public set(item: K) {\r\n        this.indexes.forEach((index) => {\r\n            const map = this.maps.get(index)!;\r\n            map.set(item[index], item);\r\n        });\r\n    }\r\n\r\n    public delete(item: K) {\r\n        this.indexes.forEach((index) => {\r\n            const map = this.maps.get(index)!;\r\n            map.delete(item[index]);\r\n        });\r\n    }\r\n\r\n    public clear() {\r\n        this.maps.forEach((map) => map.clear());\r\n    }\r\n\r\n    private getIterator(index: I) {\r\n        const map = this.maps.get(index)!;\r\n        return map.values();\r\n    }\r\n\r\n    public forEach(callback: (item: K) => void) {\r\n        const iterator = this.getIterator(this.indexes[0]);\r\n        let pointer: IteratorResult<K, any>;\r\n        while ((pointer = iterator.next())) {\r\n            if (pointer.done) break;\r\n            callback(pointer.value);\r\n        }\r\n    }\r\n\r\n    public find(callback: (item: K) => boolean) {\r\n        const iterator = this.getIterator(this.indexes[0]);\r\n        let pointer: IteratorResult<K, any>;\r\n        while ((pointer = iterator.next())) {\r\n            if (pointer.done) break;\r\n            if (callback(pointer.value)) {\r\n                return pointer.value;\r\n            }\r\n        }\r\n    }\r\n\r\n    public filter(predicate: (item: K) => boolean) {\r\n        const iterator = this.getIterator(this.indexes[0]);\r\n        let pointer: IteratorResult<K, any>;\r\n        const result: K[] = [];\r\n        while ((pointer = iterator.next())) {\r\n            if (pointer.done) break;\r\n            if (predicate(pointer.value)) {\r\n                result.push(pointer.value);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    ColumnModel,\r\n    ColumnVO,\r\n    NamedBean,\r\n    RowNode,\r\n    StoreRefreshAfterParams,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _isServerSideRowModel } from 'ag-grid-community';\r\n\r\nimport type { ServerSideRowModel } from '../serverSideRowModel';\r\nimport type { LazyStore } from './lazy/lazyStore';\r\nimport type { StoreFactory } from './storeFactory';\r\n\r\nexport class StoreUtils extends BeanStub implements NamedBean {\r\n    beanName = 'ssrmStoreUtils' as const;\r\n\r\n    private colModel: ColumnModel;\r\n    private serverSideRowModel: ServerSideRowModel;\r\n    private storeFactory: StoreFactory;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n        this.serverSideRowModel = beans.rowModel as ServerSideRowModel;\r\n        this.storeFactory = beans.ssrmStoreFactory as StoreFactory;\r\n    }\r\n\r\n    public getChildStore(\r\n        keys: string[],\r\n        currentCache: LazyStore,\r\n        findNodeFunc: (key: string) => RowNode | null\r\n    ): LazyStore | null {\r\n        if (!keys?.length) {\r\n            return currentCache;\r\n        }\r\n\r\n        const nextKey = keys[0];\r\n        const nextNode = findNodeFunc(nextKey);\r\n\r\n        if (nextNode) {\r\n            // if we have the final node, but not the final store, we create it to allow\r\n            // early population of data\r\n            if (keys.length === 1 && !nextNode.childStore) {\r\n                const storeParams = this.serverSideRowModel.getParams();\r\n                nextNode.childStore = this.createBean(this.storeFactory.createStore(storeParams, nextNode));\r\n            }\r\n\r\n            const keyListForNextLevel = keys.slice(1, keys.length);\r\n            const nextStore = nextNode.childStore as LazyStore | undefined;\r\n            return nextStore ? nextStore.getChildStore(keyListForNextLevel) : null;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public isServerRefreshNeeded(\r\n        parentRowNode: RowNode,\r\n        rowGroupCols: ColumnVO[],\r\n        params: StoreRefreshAfterParams\r\n    ): boolean {\r\n        if (params.valueColChanged || params.secondaryColChanged) {\r\n            return true;\r\n        }\r\n\r\n        const level = parentRowNode.level + 1;\r\n        const grouping = level < rowGroupCols.length;\r\n        const leafNodes = !grouping;\r\n\r\n        if (leafNodes) {\r\n            return true;\r\n        }\r\n\r\n        const colIdThisGroup = rowGroupCols[level].id;\r\n        const actionOnThisGroup = params.changedColumns.indexOf(colIdThisGroup) > -1;\r\n\r\n        if (actionOnThisGroup) {\r\n            return true;\r\n        }\r\n\r\n        const allCols = this.colModel.getCols();\r\n        const affectedGroupCols = allCols\r\n            // find all impacted cols which also a group display column\r\n            .filter((col) => col.getColDef().showRowGroup && params.changedColumns.includes(col.getId()))\r\n            .map((col) => col.getColDef().showRowGroup)\r\n            // if displaying all groups, or displaying the effected col for this group, refresh\r\n            .some((group) => group === true || group === colIdThisGroup);\r\n\r\n        return affectedGroupCols;\r\n    }\r\n\r\n    public getServerSideInitialRowCount(): number | null {\r\n        return this.gos.get('serverSideInitialRowCount');\r\n    }\r\n\r\n    public isServerSideSortAllLevels() {\r\n        return this.gos.get('serverSideSortAllLevels') && _isServerSideRowModel(this.gos);\r\n    }\r\n\r\n    public isServerSideOnlyRefreshFilteredGroups() {\r\n        return this.gos.get('serverSideOnlyRefreshFilteredGroups') && _isServerSideRowModel(this.gos);\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    IServerSideTransactionManager,\r\n    NamedBean,\r\n    ServerSideTransaction,\r\n    ServerSideTransactionResult,\r\n    ValueCache,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, ServerSideTransactionResultStatus, _isServerSideRowModel } from 'ag-grid-community';\r\n\r\nimport type { ServerSideRowModel } from './serverSideRowModel';\r\nimport type { ServerSideSelectionService } from './services/serverSideSelectionService';\r\n\r\ninterface AsyncTransactionWrapper {\r\n    transaction: ServerSideTransaction;\r\n    callback?: (result: ServerSideTransactionResult) => void;\r\n}\r\n\r\nexport class TransactionManager extends BeanStub implements NamedBean, IServerSideTransactionManager {\r\n    beanName = 'ssrmTxnManager' as const;\r\n\r\n    private valueCache?: ValueCache;\r\n    private serverSideRowModel: ServerSideRowModel;\r\n    private selectionSvc?: ServerSideSelectionService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.valueCache = beans.valueCache;\r\n        this.serverSideRowModel = beans.rowModel as ServerSideRowModel;\r\n        this.selectionSvc = beans.selectionSvc as ServerSideSelectionService;\r\n    }\r\n\r\n    private asyncTransactionsTimeout: number | undefined;\r\n    private asyncTransactions: AsyncTransactionWrapper[] = [];\r\n\r\n    public postConstruct(): void {\r\n        // only want to be active if SSRM active, otherwise would be interfering with other row models\r\n        if (!_isServerSideRowModel(this.gos)) {\r\n            return;\r\n        }\r\n    }\r\n\r\n    public applyTransactionAsync(\r\n        transaction: ServerSideTransaction,\r\n        callback?: (res: ServerSideTransactionResult) => void\r\n    ): void {\r\n        if (this.asyncTransactionsTimeout == null) {\r\n            this.scheduleExecuteAsync();\r\n        }\r\n        this.asyncTransactions.push({ transaction: transaction, callback: callback });\r\n    }\r\n\r\n    private scheduleExecuteAsync(): void {\r\n        const waitMillis = this.gos.get('asyncTransactionWaitMillis');\r\n        this.asyncTransactionsTimeout = window.setTimeout(() => {\r\n            this.executeAsyncTransactions();\r\n        }, waitMillis);\r\n    }\r\n\r\n    private executeAsyncTransactions(): void {\r\n        if (!this.asyncTransactions) {\r\n            return;\r\n        }\r\n\r\n        const resultFuncs: (() => void)[] = [];\r\n        const resultsForEvent: ServerSideTransactionResult[] = [];\r\n\r\n        const transactionsToRetry: AsyncTransactionWrapper[] = [];\r\n        let atLeastOneTransactionApplied = false;\r\n\r\n        this.asyncTransactions.forEach((txWrapper) => {\r\n            let result: ServerSideTransactionResult | undefined;\r\n            const hasStarted = this.serverSideRowModel.executeOnStore(txWrapper.transaction.route!, (cache) => {\r\n                result = cache.applyTransaction(txWrapper.transaction);\r\n            });\r\n\r\n            if (!hasStarted) {\r\n                result = { status: ServerSideTransactionResultStatus.StoreNotStarted };\r\n            } else if (result == undefined) {\r\n                result = { status: ServerSideTransactionResultStatus.StoreNotFound };\r\n            }\r\n\r\n            resultsForEvent.push(result);\r\n\r\n            const retryTransaction = result.status == ServerSideTransactionResultStatus.StoreLoading;\r\n\r\n            if (retryTransaction) {\r\n                transactionsToRetry.push(txWrapper);\r\n                return;\r\n            }\r\n\r\n            if (txWrapper.callback) {\r\n                resultFuncs.push(() => txWrapper.callback!(result!));\r\n            }\r\n            if (result.status === ServerSideTransactionResultStatus.Applied) {\r\n                atLeastOneTransactionApplied = true;\r\n            }\r\n        });\r\n\r\n        // do callbacks in next VM turn so it's async\r\n        if (resultFuncs.length > 0) {\r\n            window.setTimeout(() => {\r\n                resultFuncs.forEach((func) => func());\r\n            }, 0);\r\n        }\r\n\r\n        this.asyncTransactionsTimeout = undefined;\r\n\r\n        // this will be empty list if nothing to retry\r\n        this.asyncTransactions = transactionsToRetry;\r\n\r\n        if (atLeastOneTransactionApplied) {\r\n            this.valueCache?.onDataChanged();\r\n            this.eventSvc.dispatchEvent({ type: 'storeUpdated' });\r\n        }\r\n\r\n        if (resultsForEvent.length > 0) {\r\n            this.eventSvc.dispatchEvent({\r\n                type: 'asyncTransactionsFlushed',\r\n                results: resultsForEvent,\r\n            });\r\n        }\r\n    }\r\n\r\n    public flushAsyncTransactions(): void {\r\n        // the timeout could be missing, if we are flushing due to row data loaded\r\n        if (this.asyncTransactionsTimeout != null) {\r\n            clearTimeout(this.asyncTransactionsTimeout);\r\n        }\r\n        this.executeAsyncTransactions();\r\n    }\r\n\r\n    public applyTransaction(transaction: ServerSideTransaction): ServerSideTransactionResult | undefined {\r\n        let res: ServerSideTransactionResult | undefined;\r\n\r\n        const hasStarted = this.serverSideRowModel.executeOnStore(transaction.route!, (store) => {\r\n            res = store.applyTransaction(transaction);\r\n        });\r\n\r\n        if (!hasStarted) {\r\n            return { status: ServerSideTransactionResultStatus.StoreNotStarted };\r\n        } else if (res) {\r\n            this.valueCache?.onDataChanged();\r\n            if (res.remove && this.selectionSvc) {\r\n                const removedRowIds = res.remove.map((row) => row.id!);\r\n                this.selectionSvc.deleteSelectionStateFromParent(transaction.route || [], removedRowIds);\r\n            }\r\n\r\n            this.eventSvc.dispatchEvent({ type: 'storeUpdated' });\r\n            return res;\r\n        } else {\r\n            return { status: ServerSideTransactionResultStatus.StoreNotFound };\r\n        }\r\n    }\r\n}\r\n", "import type { IntegratedModule } from 'ag-charts-types';\r\n\r\nimport { _preInitErrMsg } from 'ag-grid-community';\r\nimport type { _ModuleWithoutApi } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport { VERSION } from '../version';\r\nimport { sparklineCSS } from './sparkline.css-GENERATED';\r\nimport { SparklineCellRenderer } from './sparklineCellRenderer';\r\n\r\ntype SparklineChartsModuleType = { with: (params: IntegratedModule) => _ModuleWithoutApi } & _ModuleWithoutApi;\r\nconst moduleName = 'Sparklines';\r\n/**\r\n * @feature Sparklines\r\n * Requires the AG Charts library to be provided to this module via the `with` method.\r\n * The AG Charts module can be imported from either `ag-charts-community` or `ag-charts-enterprise`.\r\n * @example\r\n * import { AgChartsCommunityModule } from 'ag-charts-community';\r\n * import { ModuleRegistry } from 'ag-grid-community';\r\n * import { SparklinesModule } from 'ag-grid-enterprise';\r\n *\r\n * ModuleRegistry.registerModules([ SparklinesModule.with(AgChartsCommunityModule) ]);\r\n */\r\nexport const SparklinesModule: SparklineChartsModuleType = {\r\n    moduleName,\r\n    version: VERSION,\r\n    dependsOn: [EnterpriseCoreModule],\r\n    validate: () => {\r\n        return {\r\n            isValid: false,\r\n            message: _preInitErrMsg(258),\r\n        };\r\n    },\r\n    with: (params) => {\r\n        params.setup();\r\n\r\n        return {\r\n            moduleName,\r\n            version: VERSION,\r\n            dependsOn: [EnterpriseCoreModule],\r\n            css: [sparklineCSS],\r\n            userComponents: {\r\n                agSparklineCellRenderer: {\r\n                    classImp: SparklineCellRenderer,\r\n                    /** Default params for provided components */\r\n                    params: { createSparkline: params.createSparkline },\r\n                },\r\n            },\r\n            validate: () => {\r\n                return { isValid: true };\r\n            },\r\n        };\r\n    },\r\n};\r\n", "export const sparklineCSS = /*css*/ `.ag-sparkline-wrapper{height:100%;left:0;position:absolute;top:0;width:100%}.ag-sparkline-wrapper :where(canvas){position:absolute}`;\n", "import type {\r\n    AgChartInstance,\r\n    AgChartTheme,\r\n    AgChartThemeName,\r\n    AgSparklineOptions,\r\n    AgTooltipRendererResult,\r\n} from 'ag-charts-types';\r\n\r\nimport type { ICellRenderer, ISparklineCellRendererParams } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _observeResize } from 'ag-grid-community';\r\n\r\nimport { wrapFn } from './sparklinesUtils';\r\n\r\nexport const DEFAULT_THEMES = ['ag-default', 'ag-material', 'ag-sheets', 'ag-polychroma', 'ag-vivid'];\r\n\r\nexport class SparklineCellRenderer extends Component implements ICellRenderer {\r\n    private readonly eSparkline: HTMLElement = RefPlaceholder;\r\n    private sparklineInstance?: AgChartInstance<any>;\r\n    private sparklineOptions: AgSparklineOptions;\r\n    private params: ISparklineCellRendererParams<any, any> | undefined;\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-sparkline-wrapper\">\r\n            <span data-ref=\"eSparkline\"></span>\r\n        </div>`);\r\n    }\r\n\r\n    postConstruct(): void {\r\n        this.addManagedPropertyListeners(['chartThemeOverrides', 'chartThemes'], (_event) => this.refresh(this.params));\r\n    }\r\n\r\n    public init(params: ISparklineCellRendererParams): void {\r\n        this.refresh(params);\r\n        const unsubscribeFromResize = _observeResize(this.beans, this.getGui(), () => this.refresh(params));\r\n        this.addDestroyFunc(() => unsubscribeFromResize());\r\n    }\r\n\r\n    private getThemeName(): string {\r\n        const availableThemes = this.gos.get('chartThemes');\r\n        return (availableThemes || DEFAULT_THEMES)[0];\r\n    }\r\n\r\n    public refresh(params?: ISparklineCellRendererParams): boolean {\r\n        this.params = params;\r\n        const { clientWidth: width, clientHeight: height } = this.getGui();\r\n\r\n        if (!this.sparklineInstance && params && width > 0 && height) {\r\n            this.sparklineOptions = {\r\n                container: this.eSparkline,\r\n                width,\r\n                height,\r\n                ...params.sparklineOptions,\r\n                data: this.processData(params.value),\r\n            } as AgSparklineOptions;\r\n\r\n            if (this.sparklineOptions.tooltip?.renderer) {\r\n                this.wrapTooltipRenderer();\r\n            } else {\r\n                this.sparklineOptions.tooltip = {\r\n                    ...this.sparklineOptions.tooltip,\r\n                    renderer: (params: any) =>\r\n                        ({ content: this.createDefaultContent(params) }) as AgTooltipRendererResult,\r\n                };\r\n            }\r\n\r\n            // Only bar sparklines have itemStyler\r\n            const theme = this.sparklineOptions?.theme as AgChartTheme;\r\n            if (this.sparklineOptions.type === 'bar' && this.sparklineOptions.itemStyler) {\r\n                this.wrapItemStyler(this.sparklineOptions);\r\n            } else if (theme?.overrides?.bar?.series?.itemStyler) {\r\n                this.wrapItemStyler(theme.overrides.bar.series);\r\n            }\r\n\r\n            this.updateTheme(this.sparklineOptions);\r\n\r\n            // create new sparkline\r\n            this.sparklineInstance = params.createSparkline!(this.sparklineOptions);\r\n            return true;\r\n        } else if (this.sparklineInstance) {\r\n            const data = params?.value;\r\n            this.sparklineOptions.width = width;\r\n            this.sparklineOptions.height = height;\r\n            this.sparklineOptions.data = this.processData(data);\r\n            this.updateTheme(this.sparklineOptions);\r\n\r\n            this.sparklineInstance.updateDelta(this.sparklineOptions);\r\n\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private updateTheme(sparklineOptions: AgSparklineOptions) {\r\n        const themeName = this.getThemeName() as AgChartThemeName;\r\n        if (typeof sparklineOptions.theme === 'string' || !sparklineOptions.theme) {\r\n            sparklineOptions.theme = themeName;\r\n        } else if (sparklineOptions.theme) {\r\n            sparklineOptions.theme.baseTheme = themeName;\r\n        }\r\n    }\r\n\r\n    private processData(data: any[] = []) {\r\n        if (data.length === 0) {\r\n            return data;\r\n        }\r\n\r\n        return data.filter((item) => item != null);\r\n    }\r\n\r\n    private createContext() {\r\n        return {\r\n            data: this.params?.data,\r\n            cellData: this.params?.value,\r\n        };\r\n    }\r\n\r\n    private createDefaultContent(params: any, userRendererResult?: AgTooltipRendererResult): string {\r\n        const userTitle = userRendererResult?.title;\r\n        const xKeyProvided = this.sparklineOptions.xKey;\r\n        const tupleData = Array.isArray(this.sparklineOptions.data?.[0]);\r\n\r\n        const showXValue = !userTitle && (xKeyProvided || tupleData);\r\n\r\n        return `${showXValue ? `${params.xValue} ` : ''}${params.yValue}`;\r\n    }\r\n\r\n    private wrapItemStyler(container: { itemStyler?: any }) {\r\n        container!.itemStyler = wrapFn(container.itemStyler, (fn, stylerParams: any): any => {\r\n            return fn({\r\n                ...stylerParams,\r\n                context: this.createContext(),\r\n            });\r\n        });\r\n    }\r\n\r\n    private wrapTooltipRenderer() {\r\n        this.sparklineOptions.tooltip = {\r\n            ...this.sparklineOptions.tooltip,\r\n            renderer: wrapFn(this.sparklineOptions.tooltip!.renderer!, (fn, tooltipParams: any): any => {\r\n                const userRendererResult = fn({\r\n                    ...tooltipParams,\r\n                    context: this.createContext(),\r\n                });\r\n\r\n                if (typeof userRendererResult === 'string') {\r\n                    return userRendererResult;\r\n                }\r\n                return {\r\n                    content: this.createDefaultContent(tooltipParams, userRendererResult),\r\n                    ...userRendererResult,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    public override destroy() {\r\n        super.destroy();\r\n        this.sparklineInstance?.destroy();\r\n    }\r\n}\r\n", "const WrappedFunctionMarker = Symbol('WrappedFunctionMarker');\r\n\r\ntype FunctionParams = (...args: any[]) => any;\r\ntype WrapperFunctionParams = (fn: FunctionParams, ...args: any[]) => any;\r\n\r\nexport const wrapFn = (fn: FunctionParams, wrapperFn: WrapperFunctionParams) => {\r\n    if ((fn as any)[WrappedFunctionMarker]) {\r\n        return fn;\r\n    }\r\n\r\n    const wrapped = (...args: any[]) => wrapperFn(fn, ...args);\r\n\r\n    wrapped[WrappedFunctionMarker] = WrappedFunctionMarker;\r\n\r\n    return wrapped;\r\n};\r\n", "import type { IntegratedModule } from 'ag-charts-types';\r\n\r\nimport type { Module, ModuleName, _GridChartsGridApi, _ModuleWithApi } from 'ag-grid-community';\r\nimport { _PopupModule, _SharedDragAndDropModule, _preInitErrMsg } from 'ag-grid-community';\r\n\r\nimport { EnterpriseCoreModule } from '../agGridEnterpriseModule';\r\nimport type { ILicenseManager } from '../license/shared/licenseManager';\r\nimport { LicenseManager } from '../license/shared/licenseManager';\r\nimport { CellSelectionModule } from '../rangeSelection/rangeSelectionModule';\r\nimport { VERSION } from '../version';\r\nimport { MenuItemModule } from '../widgets/menuItemModule';\r\nimport { AgChartsExports } from './agChartsExports';\r\nimport { EnterpriseChartProxyFactory } from './chartComp/chartProxies/enterpriseChartProxyFactory';\r\nimport { AdvancedSettingsMenuFactory } from './chartComp/menu/advancedSettings/advancedSettingsMenuFactory';\r\nimport { ChartMenuListFactory } from './chartComp/menu/chartMenuList';\r\nimport { ChartCrossFilterService } from './chartComp/services/chartCrossFilterService';\r\nimport { ChartMenuService } from './chartComp/services/chartMenuService';\r\nimport { ChartTranslationService } from './chartComp/services/chartTranslationService';\r\nimport { ChartService } from './chartService';\r\nimport {\r\n    closeChartToolPanel,\r\n    createCrossFilterChart,\r\n    createPivotChart,\r\n    createRangeChart,\r\n    downloadChart,\r\n    getChartImageDataURL,\r\n    getChartModels,\r\n    getChartRef,\r\n    openChartToolPanel,\r\n    restoreChart,\r\n    updateChart,\r\n} from './chartsApi';\r\nimport { integratedChartsModuleCSS } from './integratedChartsModule.css-GENERATED';\r\nimport { validGridChartsVersion } from './utils/validGridChartsVersion';\r\n\r\ntype IntegratedChartsModuleType = {\r\n    with: (params: IntegratedModule) => _ModuleWithApi<_GridChartsGridApi>;\r\n} & _ModuleWithApi<_GridChartsGridApi>;\r\n\r\nconst icons: _ModuleWithApi<_GridChartsGridApi>['icons'] = {\r\n    // shown on top right of chart when chart is linked to range data (click to unlink)\r\n    linked: 'linked',\r\n    // shown on top right of chart when chart is not linked to range data (click to link)\r\n    unlinked: 'unlinked',\r\n    // icon to open charts menu\r\n    chartsMenu: 'menu-alt',\r\n    // download chart\r\n    chartsDownload: 'save',\r\n    // Edit Chart menu item shown in Integrated Charts menu\r\n    chartsMenuEdit: 'chart',\r\n    // Advanced Settings menu item shown in Integrated Charts menu\r\n    chartsMenuAdvancedSettings: 'settings',\r\n    // shown in Integrated Charts menu add fields\r\n    chartsMenuAdd: 'plus',\r\n    // shown in Integrated Charts tool panel color picker\r\n    chartsColorPicker: 'small-down',\r\n    // previous in Integrated Charts settings tool panel theme switcher\r\n    chartsThemePrevious: 'previous',\r\n    // next in Integrated Charts settings tool panel theme switcher\r\n    chartsThemeNext: 'next',\r\n};\r\nconst apiFunctions: _ModuleWithApi<_GridChartsGridApi>['apiFunctions'] = {\r\n    getChartModels,\r\n    getChartRef,\r\n    getChartImageDataURL,\r\n    downloadChart,\r\n    openChartToolPanel,\r\n    closeChartToolPanel,\r\n    createRangeChart,\r\n    createPivotChart,\r\n    createCrossFilterChart,\r\n    updateChart,\r\n    restoreChart,\r\n};\r\n\r\nconst dependsOn: Module[] = [\r\n    CellSelectionModule,\r\n    EnterpriseCoreModule,\r\n    _SharedDragAndDropModule,\r\n    _PopupModule,\r\n    MenuItemModule,\r\n];\r\nconst moduleName: ModuleName = 'IntegratedCharts';\r\n\r\n/**\r\n * @deprecated v33 Deprecated as of v33, please use `IntegratedChartsModule` instead.\r\n */\r\nexport const GridChartsModule: _ModuleWithApi<_GridChartsGridApi> = {\r\n    moduleName: 'GridCharts',\r\n    version: VERSION,\r\n    dependsOn, // included to avoid other false positive warnings about missing modules\r\n    validate: () => {\r\n        return {\r\n            isValid: false,\r\n            message: `AG Grid: As of v33, the \"GridChartsModule\" has been deprecated. Please use \"IntegratedChartsModule.with(...)\" instead.\\n ${_preInitErrMsg(257)}`,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * @feature Integrated Charts\r\n * Requires the AG Charts library to be provided to this module via the `with` method.\r\n * The AG Charts module can be imported from either `ag-charts-community` or `ag-charts-enterprise`.\r\n * @example\r\n * import { AgChartsEnterpriseModule } from 'ag-charts-enterprise';\r\n * import { ModuleRegistry } from 'ag-grid-community';\r\n * import { IntegratedChartsModule } from 'ag-grid-enterprise';\r\n *\r\n * ModuleRegistry.registerModules([ IntegratedChartsModule.with(AgChartsEnterpriseModule) ]);\r\n */\r\nexport const IntegratedChartsModule: IntegratedChartsModuleType = {\r\n    moduleName,\r\n    version: VERSION,\r\n    dependsOn, // included to avoid other false positive warnings about missing modules\r\n    validate: () => {\r\n        return {\r\n            isValid: false,\r\n            message: _preInitErrMsg(257),\r\n        };\r\n    },\r\n    with: (params) => {\r\n        params.setup();\r\n        params.setGridContext?.(true);\r\n        if (params.isEnterprise && params.setLicenseKey) {\r\n            const chartsManager: ILicenseManager = {\r\n                setLicenseKey: params.setLicenseKey,\r\n            };\r\n            LicenseManager.setChartsLicenseManager(chartsManager);\r\n        }\r\n\r\n        return {\r\n            moduleName,\r\n            version: VERSION,\r\n            icons,\r\n            apiFunctions,\r\n            dependsOn,\r\n            css: [integratedChartsModuleCSS],\r\n            validate: () => {\r\n                return validGridChartsVersion({\r\n                    gridVersion: VERSION,\r\n                    chartsVersion: params.VERSION,\r\n                });\r\n            },\r\n            beans: [\r\n                // bind the params to the constructor to avoid the need for static properties\r\n                AgChartsExports.bind(null, params),\r\n                ChartService,\r\n                ChartTranslationService,\r\n                ChartCrossFilterService,\r\n                ChartMenuListFactory,\r\n                ChartMenuService,\r\n                // Include enterprise beans for now for all users as tiny compared to charts bundle size\r\n                EnterpriseChartProxyFactory,\r\n                AdvancedSettingsMenuFactory,\r\n            ],\r\n        };\r\n    },\r\n};\r\n", "import type { IntegratedModule } from 'ag-charts-types';\r\n\r\nimport type { NamedBean } from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\ntype ChartTypes = IntegratedModule;\r\n\r\n/** Bean to expose the AG Charts apis from a single location and not require a code dependency on ag-charts-community */\r\nexport class AgChartsExports extends BeanStub implements NamedBean {\r\n    beanName = 'agChartsExports' as const;\r\n\r\n    isEnterprise = false;\r\n    create: ChartTypes['create'];\r\n    _Theme: ChartTypes['_Theme'];\r\n    _Scene: ChartTypes['_Scene'];\r\n    _Util: ChartTypes['_Util'];\r\n\r\n    constructor(params: IntegratedModule) {\r\n        super();\r\n        this.create = params.create as any;\r\n        this._Theme = params._Theme as any;\r\n        this._Scene = params._Scene as any;\r\n        this.isEnterprise = params.isEnterprise as any;\r\n        this._Util = params._Util as any;\r\n    }\r\n}\r\n", "import type { BeanName, NamedBean } from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\nimport { HistogramChartProxy } from './cartesian/histogramChartProxy';\r\nimport { WaterfallChartProxy } from './cartesian/waterfallChartProxy';\r\nimport type { ChartProxy, ChartProxyParams } from './chartProxy';\r\nimport { HierarchicalChartProxy } from './hierarchical/hierarchicalChartProxy';\r\nimport { PolarChartProxy } from './polar/polarChartProxy';\r\nimport { HeatmapChartProxy } from './specialized/heatmapChartProxy';\r\nimport { BoxPlotChartProxy } from './statistical/boxPlotChartProxy';\r\nimport { RangeChartProxy } from './statistical/rangeChartProxy';\r\n\r\nexport class EnterpriseChartProxyFactory extends BeanStub implements NamedBean {\r\n    beanName: BeanName = 'enterpriseChartProxyFactory';\r\n\r\n    public createChartProxy(chartProxyParams: ChartProxyParams): ChartProxy | undefined {\r\n        switch (chartProxyParams.chartType) {\r\n            case 'histogram':\r\n                return new HistogramChartProxy(chartProxyParams);\r\n            case 'radarLine':\r\n            case 'radarArea':\r\n            case 'nightingale':\r\n            case 'radialColumn':\r\n            case 'radialBar':\r\n                return new PolarChartProxy(chartProxyParams);\r\n            case 'rangeBar':\r\n            case 'rangeArea':\r\n                return new RangeChartProxy(chartProxyParams);\r\n            case 'boxPlot':\r\n                return new BoxPlotChartProxy(chartProxyParams);\r\n            case 'treemap':\r\n            case 'sunburst':\r\n                return new HierarchicalChartProxy(chartProxyParams);\r\n            case 'heatmap':\r\n                return new HeatmapChartProxy(chartProxyParams);\r\n            case 'waterfall':\r\n                return new WaterfallChartProxy(chartProxyParams);\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n", "import type {\r\n    AgCartesianAxisType,\r\n    AgChartCaptionOptions,\r\n    AgChartInstance,\r\n    AgChartInstanceOptions,\r\n    AgPolarAxisOptions,\r\n} from 'ag-charts-types';\r\n\r\nexport function deproxy(chartOrProxy: AgChartInstance<AgChartInstanceOptions>): AgChartActual {\r\n    if ((chartOrProxy as any).chart != null) {\r\n        return (chartOrProxy as any).chart;\r\n    }\r\n    return chartOrProxy as AgChartActual;\r\n}\r\n\r\n// Extensions to the public ag-charts-community API that Integrated Charts currently depends on for\r\n// correct operation. Over time we aim to eliminate these and only use the public API.\r\n//\r\n// AVOID ADDING MORE DEPENDENCIES ON THESE PRIVATE APIS.\r\n\r\nexport interface AgChartActual extends AgChartInstance {\r\n    title?: AgChartCaptionOptions;\r\n    width: number;\r\n    height: number;\r\n    series: {\r\n        id: string;\r\n        type: string;\r\n        toggleSeriesItem(enabled?: boolean, legendType?: string, itemId?: string, legendItemName?: string): void;\r\n        properties: {\r\n            [key: string]: any;\r\n            toJson(): any;\r\n        };\r\n    }[];\r\n    axes?: {\r\n        type: AgCartesianAxisType | AgPolarAxisOptions['type'];\r\n        direction: 'x' | 'y';\r\n    }[];\r\n    canvasElement: HTMLCanvasElement;\r\n    getCanvasDataURL(type?: string): string;\r\n    addEventListener(type: 'click', cb: (even: any) => void): void;\r\n    waitForUpdate(): Promise<void>;\r\n}\r\n\r\nexport type AgChartAxis = NonNullable<AgChartActual['axes']>[number];\r\nexport type AgChartAxisType = AgChartAxis['type'];\r\n", "export function get(source: any, expression: string, defaultValue: any): any {\r\n    if (source == null) {\r\n        return defaultValue;\r\n    }\r\n\r\n    const keys = expression.split('.');\r\n    let objectToRead = source;\r\n\r\n    while (keys.length > 1) {\r\n        objectToRead = objectToRead[keys.shift()!];\r\n\r\n        if (objectToRead == null) {\r\n            return defaultValue;\r\n        }\r\n    }\r\n\r\n    const value = objectToRead[keys[0]];\r\n\r\n    return value != null ? value : defaultValue;\r\n}\r\n\r\nexport function set(target: any, expression: string, value: any) {\r\n    if (target == null) {\r\n        return;\r\n    }\r\n\r\n    const keys = expression.split('.');\r\n\r\n    let objectToUpdate = target;\r\n    // Create empty objects\r\n    keys.forEach((key, i) => {\r\n        if (!objectToUpdate[key]) {\r\n            objectToUpdate[key] = {};\r\n        }\r\n\r\n        if (i < keys.length - 1) {\r\n            objectToUpdate = objectToUpdate[key];\r\n        }\r\n    });\r\n\r\n    objectToUpdate[keys[keys.length - 1]] = value;\r\n}\r\n", "import type { AgChartThemeOverrides } from 'ag-charts-types';\r\n\r\nimport type { ChartType, ChartTypeExCombo, ComboChartType, SeriesGroupType } from 'ag-grid-community';\r\n\r\nimport type { ChartTranslationKey } from '../services/chartTranslationService';\r\n\r\nconst CHART_TYPE_TO_SERIES_TYPE: Record<ChartTypeExCombo, string> = {\r\n    column: 'bar',\r\n    groupedColumn: 'bar',\r\n    stackedColumn: 'bar',\r\n    normalizedColumn: 'bar',\r\n    bar: 'bar',\r\n    groupedBar: 'bar',\r\n    stackedBar: 'bar',\r\n    normalizedBar: 'bar',\r\n    line: 'line',\r\n    stackedLine: 'line',\r\n    normalizedLine: 'line',\r\n    scatter: 'scatter',\r\n    bubble: 'bubble',\r\n    pie: 'pie',\r\n    donut: 'donut',\r\n    doughnut: 'donut',\r\n    area: 'area',\r\n    stackedArea: 'area',\r\n    normalizedArea: 'area',\r\n    histogram: 'histogram',\r\n    radarLine: 'radar-line',\r\n    radarArea: 'radar-area',\r\n    nightingale: 'nightingale',\r\n    radialColumn: 'radial-column',\r\n    radialBar: 'radial-bar',\r\n    sunburst: 'sunburst',\r\n    rangeBar: 'range-bar',\r\n    rangeArea: 'range-area',\r\n    boxPlot: 'box-plot',\r\n    treemap: 'treemap',\r\n    heatmap: 'heatmap',\r\n    waterfall: 'waterfall',\r\n} as const;\r\n\r\nconst COMBO_CHART_TYPES: Set<ComboChartType> = new Set(['columnLineCombo', 'areaColumnCombo', 'customCombo']);\r\n\r\nexport const SERIES_GROUP_TYPES: SeriesGroupType[] = ['grouped', 'stacked', 'normalized'];\r\n\r\nexport type ChartSeriesType = (typeof CHART_TYPE_TO_SERIES_TYPE)[keyof typeof CHART_TYPE_TO_SERIES_TYPE] &\r\n    keyof AgChartThemeOverrides;\r\n\r\n// these values correspond to top level object names in `AgChartThemeOverrides`\r\nexport type ChartThemeOverridesSeriesType = keyof AgChartThemeOverrides & (ChartSeriesType | 'common');\r\n\r\ninterface SeriesParams {\r\n    isCartesian?: boolean;\r\n    isPolar?: boolean;\r\n    isEnterprise?: boolean;\r\n    isRadial?: boolean;\r\n    isHierarchical?: boolean;\r\n    isPie?: boolean;\r\n    canInvert?: boolean;\r\n    canSwitchDirection?: boolean;\r\n}\r\n\r\ntype SeriesTypeParams = Partial<{ [key in ChartSeriesType]: SeriesParams }>;\r\n\r\nconst SERIES_TYPES: SeriesTypeParams = {\r\n    area: {\r\n        isCartesian: true,\r\n        canInvert: true,\r\n    },\r\n    bar: {\r\n        isCartesian: true,\r\n        canInvert: true,\r\n    },\r\n    histogram: {\r\n        isCartesian: true,\r\n    },\r\n    line: {\r\n        isCartesian: true,\r\n        canInvert: true,\r\n    },\r\n    pie: {\r\n        isPie: true,\r\n    },\r\n    donut: {\r\n        isPie: true,\r\n        canInvert: true,\r\n    },\r\n    scatter: {\r\n        isCartesian: true,\r\n    },\r\n    bubble: {\r\n        isCartesian: true,\r\n    },\r\n    'radial-column': {\r\n        isPolar: true,\r\n        isEnterprise: true,\r\n        isRadial: true,\r\n        canInvert: true,\r\n    },\r\n    'radial-bar': {\r\n        isPolar: true,\r\n        isEnterprise: true,\r\n        isRadial: true,\r\n        canInvert: true,\r\n    },\r\n    'radar-line': {\r\n        isPolar: true,\r\n        isEnterprise: true,\r\n        canInvert: true,\r\n    },\r\n    'radar-area': {\r\n        isPolar: true,\r\n        isEnterprise: true,\r\n        canInvert: true,\r\n    },\r\n    nightingale: {\r\n        isPolar: true,\r\n        isEnterprise: true,\r\n        canInvert: true,\r\n    },\r\n    'range-bar': {\r\n        isCartesian: true,\r\n        isEnterprise: true,\r\n        canSwitchDirection: true,\r\n    },\r\n    'range-area': {\r\n        isCartesian: true,\r\n        isEnterprise: true,\r\n    },\r\n    'box-plot': {\r\n        isCartesian: true,\r\n        isEnterprise: true,\r\n        canSwitchDirection: true,\r\n    },\r\n    treemap: {\r\n        isEnterprise: true,\r\n        isHierarchical: true,\r\n    },\r\n    sunburst: {\r\n        isEnterprise: true,\r\n        isHierarchical: true,\r\n    },\r\n    heatmap: {\r\n        isCartesian: true,\r\n        isEnterprise: true,\r\n    },\r\n    waterfall: {\r\n        isCartesian: true,\r\n        isEnterprise: true,\r\n        canSwitchDirection: true,\r\n    },\r\n};\r\n\r\nexport function isSeriesType(seriesType: ChartSeriesType): boolean {\r\n    return !!SERIES_TYPES[seriesType];\r\n}\r\n\r\nexport function isComboChart(chartType: ChartType): boolean {\r\n    return COMBO_CHART_TYPES.has(chartType as ComboChartType);\r\n}\r\n\r\nfunction doesSeriesHaveProperty(seriesType: ChartSeriesType, prop: keyof SeriesParams): boolean {\r\n    return !!SERIES_TYPES[seriesType]?.[prop];\r\n}\r\n\r\nexport function isEnterpriseChartType(chartType: ChartType): boolean {\r\n    return doesSeriesHaveProperty(getSeriesType(chartType), 'isEnterprise');\r\n}\r\n\r\nconst stackedChartTypes = new Set(['stackedColumn', 'normalizedColumn', 'stackedBar', 'normalizedBar']);\r\nexport function isStacked(chartType: ChartType): boolean {\r\n    return stackedChartTypes.has(chartType);\r\n}\r\n\r\nexport function isCartesian(seriesType: ChartSeriesType): boolean {\r\n    return doesSeriesHaveProperty(seriesType, 'isCartesian');\r\n}\r\n\r\nexport function isPolar(seriesType: ChartSeriesType): boolean {\r\n    return doesSeriesHaveProperty(seriesType, 'isPolar');\r\n}\r\n\r\nexport function isRadial(seriesType: ChartSeriesType): boolean {\r\n    return doesSeriesHaveProperty(seriesType, 'isRadial');\r\n}\r\n\r\nexport function isHierarchical(seriesType: ChartSeriesType): boolean {\r\n    return doesSeriesHaveProperty(seriesType, 'isHierarchical');\r\n}\r\n\r\nexport function getCanonicalChartType(chartType: ChartType): Exclude<ChartType, 'doughnut'> {\r\n    return chartType === 'doughnut' ? 'donut' : chartType;\r\n}\r\n\r\nexport function getSeriesTypeIfExists(chartType: ChartType): ChartSeriesType | undefined {\r\n    return CHART_TYPE_TO_SERIES_TYPE[chartType as ChartTypeExCombo] as ChartSeriesType | undefined;\r\n}\r\n\r\nexport function getSeriesType(chartType: ChartType): ChartSeriesType {\r\n    return getSeriesTypeIfExists(chartType) ?? 'line';\r\n}\r\n\r\nexport function isPieChartSeries(seriesType: ChartSeriesType): boolean {\r\n    return doesSeriesHaveProperty(seriesType, 'isPie');\r\n}\r\n\r\nfunction canOnlyHaveSingleSeries(chartType: ChartType): boolean {\r\n    return chartType === 'pie' || chartType === 'waterfall' || chartType === 'histogram';\r\n}\r\n\r\nexport function getMaxNumCategories(chartType: ChartType): number | undefined {\r\n    return isHierarchical(getSeriesType(chartType)) ? undefined : 1;\r\n}\r\n\r\nexport function getMaxNumSeries(chartType: ChartType): number | undefined {\r\n    if (isHierarchical(getSeriesType(chartType))) {\r\n        return 2;\r\n    } else if (canOnlyHaveSingleSeries(chartType)) {\r\n        return 1;\r\n    } else {\r\n        return undefined;\r\n    }\r\n}\r\n\r\nexport function supportsInvertedCategorySeries(chartType: ChartType): boolean {\r\n    return !isComboChart(chartType) && doesSeriesHaveProperty(getSeriesType(chartType), 'canInvert');\r\n}\r\n\r\nexport function canSwitchDirection(chartType: ChartType): boolean {\r\n    return doesSeriesHaveProperty(getSeriesType(chartType), 'canSwitchDirection');\r\n}\r\n\r\nexport function getFullChartNameTranslationKey(chartType: ChartType): ChartTranslationKey {\r\n    switch (chartType) {\r\n        case 'groupedColumn':\r\n        case 'stackedColumn':\r\n        case 'normalizedColumn':\r\n        case 'groupedBar':\r\n        case 'stackedBar':\r\n        case 'normalizedBar':\r\n        case 'stackedLine':\r\n        case 'normalizedLine':\r\n        case 'stackedArea':\r\n        case 'normalizedArea':\r\n            return `${chartType}Full`;\r\n        case 'doughnut':\r\n            return 'donut';\r\n        case 'areaColumnCombo':\r\n            return 'AreaColumnCombo';\r\n        default:\r\n            return chartType;\r\n    }\r\n}\r\n", "import type { AgChartTheme, AgChartThemeName, AgChartThemeOverrides, AgChartThemePalette } from 'ag-charts-types';\r\n\r\nimport { _warn } from 'ag-grid-community';\r\n\r\nimport { ALL_AXIS_TYPES } from '../utils/axisTypeMapper';\r\nimport { get } from '../utils/object';\r\nimport type { ChartSeriesType } from '../utils/seriesTypeMapper';\r\nimport { getSeriesType } from '../utils/seriesTypeMapper';\r\nimport type { ChartProxy, ChartProxyParams } from './chartProxy';\r\n\r\nexport function createAgChartTheme(\r\n    chartProxyParams: ChartProxyParams,\r\n    proxy: ChartProxy,\r\n    isEnterprise: boolean,\r\n    chartThemeDefaults?: AgChartThemeOverrides,\r\n    updatedOverrides?: AgChartThemeOverrides\r\n): AgChartTheme {\r\n    const { chartOptionsToRestore, chartPaletteToRestore, chartThemeToRestore, agChartsExports } = chartProxyParams;\r\n    const themeName = getSelectedTheme(chartProxyParams);\r\n    const stockTheme = isStockTheme(themeName, agChartsExports._Theme);\r\n\r\n    const rootTheme = stockTheme\r\n        ? { baseTheme: themeName as AgChartThemeName }\r\n        : lookupCustomChartTheme(chartProxyParams, themeName) ?? {};\r\n\r\n    const gridOptionsThemeOverrides = chartProxyParams.getGridOptionsChartThemeOverrides();\r\n    const apiThemeOverrides = chartProxyParams.apiChartThemeOverrides;\r\n\r\n    const standaloneChartType = getSeriesType(chartProxyParams.chartType);\r\n    const crossFilteringOverrides = chartProxyParams.crossFiltering\r\n        ? createCrossFilterThemeOverrides(proxy, chartProxyParams, standaloneChartType)\r\n        : undefined;\r\n\r\n    const isTitleEnabled = () => {\r\n        const isTitleEnabled = (obj: any) => {\r\n            if (!obj) {\r\n                return false;\r\n            }\r\n            return Object.keys(obj).some((key) => get(obj[key], 'title.enabled', false));\r\n        };\r\n        return isTitleEnabled(gridOptionsThemeOverrides) || isTitleEnabled(apiThemeOverrides);\r\n    };\r\n\r\n    // Overrides in ascending precedence ordering.\r\n    const overrides: (AgChartThemeOverrides | undefined)[] = [\r\n        stockTheme ? inbuiltStockThemeOverrides(chartProxyParams, isEnterprise, isTitleEnabled()) : undefined,\r\n        pieAndDonutOverrides(),\r\n        chartThemeDefaults,\r\n        crossFilteringOverrides,\r\n        gridOptionsThemeOverrides,\r\n        apiThemeOverrides,\r\n        { ...(chartOptionsToRestore ?? {}) },\r\n        updatedOverrides,\r\n    ];\r\n\r\n    // Recursively nest theme overrides so they are applied with correct precedence in\r\n    // Standalone Charts - this is an undocumented feature.\r\n    // Outermost theme overrides will be the formatting panel configured values, so they are\r\n    // differentiated from grid-config and inbuilt overrides.\r\n    const theme = overrides\r\n        .filter((v): v is AgChartThemeOverrides => !!v)\r\n        .reduce(\r\n            (r, n): AgChartTheme => ({\r\n                baseTheme: r as any,\r\n                overrides: n,\r\n            }),\r\n            rootTheme\r\n        );\r\n\r\n    // Avoid explicitly setting the `theme.palette` property unless we're using the restored theme\r\n    // AND the palette is actually different.\r\n    if (chartPaletteToRestore && themeName === chartThemeToRestore) {\r\n        const rootThemePalette = chartProxyParams.agChartsExports._Theme.getChartTheme(rootTheme).palette;\r\n        if (!isIdenticalPalette(chartPaletteToRestore, rootThemePalette)) {\r\n            theme.palette = chartPaletteToRestore;\r\n        }\r\n    }\r\n\r\n    return theme;\r\n}\r\n\r\nfunction isIdenticalPalette(paletteA: AgChartThemePalette, paletteB: AgChartThemePalette) {\r\n    const arrayCompare = (arrA?: any[], arrB?: any[]) => {\r\n        if (arrA === arrB) return true;\r\n        if (arrA?.length !== arrB?.length) return false;\r\n\r\n        return arrA?.every((v: any, i) => v === arrB?.[i]) ?? false;\r\n    };\r\n\r\n    return arrayCompare(paletteA.fills, paletteB.fills) && arrayCompare(paletteA.strokes, paletteB.strokes);\r\n}\r\n\r\nexport function isStockTheme(themeName: string, theme: { themes: Record<string, unknown> }): boolean {\r\n    return Object.keys(theme.themes).includes(themeName);\r\n}\r\n\r\nfunction createCrossFilterThemeOverrides(\r\n    proxy: ChartProxy,\r\n    chartProxyParams: ChartProxyParams,\r\n    seriesType: ChartSeriesType\r\n): AgChartThemeOverrides {\r\n    const legend = {\r\n        listeners: {\r\n            legendItemClick: (e: any) => {\r\n                const chart = proxy.getChart();\r\n                const eligibleSeriesIds = [e.seriesId, `${e.seriesId}-filtered-out`];\r\n                chart.series\r\n                    .filter((s) => eligibleSeriesIds.includes(s.id))\r\n                    .forEach((s) => s.toggleSeriesItem(undefined, 'category', e.itemId, undefined));\r\n            },\r\n        },\r\n    };\r\n\r\n    return {\r\n        [seriesType]: {\r\n            tooltip: {\r\n                delay: 500,\r\n            },\r\n            legend,\r\n            listeners: {\r\n                click: (e: any) => chartProxyParams.crossFilterCallback(e, true),\r\n            },\r\n        },\r\n    };\r\n}\r\n\r\nconst STATIC_INBUILT_STOCK_THEME_AXES_OVERRIDES = ALL_AXIS_TYPES.reduce(\r\n    (r, n) => ({ ...r, [n]: { title: { _enabledFromTheme: true } } }),\r\n    {}\r\n);\r\n\r\nfunction inbuiltStockThemeOverrides(params: ChartProxyParams, isEnterprise: boolean, titleEnabled: boolean) {\r\n    const extraPadding = params.getExtraPaddingDirections();\r\n    return {\r\n        common: {\r\n            ...(isEnterprise ? { animation: { duration: 500 } } : undefined),\r\n            axes: STATIC_INBUILT_STOCK_THEME_AXES_OVERRIDES,\r\n            padding: {\r\n                // don't add extra padding when a title is present!\r\n                top: !titleEnabled && extraPadding.includes('top') ? 40 : 20,\r\n                right: extraPadding.includes('right') ? 30 : 20,\r\n                bottom: extraPadding.includes('bottom') ? 40 : 20,\r\n                left: extraPadding.includes('left') ? 30 : 20,\r\n            },\r\n            suppressFieldDotNotation: true,\r\n        },\r\n    };\r\n}\r\n\r\nfunction pieAndDonutOverrides() {\r\n    return {\r\n        pie: {\r\n            series: {\r\n                title: { _enabledFromTheme: true },\r\n                calloutLabel: { _enabledFromTheme: true },\r\n                sectorLabel: {\r\n                    enabled: false,\r\n                    _enabledFromTheme: true,\r\n                },\r\n            } as any,\r\n        },\r\n        donut: {\r\n            series: {\r\n                title: { _enabledFromTheme: true },\r\n                calloutLabel: { _enabledFromTheme: true },\r\n                sectorLabel: {\r\n                    enabled: false,\r\n                    _enabledFromTheme: true,\r\n                },\r\n            } as any,\r\n        },\r\n    };\r\n}\r\n\r\nfunction getSelectedTheme(chartProxyParams: ChartProxyParams): string {\r\n    let chartThemeName = chartProxyParams.getChartThemeName();\r\n    const availableThemes = chartProxyParams.getChartThemes();\r\n\r\n    if (!availableThemes.includes(chartThemeName)) {\r\n        chartThemeName = availableThemes[0];\r\n    }\r\n\r\n    return chartThemeName;\r\n}\r\n\r\nexport function lookupCustomChartTheme(chartProxyParams: ChartProxyParams, name: string): AgChartTheme {\r\n    const { customChartThemes } = chartProxyParams;\r\n    const customChartTheme = customChartThemes && customChartThemes[name];\r\n\r\n    if (!customChartTheme) {\r\n        _warn(140, { name });\r\n    }\r\n\r\n    return customChartTheme as AgChartTheme;\r\n}\r\n", "import type { AgCartesianAxisType } from 'ag-charts-types';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nexport const ALL_AXIS_TYPES: AgCartesianAxisType[] = ['number', 'category', 'grouped-category', 'log', 'time'];\r\n\r\nexport function getLegacyAxisType(chartType: ChartType): [AgCartesianAxisType, AgCartesianAxisType] | undefined {\r\n    switch (chartType) {\r\n        case 'bar':\r\n        case 'stackedBar':\r\n        case 'normalizedBar':\r\n            return ['number', 'category'];\r\n        case 'groupedBar':\r\n            return ['number', 'grouped-category'];\r\n        case 'column':\r\n        case 'stackedColumn':\r\n        case 'normalizedColumn':\r\n        case 'line':\r\n        case 'stackedLine':\r\n        case 'normalizedLine':\r\n        case 'area':\r\n        case 'stackedArea':\r\n        case 'normalizedArea':\r\n        case 'histogram':\r\n            return ['category', 'number'];\r\n        case 'groupedColumn':\r\n            return ['grouped-category', 'number'];\r\n        case 'scatter':\r\n        case 'bubble':\r\n            return ['number', 'number'];\r\n        default:\r\n            return undefined;\r\n    }\r\n}\r\n", "import type {\r\n    AgChartInstance,\r\n    AgChartInstanceOptions,\r\n    AgChartOptions,\r\n    AgChartTheme,\r\n    AgChartThemeOverrides,\r\n    AgChartThemePalette,\r\n    AgCommonThemeableChartOptions,\r\n    AgCrosshairOptions,\r\n} from 'ag-charts-types';\r\n\r\nimport type { ChartType, SeriesChartType, SeriesGroupType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../agChartsExports';\r\nimport type { CrossFilteringContext } from '../../chartService';\r\nimport { deproxy } from '../utils/integration';\r\nimport { get } from '../utils/object';\r\nimport type { ChartSeriesType } from '../utils/seriesTypeMapper';\r\nimport { getSeriesType } from '../utils/seriesTypeMapper';\r\nimport { createAgChartTheme, lookupCustomChartTheme } from './chartTheme';\r\n\r\nexport interface ChartProxyParams {\r\n    agChartsExports: AgChartsExports;\r\n    chartInstance?: AgChartInstance<AgChartInstanceOptions>;\r\n    chartType: ChartType;\r\n    customChartThemes?: { [name: string]: AgChartTheme };\r\n    parentElement: HTMLElement;\r\n    grouping: boolean;\r\n    getChartThemeName: () => string;\r\n    getChartThemes: () => string[];\r\n    getGridOptionsChartThemeOverrides: () => AgChartThemeOverrides | undefined;\r\n    getExtraPaddingDirections: () => ExtraPaddingDirection[];\r\n    apiChartThemeOverrides?: AgChartThemeOverrides;\r\n    crossFiltering: boolean;\r\n    crossFilterCallback: (event: any, reset?: boolean) => void;\r\n    chartThemeToRestore?: string;\r\n    chartOptionsToRestore?: AgChartThemeOverrides;\r\n    chartPaletteToRestore?: AgChartThemePalette;\r\n    seriesChartTypes: SeriesChartType[];\r\n    translate: (toTranslate: string, defaultText?: string) => string;\r\n}\r\n\r\nexport type ExtraPaddingDirection = 'top' | 'right' | 'bottom' | 'left';\r\n\r\nexport interface FieldDefinition {\r\n    colId: string;\r\n    displayName: string | null;\r\n}\r\n\r\nexport interface UpdateParams {\r\n    data: any[];\r\n    groupData?: any[];\r\n    grouping: boolean;\r\n    categories: {\r\n        id: string;\r\n        name: string;\r\n        chartDataType?: string;\r\n    }[];\r\n    fields: FieldDefinition[];\r\n    chartId?: string;\r\n    getCrossFilteringContext: () => CrossFilteringContext;\r\n    seriesChartTypes: SeriesChartType[];\r\n    updatedOverrides?: AgChartThemeOverrides;\r\n    seriesGroupType?: SeriesGroupType;\r\n}\r\n\r\nexport abstract class ChartProxy<\r\n    TOptions extends AgChartOptions = AgChartOptions,\r\n    TSeries extends ChartSeriesType = ChartSeriesType,\r\n> {\r\n    protected readonly agChartsExports: AgChartsExports;\r\n    protected readonly chartType: ChartType;\r\n    protected readonly standaloneChartType: TSeries;\r\n\r\n    protected readonly chart: AgChartInstance<AgChartInstanceOptions>;\r\n    protected readonly crossFiltering: boolean;\r\n    protected readonly crossFilterCallback: (event: any, reset?: boolean) => void;\r\n\r\n    protected clearThemeOverrides = false;\r\n\r\n    protected constructor(protected readonly chartProxyParams: ChartProxyParams) {\r\n        this.agChartsExports = chartProxyParams.agChartsExports;\r\n        this.chart = chartProxyParams.chartInstance!;\r\n        this.chartType = chartProxyParams.chartType;\r\n        this.crossFiltering = chartProxyParams.crossFiltering;\r\n        this.crossFilterCallback = chartProxyParams.crossFilterCallback;\r\n        this.standaloneChartType = getSeriesType(this.chartType) as TSeries;\r\n\r\n        if (this.chart == null) {\r\n            this.chart = chartProxyParams.agChartsExports.create(this.getCommonChartOptions());\r\n        } else {\r\n            // On chart change, reset formatting panel changes.\r\n            this.clearThemeOverrides = true;\r\n        }\r\n    }\r\n\r\n    protected abstract getUpdateOptions(params: UpdateParams, commonChartOptions: TOptions): TOptions;\r\n\r\n    public crossFilteringReset(): void {\r\n        // only required in cartesian charts\r\n    }\r\n\r\n    public update(params: UpdateParams): void {\r\n        this.getChartRef().update(this.getUpdateOptions(params, this.getCommonChartOptions(params.updatedOverrides)));\r\n    }\r\n\r\n    public updateThemeOverrides(themeOverrides: AgChartThemeOverrides): void {\r\n        this.getChartRef().updateDelta({ theme: { overrides: themeOverrides } });\r\n    }\r\n\r\n    public getChart() {\r\n        return deproxy(this.chart);\r\n    }\r\n\r\n    public getChartRef() {\r\n        return this.chart;\r\n    }\r\n\r\n    public downloadChart(dimensions?: { width: number; height: number }, fileName?: string, fileFormat?: string) {\r\n        const { chart } = this;\r\n        const rawChart = deproxy(chart);\r\n        const imageFileName = fileName || (rawChart.title ? rawChart.title.text : 'chart');\r\n        const { width, height } = dimensions || {};\r\n\r\n        chart.download({ width, height, fileName: imageFileName, fileFormat });\r\n    }\r\n\r\n    public getChartImageDataURL(type?: string) {\r\n        return this.getChart().getCanvasDataURL(type);\r\n    }\r\n\r\n    private getChartOptions(): AgChartInstanceOptions {\r\n        return this.chart.getOptions();\r\n    }\r\n\r\n    public getChartThemeOverrides(): AgChartThemeOverrides {\r\n        const chartOptionsTheme = this.getChartOptions().theme as AgChartTheme;\r\n        return chartOptionsTheme.overrides ?? {};\r\n    }\r\n\r\n    public getChartPalette(): AgChartThemePalette | undefined {\r\n        return this.agChartsExports._Theme.getChartTheme(this.getChartOptions().theme).palette;\r\n    }\r\n\r\n    public setPaired(paired: boolean) {\r\n        // Special handling to make scatter charts operate in paired mode by default, where\r\n        // columns alternate between being X and Y (and size for bubble). In standard mode,\r\n        // the first column is used for X and every other column is treated as Y\r\n        // (or alternates between Y and size for bubble)\r\n        const seriesType = getSeriesType(this.chartProxyParams.chartType);\r\n        this.chart.updateDelta({ theme: { overrides: { [seriesType]: { paired } } } });\r\n    }\r\n\r\n    public isPaired(): boolean {\r\n        const seriesType = getSeriesType(this.chartProxyParams.chartType);\r\n        return get(this.getChartThemeOverrides(), `${seriesType}.paired`, true);\r\n    }\r\n\r\n    public lookupCustomChartTheme(themeName: string) {\r\n        return lookupCustomChartTheme(this.chartProxyParams, themeName);\r\n    }\r\n\r\n    public getSeriesGroupType(): SeriesGroupType | undefined {\r\n        return undefined;\r\n    }\r\n\r\n    protected transformCategoryData(data: any[], categoryKey: string): any[] {\r\n        // replace the values for the selected category with a complex object to allow for duplicated categories\r\n        return data.map((d, index) => {\r\n            const value = d[categoryKey];\r\n            const valueString = value && value.toString ? value.toString() : '';\r\n            const datum = { ...d };\r\n\r\n            datum[categoryKey] = { id: index, value, toString: () => valueString };\r\n\r\n            return datum;\r\n        });\r\n    }\r\n\r\n    private getCommonChartOptions(updatedOverrides?: AgChartThemeOverrides): TOptions & { mode: 'integrated' } {\r\n        // Only apply active overrides if chart is initialised.\r\n        const existingOptions = (this.clearThemeOverrides ? {} : this.chart?.getOptions() ?? {}) as TOptions;\r\n        const formattingPanelOverrides = this.chart != null ? this.getActiveFormattingPanelOverrides() : undefined;\r\n        this.clearThemeOverrides = false;\r\n\r\n        const theme = createAgChartTheme(\r\n            this.chartProxyParams,\r\n            this,\r\n            this.agChartsExports.isEnterprise,\r\n            this.getChartThemeDefaults(),\r\n            updatedOverrides ?? formattingPanelOverrides\r\n        );\r\n\r\n        const newOptions = {\r\n            ...existingOptions,\r\n            mode: 'integrated',\r\n        } as const;\r\n        newOptions.theme = theme;\r\n        newOptions.container = this.chartProxyParams.parentElement;\r\n        return newOptions;\r\n    }\r\n\r\n    private getChartThemeDefaults(): AgChartThemeOverrides | undefined {\r\n        const seriesOverrides = this.getSeriesChartThemeDefaults();\r\n        const seriesChartOptions = seriesOverrides\r\n            ? {\r\n                  [this.standaloneChartType]: seriesOverrides,\r\n              }\r\n            : {};\r\n        const crosshair: AgCrosshairOptions = {\r\n            enabled: true,\r\n            snap: true,\r\n            label: {\r\n                enabled: false,\r\n            },\r\n        };\r\n        const common: AgCommonThemeableChartOptions = this.agChartsExports.isEnterprise\r\n            ? {\r\n                  zoom: {\r\n                      enabled: true,\r\n                  },\r\n                  animation: {\r\n                      enabled: true,\r\n                      duration: 500,\r\n                  },\r\n                  axes: {\r\n                      number: { crosshair },\r\n                      category: { crosshair },\r\n                      log: { crosshair },\r\n                      time: { crosshair },\r\n                  },\r\n              }\r\n            : {};\r\n        common.minHeight = 0;\r\n        common.minWidth = 0;\r\n        common.navigator = {\r\n            enabled: false,\r\n        };\r\n        return {\r\n            common,\r\n            ...seriesChartOptions,\r\n        };\r\n    }\r\n\r\n    protected getSeriesChartThemeDefaults(): AgChartThemeOverrides[TSeries] {\r\n        return undefined;\r\n    }\r\n\r\n    private getActiveFormattingPanelOverrides(): AgChartThemeOverrides {\r\n        if (this.clearThemeOverrides) {\r\n            return {};\r\n        }\r\n\r\n        const inUseTheme = this.chart?.getOptions().theme as AgChartTheme;\r\n        return inUseTheme?.overrides ?? {};\r\n    }\r\n\r\n    public destroy({ keepChartInstance = false } = {}): AgChartInstance<AgChartInstanceOptions> | undefined {\r\n        if (keepChartInstance) {\r\n            // Reset Charts animation state, so that future updates to this re-used chart instance\r\n            // behave as-if the chart is brand new. When switching chartTypes, this means we hide\r\n            // the fact we are reusing the chart instance; the user sees a new chart which behaves\r\n            // as-if it is a completely new and distinct chart instance.\r\n            this.chart.resetAnimations();\r\n            return this.chart;\r\n        }\r\n\r\n        this.destroyChart();\r\n    }\r\n\r\n    protected destroyChart(): void {\r\n        if (this.chart) {\r\n            this.chart.destroy();\r\n            (this.chart as any) = undefined;\r\n        }\r\n    }\r\n}\r\n", "import type {\r\n    AgAreaSeriesOptions,\r\n    AgCartesianAxisOptions,\r\n    AgCartesianAxisType,\r\n    AgCartesianChartOptions,\r\n    AgCartesianSeriesOptions,\r\n    AgChartTheme,\r\n    AgChartThemeName,\r\n    AgLineSeriesOptions,\r\n    AgRangeBarSeriesThemeableOptions,\r\n} from 'ag-charts-types';\r\n\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { ChartProxy } from '../chartProxy';\r\n\r\nexport abstract class CartesianChartProxy<\r\n    TSeries extends\r\n        | 'area'\r\n        | 'bar'\r\n        | 'histogram'\r\n        | 'line'\r\n        | 'scatter'\r\n        | 'bubble'\r\n        | 'waterfall'\r\n        | 'box-plot'\r\n        | 'range-area'\r\n        | 'range-bar',\r\n> extends ChartProxy<AgCartesianChartOptions, TSeries> {\r\n    protected crossFilteringAllPoints = new Set<string>();\r\n    protected crossFilteringSelectedPoints: string[] = [];\r\n\r\n    protected constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected abstract getAxes(\r\n        params: UpdateParams,\r\n        commonChartOptions: AgCartesianChartOptions\r\n    ): AgCartesianAxisOptions[];\r\n    protected abstract getSeries(params: UpdateParams): AgCartesianSeriesOptions[];\r\n\r\n    protected getUpdateOptions(\r\n        params: UpdateParams,\r\n        commonChartOptions: AgCartesianChartOptions\r\n    ): AgCartesianChartOptions {\r\n        const axes = this.getAxes(params, commonChartOptions);\r\n\r\n        return {\r\n            ...commonChartOptions,\r\n            data: this.getData(params, axes),\r\n            axes,\r\n            series: this.getSeries(params),\r\n        };\r\n    }\r\n\r\n    protected getData(params: UpdateParams, axes: AgCartesianAxisOptions[]): any[] {\r\n        const supportsCrossFiltering = ['area', 'line'].includes(this.standaloneChartType);\r\n        return this.crossFiltering && supportsCrossFiltering\r\n            ? this.getCrossFilterData(params)\r\n            : this.getDataTransformedData(params, axes);\r\n    }\r\n\r\n    private getDataTransformedData(params: UpdateParams, axes: AgCartesianAxisOptions[]) {\r\n        // assumed that the first axis is always the \"category\" axis\r\n        const xAxisType = axes[0].type;\r\n        const { categories, data } = params;\r\n        const [category] = categories;\r\n        switch (xAxisType) {\r\n            case 'category':\r\n                return this.transformCategoryData(data, category.id);\r\n            case 'time':\r\n                return this.transformTimeData(data, category.id);\r\n            default:\r\n                return data;\r\n        }\r\n    }\r\n\r\n    protected getXAxisType(params: UpdateParams) {\r\n        if (params.grouping) {\r\n            return 'grouped-category';\r\n        } else if (this.isXAxisOfType(params, 'time', (value) => value instanceof Date)) {\r\n            return 'time';\r\n        } else if (this.isXAxisOfType(params, 'number')) {\r\n            return 'number';\r\n        }\r\n        return 'category';\r\n    }\r\n\r\n    private isXAxisOfType<T>(\r\n        params: UpdateParams,\r\n        type: AgCartesianAxisType,\r\n        isInstance?: (value: T) => boolean\r\n    ): boolean {\r\n        const [category] = params.categories;\r\n        if (category?.chartDataType) {\r\n            return category.chartDataType === type;\r\n        }\r\n        if (!isInstance) {\r\n            return false;\r\n        }\r\n        const testDatum = params.data[0];\r\n        if (!testDatum) {\r\n            return false;\r\n        }\r\n        return isInstance(testDatum[category.id]);\r\n    }\r\n\r\n    private transformTimeData(data: any[], categoryKey: string): any[] {\r\n        const firstValue = data[0]?.[categoryKey];\r\n        if (firstValue instanceof Date) {\r\n            return data;\r\n        }\r\n\r\n        return data.map((datum) => {\r\n            const value = datum[categoryKey];\r\n            return typeof value === 'string'\r\n                ? {\r\n                      ...datum,\r\n                      [categoryKey]: new Date(value),\r\n                  }\r\n                : datum;\r\n        });\r\n    }\r\n\r\n    public override crossFilteringReset(): void {\r\n        this.crossFilteringSelectedPoints = [];\r\n        this.crossFilteringAllPoints.clear();\r\n    }\r\n\r\n    protected crossFilteringPointSelected(point: string): boolean {\r\n        return this.crossFilteringSelectedPoints.length == 0 || this.crossFilteringSelectedPoints.includes(point);\r\n    }\r\n\r\n    protected crossFilteringDeselectedPoints(): boolean {\r\n        return (\r\n            this.crossFilteringSelectedPoints.length > 0 &&\r\n            this.crossFilteringAllPoints.size !== this.crossFilteringSelectedPoints.length\r\n        );\r\n    }\r\n\r\n    protected extractLineAreaCrossFilterSeries(\r\n        series: (AgLineSeriesOptions | AgAreaSeriesOptions)[],\r\n        params: UpdateParams\r\n    ) {\r\n        const [category] = params.categories;\r\n\r\n        const getYKey = (yKey: string) => {\r\n            if (this.standaloneChartType === 'area') {\r\n                const lastSelectedChartId = params.getCrossFilteringContext().lastSelectedChartId;\r\n                return lastSelectedChartId === params.chartId ? yKey + '-total' : yKey;\r\n            }\r\n            return yKey + '-total';\r\n        };\r\n\r\n        return series.map((s) => {\r\n            s.yKey = getYKey(s.yKey!);\r\n            s.listeners = {\r\n                nodeClick: (e: any) => {\r\n                    const value = e.datum![s.xKey!];\r\n                    const multiSelection = e.event.metaKey || e.event.ctrlKey;\r\n                    this.crossFilteringAddSelectedPoint(multiSelection, value);\r\n                    this.crossFilterCallback(e);\r\n                },\r\n            };\r\n            s.marker = {\r\n                itemStyler: (p) => {\r\n                    const value = p.datum[category.id];\r\n                    return {\r\n                        fill: p.highlighted ? 'yellow' : p.fill,\r\n                        size: p.highlighted ? 14 : this.crossFilteringPointSelected(value) ? 8 : 0,\r\n                    };\r\n                },\r\n            };\r\n            if (this.standaloneChartType === 'area') {\r\n                (s as AgAreaSeriesOptions).fillOpacity = this.crossFilteringDeselectedPoints() ? 0.3 : 1;\r\n            }\r\n            if (this.standaloneChartType === 'line') {\r\n                (s as AgLineSeriesOptions).strokeOpacity = this.crossFilteringDeselectedPoints() ? 0.3 : 1;\r\n            }\r\n\r\n            return s;\r\n        });\r\n    }\r\n\r\n    private getCrossFilterData(params: UpdateParams): any[] {\r\n        this.crossFilteringAllPoints.clear();\r\n        const [category] = params.categories;\r\n        const colId = params.fields[0].colId;\r\n        const filteredOutColId = `${colId}-filtered-out`;\r\n        const lastSelectedChartId = params.getCrossFilteringContext().lastSelectedChartId;\r\n\r\n        return params.data.map((d) => {\r\n            const value = d[category.id];\r\n            this.crossFilteringAllPoints.add(value);\r\n\r\n            const pointSelected = this.crossFilteringPointSelected(value);\r\n            if (this.standaloneChartType === 'area' && lastSelectedChartId === params.chartId) {\r\n                d[`${colId}-total`] = pointSelected ? d[colId] : d[colId] + d[filteredOutColId];\r\n            }\r\n            if (this.standaloneChartType === 'line') {\r\n                d[`${colId}-total`] = pointSelected ? d[colId] : d[colId] + d[filteredOutColId];\r\n            }\r\n\r\n            return d;\r\n        });\r\n    }\r\n\r\n    private crossFilteringAddSelectedPoint(multiSelection: boolean, value: string): void {\r\n        multiSelection ? this.crossFilteringSelectedPoints.push(value) : (this.crossFilteringSelectedPoints = [value]);\r\n    }\r\n\r\n    protected isHorizontal(commonChartOptions: AgCartesianChartOptions): boolean {\r\n        const seriesType = this.standaloneChartType;\r\n        if (seriesType !== 'waterfall' && seriesType !== 'box-plot' && seriesType !== 'range-bar') {\r\n            return false;\r\n        }\r\n        const theme = commonChartOptions.theme;\r\n        const isHorizontal = (theme?: AgChartTheme | AgChartThemeName): boolean => {\r\n            const direction = (\r\n                (theme as AgChartTheme)?.overrides?.[seriesType]?.series as AgRangeBarSeriesThemeableOptions\r\n            )?.direction;\r\n            if (direction != null) {\r\n                return direction === 'horizontal';\r\n            }\r\n            if (typeof (theme as AgChartTheme)?.baseTheme === 'object') {\r\n                return isHorizontal((theme as AgChartTheme).baseTheme as any);\r\n            }\r\n            return false;\r\n        };\r\n        return isHorizontal(theme);\r\n    }\r\n}\r\n", "import type { AgCartesianAxisOptions, AgHistogramSeriesOptions } from 'ag-charts-types';\r\n\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { CartesianChartProxy } from './cartesianChartProxy';\r\n\r\nexport class HistogramChartProxy extends CartesianChartProxy<'histogram'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected override getSeries(params: UpdateParams): AgHistogramSeriesOptions[] {\r\n        const firstField = params.fields[0]; // multiple series are not supported!\r\n        return [\r\n            {\r\n                type: this.standaloneChartType,\r\n                xKey: firstField.colId,\r\n                xName: firstField.displayName,\r\n                yName: this.chartProxyParams.translate('histogramFrequency'),\r\n                areaPlot: false, // only constant width is supported via integrated charts\r\n            } as AgHistogramSeriesOptions,\r\n        ];\r\n    }\r\n\r\n    protected override getAxes(_params: UpdateParams): AgCartesianAxisOptions[] {\r\n        return [\r\n            {\r\n                type: 'number',\r\n                position: 'bottom',\r\n            },\r\n            {\r\n                type: 'number',\r\n                position: 'left',\r\n            },\r\n        ];\r\n    }\r\n}\r\n", "import type { AgCartesianAxisOptions, AgCartesianChartOptions, AgWaterfallSeriesOptions } from 'ag-charts-types';\r\n\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { CartesianChartProxy } from './cartesianChartProxy';\r\n\r\nexport class WaterfallChartProxy extends CartesianChartProxy<'waterfall'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected override getAxes(\r\n        params: UpdateParams,\r\n        commonChartOptions: AgCartesianChartOptions\r\n    ): AgCartesianAxisOptions[] {\r\n        return [\r\n            {\r\n                type: this.getXAxisType(params),\r\n                position: this.isHorizontal(commonChartOptions) ? 'left' : 'bottom',\r\n            },\r\n            {\r\n                type: 'number',\r\n                position: this.isHorizontal(commonChartOptions) ? 'bottom' : 'left',\r\n            },\r\n        ];\r\n    }\r\n\r\n    protected override getSeries(params: UpdateParams): AgWaterfallSeriesOptions[] {\r\n        const [category] = params.categories;\r\n        const [firstField] = params.fields;\r\n        const firstSeries: AgWaterfallSeriesOptions = {\r\n            type: this.standaloneChartType as 'waterfall',\r\n            xKey: category.id,\r\n            xName: category.name,\r\n            yKey: firstField.colId,\r\n            yName: firstField.displayName ?? undefined,\r\n        };\r\n\r\n        return [firstSeries]; // waterfall only supports a single series!\r\n    }\r\n}\r\n", "import type { AgChartThemeOverrides, AgHierarchyChartOptions, AgHierarchySeriesOptions } from 'ag-charts-types';\r\n\r\nimport { GROUP_AUTO_COLUMN_ID } from 'ag-grid-community';\r\n\r\nimport type { ChartProxyParams, FieldDefinition, UpdateParams } from '../chartProxy';\r\nimport { ChartProxy } from '../chartProxy';\r\nimport { CATEGORY_LABEL_KEY, createAutoGroupHierarchy, createCategoryHierarchy } from './hierarchicalChartUtils';\r\n\r\nexport class HierarchicalChartProxy<TSeries extends 'sunburst' | 'treemap'> extends ChartProxy<\r\n    AgHierarchyChartOptions,\r\n    TSeries\r\n> {\r\n    constructor(chartProxyParams: ChartProxyParams) {\r\n        super(chartProxyParams);\r\n    }\r\n\r\n    protected override getUpdateOptions(\r\n        params: UpdateParams,\r\n        commonChartOptions: AgHierarchyChartOptions\r\n    ): AgHierarchyChartOptions {\r\n        const { fields } = params;\r\n        // Hierarchical charts support up to two input series, corresponding to size and color respectively\r\n        const [sizeField, colorField] = fields as [FieldDefinition | undefined, FieldDefinition | undefined];\r\n        return {\r\n            ...commonChartOptions,\r\n            series: this.getSeries(sizeField, colorField),\r\n            data: this.getData(params, sizeField, colorField),\r\n        };\r\n    }\r\n\r\n    protected override getSeriesChartThemeDefaults(): AgChartThemeOverrides['treemap' | 'sunburst'] {\r\n        return {\r\n            gradientLegend: {\r\n                gradient: {\r\n                    preferredLength: 200,\r\n                },\r\n            },\r\n        };\r\n    }\r\n\r\n    private getSeries(sizeField?: FieldDefinition, colorField?: FieldDefinition): AgHierarchySeriesOptions[] {\r\n        return [\r\n            {\r\n                type: this.standaloneChartType as AgHierarchySeriesOptions['type'],\r\n                labelKey: CATEGORY_LABEL_KEY,\r\n                // Size and color fields are inferred from the range data\r\n                sizeKey: sizeField?.colId,\r\n                sizeName: sizeField?.displayName ?? undefined,\r\n                colorKey: colorField?.colId,\r\n                colorName: colorField?.displayName ?? undefined,\r\n            },\r\n        ];\r\n    }\r\n\r\n    private getData(params: UpdateParams, sizeField?: FieldDefinition, colorField?: FieldDefinition): any[] {\r\n        const { categories, data, groupData, grouping: isGrouped } = params;\r\n        if (isGrouped) {\r\n            const processedData = colorField\r\n                ? data.concat(\r\n                      groupData?.map((groupDatum) => {\r\n                          const newDatum = { ...groupDatum };\r\n                          delete newDatum[sizeField!.colId];\r\n                          return newDatum;\r\n                      }) ?? []\r\n                  )\r\n                : data;\r\n            return createAutoGroupHierarchy(processedData, (item) => item[GROUP_AUTO_COLUMN_ID]?.labels ?? null);\r\n        } else {\r\n            const categoryKeys = categories.map(({ id }) => id);\r\n            return createCategoryHierarchy(data, categoryKeys);\r\n        }\r\n    }\r\n}\r\n", "export type CATEGORY_LABEL_KEY = 'AG-GRID-DEFAULT-LABEL-KEY';\r\nexport const CATEGORY_LABEL_KEY: CATEGORY_LABEL_KEY = 'AG-GRID-DEFAULT-LABEL-KEY';\r\n\r\nexport type CategoryItem<T extends object> = {\r\n    [CATEGORY_LABEL_KEY]: string | null;\r\n    children?: Array<CategoryItem<T>>;\r\n} & T;\r\n\r\nexport function createCategoryHierarchy<T extends object>(data: T[], categoryKeys: Array<keyof T>): CategoryItem<T>[] {\r\n    const hierarchy = buildNestedHierarchy(data, getItemDepth, getItemCategoryLabel);\r\n    return formatCategoryHierarchy(hierarchy);\r\n\r\n    function getItemDepth(_item: T) {\r\n        return categoryKeys.length;\r\n    }\r\n\r\n    function getItemCategoryLabel(item: T, categoryIndex: number): string | null {\r\n        const categoryKey = categoryKeys[categoryIndex];\r\n        const categoryValue = item[categoryKey];\r\n        return getCategoryLabel(categoryValue);\r\n    }\r\n\r\n    function getCategoryLabel(value: unknown): string | null {\r\n        if (value == null) return null;\r\n        return String(value);\r\n    }\r\n}\r\n\r\nexport function createAutoGroupHierarchy<T extends object>(\r\n    data: T[],\r\n    getItemLabels: (item: T) => string[] | null\r\n): CategoryItem<T>[] {\r\n    const hierarchy = buildNestedHierarchy(data, getItemDepth, getItemGroupLabel);\r\n    return formatCategoryHierarchy(hierarchy);\r\n\r\n    function getItemDepth(item: T) {\r\n        return getItemLabels(item)?.length ?? 0;\r\n    }\r\n\r\n    function getItemGroupLabel(item: T, groupIndex: number): string | null {\r\n        const labels = getItemLabels(item);\r\n        if (!labels) return null;\r\n        // Autogroup label values are ordered from the leaf outwards\r\n        const labelIndex = labels.length - 1 - groupIndex;\r\n        return labels[labelIndex];\r\n    }\r\n}\r\n\r\n/* Utility functions for building and formatting nested category hierarchies */\r\n\r\n/** Convert an abstract nested hierarchy structure into an ag-charts-compatible 'category-grouped' data structure */\r\nfunction formatCategoryHierarchy<T extends object>(\r\n    hierarchy: Tree<T>,\r\n    key: string | null = null,\r\n    isChild?: boolean\r\n): CategoryItem<T>[] {\r\n    const { depth, rootValues, value, children: inputChildren } = hierarchy;\r\n    if (rootValues) {\r\n        return rootValues.map((item) => ({ [CATEGORY_LABEL_KEY]: key, ...item }));\r\n    } else if (depth === 0) {\r\n        return [{ [CATEGORY_LABEL_KEY]: key, ...value! }];\r\n    }\r\n\r\n    const children: CategoryItem<T>[] = [];\r\n    for (const [childKey, childHierarchy] of inputChildren.entries()) {\r\n        children.push(...formatCategoryHierarchy(childHierarchy, childKey, true));\r\n    }\r\n\r\n    return isChild\r\n        ? [\r\n              {\r\n                  [CATEGORY_LABEL_KEY]: key,\r\n                  children,\r\n                  ...(value ?? ({} as T)),\r\n              },\r\n          ]\r\n        : children;\r\n}\r\n\r\n/** Data structure that represents an arbitrarily deeply nested tree of keyed values */\r\ntype Tree<V> = {\r\n    /** Number of child levels nested within this path of the tree (leaves do not count towards the depth) */\r\n    depth: number;\r\n    rootValues?: V[];\r\n    value?: V;\r\n    /** Child levels contained within this path of the tree, grouped by child key */\r\n    children: Map<string | null, Tree<V>>;\r\n};\r\n\r\n/** Build an arbitrarily deeply nested hierarchy from a flat list of input items */\r\nfunction buildNestedHierarchy<V extends object>(\r\n    data: V[],\r\n    getItemDepth: (item: V) => number,\r\n    getItemGroupKey: (item: V, depthIndex: number) => string | null\r\n): Tree<V> {\r\n    const hierarchy: Tree<V> = { depth: 0, children: new Map() };\r\n    data.forEach((item) => {\r\n        const itemDepth = getItemDepth(item);\r\n        createNestedItemHierarchy(item, itemDepth, getItemGroupKey, 0, hierarchy);\r\n    });\r\n    return hierarchy;\r\n\r\n    function createNestedItemHierarchy(\r\n        item: V,\r\n        itemDepth: number,\r\n        getItemGroupKey: (item: V, depthIndex: number) => string | null,\r\n        currentDepth: number,\r\n        hierarchy: Tree<V>\r\n    ): Tree<V> {\r\n        if (currentDepth === itemDepth) {\r\n            if (currentDepth === 0) {\r\n                if (!hierarchy.rootValues) {\r\n                    hierarchy.rootValues = [];\r\n                }\r\n                hierarchy.rootValues.push(item);\r\n            } else {\r\n                hierarchy.value = item;\r\n            }\r\n            return hierarchy;\r\n        } else {\r\n            const key = getItemGroupKey(item, currentDepth);\r\n            const existingChildHierarchy = hierarchy.children.get(key);\r\n            const childHierarchy = createNestedItemHierarchy(\r\n                item,\r\n                itemDepth,\r\n                getItemGroupKey,\r\n                currentDepth + 1,\r\n                existingChildHierarchy || { depth: 0, children: new Map() }\r\n            );\r\n            hierarchy.children.set(key, childHierarchy);\r\n            hierarchy.depth = Math.max(1 + childHierarchy.depth, hierarchy.depth);\r\n            return hierarchy;\r\n        }\r\n    }\r\n}\r\n", "import type {\r\n    AgPolarAxisOptions,\r\n    AgPolarChartOptions,\r\n    AgPolarSeriesOptions,\r\n    AgRadarAreaSeriesOptions,\r\n} from 'ag-charts-types';\r\n\r\nimport type { SeriesGroupType } from 'ag-grid-community';\r\n\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { ChartProxy } from '../chartProxy';\r\n\r\nexport class PolarChartProxy extends ChartProxy<\r\n    AgPolarChartOptions,\r\n    'radar-line' | 'radar-area' | 'nightingale' | 'radial-column' | 'radial-bar'\r\n> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    public getAxes(_: UpdateParams): AgPolarAxisOptions[] {\r\n        const radialBar = this.standaloneChartType === 'radial-bar';\r\n        return [\r\n            { type: radialBar ? 'angle-number' : 'angle-category' },\r\n            { type: radialBar ? 'radius-category' : 'radius-number' },\r\n        ];\r\n    }\r\n\r\n    public getSeries(params: UpdateParams): AgPolarSeriesOptions[] {\r\n        const { fields, categories, seriesGroupType } = params;\r\n        const [category] = categories;\r\n        const radialBar = this.standaloneChartType === 'radial-bar';\r\n        const seriesGroupTypeOptions = this.getSeriesGroupTypeOptions(seriesGroupType);\r\n\r\n        return fields.map((f) => ({\r\n            type: this.standaloneChartType as AgRadarAreaSeriesOptions['type'],\r\n            angleKey: radialBar ? f.colId : category.id,\r\n            angleName: radialBar ? f.displayName ?? undefined : category.name,\r\n            radiusKey: radialBar ? category.id : f.colId,\r\n            radiusName: radialBar ? category.name : f.displayName ?? undefined,\r\n            ...seriesGroupTypeOptions,\r\n        }));\r\n    }\r\n\r\n    public override getSeriesGroupType(): SeriesGroupType | undefined {\r\n        const standaloneChartType = this.standaloneChartType;\r\n        if (!['nightingale', 'radial-bar', 'radial-column'].includes(standaloneChartType)) {\r\n            return undefined;\r\n        }\r\n        const firstSeriesProperties = this.getChart().series?.[0]?.properties.toJson();\r\n        const getStackedValue = () => (firstSeriesProperties.normalizedTo ? 'normalized' : 'stacked');\r\n        if (standaloneChartType === 'nightingale') {\r\n            return firstSeriesProperties.grouped ? 'grouped' : getStackedValue();\r\n        } else {\r\n            return firstSeriesProperties.stacked ? getStackedValue() : 'grouped';\r\n        }\r\n    }\r\n\r\n    protected getUpdateOptions(params: UpdateParams, commonChartOptions: AgPolarChartOptions): AgPolarChartOptions {\r\n        const axes = this.getAxes(params);\r\n\r\n        return {\r\n            ...commonChartOptions,\r\n            data: this.getData(params, axes),\r\n            axes,\r\n            series: this.getSeries(params),\r\n        };\r\n    }\r\n\r\n    private getData(params: UpdateParams, axes: AgPolarAxisOptions[]): any[] {\r\n        const isCategoryAxis = axes.some((axis) => axis.type === 'angle-category' || axis.type === 'radius-category');\r\n        if (isCategoryAxis) {\r\n            const [category] = params.categories;\r\n            return this.transformCategoryData(params.data, category.id);\r\n        } else {\r\n            return params.data;\r\n        }\r\n    }\r\n\r\n    private getSeriesGroupTypeOptions(seriesGroupType?: SeriesGroupType): Partial<AgPolarSeriesOptions> {\r\n        if (!seriesGroupType) {\r\n            return {};\r\n        }\r\n        return {\r\n            grouped: seriesGroupType === 'grouped' || undefined,\r\n            stacked: seriesGroupType !== 'grouped' || undefined,\r\n            normalizedTo: seriesGroupType === 'normalized' ? 100 : undefined,\r\n        };\r\n    }\r\n}\r\n", "export function partition<T, K>(items: T[], selector: (item: T) => K): Map<K, T[]> {\r\n    return items.reduce((groupedItems, item) => {\r\n        const key = selector(item);\r\n        const existingItems = groupedItems.get(key);\r\n        return groupedItems.set(key, existingItems ? [...existingItems, item] : [item]);\r\n    }, new Map<K, T[]>());\r\n}\r\n\r\nexport function flatMap<T, V>(items: T[], iteratee: (item: T, index: number, array: T[]) => V[]): V[] {\r\n    return items.reduce((acc, item, index, array) => acc.concat(iteratee(item, index, array)), new Array<V>());\r\n}\r\n", "import type {\r\n    AgCartesianChartOptions,\r\n    AgChartThemeOverrides,\r\n    AgHeatmapSeriesOptions,\r\n    AgHeatmapSeriesTooltipRendererParams,\r\n    AgTooltipRendererResult,\r\n} from 'ag-charts-types';\r\n\r\nimport { flatMap } from '../../utils/array';\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { ChartProxy } from '../chartProxy';\r\n\r\nexport const HEATMAP_CATEGORY_KEY = 'AG-GRID-DEFAULT-HEATMAP-CATEGORY-KEY';\r\nexport const HEATMAP_SERIES_KEY = 'AG-GRID-DEFAULT-HEATMAP-SERIES-KEY';\r\nexport const HEATMAP_VALUE_KEY = 'AG-GRID-DEFAULT-HEATMAP-VALUE-KEY';\r\n\r\nexport class HeatmapChartProxy extends ChartProxy<AgCartesianChartOptions, 'heatmap'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected getUpdateOptions(\r\n        params: UpdateParams,\r\n        commonChartOptions: AgCartesianChartOptions\r\n    ): AgCartesianChartOptions {\r\n        const xSeriesKey = HEATMAP_SERIES_KEY;\r\n        const xValueKey = HEATMAP_VALUE_KEY;\r\n        const yKey = HEATMAP_CATEGORY_KEY;\r\n        return {\r\n            ...commonChartOptions,\r\n            series: this.getSeries(params, xSeriesKey, xValueKey, yKey),\r\n            data: this.getData(params, xSeriesKey, xValueKey, yKey),\r\n        };\r\n    }\r\n\r\n    protected getSeries(\r\n        params: UpdateParams,\r\n        xSeriesKey: string,\r\n        xValueKey: string,\r\n        yKey: string\r\n    ): AgHeatmapSeriesOptions[] {\r\n        const [category] = params.categories;\r\n        return [\r\n            {\r\n                type: this.standaloneChartType as AgHeatmapSeriesOptions['type'],\r\n                // The axis keys reference synthetic fields based on the category values and series column names\r\n                yKey,\r\n                xKey: xSeriesKey,\r\n                // The color key references a synthetic field based on the series column value for a specific cell\r\n                colorKey: xValueKey,\r\n                yName: category.name,\r\n                // We don't know how to label the 'x' series, as it is a synthetic series created from the set of all input columns\r\n                // In future releases we may want to consider inferring the series label from column groupings etc\r\n                xName: undefined,\r\n                colorName: undefined,\r\n            },\r\n        ];\r\n    }\r\n\r\n    protected getData(params: UpdateParams, xSeriesKey: string, xValueKey: string, yKey: string): any[] {\r\n        const [category] = params.categories;\r\n        // Heatmap chart expects a flat array of data, with each row representing a single cell in the heatmap\r\n        // This means we need to explode the list of input rows into their individual cells\r\n        return flatMap(params.data, (datum, index) => {\r\n            // We need to create a unique y value object for each row to prevent unintended category grouping\r\n            // when there are multiple rows with the same category value\r\n            const value = datum[category.id];\r\n            const valueString = value == null ? '' : String(value);\r\n            const yValue = { id: index, value, toString: () => valueString };\r\n            // Return a flat list of output data items corresponding to each cell,\r\n            // appending the synthetic series and category fields to the cell data\r\n            return params.fields.map(({ colId, displayName }) => ({\r\n                ...datum,\r\n                [xSeriesKey]: displayName,\r\n                [xValueKey]: datum[colId],\r\n                [yKey]: yValue,\r\n            }));\r\n        });\r\n    }\r\n\r\n    protected override getSeriesChartThemeDefaults(): AgChartThemeOverrides['heatmap'] {\r\n        return {\r\n            gradientLegend: {\r\n                gradient: {\r\n                    preferredLength: 200,\r\n                },\r\n            },\r\n            series: {\r\n                tooltip: {\r\n                    renderer: renderHeatmapTooltip,\r\n                },\r\n            },\r\n        };\r\n    }\r\n}\r\n\r\nfunction renderHeatmapTooltip(params: AgHeatmapSeriesTooltipRendererParams<any>): string | AgTooltipRendererResult {\r\n    const { xKey, yKey, colorKey, yName, datum } = params;\r\n    const table: Array<{ label: string; value: string | undefined }> = [\r\n        { label: yName, value: datum[yKey] },\r\n        { label: datum[xKey], value: colorKey && datum[colorKey] },\r\n    ];\r\n    return {\r\n        title: '',\r\n        data: table.map(({ label, value }) => ({ label: String(label), value: String(value) })),\r\n    };\r\n}\r\n", "import type { AgCartesianAxisType } from 'ag-charts-types';\r\n\r\nimport type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    CellRange,\r\n    ChartType,\r\n    IAggFunc,\r\n    IRangeService,\r\n    PartialCellRange,\r\n    SeriesChartType,\r\n    SeriesGroupType,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, CellRangeType } from 'ag-grid-community';\r\n\r\nimport type { ChartDatasourceParams } from '../datasource/chartDatasource';\r\nimport { ChartDatasource } from '../datasource/chartDatasource';\r\nimport { ChartColumnService } from '../services/chartColumnService';\r\nimport type { ChartTranslationService } from '../services/chartTranslationService';\r\nimport { getMaxNumSeries, getSeriesType, isComboChart, isHierarchical } from '../utils/seriesTypeMapper';\r\nimport { ComboChartModel } from './comboChartModel';\r\n\r\nexport interface ColState {\r\n    column?: AgColumn;\r\n    colId: string;\r\n    displayName: string | null;\r\n    selected?: boolean;\r\n    order: number;\r\n}\r\n\r\nexport interface ChartModelParams {\r\n    chartId: string;\r\n    pivotChart?: boolean;\r\n    chartType: ChartType;\r\n    chartThemeName: string;\r\n    switchCategorySeries?: boolean;\r\n    aggFunc?: string | IAggFunc;\r\n    cellRange: PartialCellRange;\r\n    suppressChartRanges?: boolean;\r\n    unlinkChart?: boolean;\r\n    crossFiltering?: boolean;\r\n    seriesChartTypes?: SeriesChartType[];\r\n    seriesGroupType?: SeriesGroupType;\r\n}\r\n\r\nexport const DEFAULT_CHART_CATEGORY = 'AG-GRID-DEFAULT-CATEGORY';\r\n\r\nexport class ChartDataModel extends BeanStub {\r\n    private rangeSvc: IRangeService;\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.rangeSvc = beans.rangeSvc!;\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    public readonly params: ChartModelParams;\r\n\r\n    // this is used to associate chart ranges with charts\r\n    public readonly chartId: string;\r\n\r\n    public suppressChartRanges: boolean;\r\n    public switchCategorySeries: boolean;\r\n    public aggFunc?: string | IAggFunc;\r\n    public pivotChart: boolean;\r\n    public categoryAxisType?: AgCartesianAxisType;\r\n\r\n    public chartType: ChartType;\r\n    public chartThemeName: string;\r\n    public unlinked = false;\r\n    public chartData: any[] = [];\r\n    public groupChartData: any[] | undefined;\r\n    public valueColState: ColState[] = [];\r\n    public dimensionColState: ColState[] = [];\r\n    public colNames: { [p: string]: string[] } = {};\r\n\r\n    public valueCellRange?: CellRange;\r\n    public dimensionCellRange?: CellRange;\r\n\r\n    public comboChartModel: ComboChartModel;\r\n    private chartColSvc: ChartColumnService;\r\n    private datasource: ChartDatasource;\r\n\r\n    public referenceCellRange: PartialCellRange;\r\n    public suppliedCellRange: PartialCellRange;\r\n\r\n    public crossFiltering = false;\r\n\r\n    private grouping = false;\r\n\r\n    public seriesGroupType?: SeriesGroupType;\r\n\r\n    public constructor(params: ChartModelParams) {\r\n        super();\r\n\r\n        this.params = params;\r\n        this.chartId = params.chartId;\r\n        this.setParams(params);\r\n    }\r\n\r\n    private setParams(params: ChartModelParams): void {\r\n        const {\r\n            chartType,\r\n            pivotChart,\r\n            chartThemeName,\r\n            switchCategorySeries,\r\n            aggFunc,\r\n            cellRange,\r\n            suppressChartRanges,\r\n            unlinkChart,\r\n            crossFiltering,\r\n            seriesGroupType,\r\n        } = params;\r\n        this.chartType = chartType;\r\n        this.pivotChart = pivotChart ?? false;\r\n        this.chartThemeName = chartThemeName;\r\n        this.switchCategorySeries = !!switchCategorySeries;\r\n        this.aggFunc = aggFunc;\r\n        this.referenceCellRange = cellRange;\r\n        this.suppliedCellRange = cellRange;\r\n        this.suppressChartRanges = suppressChartRanges ?? false;\r\n        this.unlinked = !!unlinkChart;\r\n        this.crossFiltering = !!crossFiltering;\r\n        this.seriesGroupType = seriesGroupType;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.datasource = this.createManagedBean(new ChartDatasource());\r\n        this.chartColSvc = this.createManagedBean(new ChartColumnService());\r\n        this.comboChartModel = this.createManagedBean(new ComboChartModel(this));\r\n        this.updateCellRanges({ setColsFromRange: true });\r\n        this.updateData();\r\n    }\r\n\r\n    public updateModel(params: ChartModelParams): void {\r\n        const { cellRange, seriesChartTypes } = params;\r\n\r\n        if (cellRange !== this.suppliedCellRange) {\r\n            this.dimensionCellRange = undefined;\r\n            this.valueCellRange = undefined;\r\n        }\r\n\r\n        this.setParams(params);\r\n\r\n        this.updateSelectedDimensions(cellRange?.columns as AgColumn[]);\r\n        this.updateCellRanges({ setColsFromRange: true });\r\n\r\n        const shouldUpdateComboModel = this.isComboChart() || seriesChartTypes;\r\n        if (shouldUpdateComboModel) {\r\n            this.comboChartModel.update(seriesChartTypes);\r\n        }\r\n\r\n        if (!this.unlinked) {\r\n            this.updateData();\r\n        }\r\n    }\r\n\r\n    public updateCellRanges(params?: {\r\n        updatedColState?: ColState;\r\n        resetOrder?: boolean;\r\n        maintainColState?: boolean;\r\n        setColsFromRange?: boolean;\r\n    }): void {\r\n        const { updatedColState, resetOrder, maintainColState, setColsFromRange } = params ?? {};\r\n        if (this.valueCellRange) {\r\n            this.referenceCellRange = this.valueCellRange;\r\n        }\r\n\r\n        const { dimensionCols, valueCols } = this.chartColSvc.getChartColumns();\r\n        const allColsFromRanges = this.getAllColumnsFromRanges();\r\n\r\n        if (updatedColState) {\r\n            this.updateColumnState(updatedColState, resetOrder);\r\n        }\r\n\r\n        this.setDimensionCellRange(dimensionCols, allColsFromRanges, updatedColState);\r\n        this.setValueCellRange(valueCols, allColsFromRanges, setColsFromRange);\r\n\r\n        if (!updatedColState && !maintainColState) {\r\n            this.resetColumnState();\r\n            // dimension / category cell range could be out of sync after resetting column state when row grouping\r\n            this.syncDimensionCellRange();\r\n        }\r\n\r\n        this.comboChartModel.updateSeriesChartTypes();\r\n    }\r\n\r\n    public updateData(): void {\r\n        const { startRow, endRow } = this.getRowIndexes();\r\n\r\n        if (this.pivotChart) {\r\n            this.resetColumnState();\r\n        }\r\n\r\n        this.grouping = this.isGrouping();\r\n\r\n        const params: ChartDatasourceParams = {\r\n            aggFunc: this.aggFunc,\r\n            dimensionCols: this.getSelectedDimensions(),\r\n            grouping: this.grouping,\r\n            pivoting: this.isPivotActive(),\r\n            crossFiltering: this.crossFiltering,\r\n            valueCols: this.getSelectedValueCols(),\r\n            startRow,\r\n            endRow,\r\n            isScatter: ['scatter', 'bubble'].includes(this.chartType),\r\n        };\r\n\r\n        const { chartData, colNames, groupChartData } = this.datasource.getData(params);\r\n\r\n        this.chartData = chartData;\r\n        this.groupChartData = groupChartData;\r\n        this.colNames = colNames;\r\n        this.categoryAxisType = undefined;\r\n    }\r\n\r\n    public isGrouping(): boolean {\r\n        const usingTreeData = this.gos.get('treeData');\r\n        const groupedCols = usingTreeData ? null : this.chartColSvc.getRowGroupColumns();\r\n        const isGroupActive = usingTreeData || (groupedCols && groupedCols.length > 0);\r\n\r\n        // charts only group when the selected category is a group column\r\n        const colIds = this.getSelectedDimensions().map(({ colId }) => colId);\r\n        const displayedGroupCols = this.chartColSvc.getGroupDisplayColumns();\r\n        const groupDimensionSelected = displayedGroupCols\r\n            .map((col) => col.getColId())\r\n            .some((id) => colIds.includes(id));\r\n        return !!isGroupActive && groupDimensionSelected;\r\n    }\r\n\r\n    public getSelectedValueCols(): AgColumn[] {\r\n        return this.valueColState.filter((cs) => cs.selected).map((cs) => cs.column!);\r\n    }\r\n\r\n    public getSelectedDimensions(): ColState[] {\r\n        return this.dimensionColState.filter((cs) => cs.selected);\r\n    }\r\n\r\n    public getColDisplayName(col: AgColumn, includePath?: boolean): string | null {\r\n        return this.chartColSvc.getColDisplayName(col, includePath);\r\n    }\r\n\r\n    public isPivotMode(): boolean {\r\n        return this.chartColSvc.isPivotMode();\r\n    }\r\n\r\n    public getChartDataType(colId: string): string | undefined {\r\n        const column = this.chartColSvc.getColumn(colId);\r\n        return column ? column.getColDef().chartDataType : undefined;\r\n    }\r\n\r\n    private isPivotActive(): boolean {\r\n        return this.chartColSvc.isPivotActive();\r\n    }\r\n\r\n    private createCellRange(type: CellRangeType, ...columns: AgColumn[]): CellRange {\r\n        return {\r\n            id: this.chartId, // set range ID to match chart ID so we can identify changes to the ranges for this chart\r\n            startRow: this.referenceCellRange.startRow,\r\n            endRow: this.referenceCellRange.endRow,\r\n            columns,\r\n            startColumn:\r\n                type === CellRangeType.DIMENSION || this.referenceCellRange.startColumn == null\r\n                    ? columns[0]\r\n                    : this.referenceCellRange.startColumn,\r\n            type,\r\n        };\r\n    }\r\n\r\n    private getAllColumnsFromRanges(): Set<AgColumn> {\r\n        if (this.pivotChart) {\r\n            return new Set(this.chartColSvc.getAllDisplayedColumns());\r\n        }\r\n\r\n        const columns = this.dimensionCellRange || this.valueCellRange ? [] : this.referenceCellRange.columns;\r\n\r\n        if (this.dimensionCellRange) {\r\n            columns.push(...this.dimensionCellRange.columns);\r\n        }\r\n\r\n        if (this.valueCellRange) {\r\n            columns.push(...this.valueCellRange.columns);\r\n        }\r\n\r\n        return new Set(columns as AgColumn[]);\r\n    }\r\n\r\n    private getRowIndexes(): { startRow: number; endRow: number } {\r\n        let startRow = 0,\r\n            endRow = 0;\r\n        const { rangeSvc, valueCellRange, dimensionCellRange } = this;\r\n\r\n        // Not all chart types require a value series (e.g. hierarchical charts),\r\n        // so fall back to using the dimension cell range for inferring row indices\r\n        const cellRange = valueCellRange || dimensionCellRange;\r\n\r\n        if (rangeSvc && cellRange) {\r\n            startRow = rangeSvc.getRangeStartRow(cellRange).rowIndex;\r\n\r\n            // when the last row the cell range is a pinned 'bottom' row, the `endRow` index is set to -1 which results\r\n            // in the ChartDatasource processing all non pinned rows from the `startRow` index.\r\n            const endRowPosition = rangeSvc.getRangeEndRow(cellRange);\r\n            endRow = endRowPosition.rowPinned === 'bottom' ? -1 : endRowPosition.rowIndex;\r\n        }\r\n\r\n        return { startRow, endRow };\r\n    }\r\n\r\n    private resetColumnState(): void {\r\n        const { dimensionCols, valueCols } = this.chartColSvc.getChartColumns();\r\n        const allCols = this.getAllColumnsFromRanges();\r\n        const isInitialising = this.valueColState.length < 1;\r\n\r\n        this.dimensionColState = [];\r\n        this.valueColState = [];\r\n\r\n        const supportsMultipleDimensions = isHierarchical(getSeriesType(this.chartType));\r\n        let hasSelectedDimension = false;\r\n        let order = 1;\r\n\r\n        const aggFuncDimension = this.suppliedCellRange.columns[0]; //TODO\r\n\r\n        dimensionCols.forEach((column) => {\r\n            const isAutoGroupCol = column.getColId() === 'ag-Grid-AutoColumn';\r\n\r\n            let selected = false;\r\n            if (this.crossFiltering && this.aggFunc) {\r\n                if (aggFuncDimension.getColId() === column.getColId()) {\r\n                    selected = true;\r\n                }\r\n            } else {\r\n                selected = isAutoGroupCol\r\n                    ? true\r\n                    : (!hasSelectedDimension || supportsMultipleDimensions) && allCols.has(column);\r\n            }\r\n\r\n            this.dimensionColState.push({\r\n                column,\r\n                colId: column.getColId(),\r\n                displayName: this.getColDisplayName(column),\r\n                selected,\r\n                order: order++,\r\n            });\r\n\r\n            if (selected) {\r\n                hasSelectedDimension = true;\r\n            }\r\n        });\r\n\r\n        const defaultCategory = {\r\n            colId: DEFAULT_CHART_CATEGORY,\r\n            displayName: this.chartTranslation.translate('defaultCategory'),\r\n            selected: !hasSelectedDimension, // if no dimensions in range select the default\r\n            order: 0,\r\n        };\r\n\r\n        this.dimensionColState.unshift(defaultCategory);\r\n\r\n        const valueColumnsFromReferenceRange = (this.referenceCellRange.columns as AgColumn[]).filter((c) =>\r\n            valueCols.has(c)\r\n        );\r\n\r\n        valueCols.forEach((column) => {\r\n            // first time the value cell range is set, preserve the column order from the supplied range\r\n            if (isInitialising && this.referenceCellRange.columns.includes(column)) {\r\n                column = valueColumnsFromReferenceRange.shift()!;\r\n            }\r\n\r\n            this.valueColState.push({\r\n                column,\r\n                colId: column.getColId(),\r\n                displayName: this.getColDisplayName(column),\r\n                selected: allCols.has(column),\r\n                order: order++,\r\n            });\r\n        });\r\n    }\r\n\r\n    private updateColumnState(updatedCol: ColState, resetOrder?: boolean): void {\r\n        const idsMatch = (cs: ColState) => cs.colId === updatedCol.colId;\r\n        const { dimensionColState, valueColState } = this;\r\n\r\n        // Determine whether the specified column is a dimension or value column\r\n        const matchedDimensionColState = dimensionColState.find(idsMatch);\r\n        const matchedValueColState = valueColState.find(idsMatch);\r\n\r\n        if (matchedDimensionColState) {\r\n            // For non-hierarchical chart types, only one dimension can be selected\r\n            const supportsMultipleDimensions = isHierarchical(getSeriesType(this.chartType));\r\n            if (!supportsMultipleDimensions) {\r\n                // Determine which column should end up selected, if any\r\n                const selectedColumnState = updatedCol.selected\r\n                    ? matchedDimensionColState\r\n                    : dimensionColState\r\n                          .filter((cs) => cs !== matchedDimensionColState)\r\n                          .find(({ selected }) => selected);\r\n                // Update the selection state of all dimension columns\r\n                dimensionColState.forEach((cs) => (cs.selected = cs === selectedColumnState));\r\n            } else {\r\n                // Update the selection state of the specified dimension column\r\n                matchedDimensionColState.selected = updatedCol.selected;\r\n            }\r\n        } else if (matchedValueColState) {\r\n            // Update the selection state of the specified value column\r\n            matchedValueColState.selected = updatedCol.selected;\r\n        }\r\n\r\n        const allColumns = [...dimensionColState, ...valueColState];\r\n        const orderedColIds: string[] = [];\r\n\r\n        if (!resetOrder) {\r\n            // calculate new order\r\n            allColumns.forEach((col: ColState, i: number) => {\r\n                if (i === updatedCol.order) {\r\n                    orderedColIds.push(updatedCol.colId);\r\n                }\r\n\r\n                if (col.colId !== updatedCol.colId) {\r\n                    orderedColIds.push(col.colId);\r\n                }\r\n            });\r\n\r\n            // update col state with new order\r\n            allColumns.forEach((col) => {\r\n                const order = orderedColIds.indexOf(col.colId);\r\n                col.order = order >= 0 ? orderedColIds.indexOf(col.colId) : allColumns.length - 1;\r\n            });\r\n        }\r\n\r\n        this.reorderColState();\r\n    }\r\n\r\n    private reorderColState(): void {\r\n        const ascColStateOrder = (a: ColState, b: ColState) => a.order - b.order;\r\n        this.dimensionColState.sort(ascColStateOrder);\r\n        this.valueColState.sort(ascColStateOrder);\r\n    }\r\n\r\n    private setDimensionCellRange(\r\n        dimensionCols: Set<AgColumn>,\r\n        colsInRange: Set<AgColumn>,\r\n        updatedColState?: ColState\r\n    ): void {\r\n        this.dimensionCellRange = undefined;\r\n        const supportsMultipleDimensions = isHierarchical(getSeriesType(this.chartType));\r\n\r\n        if (!updatedColState && !this.dimensionColState.length) {\r\n            const selectedCols = new Array<AgColumn>();\r\n            // use first dimension column in range by default, or all dimension columns for hierarchical charts\r\n            dimensionCols.forEach((col) => {\r\n                if ((selectedCols.length > 0 && !supportsMultipleDimensions) || !colsInRange.has(col)) {\r\n                    return;\r\n                }\r\n                selectedCols.push(col);\r\n            });\r\n            if (selectedCols.length > 0) {\r\n                this.dimensionCellRange = this.createCellRange(CellRangeType.DIMENSION, ...selectedCols);\r\n            }\r\n            return;\r\n        }\r\n\r\n        let selectedDimensionColStates = updatedColState ? [updatedColState] : [];\r\n        if (this.crossFiltering && this.aggFunc) {\r\n            const aggFuncDimension = this.suppliedCellRange.columns[0]; //TODO\r\n            selectedDimensionColStates = this.dimensionColState.filter(\r\n                (cs) => cs.colId === aggFuncDimension.getColId()\r\n            );\r\n        } else if (\r\n            supportsMultipleDimensions ||\r\n            selectedDimensionColStates.length === 0 ||\r\n            selectedDimensionColStates.some(({ column }) => !column || !dimensionCols.has(column))\r\n        ) {\r\n            selectedDimensionColStates = this.dimensionColState.filter((cs) => cs.selected);\r\n        }\r\n\r\n        const isDefaultCategory =\r\n            selectedDimensionColStates.length === 1\r\n                ? selectedDimensionColStates[0].colId === DEFAULT_CHART_CATEGORY\r\n                : false;\r\n        const selectedColumns = selectedDimensionColStates\r\n            .map(({ column }) => column)\r\n            .filter((value): value is NonNullable<typeof value> => value != null);\r\n        if (selectedColumns.length > 0 && !isDefaultCategory) {\r\n            this.dimensionCellRange = this.createCellRange(CellRangeType.DIMENSION, ...selectedColumns);\r\n        }\r\n    }\r\n\r\n    private setValueCellRange(valueCols: Set<AgColumn>, colsInRange: Set<AgColumn>, setColsFromRange?: boolean): void {\r\n        this.valueCellRange = undefined;\r\n\r\n        const selectedValueCols: AgColumn[] = [];\r\n\r\n        const maxSelection = getMaxNumSeries(this.chartType);\r\n        let numSelected = 0;\r\n\r\n        valueCols.forEach((col) => {\r\n            if (setColsFromRange) {\r\n                if ((maxSelection == null || numSelected < maxSelection) && colsInRange.has(col)) {\r\n                    selectedValueCols.push(col);\r\n                    numSelected++;\r\n                }\r\n            } else {\r\n                if (this.valueColState.some((colState) => colState.selected && colState.colId === col.getColId())) {\r\n                    selectedValueCols.push(col);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (selectedValueCols.length > 0) {\r\n            let orderedColIds: string[] = [];\r\n\r\n            if (this.valueColState.length > 0) {\r\n                orderedColIds = this.valueColState.map((c) => c.colId);\r\n            } else {\r\n                colsInRange.forEach((c) => orderedColIds.push(c.getColId()));\r\n            }\r\n\r\n            selectedValueCols.sort((a, b) => orderedColIds.indexOf(a.getColId()) - orderedColIds.indexOf(b.getColId()));\r\n\r\n            this.valueCellRange = this.createCellRange(CellRangeType.VALUE, ...selectedValueCols);\r\n        }\r\n    }\r\n\r\n    public resetCellRanges(dimension: boolean, value: boolean): void {\r\n        if (!dimension && !value) {\r\n            return;\r\n        }\r\n        const { dimensionCols, valueCols } = this.chartColSvc.getChartColumns();\r\n        const allColsFromRanges = this.getAllColumnsFromRanges();\r\n        if (dimension) {\r\n            this.setDimensionCellRange(dimensionCols, allColsFromRanges);\r\n        }\r\n        if (value) {\r\n            this.setValueCellRange(valueCols, allColsFromRanges);\r\n        }\r\n    }\r\n\r\n    private updateSelectedDimensions(columns: AgColumn[]): void {\r\n        const colIdSet = new Set(columns.map((column) => column.getColId()));\r\n\r\n        // For non-hierarchical chart types, only one dimension can be selected\r\n        const supportsMultipleDimensions = isHierarchical(getSeriesType(this.chartType));\r\n        if (!supportsMultipleDimensions) {\r\n            // Determine which column should end up selected, if any\r\n            // if no dimension found in supplied columns use the default category (always index = 0)\r\n            const foundColState =\r\n                this.dimensionColState.find((colState) => colIdSet.has(colState.colId)) || this.dimensionColState[0];\r\n            const selectedColumnId = foundColState.colId;\r\n            // Update the selection state of all dimension columns\r\n            this.dimensionColState = this.dimensionColState.map((colState) => ({\r\n                ...colState,\r\n                selected: colState.colId === selectedColumnId,\r\n            }));\r\n        } else {\r\n            // Update the selection state of all dimension columns, selecting only the provided columns from the chart model\r\n            const foundColStates = this.dimensionColState.filter((colState) => colIdSet.has(colState.colId));\r\n            const selectedColumnIds = new Set(foundColStates.map((colState) => colState.colId));\r\n            this.dimensionColState = this.dimensionColState.map((colState) => ({\r\n                ...colState,\r\n                selected: selectedColumnIds.has(colState.colId),\r\n            }));\r\n        }\r\n    }\r\n\r\n    private syncDimensionCellRange() {\r\n        const selectedDimensions = this.getSelectedDimensions();\r\n        if (selectedDimensions.length === 0) return;\r\n        const selectedCols = selectedDimensions\r\n            .map(({ column }) => column)\r\n            .filter((value): value is NonNullable<typeof value> => value != null);\r\n        if (selectedCols.length > 0) {\r\n            this.dimensionCellRange = this.createCellRange(CellRangeType.DIMENSION, ...selectedCols);\r\n        }\r\n    }\r\n\r\n    public isComboChart(chartType?: ChartType): boolean {\r\n        return isComboChart(chartType ?? this.chartType);\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AgColumnGroup,\r\n    BeanCollection,\r\n    ColumnModel,\r\n    IAggFunc,\r\n    IAggregationStage,\r\n    IClientSideRowModel,\r\n    IPivotResultColsService,\r\n    IRowModel,\r\n    IRowNodeStage,\r\n    PartialCellRange,\r\n    RowNode,\r\n    RowNodeSorter,\r\n    SortService,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _isClientSideRowModel, _isServerSideRowModel, _last, _warn } from 'ag-grid-community';\r\n\r\nimport type { ColState } from '../model/chartDataModel';\r\nimport { DEFAULT_CHART_CATEGORY } from '../model/chartDataModel';\r\n\r\nexport interface ChartDatasourceParams {\r\n    dimensionCols: ColState[];\r\n    grouping: boolean;\r\n    pivoting: boolean;\r\n    crossFiltering: boolean;\r\n    valueCols: AgColumn[];\r\n    startRow: number;\r\n    endRow: number;\r\n    isScatter: boolean;\r\n    aggFunc?: string | IAggFunc;\r\n    referenceCellRange?: PartialCellRange;\r\n}\r\n\r\ninterface IData {\r\n    chartData: any[];\r\n    colNames: { [key: string]: string[] };\r\n    groupChartData?: any[];\r\n}\r\n\r\nexport class ChartDatasource extends BeanStub {\r\n    private gridRowModel: IRowModel;\r\n    private pivotResultCols?: IPivotResultColsService;\r\n    private valueSvc: ValueService;\r\n    private colModel: ColumnModel;\r\n    private rowNodeSorter?: RowNodeSorter;\r\n    private sortSvc?: SortService;\r\n    private aggStage?: IRowNodeStage & IAggregationStage;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.sortSvc = beans.sortSvc;\r\n        this.gridRowModel = beans.rowModel;\r\n        this.colModel = beans.colModel;\r\n        this.valueSvc = beans.valueSvc;\r\n        this.pivotResultCols = beans.pivotResultCols;\r\n        this.rowNodeSorter = beans.rowNodeSorter;\r\n        this.aggStage = beans.aggStage as (IRowNodeStage & IAggregationStage) | undefined;\r\n    }\r\n\r\n    public getData(params: ChartDatasourceParams): IData {\r\n        if (params.crossFiltering) {\r\n            if (params.grouping) {\r\n                _warn(141);\r\n                return { chartData: [], colNames: {} };\r\n            }\r\n\r\n            if (!_isClientSideRowModel(this.gos)) {\r\n                _warn(142);\r\n                return { chartData: [], colNames: {} };\r\n            }\r\n        }\r\n\r\n        const isServerSide = _isServerSideRowModel(this.gos);\r\n        if (isServerSide && params.pivoting) {\r\n            this.updatePivotKeysForSSRM();\r\n        }\r\n\r\n        const result = this.extractRowsFromGridRowModel(params);\r\n        result.chartData = this.aggregateRowsByDimension(params, result.chartData);\r\n        return result;\r\n    }\r\n\r\n    private extractRowsFromGridRowModel(params: ChartDatasourceParams): IData {\r\n        const { crossFiltering, startRow, endRow, valueCols, dimensionCols, grouping } = params;\r\n        let extractedRowData: any[] = [];\r\n        const colNames: { [key: string]: string[] } = {};\r\n\r\n        // maps used to keep track of expanded groups that need to be removed\r\n        const groupNodeIndexes: { [key: string]: number } = {};\r\n        const groupsToRemove: { [key: string]: number } = {};\r\n\r\n        // only used when cross filtering\r\n        let filteredNodes: { [key: string]: RowNode } = {};\r\n        let allRowNodes: RowNode[] = [];\r\n\r\n        let numRows;\r\n        if (crossFiltering) {\r\n            filteredNodes = this.getFilteredRowNodes();\r\n            allRowNodes = this.getAllRowNodes();\r\n            numRows = allRowNodes.length;\r\n        } else {\r\n            // make sure enough rows in range to chart. if user filters and less rows, then end row will be\r\n            // the last displayed row, not where the range ends.\r\n            const modelLastRow = this.gridRowModel.getRowCount() - 1;\r\n            // inclusivity is wrong for end row, so can't detect 0 rows properly\r\n            const hasNoRange =\r\n                startRow === endRow && startRow === 0 && dimensionCols.length === 0 && valueCols.length === 0;\r\n            if (hasNoRange) {\r\n                numRows = 0;\r\n            } else {\r\n                const rangeLastRow = endRow >= 0 ? Math.min(endRow, modelLastRow) : modelLastRow;\r\n                numRows = rangeLastRow - startRow + 1;\r\n            }\r\n        }\r\n\r\n        if (numRows > 0) {\r\n            valueCols.forEach((col) => {\r\n                let colNamesArr: string[] = [];\r\n\r\n                // pivot keys should be added first\r\n                const pivotKeys = col.getColDef().pivotKeys;\r\n                if (pivotKeys) {\r\n                    colNamesArr = pivotKeys.slice();\r\n                }\r\n\r\n                // then add column header name to results\r\n                const headerName = col.getColDef().headerName;\r\n                if (headerName) {\r\n                    colNamesArr.push(headerName);\r\n                }\r\n\r\n                // add array of column names to results\r\n                if (colNamesArr.length > 0) {\r\n                    colNames[col.getId()] = colNamesArr;\r\n                }\r\n            });\r\n        }\r\n\r\n        let numRemovedNodes = 0;\r\n\r\n        for (let i = 0; i < numRows; i++) {\r\n            const rowNode = crossFiltering ? allRowNodes[i] : this.gridRowModel.getRow(i + startRow)!;\r\n\r\n            if (rowNode.footer || rowNode.detail) {\r\n                numRemovedNodes++;\r\n                continue;\r\n            }\r\n\r\n            const data: any = {};\r\n            // first get data for dimensions columns\r\n            dimensionCols.forEach((col) => {\r\n                const colId = col.colId;\r\n                const column = this.colModel.getCol(colId);\r\n\r\n                if (column) {\r\n                    const valueObject = this.valueSvc.getValue(column, rowNode);\r\n\r\n                    // when grouping we also need to build up multi category labels for charts\r\n                    if (grouping) {\r\n                        const valueString = valueObject?.toString ? String(valueObject.toString()) : '';\r\n\r\n                        // traverse parents to extract group label path\r\n                        const labels = this.getGroupLabels(rowNode, valueString);\r\n\r\n                        data[colId] = labels.slice().reverse();\r\n\r\n                        // keep track of group node indexes, so they can be padded when other groups are expanded\r\n                        if (rowNode.group) {\r\n                            groupNodeIndexes[labels.toString()] = i - numRemovedNodes;\r\n                        }\r\n\r\n                        // if node (group or leaf) has parents then it is expanded and should be removed\r\n                        const groupKey = labels.slice(1, labels.length).toString();\r\n\r\n                        if (groupKey) {\r\n                            groupsToRemove[groupKey] = groupNodeIndexes[groupKey];\r\n                        }\r\n                    } else {\r\n                        // leaf nodes can be directly added to dimension columns\r\n                        data[colId] = valueObject;\r\n                    }\r\n                } else {\r\n                    // introduce a default category when no dimensions exist with a value based off row index (+1)\r\n                    data[DEFAULT_CHART_CATEGORY] = i + 1;\r\n                }\r\n            });\r\n\r\n            // then get data for value columns\r\n            valueCols.forEach((col) => {\r\n                const colId = col.getColId();\r\n                if (crossFiltering) {\r\n                    const filteredOutColId = colId + '-filtered-out';\r\n\r\n                    // add data value to value column\r\n                    const value = this.valueSvc.getValue(col, rowNode);\r\n                    const actualValue =\r\n                        value != null && typeof value.toNumber === 'function' ? value.toNumber() : value;\r\n\r\n                    if (filteredNodes[rowNode.id as string]) {\r\n                        data[colId] = actualValue;\r\n                        data[filteredOutColId] = params.aggFunc || params.isScatter ? undefined : 0;\r\n                    } else {\r\n                        data[colId] = params.aggFunc || params.isScatter ? undefined : 0;\r\n                        data[filteredOutColId] = actualValue;\r\n                    }\r\n                } else {\r\n                    // add data value to value column\r\n                    let value = this.valueSvc.getValue(col, rowNode);\r\n\r\n                    // aggregated value\r\n                    if (value && Object.prototype.hasOwnProperty.call(value, 'toString')) {\r\n                        value = parseFloat(value.toString());\r\n                    }\r\n\r\n                    data[colId] = value != null && typeof value.toNumber === 'function' ? value.toNumber() : value;\r\n                }\r\n            });\r\n\r\n            // add data to results\r\n            extractedRowData.push(data);\r\n        }\r\n\r\n        let groupChartData: any[] | undefined;\r\n        if (grouping) {\r\n            const groupIndexesToRemove = Object.values(groupsToRemove);\r\n            const allData = extractedRowData;\r\n            extractedRowData = [];\r\n            groupChartData = [];\r\n            for (let i = 0; i < allData.length; i++) {\r\n                (groupIndexesToRemove.includes(i) ? groupChartData : extractedRowData).push(allData[i]);\r\n            }\r\n        }\r\n\r\n        return { chartData: extractedRowData, colNames, groupChartData };\r\n    }\r\n\r\n    private aggregateRowsByDimension(params: ChartDatasourceParams, dataFromGrid: any[]): any[] {\r\n        const dimensionCols = params.dimensionCols;\r\n\r\n        if (!params.aggFunc || dimensionCols.length === 0) {\r\n            return dataFromGrid;\r\n        }\r\n\r\n        const lastCol = _last(dimensionCols);\r\n        const lastColId = lastCol && lastCol.colId;\r\n        const map: any = {};\r\n        const dataAggregated: any[] = [];\r\n\r\n        dataFromGrid.forEach((data) => {\r\n            let currentMap = map;\r\n\r\n            dimensionCols.forEach((col) => {\r\n                const colId = col.colId;\r\n                const key = data[colId];\r\n\r\n                if (colId === lastColId) {\r\n                    let groupItem = currentMap[key];\r\n\r\n                    if (!groupItem) {\r\n                        groupItem = { __children: [] };\r\n\r\n                        dimensionCols.forEach((dimCol) => {\r\n                            const dimColId = dimCol.colId;\r\n                            groupItem[dimColId] = data[dimColId];\r\n                        });\r\n\r\n                        currentMap[key] = groupItem;\r\n                        dataAggregated.push(groupItem);\r\n                    }\r\n\r\n                    groupItem.__children.push(data);\r\n                } else {\r\n                    // map of maps\r\n                    if (!currentMap[key]) {\r\n                        currentMap[key] = {};\r\n                    }\r\n\r\n                    currentMap = currentMap[key];\r\n                }\r\n            });\r\n        });\r\n\r\n        if (this.gos.assertModuleRegistered('SharedRowGrouping', 1)) {\r\n            const aggStage = this.aggStage!;\r\n            dataAggregated.forEach((groupItem) =>\r\n                params.valueCols.forEach((col) => {\r\n                    if (params.crossFiltering) {\r\n                        params.valueCols.forEach((valueCol) => {\r\n                            const colId = valueCol.getColId();\r\n\r\n                            // filtered data\r\n                            const dataToAgg = groupItem.__children\r\n                                .filter((child: any) => typeof child[colId] !== 'undefined')\r\n                                .map((child: any) => child[colId]);\r\n\r\n                            const aggResult: any = aggStage.aggregateValues(dataToAgg, params.aggFunc!);\r\n                            groupItem[valueCol.getId()] =\r\n                                aggResult && typeof aggResult.value !== 'undefined' ? aggResult.value : aggResult;\r\n\r\n                            // filtered out data\r\n                            const filteredOutColId = `${colId}-filtered-out`;\r\n                            const dataToAggFiltered = groupItem.__children\r\n                                .filter((child: any) => typeof child[filteredOutColId] !== 'undefined')\r\n                                .map((child: any) => child[filteredOutColId]);\r\n\r\n                            const aggResultFiltered: any = aggStage.aggregateValues(dataToAggFiltered, params.aggFunc!);\r\n                            groupItem[filteredOutColId] =\r\n                                aggResultFiltered && typeof aggResultFiltered.value !== 'undefined'\r\n                                    ? aggResultFiltered.value\r\n                                    : aggResultFiltered;\r\n                        });\r\n                    } else {\r\n                        const dataToAgg = groupItem.__children.map((child: any) => child[col.getId()]);\r\n                        const aggResult = aggStage.aggregateValues(dataToAgg, params.aggFunc!);\r\n\r\n                        groupItem[col.getId()] =\r\n                            aggResult && typeof aggResult.value !== 'undefined' ? aggResult.value : aggResult;\r\n                    }\r\n                })\r\n            );\r\n        }\r\n\r\n        return dataAggregated;\r\n    }\r\n\r\n    private updatePivotKeysForSSRM() {\r\n        const secondaryColumns = this.pivotResultCols?.getPivotResultCols()?.list;\r\n\r\n        if (!secondaryColumns) {\r\n            return;\r\n        }\r\n\r\n        // we don't know what the application will use for the pivot key separator (i.e. '_' or '|' ) as the\r\n        // secondary columns are provided to grid by the application via api.setSecondaryColumns()\r\n        const pivotKeySeparator = this.extractPivotKeySeparator(secondaryColumns);\r\n\r\n        // `pivotKeys` is not used by the SSRM for pivoting, so it is safe to reuse this colDef property. This way\r\n        // the same logic can be used for CSRM and SSRM to extract legend names in extractRowsFromGridRowModel()\r\n        secondaryColumns.forEach((col) => {\r\n            if (pivotKeySeparator === '') {\r\n                col.getColDef().pivotKeys = [];\r\n            } else {\r\n                const keys = col.getColId().split(pivotKeySeparator);\r\n                col.getColDef().pivotKeys = keys.slice(0, keys.length - 1);\r\n            }\r\n        });\r\n    }\r\n\r\n    private extractPivotKeySeparator(secondaryColumns: AgColumn[]) {\r\n        if (secondaryColumns.length === 0) {\r\n            return '';\r\n        }\r\n\r\n        const extractSeparator = (columnGroup: AgColumnGroup, childId: string): string => {\r\n            const groupId = columnGroup.getGroupId();\r\n            if (!columnGroup.getParent()) {\r\n                // removing groupId ('2000') from childId ('2000|Swimming') yields '|Swimming' so first char is separator\r\n                return childId.split(groupId)[1][0];\r\n            }\r\n            return extractSeparator(columnGroup.getParent()!, groupId);\r\n        };\r\n\r\n        const firstSecondaryCol = secondaryColumns[0];\r\n        if (firstSecondaryCol.getParent() == null) {\r\n            return '';\r\n        }\r\n        return extractSeparator(firstSecondaryCol.getParent()!, firstSecondaryCol.getColId());\r\n    }\r\n\r\n    private getGroupLabels(rowNode: RowNode | null, initialLabel: string): string[] {\r\n        const labels = [initialLabel];\r\n        while (rowNode && rowNode.level !== 0) {\r\n            rowNode = rowNode.parent;\r\n            if (rowNode) {\r\n                labels.push(rowNode.key!);\r\n            }\r\n        }\r\n        return labels;\r\n    }\r\n\r\n    private getFilteredRowNodes() {\r\n        const filteredNodes: { [key: string]: RowNode } = {};\r\n        (this.gridRowModel as IClientSideRowModel).forEachNodeAfterFilterAndSort((rowNode: RowNode) => {\r\n            filteredNodes[rowNode.id as string] = rowNode;\r\n        });\r\n        return filteredNodes;\r\n    }\r\n\r\n    private getAllRowNodes() {\r\n        const allRowNodes: RowNode[] = [];\r\n        this.gridRowModel.forEachNode((rowNode: RowNode) => {\r\n            allRowNodes.push(rowNode);\r\n        });\r\n        return this.sortRowNodes(allRowNodes);\r\n    }\r\n\r\n    private sortRowNodes(rowNodes: RowNode[]): RowNode[] {\r\n        const sortOptions = this.sortSvc?.getSortOptions();\r\n        if (!sortOptions || sortOptions.length == 0 || !this.rowNodeSorter) {\r\n            return rowNodes;\r\n        }\r\n        return this.rowNodeSorter.doFullSort(rowNodes, sortOptions);\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    AgColumnGroup,\r\n    BeanCollection,\r\n    ColumnModel,\r\n    ColumnNameService,\r\n    NamedBean,\r\n    RowNode,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _getRowNode, _warn } from 'ag-grid-community';\r\n\r\nexport class ChartColumnService extends BeanStub implements NamedBean {\r\n    beanName = 'chartColSvc' as const;\r\n\r\n    private colModel: ColumnModel;\r\n    private colNames: ColumnNameService;\r\n    private valueSvc: ValueService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.colModel = beans.colModel;\r\n        this.colNames = beans.colNames;\r\n        this.valueSvc = beans.valueSvc;\r\n    }\r\n\r\n    private valueColsWithoutSeriesType: Set<string> = new Set();\r\n\r\n    public postConstruct(): void {\r\n        const clearValueCols = () => this.valueColsWithoutSeriesType.clear();\r\n        this.addManagedEventListeners({\r\n            newColumnsLoaded: clearValueCols,\r\n            rowDataUpdated: clearValueCols,\r\n        });\r\n    }\r\n\r\n    public getColumn(colId: string): AgColumn | null {\r\n        return this.colModel.getColDefCol(colId);\r\n    }\r\n\r\n    public getAllDisplayedColumns(): AgColumn[] {\r\n        return this.beans.visibleCols.allCols;\r\n    }\r\n\r\n    public getColDisplayName(col: AgColumn, includePath?: boolean): string | null {\r\n        const headerLocation = 'chart';\r\n        const columnDisplayName = this.colNames.getDisplayNameForColumn(col, headerLocation);\r\n        if (includePath) {\r\n            const displayNames = [columnDisplayName];\r\n            const getDisplayName = (colGroup: AgColumnGroup | null) => {\r\n                if (!colGroup) {\r\n                    return;\r\n                }\r\n                const colGroupName = this.colNames.getDisplayNameForColumnGroup(colGroup, headerLocation);\r\n                if (colGroupName?.length) {\r\n                    displayNames.unshift(colGroupName);\r\n                    getDisplayName(colGroup.getParent());\r\n                }\r\n            };\r\n            getDisplayName(col.getParent());\r\n            return displayNames.join(' - ');\r\n        }\r\n        return columnDisplayName;\r\n    }\r\n\r\n    public getRowGroupColumns(): AgColumn[] {\r\n        return this.beans.rowGroupColsSvc?.columns ?? [];\r\n    }\r\n\r\n    public getGroupDisplayColumns(): AgColumn[] {\r\n        return this.beans.showRowGroupCols?.getShowRowGroupCols() ?? [];\r\n    }\r\n\r\n    public isPivotMode(): boolean {\r\n        return this.colModel.isPivotMode();\r\n    }\r\n\r\n    public isPivotActive(): boolean {\r\n        return this.colModel.isPivotActive();\r\n    }\r\n\r\n    public getChartColumns(): { dimensionCols: Set<AgColumn>; valueCols: Set<AgColumn> } {\r\n        const gridCols = this.colModel.getCols();\r\n\r\n        const dimensionCols = new Set<AgColumn>();\r\n        const valueCols = new Set<AgColumn>();\r\n\r\n        gridCols.forEach((col) => {\r\n            const colDef = col.getColDef();\r\n            const chartDataType = colDef.chartDataType;\r\n\r\n            if (chartDataType) {\r\n                // chart data type was specified explicitly\r\n                switch (chartDataType) {\r\n                    case 'category':\r\n                    case 'time':\r\n                        dimensionCols.add(col);\r\n                        return;\r\n                    case 'series':\r\n                        valueCols.add(col);\r\n                        return;\r\n                    case 'excluded':\r\n                        return;\r\n                    default:\r\n                        _warn(153, { chartDataType });\r\n                        break;\r\n                }\r\n            }\r\n\r\n            if (colDef.colId === 'ag-Grid-AutoColumn') {\r\n                dimensionCols.add(col);\r\n                return;\r\n            }\r\n\r\n            if (!col.isPrimary()) {\r\n                valueCols.add(col);\r\n                return;\r\n            }\r\n\r\n            // if 'chartDataType' is not provided then infer type based data contained in first row\r\n            (this.isInferredValueCol(col) ? valueCols : dimensionCols).add(col);\r\n        });\r\n\r\n        return { dimensionCols, valueCols };\r\n    }\r\n\r\n    private isInferredValueCol(col: AgColumn): boolean {\r\n        const colId = col.getColId();\r\n        if (colId === 'ag-Grid-AutoColumn') {\r\n            return false;\r\n        }\r\n\r\n        const row = _getRowNode(this.beans, { rowIndex: 0, rowPinned: null });\r\n\r\n        if (!row) {\r\n            return this.valueColsWithoutSeriesType.has(colId);\r\n        }\r\n\r\n        let cellValue = this.valueSvc.getValue(col, row);\r\n\r\n        if (cellValue == null) {\r\n            cellValue = this.extractLeafData(row, col);\r\n        }\r\n\r\n        if (cellValue != null && typeof cellValue.toNumber === 'function') {\r\n            cellValue = cellValue.toNumber();\r\n        }\r\n\r\n        const isNumber = typeof cellValue === 'number';\r\n\r\n        if (isNumber) {\r\n            this.valueColsWithoutSeriesType.add(colId);\r\n        }\r\n\r\n        return isNumber;\r\n    }\r\n\r\n    private extractLeafData(row: RowNode, col: AgColumn): any {\r\n        if (!row.allLeafChildren) {\r\n            return null;\r\n        }\r\n\r\n        for (let i = 0; i < row.allLeafChildren.length; i++) {\r\n            const childRow = row.allLeafChildren[i];\r\n            const value = this.valueSvc.getValue(col, childRow);\r\n\r\n            if (value != null) {\r\n                return value;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.valueColsWithoutSeriesType.clear();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { ChartType, SeriesChartType } from 'ag-grid-community';\r\nimport { BeanStub, _warn } from 'ag-grid-community';\r\n\r\nimport type { ChartDataModel, ColState } from './chartDataModel';\r\n\r\nconst SUPPORTED_COMBO_CHART_TYPES = new Set(['line', 'groupedColumn', 'stackedColumn', 'area', 'stackedArea']);\r\n\r\nexport class ComboChartModel extends BeanStub {\r\n    public seriesChartTypes: SeriesChartType[];\r\n    public savedCustomSeriesChartTypes: SeriesChartType[];\r\n\r\n    // this control flag is used to only log warning for the initial user config\r\n    private suppressComboChartWarnings = false;\r\n    private chartDataModel: ChartDataModel;\r\n\r\n    public constructor(chartDataModel: ChartDataModel) {\r\n        super();\r\n        this.chartDataModel = chartDataModel;\r\n        this.seriesChartTypes = chartDataModel.params.seriesChartTypes ?? [];\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.initComboCharts();\r\n    }\r\n\r\n    public update(seriesChartTypes?: SeriesChartType[]): void {\r\n        this.seriesChartTypes = seriesChartTypes ?? this.seriesChartTypes;\r\n        this.initComboCharts();\r\n        this.updateSeriesChartTypes();\r\n    }\r\n\r\n    private initComboCharts() {\r\n        const seriesChartTypesExist = this.seriesChartTypes && this.seriesChartTypes.length > 0;\r\n        const customCombo = this.chartDataModel.chartType === 'customCombo' || seriesChartTypesExist;\r\n        if (customCombo) {\r\n            // it is not necessary to supply a chart type for combo charts when `seriesChartTypes` is supplied\r\n            this.chartDataModel.chartType = 'customCombo';\r\n\r\n            // cache supplied `seriesChartTypes` to allow switching between different chart types in the settings panel\r\n            this.savedCustomSeriesChartTypes = this.seriesChartTypes || [];\r\n        }\r\n    }\r\n\r\n    public updateSeriesChartTypes(): void {\r\n        if (!this.chartDataModel.isComboChart()) {\r\n            return;\r\n        }\r\n\r\n        // ensure primary only chart types are not placed on secondary axis\r\n        this.seriesChartTypes = this.seriesChartTypes.map((seriesChartType) => {\r\n            const primaryOnly = ['groupedColumn', 'stackedColumn', 'stackedArea'].includes(seriesChartType.chartType);\r\n            seriesChartType.secondaryAxis = primaryOnly ? false : seriesChartType.secondaryAxis;\r\n            return seriesChartType;\r\n        });\r\n\r\n        // note that when seriesChartTypes are supplied the chart type is also changed to 'customCombo'\r\n        if (this.chartDataModel.chartType === 'customCombo') {\r\n            this.updateSeriesChartTypesForCustomCombo();\r\n            return;\r\n        }\r\n\r\n        this.updateChartSeriesTypesForBuiltInCombos();\r\n    }\r\n\r\n    private updateSeriesChartTypesForCustomCombo() {\r\n        const seriesChartTypesSupplied = this.seriesChartTypes && this.seriesChartTypes.length > 0;\r\n        if (!seriesChartTypesSupplied && !this.suppressComboChartWarnings) {\r\n            _warn(150);\r\n        }\r\n\r\n        // ensure correct chartTypes are supplied\r\n        this.seriesChartTypes = this.seriesChartTypes.map((s) => {\r\n            if (!SUPPORTED_COMBO_CHART_TYPES.has(s.chartType)) {\r\n                _warn(151, { chartType: s.chartType });\r\n                s.chartType = 'line';\r\n            }\r\n            return s;\r\n        });\r\n\r\n        const getSeriesChartType = (valueCol: ColState): SeriesChartType => {\r\n            if (!this.savedCustomSeriesChartTypes || this.savedCustomSeriesChartTypes.length === 0) {\r\n                this.savedCustomSeriesChartTypes = this.seriesChartTypes;\r\n            }\r\n\r\n            const providedSeriesChartType = this.savedCustomSeriesChartTypes.find((s) => s.colId === valueCol.colId);\r\n            if (!providedSeriesChartType) {\r\n                if (valueCol.selected && !this.suppressComboChartWarnings) {\r\n                    _warn(152, { colId: valueCol.colId });\r\n                }\r\n                return {\r\n                    colId: valueCol.colId,\r\n                    chartType: 'line',\r\n                    secondaryAxis: false,\r\n                };\r\n            }\r\n\r\n            return providedSeriesChartType;\r\n        };\r\n\r\n        const updatedSeriesChartTypes = this.chartDataModel.valueColState.map(getSeriesChartType);\r\n\r\n        this.seriesChartTypes = updatedSeriesChartTypes;\r\n\r\n        // also cache custom `seriesChartTypes` to allow for switching between different chart types\r\n        this.savedCustomSeriesChartTypes = updatedSeriesChartTypes;\r\n\r\n        // turn off warnings as first combo chart attempt has completed\r\n        this.suppressComboChartWarnings = true;\r\n    }\r\n\r\n    private updateChartSeriesTypesForBuiltInCombos() {\r\n        const { chartType, valueColState } = this.chartDataModel;\r\n\r\n        const primaryChartType: ChartType = chartType === 'columnLineCombo' ? 'groupedColumn' : 'stackedArea';\r\n        const secondaryChartType: ChartType = chartType === 'columnLineCombo' ? 'line' : 'groupedColumn';\r\n\r\n        const selectedCols = valueColState.filter((cs) => cs.selected);\r\n        const lineIndex = Math.ceil(selectedCols.length / 2);\r\n        this.seriesChartTypes = selectedCols.map((valueCol: ColState, i: number) => {\r\n            const seriesType = i >= lineIndex ? secondaryChartType : primaryChartType;\r\n            return { colId: valueCol.colId, chartType: seriesType, secondaryAxis: false };\r\n        });\r\n    }\r\n}\r\n", "import type { AgCartesianAxisOptions, AgCartesianChartOptions } from 'ag-charts-types';\r\n\r\nimport { DEFAULT_CHART_CATEGORY } from '../../model/chartDataModel';\r\nimport { CartesianChartProxy } from '../cartesian/cartesianChartProxy';\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\n\r\nexport abstract class StatisticalChartProxy<\r\n    TSeries extends 'box-plot' | 'range-area' | 'range-bar',\r\n> extends CartesianChartProxy<TSeries> {\r\n    protected constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    public getAxes(params: UpdateParams, commonChartOptions: AgCartesianChartOptions): AgCartesianAxisOptions[] {\r\n        return [\r\n            {\r\n                type: this.getXAxisType(params),\r\n                position: this.isHorizontal(commonChartOptions) ? 'left' : 'bottom',\r\n            },\r\n            {\r\n                type: 'number',\r\n                position: this.isHorizontal(commonChartOptions) ? 'bottom' : 'left',\r\n            },\r\n        ];\r\n    }\r\n\r\n    protected computeSeriesStatistics(params: UpdateParams, computeStatsFn: (values: number[]) => any): any[] {\r\n        const { data, fields } = params;\r\n        const [category] = params.categories;\r\n        const categoryKey = category.id || DEFAULT_CHART_CATEGORY;\r\n        const groupedData = this.groupDataByCategory(categoryKey, data);\r\n\r\n        return Array.from(groupedData).map(([categoryValue, categoryData]) => {\r\n            const categoryResult = { [category.id]: categoryValue };\r\n\r\n            fields.forEach((field, seriesIndex) => {\r\n                // `null` & `NaN` values are omitted from calculations\r\n                const seriesValues = categoryData\r\n                    .map((datum) => datum[field.colId])\r\n                    .filter((value) => typeof value === 'number' && !isNaN(value));\r\n\r\n                Object.entries(computeStatsFn(seriesValues)).forEach(([statKey, value]) => {\r\n                    const propertyKey = `${statKey}:${seriesIndex}`;\r\n                    // when no data exists, stat properties are added to results with `null` values!\r\n                    categoryResult[propertyKey] = seriesValues.length > 0 ? value : null;\r\n                });\r\n            });\r\n\r\n            return categoryResult;\r\n        });\r\n    }\r\n\r\n    protected groupDataByCategory(categoryKey: string, data: any[]): Map<any, any[]> {\r\n        const getCategory = (datum: any) => {\r\n            if (categoryKey === DEFAULT_CHART_CATEGORY) {\r\n                return 1;\r\n            }\r\n            const categoryValue = datum[categoryKey];\r\n            if (categoryValue === null || categoryValue === undefined) {\r\n                return ''; // use a blank category for `null` or `undefined` values\r\n            }\r\n            return categoryValue instanceof Date ? categoryValue.getTime() : categoryValue;\r\n        };\r\n\r\n        return data.reduce((acc, datum) => {\r\n            const category = getCategory(datum);\r\n            const existingCategoryData = acc.get(category);\r\n            if (existingCategoryData) {\r\n                existingCategoryData.push(datum);\r\n            } else {\r\n                acc.set(category, [datum]);\r\n            }\r\n            return acc;\r\n        }, new Map<string | null, any[]>());\r\n    }\r\n}\r\n", "import type { AgBoxPlotSeriesOptions } from 'ag-charts-types';\r\n\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { StatisticalChartProxy } from './statisticalChartProxy';\r\n\r\nexport class BoxPlotChartProxy extends StatisticalChartProxy<'box-plot'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    public getSeries(params: UpdateParams): AgBoxPlotSeriesOptions<any>[] {\r\n        const [category] = params.categories;\r\n        return params.fields.map((field, seriesIndex) => ({\r\n            type: this.standaloneChartType as AgBoxPlotSeriesOptions['type'],\r\n            // xKey/xName refer to category buckets\r\n            xKey: category.id,\r\n            xName: category.name,\r\n            // yName is used to label the series\r\n            yName: field.displayName ?? undefined,\r\n            // custom field labels shown in the tooltip\r\n            minName: 'Min',\r\n            q1Name: 'Q1',\r\n            medianName: 'Median',\r\n            q3Name: 'Q3',\r\n            maxName: 'Max',\r\n            // generated 'synthetic fields' from getData()\r\n            minKey: `min:${seriesIndex}`,\r\n            q1Key: `q1:${seriesIndex}`,\r\n            medianKey: `median:${seriesIndex}`,\r\n            q3Key: `q3:${seriesIndex}`,\r\n            maxKey: `max:${seriesIndex}`,\r\n        }));\r\n    }\r\n\r\n    protected override getData(params: UpdateParams): any[] {\r\n        return this.computeSeriesStatistics(params, (seriesValues: number[]): Record<string, number> => {\r\n            const sortedValues = seriesValues.sort((a, b) => a - b);\r\n            return {\r\n                min: sortedValues[0],\r\n                q1: this.quantile(sortedValues, 0.25),\r\n                median: this.quantile(sortedValues, 0.5),\r\n                q3: this.quantile(sortedValues, 0.75),\r\n                max: sortedValues[sortedValues.length - 1],\r\n            };\r\n        });\r\n    }\r\n\r\n    private quantile(sortedValues: number[], q: number): number {\r\n        const position = (sortedValues.length - 1) * q;\r\n        const indexBelow = Math.floor(position);\r\n        const aboveValue = position - indexBelow;\r\n        if (sortedValues[indexBelow + 1] !== undefined) {\r\n            return sortedValues[indexBelow] + aboveValue * (sortedValues[indexBelow + 1] - sortedValues[indexBelow]);\r\n        }\r\n        return sortedValues[indexBelow];\r\n    }\r\n}\r\n", "import type { AgRangeAreaSeriesOptions } from 'ag-charts-types';\r\n\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { StatisticalChartProxy } from './statisticalChartProxy';\r\n\r\nexport class RangeChartProxy extends StatisticalChartProxy<'range-bar' | 'range-area'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    public getSeries(params: UpdateParams): AgRangeAreaSeriesOptions<any>[] {\r\n        const [category] = params.categories;\r\n        return params.fields.map((field, seriesIndex) => ({\r\n            type: this.standaloneChartType as AgRangeAreaSeriesOptions['type'],\r\n            // xKey/xName refer to category buckets\r\n            xKey: category.id,\r\n            xName: category.name,\r\n            // yName is used to label the series\r\n            yName: field.displayName ?? undefined,\r\n            // custom field labels shown in the tooltip\r\n            yLowName: 'Min',\r\n            yHighName: 'Max',\r\n            // generated 'synthetic fields' from getData()\r\n            yLowKey: `min:${seriesIndex}`,\r\n            yHighKey: `max:${seriesIndex}`,\r\n        }));\r\n    }\r\n\r\n    protected override getData(params: UpdateParams): any[] {\r\n        return this.computeSeriesStatistics(params, (seriesValues: number[]): Record<string, number> => {\r\n            return {\r\n                min: Math.min(...seriesValues),\r\n                max: Math.max(...seriesValues),\r\n            };\r\n        });\r\n    }\r\n}\r\n", "import type { NamedBean } from 'ag-grid-community';\r\nimport { BeanStub, TabGuardComp, _findFocusableElements, _findNextFocusableElement } from 'ag-grid-community';\r\n\r\nimport { AgDialog } from '../../../../widgets/agDialog';\r\nimport type { ChartTranslationService } from '../../services/chartTranslationService';\r\nimport type { ChartMenuContext } from '../chartMenuContext';\r\nimport { AdvancedSettingsPanel } from './advancedSettingsPanel';\r\n\r\nexport class AdvancedSettingsMenuFactory extends BeanStub implements NamedBean {\r\n    beanName = 'advSettingsMenuFactory' as const;\r\n\r\n    private activeMenu?: AdvancedSettingsMenu;\r\n    private activeDialog?: AgDialog;\r\n\r\n    public showMenu(chartMenuContext: ChartMenuContext, eventSource?: HTMLElement): void {\r\n        this.hideMenu();\r\n\r\n        const menu = this.createBean(new AdvancedSettingsMenu(chartMenuContext));\r\n\r\n        this.activeDialog = this.createBean(\r\n            new AgDialog({\r\n                title: (this.beans.chartTranslation as ChartTranslationService).translate('advancedSettings'),\r\n                component: menu,\r\n                width: 300,\r\n                height: 400,\r\n                resizable: true,\r\n                movable: true,\r\n                centered: true,\r\n                closable: true,\r\n                afterGuiAttached: () => {\r\n                    _findFocusableElements(menu.getGui())[0]?.focus();\r\n                },\r\n                closedCallback: () => {\r\n                    this.activeMenu = this.destroyBean(this.activeMenu);\r\n                    this.activeDialog = undefined;\r\n                    eventSource?.focus({ preventScroll: true });\r\n                },\r\n            })\r\n        );\r\n\r\n        this.activeMenu = menu;\r\n    }\r\n\r\n    public hideMenu(): void {\r\n        if (this.activeDialog) {\r\n            this.destroyBean(this.activeDialog);\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.activeMenu = this.destroyBean(this.activeMenu);\r\n        this.activeDialog = this.destroyBean(this.activeDialog);\r\n        super.destroy();\r\n    }\r\n}\r\n\r\nclass AdvancedSettingsMenu extends TabGuardComp {\r\n    private advancedSettingsPanel: AdvancedSettingsPanel;\r\n\r\n    constructor(private readonly chartMenuContext: ChartMenuContext) {\r\n        super(/* html */ `<div class=\"ag-chart-advanced-settings\"></div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.advancedSettingsPanel = this.createManagedBean(new AdvancedSettingsPanel(this.chartMenuContext));\r\n        this.getGui().appendChild(this.advancedSettingsPanel.getGui());\r\n        this.initialiseTabGuard({\r\n            onTabKeyDown: this.onTabKeyDown.bind(this),\r\n            focusTrapActive: true,\r\n        });\r\n    }\r\n\r\n    protected onTabKeyDown(e: KeyboardEvent) {\r\n        if (e.defaultPrevented) {\r\n            return;\r\n        }\r\n\r\n        e.preventDefault();\r\n\r\n        const backwards = e.shiftKey;\r\n        const panelGui = this.advancedSettingsPanel.getGui();\r\n        const nextEl = _findNextFocusableElement(this.beans, panelGui, false, backwards);\r\n\r\n        if (nextEl) {\r\n            nextEl.focus();\r\n        } else {\r\n            const focusableElements = _findFocusableElements(panelGui);\r\n            if (focusableElements.length) {\r\n                focusableElements[backwards ? focusableElements.length - 1 : 0].focus();\r\n            }\r\n        }\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { ChartSeriesType } from '../../utils/seriesTypeMapper';\r\nimport { isCartesian } from '../../utils/seriesTypeMapper';\r\nimport type { ChartMenuContext } from '../chartMenuContext';\r\nimport { ChartPanelFeature } from '../chartPanelFeature';\r\nimport { AnimationPanel } from './interactivity/animationPanel';\r\nimport { CrosshairPanel } from './interactivity/crosshairPanel';\r\nimport { NavigatorPanel } from './interactivity/navigatorPanel';\r\nimport { ZoomPanel } from './interactivity/zoomPanel';\r\n\r\nconst INTERACTIVITY_GROUPS = ['navigator', 'zoom', 'animation', 'crosshair'] as const;\r\n\r\ntype ChartInteractivityGroup = (typeof INTERACTIVITY_GROUPS)[number];\r\n\r\nexport class AdvancedSettingsPanel extends Component {\r\n    private chartPanelFeature: ChartPanelFeature;\r\n\r\n    constructor(private readonly chartMenuContext: ChartMenuContext) {\r\n        super(/* html */ `<div class=\"ag-chart-advanced-settings-wrapper\"></div>`);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.chartPanelFeature = this.createManagedBean(\r\n            new ChartPanelFeature(\r\n                this.chartMenuContext.chartController,\r\n                this.getGui(),\r\n                'ag-chart-advanced-settings-section',\r\n                (chartType, seriesType) => this.createPanels(chartType, seriesType)\r\n            )\r\n        );\r\n        this.chartPanelFeature.refreshPanels();\r\n    }\r\n\r\n    private createPanels(chartType: ChartType, seriesType: ChartSeriesType): void {\r\n        INTERACTIVITY_GROUPS.forEach((group) => {\r\n            if (!this.isGroupPanelShownForSeries(group, seriesType)) {\r\n                return;\r\n            }\r\n\r\n            const comp = this.createPanel(group);\r\n            this.chartPanelFeature.addComponent(comp);\r\n        });\r\n    }\r\n\r\n    private isGroupPanelShownForSeries(group: ChartInteractivityGroup, seriesType: ChartSeriesType): boolean {\r\n        return group === 'animation' || isCartesian(seriesType);\r\n    }\r\n\r\n    private createPanel(group: ChartInteractivityGroup): Component {\r\n        const { chartMenuParamsFactory, chartAxisMenuParamsFactory } = this.chartMenuContext;\r\n        switch (group) {\r\n            case 'navigator':\r\n                return new NavigatorPanel(chartMenuParamsFactory);\r\n            case 'zoom':\r\n                return new ZoomPanel(chartMenuParamsFactory);\r\n            case 'animation':\r\n                return new AnimationPanel(chartMenuParamsFactory);\r\n            case 'crosshair':\r\n                return new CrosshairPanel(chartAxisMenuParamsFactory);\r\n        }\r\n    }\r\n}\r\n", "import type { ChartType, Component } from 'ag-grid-community';\r\nimport { BeanStub, _removeFromParent } from 'ag-grid-community';\r\n\r\nimport type { ChartController } from '../chartController';\r\nimport type { ChartSeriesType } from '../utils/seriesTypeMapper';\r\nimport { getSeriesType } from '../utils/seriesTypeMapper';\r\n\r\nexport class ChartPanelFeature extends BeanStub {\r\n    private chartType: ChartType;\r\n    private isGrouping: boolean;\r\n    private panels: Component[] = [];\r\n\r\n    constructor(\r\n        private readonly chartController: ChartController,\r\n        private readonly eGui: HTMLElement,\r\n        private readonly cssClass: string,\r\n        private readonly createPanels: (chartType: ChartType, seriesType: ChartSeriesType) => void\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.addManagedListeners(this.chartController, {\r\n            chartUpdated: () => this.refreshPanels(true),\r\n            chartApiUpdate: () => this.refreshPanels(false),\r\n        });\r\n    }\r\n\r\n    public addComponent(component: Component): void {\r\n        this.createBean(component);\r\n        this.panels.push(component);\r\n        component.addCssClass(this.cssClass);\r\n        this.eGui.appendChild(component.getGui());\r\n    }\r\n\r\n    public refreshPanels(reuse?: boolean) {\r\n        const chartType = this.chartController.getChartType();\r\n        const isGrouping = this.chartController.isGrouping();\r\n        const seriesType = getSeriesType(chartType);\r\n\r\n        if (reuse && chartType === this.chartType && isGrouping === this.isGrouping) {\r\n            // existing panels can be re-used\r\n            return;\r\n        }\r\n\r\n        this.destroyPanels();\r\n\r\n        this.createPanels(chartType, seriesType);\r\n\r\n        this.chartType = chartType;\r\n        this.isGrouping = isGrouping;\r\n    }\r\n\r\n    private destroyPanels(): void {\r\n        this.panels.forEach((panel) => {\r\n            _removeFromParent(panel.getGui());\r\n            this.destroyBean(panel);\r\n        });\r\n        this.panels = [];\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyPanels();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { AgInputNumberFieldSelector, Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class AnimationPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    constructor(private readonly chartMenuParamsFactory: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const animationGroupParams = this.chartMenuParamsFactory.addEnableParams<AgGroupComponentParams>(\r\n            'animation.enabled',\r\n            {\r\n                cssIdentifier: 'charts-advanced-settings-top-level',\r\n                direction: 'vertical',\r\n                suppressOpenCloseIcons: true,\r\n                title: this.chartTranslation.translate('animation'),\r\n                suppressEnabledCheckbox: true,\r\n                useToggle: true,\r\n            }\r\n        );\r\n        const animationHeightInputParams = this.chartMenuParamsFactory.getDefaultNumberInputParams(\r\n            'animation.duration',\r\n            'durationMillis',\r\n            {\r\n                min: 0,\r\n            }\r\n        );\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"animationGroup\">\r\n                <ag-input-number-field data-ref=\"animationHeightInput\"></ag-input>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgInputNumberFieldSelector],\r\n            {\r\n                animationGroup: animationGroupParams,\r\n                animationHeightInput: animationHeightInputParams,\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { AgCheckboxSelector, Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class CrosshairPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    constructor(private readonly chartMenuParamsFactory: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const crosshairGroupParams = this.chartMenuParamsFactory.addEnableParams<AgGroupComponentParams>(\r\n            'crosshair.enabled',\r\n            {\r\n                cssIdentifier: 'charts-advanced-settings-top-level',\r\n                direction: 'vertical',\r\n                suppressOpenCloseIcons: true,\r\n                title: this.chartTranslation.translate('crosshair'),\r\n                suppressEnabledCheckbox: true,\r\n                useToggle: true,\r\n            }\r\n        );\r\n        const crosshairLabelCheckboxParams = this.chartMenuParamsFactory.getDefaultCheckboxParams(\r\n            'crosshair.label.enabled',\r\n            'crosshairLabel'\r\n        );\r\n        const crosshairSnapCheckboxParams = this.chartMenuParamsFactory.getDefaultCheckboxParams(\r\n            'crosshair.snap',\r\n            'crosshairSnap'\r\n        );\r\n        const crosshairStrokeColorPickerParams = this.chartMenuParamsFactory.getDefaultColorPickerParams(\r\n            'crosshair.stroke',\r\n            'color'\r\n        );\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"crosshairGroup\">\r\n                <ag-checkbox data-ref=\"crosshairLabelCheckbox\"></ag-checkbox>\r\n                <ag-checkbox data-ref=\"crosshairSnapCheckbox\"></ag-checkbox>\r\n                <ag-color-picker data-ref=\"crosshairStrokeColorPicker\"></ag-color-picker>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgCheckboxSelector, AgColorPickerSelector],\r\n            {\r\n                crosshairGroup: crosshairGroupParams,\r\n                crosshairLabelCheckbox: crosshairLabelCheckboxParams,\r\n                crosshairSnapCheckbox: crosshairSnapCheckboxParams,\r\n                crosshairStrokeColorPicker: crosshairStrokeColorPickerParams,\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { AgPickerFieldParams, ComponentSelector } from 'ag-grid-community';\r\nimport { AgPickerField, _getDocument } from 'ag-grid-community';\r\n\r\nimport { AgDialog } from '../../widgets/agDialog';\r\nimport type { AgChartsExports } from '../agChartsExports';\r\nimport { AgColorPanel } from './agColorPanel';\r\n\r\nexport interface AgColorPickerParams\r\n    extends Omit<AgPickerFieldParams, 'pickerType' | 'pickerAriaLabelKey' | 'pickerAriaLabelValue'> {\r\n    pickerType?: string;\r\n    pickerAriaLabelKey?: string;\r\n    pickerAriaLabelValue?: string;\r\n}\r\n\r\nexport class AgColorPicker extends AgPickerField<string, AgColorPickerParams & AgPickerFieldParams, string, AgDialog> {\r\n    private isDestroyingPicker: boolean;\r\n    private eDisplayFieldColor: HTMLElement;\r\n    private eDisplayFieldText: HTMLElement;\r\n\r\n    constructor(config?: AgColorPickerParams) {\r\n        super({\r\n            pickerAriaLabelKey: 'ariaLabelColorPicker',\r\n            pickerAriaLabelValue: 'Color Picker',\r\n            pickerType: 'ag-list',\r\n            className: 'ag-color-picker',\r\n            pickerIcon: 'chartsColorPicker',\r\n            ...config,\r\n        });\r\n    }\r\n\r\n    public override postConstruct() {\r\n        const eDocument = _getDocument(this.beans);\r\n        this.eDisplayFieldColor = eDocument.createElement('span');\r\n        this.eDisplayFieldColor.classList.add('ag-color-picker-color');\r\n        this.eDisplayFieldText = eDocument.createElement('span');\r\n        this.eDisplayFieldText.classList.add('ag-color-picker-value');\r\n        this.eDisplayField.appendChild(this.eDisplayFieldColor);\r\n        this.eDisplayField.appendChild(this.eDisplayFieldText);\r\n\r\n        super.postConstruct();\r\n\r\n        if (this.value) {\r\n            this.setValue(this.value);\r\n        }\r\n    }\r\n\r\n    protected createPickerComponent() {\r\n        const eGuiRect = this.eWrapper.getBoundingClientRect();\r\n        const parentRect = this.beans.popupSvc!.getParentRect();\r\n\r\n        const colorDialog = this.createBean(\r\n            new AgDialog({\r\n                closable: false,\r\n                modal: true,\r\n                hideTitleBar: true,\r\n                minWidth: 190,\r\n                width: 190,\r\n                height: 250,\r\n                x: eGuiRect.right - parentRect.left - 190,\r\n                y: eGuiRect.top - parentRect.top - 250 - (this.config.pickerGap ?? 0),\r\n                postProcessPopupParams: {\r\n                    type: 'colorPicker',\r\n                    eventSource: this.eWrapper,\r\n                },\r\n            })\r\n        );\r\n\r\n        return colorDialog;\r\n    }\r\n\r\n    protected override renderAndPositionPicker(): () => void {\r\n        const pickerComponent = this.pickerComponent!;\r\n        const colorPanel = this.createBean(new AgColorPanel({ picker: this }));\r\n\r\n        pickerComponent.addCssClass('ag-color-dialog');\r\n\r\n        colorPanel.addDestroyFunc(() => {\r\n            if (pickerComponent.isAlive()) {\r\n                this.destroyBean(pickerComponent);\r\n            }\r\n        });\r\n\r\n        pickerComponent.setParentComponent(this);\r\n        pickerComponent.setBodyComponent(colorPanel);\r\n        colorPanel.setValue(this.getValue());\r\n        colorPanel.getGui().focus();\r\n\r\n        pickerComponent.addDestroyFunc(() => {\r\n            // here we check if the picker was already being\r\n            // destroyed to avoid a stack overflow\r\n            if (!this.isDestroyingPicker) {\r\n                this.beforeHidePicker();\r\n                this.isDestroyingPicker = true;\r\n\r\n                if (colorPanel.isAlive()) {\r\n                    this.destroyBean(colorPanel);\r\n                }\r\n\r\n                if (this.isAlive()) {\r\n                    this.getFocusableElement().focus();\r\n                }\r\n            } else {\r\n                this.isDestroyingPicker = false;\r\n            }\r\n        });\r\n\r\n        return () => this.pickerComponent?.close();\r\n    }\r\n\r\n    public override setValue(color: string): this {\r\n        if (this.value === color) {\r\n            return this;\r\n        }\r\n\r\n        this.eDisplayFieldColor.style.backgroundColor = color;\r\n        this.eDisplayFieldText.textContent = (this.beans.agChartsExports as AgChartsExports)._Util.Color.fromString(\r\n            color\r\n        )\r\n            .toHexString()\r\n            .toUpperCase();\r\n\r\n        return super.setValue(color);\r\n    }\r\n\r\n    public override getValue(): string {\r\n        return this.value;\r\n    }\r\n}\r\n\r\nexport const AgColorPickerSelector: ComponentSelector = {\r\n    selector: 'AG-COLOR-PICKER',\r\n    component: AgColorPicker,\r\n};\r\n", "import type { IColor, _IUtil } from 'ag-charts-types';\r\n\r\nimport type { BeanCollection } from 'ag-grid-community';\r\nimport { Component, KeyCode, RefPlaceholder, _exists, _setDisplayed } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../agChartsExports';\r\nimport type { AgColorInput } from './agColorInput';\r\nimport { AgColorInputSelector } from './agColorInput';\r\nimport type { AgColorPicker } from './agColorPicker';\r\n\r\nconst maxRecentColors = 8;\r\n\r\nlet sharedRecentColors: string[] = [];\r\n\r\nexport class AgColorPanel extends Component {\r\n    private H = 1; // in the [0, 1] range\r\n    private S = 1; // in the [0, 1] range\r\n    private B = 1; // in the [0, 1] range\r\n    private A = 1; // in the [0, 1] range\r\n\r\n    private spectrumValRect?: ClientRect | DOMRect;\r\n    private isSpectrumDragging = false;\r\n\r\n    private spectrumHueRect?: ClientRect | DOMRect;\r\n    private isSpectrumHueDragging = false;\r\n\r\n    private spectrumAlphaRect?: ClientRect | DOMRect;\r\n    private isSpectrumAlphaDragging = false;\r\n\r\n    private picker: Component;\r\n    private _Color: _IUtil['Color'];\r\n\r\n    private colorChanged = false;\r\n    private tabIndex: string;\r\n\r\n    private readonly spectrumColor: HTMLElement = RefPlaceholder;\r\n    private readonly spectrumVal: HTMLElement = RefPlaceholder;\r\n    private readonly spectrumDragger: HTMLElement = RefPlaceholder;\r\n    private readonly spectrumHue: HTMLElement = RefPlaceholder;\r\n    private readonly spectrumHueSlider: HTMLElement = RefPlaceholder;\r\n    private readonly spectrumAlpha: HTMLElement = RefPlaceholder;\r\n    private readonly spectrumAlphaSlider: HTMLElement = RefPlaceholder;\r\n    private readonly colorInput: AgColorInput = RefPlaceholder;\r\n    private readonly recentColors: HTMLElement = RefPlaceholder;\r\n\r\n    constructor(config: { picker: Component<any> }) {\r\n        super(\r\n            /* html */ `<div class=\"ag-color-panel\" tabindex=\"-1\">\r\n            <div data-ref=\"spectrumColor\" class=\"ag-spectrum-color\">\r\n                <div class=\"ag-spectrum-sat ag-spectrum-fill\">\r\n                    <div data-ref=\"spectrumVal\" class=\"ag-spectrum-val ag-spectrum-fill\">\r\n                        <div data-ref=\"spectrumDragger\" class=\"ag-spectrum-dragger\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"ag-spectrum-tools\">\r\n                <div data-ref=\"spectrumHue\" class=\"ag-spectrum-hue ag-spectrum-tool\">\r\n                    <div class=\"ag-spectrum-hue-background\"></div>\r\n                    <div data-ref=\"spectrumHueSlider\" class=\"ag-spectrum-slider\"></div>\r\n                </div>\r\n                <div data-ref=\"spectrumAlpha\" class=\"ag-spectrum-alpha ag-spectrum-tool\">\r\n                    <div class=\"ag-spectrum-alpha-background\"></div>\r\n                    <div data-ref=\"spectrumAlphaSlider\" class=\"ag-spectrum-slider\"></div>\r\n                </div>\r\n                <ag-color-input data-ref=\"colorInput\"></ag-color-input>\r\n                <div data-ref=\"recentColors\" class=\"ag-recent-colors\"></div>\r\n            </div>\r\n        </div>`,\r\n            [AgColorInputSelector]\r\n        );\r\n        this.picker = config.picker;\r\n    }\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this._Color = (beans.agChartsExports as AgChartsExports)._Util.Color;\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.initTabIndex();\r\n        this.initRecentColors();\r\n\r\n        this.addGuiEventListener('focus', () => this.spectrumColor.focus());\r\n        this.addGuiEventListener('keydown', (e: KeyboardEvent) => {\r\n            if (e.key === KeyCode.ENTER && !e.defaultPrevented) {\r\n                this.destroy();\r\n            }\r\n        });\r\n\r\n        this.addManagedListeners(this.spectrumColor, { keydown: (e) => this.moveDragger(e) });\r\n        this.addManagedListeners(this.spectrumAlphaSlider, { keydown: (e) => this.moveAlphaSlider(e) });\r\n        this.addManagedListeners(this.spectrumHueSlider, { keydown: (e) => this.moveHueSlider(e) });\r\n\r\n        this.addManagedListeners(this.spectrumVal, { mousedown: this.onSpectrumDraggerDown.bind(this) });\r\n        this.addManagedListeners(this.spectrumHue, { mousedown: this.onSpectrumHueDown.bind(this) });\r\n        this.addManagedListeners(this.spectrumAlpha, { mousedown: this.onSpectrumAlphaDown.bind(this) });\r\n\r\n        this.addGuiEventListener('mousemove', (e: MouseEvent) => {\r\n            this.onSpectrumDraggerMove(e);\r\n            this.onSpectrumHueMove(e);\r\n            this.onSpectrumAlphaMove(e);\r\n        });\r\n\r\n        // Listening to `mouseup` on the document on purpose. The user might release the mouse button\r\n        // outside the UI control. When the mouse returns back to the control's area, the dragging\r\n        // of the thumb is not expected and seen as a bug.\r\n        this.addManagedListeners(document, { mouseup: this.onMouseUp.bind(this) });\r\n\r\n        this.colorInput.onColorChanged(this.setColor.bind(this));\r\n\r\n        this.addManagedListeners(this.recentColors, {\r\n            click: this.onRecentColorClick.bind(this),\r\n            keydown: (e: KeyboardEvent) => {\r\n                if (e.key === KeyCode.ENTER || e.key === KeyCode.SPACE) {\r\n                    e.preventDefault();\r\n                    this.onRecentColorClick(e);\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    private initTabIndex(): void {\r\n        const tabIndex = (this.tabIndex = this.gos.get('tabIndex').toString());\r\n\r\n        this.spectrumColor.setAttribute('tabindex', tabIndex);\r\n        this.spectrumHueSlider.setAttribute('tabindex', tabIndex);\r\n        this.spectrumAlphaSlider.setAttribute('tabindex', tabIndex);\r\n    }\r\n\r\n    private refreshSpectrumRect() {\r\n        return (this.spectrumValRect = this.spectrumVal.getBoundingClientRect());\r\n    }\r\n\r\n    private refreshHueRect() {\r\n        return (this.spectrumHueRect = this.spectrumHue.getBoundingClientRect());\r\n    }\r\n\r\n    private refreshAlphaRect() {\r\n        return (this.spectrumAlphaRect = this.spectrumAlpha.getBoundingClientRect());\r\n    }\r\n\r\n    private onSpectrumDraggerDown(e: MouseEvent) {\r\n        e.preventDefault();\r\n        this.refreshSpectrumRect();\r\n        this.isSpectrumDragging = true;\r\n\r\n        this.moveDragger(e);\r\n    }\r\n\r\n    private onSpectrumDraggerMove(e: MouseEvent) {\r\n        if (this.isSpectrumDragging) {\r\n            this.moveDragger(e);\r\n        }\r\n    }\r\n\r\n    private onSpectrumHueDown(e: MouseEvent) {\r\n        this.refreshHueRect();\r\n        this.isSpectrumHueDragging = true;\r\n\r\n        this.moveHueSlider(e);\r\n    }\r\n\r\n    private onSpectrumHueMove(e: MouseEvent) {\r\n        if (this.isSpectrumHueDragging) {\r\n            this.moveHueSlider(e);\r\n        }\r\n    }\r\n\r\n    private onSpectrumAlphaDown(e: MouseEvent) {\r\n        this.refreshAlphaRect();\r\n        this.isSpectrumAlphaDragging = true;\r\n\r\n        this.moveAlphaSlider(e);\r\n    }\r\n\r\n    private onSpectrumAlphaMove(e: MouseEvent) {\r\n        if (this.isSpectrumAlphaDragging) {\r\n            this.moveAlphaSlider(e);\r\n        }\r\n    }\r\n\r\n    private onMouseUp() {\r\n        this.isSpectrumDragging = false;\r\n        this.isSpectrumHueDragging = false;\r\n        this.isSpectrumAlphaDragging = false;\r\n    }\r\n\r\n    private moveDragger(e: MouseEvent | KeyboardEvent) {\r\n        const valRect = this.spectrumValRect;\r\n        if (!valRect) {\r\n            return;\r\n        }\r\n\r\n        let x: number;\r\n        let y: number;\r\n\r\n        if (e instanceof MouseEvent) {\r\n            x = e.clientX - valRect.left;\r\n            y = e.clientY - valRect.top;\r\n        } else {\r\n            const isLeft = e.key === KeyCode.LEFT;\r\n            const isRight = e.key === KeyCode.RIGHT;\r\n            const isUp = e.key === KeyCode.UP;\r\n            const isDown = e.key === KeyCode.DOWN;\r\n            const isVertical = isUp || isDown;\r\n            const isHorizontal = isLeft || isRight;\r\n\r\n            if (!isVertical && !isHorizontal) {\r\n                return;\r\n            }\r\n            e.preventDefault();\r\n\r\n            const { x: currentX, y: currentY } = this.getSpectrumValue();\r\n            x = currentX + (isHorizontal ? (isLeft ? -5 : 5) : 0);\r\n            y = currentY + (isVertical ? (isUp ? -5 : 5) : 0);\r\n        }\r\n\r\n        x = Math.max(x, 0);\r\n        x = Math.min(x, valRect.width);\r\n        y = Math.max(y, 0);\r\n        y = Math.min(y, valRect.height);\r\n\r\n        this.setSpectrumValue(x / valRect.width, 1 - y / valRect.height);\r\n    }\r\n\r\n    private moveHueSlider(e: MouseEvent | KeyboardEvent) {\r\n        const rect = this.spectrumHueRect;\r\n\r\n        if (!rect) {\r\n            return;\r\n        }\r\n\r\n        const x = this.moveSlider(this.spectrumHueSlider, e);\r\n\r\n        if (x == null) {\r\n            return;\r\n        }\r\n\r\n        this.H = 1 - x / rect.width;\r\n        this.update();\r\n    }\r\n\r\n    private moveAlphaSlider(e: MouseEvent | KeyboardEvent) {\r\n        const rect = this.spectrumAlphaRect;\r\n\r\n        if (!rect) {\r\n            return;\r\n        }\r\n\r\n        const x = this.moveSlider(this.spectrumAlphaSlider, e);\r\n\r\n        if (x == null) {\r\n            return;\r\n        }\r\n\r\n        this.A = x / rect.width;\r\n        this.update();\r\n    }\r\n\r\n    private moveSlider(slider: HTMLElement, e: MouseEvent | KeyboardEvent): number | null {\r\n        const sliderRect = slider.getBoundingClientRect();\r\n        const parentRect = slider.parentElement?.getBoundingClientRect();\r\n\r\n        if (!slider || !parentRect) {\r\n            return null;\r\n        }\r\n\r\n        const offset = sliderRect.width / 2;\r\n\r\n        let x: number;\r\n        if (e instanceof MouseEvent) {\r\n            x = Math.floor(e.clientX - parentRect.left);\r\n        } else {\r\n            const isLeft = e.key === KeyCode.LEFT;\r\n            const isRight = e.key === KeyCode.RIGHT;\r\n            if (!isLeft && !isRight) {\r\n                return null;\r\n            }\r\n            e.preventDefault();\r\n            const diff = isLeft ? -5 : 5;\r\n            x = parseFloat(slider.style.left) + offset + diff;\r\n        }\r\n\r\n        x = Math.max(x, 0);\r\n        x = Math.min(x, parentRect.width);\r\n\r\n        slider.style.left = x - offset + 'px';\r\n\r\n        return x;\r\n    }\r\n\r\n    private update(suppressColorInputUpdate?: boolean) {\r\n        const { A, S, B, H, _Color } = this;\r\n        const hue = H * 360;\r\n        const color = _Color.fromHSB(hue, S, B, A);\r\n        const rgbaColor = color.toRgbaString();\r\n        const colorWithoutAlpha = _Color.fromHSB(hue, S, B);\r\n        const rgbaColorWithoutAlpha = colorWithoutAlpha.toRgbaString();\r\n        const spectrumColor = _Color.fromHSB(hue, 1, 1);\r\n        const spectrumRgbaColor = spectrumColor.toRgbaString();\r\n\r\n        // the recent color list needs to know color has actually changed\r\n        const colorPicker = this.picker as AgColorPicker;\r\n\r\n        const existingColor = _Color.fromString(colorPicker.getValue());\r\n        if (existingColor.toRgbaString() !== rgbaColor) {\r\n            this.colorChanged = true;\r\n        }\r\n\r\n        colorPicker.setValue(rgbaColor);\r\n\r\n        this.spectrumColor.style.backgroundColor = spectrumRgbaColor;\r\n        this.spectrumDragger.style.backgroundColor = rgbaColorWithoutAlpha;\r\n\r\n        this.spectrumHueSlider.style.backgroundColor = spectrumRgbaColor;\r\n\r\n        this.spectrumAlpha.style.setProperty(\r\n            '--ag-internal-spectrum-alpha-color-from',\r\n            _Color.fromHSB(hue, S, B, 0).toRgbaString()\r\n        );\r\n        this.spectrumAlpha.style.setProperty('--ag-internal-spectrum-alpha-color-to', rgbaColorWithoutAlpha);\r\n        this.spectrumAlpha.style.setProperty('--ag-internal-spectrum-alpha-color', rgbaColor);\r\n\r\n        if (!suppressColorInputUpdate) {\r\n            this.colorInput.setColor(color);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param saturation In the [0, 1] interval.\r\n     * @param brightness In the [0, 1] interval.\r\n     */\r\n    public setSpectrumValue(saturation: number, brightness: number, suppressColorInputUpdate?: boolean) {\r\n        const valRect = this.spectrumValRect || this.refreshSpectrumRect();\r\n\r\n        if (valRect == null) {\r\n            return;\r\n        }\r\n\r\n        const dragger = this.spectrumDragger;\r\n        const draggerRect = dragger.getBoundingClientRect();\r\n\r\n        saturation = Math.max(0, saturation);\r\n        saturation = Math.min(1, saturation);\r\n        brightness = Math.max(0, brightness);\r\n        brightness = Math.min(1, brightness);\r\n\r\n        this.S = saturation;\r\n        this.B = brightness;\r\n\r\n        dragger.style.left = saturation * valRect.width - draggerRect.width / 2 + 'px';\r\n        dragger.style.top = (1 - brightness) * valRect.height - draggerRect.height / 2 + 'px';\r\n\r\n        this.update(suppressColorInputUpdate);\r\n    }\r\n\r\n    private getSpectrumValue(): { x: number; y: number } {\r\n        const dragger = this.spectrumDragger;\r\n        const draggerRect = dragger.getBoundingClientRect();\r\n\r\n        const x = parseFloat(dragger.style.left) + draggerRect.width / 2;\r\n        const y = parseFloat(dragger.style.top) + draggerRect.height / 2;\r\n\r\n        return { x, y };\r\n    }\r\n\r\n    private initRecentColors() {\r\n        const recentColors = sharedRecentColors;\r\n        const innerHtml = recentColors.map((color: string, index: number) => {\r\n            return /* html */ `<div class=\"ag-recent-color\" id=${index} style=\"background-color: ${color}; width: 15px; height: 15px;\" recent-color=\"${color}\" tabIndex=\"${this.tabIndex}\"></div>`;\r\n        });\r\n\r\n        this.recentColors.innerHTML = innerHtml.join('');\r\n        _setDisplayed(this.recentColors, !!recentColors.length);\r\n    }\r\n\r\n    public setValue(val: string): void {\r\n        const color = this._Color.fromString(val);\r\n        this.setColor(color, true);\r\n    }\r\n\r\n    private setColor(color: IColor, updateColorInput?: boolean): void {\r\n        const [h, s, b] = color.toHSB();\r\n\r\n        this.H = (isNaN(h) ? 0 : h) / 360;\r\n        this.A = color.a;\r\n\r\n        const spectrumHueRect = this.spectrumHueRect || this.refreshHueRect();\r\n        const spectrumAlphaRect = this.spectrumAlphaRect || this.refreshAlphaRect();\r\n\r\n        this.spectrumHueSlider.style.left = `${(this.H - 1) * -spectrumHueRect.width - this.spectrumHueSlider.getBoundingClientRect().width / 2}px`;\r\n        this.spectrumAlphaSlider.style.left = `${this.A * spectrumAlphaRect.width - this.spectrumAlphaSlider.getBoundingClientRect().width / 2}px`;\r\n\r\n        this.setSpectrumValue(s, b, !updateColorInput);\r\n    }\r\n\r\n    private onRecentColorClick(e: MouseEvent | KeyboardEvent) {\r\n        const target = e.target as HTMLElement;\r\n\r\n        if (!_exists(target.id)) {\r\n            return;\r\n        }\r\n\r\n        const id = parseInt(target.id, 10);\r\n\r\n        this.setValue(sharedRecentColors[id]);\r\n        this.destroy();\r\n    }\r\n\r\n    private addRecentColor() {\r\n        const color = this._Color.fromHSB(this.H * 360, this.S, this.B, this.A);\r\n        const rgbaColor = color.toRgbaString();\r\n\r\n        let recentColors = sharedRecentColors;\r\n\r\n        if (!this.colorChanged || recentColors[0] === rgbaColor) {\r\n            return;\r\n        }\r\n\r\n        // remove duplicate color\r\n        recentColors = recentColors.filter((currentColor) => currentColor != rgbaColor);\r\n\r\n        // add color to head\r\n        recentColors = [rgbaColor].concat(recentColors);\r\n\r\n        // ensure we don't exceed max number of recent colors\r\n        if (recentColors.length > maxRecentColors) {\r\n            recentColors = recentColors.slice(0, maxRecentColors);\r\n        }\r\n\r\n        sharedRecentColors = recentColors;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.addRecentColor();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { IColor, _IUtil } from 'ag-charts-types';\r\n\r\nimport type { AgInputTextFieldParams, BeanCollection, ComponentSelector } from 'ag-grid-community';\r\nimport { AgInputTextField, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../agChartsExports';\r\nimport type { ChartTranslationService } from '../chartComp/services/chartTranslationService';\r\n\r\nexport type AgColorInputEvent = 'colorChanged';\r\nexport class AgColorInput extends AgInputTextField<AgInputTextFieldParams, AgColorInputEvent> {\r\n    private chartTranslation: ChartTranslationService;\r\n    private color: _IUtil['Color'];\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n        this.color = (beans.agChartsExports as AgChartsExports)._Util.Color;\r\n    }\r\n    private readonly eColor: HTMLElement = RefPlaceholder;\r\n\r\n    constructor() {\r\n        super({\r\n            template: /* html */ `\r\n            <div role=\"presentation\" class=\"ag-color-input\">\r\n                <div data-ref=\"eLabel\" class=\"ag-input-field-label\"></div>\r\n                <div data-ref=\"eWrapper\" class=\"ag-wrapper ag-input-wrapper\" role=\"presentation\">\r\n                    <input data-ref=\"eInput\" class=\"ag-input-field-input\">\r\n                    <div data-ref=\"eColor\" class=\"ag-color-input-color\"></div>\r\n                </div>\r\n            </div>`,\r\n        });\r\n    }\r\n\r\n    public setColor(color: IColor): void {\r\n        const rgbaColor = color.toRgbaString();\r\n        this.setValue(this.color.fromString(rgbaColor).toHexString().toUpperCase(), true);\r\n        this.eColor.style.backgroundColor = rgbaColor;\r\n    }\r\n\r\n    public override setValue(value?: string | null | undefined, silent?: boolean | undefined): this {\r\n        const isValid = this.color.validColorString(value ?? '');\r\n        this.eInput.setCustomValidity(isValid ? '' : this.chartTranslation.translate('invalidColor'));\r\n        super.setValue(value, silent);\r\n        if (isValid && !silent) {\r\n            this.dispatchLocalEvent({ type: 'colorChanged' });\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public onColorChanged(callback: (color: IColor) => void): void {\r\n        this.addManagedListeners(this, { colorChanged: () => callback(this.color.fromString(this.value!)) });\r\n    }\r\n}\r\n\r\nexport const AgColorInputSelector: ComponentSelector = {\r\n    selector: 'AG-COLOR-INPUT',\r\n    component: AgColorInput,\r\n};\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { AgCheckboxSelector, Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class NavigatorPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    constructor(private readonly chartMenuParamsFactory: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const navigatorGroupParams = this.chartMenuParamsFactory.addEnableParams<AgGroupComponentParams>(\r\n            'navigator.enabled',\r\n            {\r\n                cssIdentifier: 'charts-advanced-settings-top-level',\r\n                direction: 'vertical',\r\n                suppressOpenCloseIcons: true,\r\n                title: this.chartTranslation.translate('navigator'),\r\n                suppressEnabledCheckbox: true,\r\n                useToggle: true,\r\n            }\r\n        );\r\n        const navigatorHeightSliderParams = this.chartMenuParamsFactory.getDefaultSliderParams(\r\n            'navigator.height',\r\n            'height',\r\n            60\r\n        );\r\n        navigatorHeightSliderParams.minValue = 10;\r\n        const navigatorMiniChartCheckboxParams = this.chartMenuParamsFactory.getDefaultCheckboxParams(\r\n            'navigator.miniChart.enabled',\r\n            'miniChart'\r\n        );\r\n\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"navigatorGroup\">\r\n                <ag-slider data-ref=\"navigatorHeightSlider\"></ag-slider>\r\n                <ag-checkbox data-ref=\"navigatorMiniChartCheckbox\"></ag-checkbox>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgSliderSelector, AgCheckboxSelector],\r\n            {\r\n                navigatorGroup: navigatorGroupParams,\r\n                navigatorHeightSlider: navigatorHeightSliderParams,\r\n                navigatorMiniChartCheckbox: navigatorMiniChartCheckboxParams,\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { AgInputNumberField, AgLabelParams, ComponentSelector, LabelAlignment } from 'ag-grid-community';\r\nimport { AgAbstractLabel, AgInputNumberFieldSelector, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgInputRange } from './agInputRange';\r\nimport { AgInputRangeSelector } from './agInputRange';\r\n\r\nexport interface AgSliderParams extends AgLabelParams {\r\n    minValue?: number;\r\n    maxValue?: number;\r\n    textFieldWidth?: number;\r\n    step?: number;\r\n    value?: string;\r\n    onValueChange?: (newValue: number) => void;\r\n}\r\n\r\nexport type AgSliderEvent = 'fieldValueChanged';\r\nexport class AgSlider extends AgAbstractLabel<AgSliderParams, AgSliderEvent> {\r\n    protected readonly eLabel: HTMLElement = RefPlaceholder;\r\n    private readonly eSlider: AgInputRange = RefPlaceholder;\r\n    private readonly eText: AgInputNumberField = RefPlaceholder;\r\n\r\n    protected override labelAlignment: LabelAlignment = 'top';\r\n\r\n    constructor(config?: AgSliderParams) {\r\n        super(\r\n            config,\r\n            /* html */ `<div class=\"ag-slider\">\r\n            <label data-ref=\"eLabel\"></label>\r\n            <div class=\"ag-wrapper ag-slider-wrapper\">\r\n                <ag-input-range data-ref=\"eSlider\"></ag-input-range>\r\n                <ag-input-number-field data-ref=\"eText\"></ag-input-number-field>\r\n            </div>\r\n        </div>`,\r\n            [AgInputRangeSelector, AgInputNumberFieldSelector]\r\n        );\r\n    }\r\n\r\n    public override postConstruct() {\r\n        super.postConstruct();\r\n        this.eSlider.addCssClass('ag-slider-field');\r\n        const { minValue, maxValue, textFieldWidth, step, value, onValueChange } = this.config;\r\n        if (minValue != null) {\r\n            this.setMinValue(minValue);\r\n        }\r\n        if (maxValue != null) {\r\n            this.setMaxValue(maxValue);\r\n        }\r\n        if (textFieldWidth != null) {\r\n            this.setTextFieldWidth(textFieldWidth);\r\n        }\r\n        if (step != null) {\r\n            this.setStep(step);\r\n        }\r\n        if (value != null) {\r\n            this.setValue(value);\r\n        }\r\n        if (onValueChange != null) {\r\n            this.onValueChange(onValueChange);\r\n        }\r\n    }\r\n\r\n    public onValueChange(callbackFn: (newValue: number) => void) {\r\n        this.addManagedListeners(this.eText, {\r\n            fieldValueChanged: () => {\r\n                const textValue = parseFloat(this.eText.getValue()!);\r\n                this.eSlider.setValue(textValue.toString(), true);\r\n                callbackFn(textValue || 0);\r\n            },\r\n        });\r\n\r\n        this.addManagedListeners(this.eSlider, {\r\n            fieldValueChanged: () => {\r\n                const sliderValue = this.eSlider.getValue()!;\r\n                this.eText.setValue(sliderValue, true);\r\n                callbackFn(parseFloat(sliderValue));\r\n            },\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    public setSliderWidth(width: number): this {\r\n        this.eSlider.setWidth(width);\r\n        return this;\r\n    }\r\n\r\n    public setTextFieldWidth(width: number): this {\r\n        this.eText.setWidth(width);\r\n        return this;\r\n    }\r\n\r\n    public setMinValue(minValue: number): this {\r\n        this.eSlider.setMinValue(minValue);\r\n        this.eText.setMin(minValue);\r\n\r\n        return this;\r\n    }\r\n\r\n    public setMaxValue(maxValue: number): this {\r\n        this.eSlider.setMaxValue(maxValue);\r\n        this.eText.setMax(maxValue);\r\n        return this;\r\n    }\r\n\r\n    public getValue(): string | null | undefined {\r\n        return this.eText.getValue();\r\n    }\r\n\r\n    public setValue(value: string, silent?: boolean): this {\r\n        if (this.getValue() === value) {\r\n            return this;\r\n        }\r\n\r\n        this.eText.setValue(value, true);\r\n        this.eSlider.setValue(value, true);\r\n\r\n        if (!silent) {\r\n            this.dispatchLocalEvent({ type: 'fieldValueChanged' });\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public setStep(step: number): this {\r\n        this.eSlider.setStep(step);\r\n        this.eText.setStep(step);\r\n        return this;\r\n    }\r\n}\r\n\r\nexport const AgSliderSelector: ComponentSelector = {\r\n    selector: 'AG-SLIDER',\r\n    component: AgSlider,\r\n};\r\n", "import type { AgInputFieldParams, ComponentSelector } from 'ag-grid-community';\r\nimport { AgAbstractInputField } from 'ag-grid-community';\r\n\r\ninterface IInputRange extends AgInputFieldParams {\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nexport class AgInputRange extends AgAbstractInputField<HTMLInputElement, string, IInputRange> {\r\n    private min: number;\r\n    private max: number;\r\n\r\n    constructor(config?: IInputRange) {\r\n        super(config, 'ag-range-field', 'range');\r\n    }\r\n\r\n    public override postConstruct() {\r\n        super.postConstruct();\r\n\r\n        const { min, max, step } = this.config;\r\n\r\n        if (min != null) {\r\n            this.setMinValue(min);\r\n        }\r\n\r\n        if (max != null) {\r\n            this.setMaxValue(max);\r\n        }\r\n\r\n        this.setStep(step || 1);\r\n    }\r\n\r\n    protected override addInputListeners() {\r\n        this.addManagedElementListeners(this.eInput, {\r\n            input: (e: any) => {\r\n                const value = e.target.value;\r\n\r\n                this.setValue(value);\r\n            },\r\n        });\r\n    }\r\n\r\n    public setMinValue(value: number): this {\r\n        this.min = value;\r\n\r\n        this.eInput.setAttribute('min', value.toString());\r\n\r\n        return this;\r\n    }\r\n\r\n    public setMaxValue(value: number): this {\r\n        this.max = value;\r\n\r\n        this.eInput.setAttribute('max', value.toString());\r\n\r\n        return this;\r\n    }\r\n\r\n    public setStep(value: number): this {\r\n        this.eInput.setAttribute('step', value.toString());\r\n\r\n        return this;\r\n    }\r\n\r\n    public override setValue(value: string, silent?: boolean): this {\r\n        if (this.min != null) {\r\n            value = Math.max(parseFloat(value), this.min).toString();\r\n        }\r\n\r\n        if (this.max != null) {\r\n            value = Math.min(parseFloat(value), this.max).toString();\r\n        }\r\n\r\n        const ret = super.setValue(value, silent);\r\n\r\n        this.eInput.value = value;\r\n\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport const AgInputRangeSelector: ComponentSelector = {\r\n    selector: 'AG-INPUT-RANGE',\r\n    component: AgInputRange,\r\n};\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { AgCheckboxSelector, Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { AgSlider } from '../../../../widgets/agSlider';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class ZoomPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    private readonly zoomScrollingStepInput: AgSlider = RefPlaceholder;\r\n\r\n    constructor(private readonly chartMenuParamsFactory: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const zoomGroupParams = this.chartMenuParamsFactory.addEnableParams<AgGroupComponentParams>('zoom.enabled', {\r\n            cssIdentifier: 'charts-advanced-settings-top-level',\r\n            direction: 'vertical',\r\n            suppressOpenCloseIcons: true,\r\n            title: this.chartTranslation.translate('zoom'),\r\n            suppressEnabledCheckbox: true,\r\n            useToggle: true,\r\n        });\r\n        const zoomScrollingCheckboxParams = this.chartMenuParamsFactory.getDefaultCheckboxParams(\r\n            'zoom.enableScrolling',\r\n            'scrollingZoom'\r\n        );\r\n        const zoomScrollingStepSliderParams = this.chartMenuParamsFactory.getDefaultSliderParams(\r\n            'zoom.scrollingStep',\r\n            'scrollingStep',\r\n            1\r\n        );\r\n        zoomScrollingStepSliderParams.step = 0.01;\r\n        zoomScrollingStepSliderParams.minValue = zoomScrollingStepSliderParams.step;\r\n        const zoomSelectingCheckboxParams = this.chartMenuParamsFactory.getDefaultCheckboxParams(\r\n            'zoom.enableSelecting',\r\n            'selectingZoom'\r\n        );\r\n\r\n        // Enable/disable the scrolling step input according to whether the scrolling checkbox is checked\r\n        zoomScrollingCheckboxParams.onValueChange = ((onValueChange) => (value: boolean) => {\r\n            if (!onValueChange) return;\r\n            onValueChange(value);\r\n            this.zoomScrollingStepInput.setDisabled(!value);\r\n        })(zoomScrollingCheckboxParams.onValueChange);\r\n\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"zoomGroup\">\r\n                <ag-checkbox data-ref=\"zoomSelectingCheckbox\"></ag-checkbox>\r\n                <ag-checkbox data-ref=\"zoomScrollingCheckbox\"></ag-checkbox>\r\n                <ag-slider data-ref=\"zoomScrollingStepInput\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgCheckboxSelector, AgSliderSelector],\r\n            {\r\n                zoomGroup: zoomGroupParams,\r\n                zoomScrollingCheckbox: zoomScrollingCheckboxParams,\r\n                zoomScrollingStepInput: zoomScrollingStepSliderParams,\r\n                zoomSelectingCheckbox: zoomSelectingCheckboxParams,\r\n            }\r\n        );\r\n\r\n        // Set the initial state of the scrolling step input according to whether the scrolling checkbox is checked\r\n        this.zoomScrollingStepInput.setDisabled(!zoomScrollingCheckboxParams.value);\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    DefaultChartMenuItem,\r\n    IAfterGuiAttachedParams,\r\n    IconName,\r\n    MenuItemDef,\r\n    NamedBean,\r\n    PopupService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    BeanStub,\r\n    Component,\r\n    RefPlaceholder,\r\n    _createIconNoSpan,\r\n    _focusInto,\r\n    _isNothingFocused,\r\n} from 'ag-grid-community';\r\n\r\nimport { AgMenuList } from '../../../widgets/agMenuList';\r\nimport type { ChartController } from '../chartController';\r\nimport type { ChartMenuService } from '../services/chartMenuService';\r\nimport type { ChartTranslationService } from '../services/chartTranslationService';\r\nimport type { ChartMenuContext } from './chartMenuContext';\r\n\r\nexport class ChartMenuListFactory extends BeanStub implements NamedBean {\r\n    beanName = 'chartMenuListFactory' as const;\r\n\r\n    private popupSvc: PopupService;\r\n    private chartMenuSvc: ChartMenuService;\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.popupSvc = beans.popupSvc!;\r\n        this.chartMenuSvc = beans.chartMenuSvc as ChartMenuService;\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    private activeChartMenuList?: ChartMenuList;\r\n\r\n    public showMenuList(params: {\r\n        eventSource: HTMLElement;\r\n        showMenu: () => void;\r\n        chartMenuContext: ChartMenuContext;\r\n    }): void {\r\n        const { eventSource, showMenu, chartMenuContext } = params;\r\n        const areChartToolPanelsEnabled = this.chartMenuSvc.doChartToolPanelsExist(chartMenuContext.chartController);\r\n        const menuItems = this.mapWithStockItems(\r\n            this.getMenuItems(chartMenuContext.chartController, areChartToolPanelsEnabled),\r\n            chartMenuContext,\r\n            showMenu,\r\n            eventSource,\r\n            areChartToolPanelsEnabled\r\n        );\r\n        if (!menuItems.length) {\r\n            return;\r\n        }\r\n        const chartMenuList = this.createBean(new ChartMenuList(menuItems));\r\n        this.activeChartMenuList = chartMenuList;\r\n\r\n        let multiplier = -1;\r\n        let alignSide: 'left' | 'right' = 'left';\r\n\r\n        if (this.gos.get('enableRtl')) {\r\n            multiplier = 1;\r\n            alignSide = 'right';\r\n        }\r\n\r\n        const eGui = chartMenuList.getGui();\r\n\r\n        this.popupSvc.addPopup({\r\n            modal: true,\r\n            eChild: eGui,\r\n            closeOnEsc: true,\r\n            closedCallback: () => {\r\n                this.destroyBean(chartMenuList);\r\n                this.activeChartMenuList = undefined;\r\n                if (_isNothingFocused(this.beans)) {\r\n                    eventSource.focus({ preventScroll: true });\r\n                }\r\n            },\r\n            afterGuiAttached: (params) => chartMenuList.afterGuiAttached(params),\r\n            positionCallback: () => {\r\n                {\r\n                    this.popupSvc.positionPopupByComponent({\r\n                        type: 'chartMenu',\r\n                        eventSource,\r\n                        ePopup: eGui,\r\n                        alignSide,\r\n                        nudgeX: 4 * multiplier,\r\n                        nudgeY: 4,\r\n                        position: 'under',\r\n                        keepWithinBounds: true,\r\n                    });\r\n                }\r\n            },\r\n            ariaLabel: 'Chart Menu',\r\n        });\r\n    }\r\n\r\n    private getMenuItems(\r\n        chartController: ChartController,\r\n        areChartToolPanelsEnabled: boolean\r\n    ): (MenuItemDef | DefaultChartMenuItem)[] {\r\n        const defaultItems: DefaultChartMenuItem[] = [\r\n            ...(areChartToolPanelsEnabled ? (['chartEdit'] as const) : []),\r\n            ...(chartController.isEnterprise() ? (['chartAdvancedSettings'] as const) : []),\r\n            chartController.isChartLinked() ? 'chartUnlink' : 'chartLink',\r\n            'chartDownload',\r\n        ];\r\n        const chartMenuItems = this.gos.get('chartMenuItems');\r\n        if (!chartMenuItems) {\r\n            return defaultItems;\r\n        } else if (Array.isArray(chartMenuItems)) {\r\n            return chartMenuItems;\r\n        } else {\r\n            return chartMenuItems(\r\n                this.gos.addGridCommonParams({\r\n                    defaultItems,\r\n                })\r\n            );\r\n        }\r\n    }\r\n\r\n    private mapWithStockItems(\r\n        originalList: (MenuItemDef | DefaultChartMenuItem)[],\r\n        chartMenuContext: ChartMenuContext,\r\n        showMenu: () => void,\r\n        eventSource: HTMLElement,\r\n        areChartToolPanelsEnabled: boolean\r\n    ): MenuItemDef[] {\r\n        if (!originalList) {\r\n            return [];\r\n        }\r\n        const resultList: MenuItemDef[] = [];\r\n\r\n        originalList.forEach((menuItemOrString) => {\r\n            let result: MenuItemDef | null;\r\n            if (typeof menuItemOrString === 'string') {\r\n                result = this.getStockMenuItem(\r\n                    menuItemOrString,\r\n                    chartMenuContext,\r\n                    showMenu,\r\n                    eventSource,\r\n                    areChartToolPanelsEnabled\r\n                );\r\n            } else {\r\n                result = { ...menuItemOrString };\r\n            }\r\n            if (!result) {\r\n                return;\r\n            }\r\n\r\n            const { subMenu } = result;\r\n            if (Array.isArray(subMenu)) {\r\n                result.subMenu = this.mapWithStockItems(\r\n                    subMenu as (DefaultChartMenuItem | MenuItemDef)[],\r\n                    chartMenuContext,\r\n                    showMenu,\r\n                    eventSource,\r\n                    areChartToolPanelsEnabled\r\n                );\r\n            }\r\n\r\n            resultList.push(result);\r\n        });\r\n\r\n        return resultList;\r\n    }\r\n\r\n    private getStockMenuItem(\r\n        key: DefaultChartMenuItem,\r\n        chartMenuContext: ChartMenuContext,\r\n        showMenu: () => void,\r\n        eventSource: HTMLElement,\r\n        areChartToolPanelsEnabled: boolean\r\n    ): MenuItemDef | null {\r\n        switch (key) {\r\n            case 'chartEdit':\r\n                return areChartToolPanelsEnabled\r\n                    ? this.createMenuItem(this.chartTranslation.translate('chartEdit'), 'chartsMenuEdit', showMenu)\r\n                    : null;\r\n            case 'chartAdvancedSettings':\r\n                return this.createMenuItem(\r\n                    this.chartTranslation.translate('chartAdvancedSettings'),\r\n                    'chartsMenuAdvancedSettings',\r\n                    () => this.chartMenuSvc.openAdvancedSettings(chartMenuContext, eventSource)\r\n                );\r\n            case 'chartUnlink':\r\n                return chartMenuContext.chartController.isChartLinked()\r\n                    ? this.createMenuItem(this.chartTranslation.translate('chartUnlink'), 'unlinked', () =>\r\n                          this.chartMenuSvc.toggleLinked(chartMenuContext)\r\n                      )\r\n                    : null;\r\n            case 'chartLink':\r\n                return !chartMenuContext.chartController.isChartLinked()\r\n                    ? this.createMenuItem(this.chartTranslation.translate('chartLink'), 'linked', () =>\r\n                          this.chartMenuSvc.toggleLinked(chartMenuContext)\r\n                      )\r\n                    : null;\r\n            case 'chartDownload':\r\n                return this.createMenuItem(this.chartTranslation.translate('chartDownload'), 'chartsDownload', () =>\r\n                    this.chartMenuSvc.downloadChart(chartMenuContext)\r\n                );\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private createMenuItem(name: string, iconName: IconName, action: () => void): MenuItemDef {\r\n        return {\r\n            name,\r\n            icon: _createIconNoSpan(iconName, this.beans, null),\r\n            action,\r\n        };\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyBean(this.activeChartMenuList);\r\n        super.destroy();\r\n    }\r\n}\r\n\r\nclass ChartMenuList extends Component {\r\n    private readonly eChartsMenu: HTMLElement = RefPlaceholder;\r\n\r\n    private hidePopupFunc: () => void;\r\n    private mainMenuList: AgMenuList;\r\n\r\n    constructor(private readonly menuItems: MenuItemDef[]) {\r\n        super(/* html */ `\r\n            <div data-ref=\"eChartsMenu\" role=\"presentation\" class=\"ag-menu ag-chart-menu-popup\"></div>\r\n        `);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.mainMenuList = this.createManagedBean(new AgMenuList(0));\r\n        this.mainMenuList.addMenuItems(this.menuItems);\r\n        this.mainMenuList.addEventListener('closeMenu', this.onHidePopup.bind(this));\r\n        this.eChartsMenu.appendChild(this.mainMenuList.getGui());\r\n    }\r\n\r\n    private onHidePopup(): void {\r\n        this.hidePopupFunc?.();\r\n    }\r\n\r\n    public afterGuiAttached({ hidePopup }: IAfterGuiAttachedParams): void {\r\n        if (hidePopup) {\r\n            this.hidePopupFunc = hidePopup;\r\n            this.addDestroyFunc(hidePopup);\r\n        }\r\n        _focusInto(this.mainMenuList.getGui());\r\n    }\r\n}\r\n", "import type {\r\n    AgColumn,\r\n    BeanCollection,\r\n    ColumnModel,\r\n    FilterManager,\r\n    IClientSideRowModel,\r\n    NamedBean,\r\n    RowNode,\r\n    ValueService,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _isClientSideRowModel, _warn } from 'ag-grid-community';\r\n\r\nexport class ChartCrossFilterService extends BeanStub implements NamedBean {\r\n    beanName = 'chartCrossFilterSvc' as const;\r\n\r\n    private colModel: ColumnModel;\r\n    private valueSvc: ValueService;\r\n    private filterManager?: FilterManager;\r\n    private clientSideRowModel?: IClientSideRowModel;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.colModel = beans.colModel;\r\n        this.valueSvc = beans.valueSvc;\r\n        this.filterManager = beans.filterManager;\r\n        if (_isClientSideRowModel(this.gos, beans.rowModel)) {\r\n            this.clientSideRowModel = beans.rowModel;\r\n        }\r\n    }\r\n\r\n    public filter(event: any, reset: boolean = false): void {\r\n        const filterModel = this.filterManager?.getFilterModel() ?? {};\r\n\r\n        // filters should be reset when user clicks on canvas background\r\n        if (reset) {\r\n            this.resetFilters(filterModel);\r\n            return;\r\n        }\r\n\r\n        const colId = this.extractFilterColId(event);\r\n        if (this.isValidColumnFilter(colId)) {\r\n            // update filters based on current chart selections\r\n            this.updateFilters(filterModel, event, colId);\r\n        } else {\r\n            _warn(154, { colId });\r\n        }\r\n    }\r\n\r\n    private resetFilters(filterModel: any) {\r\n        const filtersExist = Object.keys(filterModel).length > 0;\r\n        if (filtersExist) {\r\n            // only reset filters / charts when necessary to prevent undesirable flickering effect\r\n            this.filterManager?.setFilterModel(null);\r\n            this.filterManager?.onFilterChanged({ source: 'api' });\r\n        }\r\n    }\r\n\r\n    private updateFilters(filterModel: any, event: any, colId: string) {\r\n        const dataKey = this.extractFilterColId(event);\r\n        const rawValue = event.datum[dataKey];\r\n        if (rawValue === undefined) {\r\n            return;\r\n        }\r\n\r\n        const selectedValue = rawValue.toString();\r\n\r\n        if (event.event.metaKey || event.event.ctrlKey) {\r\n            const existingGridValues = this.getCurrentGridValuesForCategory(colId);\r\n            const valueAlreadyExists = existingGridValues.includes(selectedValue);\r\n\r\n            let updatedValues;\r\n            if (valueAlreadyExists) {\r\n                updatedValues = existingGridValues.filter((v: any) => v !== selectedValue);\r\n            } else {\r\n                updatedValues = existingGridValues;\r\n                updatedValues.push(selectedValue);\r\n            }\r\n\r\n            filterModel[colId] = this.getUpdatedFilterModel(colId, updatedValues);\r\n        } else {\r\n            const updatedValues = [selectedValue];\r\n            filterModel = { [colId]: this.getUpdatedFilterModel(colId, updatedValues) };\r\n        }\r\n\r\n        this.filterManager?.setFilterModel(filterModel);\r\n    }\r\n\r\n    private getUpdatedFilterModel(colId: any, updatedValues: any[]) {\r\n        const columnFilterType = this.getColumnFilterType(colId);\r\n        if (columnFilterType === 'agMultiColumnFilter') {\r\n            return { filterType: 'multi', filterModels: [null, { filterType: 'set', values: updatedValues }] };\r\n        }\r\n        return { filterType: 'set', values: updatedValues };\r\n    }\r\n\r\n    private getCurrentGridValuesForCategory(colId: string) {\r\n        const filteredValues: any[] = [];\r\n        const column = this.getColumnById(colId);\r\n        this.clientSideRowModel?.forEachNodeAfterFilter((rowNode: RowNode) => {\r\n            if (column && !rowNode.group) {\r\n                const value = this.valueSvc.getValue(column, rowNode) + '';\r\n                if (!filteredValues.includes(value)) {\r\n                    filteredValues.push(value);\r\n                }\r\n            }\r\n        });\r\n        return filteredValues;\r\n    }\r\n\r\n    private extractFilterColId(event: any): string {\r\n        return event.xKey || event.calloutLabelKey;\r\n    }\r\n\r\n    private isValidColumnFilter(colId: any) {\r\n        if (colId.indexOf('-filtered-out')) {\r\n            colId = colId.replace('-filtered-out', '');\r\n        }\r\n\r\n        const filterType = this.getColumnFilterType(colId);\r\n        if (typeof filterType === 'boolean') {\r\n            return filterType;\r\n        }\r\n\r\n        return ['agSetColumnFilter', 'agMultiColumnFilter'].includes(filterType);\r\n    }\r\n\r\n    private getColumnFilterType(colId: any) {\r\n        const gridColumn = this.getColumnById(colId);\r\n        if (gridColumn) {\r\n            const colDef = gridColumn.getColDef();\r\n            return colDef.filter;\r\n        }\r\n    }\r\n\r\n    private getColumnById(colId: string) {\r\n        return this.colModel.getCol(colId) as AgColumn;\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    ChartToolPanelMenuOptions,\r\n    ChartToolPanelName,\r\n    ChartToolbarMenuItemOptions,\r\n    GetChartToolbarItemsParams,\r\n    NamedBean,\r\n    WithoutGridCommon,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _warn } from 'ag-grid-community';\r\n\r\nimport type { ChartController } from '../chartController';\r\nimport type { AdvancedSettingsMenuFactory } from '../menu/advancedSettings/advancedSettingsMenuFactory';\r\nimport type { ChartMenuContext } from '../menu/chartMenuContext';\r\n\r\nconst CHART_TOOLBAR_ALLOW_LIST: ChartToolbarMenuItemOptions[] = [\r\n    'chartUnlink',\r\n    'chartLink',\r\n    'chartDownload',\r\n    'chartMenu',\r\n];\r\n\r\nexport const CHART_TOOL_PANEL_MENU_OPTIONS: { [key in ChartToolPanelName]: ChartToolPanelMenuOptions } = {\r\n    settings: 'chartSettings',\r\n    data: 'chartData',\r\n    format: 'chartFormat',\r\n};\r\n\r\nexport class ChartMenuService extends BeanStub implements NamedBean {\r\n    beanName = 'chartMenuSvc' as const;\r\n\r\n    private advSettingsMenuFactory?: AdvancedSettingsMenuFactory;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.advSettingsMenuFactory = beans.advSettingsMenuFactory as AdvancedSettingsMenuFactory;\r\n    }\r\n\r\n    public downloadChart(\r\n        chartMenuContext: ChartMenuContext,\r\n        dimensions?: { width: number; height: number },\r\n        fileName?: string,\r\n        fileFormat?: string\r\n    ): void {\r\n        chartMenuContext.chartController.getChartProxy().downloadChart(dimensions, fileName, fileFormat);\r\n    }\r\n\r\n    public toggleLinked(chartMenuContext: ChartMenuContext): void {\r\n        chartMenuContext.chartController.detachChartRange();\r\n    }\r\n\r\n    public openAdvancedSettings(chartMenuContext: ChartMenuContext, eventSource?: HTMLElement): void {\r\n        this.advSettingsMenuFactory?.showMenu(chartMenuContext, eventSource);\r\n    }\r\n\r\n    public hideAdvancedSettings(): void {\r\n        this.advSettingsMenuFactory?.hideMenu();\r\n    }\r\n\r\n    public getChartToolbarOptions(): ChartToolbarMenuItemOptions[] {\r\n        const defaultChartToolbarOptions: ChartToolbarMenuItemOptions[] = ['chartMenu'];\r\n\r\n        const toolbarItemsFunc = this.gos.getCallback('getChartToolbarItems');\r\n        const params: WithoutGridCommon<GetChartToolbarItemsParams> = {\r\n            defaultItems: defaultChartToolbarOptions,\r\n        };\r\n        return toolbarItemsFunc\r\n            ? toolbarItemsFunc(params).filter((option) => {\r\n                  if (!CHART_TOOLBAR_ALLOW_LIST.includes(option)) {\r\n                      _warn(155, { option });\r\n                      return false;\r\n                  }\r\n                  return true;\r\n              })\r\n            : defaultChartToolbarOptions;\r\n    }\r\n\r\n    public getChartToolPanels(chartController: ChartController): {\r\n        panels: ChartToolPanelMenuOptions[];\r\n        defaultPanel: ChartToolPanelMenuOptions;\r\n    } {\r\n        const chartToolPanelsDef = this.gos.get('chartToolPanelsDef');\r\n\r\n        const panelsOverride = chartToolPanelsDef?.panels\r\n            ?.map((panel) => {\r\n                const menuOption = CHART_TOOL_PANEL_MENU_OPTIONS[panel];\r\n                if (!menuOption) {\r\n                    _warn(156, { panel });\r\n                }\r\n                return menuOption;\r\n            })\r\n            .filter((panel) => Boolean(panel));\r\n        let panels = panelsOverride ?? Object.values(CHART_TOOL_PANEL_MENU_OPTIONS);\r\n\r\n        // pivot charts use the column tool panel instead of the data panel\r\n        if (chartController.isPivotChart()) {\r\n            panels = panels.filter((panel) => panel !== 'chartData');\r\n        }\r\n\r\n        const defaultToolPanel = chartToolPanelsDef?.defaultToolPanel;\r\n        const defaultPanel = (defaultToolPanel && CHART_TOOL_PANEL_MENU_OPTIONS[defaultToolPanel]) || panels[0];\r\n\r\n        return {\r\n            panels,\r\n            defaultPanel,\r\n        };\r\n    }\r\n\r\n    public doesChartToolbarExist(): boolean {\r\n        const chartToolbarOptions = this.getChartToolbarOptions();\r\n        return chartToolbarOptions.length > 0;\r\n    }\r\n\r\n    public doChartToolPanelsExist(chartController: ChartController): boolean {\r\n        const { panels } = this.getChartToolPanels(chartController);\r\n        return panels.length > 0;\r\n    }\r\n}\r\n", "import type { NamedBean } from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\nexport type ChartTranslationKey = keyof typeof DEFAULT_CHART_TRANSLATIONS;\r\n\r\nexport const DEFAULT_CHART_TRANSLATIONS = {\r\n    pivotChartTitle: 'Pivot Chart',\r\n    rangeChartTitle: 'Range Chart',\r\n    settings: 'Chart',\r\n    data: 'Set Up',\r\n    format: 'Customize',\r\n    categories: 'Categories',\r\n    defaultCategory: '(None)',\r\n    series: 'Series',\r\n    switchCategorySeries: 'Switch Category / Series',\r\n    categoryValues: 'Category Values',\r\n    seriesLabels: 'Series Labels',\r\n    aggregate: 'Aggregate',\r\n    xyValues: 'X Y Values',\r\n    paired: 'Paired Mode',\r\n    axis: 'Axis',\r\n    xAxis: 'Horizontal Axis',\r\n    yAxis: 'Vertical Axis',\r\n    polarAxis: 'Polar Axis',\r\n    radiusAxis: 'Radius Axis',\r\n    navigator: 'Navigator',\r\n    zoom: 'Zoom',\r\n    animation: 'Animation',\r\n    crosshair: 'Crosshair',\r\n    color: 'Color',\r\n    thickness: 'Thickness',\r\n    preferredLength: 'Preferred Length',\r\n    xType: 'X Type',\r\n    axisType: 'Axis Type',\r\n    automatic: 'Automatic',\r\n    category: 'Category',\r\n    number: 'Number',\r\n    time: 'Time',\r\n    timeFormat: 'Time Format',\r\n    autoRotate: 'Auto Rotate',\r\n    labelRotation: 'Rotation',\r\n    circle: 'Circle',\r\n    polygon: 'Polygon',\r\n    square: 'Square',\r\n    cross: 'Cross',\r\n    diamond: 'Diamond',\r\n    plus: 'Plus',\r\n    triangle: 'Triangle',\r\n    heart: 'Heart',\r\n    orientation: 'Orientation',\r\n    fixed: 'Fixed',\r\n    parallel: 'Parallel',\r\n    perpendicular: 'Perpendicular',\r\n    radiusAxisPosition: 'Position',\r\n    ticks: 'Ticks',\r\n    gridLines: 'Grid Lines',\r\n    width: 'Width',\r\n    height: 'Height',\r\n    length: 'Length',\r\n    padding: 'Padding',\r\n    spacing: 'Spacing',\r\n    chartStyle: 'Chart Style',\r\n    title: 'Title',\r\n    chartTitles: 'Titles',\r\n    chartTitle: 'Chart Title',\r\n    chartSubtitle: 'Subtitle',\r\n    horizontalAxisTitle: 'Horizontal Axis Title',\r\n    verticalAxisTitle: 'Vertical Axis Title',\r\n    polarAxisTitle: 'Polar Axis Title',\r\n    titlePlaceholder: 'Chart Title',\r\n    background: 'Background',\r\n    font: 'Font',\r\n    weight: 'Weight',\r\n    top: 'Top',\r\n    right: 'Right',\r\n    bottom: 'Bottom',\r\n    left: 'Left',\r\n    labels: 'Labels',\r\n    calloutLabels: 'Callout Labels',\r\n    sectorLabels: 'Sector Labels',\r\n    positionRatio: 'Position Ratio',\r\n    size: 'Size',\r\n    shape: 'Shape',\r\n    minSize: 'Minimum Size',\r\n    maxSize: 'Maximum Size',\r\n    legend: 'Legend',\r\n    position: 'Position',\r\n    markerSize: 'Marker Size',\r\n    markerStroke: 'Marker Stroke',\r\n    markerPadding: 'Marker Padding',\r\n    itemSpacing: 'Item Spacing',\r\n    itemPaddingX: 'Item Padding X',\r\n    itemPaddingY: 'Item Padding Y',\r\n    layoutHorizontalSpacing: 'Horizontal Spacing',\r\n    layoutVerticalSpacing: 'Vertical Spacing',\r\n    strokeWidth: 'Stroke Width',\r\n    offset: 'Offset',\r\n    offsets: 'Offsets',\r\n    tooltips: 'Tooltips',\r\n    callout: 'Callout',\r\n    markers: 'Markers',\r\n    shadow: 'Shadow',\r\n    blur: 'Blur',\r\n    xOffset: 'X Offset',\r\n    yOffset: 'Y Offset',\r\n    lineWidth: 'Line Width',\r\n    lineDash: 'Line Dash',\r\n    lineDashOffset: 'Dash Offset',\r\n    scrollingZoom: 'Scrolling',\r\n    scrollingStep: 'Scrolling Step',\r\n    selectingZoom: 'Selecting',\r\n    durationMillis: 'Duration (ms)',\r\n    crosshairLabel: 'Label',\r\n    crosshairSnap: 'Snap to Node',\r\n    normal: 'Normal',\r\n    bold: 'Bold',\r\n    italic: 'Italic',\r\n    boldItalic: 'Bold Italic',\r\n    predefined: 'Predefined',\r\n    fillOpacity: 'Fill Opacity',\r\n    strokeColor: 'Line Color',\r\n    strokeOpacity: 'Line Opacity',\r\n    miniChart: 'Mini-Chart',\r\n    histogramBinCount: 'Bin count',\r\n    connectorLine: 'Connector Line',\r\n    seriesItems: 'Series Items',\r\n    seriesItemType: 'Item Type',\r\n    seriesItemPositive: 'Positive',\r\n    seriesItemNegative: 'Negative',\r\n    seriesItemLabels: 'Item Labels',\r\n    columnGroup: 'Column',\r\n    barGroup: 'Bar',\r\n    pieGroup: 'Pie',\r\n    lineGroup: 'Line',\r\n    scatterGroup: 'X Y (Scatter)',\r\n    areaGroup: 'Area',\r\n    polarGroup: 'Polar',\r\n    statisticalGroup: 'Statistical',\r\n    hierarchicalGroup: 'Hierarchical',\r\n    specializedGroup: 'Specialized',\r\n    combinationGroup: 'Combination',\r\n    groupedColumnTooltip: 'Grouped',\r\n    stackedColumnTooltip: 'Stacked',\r\n    normalizedColumnTooltip: '100% Stacked',\r\n    groupedBarTooltip: 'Grouped',\r\n    stackedBarTooltip: 'Stacked',\r\n    normalizedBarTooltip: '100% Stacked',\r\n    pieTooltip: 'Pie',\r\n    donutTooltip: 'Donut',\r\n    lineTooltip: 'Line',\r\n    stackedLineTooltip: 'Stacked',\r\n    normalizedLineTooltip: '100% Stacked',\r\n    groupedAreaTooltip: 'Area',\r\n    stackedAreaTooltip: 'Stacked',\r\n    normalizedAreaTooltip: '100% Stacked',\r\n    scatterTooltip: 'Scatter',\r\n    bubbleTooltip: 'Bubble',\r\n    histogramTooltip: 'Histogram',\r\n    radialColumnTooltip: 'Radial Column',\r\n    radialBarTooltip: 'Radial Bar',\r\n    radarLineTooltip: 'Radar Line',\r\n    radarAreaTooltip: 'Radar Area',\r\n    nightingaleTooltip: 'Nightingale',\r\n    rangeBarTooltip: 'Range Bar',\r\n    rangeAreaTooltip: 'Range Area',\r\n    boxPlotTooltip: 'Box Plot',\r\n    treemapTooltip: 'Treemap',\r\n    sunburstTooltip: 'Sunburst',\r\n    waterfallTooltip: 'Waterfall',\r\n    heatmapTooltip: 'Heatmap',\r\n    columnLineComboTooltip: 'Column & Line',\r\n    areaColumnComboTooltip: 'Area & Column',\r\n    customComboTooltip: 'Custom Combination',\r\n    innerRadius: 'Inner Radius',\r\n    startAngle: 'Start Angle',\r\n    endAngle: 'End Angle',\r\n    reverseDirection: 'Reverse Direction',\r\n    groupPadding: 'Group Padding',\r\n    seriesPadding: 'Series Padding',\r\n    tile: 'Tile',\r\n    whisker: 'Whisker',\r\n    cap: 'Cap',\r\n    capLengthRatio: 'Length Ratio',\r\n    labelPlacement: 'Placement',\r\n    inside: 'Inside',\r\n    outside: 'Outside',\r\n    noDataToChart: 'No data available to be charted.',\r\n    pivotChartRequiresPivotMode: 'Pivot Chart requires Pivot Mode enabled.',\r\n    chartSettingsToolbarTooltip: 'Menu',\r\n    chartLinkToolbarTooltip: 'Linked to Grid',\r\n    chartUnlinkToolbarTooltip: 'Unlinked from Grid',\r\n    chartDownloadToolbarTooltip: 'Download Chart',\r\n    chartMenuToolbarTooltip: 'Menu',\r\n    chartEdit: 'Edit Chart',\r\n    chartAdvancedSettings: 'Advanced Settings',\r\n    chartLink: 'Link to Grid',\r\n    chartUnlink: 'Unlink from Grid',\r\n    chartDownload: 'Download Chart',\r\n    histogramFrequency: 'Frequency',\r\n    seriesChartType: 'Series Chart Type',\r\n    seriesType: 'Series Type',\r\n    secondaryAxis: 'Secondary Axis',\r\n    seriesAdd: 'Add a series',\r\n    categoryAdd: 'Add a category',\r\n    bar: 'Bar',\r\n    column: 'Column',\r\n    histogram: 'Histogram',\r\n    advancedSettings: 'Advanced Settings',\r\n    direction: 'Direction',\r\n    horizontal: 'Horizontal',\r\n    vertical: 'Vertical',\r\n    seriesGroupType: 'Group Type',\r\n    groupedSeriesGroupType: 'Grouped',\r\n    stackedSeriesGroupType: 'Stacked',\r\n    normalizedSeriesGroupType: '100% Stacked',\r\n    legendEnabled: 'Enabled',\r\n    invalidColor: 'Color value is invalid',\r\n    groupedColumnFull: 'Grouped Column',\r\n    stackedColumnFull: 'Stacked Column',\r\n    normalizedColumnFull: '100% Stacked Column',\r\n    groupedBarFull: 'Grouped Bar',\r\n    stackedBarFull: 'Stacked Bar',\r\n    normalizedBarFull: '100% Stacked Bar',\r\n    stackedAreaFull: 'Stacked Area',\r\n    normalizedAreaFull: '100% Stacked Area',\r\n    stackedLineFull: 'Stacked Line',\r\n    normalizedLineFull: '100% Stacked Line',\r\n    customCombo: 'Custom Combination',\r\n\r\n    // menu items\r\n    groupedColumn: 'Grouped',\r\n    stackedColumn: 'Stacked',\r\n    pie: 'Pie',\r\n    donut: 'Donut',\r\n    line: 'Line',\r\n    scatter: 'Scatter',\r\n    bubble: 'Bubble',\r\n    area: 'Area',\r\n    stackedArea: 'Stacked',\r\n    radarLine: 'Radar Line',\r\n    radarArea: 'Radar Area',\r\n    nightingale: 'Nightingale',\r\n    radialColumn: 'Radial Column',\r\n    radialBar: 'Radial Bar',\r\n    boxPlot: 'Box Plot',\r\n    rangeBar: 'Range Bar',\r\n    rangeArea: 'Range Area',\r\n    treemap: 'Treemap',\r\n    sunburst: 'Sunburst',\r\n    waterfall: 'Waterfall',\r\n    heatmap: 'Heatmap',\r\n    columnLineCombo: 'Column & Line',\r\n    AreaColumnCombo: 'Area & Column',\r\n\r\n    // aria\r\n    ariaChartMenuClose: 'Close Chart Edit Menu',\r\n    ariaChartSelected: 'Selected',\r\n\r\n    // group\r\n    group: 'Group',\r\n\r\n    // time formats\r\n    timeFormatSlashesDDMMYYYY: 'DD/MM/YYYY',\r\n    timeFormatSlashesMMDDYYYY: 'MM/DD/YYYY',\r\n    timeFormatSlashesDDMMYY: 'DD/MM/YY',\r\n    timeFormatSlashesMMDDYY: 'MM/DD/YY',\r\n    timeFormatDotsDDMYY: 'DD.M.YY',\r\n    timeFormatDotsMDDYY: 'M.DD.YY',\r\n    timeFormatDashesYYYYMMDD: 'YYYY-MM-DD',\r\n    timeFormatSpacesDDMMMMYYYY: 'DD MMMM YYYY',\r\n    timeFormatHHMMSS: 'HH:MM:SS',\r\n    timeFormatHHMMSSAmPm: 'HH:MM:SS AM/PM',\r\n\r\n    // agg funcs\r\n    sum: 'Sum',\r\n    first: 'First',\r\n    last: 'Last',\r\n    min: 'Min',\r\n    max: 'Max',\r\n    count: 'Count',\r\n    avg: 'Average',\r\n};\r\n\r\nexport class ChartTranslationService extends BeanStub implements NamedBean {\r\n    beanName = 'chartTranslation' as const;\r\n\r\n    public translate(toTranslate: ChartTranslationKey): string {\r\n        const translate = this.getLocaleTextFunc();\r\n        const defaultTranslation = DEFAULT_CHART_TRANSLATIONS[toTranslate];\r\n        return translate(toTranslate, defaultTranslation);\r\n    }\r\n}\r\n", "import type { AgChartThemeOverrides, AgChartThemePalette } from 'ag-charts-types';\r\n\r\nimport type {\r\n    BaseCreateChartParams,\r\n    BeanCollection,\r\n    CellRangeParams,\r\n    ChartDownloadParams,\r\n    ChartModel,\r\n    ChartParamsCellRange,\r\n    ChartRef,\r\n    ChartType,\r\n    CreateCrossFilterChartParams,\r\n    CreatePivotChartParams,\r\n    CreateRangeChartParams,\r\n    GetChartImageDataUrlParams,\r\n    IAggFunc,\r\n    IChartService,\r\n    IRangeService,\r\n    NamedBean,\r\n    OpenChartToolPanelParams,\r\n    PartialCellRange,\r\n    SeriesChartType,\r\n    SeriesGroupType,\r\n    UpdateChartParams,\r\n    VisibleColsService,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _focusInto, _warn } from 'ag-grid-community';\r\n\r\nimport { VERSION as GRID_VERSION } from '../version';\r\nimport type { AgChartsExports } from './agChartsExports';\r\nimport type { GridChartParams } from './chartComp/gridChartComp';\r\nimport { GridChartComp } from './chartComp/gridChartComp';\r\nimport { validateCreateParams } from './chartComp/utils/chartParamsValidator';\r\nimport { getCanonicalChartType } from './chartComp/utils/seriesTypeMapper';\r\nimport { upgradeChartModel } from './chartModelMigration';\r\n\r\nexport interface CrossFilteringContext {\r\n    lastSelectedChartId: string;\r\n}\r\n\r\nexport interface CommonCreateChartParams extends BaseCreateChartParams {\r\n    cellRange: PartialCellRange;\r\n    pivotChart?: boolean;\r\n    suppressChartRanges?: boolean;\r\n    switchCategorySeries?: boolean;\r\n    aggFunc?: string | IAggFunc;\r\n    crossFiltering?: boolean;\r\n    chartOptionsToRestore?: AgChartThemeOverrides;\r\n    chartPaletteToRestore?: AgChartThemePalette;\r\n    seriesChartTypes?: SeriesChartType[];\r\n    seriesGroupType?: SeriesGroupType;\r\n    focusDialogOnOpen?: boolean;\r\n}\r\n\r\nexport class ChartService extends BeanStub implements NamedBean, IChartService {\r\n    beanName = 'chartSvc' as const;\r\n\r\n    private visibleCols: VisibleColsService;\r\n    private agChartsExports: AgChartsExports;\r\n    private rangeSvc?: IRangeService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.visibleCols = beans.visibleCols;\r\n        this.rangeSvc = beans.rangeSvc;\r\n        this.agChartsExports = beans.agChartsExports as AgChartsExports;\r\n    }\r\n\r\n    // we destroy all charts bound to this grid when grid is destroyed. activeCharts contains all charts, including\r\n    // those in developer provided containers.\r\n    private activeCharts = new Set<ChartRef>();\r\n    private activeChartComps = new Set<GridChartComp>();\r\n\r\n    // this shared (singleton) context is used by cross filtering in line and area charts\r\n    private crossFilteringContext: CrossFilteringContext = {\r\n        lastSelectedChartId: '',\r\n    };\r\n\r\n    public isEnterprise = () => this.agChartsExports.isEnterprise;\r\n\r\n    public updateChart(params: UpdateChartParams): void {\r\n        if (this.activeChartComps.size === 0) {\r\n            _warn(124);\r\n            return;\r\n        }\r\n\r\n        const chartComp = [...this.activeChartComps].find((chartComp) => chartComp.getChartId() === params.chartId);\r\n        if (!chartComp) {\r\n            _warn(125, { chartId: params.chartId });\r\n            return;\r\n        }\r\n\r\n        chartComp.update(params);\r\n    }\r\n\r\n    public getChartModels(): ChartModel[] {\r\n        const models: ChartModel[] = [];\r\n\r\n        const versionedModel = (c: ChartModel) => {\r\n            return { ...c, version: GRID_VERSION };\r\n        };\r\n        this.activeChartComps.forEach((c) => models.push(versionedModel(c.getChartModel())));\r\n\r\n        return models;\r\n    }\r\n\r\n    public getChartRef(chartId: string): ChartRef | undefined {\r\n        let chartRef;\r\n        this.activeCharts.forEach((cr) => {\r\n            if (cr.chartId === chartId) {\r\n                chartRef = cr;\r\n            }\r\n        });\r\n        return chartRef;\r\n    }\r\n\r\n    public getChartComp(chartId: string): GridChartComp | undefined {\r\n        let chartComp;\r\n        this.activeChartComps.forEach((comp) => {\r\n            if (comp.getChartId() === chartId) {\r\n                chartComp = comp;\r\n            }\r\n        });\r\n        return chartComp;\r\n    }\r\n\r\n    public getChartImageDataURL(params: GetChartImageDataUrlParams): string | undefined {\r\n        let url: any;\r\n        this.activeChartComps.forEach((c) => {\r\n            if (c.getChartId() === params.chartId) {\r\n                url = c.getChartImageDataURL(params.fileFormat);\r\n            }\r\n        });\r\n        return url;\r\n    }\r\n\r\n    public downloadChart(params: ChartDownloadParams) {\r\n        const chartComp = Array.from(this.activeChartComps).find((c) => c.getChartId() === params.chartId);\r\n        chartComp?.downloadChart(params.dimensions, params.fileName, params.fileFormat);\r\n    }\r\n\r\n    public openChartToolPanel(params: OpenChartToolPanelParams) {\r\n        const chartComp = Array.from(this.activeChartComps).find((c) => c.getChartId() === params.chartId);\r\n        chartComp?.openChartToolPanel(params.panel);\r\n    }\r\n\r\n    public closeChartToolPanel(chartId: string) {\r\n        const chartComp = Array.from(this.activeChartComps).find((c) => c.getChartId() === chartId);\r\n        chartComp?.closeChartToolPanel();\r\n    }\r\n\r\n    public createChartFromCurrentRange(\r\n        chartType: ChartType = 'groupedColumn',\r\n        fromApi?: boolean\r\n    ): ChartRef | undefined {\r\n        const cellRange: PartialCellRange = this.getSelectedRange();\r\n        return this.createChart({ cellRange, chartType, focusDialogOnOpen: !fromApi });\r\n    }\r\n\r\n    public restoreChart(model: ChartModel, chartContainer?: HTMLElement): ChartRef | undefined {\r\n        if (!model) {\r\n            _warn(126);\r\n            return;\r\n        }\r\n\r\n        if (model.version !== GRID_VERSION) {\r\n            model = upgradeChartModel(model);\r\n        }\r\n\r\n        let cellRange: PartialCellRange | undefined;\r\n        let pivotChart: true | undefined;\r\n        let suppressChartRanges: boolean | undefined;\r\n        let chartPaletteToRestore: AgChartThemePalette | undefined;\r\n\r\n        if (model.modelType === 'pivot') {\r\n            // if required enter pivot mode\r\n            this.gos.updateGridOptions({ options: { pivotMode: true }, source: 'pivotChart' as any });\r\n\r\n            cellRange = this.createCellRange(undefined, true);\r\n            pivotChart = true;\r\n            suppressChartRanges = true;\r\n        } else {\r\n            cellRange = this.createCellRange(model.cellRange);\r\n            chartPaletteToRestore = model.chartPalette;\r\n            suppressChartRanges = model.suppressChartRanges;\r\n        }\r\n\r\n        if (!cellRange) {\r\n            return;\r\n        }\r\n\r\n        return this.createChart({\r\n            ...model,\r\n            cellRange,\r\n            pivotChart,\r\n            suppressChartRanges,\r\n            chartContainer,\r\n            chartOptionsToRestore: model.chartOptions,\r\n            chartPaletteToRestore,\r\n        });\r\n    }\r\n\r\n    public createRangeChart(params: CreateRangeChartParams, fromApi?: boolean): ChartRef | undefined {\r\n        const cellRange = this.createCellRange(params.cellRange);\r\n\r\n        if (!cellRange) {\r\n            return;\r\n        }\r\n\r\n        return this.createChart({\r\n            ...params,\r\n            cellRange,\r\n            focusDialogOnOpen: !fromApi,\r\n        });\r\n    }\r\n\r\n    public createPivotChart(params: CreatePivotChartParams, fromApi?: boolean): ChartRef | undefined {\r\n        // if required enter pivot mode\r\n        this.gos.updateGridOptions({ options: { pivotMode: true }, source: 'pivotChart' as any });\r\n\r\n        const cellRange = this.createCellRange(undefined, true);\r\n\r\n        if (!cellRange) {\r\n            return;\r\n        }\r\n\r\n        return this.createChart({\r\n            ...params,\r\n            cellRange,\r\n            pivotChart: true,\r\n            suppressChartRanges: true,\r\n            focusDialogOnOpen: !fromApi,\r\n        });\r\n    }\r\n\r\n    public createCrossFilterChart(params: CreateCrossFilterChartParams, fromApi?: boolean): ChartRef | undefined {\r\n        const cellRange = this.createCellRange(params.cellRange);\r\n\r\n        if (!cellRange) {\r\n            return;\r\n        }\r\n\r\n        const suppressChartRangesSupplied =\r\n            typeof params.suppressChartRanges !== 'undefined' && params.suppressChartRanges !== null;\r\n        const suppressChartRanges = suppressChartRangesSupplied ? params.suppressChartRanges : true;\r\n\r\n        return this.createChart({\r\n            ...params,\r\n            cellRange,\r\n            suppressChartRanges,\r\n            crossFiltering: true,\r\n            focusDialogOnOpen: !fromApi,\r\n        });\r\n    }\r\n\r\n    private createChart(params: CommonCreateChartParams): ChartRef | undefined {\r\n        const validationResult = validateCreateParams(params, this.agChartsExports.isEnterprise);\r\n        if (!validationResult) {\r\n            return undefined;\r\n        }\r\n        params = validationResult === true ? params : validationResult;\r\n\r\n        const { chartType, chartContainer } = params;\r\n\r\n        const createChartContainerFunc = this.gos.getCallback('createChartContainer');\r\n\r\n        const gridChartParams: GridChartParams = {\r\n            ...params,\r\n            chartId: this.generateId(),\r\n            chartType: getCanonicalChartType(chartType),\r\n            insideDialog: !(chartContainer || createChartContainerFunc),\r\n            crossFilteringContext: this.crossFilteringContext,\r\n            crossFilteringResetCallback: () => this.activeChartComps.forEach((c) => c.crossFilteringReset()),\r\n        };\r\n\r\n        const chartComp = new GridChartComp(gridChartParams);\r\n        this.createBean(chartComp);\r\n\r\n        const chartRef = this.createChartRef(chartComp);\r\n\r\n        if (chartContainer) {\r\n            // if container exists, means developer initiated chart create via API, so place in provided container\r\n            chartContainer.appendChild(chartRef.chartElement);\r\n        } else if (createChartContainerFunc) {\r\n            // otherwise, user created chart via grid UI, check if developer provides containers (e.g. if the application\r\n            // is using its own dialogs rather than the grid provided dialogs)\r\n            createChartContainerFunc(chartRef);\r\n        } else {\r\n            // add listener to remove from active charts list when charts are destroyed, e.g. closing chart dialog\r\n            chartComp.addEventListener('destroyed', () => {\r\n                this.activeChartComps.delete(chartComp);\r\n                this.activeCharts.delete(chartRef);\r\n            });\r\n        }\r\n\r\n        return chartRef;\r\n    }\r\n\r\n    private createChartRef(chartComp: GridChartComp): ChartRef {\r\n        const chartRef: ChartRef = {\r\n            destroyChart: () => {\r\n                if (this.activeCharts.has(chartRef)) {\r\n                    this.destroyBean(chartComp);\r\n                    this.activeChartComps.delete(chartComp);\r\n                    this.activeCharts.delete(chartRef);\r\n                }\r\n            },\r\n            focusChart: () => {\r\n                _focusInto(chartComp.getGui());\r\n            },\r\n            chartElement: chartComp.getGui(),\r\n            chart: chartComp.getUnderlyingChart(),\r\n            chartId: chartComp.getChartModel().chartId,\r\n        };\r\n\r\n        this.activeCharts.add(chartRef);\r\n        this.activeChartComps.add(chartComp);\r\n\r\n        return chartRef;\r\n    }\r\n\r\n    private getSelectedRange(): PartialCellRange {\r\n        const ranges = this.rangeSvc?.getCellRanges() ?? [];\r\n        return ranges.length > 0 ? ranges[0] : { columns: [] };\r\n    }\r\n\r\n    private generateId(): string {\r\n        return `id-${Math.random().toString(36).substring(2, 18)}`;\r\n    }\r\n\r\n    private createCellRange(cellRangeParams?: ChartParamsCellRange, allRange?: boolean): PartialCellRange | undefined {\r\n        const rangeParams = allRange\r\n            ? {\r\n                  rowStartIndex: null,\r\n                  rowStartPinned: undefined,\r\n                  rowEndIndex: null,\r\n                  rowEndPinned: undefined,\r\n                  columns: this.visibleCols.allCols.map((col) => col.getColId()),\r\n              }\r\n            : cellRangeParams;\r\n        const cellRange =\r\n            rangeParams && this.rangeSvc?.createPartialCellRangeFromRangeParams(rangeParams as CellRangeParams, true);\r\n        if (!cellRange) {\r\n            _warn(127, { allRange });\r\n        }\r\n        return cellRange;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.activeCharts.forEach((chart) => chart.destroyChart());\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type {\r\n    AgChartInstance,\r\n    AgChartInstanceOptions,\r\n    AgChartThemeOverrides,\r\n    AgChartThemePalette,\r\n} from 'ag-charts-types';\r\n\r\nimport type {\r\n    BeanCollection,\r\n    ChartModel,\r\n    ChartToolPanelName,\r\n    ChartType,\r\n    Environment,\r\n    FocusService,\r\n    IAggFunc,\r\n    PartialCellRange,\r\n    PopupService,\r\n    SeriesChartType,\r\n    UpdateChartParams,\r\n} from 'ag-grid-community';\r\nimport {\r\n    Component,\r\n    RefPlaceholder,\r\n    _clearElement,\r\n    _errMsg,\r\n    _focusGridInnerElement,\r\n    _focusInto,\r\n    _getAbsoluteHeight,\r\n    _getAbsoluteWidth,\r\n    _mergeDeep,\r\n    _removeFromParent,\r\n    _setDisplayed,\r\n    _warn,\r\n} from 'ag-grid-community';\r\n\r\nimport { AgDialog } from '../../widgets/agDialog';\r\nimport type { AgChartsExports } from '../agChartsExports';\r\nimport type { CrossFilteringContext } from '../chartService';\r\nimport { ChartController, DEFAULT_THEMES } from './chartController';\r\nimport { AreaChartProxy } from './chartProxies/cartesian/areaChartProxy';\r\nimport { BarChartProxy } from './chartProxies/cartesian/barChartProxy';\r\nimport { LineChartProxy } from './chartProxies/cartesian/lineChartProxy';\r\nimport { ScatterChartProxy } from './chartProxies/cartesian/scatterChartProxy';\r\nimport type { ChartProxy, ChartProxyParams } from './chartProxies/chartProxy';\r\nimport { ComboChartProxy } from './chartProxies/combo/comboChartProxy';\r\nimport type { EnterpriseChartProxyFactory } from './chartProxies/enterpriseChartProxyFactory';\r\nimport { PieChartProxy } from './chartProxies/pie/pieChartProxy';\r\nimport { ChartMenu } from './menu/chartMenu';\r\nimport type { ChartMenuContext } from './menu/chartMenuContext';\r\nimport { ChartMenuParamsFactory } from './menu/chartMenuParamsFactory';\r\nimport type { ChartModelParams } from './model/chartDataModel';\r\nimport { ChartDataModel } from './model/chartDataModel';\r\nimport type { ChartCrossFilterService } from './services/chartCrossFilterService';\r\nimport type { ChartMenuService } from './services/chartMenuService';\r\nimport { CHART_TOOL_PANEL_MENU_OPTIONS } from './services/chartMenuService';\r\nimport { ChartOptionsService } from './services/chartOptionsService';\r\nimport type { ChartTranslationKey, ChartTranslationService } from './services/chartTranslationService';\r\nimport { getCanonicalChartType, getSeriesType, isHierarchical } from './utils/seriesTypeMapper';\r\n\r\nexport interface GridChartParams {\r\n    chartId: string;\r\n    pivotChart?: boolean;\r\n    cellRange: PartialCellRange;\r\n    chartType: ChartType;\r\n    chartThemeName?: string;\r\n    insideDialog: boolean;\r\n    focusDialogOnOpen?: boolean;\r\n    suppressChartRanges?: boolean;\r\n    switchCategorySeries?: boolean;\r\n    aggFunc?: string | IAggFunc;\r\n    chartThemeOverrides?: AgChartThemeOverrides;\r\n    unlinkChart?: boolean;\r\n    crossFiltering?: boolean;\r\n    crossFilteringContext: CrossFilteringContext;\r\n    chartOptionsToRestore?: AgChartThemeOverrides;\r\n    chartPaletteToRestore?: AgChartThemePalette;\r\n    seriesChartTypes?: SeriesChartType[];\r\n    crossFilteringResetCallback?: () => void;\r\n}\r\n\r\nexport class GridChartComp extends Component {\r\n    private crossFilterService: ChartCrossFilterService;\r\n    private chartTranslation: ChartTranslationService;\r\n    private chartMenuSvc: ChartMenuService;\r\n    private focusSvc: FocusService;\r\n    private popupSvc: PopupService;\r\n    private enterpriseChartProxyFactory?: EnterpriseChartProxyFactory;\r\n    private environment: Environment;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.crossFilterService = beans.chartCrossFilterSvc as ChartCrossFilterService;\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n        this.chartMenuSvc = beans.chartMenuSvc as ChartMenuService;\r\n        this.focusSvc = beans.focusSvc;\r\n        this.popupSvc = beans.popupSvc!;\r\n        this.enterpriseChartProxyFactory = beans.enterpriseChartProxyFactory as EnterpriseChartProxyFactory;\r\n        this.environment = beans.environment;\r\n    }\r\n\r\n    private readonly eChart: HTMLElement = RefPlaceholder;\r\n    private readonly eWrapper: HTMLElement = RefPlaceholder;\r\n    private readonly eChartContainer: HTMLElement = RefPlaceholder;\r\n    private readonly eMenuContainer: HTMLElement = RefPlaceholder;\r\n    private readonly eEmpty: HTMLElement = RefPlaceholder;\r\n\r\n    private chartMenu: ChartMenu;\r\n    private chartDialog: AgDialog;\r\n\r\n    private chartController: ChartController;\r\n    private chartOptionsService: ChartOptionsService;\r\n    private chartMenuContext: ChartMenuContext;\r\n\r\n    private chartProxy: ChartProxy;\r\n    private chartType: ChartType;\r\n    private chartEmpty: boolean;\r\n\r\n    private readonly params: GridChartParams;\r\n\r\n    // function to clean up the 'color-scheme-change' event listener\r\n    private onDestroyColorSchemeChangeListener: () => void;\r\n\r\n    constructor(params: GridChartParams) {\r\n        super(/* html */ `\r\n            <div style=\"height: 100%; width: 100%;\">\r\n                <div class=\"ag-chart\" data-ref=\"eWrapper\">\r\n                    <div data-ref=\"eChartContainer\" class=\"ag-chart-components-wrapper ag-chart-menu-hidden\">\r\n                        <div data-ref=\"eChart\" class=\"ag-chart-canvas-wrapper\"></div>\r\n                        <div data-ref=\"eEmpty\" class=\"ag-chart-empty-text ag-unselectable\"></div>\r\n                    </div>\r\n                    <div data-ref=\"eMenuContainer\" class=\"ag-chart-docked-container\"></div>\r\n                </div>\r\n            </div>\r\n            `);\r\n        this.params = params;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const modelParams: ChartModelParams = {\r\n            ...this.params,\r\n            chartType: getCanonicalChartType(this.params.chartType),\r\n            chartThemeName: this.getThemeName(),\r\n        };\r\n\r\n        const isRtl = this.gos.get('enableRtl');\r\n\r\n        this.eWrapper.classList.add(isRtl ? 'ag-rtl' : 'ag-ltr');\r\n\r\n        // only the chart controller interacts with the chart model\r\n        const model = this.createBean(new ChartDataModel(modelParams));\r\n        this.chartController = this.createManagedBean(new ChartController(model));\r\n        this.chartOptionsService = this.createManagedBean(new ChartOptionsService(this.chartController));\r\n\r\n        this.validateCustomThemes();\r\n\r\n        // create chart before dialog to ensure dialog is correct size\r\n        this.createChart();\r\n\r\n        if (this.params.insideDialog) {\r\n            this.addDialog();\r\n        } else {\r\n            // don't add the theme if we're in a dialog, since dialogs already\r\n            // add a theme, and legacy themes don't like being applied twice\r\n            this.addManagedEventListeners({\r\n                gridStylesChanged: this.updateTheme.bind(this),\r\n            });\r\n            this.updateTheme();\r\n        }\r\n\r\n        this.addMenu();\r\n\r\n        this.addManagedElementListeners(this.getGui(), { focusin: this.setActiveChartCellRange.bind(this) });\r\n        this.addManagedListeners(this.chartController, { chartModelUpdate: this.update.bind(this) });\r\n\r\n        this.addManagedPropertyListeners(\r\n            ['chartThemeOverrides', 'chartThemes'],\r\n            this.reactivePropertyUpdate.bind(this)\r\n        );\r\n\r\n        this.update();\r\n        this.raiseChartCreatedEvent();\r\n    }\r\n\r\n    private updateTheme() {\r\n        this.environment.applyThemeClasses(this.getGui());\r\n    }\r\n\r\n    private createChart(): void {\r\n        // if chart already exists, destroy it and remove it from DOM\r\n        let chartInstance: AgChartInstance<AgChartInstanceOptions> | undefined = undefined;\r\n        if (this.chartProxy) {\r\n            chartInstance = this.chartProxy.destroy({ keepChartInstance: true });\r\n        }\r\n\r\n        const crossFilterCallback = (event: any, reset: boolean) => {\r\n            const ctx = this.params.crossFilteringContext;\r\n            ctx.lastSelectedChartId = reset ? '' : this.chartController.getChartId();\r\n            if (reset) {\r\n                this.params.crossFilteringResetCallback!();\r\n            }\r\n            this.crossFilterService.filter(event, reset);\r\n        };\r\n\r\n        const chartType = this.chartController.getChartType();\r\n        const chartProxyParams: ChartProxyParams = {\r\n            agChartsExports: this.beans.agChartsExports as AgChartsExports,\r\n            chartType,\r\n            chartInstance,\r\n            getChartThemeName: this.getChartThemeName.bind(this),\r\n            getChartThemes: this.getChartThemes.bind(this),\r\n            customChartThemes: this.gos.get('customChartThemes'),\r\n            getGridOptionsChartThemeOverrides: () => this.getGridOptionsChartThemeOverrides(),\r\n            getExtraPaddingDirections: () => this.chartMenu?.getExtraPaddingDirections() ?? [],\r\n            apiChartThemeOverrides: this.params.chartThemeOverrides,\r\n            crossFiltering: this.params.crossFiltering ?? false,\r\n            crossFilterCallback,\r\n            parentElement: this.eChart,\r\n            grouping: this.chartController.isGrouping(),\r\n            chartThemeToRestore: this.params.chartThemeName,\r\n            chartOptionsToRestore: this.params.chartOptionsToRestore,\r\n            chartPaletteToRestore: this.params.chartPaletteToRestore,\r\n            seriesChartTypes: this.chartController.getSeriesChartTypes(),\r\n            translate: (toTranslate: ChartTranslationKey) => this.chartTranslation.translate(toTranslate),\r\n        };\r\n\r\n        // ensure 'restoring' options are not reused when switching chart types\r\n        this.params.chartOptionsToRestore = undefined;\r\n\r\n        // set local state used to detect when chart changes\r\n        this.chartType = chartType;\r\n\r\n        this.chartProxy = this.createChartProxy(chartProxyParams);\r\n        if (!this.chartProxy) {\r\n            _warn(138, { chartType: chartProxyParams.chartType });\r\n            return;\r\n        }\r\n\r\n        this.chartController.setChartProxy(this.chartProxy);\r\n        this.createMenuContext();\r\n    }\r\n\r\n    private createMenuContext(): void {\r\n        if (this.chartMenuContext) {\r\n            return;\r\n        }\r\n        const chartMenuParamsFactory = this.createManagedBean(\r\n            new ChartMenuParamsFactory(this.chartOptionsService.getChartThemeOverridesProxy())\r\n        );\r\n        const chartAxisMenuParamsFactory = this.createManagedBean(\r\n            new ChartMenuParamsFactory(this.chartOptionsService.getAxisThemeOverridesProxy())\r\n        );\r\n        this.chartMenuContext = {\r\n            chartController: this.chartController,\r\n            chartOptionsService: this.chartOptionsService,\r\n            chartMenuParamsFactory,\r\n            chartAxisMenuParamsFactory,\r\n        };\r\n    }\r\n\r\n    private getChartThemeName(): string {\r\n        return this.chartController.getChartThemeName();\r\n    }\r\n\r\n    private getChartThemes(): string[] {\r\n        return this.chartController.getThemeNames();\r\n    }\r\n\r\n    private getGridOptionsChartThemeOverrides(): AgChartThemeOverrides | undefined {\r\n        return this.gos.get('chartThemeOverrides');\r\n    }\r\n\r\n    private createChartProxy(chartProxyParams: ChartProxyParams): ChartProxy {\r\n        const { chartType } = chartProxyParams;\r\n        switch (chartType) {\r\n            case 'column':\r\n            case 'bar':\r\n            case 'groupedColumn':\r\n            case 'stackedColumn':\r\n            case 'normalizedColumn':\r\n            case 'groupedBar':\r\n            case 'stackedBar':\r\n            case 'normalizedBar':\r\n                return new BarChartProxy(chartProxyParams);\r\n            case 'pie':\r\n            case 'donut':\r\n            case 'doughnut':\r\n                return new PieChartProxy(chartProxyParams);\r\n            case 'area':\r\n            case 'stackedArea':\r\n            case 'normalizedArea':\r\n                return new AreaChartProxy(chartProxyParams);\r\n            case 'line':\r\n            case 'stackedLine':\r\n            case 'normalizedLine':\r\n                return new LineChartProxy(chartProxyParams);\r\n            case 'scatter':\r\n            case 'bubble':\r\n                return new ScatterChartProxy(chartProxyParams);\r\n            case 'columnLineCombo':\r\n            case 'areaColumnCombo':\r\n            case 'customCombo':\r\n                return new ComboChartProxy(chartProxyParams);\r\n        }\r\n        const enterpriseChartProxy = this.enterpriseChartProxyFactory?.createChartProxy(chartProxyParams);\r\n        if (!enterpriseChartProxy) {\r\n            throw _errMsg(251, { chartType });\r\n        }\r\n        return enterpriseChartProxy;\r\n    }\r\n\r\n    private addDialog(): void {\r\n        const title = this.chartTranslation.translate(this.params.pivotChart ? 'pivotChartTitle' : 'rangeChartTitle');\r\n\r\n        const { width, height } = this.getBestDialogSize();\r\n\r\n        const afterGuiAttached = this.params.focusDialogOnOpen\r\n            ? () => setTimeout(() => _focusInto(this.getGui()))\r\n            : undefined;\r\n\r\n        this.chartDialog = new AgDialog({\r\n            resizable: true,\r\n            movable: true,\r\n            maximizable: true,\r\n            title,\r\n            width,\r\n            height,\r\n            component: this,\r\n            centered: true,\r\n            closable: true,\r\n            afterGuiAttached,\r\n            postProcessPopupParams: {\r\n                type: 'chart',\r\n            },\r\n        });\r\n\r\n        this.createBean(this.chartDialog);\r\n\r\n        this.chartDialog.addEventListener('destroyed', () => {\r\n            this.destroy();\r\n            this.chartMenuSvc.hideAdvancedSettings();\r\n            const lastFocusedCell = this.focusSvc.getFocusedCell();\r\n            setTimeout(() => {\r\n                if (this.focusSvc.isAlive()) {\r\n                    // focus Service may have been destroyed if both grid and chart destroyed together\r\n                    if (lastFocusedCell) {\r\n                        this.focusSvc.setFocusedCell({ ...lastFocusedCell, forceBrowserFocus: true });\r\n                    } else {\r\n                        _focusGridInnerElement(this.beans);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    private getBestDialogSize(): { width: number; height: number } {\r\n        const popupParent = this.popupSvc.getPopupParent();\r\n        const maxWidth = _getAbsoluteWidth(popupParent) * 0.75;\r\n        const maxHeight = _getAbsoluteHeight(popupParent) * 0.75;\r\n        const ratio = 0.553;\r\n\r\n        const chart = this.chartProxy.getChart();\r\n        let width = this.params.insideDialog ? 850 : chart.width;\r\n        let height = this.params.insideDialog ? 470 : chart.height;\r\n\r\n        if (width > maxWidth || height > maxHeight) {\r\n            width = Math.min(width, maxWidth);\r\n            height = Math.round(width * ratio);\r\n\r\n            if (height > maxHeight) {\r\n                height = maxHeight;\r\n                width = Math.min(width, Math.round(height / ratio));\r\n            }\r\n        }\r\n\r\n        return { width, height };\r\n    }\r\n\r\n    private addMenu(): void {\r\n        if (!this.params.crossFiltering) {\r\n            this.chartMenu = this.createBean(\r\n                new ChartMenu(this.eChartContainer, this.eMenuContainer, this.chartMenuContext)\r\n            );\r\n            this.eChartContainer.appendChild(this.chartMenu.getGui());\r\n        }\r\n    }\r\n\r\n    public update(params?: UpdateChartParams): void {\r\n        // update chart model for api.updateChart()\r\n        if (params?.chartId) {\r\n            const validUpdate = this.chartController.update(params);\r\n            if (!validUpdate) {\r\n                return; // warning already logged!\r\n            }\r\n        }\r\n\r\n        const updatedChartType = this.chartTypeChanged(params);\r\n        // If the chart type has changed, grab the theme overrides from the exisiting chart before destroying it,\r\n        // so that we can retain any compatible theme overrides across different chart types.\r\n        const persistedThemeOverrides =\r\n            updatedChartType || this.chartEmpty\r\n                ? ((updatedChartType) => {\r\n                      const currentChartType = this.chartType;\r\n                      const targetChartType = updatedChartType;\r\n                      const existingChartInstance = this.chartProxy.getChart();\r\n                      const existingChartOptions = existingChartInstance?.getOptions();\r\n                      const existingAxes = existingChartInstance?.axes;\r\n                      return this.chartOptionsService.getPersistedChartThemeOverrides(\r\n                          existingChartOptions,\r\n                          existingAxes,\r\n                          currentChartType,\r\n                          targetChartType ?? currentChartType\r\n                      );\r\n                  })(updatedChartType)\r\n                : undefined;\r\n\r\n        // recreate chart if chart type has changed\r\n        if (updatedChartType) this.createChart();\r\n\r\n        // combine any provided theme overrides with any retained theme overrides from changing chart type\r\n        if (persistedThemeOverrides && params?.chartThemeOverrides) {\r\n            _mergeDeep(persistedThemeOverrides, params.chartThemeOverrides);\r\n        }\r\n        const updatedThemeOverrides = persistedThemeOverrides ?? params?.chartThemeOverrides;\r\n\r\n        // update chart options if chart type hasn't changed or if overrides are supplied\r\n        this.updateChart(updatedThemeOverrides);\r\n\r\n        if (params?.chartId) {\r\n            this.chartProxy\r\n                .getChart()\r\n                .waitForUpdate()\r\n                .then(() => {\r\n                    this.chartController.raiseChartApiUpdateEvent();\r\n                });\r\n        }\r\n    }\r\n\r\n    private updateChart(updatedOverrides?: AgChartThemeOverrides): void {\r\n        const { chartProxy } = this;\r\n\r\n        const selectedCols = this.chartController.getSelectedValueColState();\r\n        const data = this.chartController.getChartData();\r\n        const chartEmpty = this.handleEmptyChart(data, selectedCols.length);\r\n\r\n        this.chartEmpty = chartEmpty;\r\n        if (chartEmpty) {\r\n            // We don't have enough data to reinstantiate the chart with the new chart type,\r\n            // but we still want to persist any theme overrides for when the data is present\r\n            if (updatedOverrides) this.chartController.updateThemeOverrides(updatedOverrides);\r\n            return;\r\n        }\r\n\r\n        const chartUpdateParams = this.chartController.getChartUpdateParams(updatedOverrides);\r\n        chartProxy.update(chartUpdateParams);\r\n\r\n        this.chartProxy\r\n            .getChart()\r\n            .waitForUpdate()\r\n            .then(() => {\r\n                this.chartController.raiseChartUpdatedEvent();\r\n            });\r\n    }\r\n\r\n    private chartTypeChanged(updateParams?: UpdateChartParams): ChartType | null {\r\n        const [currentType, updatedChartType] = [this.chartController.getChartType(), updateParams?.chartType];\r\n        const targetChartType = updatedChartType ? getCanonicalChartType(updatedChartType) : undefined;\r\n        // If the grid chart component is out of sync with the existing chart instance type, return the correct chart type\r\n        if (this.chartType !== currentType) return targetChartType ?? currentType;\r\n        // If the target chart type is different to the current chart type, return the new chart type\r\n        if (targetChartType && currentType !== targetChartType) return targetChartType;\r\n        // Otherwise nothing has changed\r\n        return null;\r\n    }\r\n\r\n    public getChartModel(): ChartModel {\r\n        return this.chartController.getChartModel();\r\n    }\r\n\r\n    public getChartImageDataURL(fileFormat?: string): string {\r\n        return this.chartProxy.getChartImageDataURL(fileFormat);\r\n    }\r\n\r\n    private handleEmptyChart(data: any[], numFields: number): boolean {\r\n        const pivotModeDisabled = this.chartController.isPivotChart() && !this.chartController.isPivotMode();\r\n\r\n        // Determine the minimum number of fields based on the chart type\r\n        const chartType = this.chartController.getChartType();\r\n        let minFieldsRequired = 1;\r\n        if (this.chartController.isActiveXYChart()) {\r\n            minFieldsRequired = chartType === 'bubble' ? 3 : 2;\r\n        } else if (isHierarchical(getSeriesType(chartType))) {\r\n            minFieldsRequired = 0;\r\n        }\r\n\r\n        const isEmptyChart = numFields < minFieldsRequired || data.length === 0;\r\n\r\n        if (this.eChart) {\r\n            const isEmpty = pivotModeDisabled || isEmptyChart;\r\n            _setDisplayed(this.eChart, !isEmpty);\r\n            _setDisplayed(this.eEmpty, isEmpty);\r\n        }\r\n\r\n        if (pivotModeDisabled) {\r\n            this.eEmpty.innerText = this.chartTranslation.translate('pivotChartRequiresPivotMode');\r\n            return true;\r\n        }\r\n\r\n        if (isEmptyChart) {\r\n            this.eEmpty.innerText = this.chartTranslation.translate('noDataToChart');\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public downloadChart(dimensions?: { width: number; height: number }, fileName?: string, fileFormat?: string): void {\r\n        this.chartProxy.downloadChart(dimensions, fileName, fileFormat);\r\n    }\r\n\r\n    public openChartToolPanel(panel?: ChartToolPanelName) {\r\n        const menuPanel = panel ? CHART_TOOL_PANEL_MENU_OPTIONS[panel] : panel;\r\n        this.chartMenu.showMenu({ panel: menuPanel });\r\n    }\r\n\r\n    public closeChartToolPanel() {\r\n        this.chartMenu.hideMenu();\r\n    }\r\n\r\n    public getChartId(): string {\r\n        return this.chartController.getChartId();\r\n    }\r\n\r\n    public getUnderlyingChart() {\r\n        return this.chartProxy.getChartRef();\r\n    }\r\n\r\n    public crossFilteringReset(): void {\r\n        this.chartProxy.crossFilteringReset();\r\n    }\r\n\r\n    private setActiveChartCellRange(focusEvent: FocusEvent): void {\r\n        if (this.getGui().contains(focusEvent.relatedTarget as HTMLElement)) {\r\n            return;\r\n        }\r\n\r\n        this.chartController.setChartRange(true);\r\n    }\r\n\r\n    private getThemeName(): string {\r\n        const availableChartThemes = this.gos.get('chartThemes') || DEFAULT_THEMES;\r\n\r\n        if (availableChartThemes.length === 0) {\r\n            throw new Error(_errMsg(254));\r\n        }\r\n\r\n        const { chartThemeName } = this.params;\r\n        return availableChartThemes.includes(chartThemeName!) ? chartThemeName! : availableChartThemes[0];\r\n    }\r\n\r\n    private getAllKeysInObjects(objects: any[]): string[] {\r\n        const allValues: any = {};\r\n\r\n        objects\r\n            .filter((obj) => obj != null)\r\n            .forEach((obj) => {\r\n                Object.keys(obj).forEach((key) => (allValues[key] = null));\r\n            });\r\n\r\n        return Object.keys(allValues);\r\n    }\r\n\r\n    private validateCustomThemes() {\r\n        const suppliedThemes = this.getChartThemes();\r\n        const customChartThemes = this.gos.get('customChartThemes');\r\n        if (customChartThemes) {\r\n            this.getAllKeysInObjects([customChartThemes]).forEach((customThemeName) => {\r\n                if (!suppliedThemes.includes(customThemeName)) {\r\n                    _warn(139, { customThemeName });\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    private reactivePropertyUpdate(): void {\r\n        // switch to the first theme if the current theme is unavailable\r\n        this.chartController.setChartThemeName(this.getThemeName(), true);\r\n\r\n        const chartId = this.getChartId();\r\n        const modelType = this.chartController.isCrossFilterChart() ? 'crossFilter' : this.getChartModel().modelType;\r\n\r\n        // standalone requires that `undefined` / `null` values are supplied as `{}`\r\n        const chartThemeOverrides = this.gos.get('chartThemeOverrides') || {};\r\n\r\n        this.update({\r\n            type: `${modelType}ChartUpdate`,\r\n            chartId,\r\n            chartThemeOverrides,\r\n        });\r\n    }\r\n\r\n    private raiseChartCreatedEvent(): void {\r\n        this.chartProxy\r\n            .getChart()\r\n            .waitForUpdate()\r\n            .then(() => {\r\n                this.eventSvc.dispatchEvent({\r\n                    type: 'chartCreated',\r\n                    chartId: this.chartController.getChartId(),\r\n                });\r\n            });\r\n    }\r\n\r\n    private raiseChartDestroyedEvent(): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'chartDestroyed',\r\n            chartId: this.chartController.getChartId(),\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n\r\n        if (this.chartProxy) {\r\n            this.chartProxy.destroy();\r\n        }\r\n\r\n        this.destroyBean(this.chartMenu);\r\n\r\n        // don't want to invoke destroy() on the Dialog (prevents destroy loop)\r\n        if (this.chartDialog && this.chartDialog.isAlive()) {\r\n            this.destroyBean(this.chartDialog);\r\n        }\r\n\r\n        this.onDestroyColorSchemeChangeListener?.();\r\n\r\n        // if the user is providing containers for the charts, we need to clean up, otherwise the old chart\r\n        // data will still be visible although the chart is no longer bound to the grid\r\n        const eGui = this.getGui();\r\n        _clearElement(eGui);\r\n        // remove from parent, so if user provided container, we detach from the provided dom element\r\n        _removeFromParent(eGui);\r\n\r\n        this.raiseChartDestroyedEvent();\r\n    }\r\n}\r\n", "import type { AgCartesianAxisType, AgChartThemeOverrides, AgChartThemePalette, IChartTheme } from 'ag-charts-types';\r\n\r\nimport type {\r\n    BeanCollection,\r\n    CellRange,\r\n    CellRangeParams,\r\n    ChartModel,\r\n    ChartModelType,\r\n    ChartType,\r\n    IAggFunc,\r\n    IRangeService,\r\n    PartialCellRange,\r\n    SeriesChartType,\r\n    SeriesGroupType,\r\n    UpdateChartParams,\r\n    UpdateCrossFilterChartParams,\r\n    UpdateRangeChartParams,\r\n} from 'ag-grid-community';\r\nimport { BeanStub, _warn } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../agChartsExports';\r\nimport type { ChartProxy, FieldDefinition, UpdateParams } from './chartProxies/chartProxy';\r\nimport { isStockTheme } from './chartProxies/chartTheme';\r\nimport type { ChartDataModel, ChartModelParams, ColState } from './model/chartDataModel';\r\nimport { DEFAULT_CHART_CATEGORY } from './model/chartDataModel';\r\nimport { validateUpdateParams } from './utils/chartParamsValidator';\r\nimport type { ChartSeriesType } from './utils/seriesTypeMapper';\r\nimport {\r\n    getMaxNumCategories,\r\n    getMaxNumSeries,\r\n    getSeriesType,\r\n    supportsInvertedCategorySeries,\r\n} from './utils/seriesTypeMapper';\r\n\r\nexport const DEFAULT_THEMES = ['ag-default', 'ag-material', 'ag-sheets', 'ag-polychroma', 'ag-vivid'];\r\n\r\nexport type ChartControllerEvent =\r\n    | 'chartUpdated'\r\n    | 'chartApiUpdate'\r\n    | 'chartModelUpdate'\r\n    | 'chartTypeChanged'\r\n    | 'chartSeriesChartTypeChanged'\r\n    | 'chartLinkedChanged';\r\nexport class ChartController extends BeanStub<ChartControllerEvent> {\r\n    private rangeSvc: IRangeService;\r\n    private agChartsExports: AgChartsExports;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.rangeSvc = beans.rangeSvc!;\r\n        this.agChartsExports = beans.agChartsExports as AgChartsExports;\r\n    }\r\n\r\n    private chartProxy: ChartProxy;\r\n\r\n    public constructor(private readonly model: ChartDataModel) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.setChartRange();\r\n\r\n        if (this.model.unlinked) {\r\n            if (this.rangeSvc) {\r\n                this.rangeSvc.setCellRanges([]);\r\n            }\r\n        }\r\n        const listener = this.updateForGridChange.bind(this, {});\r\n        this.addManagedEventListeners({\r\n            cellSelectionChanged: (event) => {\r\n                if (event.id && event.id === this.model.chartId) {\r\n                    this.updateForRangeChange();\r\n                }\r\n            },\r\n            columnMoved: listener,\r\n            columnPinned: listener,\r\n            columnVisible: listener,\r\n            columnRowGroupChanged: listener,\r\n            modelUpdated: listener,\r\n            cellValueChanged: this.updateForDataChange.bind(this),\r\n        });\r\n    }\r\n\r\n    public update(params: UpdateChartParams): boolean {\r\n        if (!this.validUpdateType(params)) return false;\r\n        const validationResult = validateUpdateParams(params, this.agChartsExports.isEnterprise);\r\n        if (!validationResult) return false;\r\n        const validParams = validationResult === true ? params : validationResult;\r\n        this.applyValidatedChartParams(validParams);\r\n        return true;\r\n    }\r\n\r\n    private applyValidatedChartParams(params: UpdateChartParams): void {\r\n        const { chartId, chartType, chartThemeName, unlinkChart } = params;\r\n\r\n        // create a common base for the chart model parameters (this covers pivot chart updates)\r\n        const common = {\r\n            chartId: chartId,\r\n            pivotChart: this.model.pivotChart,\r\n            chartType: chartType ?? this.model.chartType,\r\n            chartThemeName: chartThemeName ?? this.model.chartThemeName,\r\n            unlinkChart: unlinkChart ?? this.model.unlinked,\r\n            cellRange: this.model.suppliedCellRange,\r\n            switchCategorySeries: this.model.switchCategorySeries,\r\n            aggFunc: this.model.aggFunc,\r\n            seriesChartTypes: undefined,\r\n            suppressChartRanges: false,\r\n            crossFiltering: false,\r\n        };\r\n\r\n        const chartModelParams: ChartModelParams = { ...common };\r\n\r\n        // modify the chart model properties based on the type of update\r\n        switch (params.type) {\r\n            case 'rangeChartUpdate':\r\n                chartModelParams.cellRange = this.createCellRange(params) ?? this.model.suppliedCellRange;\r\n                chartModelParams.switchCategorySeries = params.switchCategorySeries ?? this.model.switchCategorySeries;\r\n                chartModelParams.aggFunc = params.aggFunc ?? this.model.aggFunc;\r\n                chartModelParams.seriesChartTypes = params.seriesChartTypes;\r\n                chartModelParams.suppressChartRanges = params.suppressChartRanges ?? this.model.suppressChartRanges;\r\n                chartModelParams.seriesGroupType = params.seriesGroupType ?? this.model.seriesGroupType;\r\n                break;\r\n            case 'crossFilterChartUpdate':\r\n                chartModelParams.cellRange = this.createCellRange(params) ?? this.model.suppliedCellRange;\r\n                chartModelParams.switchCategorySeries = false;\r\n                chartModelParams.aggFunc = params.aggFunc ?? this.model.aggFunc;\r\n                chartModelParams.crossFiltering = true;\r\n                chartModelParams.suppressChartRanges = params.suppressChartRanges ?? this.model.suppressChartRanges;\r\n                break;\r\n            case 'pivotChartUpdate':\r\n                chartModelParams.switchCategorySeries = false;\r\n                break;\r\n        }\r\n\r\n        this.model.updateModel(chartModelParams);\r\n\r\n        // if the chart should be unlinked or chart ranges suppressed, remove all cell ranges; otherwise, set the chart range\r\n        const removeChartCellRanges = chartModelParams.unlinkChart || chartModelParams.suppressChartRanges;\r\n        removeChartCellRanges ? this.rangeSvc?.setCellRanges([]) : this.setChartRange();\r\n    }\r\n\r\n    public updateForGridChange(params?: { maintainColState?: boolean; setColsFromRange?: boolean }): void {\r\n        if (this.model.unlinked) {\r\n            return;\r\n        }\r\n\r\n        const { maintainColState, setColsFromRange } = params ?? {};\r\n\r\n        this.model.updateCellRanges({ maintainColState, setColsFromRange });\r\n        this.model.updateData();\r\n        this.setChartRange();\r\n    }\r\n\r\n    public updateForDataChange(): void {\r\n        if (this.model.unlinked) {\r\n            return;\r\n        }\r\n\r\n        this.model.updateData();\r\n        this.raiseChartModelUpdateEvent();\r\n    }\r\n\r\n    public updateForRangeChange(): void {\r\n        this.updateForGridChange({ setColsFromRange: true });\r\n        this.raiseChartRangeSelectionChangedEvent();\r\n    }\r\n\r\n    public updateForPanelChange(params: {\r\n        updatedColState: ColState;\r\n        resetOrder?: boolean;\r\n        skipAnimation?: boolean;\r\n    }): void {\r\n        this.model.updateCellRanges(params);\r\n        this.model.updateData();\r\n        if (params.skipAnimation) {\r\n            this.getChartProxy().getChartRef().skipAnimations();\r\n        }\r\n        this.setChartRange();\r\n        this.raiseChartRangeSelectionChangedEvent();\r\n    }\r\n\r\n    public updateThemeOverrides(updatedOverrides: AgChartThemeOverrides): void {\r\n        this.chartProxy.updateThemeOverrides(updatedOverrides);\r\n    }\r\n\r\n    public getChartUpdateParams(updatedOverrides?: AgChartThemeOverrides): UpdateParams {\r\n        const selectedCols = this.getSelectedValueColState();\r\n        const fields = selectedCols.map((c) => ({ colId: c.colId, displayName: c.displayName }));\r\n        const data = this.getChartData();\r\n        const selectedDimensions = this.getSelectedDimensions();\r\n\r\n        const params: UpdateParams = {\r\n            data,\r\n            groupData: this.model.groupChartData,\r\n            grouping: this.isGrouping(),\r\n            categories: selectedDimensions.map((selectedDimension) => ({\r\n                id: selectedDimension.colId,\r\n                name: selectedDimension.displayName!,\r\n                chartDataType: this.model.categoryAxisType ?? this.model.getChartDataType(selectedDimension.colId),\r\n            })),\r\n            fields,\r\n            chartId: this.getChartId(),\r\n            getCrossFilteringContext: () => ({ lastSelectedChartId: 'xxx' }), //this.params.crossFilteringContext, //TODO\r\n            seriesChartTypes: this.getSeriesChartTypes(),\r\n            updatedOverrides: updatedOverrides,\r\n            seriesGroupType: this.model.seriesGroupType,\r\n        };\r\n\r\n        return this.isCategorySeriesSwitched() ? this.invertCategorySeriesParams(params) : params;\r\n    }\r\n\r\n    private invertCategorySeriesParams(params: UpdateParams): UpdateParams {\r\n        const [category] = params.categories;\r\n        // Create a single synthetic output category that will contain the series name values\r\n        const categories = [{ id: DEFAULT_CHART_CATEGORY, name: '' }];\r\n        // Create an output series corresponding to each row in the input data\r\n        const fields = params.data.map((value, index): FieldDefinition => {\r\n            const categoryKey = `${category.id}:${index}`;\r\n            const categoryValue = value[category.id];\r\n            const seriesLabel = categoryValue == null ? '' : String(categoryValue);\r\n            return { colId: categoryKey, displayName: seriesLabel };\r\n        });\r\n        // Create an output data row corresponding to each selected series column\r\n        const data = params.fields.map((field) => {\r\n            // Create a new output row labeled with the series column name\r\n            const row: Record<PropertyKey, any> = {\r\n                [DEFAULT_CHART_CATEGORY]: field.displayName,\r\n            };\r\n            // Append fields corresponding to each row in the input data\r\n            for (const [index, value] of params.data.entries()) {\r\n                const categoryKey = `${category.id}:${index}`;\r\n                const seriesLabelValue = value[field.colId];\r\n                row[categoryKey] = seriesLabelValue;\r\n            }\r\n            return row;\r\n        });\r\n        return {\r\n            ...params,\r\n            categories,\r\n            fields,\r\n            data,\r\n        };\r\n    }\r\n\r\n    public getChartModel(): ChartModel {\r\n        const modelType: ChartModelType = this.model.pivotChart ? 'pivot' : 'range';\r\n\r\n        const seriesChartTypes = this.isComboChart() ? this.model.comboChartModel.seriesChartTypes : undefined;\r\n\r\n        return {\r\n            modelType,\r\n            chartId: this.model.chartId,\r\n            chartType: this.model.chartType,\r\n            chartThemeName: this.getChartThemeName(),\r\n            chartOptions: this.chartProxy.getChartThemeOverrides(),\r\n            chartPalette: this.chartProxy.getChartPalette(),\r\n            cellRange: this.getCellRangeParams(),\r\n            switchCategorySeries: this.model.switchCategorySeries,\r\n            suppressChartRanges: this.model.suppressChartRanges,\r\n            aggFunc: this.model.aggFunc,\r\n            unlinkChart: this.model.unlinked,\r\n            seriesChartTypes,\r\n            seriesGroupType: this.model.seriesGroupType,\r\n        };\r\n    }\r\n\r\n    public getChartId(): string {\r\n        return this.model.chartId;\r\n    }\r\n\r\n    public getChartData(): any[] {\r\n        return this.model.chartData;\r\n    }\r\n\r\n    public getChartType(): ChartType {\r\n        return this.model.chartType;\r\n    }\r\n\r\n    public setChartType(chartType: ChartType): void {\r\n        this.updateMultiSeriesAndCategory(this.model.chartType, chartType);\r\n\r\n        this.model.chartType = chartType;\r\n\r\n        this.model.comboChartModel.updateSeriesChartTypes();\r\n\r\n        // Reset the inverted category/series toggle whenever the chart type changes\r\n        this.model.switchCategorySeries = false;\r\n\r\n        this.model.categoryAxisType = undefined;\r\n\r\n        this.model.seriesGroupType = undefined;\r\n\r\n        this.raiseChartModelUpdateEvent();\r\n        this.raiseChartOptionsChangedEvent();\r\n    }\r\n\r\n    public isCategorySeriesSwitched(): boolean {\r\n        return this.model.switchCategorySeries && !this.model.isGrouping();\r\n    }\r\n\r\n    public switchCategorySeries(inverted: boolean): void {\r\n        if (!supportsInvertedCategorySeries(this.getChartType())) return;\r\n        this.model.switchCategorySeries = inverted;\r\n        this.raiseChartModelUpdateEvent();\r\n    }\r\n\r\n    public getAggFunc(): string | IAggFunc | undefined {\r\n        return this.model.aggFunc;\r\n    }\r\n\r\n    public setAggFunc(value: string | IAggFunc | undefined, silent?: boolean): void {\r\n        if (this.model.aggFunc === value) return;\r\n        this.model.aggFunc = value;\r\n        if (silent) return;\r\n        this.model.updateData();\r\n        this.raiseChartModelUpdateEvent();\r\n    }\r\n\r\n    private updateMultiSeriesAndCategory(previousChartType: ChartType, chartType: ChartType): void {\r\n        // If we are changing from a multi-category/series chart type to a single-category/series chart type,\r\n        // ensure that only the allowed number of selected category/series column remain selected\r\n        const updateForMax = (columns: ColState[], maxNum: number) => {\r\n            let numSelected = 0;\r\n            for (const colState of columns) {\r\n                if (!colState.selected) continue;\r\n                if (numSelected >= maxNum) {\r\n                    colState.selected = false;\r\n                } else {\r\n                    numSelected++;\r\n                }\r\n            }\r\n            if (numSelected === 0) {\r\n                columns[0].selected = true;\r\n            }\r\n        };\r\n\r\n        const maxNumDimensions = getMaxNumCategories(chartType);\r\n        const maxNumSeries = getMaxNumSeries(chartType);\r\n        const updateDimensionColState =\r\n            maxNumDimensions != null && (getMaxNumCategories(previousChartType) ?? 100) > (maxNumDimensions ?? 100);\r\n        const updateValueColState =\r\n            maxNumSeries != null && (getMaxNumSeries(previousChartType) ?? 100) > (maxNumSeries ?? 100);\r\n        if (updateDimensionColState) {\r\n            updateForMax(this.model.dimensionColState, maxNumDimensions);\r\n        }\r\n        if (updateValueColState) {\r\n            updateForMax(this.model.valueColState, maxNumSeries);\r\n        }\r\n        if (updateDimensionColState || updateValueColState) {\r\n            this.model.resetCellRanges(updateDimensionColState, updateValueColState);\r\n            this.setChartRange(true);\r\n        }\r\n    }\r\n\r\n    public setChartThemeName(chartThemeName: string, silent?: boolean): void {\r\n        this.model.chartThemeName = chartThemeName;\r\n        if (!silent) {\r\n            this.raiseChartModelUpdateEvent();\r\n            this.raiseChartOptionsChangedEvent();\r\n        }\r\n    }\r\n\r\n    public getChartThemeName(): string {\r\n        return this.model.chartThemeName;\r\n    }\r\n\r\n    public isPivotChart(): boolean {\r\n        return this.model.pivotChart;\r\n    }\r\n\r\n    public isPivotMode(): boolean {\r\n        return this.model.isPivotMode();\r\n    }\r\n\r\n    public isGrouping(): boolean {\r\n        return this.model.isGrouping();\r\n    }\r\n\r\n    public isCrossFilterChart(): boolean {\r\n        return this.model.crossFiltering;\r\n    }\r\n\r\n    public getThemeNames(): string[] {\r\n        return this.gos.get('chartThemes') || DEFAULT_THEMES;\r\n    }\r\n\r\n    public getThemes(): IChartTheme[] {\r\n        const themeNames = this.getThemeNames();\r\n\r\n        return themeNames.map((themeName) => {\r\n            const stockTheme = isStockTheme(themeName, this.agChartsExports._Theme);\r\n            const theme = stockTheme ? themeName : this.chartProxy.lookupCustomChartTheme(themeName);\r\n            return this.agChartsExports._Theme.getChartTheme(theme);\r\n        });\r\n    }\r\n\r\n    public getPalettes(): AgChartThemePalette[] {\r\n        const themes = this.getThemes();\r\n\r\n        return themes.map((theme) => {\r\n            return theme.palette;\r\n        });\r\n    }\r\n\r\n    public getThemeTemplateParameters(): Map<any, any>[] {\r\n        const themes = this.getThemes();\r\n\r\n        return themes.map((theme) => {\r\n            return theme.getTemplateParameters();\r\n        });\r\n    }\r\n\r\n    public getValueColState(): ColState[] {\r\n        return this.model.valueColState.map(this.displayNameMapper.bind(this));\r\n    }\r\n\r\n    public getSelectedValueColState(): { colId: string; displayName: string | null }[] {\r\n        return this.getValueColState().filter((cs) => cs.selected);\r\n    }\r\n\r\n    public getSelectedDimensions(): ColState[] {\r\n        return this.model.getSelectedDimensions();\r\n    }\r\n\r\n    private displayNameMapper(col: ColState): ColState {\r\n        const { column } = col;\r\n        if (column) {\r\n            col.displayName = this.model.getColDisplayName(column, this.model.isPivotMode());\r\n        } else {\r\n            const colNames = this.model.colNames[col.colId];\r\n            col.displayName = colNames ? colNames.join(' - ') : this.model.getColDisplayName(column!);\r\n        }\r\n        return col;\r\n    }\r\n\r\n    public getColStateForMenu(): { dimensionCols: ColState[]; valueCols: ColState[] } {\r\n        return { dimensionCols: this.model.dimensionColState, valueCols: this.getValueColState() };\r\n    }\r\n\r\n    public setChartRange(silent = false): void {\r\n        if (this.rangeSvc && !this.model.suppressChartRanges && !this.model.unlinked) {\r\n            this.rangeSvc.setCellRanges(this.getCellRanges());\r\n        }\r\n\r\n        if (!silent) {\r\n            this.raiseChartModelUpdateEvent();\r\n        }\r\n    }\r\n\r\n    public detachChartRange(): void {\r\n        // when chart is detached it won't listen to changes from the grid\r\n        this.model.unlinked = !this.model.unlinked;\r\n\r\n        if (this.model.unlinked) {\r\n            // remove range from grid\r\n            if (this.rangeSvc) {\r\n                this.rangeSvc.setCellRanges([]);\r\n            }\r\n        } else {\r\n            // update chart data may have changed\r\n            this.updateForGridChange();\r\n        }\r\n        this.dispatchLocalEvent({ type: 'chartLinkedChanged' });\r\n    }\r\n\r\n    public setChartProxy(chartProxy: ChartProxy): void {\r\n        this.chartProxy = chartProxy;\r\n    }\r\n\r\n    public getChartProxy(): ChartProxy {\r\n        return this.chartProxy;\r\n    }\r\n\r\n    public isActiveXYChart(): boolean {\r\n        return ['scatter', 'bubble'].includes(this.getChartType());\r\n    }\r\n\r\n    public isChartLinked(): boolean {\r\n        return !this.model.unlinked;\r\n    }\r\n\r\n    public customComboExists(): boolean {\r\n        const savedCustomSeriesChartTypes = this.model.comboChartModel.savedCustomSeriesChartTypes;\r\n        return savedCustomSeriesChartTypes && savedCustomSeriesChartTypes.length > 0;\r\n    }\r\n\r\n    public getSeriesChartTypes(): SeriesChartType[] {\r\n        return this.model.comboChartModel.seriesChartTypes;\r\n    }\r\n\r\n    public isComboChart(chartType?: ChartType): boolean {\r\n        return this.model.isComboChart(chartType);\r\n    }\r\n\r\n    public updateSeriesChartType(colId: string, chartType?: ChartType, secondaryAxis?: boolean): void {\r\n        const seriesChartType = this.model.comboChartModel.seriesChartTypes.find((s) => s.colId === colId);\r\n        if (seriesChartType) {\r\n            // once a combo chart has been modified it is now a 'customCombo' chart\r\n            const updateChartType = this.model.chartType !== 'customCombo';\r\n            if (updateChartType) {\r\n                this.model.chartType = 'customCombo';\r\n            }\r\n\r\n            const prevSeriesChartType = seriesChartType.chartType;\r\n            if (chartType != null) {\r\n                seriesChartType.chartType = chartType;\r\n            }\r\n\r\n            if (secondaryAxis != null) {\r\n                seriesChartType.secondaryAxis = secondaryAxis;\r\n            }\r\n\r\n            // replace existing custom series types with this latest version\r\n            this.model.comboChartModel.savedCustomSeriesChartTypes = this.model.comboChartModel.seriesChartTypes;\r\n\r\n            // series chart types can be modified, i.e. column chart types should be moved to primary axis\r\n            this.model.comboChartModel.updateSeriesChartTypes();\r\n\r\n            this.updateForDataChange();\r\n\r\n            if (updateChartType) {\r\n                // update the settings panel by raising an 'chartTypeChanged' event\r\n                this.dispatchLocalEvent({\r\n                    type: 'chartTypeChanged',\r\n                });\r\n            }\r\n\r\n            if (prevSeriesChartType !== chartType) {\r\n                // update the format panel by raising an chartSeriesChartTypeChanged event\r\n                this.dispatchLocalEvent({\r\n                    type: 'chartSeriesChartTypeChanged',\r\n                });\r\n            }\r\n\r\n            this.raiseChartOptionsChangedEvent();\r\n        }\r\n    }\r\n\r\n    public getActiveSeriesChartTypes(): SeriesChartType[] {\r\n        const selectedColIds = this.getSelectedValueColState().map((c) => c.colId);\r\n        return this.getSeriesChartTypes().filter((s) => selectedColIds.includes(s.colId));\r\n    }\r\n\r\n    public getChartSeriesTypes(chartType?: ChartType): ChartSeriesType[] {\r\n        const targetChartType = chartType ?? this.getChartType();\r\n        return this.isComboChart(targetChartType) ? ['line', 'bar', 'area'] : [getSeriesType(targetChartType)];\r\n    }\r\n\r\n    public getChartSeriesType(): ChartSeriesType {\r\n        const seriesChartTypes = this.getSeriesChartTypes();\r\n\r\n        if (seriesChartTypes.length === 0) {\r\n            return 'bar';\r\n        }\r\n        const ct = seriesChartTypes[0].chartType;\r\n\r\n        if (ct === 'columnLineCombo') {\r\n            return 'bar';\r\n        }\r\n\r\n        if (ct === 'areaColumnCombo') {\r\n            return 'area';\r\n        }\r\n        return getSeriesType(ct);\r\n    }\r\n\r\n    public isEnterprise = () => this.agChartsExports.isEnterprise;\r\n\r\n    private getCellRanges(): CellRange[] {\r\n        return [this.model.dimensionCellRange!, this.model.valueCellRange!].filter((r) => r);\r\n    }\r\n\r\n    private createCellRange(\r\n        params: UpdateRangeChartParams | UpdateCrossFilterChartParams\r\n    ): PartialCellRange | undefined {\r\n        return (\r\n            params.cellRange &&\r\n            this.rangeSvc?.createPartialCellRangeFromRangeParams(params.cellRange as CellRangeParams, true)\r\n        );\r\n    }\r\n\r\n    private validUpdateType(params: UpdateChartParams): boolean {\r\n        if (!params.type) {\r\n            _warn(136);\r\n            return false;\r\n        }\r\n\r\n        const chartTypeMap: Record<string, () => boolean> = {\r\n            'Range Chart': () => !this.isPivotChart() && !this.isCrossFilterChart(),\r\n            'Pivot Chart': () => this.isPivotChart(),\r\n            'Cross Filter Chart': () => this.isCrossFilterChart(),\r\n        };\r\n\r\n        const currentChartType = Object.keys(chartTypeMap).find((type) => chartTypeMap[type]()) ?? 'Range Chart';\r\n\r\n        const valid =\r\n            params.type === `${currentChartType[0].toLowerCase()}${currentChartType.slice(1).replace(/ /g, '')}Update`;\r\n\r\n        if (!valid) {\r\n            _warn(137, { currentChartType, type: params.type });\r\n        }\r\n        return valid;\r\n    }\r\n\r\n    private getCellRangeParams(): CellRangeParams {\r\n        const cellRanges = this.getCellRanges();\r\n        const firstCellRange = cellRanges[0];\r\n        const startRow = (firstCellRange && firstCellRange.startRow) || null;\r\n        const endRow = (firstCellRange && firstCellRange.endRow) || null;\r\n\r\n        return {\r\n            rowStartIndex: startRow && startRow.rowIndex,\r\n            rowStartPinned: startRow && startRow.rowPinned,\r\n            rowEndIndex: endRow && endRow.rowIndex,\r\n            rowEndPinned: endRow && endRow.rowPinned,\r\n            columns: cellRanges.reduce(\r\n                (columns, value) => columns.concat(value.columns.map((c) => c.getId())),\r\n                [] as string[]\r\n            ),\r\n        };\r\n    }\r\n\r\n    public setCategoryAxisType(categoryAxisType?: AgCartesianAxisType): void {\r\n        this.model.categoryAxisType = categoryAxisType;\r\n        this.raiseChartModelUpdateEvent();\r\n    }\r\n\r\n    public getSeriesGroupType(): SeriesGroupType | undefined {\r\n        return this.model.seriesGroupType ?? this.chartProxy.getSeriesGroupType();\r\n    }\r\n\r\n    public setSeriesGroupType(seriesGroupType?: SeriesGroupType): void {\r\n        this.model.seriesGroupType = seriesGroupType;\r\n        this.raiseChartModelUpdateEvent();\r\n    }\r\n\r\n    public raiseChartModelUpdateEvent(): void {\r\n        this.dispatchLocalEvent({ type: 'chartModelUpdate' });\r\n    }\r\n\r\n    public raiseChartUpdatedEvent(): void {\r\n        this.dispatchLocalEvent({ type: 'chartUpdated' });\r\n    }\r\n\r\n    public raiseChartApiUpdateEvent(): void {\r\n        this.dispatchLocalEvent({ type: 'chartApiUpdate' });\r\n    }\r\n\r\n    private raiseChartOptionsChangedEvent(): void {\r\n        const { chartId, chartType } = this.getChartModel();\r\n\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'chartOptionsChanged',\r\n            chartId,\r\n            chartType,\r\n            chartThemeName: this.getChartThemeName(),\r\n            chartOptions: this.chartProxy.getChartThemeOverrides(),\r\n        });\r\n    }\r\n\r\n    private raiseChartRangeSelectionChangedEvent(): void {\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'chartRangeSelectionChanged',\r\n            id: this.model.chartId,\r\n            chartId: this.model.chartId,\r\n            cellRange: this.getCellRangeParams(),\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n\r\n        if (this.rangeSvc) {\r\n            this.rangeSvc.setCellRanges([]);\r\n        }\r\n    }\r\n}\r\n", "import type { AgChartThemeOverrides } from 'ag-charts-types';\r\n\r\nimport type {\r\n    ChartParamsCellRange,\r\n    ChartType,\r\n    IAggFunc,\r\n    UpdateChartParams,\r\n    UpdateCrossFilterChartParams,\r\n    UpdatePivotChartParams,\r\n    UpdateRangeChartParams,\r\n} from 'ag-grid-community';\r\nimport { _warnOnce } from 'ag-grid-community';\r\n\r\nimport type { CommonCreateChartParams } from '../../chartService';\r\nimport { getCanonicalChartType, getSeriesTypeIfExists, isComboChart, isEnterpriseChartType } from './seriesTypeMapper';\r\n\r\nconst validateIfDefined = <I, O = never>(validationFn: (value: NonNullable<I>) => boolean | O) => {\r\n    return (value: I | null | undefined): boolean | O => {\r\n        if (value == undefined) return true;\r\n        return validationFn(value as NonNullable<I>);\r\n    };\r\n};\r\n\r\nconst isString = (value: any): boolean => typeof value === 'string';\r\nconst isBoolean = (value: any): boolean => typeof value === 'boolean';\r\nconst isValidSeriesChartType = (value: any): boolean => typeof value === 'object';\r\nconst createWarnMessage =\r\n    (property: string, expectedType: string): ((value: any) => string) =>\r\n    (value: any) =>\r\n        `AG Grid - unable to update chart as invalid params supplied:  \\`${property}: ${value}\\`, expected ${expectedType}.`;\r\n\r\nconst createEnterpriseMessage = (feature: string) => {\r\n    const url = 'https://www.ag-grid.com/javascript-data-grid/integrated-charts-installation/';\r\n    return `${feature} is not supported in AG Charts Community ('ag-charts-enterprise' hasn't been loaded). See ${url} for more details.`;\r\n};\r\n\r\ninterface ValidationFunction<T, K extends keyof T = keyof T, V = T[K]> {\r\n    property: K;\r\n    validationFn: (value: T[K]) => boolean | V;\r\n    warnMessage: (value: T[K]) => string;\r\n    warnIfFixed?: boolean;\r\n}\r\n\r\nconst legacyChartTypes: ChartType[] = ['doughnut'];\r\n\r\nconst baseUpdateChartParams = [\r\n    'type',\r\n    'chartId',\r\n    'chartType',\r\n    'chartThemeName',\r\n    'chartThemeOverrides',\r\n    'unlinkChart',\r\n] as const;\r\n\r\nfunction isValidChartType(value: string): value is ChartType {\r\n    return !!getSeriesTypeIfExists(value as ChartType) || isComboChart(value as ChartType);\r\n}\r\n\r\nfunction isLegacyChartType(value: string): value is ChartType {\r\n    return legacyChartTypes.includes(value as ChartType);\r\n}\r\n\r\nconst validateChartType = validateIfDefined<UpdateChartParams['chartType'], Exclude<ChartType, 'doughnut'>>(\r\n    (chartType) => {\r\n        if (isValidChartType(chartType)) return true;\r\n        if (isLegacyChartType(chartType)) {\r\n            const renamedChartType = getCanonicalChartType(chartType);\r\n            _warnOnce(`The chart type '${chartType}' has been deprecated. Please use '${renamedChartType}' instead.`);\r\n            return renamedChartType;\r\n        }\r\n        return false;\r\n    }\r\n);\r\n\r\nconst validateAgChartThemeOverrides = validateIfDefined<AgChartThemeOverrides>((themeOverrides) => {\r\n    // ensure supplied AgChartThemeOverrides is an object - can be improved if necessary?\r\n    return typeof themeOverrides === 'object';\r\n});\r\n\r\nconst validateChartParamsCellRange = validateIfDefined<ChartParamsCellRange>((cellRange) => {\r\n    // ensure supplied ChartParamsCellRange is an object - can be improved if necessary?\r\n    return typeof cellRange === 'object';\r\n});\r\n\r\nconst validateAggFunc = validateIfDefined<string | IAggFunc>((aggFunc) => {\r\n    // ensure supplied aggFunc is a `string` or `function` - can be improved if necessary?\r\n    return typeof aggFunc === 'string' || typeof aggFunc === 'function';\r\n});\r\n\r\nconst enterpriseChartTypeValidation: (isEnterprise: boolean) => ValidationFunction<any> = (isEnterprise) => ({\r\n    property: 'chartType',\r\n    validationFn: validateIfDefined<ChartType>(\r\n        (chartType) => isEnterprise || !chartType || !isEnterpriseChartType(chartType)\r\n    ),\r\n    warnMessage: (chartType) => createEnterpriseMessage(`The '${chartType}' chart type`),\r\n});\r\n\r\nconst switchCategorySeriesValidation: (isEnterprise: boolean) => ValidationFunction<any> = (isEnterprise) => ({\r\n    property: 'switchCategorySeries',\r\n    validationFn: validateIfDefined<boolean, undefined>((switchCategorySeries) => {\r\n        if (!switchCategorySeries || isEnterprise) {\r\n            return true;\r\n        }\r\n        return undefined;\r\n    }),\r\n    warnMessage: () => createEnterpriseMessage(`'switchCategorySeries' has been ignored as it`),\r\n    warnIfFixed: true,\r\n});\r\n\r\nconst commonUpdateValidations: () => ValidationFunction<any>[] = () => [\r\n    { property: 'chartId', validationFn: isString, warnMessage: createWarnMessage('chartId', 'string') },\r\n    {\r\n        property: 'chartType',\r\n        validationFn: validateChartType,\r\n        warnMessage: createWarnMessage('chartType', 'ChartType'),\r\n    },\r\n    {\r\n        property: 'chartThemeName',\r\n        validationFn: isString,\r\n        warnMessage: createWarnMessage('chartThemeName', 'string'),\r\n    },\r\n    {\r\n        property: 'chartThemeOverrides',\r\n        validationFn: validateAgChartThemeOverrides,\r\n        warnMessage: createWarnMessage('chartThemeOverrides', 'AgChartThemeOverrides'),\r\n    },\r\n    { property: 'unlinkChart', validationFn: isBoolean, warnMessage: createWarnMessage('unlinkChart', 'boolean') },\r\n];\r\n\r\nconst cellRangeValidations: (isEnterprise: boolean) => ValidationFunction<any>[] = (isEnterprise) => [\r\n    {\r\n        property: 'cellRange',\r\n        validationFn: validateChartParamsCellRange,\r\n        warnMessage: createWarnMessage('cellRange', 'ChartParamsCellRange'),\r\n    },\r\n    {\r\n        property: 'suppressChartRanges',\r\n        validationFn: isBoolean,\r\n        warnMessage: createWarnMessage('suppressChartRanges', 'boolean'),\r\n    },\r\n    {\r\n        property: 'aggFunc',\r\n        validationFn: validateAggFunc,\r\n        warnMessage: createWarnMessage('aggFunc', 'string or IAggFunc'),\r\n    },\r\n    switchCategorySeriesValidation(isEnterprise),\r\n];\r\n\r\nexport function validateUpdateParams(params: UpdateChartParams, isEnterprise: boolean): boolean | UpdateChartParams {\r\n    const paramsToValidate = params as UpdateChartParams;\r\n    switch (paramsToValidate.type) {\r\n        case 'rangeChartUpdate':\r\n            return validateUpdateRangeChartParams(params as UpdateRangeChartParams, isEnterprise);\r\n        case 'pivotChartUpdate':\r\n            return validateUpdatePivotChartParams(params as UpdatePivotChartParams);\r\n        case 'crossFilterChartUpdate':\r\n            return validateUpdateCrossFilterChartParams(params as UpdateCrossFilterChartParams, isEnterprise);\r\n        default:\r\n            _warnOnce(\r\n                `Invalid value supplied for 'type': ${params.type}. It must be either 'rangeChartUpdate', 'pivotChartUpdate', or 'crossFilterChartUpdate'.`\r\n            );\r\n            return false;\r\n    }\r\n}\r\n\r\nexport function validateCreateParams(\r\n    params: CommonCreateChartParams,\r\n    isEnterprise: boolean\r\n): boolean | CommonCreateChartParams {\r\n    return validateProperties(params, [\r\n        enterpriseChartTypeValidation(isEnterprise),\r\n        switchCategorySeriesValidation(isEnterprise),\r\n    ]);\r\n}\r\n\r\nfunction validateUpdateRangeChartParams(\r\n    params: UpdateRangeChartParams,\r\n    isEnterprise: boolean\r\n): boolean | UpdateRangeChartParams {\r\n    const validations: ValidationFunction<any>[] = [\r\n        ...commonUpdateValidations(),\r\n        enterpriseChartTypeValidation(isEnterprise),\r\n        ...cellRangeValidations(isEnterprise),\r\n        {\r\n            property: 'seriesChartTypes',\r\n            validationFn: (value: any) =>\r\n                value === undefined || (Array.isArray(value) && value.every(isValidSeriesChartType)),\r\n            warnMessage: createWarnMessage('seriesChartTypes', 'Array of SeriesChartType'),\r\n        },\r\n    ];\r\n\r\n    return validateProperties(\r\n        params,\r\n        validations,\r\n        [\r\n            ...baseUpdateChartParams,\r\n            'cellRange',\r\n            'suppressChartRanges',\r\n            'switchCategorySeries',\r\n            'aggFunc',\r\n            'seriesChartTypes',\r\n            'seriesGroupType',\r\n        ],\r\n        'UpdateRangeChartParams'\r\n    );\r\n}\r\n\r\nfunction validateUpdatePivotChartParams(params: UpdatePivotChartParams): boolean | UpdatePivotChartParams {\r\n    const validations: ValidationFunction<any>[] = [...commonUpdateValidations()];\r\n\r\n    return validateProperties(params, validations, [...baseUpdateChartParams], 'UpdatePivotChartParams');\r\n}\r\n\r\nfunction validateUpdateCrossFilterChartParams(\r\n    params: UpdateCrossFilterChartParams,\r\n    isEnterprise: boolean\r\n): boolean | UpdateCrossFilterChartParams {\r\n    const validations: ValidationFunction<any>[] = [\r\n        ...commonUpdateValidations(),\r\n        ...cellRangeValidations(isEnterprise),\r\n    ];\r\n\r\n    return validateProperties(\r\n        params,\r\n        validations,\r\n        [...baseUpdateChartParams, 'cellRange', 'suppressChartRanges', 'aggFunc'],\r\n        'UpdateCrossFilterChartParams'\r\n    );\r\n}\r\n\r\nfunction validateProperties<T extends object>(\r\n    params: T,\r\n    validations: ValidationFunction<T>[],\r\n    validPropertyNames?: (keyof T)[],\r\n    paramsType?: string\r\n): boolean | T {\r\n    let validatedProperties: T | undefined = undefined;\r\n    for (const validation of validations) {\r\n        const { property, validationFn, warnMessage, warnIfFixed } = validation;\r\n        if (property in params) {\r\n            const value = params[property];\r\n            const validationResult = validationFn(value);\r\n            if (validationResult === true) continue;\r\n            if (validationResult === false) {\r\n                _warnOnce(warnMessage(value));\r\n                return false;\r\n            }\r\n            // If the validation function returned a 'fix' value, we need to return an updated property set.\r\n            // First we clone the input set if there has not been a 'fix' encountered in a previous iteration:\r\n            validatedProperties = validatedProperties || { ...params };\r\n            /// Then we update the cloned object with the 'fixed' value\r\n            validatedProperties[property] = validationResult;\r\n            if (warnIfFixed) {\r\n                _warnOnce(warnMessage(value));\r\n            }\r\n        }\r\n    }\r\n\r\n    if (validPropertyNames) {\r\n        // Check for unexpected properties\r\n        for (const property of Object.keys(params)) {\r\n            if (!validPropertyNames.includes(property as keyof T)) {\r\n                _warnOnce(`Unexpected property supplied. ${paramsType} does not contain: \\`${property}\\`.`);\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n\r\n    // If one or more 'fixed' values were encountered, return the updated property set\r\n    if (validatedProperties) return validatedProperties;\r\n\r\n    return true;\r\n}\r\n", "import type { AgAreaSeriesOptions, AgCartesianAxisOptions } from 'ag-charts-types';\r\n\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { CartesianChartProxy } from './cartesianChartProxy';\r\n\r\nexport class AreaChartProxy extends CartesianChartProxy<'area'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected override getAxes(params: UpdateParams): AgCartesianAxisOptions[] {\r\n        const axes: AgCartesianAxisOptions[] = [\r\n            {\r\n                type: this.getXAxisType(params),\r\n                position: 'bottom',\r\n            },\r\n            {\r\n                type: 'number',\r\n                position: 'left',\r\n            },\r\n        ];\r\n\r\n        // Add a default label formatter to show '%' for normalized charts if none is provided\r\n        if (this.isNormalised()) {\r\n            const numberAxis = axes[1];\r\n            numberAxis.label = { ...numberAxis.label, formatter: (params) => Math.round(params.value) + '%' };\r\n        }\r\n\r\n        return axes;\r\n    }\r\n\r\n    protected override getSeries(params: UpdateParams) {\r\n        const [category] = params.categories;\r\n        const series: AgAreaSeriesOptions[] = params.fields.map(\r\n            (f) =>\r\n                ({\r\n                    type: this.standaloneChartType,\r\n                    xKey: category.id,\r\n                    xName: category.name,\r\n                    yKey: f.colId,\r\n                    yName: f.displayName,\r\n                    normalizedTo: this.chartType === 'normalizedArea' ? 100 : undefined,\r\n                    stacked: ['normalizedArea', 'stackedArea'].includes(this.chartType),\r\n                }) as AgAreaSeriesOptions\r\n        );\r\n\r\n        return this.crossFiltering ? this.extractLineAreaCrossFilterSeries(series, params) : series;\r\n    }\r\n\r\n    private isNormalised() {\r\n        return !this.crossFiltering && this.chartType === 'normalizedArea';\r\n    }\r\n}\r\n", "export function hexToRGBA(hex: string, alpha: string) {\r\n    const r = parseInt(hex.slice(1, 3), 16);\r\n    const g = parseInt(hex.slice(3, 5), 16);\r\n    const b = parseInt(hex.slice(5, 7), 16);\r\n    return alpha ? `rgba(${r}, ${g}, ${b}, ${alpha})` : `rgba(${r}, ${g}, ${b})`;\r\n}\r\n", "import type { AgBarSeriesOptions, AgCartesianAxisOptions } from 'ag-charts-types';\r\n\r\nimport { hexToRGBA } from '../../utils/color';\r\nimport { isStacked } from '../../utils/seriesTypeMapper';\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { CartesianChartProxy } from './cartesianChartProxy';\r\n\r\nconst HORIZONTAL_CHART_TYPES = new Set(['bar', 'groupedBar', 'stackedBar', 'normalizedBar']);\r\n\r\nexport class BarChartProxy extends CartesianChartProxy<'bar'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected override getAxes(params: UpdateParams): AgCartesianAxisOptions[] {\r\n        const axes: AgCartesianAxisOptions[] = [\r\n            {\r\n                type: this.getXAxisType(params),\r\n                position: this.isHorizontal() ? 'left' : 'bottom',\r\n            },\r\n            {\r\n                type: 'number',\r\n                position: this.isHorizontal() ? 'bottom' : 'left',\r\n            },\r\n        ];\r\n        // Add a default label formatter to show '%' for normalized charts if none is provided\r\n        if (this.isNormalised()) {\r\n            const numberAxis = axes[1];\r\n            numberAxis.label = { ...numberAxis.label, formatter: (params) => Math.round(params.value) + '%' };\r\n        }\r\n\r\n        return axes;\r\n    }\r\n\r\n    protected override getSeries(params: UpdateParams): AgBarSeriesOptions[] {\r\n        const [category] = params.categories;\r\n        const series: AgBarSeriesOptions[] = params.fields.map(\r\n            (f) =>\r\n                ({\r\n                    type: this.standaloneChartType,\r\n                    direction: this.isHorizontal() ? 'horizontal' : 'vertical',\r\n                    stacked: this.crossFiltering || isStacked(this.chartType),\r\n                    normalizedTo: this.isNormalised() ? 100 : undefined,\r\n                    xKey: category.id,\r\n                    xName: category.name,\r\n                    yKey: f.colId,\r\n                    yName: f.displayName,\r\n                }) as AgBarSeriesOptions\r\n        );\r\n\r\n        return this.crossFiltering ? this.extractCrossFilterSeries(series) : series;\r\n    }\r\n\r\n    private extractCrossFilterSeries(series: AgBarSeriesOptions[]): AgBarSeriesOptions[] {\r\n        const palette = this.getChartPalette();\r\n\r\n        const updatePrimarySeries = (seriesOptions: AgBarSeriesOptions, index: number) => {\r\n            return {\r\n                ...seriesOptions,\r\n                highlightStyle: { item: { fill: undefined } },\r\n                fill: palette?.fills?.[index],\r\n                stroke: palette?.strokes?.[index],\r\n                listeners: {\r\n                    nodeClick: this.crossFilterCallback,\r\n                },\r\n            };\r\n        };\r\n\r\n        const updateFilteredOutSeries = (seriesOptions: AgBarSeriesOptions): AgBarSeriesOptions => {\r\n            const yKey = seriesOptions.yKey + '-filtered-out';\r\n            return {\r\n                ...seriesOptions,\r\n                yKey,\r\n                fill: hexToRGBA(seriesOptions.fill!, '0.3'),\r\n                stroke: hexToRGBA(seriesOptions.stroke!, '0.3'),\r\n                showInLegend: false,\r\n            };\r\n        };\r\n\r\n        const allSeries: AgBarSeriesOptions[] = [];\r\n        for (let i = 0; i < series.length; i++) {\r\n            const originalSeries = series[i];\r\n            // update primary series\r\n            allSeries.push(updatePrimarySeries(originalSeries, i));\r\n\r\n            // add 'filtered-out' series\r\n            allSeries.push(updateFilteredOutSeries(updatePrimarySeries(originalSeries, i)));\r\n        }\r\n        return allSeries;\r\n    }\r\n\r\n    private isNormalised() {\r\n        const normalisedCharts = ['normalizedColumn', 'normalizedBar'];\r\n        return !this.crossFiltering && normalisedCharts.includes(this.chartType);\r\n    }\r\n\r\n    protected override isHorizontal(): boolean {\r\n        return HORIZONTAL_CHART_TYPES.has(this.chartType);\r\n    }\r\n}\r\n", "import type { AgCartesianAxisOptions, AgLineSeriesOptions } from 'ag-charts-types';\r\n\r\nimport type { ChartProxyParams, UpdateParams } from '../chartProxy';\r\nimport { CartesianChartProxy } from './cartesianChartProxy';\r\n\r\nexport class LineChartProxy extends CartesianChartProxy<'line'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected override getAxes(params: UpdateParams): AgCartesianAxisOptions[] {\r\n        const axes: AgCartesianAxisOptions[] = [\r\n            {\r\n                type: this.getXAxisType(params),\r\n                position: 'bottom',\r\n            },\r\n            {\r\n                type: 'number',\r\n                position: 'left',\r\n            },\r\n        ];\r\n\r\n        // Add a default label formatter to show '%' for normalized charts if none is provided\r\n        if (this.isNormalised()) {\r\n            const numberAxis = axes[1];\r\n            numberAxis.label = { ...numberAxis.label, formatter: (params) => Math.round(params.value) + '%' };\r\n        }\r\n\r\n        return axes;\r\n    }\r\n\r\n    protected override getSeries(params: UpdateParams) {\r\n        const [category] = params.categories;\r\n        const stacked = ['normalizedLine', 'stackedLine'].includes(this.chartType);\r\n\r\n        const series: AgLineSeriesOptions[] = params.fields.map(\r\n            (f) =>\r\n                ({\r\n                    type: this.standaloneChartType,\r\n                    xKey: category.id,\r\n                    xName: category.name,\r\n                    yKey: f.colId,\r\n                    yName: f.displayName,\r\n                    normalizedTo: stacked && this.isNormalised() ? 100 : undefined,\r\n                    stacked,\r\n                }) as AgLineSeriesOptions\r\n        );\r\n\r\n        return this.crossFiltering ? this.extractLineAreaCrossFilterSeries(series, params) : series;\r\n    }\r\n\r\n    private isNormalised() {\r\n        const normalisedCharts = ['normalizedLine'];\r\n        return !this.crossFiltering && normalisedCharts.includes(this.chartType);\r\n    }\r\n}\r\n", "import type { AgBubbleSeriesOptions, AgCartesianAxisOptions, AgScatterSeriesOptions } from 'ag-charts-types';\r\n\r\nimport { DEFAULT_CHART_CATEGORY } from '../../model/chartDataModel';\r\nimport type { ChartProxyParams, FieldDefinition, UpdateParams } from '../chartProxy';\r\nimport { CartesianChartProxy } from './cartesianChartProxy';\r\n\r\ninterface SeriesDefinition {\r\n    xField: FieldDefinition;\r\n    yField: FieldDefinition;\r\n    sizeField?: FieldDefinition;\r\n}\r\n\r\nexport class ScatterChartProxy extends CartesianChartProxy<'scatter' | 'bubble'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected override getAxes(_params: UpdateParams): AgCartesianAxisOptions[] {\r\n        return [\r\n            {\r\n                type: 'number',\r\n                position: 'bottom',\r\n            },\r\n            {\r\n                type: 'number',\r\n                position: 'left',\r\n            },\r\n        ];\r\n    }\r\n\r\n    protected override getSeries(params: UpdateParams): (AgScatterSeriesOptions | AgBubbleSeriesOptions)[] {\r\n        const [category] = params.categories;\r\n        const paired = this.isPaired();\r\n        const seriesDefinitions = this.getSeriesDefinitions(params.fields, paired);\r\n        const labelFieldDefinition = category.id === DEFAULT_CHART_CATEGORY ? undefined : category;\r\n\r\n        const series = seriesDefinitions.map((seriesDefinition) => {\r\n            if (seriesDefinition?.sizeField) {\r\n                const opts: AgBubbleSeriesOptions = {\r\n                    type: 'bubble',\r\n                    xKey: seriesDefinition!.xField.colId,\r\n                    xName: seriesDefinition!.xField.displayName ?? undefined,\r\n                    yKey: seriesDefinition!.yField.colId,\r\n                    yName: seriesDefinition!.yField.displayName ?? undefined,\r\n                    title: `${seriesDefinition!.yField.displayName} vs ${seriesDefinition!.xField.displayName}`,\r\n                    sizeKey: seriesDefinition!.sizeField.colId,\r\n                    sizeName: seriesDefinition!.sizeField.displayName ?? '',\r\n                    labelKey: labelFieldDefinition ? labelFieldDefinition.id : seriesDefinition!.yField.colId,\r\n                    labelName: labelFieldDefinition ? labelFieldDefinition.name : undefined,\r\n                };\r\n                return opts;\r\n            }\r\n\r\n            const opts: AgScatterSeriesOptions = {\r\n                type: 'scatter',\r\n                xKey: seriesDefinition!.xField.colId,\r\n                xName: seriesDefinition!.xField.displayName ?? undefined,\r\n                yKey: seriesDefinition!.yField.colId,\r\n                yName: seriesDefinition!.yField.displayName ?? undefined,\r\n                title: `${seriesDefinition!.yField.displayName} vs ${seriesDefinition!.xField.displayName}`,\r\n                labelKey: labelFieldDefinition ? labelFieldDefinition.id : seriesDefinition!.yField.colId,\r\n                labelName: labelFieldDefinition ? labelFieldDefinition.name : undefined,\r\n            };\r\n            return opts;\r\n        });\r\n\r\n        return this.crossFiltering ? this.extractCrossFilterSeries(series, params) : series;\r\n    }\r\n\r\n    private extractCrossFilterSeries(\r\n        series: (AgScatterSeriesOptions | AgBubbleSeriesOptions)[],\r\n        params: UpdateParams\r\n    ): (AgScatterSeriesOptions | AgBubbleSeriesOptions)[] {\r\n        const { data } = params;\r\n        const palette = this.getChartPalette();\r\n\r\n        const filteredOutKey = (key: string) => `${key}-filtered-out`;\r\n\r\n        const calcMarkerDomain = (data: any, sizeKey?: string) => {\r\n            const markerDomain: [number, number] = [Infinity, -Infinity];\r\n            if (sizeKey != null) {\r\n                for (const datum of data) {\r\n                    const value = datum[sizeKey] ?? datum[filteredOutKey(sizeKey)];\r\n                    if (value < markerDomain[0]) {\r\n                        markerDomain[0] = value;\r\n                    }\r\n                    if (value > markerDomain[1]) {\r\n                        markerDomain[1] = value;\r\n                    }\r\n                }\r\n            }\r\n            if (markerDomain[0] <= markerDomain[1]) {\r\n                return markerDomain;\r\n            }\r\n            return undefined;\r\n        };\r\n\r\n        const updatePrimarySeries = <T extends AgScatterSeriesOptions | AgBubbleSeriesOptions>(\r\n            series: T,\r\n            idx: number\r\n        ): T => {\r\n            const fill = palette?.fills?.[idx];\r\n            const stroke = palette?.strokes?.[idx];\r\n\r\n            let markerDomain: [number, number] | undefined = undefined;\r\n            if (series.type === 'bubble') {\r\n                const { sizeKey } = series;\r\n                markerDomain = calcMarkerDomain(data, sizeKey);\r\n            }\r\n\r\n            return {\r\n                ...series,\r\n                fill,\r\n                stroke,\r\n                domain: markerDomain,\r\n                highlightStyle: { item: { fill: 'yellow' } },\r\n                listeners: {\r\n                    ...series.listeners,\r\n                    nodeClick: this.crossFilterCallback,\r\n                },\r\n            };\r\n        };\r\n\r\n        const updateFilteredOutSeries = <T extends AgScatterSeriesOptions | AgBubbleSeriesOptions>(series: T): T => {\r\n            const { yKey, xKey } = series;\r\n\r\n            let alteredSizeKey = {};\r\n            if (series.type === 'bubble') {\r\n                alteredSizeKey = { sizeKey: filteredOutKey(series.sizeKey!) };\r\n            }\r\n\r\n            return {\r\n                ...series,\r\n                ...alteredSizeKey,\r\n                yKey: filteredOutKey(yKey!),\r\n                xKey: filteredOutKey(xKey!),\r\n                fillOpacity: 0.3,\r\n                strokeOpacity: 0.3,\r\n                showInLegend: false,\r\n                listeners: {\r\n                    ...series.listeners,\r\n                    nodeClick: (e: any) => {\r\n                        const value = e.datum[filteredOutKey(xKey!)];\r\n\r\n                        // Need to remove the `-filtered-out` suffixes from the event so that\r\n                        // upstream processing maps the event correctly onto grid column ids.\r\n                        const filterableEvent = {\r\n                            ...e,\r\n                            xKey,\r\n                            datum: { ...e.datum, [xKey!]: value },\r\n                        };\r\n                        this.crossFilterCallback(filterableEvent);\r\n                    },\r\n                },\r\n            };\r\n        };\r\n\r\n        const updatedSeries = series.map(updatePrimarySeries);\r\n        return [...updatedSeries, ...updatedSeries.map(updateFilteredOutSeries)];\r\n    }\r\n\r\n    private getSeriesDefinitions(fields: FieldDefinition[], paired: boolean): (SeriesDefinition | null)[] {\r\n        if (fields.length < 2) {\r\n            return [];\r\n        }\r\n\r\n        const isBubbleChart = this.chartType === 'bubble';\r\n\r\n        if (paired) {\r\n            if (isBubbleChart) {\r\n                return fields\r\n                    .map((currentXField, i) =>\r\n                        i % 3 === 0\r\n                            ? {\r\n                                  xField: currentXField,\r\n                                  yField: fields[i + 1],\r\n                                  sizeField: fields[i + 2],\r\n                              }\r\n                            : null\r\n                    )\r\n                    .filter((x) => x && x.yField && x.sizeField);\r\n            }\r\n            return fields\r\n                .map((currentXField, i) =>\r\n                    i % 2 === 0\r\n                        ? {\r\n                              xField: currentXField,\r\n                              yField: fields[i + 1],\r\n                          }\r\n                        : null\r\n                )\r\n                .filter((x) => x && x.yField);\r\n        }\r\n\r\n        const xField = fields[0];\r\n\r\n        if (isBubbleChart) {\r\n            return fields\r\n                .map((yField, i) =>\r\n                    i % 2 === 1\r\n                        ? {\r\n                              xField,\r\n                              yField,\r\n                              sizeField: fields[i + 1],\r\n                          }\r\n                        : null\r\n                )\r\n                .filter((x) => x && x.sizeField);\r\n        }\r\n\r\n        return fields.filter((value, i) => i > 0).map((yField) => ({ xField, yField }));\r\n    }\r\n}\r\n", "import type { AgCartesianAxisOptions } from 'ag-charts-types';\r\n\r\nimport type { ChartType, SeriesChartType } from 'ag-grid-community';\r\n\r\nimport { getSeriesType } from '../../utils/seriesTypeMapper';\r\nimport { CartesianChartProxy } from '../cartesian/cartesianChartProxy';\r\nimport type { ChartProxyParams, FieldDefinition, UpdateParams } from '../chartProxy';\r\n\r\nexport class ComboChartProxy extends CartesianChartProxy<'line' | 'bar' | 'area'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    public getAxes(params: UpdateParams): AgCartesianAxisOptions[] {\r\n        const fields = params ? params.fields : [];\r\n        const fieldsMap = new Map(fields.map((f) => [f.colId, f]));\r\n\r\n        const { primaryYKeys, secondaryYKeys } = this.getYKeys(fields, params.seriesChartTypes);\r\n\r\n        const axes: AgCartesianAxisOptions[] = [\r\n            {\r\n                type: this.getXAxisType(params),\r\n                position: 'bottom',\r\n            },\r\n        ];\r\n\r\n        if (primaryYKeys.length > 0) {\r\n            axes.push({\r\n                type: 'number',\r\n                keys: primaryYKeys,\r\n                position: 'left',\r\n            });\r\n        }\r\n\r\n        if (secondaryYKeys.length > 0) {\r\n            secondaryYKeys.forEach((secondaryYKey: string) => {\r\n                const field = fieldsMap.get(secondaryYKey);\r\n                const secondaryAxisIsVisible = field && field.colId === secondaryYKey;\r\n                if (!secondaryAxisIsVisible) {\r\n                    return;\r\n                }\r\n\r\n                const secondaryAxisOptions: AgCartesianAxisOptions = {\r\n                    type: 'number',\r\n                    keys: [secondaryYKey],\r\n                    position: 'right',\r\n                };\r\n\r\n                axes.push(secondaryAxisOptions);\r\n            });\r\n        }\r\n\r\n        return axes;\r\n    }\r\n\r\n    public getSeries(params: UpdateParams): any {\r\n        const { fields, seriesChartTypes } = params;\r\n        const [category] = params.categories;\r\n\r\n        return fields.map((field) => {\r\n            const seriesChartType = seriesChartTypes.find((s) => s.colId === field.colId);\r\n            if (seriesChartType) {\r\n                const chartType: ChartType = seriesChartType.chartType;\r\n                const grouped = ['groupedColumn', 'groupedBar'].includes(chartType);\r\n                const groupedOpts = grouped ? { grouped: true } : {};\r\n                return {\r\n                    type: getSeriesType(chartType),\r\n                    xKey: category.id,\r\n                    yKey: field.colId,\r\n                    yName: field.displayName,\r\n                    stacked: ['stackedArea', 'stackedColumn'].includes(chartType),\r\n                    ...groupedOpts,\r\n                };\r\n            }\r\n        });\r\n    }\r\n\r\n    private getYKeys(fields: FieldDefinition[], seriesChartTypes: SeriesChartType[]) {\r\n        const primaryYKeys: string[] = [];\r\n        const secondaryYKeys: string[] = [];\r\n\r\n        fields.forEach((field) => {\r\n            const colId = field.colId;\r\n            const seriesChartType = seriesChartTypes.find((s) => s.colId === colId);\r\n            if (seriesChartType) {\r\n                seriesChartType.secondaryAxis ? secondaryYKeys.push(colId) : primaryYKeys.push(colId);\r\n            }\r\n        });\r\n\r\n        return { primaryYKeys, secondaryYKeys };\r\n    }\r\n}\r\n", "import type {\r\n    AgDonutSeriesOptions,\r\n    AgPieSeriesOptions,\r\n    AgPolarChartOptions,\r\n    AgPolarSeriesOptions,\r\n} from 'ag-charts-types';\r\n\r\nimport type { ChartProxyParams, FieldDefinition, UpdateParams } from '../chartProxy';\r\nimport { ChartProxy } from '../chartProxy';\r\n\r\ninterface DonutOffset {\r\n    offsetAmount: number;\r\n    currentOffset: number;\r\n}\r\n\r\nfunction calculateOffsets(offset: DonutOffset) {\r\n    const outerRadiusOffset = offset.currentOffset;\r\n    offset.currentOffset -= offset.offsetAmount;\r\n\r\n    const innerRadiusOffset = offset.currentOffset;\r\n    offset.currentOffset -= offset.offsetAmount;\r\n\r\n    return { outerRadiusOffset, innerRadiusOffset };\r\n}\r\n\r\nexport class PieChartProxy extends ChartProxy<AgPolarChartOptions, 'pie' | 'donut'> {\r\n    public constructor(params: ChartProxyParams) {\r\n        super(params);\r\n    }\r\n\r\n    protected getUpdateOptions(params: UpdateParams, commonChartOptions: AgPolarChartOptions): AgPolarChartOptions {\r\n        return {\r\n            ...commonChartOptions,\r\n            data: this.crossFiltering ? this.getCrossFilterData(params) : params.data,\r\n            series: this.getSeries(params),\r\n        };\r\n    }\r\n\r\n    private getSeries(params: UpdateParams): AgPolarSeriesOptions[] {\r\n        const [category] = params.categories;\r\n        const numFields = params.fields.length;\r\n\r\n        const offset = {\r\n            currentOffset: 0,\r\n            offsetAmount: numFields > 1 ? 20 : 40,\r\n        };\r\n\r\n        const series: (AgPieSeriesOptions | AgDonutSeriesOptions)[] = this.getFields(params).map(\r\n            (f: FieldDefinition) => {\r\n                // options shared by 'pie' and 'donut' charts\r\n                const options = {\r\n                    type: this.standaloneChartType as AgPieSeriesOptions['type'],\r\n                    angleKey: f.colId,\r\n                    angleName: f.displayName!,\r\n                    sectorLabelKey: f.colId,\r\n                    calloutLabelName: category.name,\r\n                    calloutLabelKey: category.id,\r\n                };\r\n\r\n                if (this.chartType === 'donut' || this.chartType === 'doughnut') {\r\n                    const { outerRadiusOffset, innerRadiusOffset } = calculateOffsets(offset);\r\n                    const title = f.displayName\r\n                        ? {\r\n                              title: { text: f.displayName, showInLegend: numFields > 1 },\r\n                          }\r\n                        : undefined;\r\n\r\n                    // augment shared options with 'donut' specific options\r\n                    return {\r\n                        ...options,\r\n                        type: 'donut',\r\n                        outerRadiusOffset,\r\n                        innerRadiusOffset,\r\n                        ...title,\r\n                        calloutLine: {\r\n                            colors: this.getChartPalette()?.strokes,\r\n                        },\r\n                    };\r\n                }\r\n\r\n                return options;\r\n            }\r\n        );\r\n\r\n        return this.crossFiltering ? this.extractCrossFilterSeries(series) : series;\r\n    }\r\n\r\n    private getCrossFilterData(params: UpdateParams) {\r\n        const colId = params.fields[0].colId;\r\n        const filteredOutColId = `${colId}-filtered-out`;\r\n\r\n        return params.data.map((d) => {\r\n            const total = d[colId] + d[filteredOutColId];\r\n            d[`${colId}-total`] = total;\r\n            d[filteredOutColId] = 1; // normalise to 1\r\n            d[colId] = d[colId] / total; // fraction of 1\r\n            return d;\r\n        });\r\n    }\r\n\r\n    private extractCrossFilterSeries(series: (AgPieSeriesOptions | AgDonutSeriesOptions)[]) {\r\n        const palette = this.getChartPalette();\r\n\r\n        const primaryOptions = (seriesOptions: AgPieSeriesOptions | AgDonutSeriesOptions) => {\r\n            return {\r\n                ...seriesOptions,\r\n                legendItemKey: seriesOptions.calloutLabelKey,\r\n                calloutLabel: { enabled: false }, // hide labels on primary series\r\n                highlightStyle: { item: { fill: undefined } },\r\n                radiusKey: seriesOptions.angleKey,\r\n                angleKey: seriesOptions.angleKey + '-total',\r\n                radiusMin: 0,\r\n                radiusMax: 1,\r\n                listeners: {\r\n                    nodeClick: this.crossFilterCallback,\r\n                },\r\n            };\r\n        };\r\n\r\n        const filteredOutOptions = (seriesOptions: AgPieSeriesOptions | AgDonutSeriesOptions, angleKey: string) => {\r\n            return {\r\n                ...primaryOpts,\r\n                radiusKey: angleKey + '-filtered-out',\r\n                fills: this.changeOpacity(seriesOptions.fills ?? palette?.fills ?? [], 0.3),\r\n                strokes: this.changeOpacity(seriesOptions.strokes ?? palette?.strokes ?? [], 0.3),\r\n                showInLegend: false,\r\n            };\r\n        };\r\n\r\n        // currently, only single 'donut' cross-filter series are supported\r\n        const primarySeries = series[0];\r\n\r\n        // update primary series\r\n        const angleKey = primarySeries.angleKey!;\r\n        const primaryOpts = primaryOptions(primarySeries);\r\n\r\n        return [filteredOutOptions(primaryOptions(primarySeries), angleKey), primaryOpts];\r\n    }\r\n\r\n    private getFields(params: UpdateParams): FieldDefinition[] {\r\n        // pie charts only support a single series, donut charts support multiple series\r\n        return this.chartType === 'pie' ? params.fields.slice(0, 1) : params.fields;\r\n    }\r\n\r\n    private changeOpacity(fills: string[], alpha: number) {\r\n        const Color = this.agChartsExports._Util.Color;\r\n        return fills.map((fill) => {\r\n            const c = Color.fromString(fill);\r\n            return new Color(c.r, c.g, c.b, alpha).toHexString();\r\n        });\r\n    }\r\n}\r\n", "import type {\r\n    BeanCollection,\r\n    ChartToolPanelMenuOptions,\r\n    ChartToolbarMenuItemOptions,\r\n    Environment,\r\n    IconName,\r\n} from 'ag-grid-community';\r\nimport { AgPromise, Component, _warn } from 'ag-grid-community';\r\n\r\nimport { AgPanel } from '../../../widgets/agPanel';\r\nimport type { ChartController } from '../chartController';\r\nimport type { ExtraPaddingDirection } from '../chartProxies/chartProxy';\r\nimport type { ChartMenuService } from '../services/chartMenuService';\r\nimport type { ChartMenuContext } from './chartMenuContext';\r\nimport type { ChartMenuListFactory } from './chartMenuList';\r\nimport { ChartToolbar } from './chartToolbar';\r\nimport { TabbedChartMenu } from './tabbedChartMenu';\r\n\r\ntype ChartToolbarButtons = {\r\n    [key in ChartToolbarMenuItemOptions]: {\r\n        iconName: IconName;\r\n        callback: (eventSource: HTMLElement) => void;\r\n    };\r\n};\r\n\r\nexport class ChartMenu extends Component {\r\n    private chartMenuSvc: ChartMenuService;\r\n    private chartMenuListFactory: ChartMenuListFactory;\r\n    private environment: Environment;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.chartMenuSvc = beans.chartMenuSvc as ChartMenuService;\r\n        this.chartMenuListFactory = beans.chartMenuListFactory as ChartMenuListFactory;\r\n        this.environment = beans.environment;\r\n    }\r\n\r\n    private readonly chartController: ChartController;\r\n\r\n    private buttons: ChartToolbarButtons = {\r\n        chartLink: { iconName: 'linked', callback: () => this.chartMenuSvc.toggleLinked(this.chartMenuContext) },\r\n        chartUnlink: {\r\n            iconName: 'unlinked',\r\n            callback: () => this.chartMenuSvc.toggleLinked(this.chartMenuContext),\r\n        },\r\n        chartDownload: {\r\n            iconName: 'chartsDownload',\r\n            callback: () => this.chartMenuSvc.downloadChart(this.chartMenuContext),\r\n        },\r\n        chartMenu: { iconName: 'chartsMenu', callback: (eventSource: HTMLElement) => this.showMenuList(eventSource) },\r\n    };\r\n\r\n    private panels: ChartToolPanelMenuOptions[] = [];\r\n    private defaultPanel: ChartToolPanelMenuOptions;\r\n\r\n    private chartToolbar: ChartToolbar;\r\n    private tabbedMenu: TabbedChartMenu;\r\n    private menuPanel?: AgPanel;\r\n    private menuVisible = false;\r\n    private chartToolbarOptions: ChartToolbarMenuItemOptions[];\r\n\r\n    constructor(\r\n        private readonly eChartContainer: HTMLElement,\r\n        private readonly eMenuPanelContainer: HTMLElement,\r\n        private readonly chartMenuContext: ChartMenuContext\r\n    ) {\r\n        super(/* html */ `<div class=\"ag-chart-menu-wrapper\"></div>`);\r\n        this.chartController = chartMenuContext.chartController;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.chartToolbar = this.createManagedBean(new ChartToolbar());\r\n        this.getGui().appendChild(this.chartToolbar.getGui());\r\n\r\n        this.refreshToolbarAndPanels();\r\n\r\n        this.addManagedEventListeners({\r\n            chartCreated: (e) => {\r\n                if (e.chartId === this.chartController.getChartId()) {\r\n                    const showDefaultToolPanel = Boolean(this.gos.get('chartToolPanelsDef')?.defaultToolPanel);\r\n                    if (showDefaultToolPanel) {\r\n                        this.showMenu({ panel: this.defaultPanel, suppressFocus: true });\r\n                    }\r\n                }\r\n            },\r\n        });\r\n        this.addManagedListeners(this.chartController, {\r\n            chartLinkedChanged: this.refreshToolbarAndPanels.bind(this),\r\n        });\r\n\r\n        this.refreshMenuClasses();\r\n\r\n        this.addManagedListeners(this.chartController, { chartApiUpdate: this.refreshToolbarAndPanels.bind(this) });\r\n    }\r\n\r\n    public isVisible(): boolean {\r\n        return this.menuVisible;\r\n    }\r\n\r\n    public getExtraPaddingDirections(): ExtraPaddingDirection[] {\r\n        return (['chartMenu', 'chartLink', 'chartUnlink', 'chartDownload'] as const).some((v) =>\r\n            this.chartToolbarOptions.includes(v)\r\n        )\r\n            ? ['top']\r\n            : [];\r\n    }\r\n\r\n    private refreshToolbarAndPanels(): void {\r\n        this.initToolbarOptionsAndPanels();\r\n        this.updateToolbar();\r\n    }\r\n\r\n    private initToolbarOptionsAndPanels(): void {\r\n        const { panels, defaultPanel } = this.chartMenuSvc.getChartToolPanels(this.chartController);\r\n        this.panels = panels;\r\n        this.defaultPanel = defaultPanel;\r\n        this.chartToolbarOptions = this.chartMenuSvc.getChartToolbarOptions();\r\n    }\r\n\r\n    private updateToolbar(): void {\r\n        const buttons = this.chartToolbarOptions.map((buttonName) => {\r\n            const { iconName, callback } = this.buttons[buttonName];\r\n            return {\r\n                buttonName,\r\n                iconName,\r\n                callback,\r\n            };\r\n        });\r\n        this.chartToolbar.updateParams({ buttons });\r\n    }\r\n\r\n    private createMenuPanel(defaultTab: number): AgPromise<AgPanel> {\r\n        const menuPanel = (this.menuPanel = this.createBean(\r\n            new AgPanel({\r\n                height: '100%',\r\n                closable: true,\r\n                hideTitleBar: true,\r\n                cssIdentifier: 'chart-menu',\r\n            })\r\n        ));\r\n\r\n        menuPanel.setParentComponent(this);\r\n        this.eMenuPanelContainer.appendChild(menuPanel.getGui());\r\n\r\n        this.tabbedMenu = this.createBean(new TabbedChartMenu(this.panels, this.chartMenuContext));\r\n\r\n        this.addManagedListeners(this.tabbedMenu, {\r\n            closed: () => {\r\n                this.hideMenu();\r\n            },\r\n        });\r\n\r\n        this.addManagedListeners(menuPanel, { destroyed: () => this.destroyBean(this.tabbedMenu) });\r\n\r\n        return new AgPromise((res: (arg0: any) => void) => {\r\n            window.setTimeout(() => {\r\n                menuPanel.setBodyComponent(this.tabbedMenu);\r\n                this.tabbedMenu.showTab(defaultTab);\r\n                res(menuPanel);\r\n            }, 100);\r\n        });\r\n    }\r\n\r\n    private showContainer(eventSource?: HTMLElement, suppressFocus?: boolean) {\r\n        if (!this.menuPanel) {\r\n            return;\r\n        }\r\n\r\n        this.menuVisible = true;\r\n        this.refreshMenuClasses();\r\n        this.tabbedMenu.showMenu(eventSource, suppressFocus);\r\n    }\r\n\r\n    public showMenu(params?: {\r\n        /**\r\n         * Menu panel to show. If empty, shows the existing menu, or creates the default menu if menu panel has not been created\r\n         */\r\n        panel?: ChartToolPanelMenuOptions;\r\n        eventSource?: HTMLElement;\r\n        suppressFocus?: boolean;\r\n    }): void {\r\n        const { panel, eventSource, suppressFocus } = params ?? {};\r\n\r\n        if (this.menuPanel && !panel) {\r\n            this.showContainer(eventSource, suppressFocus);\r\n        } else {\r\n            const menuPanel = panel || this.defaultPanel;\r\n            let tab = this.panels.indexOf(menuPanel);\r\n            if (tab < 0) {\r\n                _warn(143, { panel });\r\n                tab = this.panels.indexOf(this.defaultPanel);\r\n            }\r\n\r\n            if (this.menuPanel) {\r\n                this.tabbedMenu.showTab(tab);\r\n                this.showContainer(eventSource, suppressFocus);\r\n            } else {\r\n                this.createMenuPanel(tab).then(() => this.showContainer(eventSource, suppressFocus));\r\n            }\r\n        }\r\n    }\r\n\r\n    public hideMenu(): void {\r\n        this.menuVisible = false;\r\n        this.refreshMenuClasses();\r\n    }\r\n\r\n    private refreshMenuClasses() {\r\n        this.eChartContainer.classList.toggle('ag-chart-menu-visible', this.menuVisible);\r\n        this.eChartContainer.classList.toggle('ag-chart-menu-hidden', !this.menuVisible);\r\n    }\r\n\r\n    private showMenuList(eventSource: HTMLElement): void {\r\n        this.chartMenuListFactory.showMenuList({\r\n            eventSource,\r\n            showMenu: () => this.showMenu({ eventSource }),\r\n            chartMenuContext: this.chartMenuContext,\r\n        });\r\n    }\r\n\r\n    public override destroy() {\r\n        super.destroy();\r\n\r\n        if (this.menuPanel && this.menuPanel.isAlive()) {\r\n            this.destroyBean(this.menuPanel);\r\n        }\r\n\r\n        if (this.tabbedMenu && this.tabbedMenu.isAlive()) {\r\n            this.destroyBean(this.tabbedMenu);\r\n        }\r\n    }\r\n}\r\n", "import type { BeanCollection, ChartToolbarMenuItemOptions, IconName } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder, _clearElement, _createIconNoSpan, _getDocument } from 'ag-grid-community';\r\n\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../services/chartTranslationService';\r\n\r\ninterface ChartToolbarButton {\r\n    buttonName: ChartToolbarMenuItemOptions;\r\n    iconName: IconName;\r\n    callback: (eventSource: HTMLElement) => void;\r\n}\r\n\r\nexport class ChartToolbar extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    private readonly eMenu: HTMLButtonElement = RefPlaceholder;\r\n\r\n    private buttonListenersDestroyFuncs: ((() => null) | undefined)[] = [];\r\n\r\n    constructor() {\r\n        super(/* html */ `<div class=\"ag-chart-menu\" data-ref=\"eMenu\"></div>`);\r\n    }\r\n\r\n    public updateParams(params: { buttons: ChartToolbarButton[] }): void {\r\n        const { buttons } = params;\r\n        this.createButtons(buttons);\r\n    }\r\n\r\n    private createButtons(buttons: ChartToolbarButton[]): void {\r\n        this.buttonListenersDestroyFuncs.forEach((func) => func?.());\r\n        this.buttonListenersDestroyFuncs = [];\r\n\r\n        const menuEl = this.eMenu;\r\n        _clearElement(menuEl);\r\n\r\n        buttons.forEach((buttonConfig) => {\r\n            const { buttonName, iconName, callback } = buttonConfig;\r\n            const buttonEl = this.createButton(iconName);\r\n\r\n            const tooltipTitle = this.chartTranslation.translate(\r\n                (buttonName + 'ToolbarTooltip') as ChartTranslationKey\r\n            );\r\n            if (tooltipTitle && buttonEl instanceof HTMLElement) {\r\n                buttonEl.title = tooltipTitle;\r\n            }\r\n\r\n            this.buttonListenersDestroyFuncs.push(\r\n                ...this.addManagedElementListeners(buttonEl, {\r\n                    click: (event: MouseEvent) => callback(event.currentTarget as HTMLElement),\r\n                })\r\n            );\r\n\r\n            menuEl.appendChild(buttonEl);\r\n        });\r\n    }\r\n\r\n    private createButton(iconName: IconName): Element {\r\n        const buttonEl = _createIconNoSpan(iconName, this.beans)!;\r\n        buttonEl.classList.add('ag-chart-menu-icon');\r\n\r\n        const wrapperEl = _getDocument(this.beans).createElement('button');\r\n        wrapperEl.appendChild(buttonEl);\r\n        wrapperEl.classList.add('ag-chart-menu-toolbar-button');\r\n        return wrapperEl;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.buttonListenersDestroyFuncs = [];\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { BeanCollection, ChartToolPanelMenuOptions } from 'ag-grid-community';\r\nimport { AgPromise, Component } from 'ag-grid-community';\r\n\r\nimport type { TabbedItem } from '../../../widgets/iTabbedLayout';\r\nimport { TabbedLayout } from '../../../widgets/tabbedLayout';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../services/chartTranslationService';\r\nimport type { ChartMenuContext } from './chartMenuContext';\r\nimport { ChartDataPanel } from './data/chartDataPanel';\r\nimport { FormatPanel } from './format/formatPanel';\r\nimport { ChartSettingsPanel } from './settings/chartSettingsPanel';\r\n\r\nconst TAB_DATA = 'data';\r\nconst TAB_FORMAT = 'format';\r\n\r\nexport type TabbedChartMenuEvent = 'closed';\r\nexport class TabbedChartMenu extends Component<TabbedChartMenuEvent> {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    private tabbedLayout: TabbedLayout;\r\n    private tabs: TabbedItem[] = [];\r\n    private eventSource?: HTMLElement;\r\n\r\n    constructor(\r\n        private readonly panels: ChartToolPanelMenuOptions[],\r\n        private readonly chartMenuContext: ChartMenuContext\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.panels.forEach((panel) => {\r\n            const panelType = panel.replace('chart', '').toLowerCase() as 'settings' | 'data' | 'format';\r\n            const panelComp = this.createPanel(panelType);\r\n            const tabItem = this.createTab(panel, panelType, panelComp);\r\n\r\n            this.tabs.push(tabItem);\r\n            this.addDestroyFunc(() => this.destroyBean(panelComp));\r\n        });\r\n\r\n        this.tabbedLayout = new TabbedLayout({\r\n            items: this.tabs,\r\n            cssClass: 'ag-chart-tabbed-menu',\r\n            keepScrollPosition: true,\r\n            suppressFocusBodyOnOpen: true,\r\n            suppressTrapFocus: true,\r\n            enableCloseButton: true,\r\n            closeButtonAriaLabel: this.chartTranslation.translate('ariaChartMenuClose'),\r\n            onCloseClicked: () => {\r\n                this.eventSource?.focus({ preventScroll: true });\r\n                this.dispatchLocalEvent({ type: 'closed' });\r\n            },\r\n        });\r\n        this.createBean(this.tabbedLayout);\r\n    }\r\n\r\n    private createTab(name: ChartToolPanelMenuOptions, title: ChartTranslationKey, panelComp: Component): TabbedItem {\r\n        const eWrapperDiv = document.createElement('div');\r\n        eWrapperDiv.classList.add('ag-chart-tab', `ag-chart-${title}`);\r\n\r\n        this.createBean(panelComp);\r\n\r\n        eWrapperDiv.appendChild(panelComp.getGui());\r\n\r\n        const titleEl = document.createElement('div');\r\n        const translatedTitle = this.chartTranslation.translate(title);\r\n        titleEl.innerText = translatedTitle;\r\n\r\n        return {\r\n            title: titleEl,\r\n            titleLabel: translatedTitle,\r\n            bodyPromise: AgPromise.resolve(eWrapperDiv),\r\n            getScrollableContainer: () => {\r\n                const scrollableContainer = eWrapperDiv.querySelector('.ag-scrollable-container');\r\n                return (scrollableContainer || eWrapperDiv) as HTMLElement;\r\n            },\r\n            name,\r\n        };\r\n    }\r\n\r\n    public showTab(tab: number) {\r\n        const tabItem = this.tabs[tab];\r\n        this.tabbedLayout.showItem(tabItem);\r\n    }\r\n\r\n    public override getGui(): HTMLElement {\r\n        return this.tabbedLayout && this.tabbedLayout.getGui();\r\n    }\r\n\r\n    public showMenu(eventSource?: HTMLElement, suppressFocus?: boolean): void {\r\n        this.eventSource = eventSource;\r\n        if (!suppressFocus) {\r\n            this.tabbedLayout?.focusHeader(true);\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        if (this.parentComponent && this.parentComponent.isAlive()) {\r\n            this.destroyBean(this.parentComponent);\r\n        }\r\n        super.destroy();\r\n    }\r\n\r\n    private createPanel(panelType: string): Component {\r\n        switch (panelType) {\r\n            case TAB_DATA:\r\n                return new ChartDataPanel(this.chartMenuContext);\r\n            case TAB_FORMAT:\r\n                return new FormatPanel(this.chartMenuContext);\r\n            default:\r\n                return new ChartSettingsPanel(this.chartMenuContext.chartController);\r\n        }\r\n    }\r\n}\r\n", "import type { BeanCollection, ChartDataPanel as ChartDataPanelType, ChartType, IChartService } from 'ag-grid-community';\r\nimport { AgToggleButton, Component, _getDocument, _setDisplayed, _warn } from 'ag-grid-community';\r\n\r\nimport type { ChartController } from '../../chartController';\r\nimport type { ColState } from '../../model/chartDataModel';\r\nimport type { ChartTranslationService } from '../../services/chartTranslationService';\r\nimport { getMaxNumCategories, getMaxNumSeries, supportsInvertedCategorySeries } from '../../utils/seriesTypeMapper';\r\nimport type { ChartMenuContext } from '../chartMenuContext';\r\nimport { CategoriesDataPanel } from './categoriesDataPanel';\r\nimport { ChartSpecificDataPanel } from './chartSpecificDataPanel';\r\nimport { SeriesChartTypePanel } from './seriesChartTypePanel';\r\nimport { SeriesDataPanel } from './seriesDataPanel';\r\n\r\nconst DefaultDataPanelDef: ChartDataPanelType = {\r\n    groups: [\r\n        { type: 'categories', isOpen: true },\r\n        { type: 'series', isOpen: true },\r\n        { type: 'seriesChartType', isOpen: true },\r\n        { type: 'chartSpecific', isOpen: true },\r\n    ],\r\n};\r\n\r\nexport class ChartDataPanel extends Component {\r\n    protected chartTranslation: ChartTranslationService;\r\n    private chartSvc: IChartService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n        this.chartSvc = beans.chartSvc!;\r\n    }\r\n\r\n    private readonly chartController: ChartController;\r\n    private chartType?: ChartType;\r\n    private isSwitchCategorySeriesToggled = false;\r\n    private categoriesDataPanel?: CategoriesDataPanel;\r\n    private seriesDataPanel?: SeriesDataPanel;\r\n    private seriesChartTypePanel?: SeriesChartTypePanel;\r\n    private chartSpecificPanel?: ChartSpecificDataPanel;\r\n    private switchCategorySeriesToggle: AgToggleButton;\r\n    private restoreSwitchCategorySeriesToggleFocus = false;\r\n    private panels: Component[] = [];\r\n\r\n    constructor(private readonly chartMenuContext: ChartMenuContext) {\r\n        super(/* html */ `<div class=\"ag-chart-data-wrapper ag-scrollable-container\"></div>`);\r\n\r\n        this.chartController = chartMenuContext.chartController;\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.createSwitchCategorySeriesToggle();\r\n        this.isSwitchCategorySeriesToggled = this.chartController.isCategorySeriesSwitched();\r\n\r\n        this.updatePanels();\r\n        const listener = this.updatePanels.bind(this);\r\n        this.addManagedListeners(this.chartController, {\r\n            chartModelUpdate: listener,\r\n            chartApiUpdate: listener,\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.clearPanelComponents();\r\n        super.destroy();\r\n    }\r\n\r\n    private updatePanels() {\r\n        const currentChartType = this.chartType;\r\n        const isSwitchCategorySeriesToggledCurrent = this.isSwitchCategorySeriesToggled;\r\n        const { dimensionCols, valueCols } = this.chartController.getColStateForMenu();\r\n\r\n        this.chartType = this.chartController.getChartType();\r\n\r\n        // Determine the state of the category/series toggle\r\n        this.isSwitchCategorySeriesToggled = this.chartController.isCategorySeriesSwitched();\r\n        const hasChangedSwitchCategorySeries =\r\n            this.isSwitchCategorySeriesToggled !== isSwitchCategorySeriesToggledCurrent;\r\n\r\n        // Attempt to re-use existing panels where possible in order to maintain keyboard focus\r\n        if (this.canRefresh(currentChartType, this.chartType) && !hasChangedSwitchCategorySeries) {\r\n            this.categoriesDataPanel?.refresh(dimensionCols);\r\n            this.seriesDataPanel?.refresh(valueCols);\r\n            this.seriesChartTypePanel?.refresh(valueCols);\r\n            this.chartSpecificPanel?.refresh();\r\n        } else {\r\n            this.recreatePanels(dimensionCols, valueCols);\r\n        }\r\n\r\n        // Ensure the category/series toggle UI control is up-to-date\r\n        const isSwitchCategorySeriesDisplayed =\r\n            supportsInvertedCategorySeries(this.chartType) &&\r\n            this.chartSvc.isEnterprise() &&\r\n            !this.chartController.isGrouping();\r\n        _setDisplayed(this.switchCategorySeriesToggle.getGui(), isSwitchCategorySeriesDisplayed);\r\n        if (hasChangedSwitchCategorySeries) {\r\n            this.switchCategorySeriesToggle?.setValue(this.chartController.isCategorySeriesSwitched());\r\n        }\r\n        if (this.restoreSwitchCategorySeriesToggleFocus) {\r\n            this.restoreSwitchCategorySeriesToggleFocus = false;\r\n            if (isSwitchCategorySeriesDisplayed) {\r\n                this.switchCategorySeriesToggle.getFocusableElement().focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    private canRefresh(oldChartType: ChartType | undefined, newChartType: ChartType): boolean {\r\n        if (oldChartType === undefined) return false;\r\n        if (oldChartType === newChartType) {\r\n            return true;\r\n        }\r\n        const isCombo = (chartType: ChartType) =>\r\n            ['columnLineCombo', 'areaColumnCombo', 'customCombo'].includes(chartType);\r\n        if (isCombo(oldChartType) && isCombo(newChartType)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private recreatePanels(dimensionCols: ColState[], valueCols: ColState[]): void {\r\n        this.clearPanelComponents();\r\n\r\n        const { chartType } = this;\r\n        if (!chartType) return;\r\n\r\n        const isCategorySeriesSwitched = this.chartController.isCategorySeriesSwitched();\r\n\r\n        this.getDataPanelDef().groups?.forEach(({ type, isOpen }) => {\r\n            if (type === (isCategorySeriesSwitched ? 'series' : 'categories')) {\r\n                this.categoriesDataPanel = this.createBean(\r\n                    new CategoriesDataPanel(\r\n                        this.chartController,\r\n                        this.getCategoryGroupTitle(isCategorySeriesSwitched),\r\n                        this.getCategoryGroupMultipleSelect(chartType, isCategorySeriesSwitched),\r\n                        dimensionCols,\r\n                        isOpen\r\n                    )\r\n                );\r\n                this.panels.push(this.categoriesDataPanel);\r\n            } else if (type === (isCategorySeriesSwitched ? 'categories' : 'series')) {\r\n                this.seriesDataPanel = this.createBean(\r\n                    new SeriesDataPanel(\r\n                        this.chartController,\r\n                        this.chartMenuContext.chartOptionsService,\r\n                        this.getSeriesGroupTitle(isCategorySeriesSwitched),\r\n                        this.getSeriesGroupMultipleSelect(chartType, isCategorySeriesSwitched),\r\n                        this.getSeriesGroupMaxSelection(chartType, isCategorySeriesSwitched),\r\n                        valueCols,\r\n                        isOpen\r\n                    )\r\n                );\r\n                this.panels.push(this.seriesDataPanel);\r\n            } else if (type === 'seriesChartType') {\r\n                if (this.chartController.isComboChart()) {\r\n                    this.seriesChartTypePanel = this.createBean(\r\n                        new SeriesChartTypePanel(this.chartController, valueCols, isOpen)\r\n                    );\r\n                    this.panels.push(this.seriesChartTypePanel);\r\n                }\r\n            } else if (type === 'chartSpecific') {\r\n                this.chartSpecificPanel = this.createBean(new ChartSpecificDataPanel(this.chartMenuContext, isOpen));\r\n                this.panels.push(this.chartSpecificPanel);\r\n            } else {\r\n                _warn(144, { type });\r\n            }\r\n        });\r\n\r\n        (isCategorySeriesSwitched ? this.categoriesDataPanel : this.seriesDataPanel)?.addItem(\r\n            this.switchCategorySeriesToggle.getGui()\r\n        );\r\n\r\n        this.addPanelComponents();\r\n    }\r\n\r\n    private addPanelComponents(): void {\r\n        if (!this.panels.length) {\r\n            return;\r\n        }\r\n        const eDocument = _getDocument(this.beans);\r\n        const fragment = eDocument.createDocumentFragment();\r\n        for (const panel of this.panels) {\r\n            panel.addCssClass('ag-chart-data-section');\r\n            fragment.appendChild(panel.getGui());\r\n        }\r\n        this.getGui().appendChild(fragment);\r\n    }\r\n\r\n    private clearPanelComponents() {\r\n        const eGui = this.getGui();\r\n\r\n        this.panels.forEach((panel) => {\r\n            eGui.removeChild(panel.getGui());\r\n            this.destroyBean(panel);\r\n        });\r\n        this.panels = [];\r\n    }\r\n\r\n    private getDataPanelDef() {\r\n        return this.gos.get('chartToolPanelsDef')?.dataPanel ?? DefaultDataPanelDef;\r\n    }\r\n\r\n    private getCategoryGroupTitle(isCategorySeriesSwitched: boolean): string {\r\n        if (isCategorySeriesSwitched) return this.chartTranslation.translate('seriesLabels');\r\n        return this.chartTranslation.translate(this.chartController.isActiveXYChart() ? 'labels' : 'categories');\r\n    }\r\n\r\n    private getCategoryGroupMultipleSelect(chartType: ChartType, isCategorySeriesSwitched: boolean): boolean {\r\n        if (isCategorySeriesSwitched) return false;\r\n        return getMaxNumCategories(chartType) !== 1;\r\n    }\r\n\r\n    private getSeriesGroupTitle(isCategorySeriesSwitched: boolean): string {\r\n        if (isCategorySeriesSwitched) return this.chartTranslation.translate('categoryValues');\r\n        return this.chartTranslation.translate(this.chartController.isActiveXYChart() ? 'xyValues' : 'series');\r\n    }\r\n\r\n    private getSeriesGroupMultipleSelect(chartType: ChartType, isCategorySeriesSwitched: boolean): boolean {\r\n        return this.getSeriesGroupMaxSelection(chartType, isCategorySeriesSwitched) !== 1;\r\n    }\r\n\r\n    private getSeriesGroupMaxSelection(chartType: ChartType, isCategorySeriesSwitched: boolean): number | undefined {\r\n        if (isCategorySeriesSwitched) return undefined;\r\n        return getMaxNumSeries(chartType);\r\n    }\r\n\r\n    private createSwitchCategorySeriesToggle(): void {\r\n        this.switchCategorySeriesToggle = this.createManagedBean(\r\n            new AgToggleButton({\r\n                label: this.chartTranslation.translate('switchCategorySeries'),\r\n                labelAlignment: 'left',\r\n                labelWidth: 'flex',\r\n                inputWidth: 'flex',\r\n                value: this.chartController.isCategorySeriesSwitched(),\r\n                onValueChange: (value) => {\r\n                    this.restoreSwitchCategorySeriesToggleFocus = true;\r\n                    this.chartController.switchCategorySeries(value);\r\n                },\r\n            })\r\n        );\r\n    }\r\n}\r\n", "import type { IAggFunc } from 'ag-grid-community';\r\nimport { AgSelect, AgToggleButton } from 'ag-grid-community';\r\n\r\nimport { AgGroupComponent } from '../../../../widgets/agGroupComponent';\r\nimport type { ChartController } from '../../chartController';\r\nimport type { ColState } from '../../model/chartDataModel';\r\nimport { DEFAULT_CHART_CATEGORY } from '../../model/chartDataModel';\r\nimport { DragDataPanel } from './dragDataPanel';\r\n\r\ntype AggFuncPreset = 'count' | 'sum' | 'min' | 'max' | 'avg' | 'first' | 'last';\r\n\r\nconst DEFAULT_AGG_FUNC: AggFuncPreset = 'sum';\r\n\r\nexport class CategoriesDataPanel extends DragDataPanel {\r\n    private aggFuncToggle?: AgToggleButton;\r\n    private aggFuncSelect?: AgSelect;\r\n\r\n    constructor(\r\n        chartController: ChartController,\r\n        private readonly title: string,\r\n        allowMultipleSelection: boolean,\r\n        private dimensionCols: ColState[],\r\n        private isOpen?: boolean\r\n    ) {\r\n        const maxSelection = undefined;\r\n        super(chartController, allowMultipleSelection, maxSelection, /* html */ `<div id=\"categoriesGroup\"></div>`);\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.groupComp = this.createBean(\r\n            new AgGroupComponent({\r\n                title: this.title,\r\n                enabled: true,\r\n                suppressEnabledCheckbox: true,\r\n                suppressOpenCloseIcons: false,\r\n                cssIdentifier: 'charts-data',\r\n                expanded: this.isOpen,\r\n            })\r\n        );\r\n\r\n        this.createGroup(\r\n            this.dimensionCols,\r\n            (col) => col.displayName ?? '',\r\n            'categoryAdd',\r\n            'categorySelect',\r\n            () => !this.chartController.getAggFunc()\r\n        );\r\n        this.createAggFuncControls(this.dimensionCols);\r\n\r\n        this.getGui().appendChild(this.groupComp.getGui());\r\n    }\r\n\r\n    public refresh(dimensionCols: ColState[]): void {\r\n        this.valuePillSelect?.setValues(\r\n            dimensionCols,\r\n            dimensionCols.filter((col) => col.selected)\r\n        );\r\n        this.refreshValueSelect(dimensionCols);\r\n        this.refreshAggFuncControls(dimensionCols, this.chartController.getAggFunc());\r\n    }\r\n\r\n    private createAggFuncControls(dimensionCols: ColState[]): void {\r\n        const aggFunc = this.chartController.getAggFunc();\r\n        this.groupComp.addItem(\r\n            (this.aggFuncToggle = this.createBean(\r\n                new AgToggleButton({\r\n                    label: this.chartTranslation.translate('aggregate'),\r\n                    labelAlignment: 'left',\r\n                    labelWidth: 'flex',\r\n                    inputWidth: 'flex',\r\n                    value: aggFunc != undefined,\r\n                    onValueChange: (value) => {\r\n                        const aggFunc = value ? DEFAULT_AGG_FUNC : undefined;\r\n                        this.chartController.setAggFunc(aggFunc);\r\n                        this.aggFuncSelect?.setValue(aggFunc, true);\r\n                        this.aggFuncSelect?.setDisplayed(aggFunc != undefined);\r\n                    },\r\n                })\r\n            ))\r\n        );\r\n        this.groupComp.addItem(\r\n            (this.aggFuncSelect = this.createBean(\r\n                new AgSelect<AggFuncPreset>({\r\n                    options: [\r\n                        { value: 'sum', text: this.chartTranslation.translate('sum') },\r\n                        { value: 'first', text: this.chartTranslation.translate('first') },\r\n                        { value: 'last', text: this.chartTranslation.translate('last') },\r\n                        { value: 'min', text: this.chartTranslation.translate('min') },\r\n                        { value: 'max', text: this.chartTranslation.translate('max') },\r\n                        { value: 'count', text: this.chartTranslation.translate('count') },\r\n                        { value: 'avg', text: this.chartTranslation.translate('avg') },\r\n                    ],\r\n                    value: typeof aggFunc === 'string' ? aggFunc : undefined,\r\n                    onValueChange: (value) => {\r\n                        this.chartController.setAggFunc(value);\r\n                    },\r\n                })\r\n            ))\r\n        );\r\n        this.refreshAggFuncControls(dimensionCols, aggFunc);\r\n    }\r\n\r\n    private refreshAggFuncControls(dimensionCols: ColState[], aggFunc: string | IAggFunc | undefined): void {\r\n        const selectedDimensions = dimensionCols.filter((col) => col.selected);\r\n        const supportsAggregation = selectedDimensions.some((col) => col.colId !== DEFAULT_CHART_CATEGORY);\r\n        this.aggFuncToggle?.setValue(aggFunc != undefined);\r\n        this.aggFuncSelect?.setValue(typeof aggFunc === 'string' ? aggFunc : undefined, true);\r\n        this.aggFuncToggle?.setDisplayed(supportsAggregation);\r\n        this.aggFuncSelect?.setDisplayed(supportsAggregation && aggFunc != undefined);\r\n    }\r\n\r\n    private clearAggFuncControls(): void {\r\n        this.aggFuncToggle = this.destroyBean(this.aggFuncToggle);\r\n        this.aggFuncSelect = this.destroyBean(this.aggFuncSelect);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.clearAggFuncControls();\r\n        this.groupComp = this.destroyBean(this.groupComp)!;\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { AgSelectParams, BeanCollection, ListOption } from 'ag-grid-community';\r\nimport { AgSelect, Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent } from '../../../../widgets/agGroupComponent';\r\nimport type { AgPillSelectChangeParams } from '../../../widgets/agPillSelect';\r\nimport { AgPillSelect } from '../../../widgets/agPillSelect';\r\nimport type { ChartController } from '../../chartController';\r\nimport type { ColState } from '../../model/chartDataModel';\r\nimport { DEFAULT_CHART_CATEGORY } from '../../model/chartDataModel';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../services/chartTranslationService';\r\n\r\nexport abstract class DragDataPanel extends Component {\r\n    protected chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    protected groupComp: AgGroupComponent;\r\n    protected valuePillSelect?: AgPillSelect<ColState>;\r\n    private valueSelect?: AgSelect<ColState>;\r\n\r\n    constructor(\r\n        protected readonly chartController: ChartController,\r\n        protected readonly allowMultipleSelection: boolean,\r\n        private readonly maxSelection: number | undefined,\r\n        template?: string\r\n    ) {\r\n        super(template);\r\n    }\r\n\r\n    public addItem(eItem: HTMLElement): void {\r\n        this.groupComp.addItem(eItem);\r\n    }\r\n\r\n    protected createGroup(\r\n        columns: ColState[],\r\n        valueFormatter: (colState: ColState) => string,\r\n        selectLabelKey: ChartTranslationKey,\r\n        dragSourceId: string,\r\n        skipAnimation?: () => boolean\r\n    ): void {\r\n        if (this.allowMultipleSelection) {\r\n            const selectedValueList = columns.filter((col) => col.selected);\r\n            this.valuePillSelect = this.groupComp.createManagedBean(\r\n                new AgPillSelect<ColState>({\r\n                    valueList: columns,\r\n                    selectedValueList,\r\n                    valueFormatter,\r\n                    selectPlaceholder: this.chartTranslation.translate(selectLabelKey),\r\n                    dragSourceId,\r\n                    onValuesChange: (params) => this.onValueChange(params),\r\n                    maxSelection: this.maxSelection,\r\n                })\r\n            );\r\n            this.groupComp.addItem(this.valuePillSelect);\r\n        } else {\r\n            const params: AgSelectParams<ColState> = this.createValueSelectParams(columns);\r\n            params.onValueChange = (updatedColState: ColState) => {\r\n                columns.forEach((col) => {\r\n                    col.selected = false;\r\n                });\r\n                updatedColState.selected = true;\r\n                // Clear the category aggregation function if the default ordinal category is selected\r\n                if (updatedColState.colId === DEFAULT_CHART_CATEGORY) {\r\n                    this.chartController.setAggFunc(undefined, true);\r\n                }\r\n                this.chartController.updateForPanelChange({ updatedColState, skipAnimation: skipAnimation?.() });\r\n            };\r\n            this.valueSelect = this.groupComp.createManagedBean(new AgSelect<ColState>(params));\r\n            this.groupComp.addItem(this.valueSelect);\r\n        }\r\n    }\r\n\r\n    protected refreshValueSelect(columns: ColState[]): void {\r\n        if (!this.valueSelect) {\r\n            return;\r\n        }\r\n        const { options, value } = this.createValueSelectParams(columns);\r\n        this.valueSelect.clearOptions().addOptions(options).setValue(value, true);\r\n    }\r\n\r\n    private createValueSelectParams(columns: ColState[]): {\r\n        options: ListOption<ColState>[];\r\n        value: ColState;\r\n    } {\r\n        let selectedValue: ColState;\r\n        const options = columns.map((value) => {\r\n            const text = value.displayName ?? '';\r\n            if (value.selected) {\r\n                selectedValue = value;\r\n            }\r\n            return {\r\n                value,\r\n                text,\r\n            };\r\n        });\r\n        return {\r\n            options,\r\n            value: selectedValue!,\r\n        };\r\n    }\r\n\r\n    private onValueChange({ added, updated, removed, selected }: AgPillSelectChangeParams<ColState>) {\r\n        let updatedColState: ColState | undefined;\r\n        let resetOrder: boolean | undefined;\r\n        const updateOrder = () => {\r\n            selected.forEach((col, index) => {\r\n                col.order = index;\r\n            });\r\n            resetOrder = true;\r\n        };\r\n        if (added.length) {\r\n            updatedColState = added[0];\r\n            updatedColState.selected = true;\r\n            updateOrder();\r\n        } else if (removed.length) {\r\n            updatedColState = removed[0];\r\n            updatedColState.selected = false;\r\n        } else if (updated.length) {\r\n            updateOrder();\r\n            updatedColState = updated[0];\r\n        }\r\n        if (updatedColState) {\r\n            this.chartController.updateForPanelChange({ updatedColState, resetOrder });\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.valuePillSelect = undefined;\r\n        this.valueSelect = undefined;\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { DragAndDropIcon, DragItem, DraggingEvent, DropTarget, ListOption } from 'ag-grid-community';\r\nimport {\r\n    AgSelect,\r\n    Component,\r\n    DragSourceType,\r\n    _escapeString,\r\n    _getActiveDomElement,\r\n    _removeFromParent,\r\n} from 'ag-grid-community';\r\n\r\nimport { PillDragComp } from '../../widgets/pillDragComp';\r\nimport { PillDropZonePanel } from '../../widgets/pillDropZonePanel';\r\nimport { agPillSelectCSS } from './agPillSelect.css-GENERATED';\r\n\r\nexport interface AgPillSelectParams<TValue = string | null> {\r\n    valueList?: TValue[];\r\n    selectedValueList?: TValue[];\r\n    valueFormatter?: (value: TValue) => string;\r\n    ariaLabel?: string;\r\n    selectPlaceholder?: string;\r\n    onValuesChange?: (params: AgPillSelectChangeParams<TValue>) => void;\r\n    dragSourceId?: string;\r\n    maxSelection?: number;\r\n}\r\n\r\nexport interface AgPillSelectChangeParams<TValue> {\r\n    added: TValue[];\r\n    removed: TValue[];\r\n    updated: TValue[];\r\n    selected: TValue[];\r\n}\r\n\r\nexport class AgPillSelect<TValue = string | null> extends Component {\r\n    private dropZonePanel: PillSelectDropZonePanel<TValue>;\r\n    private eSelect?: AgSelect<TValue>;\r\n\r\n    private readonly config: AgPillSelectParams<TValue>;\r\n    private valueList: TValue[];\r\n    private selectedValues: TValue[];\r\n    private valueFormatter: (value: TValue) => string;\r\n    private onValuesChange?: (params: AgPillSelectChangeParams<TValue>) => void;\r\n\r\n    constructor(config?: AgPillSelectParams<TValue>) {\r\n        super(/* html */ `<div class=\"ag-pill-select\" role=\"presentation\"></div>`);\r\n        this.config = config ?? {};\r\n\r\n        const { selectedValueList, valueFormatter, valueList } = this.config;\r\n        this.selectedValues = selectedValueList ?? [];\r\n        this.valueList = valueList ?? [];\r\n        this.valueFormatter = valueFormatter ?? ((value) => _escapeString(value as any)!);\r\n        this.registerCSS(agPillSelectCSS);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const { ariaLabel, onValuesChange, dragSourceId } = this.config;\r\n        this.dropZonePanel = this.createManagedBean(\r\n            new PillSelectDropZonePanel(\r\n                {\r\n                    getValues: () => this.selectedValues,\r\n                    setValues: (values) => this.updateValues(values),\r\n                    isDraggable: () => this.selectedValues.length > 1,\r\n                },\r\n                (value) => this.valueFormatter(value),\r\n                ariaLabel!,\r\n                dragSourceId\r\n            )\r\n        );\r\n        const eGui = this.getGui();\r\n        eGui.appendChild(this.dropZonePanel.getGui());\r\n        this.initSelect();\r\n        if (onValuesChange != null) {\r\n            this.onValuesChange = onValuesChange;\r\n        }\r\n    }\r\n\r\n    public setValues(valueList: TValue[], selectedValues: TValue[]): this {\r\n        const { added, removed, updated } = this.getChanges(this.valueList, valueList);\r\n        let refreshSelect = false;\r\n        if (added.length || removed.length || updated.length) {\r\n            refreshSelect = true;\r\n        }\r\n        this.valueList = valueList;\r\n        this.updateValues(selectedValues, refreshSelect, true);\r\n        return this;\r\n    }\r\n\r\n    public setValueFormatter(valueFormatter: (value: TValue) => string): this {\r\n        this.valueFormatter = valueFormatter;\r\n        return this;\r\n    }\r\n\r\n    private initSelect(): boolean {\r\n        const options = this.createSelectOptions();\r\n        if (!options.length) {\r\n            return false;\r\n        }\r\n        const { selectPlaceholder: placeholder } = this.config;\r\n        this.eSelect = this.createBean(\r\n            new AgSelect({\r\n                options,\r\n                placeholder,\r\n                onValueChange: (value) => this.addValue(value),\r\n                pickerIcon: 'chartsMenuAdd',\r\n            })\r\n        );\r\n        this.getGui().appendChild(this.eSelect.getGui());\r\n        return true;\r\n    }\r\n\r\n    private createSelectOptions(): ListOption<TValue>[] {\r\n        const options: ListOption<TValue>[] = [];\r\n        const { maxSelection } = this.config;\r\n        if (maxSelection && this.selectedValues.length >= maxSelection) {\r\n            return options;\r\n        }\r\n        this.valueList.forEach((value) => {\r\n            if (!this.selectedValues.includes(value)) {\r\n                options.push({ value, text: this.valueFormatter(value) });\r\n            }\r\n        });\r\n        return options;\r\n    }\r\n\r\n    private addValue(value: TValue): void {\r\n        this.dropZonePanel.addItem(value);\r\n    }\r\n\r\n    private updateValues(values: TValue[], forceRefreshSelect?: boolean, silent?: boolean): void {\r\n        const previousSelectedValues = this.selectedValues;\r\n        this.selectedValues = values;\r\n        const changes = this.getChanges(previousSelectedValues, values);\r\n        const refreshSelect = forceRefreshSelect || changes.added.length || changes.removed.length;\r\n        const activeElement = _getActiveDomElement(this.beans);\r\n        const selectHasFocus = this.eSelect?.getGui().contains(activeElement);\r\n        const dropZoneHasFocus = this.dropZonePanel?.getGui().contains(activeElement);\r\n        if (!silent) {\r\n            this.onValuesChange?.(changes);\r\n        }\r\n        const emptyRefreshedSelect = refreshSelect ? !this.refreshSelect() : false;\r\n        this.dropZonePanel.refreshGui();\r\n        if (refreshSelect && selectHasFocus) {\r\n            if (emptyRefreshedSelect) {\r\n                this.dropZonePanel.focusList(true);\r\n            } else {\r\n                this.eSelect?.getFocusableElement().focus();\r\n            }\r\n        }\r\n        if (dropZoneHasFocus && !values.length) {\r\n            this.eSelect?.getFocusableElement().focus();\r\n        }\r\n    }\r\n\r\n    private getChanges(\r\n        previousSelectedValues: TValue[],\r\n        newSelectedValues: TValue[]\r\n    ): AgPillSelectChangeParams<TValue> {\r\n        const added = newSelectedValues.filter((value) => !previousSelectedValues.includes(value));\r\n        const removed = previousSelectedValues.filter((value) => !newSelectedValues.includes(value));\r\n        const updated = newSelectedValues.filter((value, index) => previousSelectedValues[index] !== value);\r\n        return { added, removed, updated, selected: newSelectedValues };\r\n    }\r\n\r\n    private refreshSelect(): boolean {\r\n        if (!this.eSelect) {\r\n            return this.initSelect();\r\n        }\r\n        const options = this.createSelectOptions();\r\n        if (!options.length) {\r\n            _removeFromParent(this.eSelect.getGui());\r\n            this.eSelect = this.destroyBean(this.eSelect);\r\n            return false;\r\n        }\r\n        this.eSelect.clearOptions().addOptions(options).setValue(undefined, true);\r\n        return true;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyBean(this.eSelect);\r\n        super.destroy();\r\n    }\r\n}\r\n\r\nclass PillSelectDragComp<TValue> extends PillDragComp<TValue> {\r\n    constructor(\r\n        private readonly value: TValue,\r\n        dragSourceDropTarget: DropTarget,\r\n        ghost: boolean,\r\n        private readonly valueFormatter: (value: TValue) => string,\r\n        private readonly draggable: boolean,\r\n        private readonly sourceId?: string\r\n    ) {\r\n        super(dragSourceDropTarget, ghost, false);\r\n    }\r\n\r\n    public getItem(): TValue {\r\n        return this.value;\r\n    }\r\n\r\n    protected getDisplayName(): string {\r\n        return this.valueFormatter(this.value);\r\n    }\r\n\r\n    protected getAriaDisplayName(): string {\r\n        return this.getDisplayName();\r\n    }\r\n\r\n    protected getTooltip(): string | null | undefined {\r\n        return undefined;\r\n    }\r\n\r\n    protected createGetDragItem(): () => DragItem<TValue> {\r\n        return () => ({\r\n            value: this.value,\r\n        });\r\n    }\r\n\r\n    protected getDragSourceType(): DragSourceType {\r\n        return DragSourceType.ChartPanel;\r\n    }\r\n\r\n    protected override getDragSourceId(): string | undefined {\r\n        return this.sourceId;\r\n    }\r\n\r\n    protected override isDraggable(): boolean {\r\n        return this.draggable;\r\n    }\r\n}\r\n\r\nclass PillSelectDropZonePanel<TValue> extends PillDropZonePanel<PillSelectDragComp<TValue>, TValue> {\r\n    constructor(\r\n        private readonly model: {\r\n            getValues: () => TValue[];\r\n            setValues: (values: TValue[]) => void;\r\n            isDraggable: () => boolean;\r\n        },\r\n        private readonly valueFormatter: (value: TValue) => string,\r\n        private readonly ariaLabel: string,\r\n        private readonly sourceId?: string\r\n    ) {\r\n        super(false);\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        super.init();\r\n    }\r\n\r\n    protected isItemDroppable(item: TValue, draggingEvent: DraggingEvent): boolean {\r\n        return (\r\n            this.isSourceEventFromTarget(draggingEvent) ||\r\n            (this.sourceId != null && this.sourceId === draggingEvent.dragSource.sourceId)\r\n        );\r\n    }\r\n\r\n    protected updateItems(items: TValue[]): void {\r\n        this.model.setValues(items);\r\n    }\r\n\r\n    protected getExistingItems(): TValue[] {\r\n        return this.model.getValues();\r\n    }\r\n\r\n    protected getIconName(): DragAndDropIcon {\r\n        return this.isPotentialDndItems() ? 'move' : 'notAllowed';\r\n    }\r\n\r\n    protected getAriaLabel(): string {\r\n        return this.ariaLabel;\r\n    }\r\n\r\n    protected createPillComponent(item: TValue, dropTarget: DropTarget, ghost: boolean): PillSelectDragComp<TValue> {\r\n        return new PillSelectDragComp(\r\n            item,\r\n            dropTarget,\r\n            ghost,\r\n            this.valueFormatter,\r\n            this.model.isDraggable(),\r\n            this.sourceId\r\n        );\r\n    }\r\n\r\n    protected getItems(dragItem: DragItem): TValue[] {\r\n        return [dragItem.value];\r\n    }\r\n\r\n    protected isInterestedIn(type: DragSourceType): boolean {\r\n        return type === DragSourceType.ChartPanel;\r\n    }\r\n}\r\n", "export const agPillSelectCSS = /*css*/ `.ag-pill-select{display:flex;flex-direction:column}:where(.ag-pill-select){.ag-column-drop-list{padding:0}.ag-select{padding-top:var(--ag-spacing)}.ag-picker-field-wrapper{background-color:transparent;border:0}.ag-picker-field-display{cursor:pointer;font-weight:500}.ag-picker-field-display,.ag-picker-field-icon{color:var(--ag-chart-menu-label-color)}}`;\n", "import type { BeanCollection, IChartService } from 'ag-grid-community';\r\nimport { AgSelect, Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent, AgGroupComponentParams } from '../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../widgets/agGroupComponent';\r\nimport type { ChartTranslationService } from '../../services/chartTranslationService';\r\nimport {\r\n    SERIES_GROUP_TYPES,\r\n    canSwitchDirection,\r\n    getFullChartNameTranslationKey,\r\n    getSeriesType,\r\n} from '../../utils/seriesTypeMapper';\r\nimport type { ChartMenuContext } from '../chartMenuContext';\r\nimport { ChartMenuParamsFactory } from '../chartMenuParamsFactory';\r\n\r\nexport class ChartSpecificDataPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n    private chartSvc: IChartService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n        this.chartSvc = beans.chartSvc!;\r\n    }\r\n\r\n    private readonly chartSpecificGroup: AgGroupComponent = RefPlaceholder;\r\n\r\n    private directionSelect?: AgSelect;\r\n    private groupTypeSelect?: AgSelect;\r\n    private hasContent = false;\r\n\r\n    constructor(\r\n        private readonly chartMenuContext: ChartMenuContext,\r\n        private isOpen?: boolean\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        const title = this.getTitle();\r\n        const chartSpecificGroupParams: AgGroupComponentParams = {\r\n            title,\r\n            enabled: true,\r\n            suppressEnabledCheckbox: true,\r\n            suppressOpenCloseIcons: false,\r\n            cssIdentifier: 'charts-data',\r\n            expanded: this.isOpen,\r\n            items: [...this.createDirectionSelect(), this.createGroupTypeSelect()],\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `\r\n            <div id=\"chartSpecificGroup\">\r\n                <ag-group-component data-ref=\"chartSpecificGroup\"></ag-group-component>\r\n            </div>`,\r\n            [AgGroupComponentSelector],\r\n            {\r\n                chartSpecificGroup: chartSpecificGroupParams,\r\n            }\r\n        );\r\n        this.setDisplayed(this.hasContent);\r\n    }\r\n\r\n    public refresh(): void {\r\n        this.hasContent = false;\r\n        this.chartSpecificGroup.setTitle(this.getTitle());\r\n        this.updateDirectionSelect();\r\n        this.updateGroupTypeSelect();\r\n        this.setDisplayed(this.hasContent);\r\n    }\r\n\r\n    private getTitle(): string {\r\n        const chartType = this.chartMenuContext.chartController.getChartType();\r\n        return this.chartTranslation.translate(getFullChartNameTranslationKey(chartType));\r\n    }\r\n\r\n    private createDirectionSelect(): AgSelect[] {\r\n        if (!this.chartSvc.isEnterprise()) {\r\n            return [];\r\n        }\r\n        const { chartOptionsService, chartController } = this.chartMenuContext;\r\n        const chartOptionsSeriesProxy = chartOptionsService.getSeriesOptionsProxy(() =>\r\n            getSeriesType(chartController.getChartType())\r\n        );\r\n        const chartSeriesMenuParamsFactory = this.createManagedBean(\r\n            new ChartMenuParamsFactory(chartOptionsSeriesProxy)\r\n        );\r\n        const options = (['horizontal', 'vertical'] as const).map((value) => ({\r\n            value,\r\n            text: this.chartTranslation.translate(value),\r\n        }));\r\n        const params = chartSeriesMenuParamsFactory.getDefaultSelectParams('direction', 'direction', options);\r\n        const onValueChange = params.onValueChange;\r\n        params.onValueChange = (value) => {\r\n            onValueChange!(value);\r\n            // series and axes configuration are based on direction\r\n            chartController.raiseChartModelUpdateEvent();\r\n        };\r\n        this.directionSelect = this.createManagedBean(new AgSelect(params));\r\n        this.updateDirectionSelect();\r\n        return [this.directionSelect];\r\n    }\r\n\r\n    private updateDirectionSelect(): void {\r\n        const isDisplayed = canSwitchDirection(this.chartMenuContext.chartController.getChartType());\r\n        this.updateDisplayed(this.directionSelect, isDisplayed);\r\n    }\r\n\r\n    private createGroupTypeSelect(): AgSelect {\r\n        const { chartController, chartMenuParamsFactory } = this.chartMenuContext;\r\n        this.groupTypeSelect = this.createManagedBean(\r\n            new AgSelect(\r\n                chartMenuParamsFactory.getDefaultSelectParamsWithoutValueParams(\r\n                    'seriesGroupType',\r\n                    SERIES_GROUP_TYPES.map((value) => ({\r\n                        value,\r\n                        text: this.chartTranslation.translate(`${value}SeriesGroupType`),\r\n                    })),\r\n                    chartController.getSeriesGroupType(),\r\n                    (value) => chartController.setSeriesGroupType(value)\r\n                )\r\n            )\r\n        );\r\n        this.updateGroupTypeSelect();\r\n        return this.groupTypeSelect;\r\n    }\r\n\r\n    private updateGroupTypeSelect(): void {\r\n        const isDisplayed = ['radialColumn', 'radialBar', 'nightingale'].includes(\r\n            this.chartMenuContext.chartController.getChartType()\r\n        );\r\n        this.updateDisplayed(this.groupTypeSelect, isDisplayed);\r\n    }\r\n\r\n    private updateDisplayed(select: AgSelect | undefined, isDisplayed: boolean): void {\r\n        select?.setDisplayed(isDisplayed);\r\n        if (select) {\r\n            this.hasContent = this.hasContent || isDisplayed;\r\n        }\r\n    }\r\n}\r\n", "import type {\r\n    AgCheckboxParams,\r\n    AgFieldParams,\r\n    AgInputNumberFieldParams,\r\n    AgSelectParams,\r\n    BeanCollection,\r\n    ListOption,\r\n} from 'ag-grid-community';\r\nimport { BeanStub } from 'ag-grid-community';\r\n\r\nimport type { AgColorPickerParams } from '../../widgets/agColorPicker';\r\nimport type { AgSliderParams } from '../../widgets/agSlider';\r\nimport type { ChartOptionsProxy } from '../services/chartOptionsService';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../services/chartTranslationService';\r\nimport type { FontPanelParams } from './format/fontPanel';\r\n\r\nexport class ChartMenuParamsFactory extends BeanStub {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    constructor(private readonly chartOptionsProxy: ChartOptionsProxy) {\r\n        super();\r\n    }\r\n\r\n    public getDefaultColorPickerParams(\r\n        expression: string,\r\n        labelKey?: ChartTranslationKey,\r\n        options?: {\r\n            parseInputValue: (value: any) => any;\r\n            formatInputValue: (value: any) => any;\r\n        }\r\n    ): AgColorPickerParams {\r\n        return this.addValueParams(\r\n            expression,\r\n            {\r\n                label: this.chartTranslation.translate(labelKey ?? 'color'),\r\n                labelWidth: 'flex',\r\n                inputWidth: 'flex',\r\n                labelAlignment: 'top',\r\n                pickerGap: 6,\r\n            },\r\n            options\r\n        );\r\n    }\r\n\r\n    public getDefaultNumberInputParams(\r\n        expression: string,\r\n        labelKey: ChartTranslationKey,\r\n        options?: {\r\n            precision?: number;\r\n            step?: number;\r\n            min?: number;\r\n            max?: number;\r\n        }\r\n    ): AgInputNumberFieldParams {\r\n        return this.addValueParams<AgInputNumberFieldParams>(\r\n            expression,\r\n            {\r\n                label: this.chartTranslation.translate(labelKey),\r\n                labelAlignment: 'top',\r\n                labelWidth: 'flex',\r\n                inputWidth: 'flex',\r\n                precision: options?.precision,\r\n                step: options?.step,\r\n                min: options?.min,\r\n                max: options?.max,\r\n            },\r\n            {\r\n                parseInputValue: (value) => {\r\n                    const numberValue = Number(value);\r\n                    return isNaN(numberValue) ? undefined : numberValue;\r\n                },\r\n                formatInputValue: (value) => {\r\n                    return value == null ? '' : `${value}`;\r\n                },\r\n            }\r\n        );\r\n    }\r\n\r\n    public getDefaultSliderParams(\r\n        expression: string,\r\n        labelKey: ChartTranslationKey,\r\n        defaultMaxValue: number,\r\n        isArray?: boolean\r\n    ): AgSliderParams {\r\n        let value = this.chartOptionsProxy.getValue<number>(expression) ?? 0;\r\n        if (isArray && Array.isArray(value)) {\r\n            value = value[0];\r\n        }\r\n        const params = this.getDefaultSliderParamsWithoutValueParams(value, labelKey, defaultMaxValue);\r\n        params.onValueChange = (value) => this.chartOptionsProxy.setValue(expression, isArray ? [value] : value);\r\n        return params;\r\n    }\r\n\r\n    public getDefaultSliderParamsWithoutValueParams(\r\n        value: number,\r\n        labelKey: ChartTranslationKey,\r\n        defaultMaxValue: number\r\n    ): AgSliderParams {\r\n        return {\r\n            label: this.chartTranslation.translate(labelKey),\r\n            minValue: 0,\r\n            maxValue: Math.max(value, defaultMaxValue),\r\n            textFieldWidth: 45,\r\n            value: `${value}`,\r\n        };\r\n    }\r\n\r\n    public getDefaultCheckboxParams(\r\n        expression: string,\r\n        labelKey: ChartTranslationKey,\r\n        options?: {\r\n            readOnly?: boolean;\r\n            passive?: boolean;\r\n        }\r\n    ): AgCheckboxParams {\r\n        const value = this.chartOptionsProxy.getValue<boolean>(expression);\r\n        const params: AgCheckboxParams = {\r\n            label: this.chartTranslation.translate(labelKey),\r\n            value,\r\n            readOnly: options?.readOnly,\r\n            passive: options?.passive,\r\n        };\r\n        params.onValueChange = (value) => {\r\n            this.chartOptionsProxy.setValue(expression, typeof value === 'boolean' ? value : undefined);\r\n        };\r\n        return params;\r\n    }\r\n\r\n    public getDefaultSelectParams(\r\n        expression: string,\r\n        labelKey: ChartTranslationKey,\r\n        dropdownOptions: Array<ListOption>\r\n    ): AgSelectParams {\r\n        return this.getDefaultSelectParamsWithoutValueParams(\r\n            labelKey,\r\n            dropdownOptions,\r\n            this.chartOptionsProxy.getValue(expression),\r\n            (value) => {\r\n                this.chartOptionsProxy.setValue(expression, value);\r\n            }\r\n        );\r\n    }\r\n\r\n    public getDefaultSelectParamsWithoutValueParams(\r\n        labelKey: ChartTranslationKey,\r\n        options: Array<ListOption>,\r\n        value: any,\r\n        onValueChange: (value: any) => void\r\n    ): AgSelectParams {\r\n        return {\r\n            label: this.chartTranslation.translate(labelKey),\r\n            labelAlignment: 'top',\r\n            options,\r\n            pickerGap: 6,\r\n            value,\r\n            onValueChange,\r\n        };\r\n    }\r\n\r\n    public getDefaultFontPanelParams(expression: string, labelKey: ChartTranslationKey): FontPanelParams {\r\n        const keyMapper = (key: string) => `${expression}.${key}`;\r\n        return this.addEnableParams<FontPanelParams>(keyMapper('enabled'), {\r\n            name: this.chartTranslation.translate(labelKey),\r\n            suppressEnabledCheckbox: false,\r\n            chartMenuParamsFactory: this,\r\n            keyMapper,\r\n        } as any);\r\n    }\r\n\r\n    public addValueParams<P extends AgFieldParams>(\r\n        expression: string,\r\n        params: P,\r\n        options?: {\r\n            parseInputValue: (value: any) => any;\r\n            formatInputValue: (value: any) => any;\r\n        }\r\n    ): P {\r\n        const optionsValue = this.chartOptionsProxy.getValue(expression);\r\n        params.value = options?.formatInputValue ? options.formatInputValue(optionsValue) : optionsValue;\r\n        params.onValueChange = (value) => {\r\n            const optionsValue = options?.parseInputValue ? options.parseInputValue(value) : value;\r\n            this.chartOptionsProxy.setValue(expression, optionsValue);\r\n        };\r\n        return params;\r\n    }\r\n\r\n    public addEnableParams<\r\n        P extends {\r\n            enabled?: boolean;\r\n            onEnableChange?: (value: boolean) => void;\r\n        },\r\n    >(expression: string, params: P): P {\r\n        params.enabled = this.chartOptionsProxy.getValue(expression) ?? false;\r\n        params.onEnableChange = (value) => this.chartOptionsProxy.setValue(expression, value);\r\n        return params;\r\n    }\r\n\r\n    public getChartOptions(): ChartOptionsProxy {\r\n        return this.chartOptionsProxy;\r\n    }\r\n}\r\n", "import type { BeanCollection, ChartType, SeriesChartType } from 'ag-grid-community';\r\nimport { AgCheckbox, AgSelect, Component, _areEqual, _clearElement } from 'ag-grid-community';\r\n\r\nimport { AgGroupComponent } from '../../../../widgets/agGroupComponent';\r\nimport type { ChartController } from '../../chartController';\r\nimport type { ColState } from '../../model/chartDataModel';\r\nimport type { ChartTranslationService } from '../../services/chartTranslationService';\r\nimport { getFullChartNameTranslationKey } from '../../utils/seriesTypeMapper';\r\n\r\nexport class SeriesChartTypePanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    private seriesChartTypeGroupComp: AgGroupComponent;\r\n    private selectedColIds: string[] = [];\r\n    private chartTypeComps: Map<string, AgSelect> = new Map();\r\n    private secondaryAxisComps: Map<string, AgCheckbox> = new Map();\r\n\r\n    constructor(\r\n        private readonly chartController: ChartController,\r\n        private columns: ColState[],\r\n        private isOpen?: boolean\r\n    ) {\r\n        super(/* html */ `<div id=\"seriesChartTypeGroup\"></div>`);\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.createSeriesChartTypeGroup(this.columns);\r\n    }\r\n\r\n    public refresh(columns: ColState[]): void {\r\n        if (!_areEqual(this.getValidColIds(columns), this.selectedColIds)) {\r\n            this.recreate(columns);\r\n        } else {\r\n            this.refreshComps();\r\n        }\r\n    }\r\n\r\n    private recreate(columns: ColState[]): void {\r\n        this.isOpen = this.seriesChartTypeGroupComp.isExpanded();\r\n        _clearElement(this.getGui());\r\n        this.destroyBean(this.seriesChartTypeGroupComp);\r\n        this.columns = columns;\r\n        this.selectedColIds = [];\r\n        this.clearComps();\r\n        this.postConstruct();\r\n    }\r\n\r\n    private getValidColIds(columns: ColState[]): string[] {\r\n        const seriesChartTypes = this.chartController.getSeriesChartTypes();\r\n\r\n        return columns\r\n            .filter((col) => col.selected && !!seriesChartTypes.filter((s) => s.colId === col.colId)[0])\r\n            .map(({ colId }) => colId);\r\n    }\r\n\r\n    private createSeriesChartTypeGroup(columns: ColState[]): void {\r\n        this.seriesChartTypeGroupComp = this.createBean(\r\n            new AgGroupComponent({\r\n                title: this.chartTranslation.translate('seriesChartType'),\r\n                enabled: true,\r\n                suppressEnabledCheckbox: true,\r\n                suppressOpenCloseIcons: false,\r\n                cssIdentifier: 'charts-data',\r\n                expanded: this.isOpen,\r\n            })\r\n        );\r\n\r\n        const seriesChartTypes = this.chartController.getSeriesChartTypes();\r\n\r\n        columns.forEach((col) => {\r\n            if (!col.selected) {\r\n                return;\r\n            }\r\n\r\n            const seriesChartType: SeriesChartType = seriesChartTypes.filter((s) => s.colId === col.colId)[0];\r\n            if (!seriesChartType) {\r\n                return;\r\n            }\r\n\r\n            this.selectedColIds.push(col.colId);\r\n\r\n            const seriesItemGroup = this.seriesChartTypeGroupComp.createManagedBean(\r\n                new AgGroupComponent({\r\n                    title: col.displayName!,\r\n                    enabled: true,\r\n                    suppressEnabledCheckbox: true,\r\n                    suppressOpenCloseIcons: true,\r\n                    cssIdentifier: 'charts-format-sub-level',\r\n                })\r\n            );\r\n\r\n            const isSecondaryAxisDisabled = (chartType: ChartType) =>\r\n                ['groupedColumn', 'stackedColumn', 'stackedArea'].includes(chartType);\r\n\r\n            const secondaryAxisComp = this.seriesChartTypeGroupComp.createManagedBean(\r\n                new AgCheckbox({\r\n                    label: this.chartTranslation.translate('secondaryAxis'),\r\n                    labelWidth: 'flex',\r\n                    disabled: isSecondaryAxisDisabled(seriesChartType.chartType),\r\n                    value: !!seriesChartType.secondaryAxis,\r\n                    onValueChange: (enabled: boolean) =>\r\n                        this.chartController.updateSeriesChartType(col.colId, undefined, enabled),\r\n                })\r\n            );\r\n\r\n            seriesItemGroup.addItem(secondaryAxisComp);\r\n\r\n            const options = (['line', 'area', 'stackedArea', 'groupedColumn', 'stackedColumn'] as const).map(\r\n                (value) => ({\r\n                    value,\r\n                    text: this.chartTranslation.translate(getFullChartNameTranslationKey(value)),\r\n                })\r\n            );\r\n\r\n            const chartTypeComp = seriesItemGroup.createManagedBean(\r\n                new AgSelect({\r\n                    options,\r\n                    value: seriesChartType.chartType,\r\n                    onValueChange: (chartType: ChartType) =>\r\n                        this.chartController.updateSeriesChartType(col.colId, chartType),\r\n                })\r\n            );\r\n\r\n            seriesItemGroup.addItem(chartTypeComp);\r\n\r\n            this.seriesChartTypeGroupComp.addItem(seriesItemGroup);\r\n            this.chartTypeComps.set(col.colId, chartTypeComp);\r\n            this.secondaryAxisComps.set(col.colId, secondaryAxisComp);\r\n        });\r\n\r\n        this.getGui().appendChild(this.seriesChartTypeGroupComp.getGui());\r\n    }\r\n\r\n    private refreshComps(): void {\r\n        const seriesChartTypes = this.chartController.getSeriesChartTypes();\r\n        this.selectedColIds.forEach((colId) => {\r\n            const seriesChartType = seriesChartTypes.find((chartType) => chartType.colId === colId);\r\n            if (!seriesChartType) {\r\n                return;\r\n            }\r\n            const chartTypeComp = this.chartTypeComps.get(colId);\r\n            const secondaryAxisComp = this.secondaryAxisComps.get(colId);\r\n\r\n            chartTypeComp?.setValue(seriesChartType.chartType);\r\n            secondaryAxisComp?.setValue(!!seriesChartType.secondaryAxis);\r\n            secondaryAxisComp?.setDisabled(this.isSecondaryAxisDisabled(seriesChartType.chartType));\r\n        });\r\n    }\r\n\r\n    private clearComps(): void {\r\n        this.chartTypeComps.clear();\r\n        this.secondaryAxisComps.clear();\r\n    }\r\n\r\n    private isSecondaryAxisDisabled(chartType: ChartType): boolean {\r\n        return ['groupedColumn', 'stackedColumn', 'stackedArea'].includes(chartType);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.clearComps();\r\n        this.seriesChartTypeGroupComp = this.destroyBean(this.seriesChartTypeGroupComp)!;\r\n        super.destroy();\r\n    }\r\n}\r\n", "import { AgToggleButton } from 'ag-grid-community';\r\n\r\nimport { AgGroupComponent } from '../../../../widgets/agGroupComponent';\r\nimport type { ChartController } from '../../chartController';\r\nimport type { ColState } from '../../model/chartDataModel';\r\nimport type { ChartOptionsService } from '../../services/chartOptionsService';\r\nimport { DragDataPanel } from './dragDataPanel';\r\n\r\nexport class SeriesDataPanel extends DragDataPanel {\r\n    constructor(\r\n        chartController: ChartController,\r\n        private readonly chartOptionsService: ChartOptionsService,\r\n        private readonly title: string,\r\n        allowMultipleSelect: boolean,\r\n        maxSelection: number | undefined,\r\n        private valueCols: ColState[],\r\n        private isOpen?: boolean\r\n    ) {\r\n        super(chartController, allowMultipleSelect, maxSelection, /* html */ `<div id=\"seriesGroup\"></div>`);\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.groupComp = this.createBean(\r\n            new AgGroupComponent({\r\n                title: this.title,\r\n                enabled: true,\r\n                suppressEnabledCheckbox: true,\r\n                suppressOpenCloseIcons: false,\r\n                cssIdentifier: 'charts-data',\r\n                expanded: this.isOpen,\r\n            })\r\n        );\r\n        if (this.chartController.isActiveXYChart()) {\r\n            const pairedModeToggle = this.groupComp.createManagedBean(\r\n                new AgToggleButton({\r\n                    label: this.chartTranslation.translate('paired'),\r\n                    labelAlignment: 'left',\r\n                    labelWidth: 'flex',\r\n                    inputWidth: 'flex',\r\n                    value: this.chartOptionsService.getPairedMode(),\r\n                    onValueChange: (newValue) => {\r\n                        this.chartOptionsService.setPairedMode(!!newValue);\r\n                        this.chartController.updateForGridChange({ maintainColState: true });\r\n                    },\r\n                })\r\n            );\r\n            this.groupComp.addItem(pairedModeToggle);\r\n        }\r\n\r\n        this.createGroup(this.valueCols, this.generateGetSeriesLabel(this.valueCols), 'seriesAdd', 'seriesSelect');\r\n\r\n        this.getGui().appendChild(this.groupComp.getGui());\r\n    }\r\n\r\n    public refresh(valueCols: ColState[]): void {\r\n        this.valuePillSelect?.setValueFormatter(this.generateGetSeriesLabel(valueCols));\r\n        this.valuePillSelect?.setValues(\r\n            valueCols,\r\n            valueCols.filter((col) => col.selected)\r\n        );\r\n        this.refreshValueSelect(valueCols);\r\n    }\r\n\r\n    private generateGetSeriesLabel(valueCols: ColState[]): (col: ColState) => string {\r\n        if (!this.chartController.isActiveXYChart()) {\r\n            return (col) => col.displayName ?? '';\r\n        }\r\n\r\n        const selectedCols = valueCols.filter((col) => col.selected);\r\n\r\n        const isBubble = this.chartController.getChartType() === 'bubble';\r\n        const isInPairedMode = this.chartOptionsService.getPairedMode();\r\n\r\n        const indexToAxisLabel = new Map<number, string>();\r\n        indexToAxisLabel.set(0, 'X');\r\n        indexToAxisLabel.set(1, 'Y');\r\n        indexToAxisLabel.set(2, 'size');\r\n\r\n        return (col: ColState): string => {\r\n            const escapedLabel = col.displayName ?? '';\r\n\r\n            if (!col.selected) {\r\n                return escapedLabel;\r\n            }\r\n\r\n            const index = selectedCols.indexOf(col);\r\n\r\n            if (index === -1) {\r\n                return escapedLabel;\r\n            }\r\n\r\n            let axisLabel;\r\n\r\n            if (isInPairedMode) {\r\n                axisLabel = indexToAxisLabel.get(index % (isBubble ? 3 : 2));\r\n            } else {\r\n                if (index === 0) {\r\n                    axisLabel = 'X';\r\n                } else {\r\n                    axisLabel = isBubble && index % 2 === 0 ? 'size' : 'Y';\r\n                }\r\n            }\r\n\r\n            return `${escapedLabel} (${axisLabel})`;\r\n        };\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.groupComp = this.destroyBean(this.groupComp)!;\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { ChartFormatPanel, ChartFormatPanelGroup } from 'ag-grid-community';\r\nimport { Component, _warn } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent } from '../../../../widgets/agGroupComponent';\r\nimport type { ChartSeriesType } from '../../utils/seriesTypeMapper';\r\nimport { isCartesian, isPolar } from '../../utils/seriesTypeMapper';\r\nimport type { ChartMenuContext } from '../chartMenuContext';\r\nimport { ChartPanelFeature } from '../chartPanelFeature';\r\nimport { CartesianAxisPanel } from './axis/cartesianAxisPanel';\r\nimport { PolarAxisPanel } from './axis/polarAxisPanel';\r\nimport { ChartPanel } from './chart/chartPanel';\r\nimport { GroupExpansionFeature } from './groupExpansionFeature';\r\nimport { LegendPanel } from './legend/legendPanel';\r\nimport { SeriesPanel } from './series/seriesPanel';\r\nimport { TitlesPanel } from './titles/titlesPanel';\r\n\r\nexport interface FormatPanelOptions extends ChartMenuContext {\r\n    isExpandedOnInit: boolean;\r\n    seriesType: ChartSeriesType;\r\n    registerGroupComponent: (groupComponent: AgGroupComponent) => void;\r\n}\r\n\r\nconst DefaultFormatPanelDef: ChartFormatPanel = {\r\n    groups: [{ type: 'chart' }, { type: 'titles' }, { type: 'legend' }, { type: 'series' }, { type: 'axis' }],\r\n};\r\n\r\nexport class FormatPanel extends Component {\r\n    private chartPanelFeature: ChartPanelFeature;\r\n    private groupExpansionFeature: GroupExpansionFeature;\r\n\r\n    constructor(private readonly chartMenuContext: ChartMenuContext) {\r\n        super(/* html */ `<div class=\"ag-chart-format-wrapper\"></div>`);\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.groupExpansionFeature = this.createManagedBean(new GroupExpansionFeature(this.getGui()));\r\n        this.chartPanelFeature = this.createManagedBean(\r\n            new ChartPanelFeature(\r\n                this.chartMenuContext.chartController,\r\n                this.getGui(),\r\n                'ag-chart-format-section',\r\n                (_chartType, seriesType) => this.createPanels(seriesType)\r\n            )\r\n        );\r\n        this.chartPanelFeature.refreshPanels();\r\n    }\r\n\r\n    private createPanels(seriesType: ChartSeriesType) {\r\n        let panelExpandedOnInit = false;\r\n        this.getFormatPanelDef().groups?.forEach(({ type: group, isOpen: isExpandedOnInit = false }) => {\r\n            // ensure the group should be displayed for the current series type\r\n            if (!this.isGroupPanelShownInSeries(group, seriesType)) {\r\n                return;\r\n            }\r\n\r\n            if (isExpandedOnInit) {\r\n                if (panelExpandedOnInit) {\r\n                    _warn(145, { group });\r\n                }\r\n                panelExpandedOnInit = true;\r\n            }\r\n\r\n            const registerGroupComponent = (groupComponent: AgGroupComponent) =>\r\n                this.groupExpansionFeature.addGroupComponent(groupComponent);\r\n\r\n            const opts: FormatPanelOptions = {\r\n                ...this.chartMenuContext,\r\n                isExpandedOnInit,\r\n                seriesType,\r\n                registerGroupComponent,\r\n            };\r\n\r\n            switch (group) {\r\n                case 'chart':\r\n                    this.chartPanelFeature.addComponent(new ChartPanel(opts));\r\n                    break;\r\n                case 'titles':\r\n                    this.chartPanelFeature.addComponent(new TitlesPanel(opts));\r\n                    break;\r\n                case 'legend':\r\n                    this.chartPanelFeature.addComponent(new LegendPanel(opts));\r\n                    break;\r\n                case 'axis':\r\n                    // Polar charts have different axis options from cartesian charts, so choose the appropriate panels\r\n                    if (isPolar(seriesType)) {\r\n                        this.chartPanelFeature.addComponent(new PolarAxisPanel(opts));\r\n                    } else if (isCartesian(seriesType)) {\r\n                        this.chartPanelFeature.addComponent(new CartesianAxisPanel('xAxis', opts));\r\n                        this.chartPanelFeature.addComponent(new CartesianAxisPanel('yAxis', opts));\r\n                    }\r\n                    break;\r\n                case 'horizontalAxis':\r\n                    this.chartPanelFeature.addComponent(new CartesianAxisPanel('xAxis', opts));\r\n                    break;\r\n                case 'verticalAxis':\r\n                    this.chartPanelFeature.addComponent(new CartesianAxisPanel('yAxis', opts));\r\n                    break;\r\n                case 'series':\r\n                    this.chartPanelFeature.addComponent(new SeriesPanel(opts));\r\n                    break;\r\n                default:\r\n                    _warn(147, { group });\r\n            }\r\n        });\r\n    }\r\n\r\n    private getFormatPanelDef() {\r\n        const userProvidedFormatPanelDef = this.gos.get('chartToolPanelsDef')?.formatPanel;\r\n        return userProvidedFormatPanelDef ? userProvidedFormatPanelDef : DefaultFormatPanelDef;\r\n    }\r\n\r\n    private isGroupPanelShownInSeries(group: ChartFormatPanelGroup, seriesType: ChartSeriesType): boolean {\r\n        return (\r\n            ['chart', 'titles', 'legend', 'series'].includes(group) ||\r\n            (isCartesian(seriesType) && ['axis', 'horizontalAxis', 'verticalAxis'].includes(group)) ||\r\n            (isPolar(seriesType) && group === 'axis')\r\n        );\r\n    }\r\n}\r\n", "import type { AgCartesianAxisOptions } from 'ag-charts-types';\r\n\r\nimport type { AgSelect, AgSelectParams, BeanCollection, ListOption } from 'ag-grid-community';\r\nimport {\r\n    AgCheckbox,\r\n    AgSelectSelector,\r\n    Component,\r\n    RefPlaceholder,\r\n    _removeFromParent,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent, AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgAngleSelect } from '../../../../widgets/agAngleSelect';\r\nimport type { AgColorPickerParams } from '../../../../widgets/agColorPicker';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport type { AgSliderParams } from '../../../../widgets/agSlider';\r\nimport { AgSlider, AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartOptionsProxy } from '../../../services/chartOptionsService';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\nimport type { FontPanelParams } from '../fontPanel';\r\nimport { FontPanel } from '../fontPanel';\r\nimport type { FormatPanelOptions } from '../formatPanel';\r\nimport { AxisTicksPanel } from './axisTicksPanel';\r\nimport { GridLinePanel } from './gridLinePanel';\r\n\r\nconst DEFAULT_TIME_AXIS_FORMAT = '%d %B %Y';\r\n\r\nexport class CartesianAxisPanel extends Component {\r\n    private readonly axisGroup: AgGroupComponent = RefPlaceholder;\r\n    private readonly axisTypeSelect: AgSelect = RefPlaceholder;\r\n    private readonly axisPositionSelect: AgSelect = RefPlaceholder;\r\n    private readonly axisTimeFormatSelect: AgSelect = RefPlaceholder;\r\n\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    private readonly chartOptionsSeriesProxy: ChartOptionsProxy;\r\n\r\n    private activePanels: Component[] = [];\r\n    private axisLabelUpdateFuncs: ((...args: any[]) => any)[] = [];\r\n\r\n    private prevRotation: number | undefined;\r\n\r\n    constructor(\r\n        private readonly axisType: 'xAxis' | 'yAxis',\r\n        private readonly options: FormatPanelOptions\r\n    ) {\r\n        super();\r\n\r\n        const { chartOptionsService, seriesType } = options;\r\n        this.chartOptionsSeriesProxy = chartOptionsService.getSeriesOptionsProxy(() => seriesType);\r\n    }\r\n\r\n    public postConstruct() {\r\n        const {\r\n            isExpandedOnInit: expanded,\r\n            chartOptionsService,\r\n            chartController,\r\n            registerGroupComponent,\r\n        } = this.options;\r\n        const labelKey: ChartTranslationKey = this.axisType;\r\n        const axisGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-top-level',\r\n            direction: 'vertical',\r\n            title: this.translate(labelKey),\r\n            expanded,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n\r\n        const chartAxisOptionsProxy = chartOptionsService.getCartesianAxisOptionsProxy(this.axisType);\r\n        const chartAxisOptions = this.createManagedBean(new ChartMenuParamsFactory(chartAxisOptionsProxy));\r\n        const chartAxisThemeOverrides = this.createManagedBean(\r\n            new ChartMenuParamsFactory(chartOptionsService.getCartesianAxisThemeOverridesProxy(this.axisType))\r\n        );\r\n\r\n        const axisTypeSelectParams = this.getAxisTypeSelectParams(\r\n            chartAxisOptions,\r\n            chartOptionsService.getCartesianAxisAppliedThemeOverridesProxy(this.axisType)\r\n        );\r\n        const axisPositionSelectParams = this.getAxisPositionSelectParams(chartAxisOptions);\r\n        const axisTimeFormatSelectParams = this.getAxisTimeFormatSelectParams(chartAxisOptions);\r\n        const axisColorInputParams = this.getAxisColorInputParams(chartAxisThemeOverrides);\r\n        const axisLineWidthSliderParams = this.getAxisLineWidthSliderParams(chartAxisThemeOverrides);\r\n\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"axisGroup\">\r\n                <ag-select data-ref=\"axisTypeSelect\"></ag-select>\r\n                <ag-select data-ref=\"axisTimeFormatSelect\"></ag-select>\r\n                <ag-select data-ref=\"axisPositionSelect\"></ag-select>\r\n                <ag-color-picker data-ref=\"axisColorInput\"></ag-color-picker>\r\n                <ag-slider data-ref=\"axisLineWidthSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgSelectSelector, AgColorPickerSelector, AgSliderSelector],\r\n            {\r\n                axisGroup: axisGroupParams,\r\n                axisTypeSelect: axisTypeSelectParams ?? undefined,\r\n                axisPositionSelect: axisPositionSelectParams ?? undefined,\r\n                axisTimeFormatSelect: axisTimeFormatSelectParams ?? undefined,\r\n                axisColorInput: axisColorInputParams,\r\n                axisLineWidthSlider: axisLineWidthSliderParams,\r\n            }\r\n        );\r\n        registerGroupComponent(this.axisGroup);\r\n\r\n        this.axisTypeSelect.setDisplayed(!!axisTypeSelectParams.options?.length);\r\n        if (!axisPositionSelectParams) this.removeTemplateComponent(this.axisPositionSelect);\r\n        const updateTimeFormatVisibility = () => {\r\n            const isTimeAxis = chartAxisOptionsProxy.getValue('type') === 'time';\r\n            _setDisplayed(this.axisTimeFormatSelect.getGui(), isTimeAxis);\r\n        };\r\n        if (!axisTimeFormatSelectParams) {\r\n            this.removeTemplateComponent(this.axisTimeFormatSelect);\r\n        } else {\r\n            // Conditionally hide the time format input based on the currently selected axis type\r\n            updateTimeFormatVisibility();\r\n            // Update the visibility whenever the axis type changes\r\n            this.addManagedEventListeners({\r\n                chartOptionsChanged: () => {\r\n                    updateTimeFormatVisibility();\r\n                },\r\n            });\r\n        }\r\n\r\n        this.initGridLines(chartAxisThemeOverrides);\r\n        this.initAxisTicks(chartAxisThemeOverrides);\r\n        this.initAxisLabels(chartAxisThemeOverrides);\r\n\r\n        const updateAxisLabelRotations = () => this.axisLabelUpdateFuncs.forEach((func) => func());\r\n        this.addManagedListeners(chartController, {\r\n            chartUpdated: updateAxisLabelRotations,\r\n            chartModelUpdate: () =>\r\n                setTimeout(() => {\r\n                    if (!this.isAlive()) {\r\n                        return;\r\n                    }\r\n                    // make sure this runs after the actual chart update has happened\r\n                    this.refreshAxisTypeSelect(chartAxisOptions);\r\n                    updateTimeFormatVisibility();\r\n                }),\r\n        });\r\n    }\r\n\r\n    private getAxisTypeSelectParams(\r\n        chartAxisOptions: ChartMenuParamsFactory,\r\n        chartAxisAppliedThemeOverrides: ChartOptionsProxy\r\n    ): AgSelectParams {\r\n        const chartOptions = chartAxisOptions.getChartOptions();\r\n        const axisTypeSelectOptions = this.getAxisTypeSelectOptions();\r\n        const params = chartAxisOptions.getDefaultSelectParams('type', 'axisType', axisTypeSelectOptions);\r\n        params.onValueChange = (value: AgCartesianAxisOptions['type']): void => {\r\n            const previousAxisType = chartOptions.getValue<AgCartesianAxisOptions['type']>('type');\r\n            if (value === previousAxisType) return;\r\n            // If the axis type is changed, we need to carry over all the accumulated theme overrides\r\n            // that have been applied to the existing axis type so far\r\n            const previousAxisThemeOverrides = chartAxisAppliedThemeOverrides.getValue<AgCartesianAxisOptions>('*');\r\n            // Optionally update the axis label format when switching between time and non-time axes\r\n            const previousAxisIsTimeAxis = previousAxisType === 'time';\r\n            const updatedAxisIsTimeAxis = value === 'time';\r\n            const updatedLabelFormat =\r\n                previousAxisIsTimeAxis !== updatedAxisIsTimeAxis\r\n                    ? updatedAxisIsTimeAxis\r\n                        ? DEFAULT_TIME_AXIS_FORMAT\r\n                        : undefined\r\n                    : null;\r\n            // Update the axis type (and label format if necessary)\r\n            this.options.chartOptionsService.setCartesianCategoryAxisType(this.axisType, value);\r\n            if (updatedLabelFormat !== null) {\r\n                const existingLabel = chartOptions.getValue<AgCartesianAxisOptions['label']>('label') ?? {};\r\n                chartOptions.setValue<AgCartesianAxisOptions['label']>('label', {\r\n                    ...existingLabel,\r\n                    format: updatedLabelFormat,\r\n                });\r\n            }\r\n            // Reapply the previous theme overrides to the new axis type\r\n            chartAxisAppliedThemeOverrides.setValue<AgCartesianAxisOptions>('*', previousAxisThemeOverrides);\r\n        };\r\n        return params;\r\n    }\r\n\r\n    private refreshAxisTypeSelect(chartAxisOptions: ChartMenuParamsFactory): void {\r\n        const options = this.getAxisTypeSelectOptions();\r\n        const hasOptions = !!options.length;\r\n        this.axisTypeSelect.setDisplayed(hasOptions);\r\n\r\n        if (!hasOptions) {\r\n            return;\r\n        }\r\n\r\n        this.axisTypeSelect\r\n            .clearOptions()\r\n            .addOptions(options)\r\n            .setValue(chartAxisOptions.getChartOptions().getValue('type'));\r\n    }\r\n\r\n    private getAxisTypeSelectOptions(): ListOption[] {\r\n        const { chartController } = this.options;\r\n        const chartType = chartController.getChartType();\r\n        const supportsNumericalAxis = () => {\r\n            const testDatum = chartController.getChartData()[0];\r\n            if (!testDatum) {\r\n                return false;\r\n            }\r\n            return chartController.getSelectedDimensions().every((col) => !isNaN(parseFloat(testDatum[col.colId])));\r\n        };\r\n        if (\r\n            ['heatmap', 'histogram', 'boxPlot', 'rangeBar', 'scatter', 'bubble'].includes(chartType) ||\r\n            chartController.isGrouping() ||\r\n            !this.isCategoryAxis() ||\r\n            chartController.isCategorySeriesSwitched() ||\r\n            !supportsNumericalAxis()\r\n        ) {\r\n            return [];\r\n        }\r\n\r\n        return ['category', 'number', 'time'].map((value: 'category' | 'number' | 'time') => ({\r\n            value,\r\n            text: this.translate(value),\r\n        }));\r\n    }\r\n\r\n    private isCategoryAxis(): boolean {\r\n        const isHorizontal = this.chartOptionsSeriesProxy.getValue('direction') === 'horizontal';\r\n        return (isHorizontal && this.axisType === 'yAxis') || (!isHorizontal && this.axisType === 'xAxis');\r\n    }\r\n\r\n    private getAxisPositionSelectParams(chartAxisOptions: ChartMenuParamsFactory): AgSelectParams | null {\r\n        const axisPositionSelectOptions = ((chartType, axisType) => {\r\n            switch (chartType) {\r\n                // Some chart types do not support configuring the axis position\r\n                case 'heatmap':\r\n                    return null;\r\n                default:\r\n                    switch (axisType) {\r\n                        // Horizontal axis position can be changed between top and bottom\r\n                        case 'xAxis':\r\n                            return [\r\n                                { value: 'top', text: this.translate('top') },\r\n                                { value: 'bottom', text: this.translate('bottom') },\r\n                            ];\r\n                        // Vertical axis position can be changed between left and right\r\n                        case 'yAxis':\r\n                            return [\r\n                                { value: 'left', text: this.translate('left') },\r\n                                { value: 'right', text: this.translate('right') },\r\n                            ];\r\n                    }\r\n            }\r\n        })(this.options.chartController.getChartType(), this.axisType);\r\n        if (!axisPositionSelectOptions) return null;\r\n        return chartAxisOptions.getDefaultSelectParams('position', 'position', axisPositionSelectOptions);\r\n    }\r\n\r\n    private getAxisTimeFormatSelectParams(chartAxisOptions: ChartMenuParamsFactory): AgSelectParams | null {\r\n        if (!this.isCategoryAxis()) {\r\n            return null;\r\n        }\r\n\r\n        const axisTimeFormatSelectOptions = [\r\n            { value: '%d/%m/%Y', text: this.translate('timeFormatSlashesDDMMYYYY') },\r\n            { value: '%m/%d/%Y', text: this.translate('timeFormatSlashesMMDDYYYY') },\r\n            { value: '%d/%m/%y', text: this.translate('timeFormatSlashesDDMMYY') },\r\n            { value: '%m/%d/%y', text: this.translate('timeFormatSlashesMMDDYY') },\r\n            { value: '%d.%e.%y', text: this.translate('timeFormatDotsDDMYY') },\r\n            { value: '%e.%d.%y', text: this.translate('timeFormatDotsMDDYY') },\r\n            { value: '%Y-%m-%d', text: this.translate('timeFormatDashesYYYYMMDD') },\r\n            { value: '%d %B %Y', text: this.translate('timeFormatSpacesDDMMMMYYYY') },\r\n            { value: '%H:%M:%S', text: this.translate('timeFormatHHMMSS') },\r\n            { value: '%I:%M:%S %p', text: this.translate('timeFormatHHMMSSAmPm') },\r\n        ];\r\n\r\n        return chartAxisOptions.getDefaultSelectParams('label.format', 'timeFormat', axisTimeFormatSelectOptions);\r\n    }\r\n\r\n    private getAxisColorInputParams(chartAxisThemeOverrides: ChartMenuParamsFactory): AgColorPickerParams {\r\n        return chartAxisThemeOverrides.getDefaultColorPickerParams('line.stroke');\r\n    }\r\n\r\n    private getAxisLineWidthSliderParams(chartAxisThemeOverrides: ChartMenuParamsFactory): AgSliderParams {\r\n        const chartOptions = chartAxisThemeOverrides.getChartOptions();\r\n        // Note that there is no separate checkbox for enabling/disabling the axis line. Whenever the line width is\r\n        // changed, the value for `line.enabled` is inferred based on the whether the `line.width` value is non-zero.\r\n        const getAxisLineWidth = (): number | null => {\r\n            const isAxisLineEnabled = chartOptions.getValue<boolean>('line.enabled');\r\n            if (!isAxisLineEnabled) return null;\r\n            return chartOptions.getValue<number>('line.width');\r\n        };\r\n        const setAxisLineWidth = (value: number | null): void => {\r\n            chartOptions.setValues<number | boolean>([\r\n                { expression: 'line.enabled', value: value != null },\r\n                { expression: 'line.width', value: value ?? 0 },\r\n            ]);\r\n        };\r\n        const axisLineWidthSliderParams = chartAxisThemeOverrides.getDefaultSliderParamsWithoutValueParams(\r\n            getAxisLineWidth() ?? 0,\r\n            'thickness',\r\n            10\r\n        );\r\n        axisLineWidthSliderParams.onValueChange = (newValue) => {\r\n            setAxisLineWidth(newValue === 0 ? null : newValue);\r\n        };\r\n        return axisLineWidthSliderParams;\r\n    }\r\n\r\n    private initGridLines(chartAxisThemeOverrides: ChartMenuParamsFactory) {\r\n        const chartType = this.options.chartController.getChartType();\r\n\r\n        // Some chart types do not support configuring grid lines\r\n        if (chartType === 'heatmap') {\r\n            return;\r\n        }\r\n\r\n        const gridLineComp = this.createBean(new GridLinePanel(chartAxisThemeOverrides));\r\n        this.axisGroup.addItem(gridLineComp);\r\n        this.activePanels.push(gridLineComp);\r\n    }\r\n\r\n    private initAxisTicks(chartAxisThemeOverrides: ChartMenuParamsFactory) {\r\n        if (!this.hasConfigurableAxisTicks()) return;\r\n        const axisTicksComp = this.createBean(new AxisTicksPanel(chartAxisThemeOverrides));\r\n        this.axisGroup.addItem(axisTicksComp);\r\n        this.activePanels.push(axisTicksComp);\r\n    }\r\n\r\n    private hasConfigurableAxisTicks(): boolean {\r\n        // Axis ticks are disabled for some chart types\r\n        const chartType = this.options.chartController.getChartType();\r\n        switch (chartType) {\r\n            case 'radarLine':\r\n            case 'radarArea':\r\n            case 'rangeBar':\r\n            case 'boxPlot':\r\n            case 'waterfall':\r\n                return false;\r\n            default:\r\n                return true;\r\n        }\r\n    }\r\n\r\n    private initAxisLabels(chartAxisThemeOverrides: ChartMenuParamsFactory) {\r\n        const params: FontPanelParams = {\r\n            name: this.translate('labels'),\r\n            enabled: true,\r\n            suppressEnabledCheckbox: true,\r\n            chartMenuParamsFactory: chartAxisThemeOverrides,\r\n            keyMapper: (key) => `label.${key}`,\r\n        };\r\n\r\n        const labelPanelComp = this.createBean(new FontPanel(params));\r\n        this.axisGroup.addItem(labelPanelComp);\r\n        this.activePanels.push(labelPanelComp);\r\n\r\n        this.addAdditionalLabelComps(labelPanelComp, chartAxisThemeOverrides);\r\n    }\r\n\r\n    private addAdditionalLabelComps(labelPanelComp: FontPanel, chartAxisThemeOverrides: ChartMenuParamsFactory) {\r\n        this.addLabelPadding(labelPanelComp, chartAxisThemeOverrides);\r\n\r\n        const rotationComp = this.createRotationWidget('labelRotation', chartAxisThemeOverrides);\r\n        const autoRotateCb = this.initLabelRotation(rotationComp, chartAxisThemeOverrides);\r\n\r\n        labelPanelComp.addItem(autoRotateCb);\r\n        labelPanelComp.addItem(rotationComp);\r\n    }\r\n\r\n    private initLabelRotation(rotationComp: AgAngleSelect, chartAxisThemeOverrides: ChartMenuParamsFactory) {\r\n        const chartOptions = chartAxisThemeOverrides.getChartOptions();\r\n\r\n        const getLabelRotationValue = (): number | undefined => {\r\n            return chartOptions.getValue<number | undefined>('label.rotation');\r\n        };\r\n        const getLabelAutoRotateValue = (): boolean => {\r\n            return chartOptions.getValue<boolean>('label.autoRotate');\r\n        };\r\n\r\n        const updateAutoRotate = (autoRotate: boolean) => {\r\n            // Remember the existing rotation before we clear it from the options\r\n            if (autoRotate) this.prevRotation = getLabelRotationValue();\r\n\r\n            // For the autoRotate option to take effect, we need to additionally clear the rotation option value\r\n            chartOptions.setValues<boolean | number | undefined>([\r\n                { expression: 'label.autoRotate', value: autoRotate },\r\n                // Clear the rotation option when activating auto-rotate, reinstate the previous value when deactivating\r\n                { expression: 'label.rotation', value: autoRotate ? undefined : this.prevRotation },\r\n            ]);\r\n\r\n            rotationComp.setDisplayed(!autoRotate);\r\n        };\r\n\r\n        const rotation = getLabelRotationValue();\r\n        const autoRotate = typeof rotation === 'number' ? false : getLabelAutoRotateValue();\r\n\r\n        const autoRotateCheckbox = this.createBean(\r\n            new AgCheckbox({\r\n                label: this.translate('autoRotate'),\r\n                value: autoRotate,\r\n                onValueChange: updateAutoRotate,\r\n            })\r\n        );\r\n\r\n        // init rotation comp state\r\n        rotationComp.setDisplayed(!autoRotate);\r\n\r\n        return autoRotateCheckbox;\r\n    }\r\n\r\n    private createRotationWidget(labelKey: ChartTranslationKey, chartAxisThemeOverrides: ChartMenuParamsFactory) {\r\n        const chartOptions = chartAxisThemeOverrides.getChartOptions();\r\n\r\n        const getLabelRotationValue = (): number | undefined => {\r\n            return chartOptions.getValue<number | undefined>('label.rotation');\r\n        };\r\n        const setLabelRotationValue = (value: number | undefined): void => {\r\n            return chartOptions.setValue<number | undefined>('label.rotation', value);\r\n        };\r\n\r\n        const degreesSymbol = String.fromCharCode(176);\r\n\r\n        const label = `${this.chartTranslation.translate(labelKey)} ${degreesSymbol}`;\r\n        const angleSelect = new AgAngleSelect({\r\n            label,\r\n            labelWidth: 'flex',\r\n            value: getLabelRotationValue() ?? 0,\r\n            onValueChange: setLabelRotationValue,\r\n        });\r\n\r\n        // the axis label rotation needs to be updated when the default category changes in the data panel\r\n        this.axisLabelUpdateFuncs.push(() => {\r\n            angleSelect.setValue(getLabelRotationValue() ?? 0);\r\n        });\r\n\r\n        return this.createBean(angleSelect);\r\n    }\r\n\r\n    private addLabelPadding(labelPanelComp: FontPanel, chartAxisThemeOverrides: ChartMenuParamsFactory) {\r\n        const labelPaddingSlider = this.createBean(\r\n            new AgSlider(chartAxisThemeOverrides.getDefaultSliderParams('label.spacing', 'padding', 30))\r\n        );\r\n\r\n        labelPanelComp.addItem(labelPaddingSlider);\r\n    }\r\n\r\n    private translate(key: ChartTranslationKey) {\r\n        return this.chartTranslation.translate(key);\r\n    }\r\n\r\n    private removeTemplateComponent(component: Component<any>): void {\r\n        _removeFromParent(component.getGui());\r\n        this.destroyBean(component);\r\n    }\r\n\r\n    private destroyActivePanels(): void {\r\n        this.activePanels.forEach((panel) => {\r\n            _removeFromParent(panel.getGui());\r\n            this.destroyBean(panel);\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyActivePanels();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type {\r\n    AgInputNumberField,\r\n    AgLabelParams,\r\n    BeanCollection,\r\n    DragListenerParams,\r\n    DragService,\r\n} from 'ag-grid-community';\r\nimport {\r\n    AgAbstractLabel,\r\n    AgInputNumberFieldSelector,\r\n    RefPlaceholder,\r\n    _exists,\r\n    _getActiveDomElement,\r\n    _setFixedWidth,\r\n} from 'ag-grid-community';\r\n\r\nexport interface AgAngleSelectParams extends AgLabelParams {\r\n    value?: number;\r\n    onValueChange?: (value: number) => void;\r\n}\r\n\r\nexport type AgAngleSelectEvent = 'fieldValueChanged';\r\nexport class AgAngleSelect extends AgAbstractLabel<AgAngleSelectParams, AgAngleSelectEvent> {\r\n    protected dragSvc?: DragService;\r\n\r\n    public wireBeans(beans: BeanCollection) {\r\n        this.dragSvc = beans.dragSvc;\r\n    }\r\n\r\n    protected readonly eLabel: HTMLElement = RefPlaceholder;\r\n    private readonly eParentCircle: HTMLElement = RefPlaceholder;\r\n    private readonly eChildCircle: HTMLElement = RefPlaceholder;\r\n    private readonly eAngleValue: AgInputNumberField = RefPlaceholder;\r\n\r\n    private parentCircleRect: ClientRect | DOMRect;\r\n    private degrees: number;\r\n    private radius: number = 0;\r\n    private offsetX: number = 0;\r\n    private offsetY: number = 0;\r\n    private dragListener: DragListenerParams;\r\n\r\n    constructor(config?: AgAngleSelectParams) {\r\n        super(\r\n            config,\r\n            /* html */ `<div class=\"ag-angle-select\">\r\n            <div data-ref=\"eLabel\"></div>\r\n            <div class=\"ag-wrapper ag-angle-select-wrapper\">\r\n                <div class=\"ag-angle-select-field\">\r\n                    <div data-ref=\"eParentCircle\" class=\"ag-angle-select-parent-circle\">\r\n                        <div data-ref=\"eChildCircle\" class=\"ag-angle-select-child-circle\"></div>\r\n                    </div>\r\n                </div>\r\n                <ag-input-number-field data-ref=\"eAngleValue\"></ag-input-number-field>\r\n            </div>\r\n        </div>`,\r\n            [AgInputNumberFieldSelector]\r\n        );\r\n    }\r\n\r\n    public override postConstruct() {\r\n        super.postConstruct();\r\n\r\n        const { value, onValueChange } = this.config;\r\n\r\n        if (value != null) {\r\n            this.setValue(value, undefined, true);\r\n        }\r\n        if (onValueChange != null) {\r\n            this.onValueChange(onValueChange);\r\n        }\r\n\r\n        this.dragListener = {\r\n            eElement: this.eParentCircle,\r\n            dragStartPixels: 0,\r\n            onDragStart: () => {\r\n                this.parentCircleRect = this.eParentCircle.getBoundingClientRect();\r\n            },\r\n            onDragging: (e: MouseEvent | Touch) => this.calculateAngleDrag(e),\r\n            onDragStop: () => {},\r\n        };\r\n\r\n        this.dragSvc?.addDragSource(this.dragListener);\r\n\r\n        this.eAngleValue\r\n            .setLabel('')\r\n            .setLabelWidth(5)\r\n            .setInputWidth(45)\r\n            .setMin(0)\r\n            .setMax(360)\r\n            .setValue(`${this.degrees}`)\r\n            .onValueChange((value: string) => {\r\n                if (value == null || value === '') {\r\n                    value = '0';\r\n                }\r\n                value = this.eAngleValue.normalizeValue(value);\r\n                let floatValue = parseFloat(value);\r\n                if (floatValue > 180) {\r\n                    floatValue = floatValue - 360;\r\n                }\r\n                this.setValue(floatValue);\r\n            });\r\n\r\n        this.updateNumberInput();\r\n\r\n        if (_exists(this.getValue())) {\r\n            this.eAngleValue.setValue(this.normalizeNegativeValue(this.getValue()).toString());\r\n        }\r\n\r\n        this.addManagedListeners(this, {\r\n            fieldValueChanged: () => {\r\n                if (this.eAngleValue.getInputElement().contains(_getActiveDomElement(this.beans))) {\r\n                    return;\r\n                }\r\n                this.updateNumberInput();\r\n            },\r\n        });\r\n    }\r\n\r\n    private updateNumberInput(): void {\r\n        const normalizedValue = this.normalizeNegativeValue(this.getValue());\r\n        this.eAngleValue.setValue(normalizedValue.toString());\r\n    }\r\n\r\n    private positionChildCircle(radians: number) {\r\n        const rect = this.parentCircleRect || { width: 24, height: 24 };\r\n        const eChildCircle = this.eChildCircle;\r\n\r\n        const centerX = rect.width / 2;\r\n        const centerY = rect.height / 2;\r\n\r\n        eChildCircle.style.left = `${centerX + Math.cos(radians) * 8}px`;\r\n        eChildCircle.style.top = `${centerY + Math.sin(radians) * 8}px`;\r\n    }\r\n\r\n    private calculatePolar() {\r\n        const x = this.offsetX;\r\n        const y = this.offsetY;\r\n\r\n        const radians = Math.atan2(y, x);\r\n        this.degrees = this.toDegrees(radians);\r\n        this.radius = Math.sqrt(x * x + y * y);\r\n\r\n        this.positionChildCircle(radians);\r\n    }\r\n\r\n    private calculateCartesian() {\r\n        const radians = this.toRadians(this.getValue());\r\n        const radius = this.getRadius();\r\n\r\n        this.setOffsetX(Math.cos(radians) * radius).setOffsetY(Math.sin(radians) * radius);\r\n    }\r\n\r\n    private setOffsetX(offset: number): this {\r\n        if (this.offsetX !== offset) {\r\n            this.offsetX = offset;\r\n            this.calculatePolar();\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    private setOffsetY(offset: number): this {\r\n        if (this.offsetY !== offset) {\r\n            this.offsetY = offset;\r\n            this.calculatePolar();\r\n        }\r\n        return this;\r\n    }\r\n\r\n    private calculateAngleDrag(e: MouseEvent | Touch) {\r\n        const rect = this.parentCircleRect;\r\n        const centerX = rect.width / 2;\r\n        const centerY = rect.height / 2;\r\n\r\n        const x = e.clientX - rect.left;\r\n        const y = e.clientY - rect.top;\r\n\r\n        const dx = x - centerX;\r\n        const dy = y - centerY;\r\n\r\n        const radians = Math.atan2(dy, dx);\r\n\r\n        this.setValue(radians, true);\r\n    }\r\n\r\n    private toDegrees(radians: number): number {\r\n        return (radians / Math.PI) * 180;\r\n    }\r\n\r\n    private toRadians(degrees: number): number {\r\n        return (degrees / 180) * Math.PI;\r\n    }\r\n\r\n    private normalizeNegativeValue(degrees: number): number {\r\n        return degrees < 0 ? 360 + degrees : degrees;\r\n    }\r\n\r\n    private normalizeAngle180(radians: number): number {\r\n        radians %= Math.PI * 2;\r\n\r\n        if (radians < -Math.PI) {\r\n            radians += Math.PI * 2;\r\n        } else if (radians >= Math.PI) {\r\n            radians -= Math.PI * 2;\r\n        }\r\n\r\n        return radians;\r\n    }\r\n\r\n    public getRadius(): number {\r\n        return this.radius;\r\n    }\r\n\r\n    public setRadius(r: number): this {\r\n        if (this.radius === r) {\r\n            return this;\r\n        }\r\n        this.radius = r;\r\n        this.calculateCartesian();\r\n\r\n        return this;\r\n    }\r\n\r\n    public onValueChange(callbackFn: (newValue: number) => void): this {\r\n        this.addManagedListeners(this, {\r\n            fieldValueChanged: () => {\r\n                callbackFn(this.degrees);\r\n            },\r\n        });\r\n        return this;\r\n    }\r\n\r\n    public getValue(radians?: boolean): number {\r\n        return radians ? this.toRadians(this.degrees) : this.degrees;\r\n    }\r\n\r\n    public setValue(degrees: number, radians?: boolean, silent?: boolean): this {\r\n        let radiansValue: number;\r\n        if (!radians) {\r\n            radiansValue = this.normalizeAngle180(this.toRadians(degrees));\r\n        } else {\r\n            radiansValue = degrees;\r\n        }\r\n\r\n        degrees = this.toDegrees(radiansValue);\r\n\r\n        if (this.degrees !== degrees) {\r\n            this.degrees = Math.floor(degrees);\r\n            this.calculateCartesian();\r\n            this.positionChildCircle(radiansValue);\r\n            if (!silent) {\r\n                this.dispatchLocalEvent({ type: 'fieldValueChanged' });\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public setWidth(width: number): this {\r\n        _setFixedWidth(this.getGui(), width);\r\n        return this;\r\n    }\r\n\r\n    public override setDisabled(disabled: boolean): this {\r\n        super.setDisabled(disabled);\r\n\r\n        this.eAngleValue.setDisabled(disabled);\r\n\r\n        return this;\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.dragSvc?.removeDragSource(this.dragListener);\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { AgSelectParams, BeanCollection } from 'ag-grid-community';\r\nimport { AgSelectSelector, Component, RefPlaceholder, _removeFromParent } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent, AgGroupComponentParams } from '../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../widgets/agGroupComponent';\r\nimport { AgColorPickerSelector } from '../../../widgets/agColorPicker';\r\nimport type { ChartOptionsProxy } from '../../services/chartOptionsService';\r\nimport type { ChartTranslationService } from '../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../chartMenuParamsFactory';\r\n\r\ninterface Font {\r\n    fontFamily?: string;\r\n    fontStyle?: string;\r\n    fontWeight?: string;\r\n    fontSize?: number;\r\n    color?: string;\r\n}\r\n\r\nexport interface FontPanelParams {\r\n    name?: string;\r\n    enabled: boolean;\r\n    suppressEnabledCheckbox?: boolean;\r\n    onEnableChange?: (enabled: boolean) => void;\r\n    chartMenuParamsFactory: ChartMenuParamsFactory;\r\n    keyMapper: (key: string) => string;\r\n    cssIdentifier?: string;\r\n}\r\n\r\nfunction _capitalise(str: string): string {\r\n    return str[0].toUpperCase() + str.substring(1).toLowerCase();\r\n}\r\n\r\nexport class FontPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    private readonly fontGroup: AgGroupComponent = RefPlaceholder;\r\n\r\n    private readonly chartOptions: ChartOptionsProxy;\r\n    private activeComps: Component[] = [];\r\n\r\n    constructor(private readonly params: FontPanelParams) {\r\n        super();\r\n        this.chartOptions = params.chartMenuParamsFactory.getChartOptions();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const {\r\n            cssIdentifier = 'charts-format-sub-level',\r\n            name: title,\r\n            enabled,\r\n            onEnableChange,\r\n            suppressEnabledCheckbox,\r\n            chartMenuParamsFactory,\r\n            keyMapper,\r\n        } = this.params;\r\n        const fontGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier,\r\n            direction: 'vertical',\r\n            suppressOpenCloseIcons: true,\r\n            title,\r\n            enabled,\r\n            suppressEnabledCheckbox: true,\r\n            onEnableChange: (enabled) => {\r\n                if (onEnableChange) {\r\n                    onEnableChange(enabled);\r\n                }\r\n            },\r\n            useToggle: !suppressEnabledCheckbox,\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div class=\"ag-font-panel\">\r\n        <ag-group-component data-ref=\"fontGroup\">\r\n            <ag-select data-ref=\"familySelect\"></ag-select>\r\n            <ag-select data-ref=\"weightStyleSelect\"></ag-select>\r\n            <div class=\"ag-charts-font-size-color\">\r\n                <ag-select data-ref=\"sizeSelect\"></ag-select>\r\n                <ag-color-picker data-ref=\"colorPicker\"></ag-color-picker>\r\n            </div>\r\n        </ag-group-component>\r\n    </div>`,\r\n            [AgGroupComponentSelector, AgSelectSelector, AgColorPickerSelector],\r\n            {\r\n                fontGroup: fontGroupParams,\r\n                familySelect: this.getFamilySelectParams(),\r\n                weightStyleSelect: this.getWeightStyleSelectParams(),\r\n                sizeSelect: this.getSizeSelectParams(),\r\n                colorPicker: chartMenuParamsFactory.getDefaultColorPickerParams(keyMapper('color')),\r\n            }\r\n        );\r\n        this.addOrRemoveCssClass('ag-font-panel-no-header', !title);\r\n    }\r\n\r\n    public addItem(comp: Component<any>, prepend?: boolean) {\r\n        if (prepend) {\r\n            this.fontGroup.prependItem(comp);\r\n        } else {\r\n            this.fontGroup.addItem(comp);\r\n        }\r\n        this.activeComps.push(comp);\r\n    }\r\n\r\n    public setEnabled(enabled: boolean): void {\r\n        this.fontGroup.setEnabled(enabled);\r\n    }\r\n\r\n    private getFamilySelectParams(): AgSelectParams {\r\n        const families = [\r\n            'Arial, sans-serif',\r\n            'Aria Black, sans-serif',\r\n            'Book Antiqua,  serif',\r\n            'Charcoal, sans-serif',\r\n            'Comic Sans MS, cursive',\r\n            'Courier, monospace',\r\n            'Courier New, monospace',\r\n            'Gadget, sans-serif',\r\n            'Geneva, sans-serif',\r\n            'Helvetica, sans-serif',\r\n            'Impact, sans-serif',\r\n            'Lucida Console, monospace',\r\n            'Lucida Grande, sans-serif',\r\n            'Lucida Sans Unicode,  sans-serif',\r\n            'Monaco, monospace',\r\n            'Palatino Linotype, serif',\r\n            'Palatino, serif',\r\n            'Times New Roman, serif',\r\n            'Times, serif',\r\n            'Verdana, sans-serif',\r\n        ];\r\n\r\n        const family = this.getInitialFontValue('fontFamily');\r\n        let initialValue = families[0];\r\n\r\n        if (family) {\r\n            // check for known values using lowercase\r\n            const lowerCaseValues = families.map((f) => f.toLowerCase());\r\n            const valueIndex = lowerCaseValues.indexOf(family.toLowerCase());\r\n\r\n            if (valueIndex >= 0) {\r\n                initialValue = families[valueIndex];\r\n            } else {\r\n                // add user provided value to list\r\n                const capitalisedFontValue = _capitalise(family);\r\n\r\n                families.push(capitalisedFontValue);\r\n\r\n                initialValue = capitalisedFontValue;\r\n            }\r\n        }\r\n\r\n        const options = families.sort().map((value) => ({ value, text: value }));\r\n\r\n        return this.params.chartMenuParamsFactory.getDefaultSelectParamsWithoutValueParams(\r\n            'font',\r\n            options,\r\n            `${initialValue}`,\r\n            (newValue) => this.setFont({ fontFamily: newValue! })\r\n        );\r\n    }\r\n\r\n    private getSizeSelectParams(): AgSelectParams {\r\n        const sizes = [8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36];\r\n        const size = this.getInitialFontValue('fontSize');\r\n\r\n        if (!sizes.includes(size!)) {\r\n            sizes.push(size!);\r\n        }\r\n\r\n        const options = sizes.sort((a, b) => a - b).map((value) => ({ value: `${value}`, text: `${value}` }));\r\n\r\n        return this.params.chartMenuParamsFactory.getDefaultSelectParamsWithoutValueParams(\r\n            'size',\r\n            options,\r\n            `${size}`,\r\n            (newValue) => this.setFont({ fontSize: parseInt(newValue!, 10) })\r\n        );\r\n    }\r\n\r\n    private getWeightStyleSelectParams(): AgSelectParams {\r\n        const weight = this.getInitialFontValue('fontWeight') ?? 'normal';\r\n        const style = this.getInitialFontValue('fontStyle') ?? 'normal';\r\n\r\n        const weightStyles: {\r\n            name: 'normal' | 'bold' | 'italic' | 'boldItalic' | 'predefined';\r\n            weight: string;\r\n            style: string;\r\n        }[] = [\r\n            { name: 'normal', weight: 'normal', style: 'normal' },\r\n            { name: 'bold', weight: 'bold', style: 'normal' },\r\n            { name: 'italic', weight: 'normal', style: 'italic' },\r\n            { name: 'boldItalic', weight: 'bold', style: 'italic' },\r\n        ];\r\n\r\n        let selectedOption = weightStyles.find((x) => x.weight === weight && x.style === style);\r\n\r\n        if (!selectedOption) {\r\n            selectedOption = { name: 'predefined', weight, style };\r\n            weightStyles.unshift(selectedOption);\r\n        }\r\n\r\n        const options = weightStyles.map((ws) => ({\r\n            value: ws.name,\r\n            text: this.chartTranslation.translate(ws.name),\r\n        }));\r\n\r\n        return this.params.chartMenuParamsFactory.getDefaultSelectParamsWithoutValueParams(\r\n            'weight',\r\n            options,\r\n            selectedOption.name,\r\n            (newValue) => {\r\n                const selectedWeightStyle = weightStyles.find((x) => x.name === newValue);\r\n\r\n                this.setFont({ fontWeight: selectedWeightStyle!.weight, fontStyle: selectedWeightStyle!.style });\r\n            }\r\n        );\r\n    }\r\n\r\n    private destroyActiveComps(): void {\r\n        this.activeComps.forEach((comp) => {\r\n            _removeFromParent(comp.getGui());\r\n            this.destroyBean(comp);\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyActiveComps();\r\n        super.destroy();\r\n    }\r\n\r\n    private setFont(font: Font): void {\r\n        const { keyMapper } = this.params;\r\n        Object.entries(font).forEach(([fontKey, value]: [keyof Font, any]) => {\r\n            if (value) {\r\n                this.chartOptions.setValue(keyMapper(fontKey), value);\r\n            }\r\n        });\r\n    }\r\n\r\n    private getInitialFontValue<K extends keyof Font>(fontKey: K): Font[K] {\r\n        const { keyMapper } = this.params;\r\n        return this.chartOptions.getValue(keyMapper(fontKey));\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class AxisTicksPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const { chartMenuUtils } = this;\r\n        const axisTicksGroupParams = chartMenuUtils.addEnableParams<AgGroupComponentParams>('tick.enabled', {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            suppressOpenCloseIcons: true,\r\n            title: this.chartTranslation.translate('ticks'),\r\n            suppressEnabledCheckbox: true,\r\n            useToggle: true,\r\n        });\r\n        const axisTicksColorPickerParams = chartMenuUtils.getDefaultColorPickerParams('tick.stroke');\r\n        const axisTicksWidthSliderParams = chartMenuUtils.getDefaultSliderParams('tick.width', 'width', 10);\r\n        const axisTicksSizeSliderParams = chartMenuUtils.getDefaultSliderParams('tick.size', 'length', 30);\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"axisTicksGroup\">\r\n                <ag-color-picker data-ref=\"axisTicksColorPicker\"></ag-color-picker>\r\n                <ag-slider data-ref=\"axisTicksWidthSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"axisTicksSizeSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgColorPickerSelector, AgSliderSelector],\r\n            {\r\n                axisTicksGroup: axisTicksGroupParams,\r\n                axisTicksColorPicker: axisTicksColorPickerParams,\r\n                axisTicksWidthSlider: axisTicksWidthSliderParams,\r\n                axisTicksSizeSlider: axisTicksSizeSliderParams,\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { AgAxisGridLineOptions } from 'ag-charts-types';\r\n\r\nimport type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { AgColorPickerParams } from '../../../../widgets/agColorPicker';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport type { AgSliderParams } from '../../../../widgets/agSlider';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartOptionsProxy } from '../../../services/chartOptionsService';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class GridLinePanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    private readonly chartOptions: ChartOptionsProxy;\r\n\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n        this.chartOptions = chartMenuUtils.getChartOptions();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const gridLineGroupParams = this.chartMenuUtils.addEnableParams<AgGroupComponentParams>('gridLine.enabled', {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            suppressOpenCloseIcons: true,\r\n            title: this.chartTranslation.translate('gridLines'),\r\n            suppressEnabledCheckbox: true,\r\n            useToggle: true,\r\n        });\r\n        const gridLineColorPickerParams = this.getGridLineColorPickerParams('color');\r\n        const gridLineWidthSliderParams = this.getGridLineWidthSliderParams('thickness');\r\n        const gridLineLineDashSliderParams = this.getGridLineDashSliderParams('lineDash');\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"gridLineGroup\">\r\n                <ag-color-picker data-ref=\"gridLineColorPicker\"></ag-color-picker>\r\n                <ag-slider data-ref=\"gridLineWidthSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"gridLineLineDashSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgColorPickerSelector, AgSliderSelector],\r\n            {\r\n                gridLineGroup: gridLineGroupParams,\r\n                gridLineColorPicker: gridLineColorPickerParams,\r\n                gridLineWidthSlider: gridLineWidthSliderParams,\r\n                gridLineLineDashSlider: gridLineLineDashSliderParams,\r\n            }\r\n        );\r\n    }\r\n\r\n    private getGridLineColorPickerParams(labelKey: ChartTranslationKey): AgColorPickerParams {\r\n        return this.chartMenuUtils.getDefaultColorPickerParams('gridLine.style', labelKey, {\r\n            formatInputValue: (value: AgAxisGridLineOptions['style']) => {\r\n                return value?.[0]?.stroke;\r\n            },\r\n            parseInputValue: (value: string) => {\r\n                const styles = this.chartOptions.getValue<AgAxisGridLineOptions['style']>('gridLine.style') ?? [];\r\n                if (styles.length === 0) return [{ stroke: value, lineDash: [] }];\r\n                return [{ ...styles[0], stroke: value }];\r\n            },\r\n        });\r\n    }\r\n\r\n    private getGridLineWidthSliderParams(labelKey: ChartTranslationKey) {\r\n        return this.chartMenuUtils.getDefaultSliderParams('gridLine.width', labelKey, 10);\r\n    }\r\n\r\n    private getGridLineDashSliderParams(labelKey: ChartTranslationKey): AgSliderParams {\r\n        const initialStyles = this.chartOptions.getValue<AgAxisGridLineOptions['style']>('gridLine.style');\r\n        const initialValue = initialStyles?.[0]?.lineDash?.[0];\r\n        const params = this.chartMenuUtils.getDefaultSliderParamsWithoutValueParams(initialValue ?? 0, labelKey, 30);\r\n        params.onValueChange = (value: number): void => {\r\n            const stroke = this.chartOptions.getValue('gridLine.style.0.stroke');\r\n            this.chartOptions.setValue<AgAxisGridLineOptions['style']>('gridLine.style', [\r\n                { lineDash: [value], stroke },\r\n            ]);\r\n        };\r\n        return params;\r\n    }\r\n}\r\n", "import type { BeanCollection, ListOption } from 'ag-grid-community';\r\nimport { AgSelect, Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponent, AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport { AgSlider, AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport { getSeriesType, isRadial } from '../../../utils/seriesTypeMapper';\r\nimport type { FontPanelParams } from '../fontPanel';\r\nimport { FontPanel } from '../fontPanel';\r\nimport type { FormatPanelOptions } from '../formatPanel';\r\n\r\nexport class PolarAxisPanel extends Component {\r\n    private readonly axisGroup: AgGroupComponent = RefPlaceholder;\r\n\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(private readonly options: FormatPanelOptions) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const { isExpandedOnInit: expanded, chartAxisMenuParamsFactory, registerGroupComponent } = this.options;\r\n        const axisGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-top-level',\r\n            direction: 'vertical',\r\n            title: this.translate('polarAxis'),\r\n            expanded,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        const axisColorInputParams = chartAxisMenuParamsFactory.getDefaultColorPickerParams('line.stroke');\r\n        const axisLineWidthSliderParams = chartAxisMenuParamsFactory.getDefaultSliderParams(\r\n            'line.width',\r\n            'thickness',\r\n            10\r\n        );\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"axisGroup\">\r\n                <ag-color-picker data-ref=\"axisColorInput\"></ag-color-picker>\r\n                <ag-slider data-ref=\"axisLineWidthSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgColorPickerSelector, AgSliderSelector],\r\n            {\r\n                axisGroup: axisGroupParams,\r\n                axisColorInput: axisColorInputParams,\r\n                axisLineWidthSlider: axisLineWidthSliderParams,\r\n            }\r\n        );\r\n        registerGroupComponent(this.axisGroup);\r\n\r\n        this.initAxis();\r\n        this.initAxisLabels();\r\n        this.initRadiusAxis();\r\n    }\r\n\r\n    private initAxis() {\r\n        const chartType = this.options.chartController.getChartType();\r\n        const hasConfigurableAxisShape = ['radarLine', 'radarArea'].includes(chartType);\r\n        if (hasConfigurableAxisShape) {\r\n            const options: Array<ListOption> = [\r\n                { value: 'circle', text: this.translate('circle') },\r\n                { value: 'polygon', text: this.translate('polygon') },\r\n            ];\r\n\r\n            this.axisGroup.addItem(\r\n                this.createSelect({\r\n                    labelKey: 'shape',\r\n                    options: options,\r\n                    property: 'shape',\r\n                })\r\n            );\r\n        }\r\n\r\n        if (chartType !== 'pie') {\r\n            this.axisGroup.addItem(\r\n                this.createSlider({\r\n                    labelKey: 'innerRadius',\r\n                    defaultMaxValue: 1,\r\n                    property: 'innerRadiusRatio',\r\n                })\r\n            );\r\n        }\r\n    }\r\n\r\n    private initAxisLabels() {\r\n        const params: FontPanelParams = {\r\n            name: this.translate('labels'),\r\n            enabled: true,\r\n            suppressEnabledCheckbox: true,\r\n            chartMenuParamsFactory: this.options.chartAxisMenuParamsFactory,\r\n            keyMapper: (key) => `label.${key}`,\r\n        };\r\n\r\n        const labelPanelComp = this.createManagedBean(new FontPanel(params));\r\n        const labelOrientationComp = this.createOrientationWidget();\r\n        labelPanelComp.addItem(labelOrientationComp);\r\n\r\n        this.axisGroup.addItem(labelPanelComp);\r\n    }\r\n\r\n    private createOrientationWidget(): AgSelect {\r\n        const options: Array<ListOption> = [\r\n            { value: 'fixed', text: this.translate('fixed') },\r\n            { value: 'parallel', text: this.translate('parallel') },\r\n            { value: 'perpendicular', text: this.translate('perpendicular') },\r\n        ];\r\n\r\n        return this.createSelect({\r\n            labelKey: 'orientation',\r\n            options,\r\n            property: 'label.orientation',\r\n        });\r\n    }\r\n\r\n    private initRadiusAxis() {\r\n        const chartSeriesType = getSeriesType(this.options.chartController.getChartType());\r\n        if (!isRadial(chartSeriesType)) return;\r\n\r\n        const items = [\r\n            this.createSlider({\r\n                labelKey: 'groupPadding',\r\n                defaultMaxValue: 1,\r\n                property: 'paddingInner',\r\n            }),\r\n            this.createSlider({\r\n                labelKey: 'seriesPadding',\r\n                defaultMaxValue: 1,\r\n                property: 'groupPaddingInner',\r\n            }),\r\n        ];\r\n\r\n        const paddingPanelComp = this.createManagedBean(\r\n            new AgGroupComponent({\r\n                cssIdentifier: 'charts-format-sub-level',\r\n                direction: 'vertical',\r\n                suppressOpenCloseIcons: true,\r\n                enabled: true,\r\n                suppressEnabledCheckbox: true,\r\n                title: this.translate('padding'),\r\n                items,\r\n            })\r\n        )\r\n            .hideEnabledCheckbox(true)\r\n            .hideOpenCloseIcons(true);\r\n\r\n        this.axisGroup.addItem(paddingPanelComp);\r\n    }\r\n\r\n    private createSlider(config: {\r\n        labelKey: ChartTranslationKey;\r\n        defaultMaxValue: number;\r\n        step?: number;\r\n        property: string;\r\n    }): AgSlider {\r\n        const { labelKey, defaultMaxValue, step = 0.05, property } = config;\r\n        const params = this.options.chartAxisMenuParamsFactory.getDefaultSliderParams(\r\n            property,\r\n            labelKey,\r\n            defaultMaxValue\r\n        );\r\n        params.step = step;\r\n        return this.createManagedBean(new AgSlider(params));\r\n    }\r\n\r\n    private createSelect(config: {\r\n        labelKey: ChartTranslationKey;\r\n        options: Array<ListOption>;\r\n        property: string;\r\n    }): AgSelect {\r\n        const { labelKey, options, property } = config;\r\n        return this.createManagedBean(\r\n            new AgSelect(this.options.chartAxisMenuParamsFactory.getDefaultSelectParams(property, labelKey, options))\r\n        );\r\n    }\r\n\r\n    private translate(key: ChartTranslationKey) {\r\n        return this.chartTranslation.translate(key);\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent, AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { FormatPanelOptions } from '../formatPanel';\r\nimport { BackgroundPanel } from './backgroundPanel';\r\nimport { PaddingPanel } from './paddingPanel';\r\n\r\nexport class ChartPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    private readonly chartGroup: AgGroupComponent = RefPlaceholder;\r\n\r\n    constructor(private readonly options: FormatPanelOptions) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const {\r\n            chartController,\r\n            chartMenuParamsFactory,\r\n            isExpandedOnInit: expanded,\r\n            registerGroupComponent,\r\n        } = this.options;\r\n\r\n        const chartGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-top-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('chartStyle'),\r\n            expanded,\r\n            suppressEnabledCheckbox: true,\r\n            items: [\r\n                this.createManagedBean(new PaddingPanel(chartMenuParamsFactory, chartController)),\r\n                this.createManagedBean(new BackgroundPanel(chartMenuParamsFactory)),\r\n            ],\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"chartGroup\"></ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector],\r\n            { chartGroup: chartGroupParams }\r\n        );\r\n        registerGroupComponent(this.chartGroup);\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class BackgroundPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const chartBackgroundGroupParams = this.chartMenuUtils.addEnableParams<AgGroupComponentParams>(\r\n            'background.visible',\r\n            {\r\n                cssIdentifier: 'charts-format-sub-level',\r\n                direction: 'vertical',\r\n                suppressOpenCloseIcons: true,\r\n                title: this.chartTranslation.translate('background'),\r\n                suppressEnabledCheckbox: true,\r\n                useToggle: true,\r\n            }\r\n        );\r\n        const colorPickerParams = this.chartMenuUtils.getDefaultColorPickerParams('background.fill');\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"chartBackgroundGroup\">\r\n                <ag-color-picker data-ref=\"colorPicker\"></ag-color-picker>\r\n            </ag-group-component>\r\n        <div>`,\r\n            [AgGroupComponentSelector, AgColorPickerSelector],\r\n            {\r\n                chartBackgroundGroup: chartBackgroundGroupParams,\r\n                colorPicker: colorPickerParams,\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { AgChartPaddingOptions, AgChartThemeOverrides } from 'ag-charts-types';\r\n\r\nimport type { BeanCollection } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { AgSlider } from '../../../../widgets/agSlider';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartController } from '../../../chartController';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartThemeOverridesSeriesType } from '../../../utils/seriesTypeMapper';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class PaddingPanel extends Component {\r\n    private readonly paddingTopSlider: AgSlider = RefPlaceholder;\r\n\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(\r\n        private readonly chartMenuUtils: ChartMenuParamsFactory,\r\n        private readonly chartController: ChartController\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const chartPaddingGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            suppressOpenCloseIcons: true,\r\n            title: this.chartTranslation.translate('padding'),\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        const getSliderParams = (property: keyof AgChartPaddingOptions) =>\r\n            this.chartMenuUtils.getDefaultSliderParams('padding.' + property, property, 200);\r\n\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"chartPaddingGroup\">\r\n                <ag-slider data-ref=\"paddingTopSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"paddingRightSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"paddingBottomSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"paddingLeftSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        <div>`,\r\n            [AgGroupComponentSelector, AgSliderSelector],\r\n            {\r\n                chartPaddingGroup: chartPaddingGroupParams,\r\n                paddingTopSlider: getSliderParams('top'),\r\n                paddingRightSlider: getSliderParams('right'),\r\n                paddingBottomSlider: getSliderParams('bottom'),\r\n                paddingLeftSlider: getSliderParams('left'),\r\n            }\r\n        );\r\n\r\n        this.addManagedEventListeners({\r\n            chartOptionsChanged: (e) => {\r\n                this.updateTopPadding(e.chartOptions);\r\n            },\r\n        });\r\n    }\r\n\r\n    private updateTopPadding(chartOptions: AgChartThemeOverrides) {\r\n        // keep 'top' padding in sync with chart as toggling chart title on / off change the 'top' padding\r\n        const topPadding = [...this.chartController.getChartSeriesTypes(), 'common']\r\n            .map((seriesType: ChartThemeOverridesSeriesType) => chartOptions[seriesType]?.padding?.top)\r\n            .find((value) => value != null);\r\n        if (topPadding != null) {\r\n            this.paddingTopSlider.setValue(`${topPadding}`);\r\n        }\r\n    }\r\n}\r\n", "import { BeanStub } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent } from '../../../../widgets/agGroupComponent';\r\n\r\n// handles single group expansion\r\nexport class GroupExpansionFeature extends BeanStub {\r\n    private id: number = 0;\r\n    private groupComponents: Map<number, AgGroupComponent> = new Map();\r\n    private expandedGroupComponent?: number;\r\n\r\n    constructor(private readonly groupContainer: HTMLElement) {\r\n        super();\r\n    }\r\n\r\n    public addGroupComponent(groupComponent: AgGroupComponent): void {\r\n        const id = this.id++;\r\n        this.groupComponents.set(id, groupComponent);\r\n        if (groupComponent.isExpanded()) {\r\n            this.expandedGroupComponent = id;\r\n        }\r\n        groupComponent.onExpandedChange((expanded) => {\r\n            if (expanded) {\r\n                const previouslyExpandedGroupComponent = this.expandedGroupComponent;\r\n                this.expandedGroupComponent = id;\r\n                if (previouslyExpandedGroupComponent != null) {\r\n                    const groupComponentGui = groupComponent.getGui();\r\n                    const groupPositionInViewport =\r\n                        groupComponentGui.offsetTop - this.groupContainer.parentElement!.scrollTop;\r\n\r\n                    this.groupComponents.get(previouslyExpandedGroupComponent)?.toggleGroupExpand(false, true);\r\n\r\n                    // if the group above is collapsed, the expanded component will be in the wrong place, so scroll\r\n                    let newScrollTop = groupComponentGui.offsetTop - groupPositionInViewport;\r\n                    if (newScrollTop < 0) {\r\n                        newScrollTop = 0;\r\n                    }\r\n                    if (newScrollTop !== this.groupContainer.parentElement!.scrollTop) {\r\n                        this.groupContainer.parentElement!.scrollTop = newScrollTop;\r\n                    }\r\n                }\r\n            } else {\r\n                this.expandedGroupComponent = undefined;\r\n            }\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.groupComponents.clear();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { AgCheckbox, AgSelect, Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponent, AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgSlider } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\nimport type { FontPanelParams } from '../fontPanel';\r\nimport { FontPanel } from '../fontPanel';\r\nimport type { FormatPanelOptions } from '../formatPanel';\r\n\r\nexport class LegendPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    private readonly legendGroup: AgGroupComponent = RefPlaceholder;\r\n\r\n    private readonly key: string;\r\n    private readonly isGradient: boolean;\r\n\r\n    constructor(private readonly options: FormatPanelOptions) {\r\n        super();\r\n\r\n        this.isGradient = ['treemap', 'sunburst', 'heatmap'].includes(options.seriesType);\r\n        this.key = this.isGradient ? 'gradientLegend' : 'legend';\r\n    }\r\n\r\n    public postConstruct() {\r\n        const { chartMenuParamsFactory, isExpandedOnInit: expanded, registerGroupComponent } = this.options;\r\n        const positionSelect = this.createManagedBean(\r\n            new AgSelect(\r\n                chartMenuParamsFactory.getDefaultSelectParams(\r\n                    `${this.key}.position`,\r\n                    'position',\r\n                    ['top', 'right', 'bottom', 'left'].map((position: ChartTranslationKey) => ({\r\n                        value: position,\r\n                        text: this.chartTranslation.translate(position),\r\n                    }))\r\n                )\r\n            )\r\n        );\r\n        const enabledGroup = this.createManagedBean(\r\n            new AgGroupComponent(\r\n                chartMenuParamsFactory.addEnableParams<AgGroupComponentParams>(`${this.key}.enabled`, {\r\n                    cssIdentifier: 'charts-format-sub-level',\r\n                    direction: 'vertical',\r\n                    suppressOpenCloseIcons: true,\r\n                    title: this.chartTranslation.translate('legendEnabled'),\r\n                    suppressEnabledCheckbox: true,\r\n                    useToggle: true,\r\n                    items: [\r\n                        this.createLabelPanel(chartMenuParamsFactory),\r\n                        positionSelect,\r\n                        ...this.getItems(chartMenuParamsFactory),\r\n                    ],\r\n                })\r\n            )\r\n        );\r\n        const legendGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-top-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('legend'),\r\n            suppressEnabledCheckbox: true,\r\n            expanded,\r\n            items: [enabledGroup],\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"legendGroup\">\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector],\r\n            {\r\n                legendGroup: legendGroupParams,\r\n            }\r\n        );\r\n        registerGroupComponent(this.legendGroup);\r\n    }\r\n\r\n    private getItems(chartMenuParamsFactory: ChartMenuParamsFactory): Component<any>[] {\r\n        const createSlider = (expression: string, labelKey: ChartTranslationKey, defaultMaxValue: number) =>\r\n            this.createManagedBean(\r\n                new AgSlider(\r\n                    chartMenuParamsFactory.getDefaultSliderParams(\r\n                        `${this.key}.${expression}`,\r\n                        labelKey,\r\n                        defaultMaxValue\r\n                    )\r\n                )\r\n            );\r\n        if (this.isGradient) {\r\n            return [\r\n                this.createManagedBean(\r\n                    new AgCheckbox(\r\n                        chartMenuParamsFactory.addValueParams('gradientLegend.reverseOrder', {\r\n                            label: this.chartTranslation.translate('reverseDirection'),\r\n                            labelWidth: 'flex',\r\n                        })\r\n                    )\r\n                ),\r\n                createSlider('gradient.thickness', 'thickness', 40),\r\n                createSlider('gradient.preferredLength', 'preferredLength', 300),\r\n                createSlider('spacing', 'spacing', 200),\r\n            ];\r\n        }\r\n        return [\r\n            createSlider('spacing', 'spacing', 200),\r\n            createSlider('item.marker.size', 'markerSize', 40),\r\n            createSlider('item.marker.strokeWidth', 'markerStroke', 10),\r\n            createSlider('item.marker.padding', 'itemSpacing', 20),\r\n            createSlider('item.paddingX', 'layoutHorizontalSpacing', 50),\r\n            createSlider('item.paddingY', 'layoutVerticalSpacing', 50),\r\n        ];\r\n    }\r\n\r\n    private createLabelPanel(chartMenuParamsFactory: ChartMenuParamsFactory): FontPanel {\r\n        const rootKey = this.isGradient ? 'gradientLegend.scale.label' : 'legend.item.label';\r\n        const params: FontPanelParams = {\r\n            enabled: true,\r\n            suppressEnabledCheckbox: true,\r\n            chartMenuParamsFactory,\r\n            keyMapper: (key) => `${rootKey}.${key}`,\r\n            cssIdentifier: 'charts-format-sub-level-no-header',\r\n        };\r\n\r\n        return this.createManagedBean(new FontPanel(params));\r\n    }\r\n}\r\n", "import type { AgRangeBarSeriesLabelPlacement } from 'ag-charts-types';\r\n\r\nimport type { AgToggleButtonParams, BeanCollection, ListOption } from 'ag-grid-community';\r\nimport { AgSelect, AgToggleButton, Component, RefPlaceholder, _error, _removeFromParent } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent, AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgColorPicker } from '../../../../widgets/agColorPicker';\r\nimport { AgSlider } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartSeriesType } from '../../../utils/seriesTypeMapper';\r\nimport { getSeriesType, isPieChartSeries } from '../../../utils/seriesTypeMapper';\r\nimport { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\nimport { FontPanel } from '../fontPanel';\r\nimport type { FormatPanelOptions } from '../formatPanel';\r\nimport { CalloutPanel } from './calloutPanel';\r\nimport { CapsPanel } from './capsPanel';\r\nimport { ConnectorLinePanel } from './connectorLinePanel';\r\nimport { MarkersPanel } from './markersPanel';\r\nimport { SeriesItemsPanel } from './seriesItemsPanel';\r\nimport { getShapeSelectOptions } from './seriesUtils';\r\nimport { ShadowPanel } from './shadowPanel';\r\nimport { TileSpacingPanel } from './tileSpacingPanel';\r\nimport { WhiskersPanel } from './whiskersPanel';\r\n\r\nconst tooltips = 'tooltips';\r\nconst strokeWidth = 'strokeWidth';\r\nconst lineDash = 'lineDash';\r\nconst lineOpacity = 'lineOpacity';\r\nconst fillOpacity = 'fillOpacity';\r\nconst labels = 'labels';\r\nconst shadow = 'shadow';\r\n\r\nexport class SeriesPanel extends Component {\r\n    private readonly seriesGroup: AgGroupComponent = RefPlaceholder;\r\n\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    private chartMenuUtils: ChartMenuParamsFactory;\r\n\r\n    private activePanels: Component<any>[] = [];\r\n    private seriesType: ChartSeriesType;\r\n\r\n    private readonly widgetFuncs = {\r\n        lineWidth: () => this.initStrokeWidth('lineWidth'),\r\n        [strokeWidth]: () => this.initStrokeWidth('strokeWidth'),\r\n        lineColor: () => this.initLineColor(),\r\n        [lineDash]: () => this.initLineDash(),\r\n        [lineOpacity]: () => this.initOpacity('strokeOpacity'),\r\n        [fillOpacity]: () => this.initOpacity('fillOpacity'),\r\n        markers: () => new MarkersPanel(this.chartMenuUtils),\r\n        [labels]: () => this.initLabels(),\r\n        sectorLabels: () => this.initSectorLabels(),\r\n        [shadow]: () => new ShadowPanel(this.chartMenuUtils),\r\n        [tooltips]: () => this.initTooltips(),\r\n        bins: () => this.initBins(),\r\n        whiskers: () => new WhiskersPanel(this.chartMenuUtils),\r\n        caps: () => new CapsPanel(this.chartMenuUtils),\r\n        connectorLine: () => new ConnectorLinePanel(this.chartMenuUtils),\r\n        seriesItems: () => new SeriesItemsPanel(this.chartMenuUtils),\r\n        tileSpacing: () => new TileSpacingPanel(this.chartMenuUtils),\r\n        shape: () => this.initShape(),\r\n        size: () => this.initSize('size', 'size'),\r\n        minSize: () => this.initSize('size', 'minSize'),\r\n        maxSize: () => this.initSize('maxSize', 'maxSize'),\r\n    } as const;\r\n\r\n    private readonly seriesWidgetMappings: { [K in ChartSeriesType]?: (keyof typeof this.widgetFuncs)[] } = {\r\n        bar: [tooltips, strokeWidth, lineDash, lineOpacity, fillOpacity, labels, shadow],\r\n        pie: [tooltips, strokeWidth, lineOpacity, fillOpacity, labels, 'sectorLabels', shadow],\r\n        donut: [tooltips, strokeWidth, lineOpacity, fillOpacity, labels, 'sectorLabels', shadow],\r\n        line: [tooltips, 'lineWidth', lineDash, lineOpacity, 'markers', labels],\r\n        scatter: [tooltips, 'shape', 'size', strokeWidth, labels],\r\n        bubble: [tooltips, 'shape', 'minSize', 'maxSize', strokeWidth, labels],\r\n        area: [tooltips, 'lineWidth', lineDash, lineOpacity, fillOpacity, 'markers', labels, shadow],\r\n        histogram: [tooltips, 'bins', strokeWidth, lineDash, lineOpacity, fillOpacity, labels, shadow],\r\n        'radial-column': [tooltips, strokeWidth, lineDash, lineOpacity, fillOpacity, labels],\r\n        'radial-bar': [tooltips, strokeWidth, lineDash, lineOpacity, fillOpacity, labels],\r\n        'radar-line': [tooltips, strokeWidth, lineDash, lineOpacity, 'markers', labels],\r\n        'radar-area': [tooltips, strokeWidth, lineDash, lineOpacity, fillOpacity, 'markers', labels],\r\n        nightingale: [tooltips, strokeWidth, lineDash, lineOpacity, fillOpacity, labels],\r\n        'box-plot': [tooltips, strokeWidth, lineDash, lineOpacity, fillOpacity, 'whiskers', 'caps'],\r\n        'range-bar': [tooltips, strokeWidth, lineDash, lineOpacity, fillOpacity, labels],\r\n        'range-area': [tooltips, 'lineWidth', lineDash, lineOpacity, fillOpacity, 'markers', labels, shadow],\r\n        treemap: [tooltips, 'tileSpacing'],\r\n        sunburst: [tooltips],\r\n        heatmap: [tooltips, labels, 'lineColor', 'lineWidth', lineOpacity],\r\n        waterfall: [tooltips, 'connectorLine', 'seriesItems'],\r\n    };\r\n\r\n    constructor(private readonly options: FormatPanelOptions) {\r\n        super();\r\n        this.seriesType = options.seriesType;\r\n    }\r\n\r\n    public postConstruct() {\r\n        const {\r\n            isExpandedOnInit: expanded,\r\n            chartOptionsService,\r\n            chartController,\r\n            registerGroupComponent,\r\n        } = this.options;\r\n        const seriesGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-top-level',\r\n            direction: 'vertical',\r\n            title: this.translate('series'),\r\n            expanded,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"seriesGroup\">\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector],\r\n            { seriesGroup: seriesGroupParams }\r\n        );\r\n\r\n        registerGroupComponent(this.seriesGroup);\r\n\r\n        this.chartMenuUtils = this.createManagedBean(\r\n            new ChartMenuParamsFactory(chartOptionsService.getSeriesOptionsProxy(() => this.seriesType))\r\n        );\r\n\r\n        this.addManagedListeners(chartController, { chartSeriesChartTypeChanged: this.refreshWidgets.bind(this) });\r\n\r\n        this.refreshWidgets();\r\n    }\r\n\r\n    private refreshWidgets(): void {\r\n        const { chartController } = this.options;\r\n        this.destroyActivePanels();\r\n\r\n        const chart = chartController.getChartProxy().getChart();\r\n        chart\r\n            .waitForUpdate()\r\n            .then(() => {\r\n                const componentWasRemoved = !this.isAlive();\r\n                if (componentWasRemoved) {\r\n                    // It's possible that the component was unmounted during the async delay in updating the chart.\r\n                    // If this is the case we want to bail out to avoid operating on stale UI components.\r\n                    return;\r\n                }\r\n                if (chartController.isComboChart()) {\r\n                    this.updateSeriesType();\r\n                    this.initSeriesSelect();\r\n                }\r\n\r\n                (this.seriesWidgetMappings[this.seriesType] ?? []).forEach((w) => {\r\n                    const widgetFuncResult = this.widgetFuncs[w]();\r\n                    let widget: Component<any>;\r\n                    if (Array.isArray(widgetFuncResult)) {\r\n                        const comp = this.createBean(widgetFuncResult[0]);\r\n                        widget = comp;\r\n                        widgetFuncResult[1](comp);\r\n                    } else {\r\n                        widget = this.createBean(widgetFuncResult);\r\n                    }\r\n                    this.seriesGroup.addItem(widget);\r\n                    this.activePanels.push(widget);\r\n                });\r\n            })\r\n            .catch((e) => _error(105, { e }));\r\n    }\r\n\r\n    private initSeriesSelect() {\r\n        const seriesSelect = this.createBean(\r\n            new AgSelect(\r\n                this.chartMenuUtils.getDefaultSelectParamsWithoutValueParams(\r\n                    'seriesType',\r\n                    this.getSeriesSelectOptions(),\r\n                    `${this.seriesType}`,\r\n                    (newValue: ChartSeriesType) => {\r\n                        this.seriesType = newValue;\r\n                        this.refreshWidgets();\r\n                    }\r\n                )\r\n            )\r\n        );\r\n\r\n        this.seriesGroup.addItem(seriesSelect);\r\n\r\n        this.activePanels.push(seriesSelect);\r\n    }\r\n\r\n    private initTooltips(): AgToggleButton {\r\n        return new AgToggleButton(\r\n            this.chartMenuUtils.addValueParams<AgToggleButtonParams>('tooltip.enabled', {\r\n                label: this.translate('tooltips'),\r\n                labelAlignment: 'left',\r\n                labelWidth: 'flex',\r\n                inputWidth: 'flex',\r\n            })\r\n        );\r\n    }\r\n\r\n    private initLineColor(): AgColorPicker {\r\n        return new AgColorPicker(this.chartMenuUtils.getDefaultColorPickerParams('stroke', 'strokeColor'));\r\n    }\r\n\r\n    private initStrokeWidth(labelKey: 'strokeWidth' | 'lineWidth'): AgSlider {\r\n        return new AgSlider(this.chartMenuUtils.getDefaultSliderParams('strokeWidth', labelKey, 10));\r\n    }\r\n\r\n    private initLineDash(): AgSlider {\r\n        return new AgSlider(this.chartMenuUtils.getDefaultSliderParams('lineDash', 'lineDash', 30, true));\r\n    }\r\n\r\n    private initOpacity(type: 'strokeOpacity' | 'fillOpacity'): AgSlider {\r\n        const params = this.chartMenuUtils.getDefaultSliderParams(type, type, 1);\r\n        params.step = 0.05;\r\n        return new AgSlider(params);\r\n    }\r\n\r\n    private initLabels(): [FontPanel, (fontPanel: FontPanel) => void] {\r\n        const isPieChart = isPieChartSeries(this.seriesType);\r\n        const seriesOptionLabelProperty = isPieChart ? 'calloutLabel' : 'label';\r\n        const labelKey = isPieChart ? 'calloutLabels' : 'labels';\r\n        const labelParams = this.chartMenuUtils.getDefaultFontPanelParams(seriesOptionLabelProperty, labelKey);\r\n        const fontPanel = new FontPanel(labelParams);\r\n\r\n        const addItems = (labelPanelComp: FontPanel) => {\r\n            if (isPieChart) {\r\n                const calloutPanelComp = labelPanelComp.createManagedBean(new CalloutPanel(this.chartMenuUtils));\r\n                labelPanelComp.addItem(calloutPanelComp);\r\n                this.activePanels.push(calloutPanelComp);\r\n            }\r\n\r\n            if (this.seriesType === 'range-bar') {\r\n                // Add label placement dropdown\r\n                const options: Array<ListOption<AgRangeBarSeriesLabelPlacement>> = [\r\n                    { value: 'inside', text: this.translate('inside') },\r\n                    { value: 'outside', text: this.translate('outside') },\r\n                ];\r\n                const placementSelect = labelPanelComp.createManagedBean(\r\n                    new AgSelect(\r\n                        this.chartMenuUtils.getDefaultSelectParams('label.placement', 'labelPlacement', options)\r\n                    )\r\n                );\r\n\r\n                labelPanelComp.addItem(placementSelect);\r\n                this.activePanels.push(placementSelect);\r\n\r\n                // Add padding slider\r\n                const paddingSlider = labelPanelComp.createManagedBean(\r\n                    new AgSlider(this.chartMenuUtils.getDefaultSliderParams('label.padding', 'padding', 200))\r\n                );\r\n\r\n                labelPanelComp.addItem(paddingSlider);\r\n                this.activePanels.push(paddingSlider);\r\n            }\r\n        };\r\n\r\n        return [fontPanel, addItems];\r\n    }\r\n\r\n    private initSectorLabels(): [FontPanel, (fontPanel: FontPanel) => void] {\r\n        const sectorParams = this.chartMenuUtils.getDefaultFontPanelParams('sectorLabel', 'sectorLabels');\r\n        const fontPanel = new FontPanel(sectorParams);\r\n\r\n        const addItems = (sectorPanelComp: FontPanel) => {\r\n            const positionRatioParams = this.chartMenuUtils.getDefaultSliderParams(\r\n                'sectorLabel.positionRatio',\r\n                'positionRatio',\r\n                1\r\n            );\r\n            positionRatioParams.step = 0.05;\r\n            const positionRatioComp = sectorPanelComp.createManagedBean(new AgSlider(positionRatioParams));\r\n            sectorPanelComp.addItem(positionRatioComp);\r\n        };\r\n\r\n        return [fontPanel, addItems];\r\n    }\r\n\r\n    private initBins(): AgSlider {\r\n        const params = this.chartMenuUtils.getDefaultSliderParams('binCount', 'histogramBinCount', 20);\r\n        const chartOptions = this.chartMenuUtils.getChartOptions();\r\n        // this needs fixing\r\n        const value = (chartOptions.getValue<any>('bins') ?? chartOptions.getValue<any>('calculatedBins', true)).length;\r\n        params.value = `${value}`;\r\n        params.maxValue = Math.max(value, 20);\r\n        return new AgSlider(params);\r\n    }\r\n\r\n    private initShape(): AgSelect {\r\n        return new AgSelect(\r\n            this.chartMenuUtils.getDefaultSelectParams('shape', 'shape', getShapeSelectOptions(this.chartTranslation))\r\n        );\r\n    }\r\n\r\n    private initSize(expression: 'size' | 'maxSize', labelKey: 'size' | 'minSize' | 'maxSize'): AgSlider {\r\n        return new AgSlider(this.chartMenuUtils.getDefaultSliderParams(expression, labelKey, 60));\r\n    }\r\n\r\n    private getSeriesSelectOptions(): ListOption[] {\r\n        const activeSeriesTypes = this.getActiveSeriesTypes();\r\n        return (['area', 'bar', 'line'] as const)\r\n            .filter((seriesType) => activeSeriesTypes.includes(seriesType))\r\n            .map((value) => ({ value, text: this.translate(value) }));\r\n    }\r\n\r\n    private updateSeriesType() {\r\n        const activeSeriesTypes = this.getActiveSeriesTypes();\r\n        const invalidSeriesType = !activeSeriesTypes.includes(this.seriesType);\r\n        if (invalidSeriesType && activeSeriesTypes.length > 0) {\r\n            this.seriesType = activeSeriesTypes[0]; // default to first active series type\r\n        }\r\n    }\r\n\r\n    private getActiveSeriesTypes(): ChartSeriesType[] {\r\n        return this.options.chartController.getActiveSeriesChartTypes().map((s) => getSeriesType(s.chartType));\r\n    }\r\n\r\n    private translate(key: ChartTranslationKey) {\r\n        return this.chartTranslation.translate(key);\r\n    }\r\n\r\n    private destroyActivePanels(): void {\r\n        this.activePanels.forEach((panel) => {\r\n            _removeFromParent(panel.getGui());\r\n            this.destroyBean(panel);\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyActivePanels();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class CalloutPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const calloutGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('callout'),\r\n            enabled: true,\r\n            suppressOpenCloseIcons: true,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"calloutGroup\">\r\n                <ag-slider data-ref=\"calloutLengthSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"calloutStrokeWidthSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"labelOffsetSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgSliderSelector],\r\n            {\r\n                calloutGroup: calloutGroupParams,\r\n                calloutLengthSlider: this.chartMenuUtils.getDefaultSliderParams('calloutLine.length', 'length', 40),\r\n                calloutStrokeWidthSlider: this.chartMenuUtils.getDefaultSliderParams(\r\n                    'calloutLine.strokeWidth',\r\n                    'strokeWidth',\r\n                    10\r\n                ),\r\n                labelOffsetSlider: this.chartMenuUtils.getDefaultSliderParams('calloutLabel.offset', 'offset', 30),\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class CapsPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const capsGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('cap'),\r\n            enabled: true,\r\n            suppressOpenCloseIcons: true,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        const capLengthRatioSliderParams = this.chartMenuUtils.getDefaultSliderParams(\r\n            'cap.lengthRatio',\r\n            'capLengthRatio',\r\n            1\r\n        );\r\n        capLengthRatioSliderParams.step = 0.05;\r\n\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"capsGroup\">\r\n                <ag-slider data-ref=\"capLengthRatioSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgSliderSelector],\r\n            {\r\n                capsGroup: capsGroupParams,\r\n                capLengthRatioSlider: capLengthRatioSliderParams,\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport type { AgSliderParams } from '../../../../widgets/agSlider';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class ConnectorLinePanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const lineGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('connectorLine'),\r\n            enabled: true,\r\n            suppressOpenCloseIcons: true,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"lineGroup\">\r\n                <ag-color-picker data-ref=\"lineColorPicker\"></ag-color-picker>\r\n                <ag-slider data-ref=\"lineStrokeWidthSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"lineOpacitySlider\"></ag-slider>\r\n                <ag-slider data-ref=\"lineDashSlider\"></ag-slider>                \r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgColorPickerSelector, AgSliderSelector],\r\n            {\r\n                lineGroup: lineGroupParams,\r\n                lineColorPicker: this.chartMenuUtils.getDefaultColorPickerParams('line.stroke'),\r\n                lineStrokeWidthSlider: this.getSliderParams('strokeWidth', 10, 'line.strokeWidth'),\r\n                lineDashSlider: this.getSliderParams('lineDash', 30, 'line.lineDash', 1, true),\r\n                lineOpacitySlider: this.getSliderParams('strokeOpacity', 1, 'line.strokeOpacity', 0.05),\r\n            }\r\n        );\r\n    }\r\n\r\n    private getSliderParams(\r\n        labelKey: ChartTranslationKey,\r\n        maxValue: number,\r\n        seriesOptionKey: string,\r\n        step: number = 1,\r\n        isArray: boolean = false\r\n    ): AgSliderParams {\r\n        const params = this.chartMenuUtils.getDefaultSliderParams(seriesOptionKey, labelKey, maxValue, isArray);\r\n        params.step = step;\r\n        return params;\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { AgSelectSelector, Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\nimport { getShapeSelectOptions } from './seriesUtils';\r\n\r\nexport class MarkersPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const seriesMarkersGroupParams = this.chartMenuUtils.addEnableParams<AgGroupComponentParams>('marker.enabled', {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('markers'),\r\n            suppressEnabledCheckbox: true,\r\n            useToggle: true,\r\n            suppressOpenCloseIcons: true,\r\n        });\r\n\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"seriesMarkersGroup\">\r\n                <ag-select data-ref=\"seriesMarkerShapeSelect\"></ag-select>\r\n                <ag-slider data-ref=\"seriesMarkerSizeSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"seriesMarkerStrokeWidthSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgSelectSelector, AgSliderSelector],\r\n            {\r\n                seriesMarkersGroup: seriesMarkersGroupParams,\r\n                seriesMarkerShapeSelect: this.chartMenuUtils.getDefaultSelectParams(\r\n                    'marker.shape',\r\n                    'shape',\r\n                    getShapeSelectOptions(this.chartTranslation)\r\n                ),\r\n                seriesMarkerSizeSlider: this.chartMenuUtils.getDefaultSliderParams('marker.size', 'size', 60),\r\n                seriesMarkerStrokeWidthSlider: this.chartMenuUtils.getDefaultSliderParams(\r\n                    'marker.strokeWidth',\r\n                    'strokeWidth',\r\n                    10\r\n                ),\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { ListOption } from 'ag-grid-community';\r\n\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\n\r\nexport function getShapeSelectOptions(chartTranslation: ChartTranslationService): ListOption[] {\r\n    return (['square', 'circle', 'cross', 'diamond', 'plus', 'triangle', 'heart'] as const).map((value) => ({\r\n        value,\r\n        text: chartTranslation.translate(value),\r\n    }));\r\n}\r\n", "import type { AgSelectParams, BeanCollection, ListOption } from 'ag-grid-community';\r\nimport { AgSelectSelector, Component, RefPlaceholder, _removeFromParent } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent, AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgSlider } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\nimport { FontPanel } from '../fontPanel';\r\n\r\ntype SeriesItemType = 'positive' | 'negative';\r\n\r\nexport class SeriesItemsPanel extends Component {\r\n    private readonly seriesItemsGroup: AgGroupComponent = RefPlaceholder;\r\n\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    private activePanels: Component<any>[] = [];\r\n\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const seriesItemsGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('seriesItems'),\r\n            enabled: true,\r\n            suppressOpenCloseIcons: true,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"seriesItemsGroup\">\r\n                <ag-select data-ref=\"seriesItemSelect\"></ag-select>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgSelectSelector],\r\n            {\r\n                seriesItemsGroup: seriesItemsGroupParams,\r\n                seriesItemSelect: this.getSeriesItemsParams(),\r\n            }\r\n        );\r\n\r\n        this.initSeriesControls();\r\n    }\r\n\r\n    private getSeriesItemsParams(): AgSelectParams {\r\n        const options: ListOption<SeriesItemType>[] = [\r\n            { value: 'positive', text: this.chartTranslation.translate('seriesItemPositive') },\r\n            { value: 'negative', text: this.chartTranslation.translate('seriesItemNegative') },\r\n        ];\r\n\r\n        const seriesItemChangedCallback = (newValue: SeriesItemType) => {\r\n            this.destroyActivePanels();\r\n            this.initSeriesControls(newValue as SeriesItemType);\r\n        };\r\n\r\n        return this.chartMenuUtils.getDefaultSelectParamsWithoutValueParams(\r\n            'seriesItemType',\r\n            options,\r\n            'positive',\r\n            seriesItemChangedCallback\r\n        );\r\n    }\r\n\r\n    private initSeriesControls(itemType: SeriesItemType = 'positive') {\r\n        this.initSlider('strokeWidth', 10, `item.${itemType}.strokeWidth`);\r\n        this.initSlider('lineDash', 30, `item.${itemType}.lineDash`, 1, true);\r\n        this.initSlider('strokeOpacity', 1, `item.${itemType}.strokeOpacity`, 0.05, false);\r\n        this.initSlider('fillOpacity', 1, `item.${itemType}.fillOpacity`, 0.05, false);\r\n        this.initItemLabels(itemType);\r\n    }\r\n\r\n    private initSlider(\r\n        labelKey: ChartTranslationKey,\r\n        maxValue: number,\r\n        seriesOptionKey: string,\r\n        step: number = 1,\r\n        isArray: boolean = false\r\n    ) {\r\n        const params = this.chartMenuUtils.getDefaultSliderParams(seriesOptionKey, labelKey, maxValue, isArray);\r\n        params.step = step;\r\n\r\n        const itemSlider = this.seriesItemsGroup.createManagedBean(new AgSlider(params));\r\n\r\n        this.seriesItemsGroup.addItem(itemSlider);\r\n        this.activePanels.push(itemSlider);\r\n    }\r\n\r\n    private initItemLabels(itemType: 'positive' | 'negative') {\r\n        const sectorParams = this.chartMenuUtils.getDefaultFontPanelParams(\r\n            `item.${itemType}.label`,\r\n            'seriesItemLabels'\r\n        );\r\n\r\n        const labelPanelComp = this.createBean(new FontPanel(sectorParams));\r\n        this.seriesItemsGroup.addItem(labelPanelComp);\r\n        this.activePanels.push(labelPanelComp);\r\n    }\r\n\r\n    private destroyActivePanels(): void {\r\n        this.activePanels.forEach((panel) => {\r\n            _removeFromParent(panel.getGui());\r\n            this.destroyBean(panel);\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyActivePanels();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport type { AgSliderParams } from '../../../../widgets/agSlider';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class ShadowPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(\r\n        private readonly chartMenuUtils: ChartMenuParamsFactory,\r\n        private propertyKey: string = 'shadow'\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        // Determine the path within the series options object to get/set the individual shadow options\r\n        const propertyNamespace = this.propertyKey;\r\n        const shadowGroupParams = this.chartMenuUtils.addEnableParams<AgGroupComponentParams>(\r\n            `${propertyNamespace}.enabled`,\r\n            {\r\n                cssIdentifier: 'charts-format-sub-level',\r\n                direction: 'vertical',\r\n                suppressOpenCloseIcons: true,\r\n                title: this.chartTranslation.translate('shadow'),\r\n                suppressEnabledCheckbox: true,\r\n                useToggle: true,\r\n            }\r\n        );\r\n        const shadowColorPickerParams = this.chartMenuUtils.getDefaultColorPickerParams(`${propertyNamespace}.color`);\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"shadowGroup\">\r\n                <ag-color-picker data-ref=\"shadowColorPicker\"></ag-color-picker>\r\n                <ag-slider data-ref=\"shadowBlurSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"shadowXOffsetSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"shadowYOffsetSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgColorPickerSelector, AgSliderSelector],\r\n            {\r\n                shadowGroup: shadowGroupParams,\r\n                shadowColorPicker: shadowColorPickerParams,\r\n                shadowBlurSlider: this.getSliderParams('blur', 0, 20),\r\n                shadowXOffsetSlider: this.getSliderParams('xOffset', -10, 10),\r\n                shadowYOffsetSlider: this.getSliderParams('yOffset', -10, 10),\r\n            }\r\n        );\r\n    }\r\n\r\n    private getSliderParams(property: ChartTranslationKey, minValue: number, defaultMaxValue: number): AgSliderParams {\r\n        const expression = `${this.propertyKey}.${property}`;\r\n        const params = this.chartMenuUtils.getDefaultSliderParams(expression, property, defaultMaxValue);\r\n        params.minValue = minValue;\r\n        return params;\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { AgSliderParams } from '../../../../widgets/agSlider';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class TileSpacingPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const groupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            enabled: true,\r\n            suppressOpenCloseIcons: true,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"groupSpacing\">\r\n                <ag-slider data-ref=\"groupPaddingSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"groupSpacingSlider\"></ag-slider>\r\n            </ag-group-component>\r\n            <ag-group-component data-ref=\"tileSpacing\">\r\n                <ag-slider data-ref=\"tilePaddingSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"tileSpacingSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgSliderSelector],\r\n            {\r\n                groupSpacing: { ...groupParams, title: this.chartTranslation.translate('group') },\r\n                tileSpacing: { ...groupParams, title: this.chartTranslation.translate('tile') },\r\n                groupPaddingSlider: this.getSliderParams('padding', 'group.padding'),\r\n                groupSpacingSlider: this.getSliderParams('spacing', 'group.gap'),\r\n                tilePaddingSlider: this.getSliderParams('padding', 'tile.padding'),\r\n                tileSpacingSlider: this.getSliderParams('spacing', 'tile.gap'),\r\n            }\r\n        );\r\n    }\r\n\r\n    private getSliderParams(labelKey: ChartTranslationKey, key: string): AgSliderParams {\r\n        return this.chartMenuUtils.getDefaultSliderParams(key, labelKey, 10);\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport { AgColorPickerSelector } from '../../../../widgets/agColorPicker';\r\nimport { AgSliderSelector } from '../../../../widgets/agSlider';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\n\r\nexport class WhiskersPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    constructor(private readonly chartMenuUtils: ChartMenuParamsFactory) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const whiskersGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-sub-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('whisker'),\r\n            enabled: true,\r\n            suppressOpenCloseIcons: true,\r\n            suppressEnabledCheckbox: true,\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"whiskersGroup\">\r\n                <ag-color-picker data-ref=\"whiskerColorPicker\"></ag-color-picker>\r\n                <ag-slider data-ref=\"whiskerThicknessSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"whiskerOpacitySlider\"></ag-slider>\r\n                <ag-slider data-ref=\"whiskerLineDashSlider\"></ag-slider>\r\n                <ag-slider data-ref=\"whiskerLineDashOffsetSlider\"></ag-slider>\r\n            </ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector, AgColorPickerSelector, AgSliderSelector],\r\n            {\r\n                whiskersGroup: whiskersGroupParams,\r\n                whiskerColorPicker: this.chartMenuUtils.getDefaultColorPickerParams('whisker.stroke'),\r\n                whiskerThicknessSlider: this.chartMenuUtils.getDefaultSliderParams(\r\n                    'whisker.strokeWidth',\r\n                    'strokeWidth',\r\n                    10\r\n                ),\r\n                whiskerOpacitySlider: this.chartMenuUtils.getDefaultSliderParams(\r\n                    'whisker.strokeOpacity',\r\n                    'strokeOpacity',\r\n                    1\r\n                ),\r\n                whiskerLineDashSlider: this.chartMenuUtils.getDefaultSliderParams(\r\n                    'whisker.lineDash',\r\n                    'lineDash',\r\n                    30,\r\n                    true\r\n                ),\r\n                whiskerLineDashOffsetSlider: this.chartMenuUtils.getDefaultSliderParams(\r\n                    'whisker.lineDashOffset',\r\n                    'lineDashOffset',\r\n                    30\r\n                ),\r\n            }\r\n        );\r\n    }\r\n}\r\n", "import type { BeanCollection } from 'ag-grid-community';\r\nimport { Component, RefPlaceholder } from 'ag-grid-community';\r\n\r\nimport type { AgGroupComponent, AgGroupComponentParams } from '../../../../../widgets/agGroupComponent';\r\nimport { AgGroupComponentSelector } from '../../../../../widgets/agGroupComponent';\r\nimport type { ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport { isCartesian, isPolar } from '../../../utils/seriesTypeMapper';\r\nimport { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\nimport type { FormatPanelOptions } from '../formatPanel';\r\nimport { ChartTitlePanel } from './chartTitlePanel';\r\nimport { TitlePanel } from './titlePanel';\r\n\r\nexport class TitlesPanel extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n    private readonly titleGroup: AgGroupComponent = RefPlaceholder;\r\n\r\n    constructor(private readonly options: FormatPanelOptions) {\r\n        super();\r\n    }\r\n\r\n    public postConstruct() {\r\n        const {\r\n            chartMenuParamsFactory,\r\n            chartAxisMenuParamsFactory,\r\n            chartOptionsService,\r\n            seriesType,\r\n            isExpandedOnInit: expanded = false,\r\n            registerGroupComponent,\r\n        } = this.options;\r\n        const axisTitlePanels: TitlePanel[] = [];\r\n        if (isCartesian(seriesType)) {\r\n            const createAxisParamsFactory = (axisType: 'xAxis' | 'yAxis') =>\r\n                this.createManagedBean(\r\n                    new ChartMenuParamsFactory(chartOptionsService.getCartesianAxisThemeOverridesProxy(axisType))\r\n                );\r\n            axisTitlePanels.push(\r\n                this.createManagedBean(new TitlePanel(createAxisParamsFactory('xAxis'), 'horizontalAxisTitle', 'title'))\r\n            );\r\n            axisTitlePanels.push(\r\n                this.createManagedBean(new TitlePanel(createAxisParamsFactory('yAxis'), 'verticalAxisTitle', 'title'))\r\n            );\r\n        } else if (isPolar(seriesType)) {\r\n            axisTitlePanels.push(\r\n                this.createManagedBean(new TitlePanel(chartAxisMenuParamsFactory, 'polarAxisTitle', 'title'))\r\n            );\r\n        }\r\n        const titleGroupParams: AgGroupComponentParams = {\r\n            cssIdentifier: 'charts-format-top-level',\r\n            direction: 'vertical',\r\n            title: this.chartTranslation.translate('chartTitles'),\r\n            expanded,\r\n            suppressEnabledCheckbox: true,\r\n            items: [\r\n                this.createManagedBean(new ChartTitlePanel(chartMenuParamsFactory, 'chartTitle', 'title')),\r\n                this.createManagedBean(new TitlePanel(chartMenuParamsFactory, 'chartSubtitle', 'subtitle')),\r\n                ...axisTitlePanels,\r\n            ],\r\n        };\r\n        this.setTemplate(\r\n            /* html */ `<div>\r\n            <ag-group-component data-ref=\"titleGroup\"></ag-group-component>\r\n        </div>`,\r\n            [AgGroupComponentSelector],\r\n            { titleGroup: titleGroupParams }\r\n        );\r\n        registerGroupComponent(this.titleGroup);\r\n    }\r\n}\r\n", "import type { AgInputTextFieldParams, BeanCollection } from 'ag-grid-community';\r\nimport { AgInputTextField, Component } from 'ag-grid-community';\r\n\r\nimport type { AgSliderParams } from '../../../../widgets/agSlider';\r\nimport { AgSlider } from '../../../../widgets/agSlider';\r\nimport type { ChartOptionsProxy } from '../../../services/chartOptionsService';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\nimport type { ChartMenuParamsFactory } from '../../chartMenuParamsFactory';\r\nimport type { FontPanelParams } from '../fontPanel';\r\nimport { FontPanel } from '../fontPanel';\r\n\r\nexport class TitlePanel extends Component {\r\n    protected chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    protected readonly chartOptions: ChartOptionsProxy;\r\n\r\n    protected fontPanel: FontPanel;\r\n\r\n    constructor(\r\n        private readonly chartMenuUtils: ChartMenuParamsFactory,\r\n        private readonly name: ChartTranslationKey,\r\n        protected readonly key: string\r\n    ) {\r\n        super(/* html */ `<div></div>`);\r\n        this.chartOptions = chartMenuUtils.getChartOptions();\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.initFontPanel();\r\n    }\r\n\r\n    protected hasTitle(): boolean {\r\n        const title: any = this.chartOptions.getValue(this.key);\r\n        return title && title.enabled && title.text && title.text.length > 0;\r\n    }\r\n\r\n    private initFontPanel(): void {\r\n        const hasTitle = this.hasTitle();\r\n\r\n        const fontPanelParams: FontPanelParams = {\r\n            name: this.chartTranslation.translate(this.name),\r\n            enabled: hasTitle,\r\n            suppressEnabledCheckbox: false,\r\n            chartMenuParamsFactory: this.chartMenuUtils,\r\n            keyMapper: (key) => `${this.key}.${key}`,\r\n            onEnableChange: (enabled) => this.onEnableChange(enabled),\r\n        };\r\n\r\n        this.fontPanel = this.createManagedBean(new FontPanel(fontPanelParams));\r\n\r\n        this.fontPanel.addItem(this.createBean(new AgInputTextField(this.getTextInputParams())), true);\r\n        this.fontPanel.addItem(this.createBean(new AgSlider(this.getSpacingSliderParams())));\r\n\r\n        this.getGui().appendChild(this.fontPanel.getGui());\r\n    }\r\n\r\n    protected getTextInputParams(): AgInputTextFieldParams {\r\n        return this.chartMenuUtils.addValueParams(`${this.key}.text`, {\r\n            label: this.chartTranslation.translate('title'),\r\n            labelAlignment: 'top',\r\n        });\r\n    }\r\n\r\n    protected getSpacingSliderParams(): AgSliderParams {\r\n        return this.chartMenuUtils.getDefaultSliderParams(`${this.key}.spacing`, 'spacing', 100);\r\n    }\r\n\r\n    protected onEnableChange(enabled: boolean): void {\r\n        this.chartOptions.setValue(`${this.key}.enabled`, enabled);\r\n    }\r\n}\r\n", "import type { AgInputTextFieldParams, BeanCollection } from 'ag-grid-community';\r\n\r\nimport type { AgSliderParams } from '../../../../widgets/agSlider';\r\nimport type { ChartMenuService } from '../../../services/chartMenuService';\r\nimport { TitlePanel } from './titlePanel';\r\n\r\nexport class ChartTitlePanel extends TitlePanel {\r\n    private chartMenuSvc: ChartMenuService;\r\n\r\n    public override wireBeans(beans: BeanCollection): void {\r\n        super.wireBeans(beans);\r\n        this.chartMenuSvc = beans.chartMenuSvc as ChartMenuService;\r\n    }\r\n\r\n    private titlePlaceholder: string;\r\n\r\n    public override postConstruct(): void {\r\n        this.titlePlaceholder = this.chartTranslation.translate('titlePlaceholder');\r\n        super.postConstruct();\r\n        // edits to the title can disable it, so keep the checkbox in sync:\r\n        this.addManagedEventListeners({\r\n            chartTitleEdit: () => {\r\n                this.fontPanel.setEnabled(this.hasTitle());\r\n            },\r\n        });\r\n    }\r\n\r\n    protected override getTextInputParams(): AgInputTextFieldParams {\r\n        const params = super.getTextInputParams();\r\n        if (this.shouldOverrideTextWithPlaceholder(params.value)) {\r\n            params.value = this.titlePlaceholder;\r\n        }\r\n        return params;\r\n    }\r\n\r\n    protected override getSpacingSliderParams(): AgSliderParams {\r\n        const params = super.getSpacingSliderParams();\r\n        // Default title spacing is 10, but this isn't reflected in the options - this should really be fixed there.\r\n        params.value = '10';\r\n        return params;\r\n    }\r\n\r\n    protected override onEnableChange(enabled: boolean): void {\r\n        if (this.chartMenuSvc.doesChartToolbarExist()) {\r\n            // extra padding is only included when the toolbar is present\r\n            const topPadding: number = this.chartOptions.getValue('padding.top');\r\n            this.chartOptions.setValue('padding.top', enabled ? topPadding - 20 : topPadding + 20);\r\n        }\r\n\r\n        this.chartOptions.setValue(`${this.key}.enabled`, enabled);\r\n        const currentTitleText = this.chartOptions.getValue(`${this.key}.text`);\r\n        if (enabled && this.shouldOverrideTextWithPlaceholder(currentTitleText)) {\r\n            this.chartOptions.setValue(`${this.key}.text`, this.titlePlaceholder);\r\n        }\r\n    }\r\n\r\n    private shouldOverrideTextWithPlaceholder(currentTitleText?: string): boolean {\r\n        return currentTitleText === 'Title' || currentTitleText?.trim().length === 0;\r\n    }\r\n}\r\n", "import type { AgChartThemePalette } from 'ag-charts-types';\r\n\r\nimport {\r\n    Component,\r\n    RefPlaceholder,\r\n    _areEqual,\r\n    _clearElement,\r\n    _createIconNoSpan,\r\n    _getAbsoluteWidth,\r\n    _radioCssClass,\r\n    _setDisplayed,\r\n} from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../agChartsExports';\r\nimport type { ChartController } from '../../chartController';\r\nimport { isStockTheme } from '../../chartProxies/chartTheme';\r\nimport { MiniChartsContainer } from './miniChartsContainer';\r\n\r\ntype AnimationDirection = 'left' | 'right';\r\n\r\nexport class ChartSettingsPanel extends Component {\r\n    private readonly eMiniChartsContainer: HTMLElement = RefPlaceholder;\r\n    private readonly eNavBar: HTMLElement = RefPlaceholder;\r\n    private readonly eCardSelector: HTMLElement = RefPlaceholder;\r\n    private readonly ePrevBtn: HTMLElement = RefPlaceholder;\r\n    private readonly eNextBtn: HTMLElement = RefPlaceholder;\r\n\r\n    private miniChartsContainers: MiniChartsContainer[] = [];\r\n    private cardItems: HTMLElement[] = [];\r\n\r\n    private activePaletteIndex = 0;\r\n    private palettes: AgChartThemePalette[] = [];\r\n    private themes: string[] = [];\r\n\r\n    private isAnimating: boolean;\r\n\r\n    constructor(private readonly chartController: ChartController) {\r\n        super(/* html */ `<div class=\"ag-chart-settings-wrapper\">\r\n            <div data-ref=\"eMiniChartsContainer\" class=\"ag-chart-settings-mini-charts-container ag-scrollable-container\"></div>\r\n            <div data-ref=\"eNavBar\" class=\"ag-chart-settings-nav-bar\">\r\n                <div data-ref=\"ePrevBtn\" class=\"ag-chart-settings-prev\">\r\n                    <button type=\"button\" class=\"ag-button ag-chart-settings-prev-button\"></button>\r\n                </div>\r\n                <div data-ref=\"eCardSelector\" class=\"ag-chart-settings-card-selector\"></div>\r\n                <div data-ref=\"eNextBtn\" class=\"ag-chart-settings-next\">\r\n                    <button type=\"button\" class=\"ag-button ag-chart-settings-next-button\"></button>\r\n                </div>\r\n            </div>\r\n        </div>`);\r\n    }\r\n\r\n    public postConstruct() {\r\n        this.resetPalettes();\r\n\r\n        this.ePrevBtn.insertAdjacentElement('afterbegin', _createIconNoSpan('chartsThemePrevious', this.beans)!);\r\n        this.eNextBtn.insertAdjacentElement('afterbegin', _createIconNoSpan('chartsThemeNext', this.beans)!);\r\n\r\n        this.addManagedElementListeners(this.ePrevBtn, { click: () => this.setActivePalette(this.getPrev(), 'left') });\r\n        this.addManagedElementListeners(this.eNextBtn, { click: () => this.setActivePalette(this.getNext(), 'right') });\r\n\r\n        // change the selected chart when a combo chart is modified via the data panel, i.e. the custom combo should be selected\r\n        const reset = () => this.resetPalettes(true);\r\n        this.addManagedListeners(this.chartController, {\r\n            chartTypeChanged: reset,\r\n            chartApiUpdate: reset,\r\n        });\r\n\r\n        this.scrollSelectedIntoView();\r\n    }\r\n\r\n    private scrollSelectedIntoView(): void {\r\n        // the panel is not immediately visible due to the slide animation, so we add a\r\n        // setTimeout to wait until the panel animation is over and is able to scroll\r\n        setTimeout(() => {\r\n            const isMiniChartsContainerVisible = (miniChartsContainers: MiniChartsContainer) => {\r\n                return !miniChartsContainers.getGui().classList.contains('ag-hidden');\r\n            };\r\n            const currentMiniChartContainer = this.miniChartsContainers.find(isMiniChartsContainerVisible);\r\n            const currentChart = currentMiniChartContainer!.getGui().querySelector('.ag-selected') as HTMLElement;\r\n\r\n            if (currentChart) {\r\n                const parent = currentChart.offsetParent as HTMLElement;\r\n                if (parent) {\r\n                    this.eMiniChartsContainer.scrollTo(0, parent.offsetTop);\r\n                }\r\n            }\r\n        }, 250);\r\n    }\r\n\r\n    private resetPalettes(forceReset?: boolean): void {\r\n        const palettes = this.chartController.getPalettes();\r\n        const themeTemplateParameters = this.chartController.getThemeTemplateParameters();\r\n        const chartGroups = this.gos.get('chartToolPanelsDef')?.settingsPanel?.chartGroupsDef;\r\n\r\n        if ((_areEqual(palettes, this.palettes) && !forceReset) || this.isAnimating) {\r\n            return;\r\n        }\r\n\r\n        this.palettes = palettes;\r\n        this.themes = this.chartController.getThemeNames();\r\n        this.activePaletteIndex = this.themes.findIndex((name) => name === this.chartController.getChartThemeName());\r\n        this.cardItems = [];\r\n\r\n        _clearElement(this.eCardSelector);\r\n\r\n        this.destroyMiniCharts();\r\n\r\n        const { themes } = this;\r\n\r\n        this.palettes.forEach((palette, index) => {\r\n            const isActivePalette = this.activePaletteIndex === index;\r\n            const { fills = [], strokes = [] } = palette;\r\n            const themeName = themes[index];\r\n            const isCustomTheme = !isStockTheme(themeName, (this.beans.agChartsExports as AgChartsExports)._Theme);\r\n            const miniChartsContainer = this.createBean(\r\n                new MiniChartsContainer(\r\n                    this.chartController,\r\n                    fills,\r\n                    strokes,\r\n                    themeTemplateParameters[index],\r\n                    isCustomTheme,\r\n                    chartGroups\r\n                )\r\n            );\r\n\r\n            this.miniChartsContainers.push(miniChartsContainer);\r\n            this.eMiniChartsContainer.appendChild(miniChartsContainer.getGui());\r\n            this.addCardLink(index);\r\n\r\n            if (isActivePalette) {\r\n                miniChartsContainer.updateSelectedMiniChart();\r\n            } else {\r\n                miniChartsContainer.setDisplayed(false);\r\n            }\r\n        });\r\n\r\n        _setDisplayed(this.eNavBar, this.palettes.length > 1);\r\n        _radioCssClass(this.cardItems[this.activePaletteIndex], 'ag-selected', 'ag-not-selected');\r\n    }\r\n\r\n    private addCardLink(index: number): void {\r\n        const link = document.createElement('div');\r\n        link.classList.add('ag-chart-settings-card-item');\r\n\r\n        this.addManagedElementListeners(link, {\r\n            click: () => {\r\n                this.setActivePalette(index, index < this.activePaletteIndex ? 'left' : 'right');\r\n            },\r\n        });\r\n\r\n        this.eCardSelector.appendChild(link);\r\n        this.cardItems.push(link);\r\n    }\r\n\r\n    private getPrev(): number {\r\n        let prev = this.activePaletteIndex - 1;\r\n\r\n        if (prev < 0) {\r\n            prev = this.palettes.length - 1;\r\n        }\r\n\r\n        return prev;\r\n    }\r\n\r\n    private getNext(): number {\r\n        let next = this.activePaletteIndex + 1;\r\n\r\n        if (next >= this.palettes.length) {\r\n            next = 0;\r\n        }\r\n\r\n        return next;\r\n    }\r\n\r\n    private setActivePalette(index: number, animationDirection: AnimationDirection) {\r\n        if (this.isAnimating || this.activePaletteIndex === index) {\r\n            return;\r\n        }\r\n\r\n        _radioCssClass(this.cardItems[index], 'ag-selected', 'ag-not-selected');\r\n\r\n        const currentPalette = this.miniChartsContainers[this.activePaletteIndex];\r\n        const currentGui = currentPalette.getGui();\r\n        const futurePalette = this.miniChartsContainers[index];\r\n        const nextGui = futurePalette.getGui();\r\n\r\n        currentPalette.updateSelectedMiniChart();\r\n        futurePalette.updateSelectedMiniChart();\r\n\r\n        const multiplier = animationDirection === 'left' ? -1 : 1;\r\n        const final = (nextGui.style.left = `${_getAbsoluteWidth(this.getGui()) * multiplier}px`);\r\n\r\n        this.activePaletteIndex = index;\r\n\r\n        this.isAnimating = true;\r\n\r\n        const animatingClass = 'ag-animating';\r\n\r\n        futurePalette.setDisplayed(true);\r\n        currentPalette.addCssClass(animatingClass);\r\n        futurePalette.addCssClass(animatingClass);\r\n\r\n        this.chartController.setChartThemeName(this.themes[index]);\r\n\r\n        window.setTimeout(() => {\r\n            currentGui.style.left = `${-parseFloat(final)}px`;\r\n            nextGui.style.left = '0px';\r\n        }, 0);\r\n\r\n        window.setTimeout(() => {\r\n            this.isAnimating = false;\r\n\r\n            currentPalette.removeCssClass(animatingClass);\r\n            futurePalette.removeCssClass(animatingClass);\r\n            currentPalette.setDisplayed(false);\r\n        }, 300);\r\n    }\r\n\r\n    private destroyMiniCharts(): void {\r\n        _clearElement(this.eMiniChartsContainer);\r\n\r\n        this.miniChartsContainers = this.destroyBeans(this.miniChartsContainers);\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.destroyMiniCharts();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import type { BeanCollection, ChartGroupsDef, ChartType } from 'ag-grid-community';\r\nimport { Component, KeyCode, _setAriaLabel, _warn } from 'ag-grid-community';\r\n\r\nimport { AgGroupComponent } from '../../../../widgets/agGroupComponent';\r\nimport type { ChartController } from '../../chartController';\r\nimport type { ChartTranslationService } from '../../services/chartTranslationService';\r\nimport { getFullChartNameTranslationKey } from '../../utils/seriesTypeMapper';\r\nimport {\r\n    MiniArea,\r\n    MiniAreaColumnCombo,\r\n    MiniBar,\r\n    MiniBoxPlot,\r\n    MiniBubble,\r\n    MiniColumn,\r\n    MiniColumnLineCombo,\r\n    MiniCustomCombo,\r\n    MiniDonut,\r\n    MiniHeatmap,\r\n    MiniHistogram,\r\n    MiniLine,\r\n    MiniNightingale,\r\n    MiniNormalizedArea,\r\n    MiniNormalizedBar,\r\n    MiniNormalizedColumn,\r\n    MiniNormalizedLine,\r\n    MiniPie,\r\n    MiniRadarArea,\r\n    MiniRadarLine,\r\n    MiniRadialBar,\r\n    MiniRadialColumn,\r\n    MiniRangeArea,\r\n    MiniRangeBar,\r\n    MiniScatter,\r\n    MiniStackedArea,\r\n    MiniStackedBar,\r\n    MiniStackedColumn,\r\n    MiniStackedLine,\r\n    MiniSunburst,\r\n    MiniTreemap,\r\n    MiniWaterfall,\r\n} from './miniCharts/index';\r\n// please leave this as is - we want it to be explicit for build reasons\r\nimport type { MiniChart } from './miniCharts/miniChart';\r\n\r\nexport type ThemeTemplateParameters = Map<any, any>;\r\n\r\ntype MiniChartMenuMapping = {\r\n    [K in keyof ChartGroupsDef]-?: MiniChartMenuGroup<K>;\r\n};\r\n\r\ntype MiniChartMenuGroup<K extends keyof ChartGroupsDef> = {\r\n    [T in NonNullable<ChartGroupsDef[K]>[number]]: MiniChartMenuItem;\r\n};\r\n\r\ninterface MiniChartMenuItem {\r\n    range: boolean;\r\n    pivot: boolean;\r\n    enterprise: boolean;\r\n    icon: MiniChartConstructor;\r\n}\r\n\r\ntype MiniChartConstructor = {\r\n    chartType: ChartType;\r\n    new (...args: any[]): MiniChart;\r\n};\r\n\r\nconst miniChartMapping: MiniChartMenuMapping = {\r\n    columnGroup: {\r\n        column: { range: true, pivot: true, enterprise: false, icon: MiniColumn },\r\n        stackedColumn: { range: true, pivot: true, enterprise: false, icon: MiniStackedColumn },\r\n        normalizedColumn: { range: true, pivot: true, enterprise: false, icon: MiniNormalizedColumn },\r\n    },\r\n    barGroup: {\r\n        bar: { range: true, pivot: true, enterprise: false, icon: MiniBar },\r\n        stackedBar: { range: true, pivot: true, enterprise: false, icon: MiniStackedBar },\r\n        normalizedBar: { range: true, pivot: true, enterprise: false, icon: MiniNormalizedBar },\r\n    },\r\n    pieGroup: {\r\n        pie: { range: true, pivot: true, enterprise: false, icon: MiniPie },\r\n        donut: { range: true, pivot: true, enterprise: false, icon: MiniDonut },\r\n        doughnut: { range: true, pivot: true, enterprise: false, icon: MiniDonut },\r\n    },\r\n    lineGroup: {\r\n        line: { range: true, pivot: true, enterprise: false, icon: MiniLine },\r\n        stackedLine: { range: true, pivot: true, enterprise: false, icon: MiniStackedLine },\r\n        normalizedLine: { range: true, pivot: true, enterprise: false, icon: MiniNormalizedLine },\r\n    },\r\n    scatterGroup: {\r\n        scatter: { range: true, pivot: true, enterprise: false, icon: MiniScatter },\r\n        bubble: { range: true, pivot: true, enterprise: false, icon: MiniBubble },\r\n    },\r\n    areaGroup: {\r\n        area: { range: true, pivot: true, enterprise: false, icon: MiniArea },\r\n        stackedArea: { range: true, pivot: true, enterprise: false, icon: MiniStackedArea },\r\n        normalizedArea: { range: true, pivot: true, enterprise: false, icon: MiniNormalizedArea },\r\n    },\r\n    polarGroup: {\r\n        radarLine: { range: true, pivot: false, enterprise: true, icon: MiniRadarLine },\r\n        radarArea: { range: true, pivot: false, enterprise: true, icon: MiniRadarArea },\r\n        nightingale: { range: true, pivot: false, enterprise: true, icon: MiniNightingale },\r\n        radialColumn: { range: true, pivot: false, enterprise: true, icon: MiniRadialColumn },\r\n        radialBar: { range: true, pivot: false, enterprise: true, icon: MiniRadialBar },\r\n    },\r\n    statisticalGroup: {\r\n        boxPlot: { range: true, pivot: false, enterprise: true, icon: MiniBoxPlot },\r\n        histogram: { range: true, pivot: false, enterprise: false, icon: MiniHistogram },\r\n        rangeBar: { range: true, pivot: false, enterprise: true, icon: MiniRangeBar },\r\n        rangeArea: { range: true, pivot: false, enterprise: true, icon: MiniRangeArea },\r\n    },\r\n    hierarchicalGroup: {\r\n        treemap: { range: true, pivot: true, enterprise: true, icon: MiniTreemap },\r\n        sunburst: { range: true, pivot: true, enterprise: true, icon: MiniSunburst },\r\n    },\r\n    specializedGroup: {\r\n        heatmap: { range: true, pivot: false, enterprise: true, icon: MiniHeatmap },\r\n        waterfall: { range: true, pivot: false, enterprise: true, icon: MiniWaterfall },\r\n    },\r\n    combinationGroup: {\r\n        columnLineCombo: { range: true, pivot: true, enterprise: false, icon: MiniColumnLineCombo },\r\n        areaColumnCombo: { range: true, pivot: true, enterprise: false, icon: MiniAreaColumnCombo },\r\n        customCombo: { range: true, pivot: true, enterprise: false, icon: MiniCustomCombo },\r\n    },\r\n};\r\n\r\nconst DEFAULT_CHART_GROUPS: ChartGroupsDef = {\r\n    columnGroup: ['column', 'stackedColumn', 'normalizedColumn'],\r\n    barGroup: ['bar', 'stackedBar', 'normalizedBar'],\r\n    pieGroup: ['pie', 'donut'],\r\n    lineGroup: ['line', 'stackedLine', 'normalizedLine'],\r\n    areaGroup: ['area', 'stackedArea', 'normalizedArea'],\r\n    scatterGroup: ['scatter', 'bubble'],\r\n    polarGroup: ['radarLine', 'radarArea', 'nightingale', 'radialColumn', 'radialBar'],\r\n    statisticalGroup: ['boxPlot', 'histogram', 'rangeBar', 'rangeArea'],\r\n    hierarchicalGroup: ['treemap', 'sunburst'],\r\n    specializedGroup: ['heatmap', 'waterfall'],\r\n    combinationGroup: ['columnLineCombo', 'areaColumnCombo', 'customCombo'],\r\n};\r\n\r\nexport class MiniChartsContainer extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    private readonly fills: string[];\r\n    private readonly strokes: string[];\r\n    private readonly themeTemplateParameters: ThemeTemplateParameters;\r\n    private readonly isCustomTheme: boolean;\r\n    private wrappers: Map<ChartType, HTMLElement> = new Map();\r\n    private chartController: ChartController;\r\n\r\n    private chartGroups: ChartGroupsDef;\r\n\r\n    constructor(\r\n        chartController: ChartController,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplateParameters: ThemeTemplateParameters,\r\n        isCustomTheme: boolean,\r\n        chartGroups: ChartGroupsDef = DEFAULT_CHART_GROUPS\r\n    ) {\r\n        super(/* html */ `<div class=\"ag-chart-settings-mini-wrapper\"></div>`);\r\n\r\n        this.chartController = chartController;\r\n        this.fills = fills;\r\n        this.strokes = strokes;\r\n        this.themeTemplateParameters = themeTemplateParameters;\r\n        this.isCustomTheme = isCustomTheme;\r\n        this.chartGroups = { ...chartGroups };\r\n    }\r\n\r\n    public postConstruct() {\r\n        // hide MiniCustomCombo if no custom combo exists\r\n        if (!this.chartController.customComboExists() && this.chartGroups.combinationGroup) {\r\n            this.chartGroups.combinationGroup = this.chartGroups.combinationGroup.filter(\r\n                (chartType) => chartType !== 'customCombo'\r\n            );\r\n        }\r\n\r\n        const eGui = this.getGui();\r\n        const isEnterprise = this.chartController.isEnterprise();\r\n        const isPivotChart = this.chartController.isPivotChart();\r\n        const isRangeChart = !isPivotChart;\r\n\r\n        // Determine the set of chart types that are specified by the chartGroupsDef config, filtering out any entries\r\n        // that are invalid for the current chart configuration (pivot/range) and license type\r\n        const displayedMenuGroups = Object.keys(this.chartGroups)\r\n            .map((group: keyof ChartGroupsDef) => {\r\n                const menuGroup =\r\n                    group in miniChartMapping ? miniChartMapping[group as keyof typeof miniChartMapping] : undefined;\r\n                if (!menuGroup) {\r\n                    // User has specified an invalid chart group in the chartGroupsDef config\r\n                    _warn(148, { group });\r\n                    return null;\r\n                }\r\n\r\n                // Determine the valid chart types within this group, based on the chartGroupsDef config\r\n                const chartGroupValues = this.chartGroups[group as keyof ChartGroupsDef] ?? [];\r\n                const menuItems = chartGroupValues\r\n                    .map((chartType) => {\r\n                        const menuItem =\r\n                            chartType in menuGroup\r\n                                ? (menuGroup as Record<typeof chartType, MiniChartMenuItem>)[chartType]\r\n                                : undefined;\r\n\r\n                        if (!menuItem) {\r\n                            // User has specified an invalid chart type in the chartGroupsDef config\r\n                            _warn(149, { group, chartType });\r\n                            return null;\r\n                        }\r\n\r\n                        if (!isEnterprise && menuItem.enterprise) {\r\n                            return null; // skip enterprise charts if community\r\n                        }\r\n                        // Only show the chart if it is valid for the current chart configuration (pivot/range)\r\n                        if (isRangeChart && menuItem.range) return menuItem;\r\n                        if (isPivotChart && menuItem.pivot) return menuItem;\r\n                        return null;\r\n                    })\r\n                    .filter((menuItem): menuItem is NonNullable<typeof menuItem> => menuItem != null);\r\n\r\n                if (menuItems.length === 0) return null; // don't render empty chart groups\r\n\r\n                return {\r\n                    label: this.chartTranslation.translate(group),\r\n                    items: menuItems,\r\n                };\r\n            })\r\n            .filter((menuGroup): menuGroup is NonNullable<typeof menuGroup> => menuGroup != null);\r\n\r\n        // Render the filtered menu items\r\n        for (const { label, items } of displayedMenuGroups) {\r\n            const groupComponent = this.createBean(\r\n                new AgGroupComponent({\r\n                    title: label,\r\n                    suppressEnabledCheckbox: true,\r\n                    enabled: true,\r\n                    suppressOpenCloseIcons: true,\r\n                    cssIdentifier: 'charts-settings',\r\n                    direction: 'horizontal',\r\n                    suppressKeyboardNavigation: true,\r\n                })\r\n            );\r\n\r\n            for (const menuItem of items) {\r\n                const MiniClass = menuItem.icon;\r\n                const miniWrapper = document.createElement('div');\r\n                miniWrapper.classList.add('ag-chart-mini-thumbnail');\r\n                miniWrapper.setAttribute('tabindex', '0');\r\n                miniWrapper.setAttribute('role', 'button');\r\n\r\n                const miniClassChartType: ChartType = MiniClass.chartType;\r\n                const listener = () => {\r\n                    this.chartController.setChartType(miniClassChartType);\r\n                    this.updateSelectedMiniChart();\r\n                };\r\n                this.addManagedListeners(miniWrapper, {\r\n                    click: listener,\r\n                    keydown: (event) => {\r\n                        if (event.key == KeyCode.ENTER || event.key === KeyCode.SPACE) {\r\n                            event.preventDefault();\r\n                            listener();\r\n                        }\r\n                    },\r\n                });\r\n\r\n                this.wrappers.set(miniClassChartType, miniWrapper);\r\n\r\n                this.createBean(\r\n                    new MiniClass(\r\n                        miniWrapper,\r\n                        this.beans.agChartsExports,\r\n                        this.fills,\r\n                        this.strokes,\r\n                        this.themeTemplateParameters,\r\n                        this.isCustomTheme\r\n                    )\r\n                );\r\n                groupComponent.addItem(miniWrapper);\r\n            }\r\n\r\n            eGui.appendChild(groupComponent.getGui());\r\n        }\r\n\r\n        this.updateSelectedMiniChart();\r\n    }\r\n\r\n    public updateSelectedMiniChart(): void {\r\n        const selectedChartType = this.chartController.getChartType();\r\n        this.wrappers.forEach((miniChart, miniChartType) => {\r\n            const selected = miniChartType === selectedChartType;\r\n            miniChart.classList.toggle('ag-selected', selected);\r\n\r\n            const chartName = this.chartTranslation.translate(getFullChartNameTranslationKey(miniChartType));\r\n            const ariaLabel = selected\r\n                ? `${chartName}. ${this.chartTranslation.translate('ariaChartSelected')}`\r\n                : chartName;\r\n            _setAriaLabel(miniChart, ariaLabel);\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        this.wrappers.clear();\r\n        super.destroy();\r\n    }\r\n}\r\n", "import { _last } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../agChartsExports';\r\nimport type { CommandSegment } from './miniChartApi';\r\n\r\ninterface CreateColumnRectsParams {\r\n    agChartsExports: AgChartsExports;\r\n    stacked: boolean;\r\n    root: any;\r\n    data: any;\r\n    size: number;\r\n    padding: number;\r\n    xScaleDomain: number[];\r\n    yScaleDomain: number[];\r\n    xScalePadding: number;\r\n}\r\n\r\nexport function createColumnRects(params: CreateColumnRectsParams) {\r\n    const {\r\n        stacked,\r\n        size,\r\n        padding,\r\n        xScalePadding,\r\n        xScaleDomain,\r\n        yScaleDomain,\r\n        agChartsExports: { _Scene },\r\n    } = params;\r\n\r\n    const xScale = new _Scene.BandScale();\r\n    xScale.domain = xScaleDomain;\r\n    xScale.range = [padding, size - padding];\r\n    xScale.paddingInner = xScalePadding;\r\n    xScale.paddingOuter = xScalePadding;\r\n\r\n    const yScale = new _Scene.LinearScale();\r\n    yScale.domain = yScaleDomain;\r\n    yScale.range = [size - padding, padding];\r\n\r\n    const createBars = (series: number[], xScale: any, yScale: any) => {\r\n        return series.map((datum: number, i: number) => {\r\n            const top = yScale.convert(datum);\r\n            const rect = new _Scene.Rect();\r\n            rect.x = xScale.convert(i);\r\n            rect.y = top;\r\n            rect.width = xScale.bandwidth;\r\n            rect.height = yScale.convert(0) - top;\r\n            rect.strokeWidth = 0;\r\n            rect.crisp = true;\r\n\r\n            return rect;\r\n        });\r\n    };\r\n\r\n    if (stacked) {\r\n        return params.data.map((d: number[]) => createBars(d, xScale, yScale));\r\n    }\r\n\r\n    return createBars(params.data, xScale, yScale);\r\n}\r\n\r\nexport function prepareLinearScene(_Scene: AgChartsExports['_Scene'], data: number[][], size: number, padding: number) {\r\n    const xDomain = [0, data[0].length - 1];\r\n    const yDomain = data.reduce(\r\n        (acc, curr) => {\r\n            curr.forEach((datum) => {\r\n                if (datum < acc[0]) {\r\n                    acc[0] = datum;\r\n                }\r\n\r\n                if (datum > acc[1]) {\r\n                    acc[1] = datum;\r\n                }\r\n            });\r\n\r\n            return acc;\r\n        },\r\n        [Infinity, -Infinity]\r\n    );\r\n\r\n    yDomain[0]--;\r\n    yDomain[yDomain.length - 1]++;\r\n\r\n    const xScale = new _Scene.LinearScale();\r\n    xScale.domain = xDomain;\r\n    xScale.range = [padding, size - padding];\r\n\r\n    const yScale = new _Scene.LinearScale();\r\n    yScale.domain = yDomain;\r\n    yScale.range = [size - padding, padding];\r\n\r\n    return { xScale, yScale };\r\n}\r\n\r\nexport function createPathCommands(data: number[][], xScale: any, yScale: any): CommandSegment[][] {\r\n    return data.map((series) =>\r\n        series.map((datum: number, i: number) => [\r\n            i > 0 ? 'lineTo' : 'moveTo',\r\n            xScale.convert(i),\r\n            yScale.convert(datum),\r\n        ])\r\n    );\r\n}\r\n\r\nexport function createPath(_Scene: AgChartsExports['_Scene'], commands: CommandSegment[]): any {\r\n    const path = new _Scene.Path();\r\n    commands.forEach(([command, x, y]: CommandSegment) => path.path[command](x, y));\r\n    return path;\r\n}\r\n\r\nexport function createAreaPathCommands(\r\n    commands: CommandSegment[][],\r\n    yScale: any,\r\n    stacked: boolean\r\n): CommandSegment[][] {\r\n    return commands.map((pathCommands: CommandSegment[], index, all) => {\r\n        const closingPath = stacked\r\n            ? closePathViaPreviousSeries(all, index, yScale)\r\n            : closePathViaOrigin(pathCommands, yScale);\r\n\r\n        // reverse path to maintain CW winding order\r\n        const closingPathCommands: CommandSegment[] = [...closingPath]\r\n            .reverse()\r\n            .map(([_, x, y]: CommandSegment) => ['lineTo', x, y]);\r\n\r\n        const first: CommandSegment = pathCommands[0];\r\n        const last = _last(closingPathCommands);\r\n\r\n        // close the path if needed\r\n        if (first[1] !== last[1] || first[2] !== last[2]) {\r\n            closingPathCommands.push(['lineTo', first[1], first[2]]);\r\n        }\r\n\r\n        return [...pathCommands, ...closingPathCommands] as CommandSegment[];\r\n    });\r\n}\r\n\r\nexport function closePathViaPreviousSeries(all: CommandSegment[][], index: number, yScale: any) {\r\n    if (index === 0) {\r\n        return closePathViaOrigin(all[index], yScale);\r\n    }\r\n    return [...all[index - 1]];\r\n}\r\n\r\nexport function closePathViaOrigin(pathCommands: CommandSegment[], yScale: any) {\r\n    return pathCommands.map(([c, x]) => [c, x, yScale.convert(0)]);\r\n}\r\n\r\nexport function createLinePaths(\r\n    { _Scene }: AgChartsExports,\r\n    root: any,\r\n    data: number[][],\r\n    size: number,\r\n    padding: number\r\n): any[] {\r\n    const { xScale, yScale } = prepareLinearScene(_Scene, data, size, padding);\r\n\r\n    const pathCommands = createPathCommands(data, xScale, yScale);\r\n\r\n    const paths: any[] = pathCommands.map((commands) => {\r\n        const path = createPath(_Scene, commands);\r\n        path.strokeWidth = 3;\r\n        path.lineCap = 'round';\r\n        path.fill = undefined;\r\n        return path;\r\n    });\r\n\r\n    const pathsGroup = new _Scene.Group();\r\n    pathsGroup.setClipRect(new _Scene.BBox(padding, padding, size - padding * 2, size - padding * 2));\r\n    pathsGroup.append(paths);\r\n    root.append(pathsGroup);\r\n\r\n    return paths;\r\n}\r\n\r\nexport function createAreaPaths(\r\n    _Scene: AgChartsExports['_Scene'],\r\n    root: any,\r\n    data: number[][],\r\n    size: number,\r\n    padding: number,\r\n    stacked = false\r\n): any[] {\r\n    const { xScale, yScale } = prepareLinearScene(_Scene, data, size, padding);\r\n\r\n    const pathCommands = createAreaPathCommands(createPathCommands(data, xScale, yScale), yScale, stacked);\r\n\r\n    const areasGroup = new _Scene.Group();\r\n    areasGroup.setClipRect(new _Scene.BBox(padding, padding, size - padding * 2, size - padding * 2));\r\n\r\n    const paths: any[] = pathCommands.map((commands) => createPath(_Scene, commands));\r\n    areasGroup.append(paths);\r\n    root.append(areasGroup);\r\n\r\n    return paths;\r\n}\r\n\r\nexport function stackData(data: number[][]): number[][] {\r\n    return data.map((stack, sindex, array) =>\r\n        stack.map((_y, i) => array.slice(0, sindex + 1).reduce((p, c) => p + c[i], 0))\r\n    );\r\n}\r\n\r\nexport function normalizeStackData(data: number[][]): number[][] {\r\n    const colSum = data.map((_, index) => data.reduce((acc, cur) => Math.max(acc, cur[index]), 0));\r\n    return data.map((stack) => stack.map((y, index) => (y / colSum[index]) * 19));\r\n}\r\n\r\nexport function createPolarPaths(\r\n    agChartsExports: AgChartsExports,\r\n    root: any,\r\n    data: number[][],\r\n    size: number,\r\n    radius: number,\r\n    innerRadius: number,\r\n    markerSize: number = 0\r\n): { paths: any[]; markers: any[] } {\r\n    const { _Scene } = agChartsExports;\r\n\r\n    const angleScale = new _Scene.LinearScale();\r\n    angleScale.domain = [0, 7];\r\n    angleScale.range = [-Math.PI, Math.PI].map((angle) => angle + Math.PI / 2);\r\n\r\n    const radiusScale = new _Scene.LinearScale();\r\n    radiusScale.domain = [0, 10];\r\n    radiusScale.range = [radius, innerRadius];\r\n\r\n    const markers: any[] = [];\r\n    const center = size / 2;\r\n\r\n    const paths: any[] = data.map((series) => {\r\n        const path = new _Scene.Path();\r\n        path.strokeWidth = 1;\r\n        path.strokeOpacity = 0.5;\r\n        path.lineCap = 'round';\r\n        path.fill = undefined;\r\n        path.fillOpacity = 0.8;\r\n\r\n        series.forEach((datum: number, i: number) => {\r\n            const angle = angleScale.convert(i);\r\n            const r = radius + innerRadius - radiusScale.convert(datum);\r\n\r\n            const x = r * Math.cos(angle) + center;\r\n            const y = r * Math.sin(angle) + center;\r\n\r\n            path.path[i > 0 ? 'lineTo' : 'moveTo'](x, y);\r\n\r\n            if (markerSize > 0) {\r\n                const marker = new _Scene.Circle();\r\n                marker.x = x;\r\n                marker.y = y;\r\n                marker.size = markerSize;\r\n                markers.push(marker);\r\n            }\r\n        });\r\n\r\n        path.path.closePath();\r\n        return path;\r\n    });\r\n\r\n    const group = new _Scene.Group();\r\n\r\n    group.append([...paths, ...markers]);\r\n    root.append(group);\r\n\r\n    return { paths, markers };\r\n}\r\n\r\nexport function accumulateData(data: number[][]): { processedData: number[][]; min: number; max: number } {\r\n    let [min, max] = [Infinity, -Infinity];\r\n    const processedData = data.reduce((acc, curr, currIndex) => {\r\n        const previous = currIndex > 0 ? acc[currIndex - 1] : undefined;\r\n        acc[currIndex] ??= [];\r\n        const current = acc[currIndex];\r\n        curr.forEach((datum, datumIndex) => {\r\n            if (previous) {\r\n                datum += previous[datumIndex];\r\n            }\r\n\r\n            current[datumIndex] = datum;\r\n\r\n            if (current[datumIndex] < min) {\r\n                min = current[datumIndex];\r\n            }\r\n\r\n            if (current[datumIndex] > max) {\r\n                max = current[datumIndex];\r\n            }\r\n        });\r\n        return acc;\r\n    }, [] as number[][]);\r\n\r\n    return { processedData, min, max };\r\n}\r\n", "import type { Group, Scene } from 'ag-charts-types/scene';\r\n\r\nimport type { BeanCollection } from 'ag-grid-community';\r\nimport { Component, _error } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../agChartsExports';\r\nimport type { ChartTranslationKey, ChartTranslationService } from '../../../services/chartTranslationService';\r\n\r\nconst CANVAS_CLASS = 'ag-chart-mini-thumbnail-canvas';\r\n\r\nexport abstract class MiniChart extends Component {\r\n    private chartTranslation: ChartTranslationService;\r\n\r\n    public wireBeans(beans: BeanCollection): void {\r\n        this.chartTranslation = beans.chartTranslation as ChartTranslationService;\r\n    }\r\n\r\n    protected readonly size: number = 58;\r\n    protected readonly padding: number = 5;\r\n    protected readonly root: Group;\r\n    protected readonly scene: Scene;\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        protected readonly agChartsExports: AgChartsExports,\r\n        protected tooltipName: ChartTranslationKey\r\n    ) {\r\n        super();\r\n\r\n        const { _Scene } = agChartsExports;\r\n\r\n        this.root = new _Scene.Group();\r\n        const scene = new _Scene.Scene({\r\n            width: this.size,\r\n            height: this.size,\r\n        });\r\n\r\n        scene.canvas.element.classList.add(CANVAS_CLASS);\r\n        scene.setRoot(this.root);\r\n        scene.setContainer(container);\r\n\r\n        this.scene = scene;\r\n    }\r\n\r\n    public postConstruct(): void {\r\n        this.scene.canvas.element.title = this.chartTranslation.translate(this.tooltipName);\r\n\r\n        // Necessary to force scene graph render as we are not using the standalone factory.\r\n        try {\r\n            this.scene.render();\r\n        } catch (e) {\r\n            _error(108, { e });\r\n        }\r\n    }\r\n\r\n    abstract updateColors(fills: string[], strokes: string[]): void;\r\n}\r\n", "import type { AgChartsExports } from '../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../services/chartTranslationService';\r\nimport { MiniChart } from './miniChart';\r\n\r\nexport abstract class MiniChartWithAxes extends MiniChart {\r\n    private readonly stroke = 'gray';\r\n    private readonly axisOvershoot = 3;\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, tooltipName: ChartTranslationKey) {\r\n        super(container, agChartsExports, tooltipName);\r\n    }\r\n\r\n    public override postConstruct() {\r\n        const { _Scene } = this.agChartsExports;\r\n        const size = this.size;\r\n        const padding = this.padding;\r\n\r\n        const leftAxis = new _Scene.Line();\r\n        leftAxis.x1 = padding;\r\n        leftAxis.y1 = padding;\r\n        leftAxis.x2 = padding;\r\n        leftAxis.y2 = size - padding + this.axisOvershoot;\r\n        leftAxis.stroke = this.stroke;\r\n\r\n        const bottomAxis = new _Scene.Line();\r\n        bottomAxis.x1 = padding - this.axisOvershoot + 1;\r\n        bottomAxis.y1 = size - padding;\r\n        bottomAxis.x2 = size - padding + 1;\r\n        bottomAxis.y2 = size - padding;\r\n        bottomAxis.stroke = this.stroke;\r\n\r\n        const root = this.root;\r\n\r\n        root.append(leftAxis);\r\n        root.append(bottomAxis);\r\n        super.postConstruct();\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { createColumnRects } from '../miniChartHelpers';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniColumn extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'groupedColumn';\r\n\r\n    private readonly columns: any[];\r\n\r\n    private columnData = [2, 3, 4];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'groupedColumnTooltip');\r\n\r\n        const { root, columnData, size, padding } = this;\r\n\r\n        this.columns = createColumnRects({\r\n            stacked: false,\r\n            root,\r\n            data: columnData,\r\n            size,\r\n            padding,\r\n            xScaleDomain: [0, 1, 2],\r\n            yScaleDomain: [0, 4],\r\n            xScalePadding: 0.3,\r\n            agChartsExports,\r\n        });\r\n\r\n        root.append(this.columns);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.columns.forEach((column: any, i) => {\r\n            column.fill = fills[i];\r\n            column.stroke = strokes[i];\r\n        });\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { createColumnRects } from '../miniChartHelpers';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniStackedColumn extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'stackedColumn';\r\n\r\n    private readonly stackedColumns: any[][];\r\n\r\n    static data = [\r\n        [8, 12, 16],\r\n        [6, 9, 12],\r\n        [2, 3, 4],\r\n    ];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        _themeTemplateParameters: ThemeTemplateParameters,\r\n        _isCustomTheme: boolean,\r\n        data = MiniStackedColumn.data,\r\n        yScaleDomain = [0, 16],\r\n        tooltipName: ChartTranslationKey = 'stackedColumnTooltip'\r\n    ) {\r\n        super(container, agChartsExports, tooltipName);\r\n\r\n        const { root, size, padding } = this;\r\n\r\n        this.stackedColumns = createColumnRects({\r\n            stacked: true,\r\n            root,\r\n            data,\r\n            size,\r\n            padding,\r\n            xScaleDomain: [0, 1, 2],\r\n            yScaleDomain,\r\n            xScalePadding: 0.3,\r\n            agChartsExports,\r\n        });\r\n\r\n        root.append(([] as any[]).concat.apply([], this.stackedColumns));\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.stackedColumns.forEach((series: any[], i: number) =>\r\n            series.forEach((column) => {\r\n                column.fill = fills[i];\r\n                column.stroke = strokes[i];\r\n            })\r\n        );\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniStackedColumn } from './miniStackedColumn';\r\n\r\nexport class MiniNormalizedColumn extends MiniStackedColumn {\r\n    static override chartType: ChartType = 'normalizedColumn';\r\n    static override data = [\r\n        [10, 10, 10],\r\n        [6, 7, 8],\r\n        [2, 4, 6],\r\n    ];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplateParameters: ThemeTemplateParameters,\r\n        isCustomTheme: boolean\r\n    ) {\r\n        super(\r\n            container,\r\n            agChartsExports,\r\n            fills,\r\n            strokes,\r\n            themeTemplateParameters,\r\n            isCustomTheme,\r\n            MiniNormalizedColumn.data,\r\n            [0, 10],\r\n            'normalizedColumnTooltip'\r\n        );\r\n    }\r\n}\r\n", "import type { Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniBar extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'groupedBar';\r\n    private readonly bars: Rect[];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'groupedBarTooltip');\r\n        const { _Scene } = agChartsExports;\r\n\r\n        const padding = this.padding;\r\n        const size = this.size;\r\n        const data = [2, 3, 4];\r\n\r\n        const yScale = new _Scene.BandScale();\r\n        yScale.domain = [0, 1, 2];\r\n        yScale.range = [padding, size - padding];\r\n        yScale.paddingInner = 0.3;\r\n        yScale.paddingOuter = 0.3;\r\n\r\n        const xScale = new _Scene.LinearScale();\r\n        xScale.domain = [0, 4];\r\n        xScale.range = [size - padding, padding];\r\n\r\n        const bottom = xScale.convert(0);\r\n        const height = yScale.bandwidth;\r\n\r\n        this.bars = data.map((datum, i) => {\r\n            const rect = new _Scene.Rect();\r\n            rect.x = padding;\r\n            rect.y = yScale.convert(i);\r\n            rect.width = bottom - xScale.convert(datum);\r\n            rect.height = height;\r\n            rect.strokeWidth = 0;\r\n            rect.crisp = true;\r\n\r\n            return rect;\r\n        });\r\n\r\n        this.updateColors(fills, strokes);\r\n        this.root.append(this.bars);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.bars.forEach((bar, i) => {\r\n            bar.fill = fills[i];\r\n            bar.stroke = strokes[i];\r\n        });\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniStackedBar extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'stackedBar';\r\n    static data = [\r\n        [8, 12, 16],\r\n        [6, 9, 12],\r\n        [2, 3, 4],\r\n    ];\r\n\r\n    private readonly bars: any[][];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        _themeTemplateParameters: ThemeTemplateParameters,\r\n        _isCustomTheme: boolean,\r\n        data = MiniStackedBar.data,\r\n        xScaleDomain = [0, 16],\r\n        tooltipName: ChartTranslationKey = 'stackedBarTooltip'\r\n    ) {\r\n        super(container, agChartsExports, tooltipName);\r\n\r\n        const { _Scene } = agChartsExports;\r\n        const size = this.size;\r\n        const padding = this.padding;\r\n\r\n        const yScale = new _Scene.BandScale();\r\n        yScale.domain = [0, 1, 2];\r\n        yScale.range = [padding, size - padding];\r\n        yScale.paddingInner = 0.3;\r\n        yScale.paddingOuter = 0.3;\r\n\r\n        const xScale = new _Scene.LinearScale();\r\n        xScale.domain = xScaleDomain;\r\n        xScale.range = [size - padding, padding];\r\n\r\n        const bottom = xScale.convert(0);\r\n        const height = yScale.bandwidth;\r\n\r\n        this.bars = data.map((series) =>\r\n            series.map((datum, i) => {\r\n                const rect = new _Scene.Rect();\r\n                rect.x = padding;\r\n                rect.y = yScale.convert(i);\r\n                rect.width = bottom - xScale.convert(datum);\r\n                rect.height = height;\r\n                rect.strokeWidth = 0;\r\n                rect.crisp = true;\r\n\r\n                return rect;\r\n            })\r\n        );\r\n\r\n        this.updateColors(fills, strokes);\r\n        this.root.append(([] as any[]).concat.apply([], this.bars));\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.bars.forEach((series, i) =>\r\n            series.forEach((bar) => {\r\n                bar.fill = fills[i];\r\n                bar.stroke = strokes[i];\r\n            })\r\n        );\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniStackedBar } from './miniStackedBar';\r\n\r\nexport class MiniNormalizedBar extends MiniStackedBar {\r\n    static override chartType: ChartType = 'normalizedBar';\r\n    static override data = [\r\n        [10, 10, 10],\r\n        [6, 7, 8],\r\n        [2, 4, 6],\r\n    ];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplateParameters: ThemeTemplateParameters,\r\n        isCustomTheme: boolean\r\n    ) {\r\n        super(\r\n            container,\r\n            agChartsExports,\r\n            fills,\r\n            strokes,\r\n            themeTemplateParameters,\r\n            isCustomTheme,\r\n            MiniNormalizedBar.data,\r\n            [0, 10],\r\n            'normalizedBarTooltip'\r\n        );\r\n    }\r\n}\r\n", "import type { Sector } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniChart } from '../miniChart';\r\n\r\nexport class MiniDonut extends MiniChart {\r\n    static chartType: ChartType = 'donut';\r\n    private readonly sectors: Sector[];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        _themeTemplateParameters: ThemeTemplateParameters,\r\n        _isCustomTheme: boolean,\r\n        centerRadiusScaler = 0.6,\r\n        tooltipName: ChartTranslationKey = 'donutTooltip'\r\n    ) {\r\n        super(container, agChartsExports, tooltipName);\r\n\r\n        const {\r\n            size,\r\n            padding,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n        const radius = (size - padding * 2) / 2;\r\n        const center = radius + padding;\r\n        const toRadians = _Scene.toRadians;\r\n        const angles = [\r\n            [toRadians(-90), toRadians(30)],\r\n            [toRadians(30), toRadians(120)],\r\n            [toRadians(120), toRadians(180)],\r\n            [toRadians(180), toRadians(210)],\r\n            [toRadians(210), toRadians(240)],\r\n            [toRadians(240), toRadians(270)],\r\n        ];\r\n\r\n        this.sectors = angles.map(([startAngle, endAngle]) => {\r\n            const sector = new _Scene.Sector();\r\n            sector.centerX = center;\r\n            sector.centerY = center;\r\n            sector.innerRadius = radius * centerRadiusScaler;\r\n            sector.outerRadius = radius;\r\n            sector.startAngle = startAngle;\r\n            sector.endAngle = endAngle;\r\n            sector.stroke = undefined;\r\n            sector.strokeWidth = 0;\r\n            sector.inset = 0.75;\r\n            return sector;\r\n        });\r\n\r\n        this.updateColors(fills, strokes);\r\n        this.root.append(this.sectors);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.sectors.forEach((sector, i) => {\r\n            sector.fill = fills[i % fills.length];\r\n            sector.stroke = strokes[i % strokes.length];\r\n        });\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniDonut } from './miniDonut';\r\n\r\nexport class MiniPie extends MiniDonut {\r\n    static override chartType: ChartType = 'pie';\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplateParameters: ThemeTemplateParameters,\r\n        isCustomTheme: boolean\r\n    ) {\r\n        super(container, agChartsExports, fills, strokes, themeTemplateParameters, isCustomTheme, 0, 'pieTooltip');\r\n    }\r\n}\r\n", "import type { Path } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { createLinePaths } from '../miniChartHelpers';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniLine extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'line';\r\n\r\n    protected lines: Path[];\r\n\r\n    static readonly data = [\r\n        [1, 3, 5],\r\n        [2, 6, 4],\r\n        [5, 3, 1],\r\n    ];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        _themeTemplateParameters: ThemeTemplateParameters,\r\n        _isCustomTheme: boolean,\r\n        data: number[][] = MiniLine.data,\r\n        tooltipName: ChartTranslationKey = 'lineTooltip'\r\n    ) {\r\n        super(container, agChartsExports, tooltipName);\r\n\r\n        const { size, padding, root } = this;\r\n        this.lines = createLinePaths(agChartsExports, root, data, size, padding);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], _strokes: string[]) {\r\n        this.lines.forEach((line: any, i: number) => {\r\n            line.stroke = fills[i];\r\n        });\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { stackData } from '../miniChartHelpers';\r\nimport { MiniLine } from './miniLine';\r\n\r\nexport class MiniStackedLine extends MiniLine {\r\n    static override chartType: ChartType = 'stackedLine';\r\n\r\n    static override readonly data = stackData(MiniLine.data);\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        _themeTemplateParameters: ThemeTemplateParameters,\r\n        _isCustomTheme: boolean,\r\n        data: number[][] = MiniStackedLine.data,\r\n        tooltipName: ChartTranslationKey = 'stackedLineTooltip'\r\n    ) {\r\n        super(container, agChartsExports, fills, strokes, _themeTemplateParameters, _isCustomTheme, data, tooltipName);\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { normalizeStackData } from '../miniChartHelpers';\r\nimport { MiniLine } from './miniLine';\r\nimport { MiniStackedLine } from './miniStackedLine';\r\n\r\nexport class MiniNormalizedLine extends MiniLine {\r\n    static override chartType: ChartType = 'normalizedLine';\r\n\r\n    static override readonly data = normalizeStackData(MiniStackedLine.data);\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplateParameters: ThemeTemplateParameters,\r\n        isCustomTheme: boolean,\r\n        data: number[][] = MiniNormalizedLine.data,\r\n        tooltipName: ChartTranslationKey = 'normalizedLineTooltip'\r\n    ) {\r\n        super(container, agChartsExports, fills, strokes, themeTemplateParameters, isCustomTheme, data, tooltipName);\r\n    }\r\n}\r\n", "import type { Shape } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniScatter extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'scatter';\r\n    private readonly points: Shape[];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'scatterTooltip');\r\n\r\n        const {\r\n            size,\r\n            padding,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        // [x, y] pairs\r\n        const data = [\r\n            [\r\n                [0.3, 3],\r\n                [1.1, 0.9],\r\n                [2, 0.4],\r\n                [3.4, 2.4],\r\n            ],\r\n            [\r\n                [0, 0.3],\r\n                [1, 2],\r\n                [2.4, 1.4],\r\n                [3, 0],\r\n            ],\r\n        ];\r\n\r\n        const xScale = new _Scene.LinearScale();\r\n        xScale.domain = [-0.5, 4];\r\n        xScale.range = [padding * 2, size - padding];\r\n\r\n        const yScale = new _Scene.LinearScale();\r\n        yScale.domain = [-0.5, 3.5];\r\n        yScale.range = [size - padding, padding];\r\n\r\n        const points: any[] = [];\r\n\r\n        data.forEach((series) => {\r\n            series.forEach(([x, y]) => {\r\n                const arc = new _Scene.Arc();\r\n                arc.strokeWidth = 0;\r\n                arc.centerX = xScale.convert(x);\r\n                arc.centerY = yScale.convert(y);\r\n                arc.radius = 2.5;\r\n                points.push(arc);\r\n            });\r\n        });\r\n\r\n        this.points = points;\r\n        this.updateColors(fills, strokes);\r\n\r\n        const pointsGroup = new _Scene.Group();\r\n        pointsGroup.setClipRect(new _Scene.BBox(padding, padding, size - padding * 2, size - padding * 2));\r\n        pointsGroup.append(this.points);\r\n        this.root.append(pointsGroup);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.points.forEach((line, i) => {\r\n            line.stroke = strokes[i % strokes.length];\r\n            line.fill = fills[i % fills.length];\r\n        });\r\n    }\r\n}\r\n", "import type { Shape } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniBubble extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'bubble';\r\n    private readonly points: Shape[];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'bubbleTooltip');\r\n\r\n        const {\r\n            size,\r\n            padding,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        // [x, y, radius] triples\r\n        const data = [\r\n            [\r\n                [0.1, 0.3, 5],\r\n                [0.5, 0.4, 7],\r\n                [0.2, 0.8, 7],\r\n            ],\r\n            [\r\n                [0.8, 0.7, 5],\r\n                [0.7, 0.3, 9],\r\n            ],\r\n        ];\r\n\r\n        const xScale = new _Scene.LinearScale();\r\n        xScale.domain = [0, 1];\r\n        xScale.range = [padding * 2, size - padding];\r\n\r\n        const yScale = new _Scene.LinearScale();\r\n        yScale.domain = [0, 1];\r\n        yScale.range = [size - padding, padding];\r\n\r\n        const points: any[] = [];\r\n\r\n        data.forEach((series) => {\r\n            series.forEach(([x, y, radius]) => {\r\n                const arc = new _Scene.Arc();\r\n                arc.strokeWidth = 0;\r\n                arc.centerX = xScale.convert(x);\r\n                arc.centerY = yScale.convert(y);\r\n                arc.radius = radius;\r\n                arc.fillOpacity = 0.7;\r\n                points.push(arc);\r\n            });\r\n        });\r\n\r\n        this.points = points;\r\n        this.updateColors(fills, strokes);\r\n\r\n        const pointsGroup = new _Scene.Group();\r\n        pointsGroup.setClipRect(new _Scene.BBox(padding, padding, size - padding * 2, size - padding * 2));\r\n        pointsGroup.append(this.points);\r\n        this.root.append(pointsGroup);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.points.forEach((line, i) => {\r\n            line.stroke = strokes[i % strokes.length];\r\n            line.fill = fills[i % fills.length];\r\n        });\r\n    }\r\n}\r\n", "import type { Path } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniLine } from '../line/miniLine';\r\nimport { createAreaPaths } from '../miniChartHelpers';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniArea extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'area';\r\n    protected readonly areas: Path[];\r\n\r\n    static readonly data = MiniLine.data;\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        _themeTemplateParameters: ThemeTemplateParameters,\r\n        _isCustomTheme: boolean,\r\n        data: number[][] = MiniArea.data,\r\n        tooltipName: ChartTranslationKey = 'groupedAreaTooltip',\r\n        stacked: boolean = false\r\n    ) {\r\n        super(container, agChartsExports, tooltipName);\r\n\r\n        this.areas = createAreaPaths(agChartsExports._Scene, this.root, data, this.size, this.padding, stacked);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.areas.forEach((area, i) => {\r\n            area.fill = fills[i];\r\n            area.stroke = strokes[i];\r\n            area.strokeWidth = 1;\r\n            area.strokeOpacity = 0.75;\r\n            area.fillOpacity = 0.7;\r\n        });\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { stackData } from '../miniChartHelpers';\r\nimport { MiniArea } from './miniArea';\r\n\r\nexport class MiniStackedArea extends MiniArea {\r\n    static override chartType: ChartType = 'stackedArea';\r\n    static override readonly data = stackData(MiniArea.data);\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        _themeTemplateParameters: ThemeTemplateParameters,\r\n        _isCustomTheme: boolean,\r\n        data: number[][] = MiniStackedArea.data,\r\n        tooltipName: ChartTranslationKey = 'stackedAreaTooltip'\r\n    ) {\r\n        super(\r\n            container,\r\n            agChartsExports,\r\n            fills,\r\n            strokes,\r\n            _themeTemplateParameters,\r\n            _isCustomTheme,\r\n            data,\r\n            tooltipName,\r\n            true\r\n        );\r\n    }\r\n\r\n    override updateColors(fills: string[], strokes: string[]) {\r\n        this.areas.forEach((area, i) => {\r\n            area.fill = fills[i];\r\n            area.stroke = strokes[i];\r\n        });\r\n    }\r\n}\r\n", "import type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../../services/chartTranslationService';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { normalizeStackData } from '../miniChartHelpers';\r\nimport { MiniStackedArea } from './miniStackedArea';\r\n\r\nexport class MiniNormalizedArea extends MiniStackedArea {\r\n    static override chartType: ChartType = 'normalizedArea';\r\n\r\n    static override readonly data = normalizeStackData(MiniStackedArea.data);\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplateParameters: ThemeTemplateParameters,\r\n        isCustomTheme: boolean,\r\n        data: number[][] = MiniNormalizedArea.data,\r\n        tooltipName: ChartTranslationKey = 'normalizedAreaTooltip'\r\n    ) {\r\n        super(container, agChartsExports, fills, strokes, themeTemplateParameters, isCustomTheme, data, tooltipName);\r\n    }\r\n}\r\n", "import type { Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniHistogram extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'histogram';\r\n\r\n    private readonly bars: Rect[];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'histogramTooltip');\r\n\r\n        const {\r\n            padding,\r\n            size,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        // approx normal curve\r\n        const data = [2, 5, 11, 13, 10, 6, 1];\r\n\r\n        const xScale = new _Scene.LinearScale();\r\n        xScale.domain = [0, data.length];\r\n        xScale.range = [padding, size - padding];\r\n\r\n        const yScale = new _Scene.LinearScale();\r\n        yScale.domain = [0, data.reduce((a, b) => Math.max(a, b), 0)];\r\n        yScale.range = [size - padding, padding];\r\n\r\n        const bottom = yScale.convert(0);\r\n\r\n        this.bars = data.map((datum, i) => {\r\n            const top = yScale.convert(datum);\r\n            const left = xScale.convert(i);\r\n            const right = xScale.convert(i + 1);\r\n\r\n            const rect = new _Scene.Rect();\r\n            rect.x = left;\r\n            rect.y = top;\r\n            rect.width = right - left;\r\n            rect.height = bottom - top;\r\n            rect.strokeWidth = 1;\r\n            rect.strokeOpacity = 0.75;\r\n            rect.crisp = true;\r\n\r\n            return rect;\r\n        });\r\n\r\n        this.updateColors(fills, strokes);\r\n        this.root.append(this.bars);\r\n    }\r\n\r\n    updateColors([fill]: string[], [stroke]: string[]) {\r\n        this.bars.forEach((bar) => {\r\n            bar.fill = fill;\r\n            bar.stroke = stroke;\r\n        });\r\n    }\r\n}\r\n", "import type { AgChartsExports } from '../../../../agChartsExports';\r\nimport type { ChartTranslationKey } from '../../../services/chartTranslationService';\r\nimport { MiniChart } from './miniChart';\r\n\r\nexport abstract class MiniChartWithPolarAxes extends MiniChart {\r\n    private readonly stroke = 'gray';\r\n    private gridLines: any[];\r\n    protected showRadiusAxisLine: boolean = true;\r\n    protected showAngleAxisLines: boolean = true;\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, tooltipName: ChartTranslationKey) {\r\n        super(container, agChartsExports, tooltipName);\r\n    }\r\n\r\n    public override postConstruct() {\r\n        const { _Scene } = this.agChartsExports;\r\n        const size = this.size;\r\n        const padding = this.padding;\r\n        const combinedPadding = padding * 2;\r\n\r\n        const axisLineRadius = (size - combinedPadding) / 2;\r\n        const gridRadii = this.showAngleAxisLines\r\n            ? [axisLineRadius, axisLineRadius * 0.8, axisLineRadius * 0.6, axisLineRadius * 0.4]\r\n            : [];\r\n\r\n        const radiusAxisLine = new _Scene.Line();\r\n        radiusAxisLine.x1 = size / 2;\r\n        radiusAxisLine.y1 = padding;\r\n        radiusAxisLine.x2 = size / 2;\r\n        radiusAxisLine.y2 = size - padding - axisLineRadius - gridRadii[gridRadii.length - 1];\r\n        radiusAxisLine.stroke = this.stroke;\r\n        radiusAxisLine.strokeOpacity = 0.5;\r\n        radiusAxisLine.fill = undefined;\r\n\r\n        radiusAxisLine.visible = this.showRadiusAxisLine;\r\n\r\n        const x = padding + axisLineRadius;\r\n        this.gridLines = gridRadii.map((radius, index) => {\r\n            const gridLine = new _Scene.Path();\r\n            gridLine.path.arc(x, x, radius, 0, 2 * Math.PI);\r\n            gridLine.strokeWidth = 1;\r\n            gridLine.stroke = this.stroke;\r\n            gridLine.strokeOpacity = index === 0 ? 0.5 : 0.2;\r\n            gridLine.fill = undefined;\r\n\r\n            return gridLine;\r\n        });\r\n\r\n        const root = this.root;\r\n\r\n        root.append(radiusAxisLine);\r\n        if (this.gridLines.length > 0) root.append(this.gridLines);\r\n        super.postConstruct();\r\n    }\r\n}\r\n", "import type { Group } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { accumulateData } from '../miniChartHelpers';\r\nimport { MiniChartWithPolarAxes } from '../miniChartWithPolarAxes';\r\n\r\nexport class MiniRadialColumn extends MiniChartWithPolarAxes {\r\n    static chartType: ChartType = 'radialColumn';\r\n    private readonly series: Group[];\r\n\r\n    private data = [\r\n        [6, 8, 10, 2, 6, 5],\r\n        [4, 4, 3, 6, 4, 4],\r\n        [5, 4, 2, 9, 8, 9],\r\n    ];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'radialColumnTooltip');\r\n\r\n        this.showRadiusAxisLine = false;\r\n\r\n        const {\r\n            padding,\r\n            size,\r\n            data,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n        const radius = (size - padding * 2) / 2;\r\n        const innerRadiusRatio = 0.4;\r\n        const axisInnerRadius = radius * innerRadiusRatio;\r\n\r\n        const angleScale = new _Scene.BandScale();\r\n        angleScale.domain = data[0].map((_, index) => index);\r\n        angleScale.range = [0, 2 * Math.PI];\r\n        angleScale.paddingInner = 0;\r\n        angleScale.paddingOuter = 0;\r\n        const bandwidth = angleScale.bandwidth * 0.7;\r\n\r\n        const { processedData, max } = accumulateData(data);\r\n\r\n        const radiusScale = new _Scene.LinearScale();\r\n        radiusScale.domain = [0, max];\r\n        radiusScale.range = [axisInnerRadius, radius];\r\n\r\n        const center = this.size / 2;\r\n        this.series = processedData.map((series, seriesIndex) => {\r\n            const firstSeries = seriesIndex === 0;\r\n            const previousSeries = firstSeries ? undefined : processedData[seriesIndex - 1];\r\n\r\n            const seriesGroup = new _Scene.TranslatableGroup({ zIndex: 1000_000 });\r\n            const seriesColumns = series.map((datum: number, i: number) => {\r\n                const previousDatum = previousSeries?.[i];\r\n                const outerRadius = radiusScale.convert(datum);\r\n                const innerRadius = radiusScale.convert(previousDatum ?? 0);\r\n                const startAngle = angleScale.convert(i);\r\n                const endAngle = startAngle + bandwidth;\r\n\r\n                const columnWidth = _Scene.getRadialColumnWidth(startAngle, endAngle, radius, 0.5, 0.5);\r\n\r\n                const column = new _Scene.RadialColumnShape();\r\n\r\n                column.columnWidth = columnWidth;\r\n                column.innerRadius = innerRadius;\r\n                column.outerRadius = outerRadius;\r\n                column.startAngle = startAngle;\r\n                column.endAngle = endAngle;\r\n                column.isBeveled = true;\r\n                column.axisInnerRadius = axisInnerRadius;\r\n                column.axisOuterRadius = radius;\r\n\r\n                column.stroke = undefined;\r\n                column.strokeWidth = 0;\r\n\r\n                return column;\r\n            });\r\n\r\n            seriesGroup.append(seriesColumns);\r\n\r\n            seriesGroup.translationX = center;\r\n            seriesGroup.translationY = center;\r\n\r\n            return seriesGroup;\r\n        });\r\n\r\n        this.root.append(this.series);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.series.forEach((group, i) => {\r\n            for (const sector of group.children() as Iterable<any>) {\r\n                sector.fill = fills[i % fills.length];\r\n                sector.stroke = strokes[i % strokes.length];\r\n            }\r\n        });\r\n    }\r\n}\r\n", "import type { Group } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { accumulateData } from '../miniChartHelpers';\r\nimport { MiniChartWithPolarAxes } from '../miniChartWithPolarAxes';\r\n\r\nexport class MiniRadialBar extends MiniChartWithPolarAxes {\r\n    static chartType: ChartType = 'radialBar';\r\n    private readonly series: Group[];\r\n\r\n    private data = [\r\n        [6, 8, 10],\r\n        [4, 4, 3],\r\n        [5, 4, 2],\r\n    ];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'radialBarTooltip');\r\n\r\n        this.showRadiusAxisLine = false;\r\n\r\n        const {\r\n            size,\r\n            padding,\r\n            data,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        const radius = (size - padding) / 2;\r\n        const innerRadiusRatio = 0.4;\r\n        const innerRadius = radius * innerRadiusRatio;\r\n\r\n        const radiusScale = new _Scene.BandScale();\r\n        radiusScale.domain = data[0].map((_, index) => index);\r\n        radiusScale.range = [innerRadius, radius];\r\n        radiusScale.paddingInner = 0.5;\r\n        radiusScale.paddingOuter = 0;\r\n        const bandwidth = radiusScale.bandwidth;\r\n\r\n        const { processedData, max } = accumulateData(data);\r\n\r\n        const angleScale = new _Scene.LinearScale();\r\n        angleScale.domain = [0, Math.ceil(max * 1.5)];\r\n        const start = (3 / 2) * Math.PI;\r\n        const end = start + 2 * Math.PI;\r\n        angleScale.range = [start, end];\r\n\r\n        const center = size / 2;\r\n        this.series = processedData.map((series, index) => {\r\n            const previousSeries = index < 0 ? undefined : processedData[index - 1];\r\n\r\n            const seriesGroup = new _Scene.Group({ zIndex: 1000_000 });\r\n            const seriesSectors = series.map((datum: number, i: number) => {\r\n                const previousDatum = previousSeries?.[i] ?? 0;\r\n\r\n                const outerRadius = radiusScale.convert(i);\r\n                const innerRadius = outerRadius - bandwidth;\r\n                const startAngle = angleScale.convert(previousDatum);\r\n                const endAngle = angleScale.convert(datum);\r\n\r\n                const sector = new _Scene.Sector();\r\n                sector.centerX = center;\r\n                sector.centerY = center;\r\n                sector.innerRadius = innerRadius;\r\n                sector.outerRadius = outerRadius;\r\n                sector.startAngle = startAngle;\r\n                sector.endAngle = endAngle;\r\n                sector.stroke = undefined;\r\n                sector.strokeWidth = 0;\r\n                return sector;\r\n            });\r\n\r\n            seriesGroup.append(seriesSectors);\r\n\r\n            return seriesGroup;\r\n        });\r\n\r\n        this.root.append(this.series);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.series.forEach((group, i) => {\r\n            for (const sector of group.children() as Iterable<any>) {\r\n                sector.fill = fills[i % fills.length];\r\n                sector.stroke = strokes[i % strokes.length];\r\n            }\r\n        });\r\n    }\r\n}\r\n", "import type { Circle, Path } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { createPolarPaths } from '../miniChartHelpers';\r\nimport { MiniChartWithPolarAxes } from '../miniChartWithPolarAxes';\r\n\r\nexport class MiniRadarLine extends MiniChartWithPolarAxes {\r\n    static chartType: ChartType = 'radarLine';\r\n    private readonly lines: Path[];\r\n    private readonly markers: Circle[];\r\n    private readonly markerSize: number = 4;\r\n\r\n    private data = [\r\n        [8, 7, 8, 7, 8, 8, 7, 8],\r\n        [6, 8, 5, 10, 6, 7, 4, 6],\r\n        [0, 3, 3, 5, 4, 4, 2, 0],\r\n    ];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'radarLineTooltip');\r\n\r\n        this.showRadiusAxisLine = false;\r\n\r\n        const { size, padding, root, data } = this;\r\n\r\n        const radius = (size - padding * 2) / 2;\r\n        const innerRadius = 0;\r\n\r\n        const { paths, markers } = createPolarPaths(\r\n            agChartsExports,\r\n            root,\r\n            data,\r\n            size,\r\n            radius,\r\n            innerRadius,\r\n            this.markerSize\r\n        );\r\n\r\n        this.lines = paths;\r\n        this.markers = markers;\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.lines.forEach((line: any, i: number) => {\r\n            const n = this.data[i].length;\r\n            line.stroke = fills[i];\r\n            const startIdx = i * n;\r\n            const endIdx = startIdx + n;\r\n            const markers = this.markers.slice(startIdx, endIdx);\r\n            markers.forEach((marker) => {\r\n                marker.stroke = strokes[i];\r\n                marker.fill = fills[i];\r\n            });\r\n        });\r\n    }\r\n}\r\n", "import type { Path } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { createPolarPaths } from '../miniChartHelpers';\r\nimport { MiniChartWithPolarAxes } from '../miniChartWithPolarAxes';\r\n\r\nexport class MiniRadarArea extends MiniChartWithPolarAxes {\r\n    static chartType: ChartType = 'radarArea';\r\n    private readonly areas: Path[];\r\n\r\n    private data = [\r\n        [8, 10, 5, 7, 4, 1, 5, 8],\r\n        [1, 1, 2, 7, 7, 8, 10, 1],\r\n        [4, 5, 9, 9, 4, 2, 3, 4],\r\n    ];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'radarAreaTooltip');\r\n\r\n        const { size, padding, root, data } = this;\r\n        this.showRadiusAxisLine = false;\r\n\r\n        const radius = (size - padding * 2) / 2;\r\n        const innerRadius = radius - size * 0.3;\r\n\r\n        this.areas = createPolarPaths(agChartsExports, root, data, size, radius, innerRadius).paths;\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.areas.forEach((area, i) => {\r\n            area.fill = fills[i];\r\n            area.stroke = strokes[i];\r\n        });\r\n    }\r\n}\r\n", "import type { Group } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { accumulateData } from '../miniChartHelpers';\r\nimport { MiniChartWithPolarAxes } from '../miniChartWithPolarAxes';\r\n\r\nexport class MiniNightingale extends MiniChartWithPolarAxes {\r\n    static chartType: ChartType = 'nightingale';\r\n    private readonly series: Group[];\r\n\r\n    private data = [\r\n        [6, 10, 9, 8, 7, 8],\r\n        [4, 6, 5, 4, 5, 5],\r\n        [3, 5, 4, 3, 4, 7],\r\n    ];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'nightingaleTooltip');\r\n\r\n        this.showRadiusAxisLine = false;\r\n        const {\r\n            size,\r\n            padding,\r\n            data,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        const radius = (size - padding * 2) / 2;\r\n\r\n        const angleScale = new _Scene.BandScale();\r\n        angleScale.domain = data[0].map((_, index) => index);\r\n        angleScale.range = [-Math.PI, Math.PI];\r\n        angleScale.paddingInner = 0;\r\n        angleScale.paddingOuter = 0;\r\n        const bandwidth = angleScale.bandwidth * 0.7;\r\n\r\n        const { processedData, max } = accumulateData(data);\r\n\r\n        const radiusScale = new _Scene.LinearScale();\r\n        radiusScale.domain = [0, max];\r\n        radiusScale.range = [0, radius];\r\n\r\n        const center = size / 2;\r\n        this.series = processedData.map((series, index) => {\r\n            const previousSeries = index < 0 ? undefined : processedData[index - 1];\r\n\r\n            const seriesGroup = new _Scene.Group({ zIndex: 1000_000 });\r\n            const seriesSectors = series.map((datum: number, i: number) => {\r\n                const previousDatum = previousSeries?.[i];\r\n                const outerRadius = radiusScale.convert(datum);\r\n                const innerRadius = radiusScale.convert(previousDatum ?? 0);\r\n                const startAngle = angleScale.convert(i);\r\n                const endAngle = startAngle + bandwidth;\r\n\r\n                const sector = new _Scene.Sector();\r\n                sector.centerX = center;\r\n                sector.centerY = center;\r\n                sector.innerRadius = innerRadius;\r\n                sector.outerRadius = outerRadius;\r\n                sector.startAngle = startAngle;\r\n                sector.endAngle = endAngle;\r\n                sector.stroke = undefined;\r\n                sector.strokeWidth = 0;\r\n                return sector;\r\n            });\r\n\r\n            seriesGroup.append(seriesSectors);\r\n\r\n            return seriesGroup;\r\n        });\r\n\r\n        this.root.append(this.series);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.series.forEach((group, i) => {\r\n            for (const sector of group.children() as Iterable<any>) {\r\n                sector.fill = fills[i % fills.length];\r\n                sector.stroke = strokes[i % strokes.length];\r\n            }\r\n        });\r\n    }\r\n}\r\n", "import type { Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniRangeBar extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'rangeBar';\r\n\r\n    private readonly bars: Rect[];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'rangeBarTooltip');\r\n        const data = [3, 3.5, 3];\r\n\r\n        this.bars = this.createRangeBar(this.root, data, this.size, this.padding, 'vertical');\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.bars.forEach((bar, i) => {\r\n            bar.fill = fills[i];\r\n            bar.stroke = strokes[i];\r\n        });\r\n    }\r\n\r\n    createRangeBar(\r\n        root: any,\r\n        data: number[],\r\n        size: number,\r\n        padding: number,\r\n        direction: 'horizontal' | 'vertical'\r\n    ): any[] {\r\n        const barAlongX = direction === 'horizontal';\r\n        const scalePadding = 2 * padding;\r\n\r\n        const { _Scene } = this.agChartsExports;\r\n\r\n        const xScale = new _Scene.BandScale();\r\n        xScale.domain = data.map((_, index) => index);\r\n        xScale.range = [padding, size - padding];\r\n        xScale.paddingInner = 0.3;\r\n        xScale.paddingOuter = 0.3;\r\n\r\n        const lowRatio = 0.7;\r\n        const highRatio = 1.3;\r\n\r\n        const yScale = new _Scene.LinearScale();\r\n        yScale.domain = [\r\n            data.reduce((a, b) => Math.min(a, b), Infinity) * lowRatio,\r\n            data.reduce((a, b) => Math.max(a, b), 0) * highRatio,\r\n        ];\r\n        yScale.range = [scalePadding, size - scalePadding];\r\n\r\n        const width = xScale.bandwidth;\r\n\r\n        const bars = data.map((datum, i) => {\r\n            const [low, high] = [datum * lowRatio, datum * highRatio];\r\n\r\n            const x = xScale.convert(i);\r\n            const y = yScale.convert(low);\r\n            const height = yScale.convert(high) - y;\r\n\r\n            const rect = new _Scene.Rect();\r\n            rect.x = barAlongX ? y : x;\r\n            rect.y = barAlongX ? x : y;\r\n            rect.width = barAlongX ? height : width;\r\n            rect.height = barAlongX ? width : height;\r\n            rect.strokeWidth = 0;\r\n            rect.crisp = true;\r\n\r\n            return rect;\r\n        });\r\n\r\n        root.append(bars);\r\n\r\n        return bars;\r\n    }\r\n}\r\n", "import type { Path } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniRangeArea extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'rangeArea';\r\n\r\n    private readonly lines: Path[][];\r\n    private readonly areas: Path[];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'rangeAreaTooltip');\r\n\r\n        // Create a set of repeating zigzag-shaped data series to use as the chart data\r\n        const period = 4;\r\n        const dataSeriesMidpoints = [\r\n            zigzag({ offset: 0.375 * period, length: period, pattern: { low: 3, high: 5, period } }),\r\n            zigzag({ offset: 0.375 * period, length: period, pattern: { low: 2.25, high: 4.25, period } }),\r\n            zigzag({ offset: 0.75 * period, length: period, pattern: { low: 2.5, high: 4.5, period } }),\r\n        ];\r\n        const dataSeriesWidth = 1.75;\r\n        const data = dataSeriesMidpoints.map((series) =>\r\n            series.map(([x, y]) => ({\r\n                x,\r\n                low: y - 0.5 * dataSeriesWidth,\r\n                high: y + 0.5 * dataSeriesWidth,\r\n            }))\r\n        );\r\n\r\n        const { lines, areas } = this.createRangeArea(this.root, data, this.size, this.padding);\r\n        this.lines = lines;\r\n        this.areas = areas;\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        // Swap the secondary and tertiary colors to match the designs\r\n        fills = swapArrayItems(fills, 1, 2);\r\n        strokes = swapArrayItems(strokes, 1, 2);\r\n\r\n        this.lines.forEach(([highLine, lowLine], i) => {\r\n            highLine.fill = undefined;\r\n            highLine.stroke = strokes[i];\r\n            lowLine.fill = undefined;\r\n            lowLine.stroke = strokes[i];\r\n        });\r\n        this.areas.forEach((area, i) => {\r\n            area.fill = fills[i];\r\n        });\r\n    }\r\n\r\n    createRangeArea(\r\n        root: any,\r\n        data: Array<Array<{ x: number; low: number; high: number }>>,\r\n        size: number,\r\n        padding: number\r\n    ): { lines: any[][]; areas: any[] } {\r\n        const xMin = data.reduce((acc, series) => series.reduce((acc, { x }) => Math.min(acc, x), acc), Infinity);\r\n        const xMax = data.reduce((acc, series) => series.reduce((acc, { x }) => Math.max(acc, x), acc), -Infinity);\r\n        const yMin = data.reduce((acc, series) => series.reduce((acc, { low }) => Math.min(acc, low), acc), Infinity);\r\n        const yMax = data.reduce(\r\n            (acc, series) => series.reduce((acc, { high }) => Math.max(acc, high), acc),\r\n            -Infinity\r\n        );\r\n\r\n        const { _Scene } = this.agChartsExports;\r\n\r\n        const xScale = new _Scene.LinearScale();\r\n        xScale.domain = [xMin, xMax];\r\n        xScale.range = [padding, size - padding];\r\n\r\n        const scalePadding = 2 * padding;\r\n\r\n        const yScale = new _Scene.LinearScale();\r\n        yScale.domain = [yMin, yMax];\r\n        yScale.range = [size - scalePadding, scalePadding];\r\n\r\n        const lines: any[][] = [];\r\n        const areas: any[] = [];\r\n\r\n        const lowPoints = data.map((series) => {\r\n            const highLine = new _Scene.Path();\r\n            const lowLine = new _Scene.Path();\r\n            const area = new _Scene.Path();\r\n\r\n            lines.push([highLine, lowLine]);\r\n            areas.push(area);\r\n\r\n            highLine.strokeWidth = 0;\r\n            lowLine.strokeWidth = 0;\r\n            area.strokeWidth = 0;\r\n            area.fillOpacity = 0.8;\r\n\r\n            highLine.path.clear();\r\n            lowLine.path.clear();\r\n            area.path.clear();\r\n\r\n            return series.map((datum, datumIndex) => {\r\n                const { x, low, high } = datum;\r\n\r\n                const scaledX = xScale.convert(x);\r\n                const yLow = yScale.convert(low);\r\n                const yHigh = yScale.convert(high);\r\n\r\n                const command = datumIndex > 0 ? 'lineTo' : 'moveTo';\r\n\r\n                highLine.path[command](scaledX, yHigh);\r\n                lowLine.path[command](scaledX, yLow);\r\n                area.path[command](scaledX, yHigh);\r\n\r\n                return [scaledX, yLow];\r\n            });\r\n        });\r\n\r\n        lowPoints.forEach((seriesLowPoints, seriesIndex) => {\r\n            const n = seriesLowPoints.length - 1;\r\n            const area = areas[seriesIndex];\r\n            for (let datumIndex = n; datumIndex >= 0; datumIndex--) {\r\n                const [x, y] = seriesLowPoints[datumIndex];\r\n                area.path['lineTo'](x, y);\r\n            }\r\n        });\r\n\r\n        root.append(areas.concat(...lines));\r\n\r\n        return { lines, areas };\r\n    }\r\n}\r\n\r\ninterface ZigzagPatternOptions {\r\n    low: number;\r\n    high: number;\r\n    period: number;\r\n}\r\n\r\nfunction zigzag(options: { offset: number; length: number; pattern: ZigzagPatternOptions }): Array<[number, number]> {\r\n    const { offset, length, pattern } = options;\r\n\r\n    // Generate [x, y] points for all inflection points of the zigzag pattern that fall within the range\r\n    const points = getZigzagInflectionPoints(offset, length, pattern);\r\n\r\n    // Ensure the first and last points are clamped to the start and end of the range\r\n    const xMin = 0;\r\n    const xMax = length;\r\n    if (points.length === 0 || points[0][0] !== xMin) points.unshift(getZigzagPoint(xMin, offset, pattern));\r\n    if (points[points.length - 1][0] !== xMax) points.push(getZigzagPoint(xMax, offset, pattern));\r\n\r\n    return points;\r\n\r\n    function getZigzagInflectionPoints(\r\n        offset: number,\r\n        length: number,\r\n        pattern: ZigzagPatternOptions\r\n    ): [number, number][] {\r\n        const { period } = pattern;\r\n        const scaledOffset = offset / period;\r\n        const patternInflectionPoints = [0, 0.5];\r\n        const inflectionPoints = patternInflectionPoints\r\n            .map((x) => x - scaledOffset)\r\n            // Clamp offset points to the unit range [0, 1)\r\n            .map(getRemainderAbs)\r\n            .sort((a, b) => a - b);\r\n        const repeatedPoints = Array.from(\r\n            { length: Math.floor(inflectionPoints.length * (period / length)) },\r\n            (_, i) => inflectionPoints[i % inflectionPoints.length] + Math.floor(i / inflectionPoints.length)\r\n        );\r\n        return repeatedPoints.map((x) => x * period).map((x) => getZigzagPoint(x, offset, pattern));\r\n    }\r\n\r\n    function getZigzagPoint(x: number, offset: number, pattern: ZigzagPatternOptions): [number, number] {\r\n        return [x, getZigzagValue(offset + x, pattern)];\r\n    }\r\n\r\n    function getZigzagValue(x: number, pattern: ZigzagPatternOptions): number {\r\n        const { low, high, period } = pattern;\r\n        const scaledX = getRemainderAbs(x / period);\r\n        const y = scaledX > 0.5 ? 1 - 2 * (scaledX - 0.5) : 2 * scaledX;\r\n        return low + (high - low) * y;\r\n    }\r\n}\r\n\r\nfunction getRemainderAbs(value: number): number {\r\n    const remainder = value % 1;\r\n    return remainder < 0 ? remainder + 1 : remainder;\r\n}\r\n\r\nfunction swapArrayItems<T>(items: T[], leftIndex: number, rightIndex: number): T[] {\r\n    const results = [...items];\r\n    const temp = results[leftIndex];\r\n    results[leftIndex] = results[rightIndex];\r\n    results[rightIndex] = temp;\r\n    return results;\r\n}\r\n", "import type { Group } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniBoxPlot extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'boxPlot';\r\n\r\n    private readonly boxPlotGroups: Group[];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplateParameters: ThemeTemplateParameters,\r\n        isCustomTheme: boolean\r\n    ) {\r\n        super(container, agChartsExports, 'boxPlotTooltip');\r\n\r\n        const {\r\n            size,\r\n            padding,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        const data = [11, 11.5, 10.5];\r\n\r\n        const maxRatio = 1.2;\r\n        const q3Ratio = 1.1;\r\n        const q1Ratio = 0.9;\r\n        const minRatio = 0.8;\r\n\r\n        const yScale = new _Scene.LinearScale();\r\n        yScale.domain = [\r\n            data.reduce((a, b) => Math.min(a, b), Infinity) * minRatio,\r\n            data.reduce((a, b) => Math.max(a, b), 0) * maxRatio,\r\n        ];\r\n        yScale.range = [size - 1.5 * padding, padding];\r\n\r\n        const xScale = new _Scene.BandScale();\r\n        xScale.domain = data.map((_, index) => index);\r\n        xScale.range = [padding, size - padding];\r\n        xScale.paddingInner = 0.4;\r\n        xScale.paddingOuter = 0.2;\r\n\r\n        const bandwidth = Math.round(xScale.bandwidth);\r\n        const halfBandWidth = Math.round(xScale.bandwidth / 2);\r\n\r\n        this.boxPlotGroups = data.map((datum, i) => {\r\n            const [minValue, q1Value, q3Value, maxValue] = [\r\n                datum * minRatio,\r\n                datum * q1Ratio,\r\n                datum * q3Ratio,\r\n                datum * maxRatio,\r\n            ];\r\n\r\n            const top = Math.round(yScale.convert(q3Value));\r\n            const left = Math.round(xScale.convert(i));\r\n            const right = Math.round(left + bandwidth);\r\n            const bottom = Math.round(yScale.convert(q1Value));\r\n            const min = Math.round(yScale.convert(minValue));\r\n            const mid = Math.round(yScale.convert(datum));\r\n            const max = Math.round(yScale.convert(maxValue));\r\n            const whiskerX = left + halfBandWidth;\r\n\r\n            const boxPlotGroup = new _Scene.Group();\r\n\r\n            const box = new _Scene.Rect();\r\n            const median = new _Scene.Line();\r\n            const topWhisker = new _Scene.Line();\r\n            const bottomWhisker = new _Scene.Line();\r\n            const topCap = new _Scene.Line();\r\n            const bottomCap = new _Scene.Line();\r\n\r\n            box.x = left;\r\n            box.y = top;\r\n            box.width = bandwidth;\r\n            box.height = bottom - top;\r\n            box.strokeWidth = 1;\r\n            box.strokeOpacity = 0.75;\r\n            box.crisp = true;\r\n\r\n            this.setLineProperties(median, left, right, mid, mid);\r\n            this.setLineProperties(topWhisker, whiskerX, whiskerX, max, top);\r\n            this.setLineProperties(bottomWhisker, whiskerX, whiskerX, min, bottom);\r\n            this.setLineProperties(topCap, left, right, max, max);\r\n            this.setLineProperties(bottomCap, left, right, min, min);\r\n\r\n            boxPlotGroup.append([box, median, topWhisker, bottomWhisker, topCap, bottomCap]);\r\n            return boxPlotGroup;\r\n        });\r\n\r\n        this.updateColors(fills, strokes, themeTemplateParameters, isCustomTheme);\r\n        this.root.append(this.boxPlotGroups);\r\n    }\r\n\r\n    updateColors(\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplateParameters?: ThemeTemplateParameters,\r\n        isCustomTheme?: boolean\r\n    ) {\r\n        const {\r\n            agChartsExports: { _Util, _Theme },\r\n        } = this;\r\n        const themeBackgroundColor = themeTemplateParameters?.get(_Theme.themeSymbols.DEFAULT_BACKGROUND_COLOUR);\r\n        const backgroundFill =\r\n            (Array.isArray(themeBackgroundColor) ? themeBackgroundColor[0] : themeBackgroundColor) ?? 'white';\r\n\r\n        this.boxPlotGroups.forEach((group, i) => {\r\n            for (const node of group.children() as Iterable<any>) {\r\n                const fill = fills[i % fills.length];\r\n                node.fill = isCustomTheme ? fill : _Util.interpolateColor(fill, backgroundFill)(0.7);\r\n                node.stroke = strokes[i % strokes.length];\r\n            }\r\n        });\r\n    }\r\n\r\n    setLineProperties(line: any, x1: number, x2: number, y1: number, y2: number) {\r\n        line.x1 = x1;\r\n        line.x2 = x2;\r\n        line.y1 = y1;\r\n        line.y2 = y2;\r\n        line.strokeOpacity = 0.75;\r\n    }\r\n}\r\n", "import type { Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniChart } from '../miniChart';\r\n\r\nexport class MiniTreemap extends MiniChart {\r\n    static chartType: ChartType = 'treemap';\r\n    private readonly rects: Rect[];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplate: ThemeTemplateParameters,\r\n        isCustomTheme: boolean\r\n    ) {\r\n        super(container, agChartsExports, 'treemapTooltip');\r\n\r\n        const {\r\n            size,\r\n            padding,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        const data: number[][] = [\r\n            [1, 1],\r\n            [3, 2, 1],\r\n        ];\r\n\r\n        const treeSize = data.length;\r\n        const treePadding = treeSize % 2 === 0 ? 0.3 : 0.2;\r\n        const range = [padding, size - padding];\r\n\r\n        const columns = data.length;\r\n        const columnParts = (columns * (columns + 1)) / 2;\r\n        const columnPadding = treePadding / (columns - 1);\r\n\r\n        const availableRange = range[1] - range[0];\r\n        const availableWidth = availableRange - treePadding;\r\n\r\n        let previousX = range[0];\r\n        this.rects = data.reduce((rects, d, columnIndex) => {\r\n            rects ??= [];\r\n\r\n            const widthRatio = (columns - columnIndex) / columnParts;\r\n            const width = availableWidth * widthRatio;\r\n\r\n            const rows = d.length;\r\n            const rowParts = d.reduce((parts, ratio) => (parts += ratio), 0);\r\n            const rowPadding = treePadding / (rows - 1 || 1);\r\n            const availableHeight = rows > 1 ? availableRange - treePadding : availableRange;\r\n\r\n            let previousY = range[0];\r\n            const xRects = d.map((ratio) => {\r\n                const rect = new _Scene.Rect();\r\n\r\n                const height = (availableHeight * ratio) / rowParts;\r\n\r\n                rect.x = previousX;\r\n                rect.y = previousY;\r\n                rect.width = width;\r\n                rect.height = height;\r\n                rect.strokeWidth = 0.75;\r\n                rect.crisp = true;\r\n\r\n                previousY += height + rowPadding;\r\n                return rect;\r\n            });\r\n\r\n            previousX += width + columnPadding;\r\n\r\n            rects.push(...xRects);\r\n\r\n            return rects;\r\n        }, [] as Rect[]);\r\n\r\n        this.updateColors(fills, strokes, themeTemplate, isCustomTheme);\r\n\r\n        const rectGroup = new _Scene.Group();\r\n        rectGroup.setClipRect(new _Scene.BBox(padding, padding, size - padding, size - padding));\r\n        rectGroup.append(this.rects);\r\n        this.root.append(rectGroup);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[], themeTemplate?: ThemeTemplateParameters, isCustomTheme?: boolean) {\r\n        const defaultBackgroundColor = themeTemplate?.get(\r\n            this.agChartsExports._Theme.themeSymbols.DEFAULT_BACKGROUND_COLOUR\r\n        );\r\n        const backgroundFill =\r\n            (Array.isArray(defaultBackgroundColor) ? defaultBackgroundColor[0] : defaultBackgroundColor) ?? 'white';\r\n\r\n        this.rects.forEach((rect, i) => {\r\n            rect.fill = fills[i % strokes.length];\r\n            rect.stroke = isCustomTheme ? strokes[i % strokes.length] : backgroundFill;\r\n        });\r\n    }\r\n}\r\n", "import type { Group } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { MiniChartWithPolarAxes } from '../miniChartWithPolarAxes';\r\n\r\nexport class MiniSunburst extends MiniChartWithPolarAxes {\r\n    static chartType: ChartType = 'sunburst';\r\n    private readonly series: Group[];\r\n\r\n    // Hierarchical data using multidimensional array\r\n    private data = [\r\n        [[], []],\r\n        [[], []],\r\n        [[], []],\r\n    ];\r\n\r\n    // Rotate the chart by the given angle (-90 degrees)\r\n    private angleOffset = -Math.PI / 2;\r\n\r\n    private innerRadiusRatio = 0;\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'sunburstTooltip');\r\n\r\n        this.showRadiusAxisLine = false;\r\n        this.showAngleAxisLines = false;\r\n\r\n        const {\r\n            data,\r\n            size,\r\n            padding,\r\n            angleOffset,\r\n            innerRadiusRatio,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        const radius = (size - padding * 2) / 2;\r\n\r\n        const angleRange = [angleOffset + 0, angleOffset + 2 * Math.PI];\r\n        const angleExtent = Math.abs(angleRange[1] - angleRange[0]);\r\n\r\n        const radiusRange = [radius * innerRadiusRatio, radius];\r\n        const radiusExtent = Math.abs(radiusRange[1] - radiusRange[0]);\r\n\r\n        let maxDepth = 0;\r\n        const findMaxDepth = (data: any[], parentDepth: number) => {\r\n            data.forEach((child) => {\r\n                const depth = parentDepth + 1;\r\n                maxDepth = Math.max(maxDepth, depth);\r\n                findMaxDepth(child, depth);\r\n            });\r\n        };\r\n\r\n        findMaxDepth(data, 0);\r\n\r\n        const radiusRatio = radiusExtent / maxDepth;\r\n        const center = this.size / 2;\r\n        const startAngle = angleRange[0];\r\n\r\n        this.series = [];\r\n\r\n        const createSectors = (data: any[], depth: number, startAngle: number, availableAngle: number, group?: any) => {\r\n            const isArray = Array.isArray(data);\r\n\r\n            if (!isArray) {\r\n                return;\r\n            }\r\n\r\n            const childDepth = depth + 1;\r\n\r\n            let previousAngle = startAngle;\r\n\r\n            data.forEach((child, childIndex, children) => {\r\n                let childGroup = group;\r\n                if (!childGroup) {\r\n                    childGroup = new _Scene.Group();\r\n                    this.series.push(childGroup);\r\n                }\r\n\r\n                const innerRadius = radiusRange[0] + depth * radiusRatio;\r\n                const outerRadius = radiusRange[0] + childDepth * radiusRatio;\r\n\r\n                const angleRatio = 1 / children.length;\r\n                const start = previousAngle;\r\n                const end = start + availableAngle * angleRatio;\r\n\r\n                const sector = new _Scene.Sector();\r\n                sector.centerX = center;\r\n                sector.centerY = center;\r\n                sector.innerRadius = innerRadius;\r\n                sector.outerRadius = outerRadius;\r\n                sector.startAngle = start;\r\n                sector.endAngle = end;\r\n                sector.stroke = undefined;\r\n                sector.strokeWidth = 0;\r\n                sector.inset = 0.75;\r\n\r\n                previousAngle = end;\r\n\r\n                childGroup.append(sector);\r\n\r\n                createSectors(child, childDepth, start, Math.abs(end - start), childGroup);\r\n            });\r\n        };\r\n\r\n        createSectors(data, 0, startAngle, angleExtent);\r\n\r\n        this.root.append(this.series);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.series.forEach((group, i) => {\r\n            for (const sector of group.children() as Iterable<any>) {\r\n                sector.fill = fills[i % fills.length];\r\n                sector.stroke = strokes[i % strokes.length];\r\n            }\r\n        });\r\n    }\r\n}\r\n", "import type { Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { MiniChart } from '../miniChart';\r\n\r\nexport class MiniHeatmap extends MiniChart {\r\n    static chartType: ChartType = 'heatmap';\r\n    private readonly rects: Rect[];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplate: ThemeTemplateParameters,\r\n        isCustomTheme: boolean\r\n    ) {\r\n        super(container, agChartsExports, 'heatmapTooltip');\r\n\r\n        const {\r\n            size,\r\n            padding,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        const heatmapSize = 3;\r\n\r\n        const data = Array.from({ length: heatmapSize }, (_, __) =>\r\n            Array.from({ length: heatmapSize }, (_, yIndex) => yIndex)\r\n        );\r\n        const domain = data.map((_, index) => index);\r\n\r\n        const xScale = new _Scene.BandScale();\r\n        xScale.domain = domain;\r\n        xScale.range = [padding, size - padding];\r\n        xScale.paddingInner = 0.01;\r\n        xScale.paddingOuter = 0.1;\r\n\r\n        const yScale = new _Scene.BandScale();\r\n        yScale.domain = domain;\r\n        yScale.range = [padding, size - padding];\r\n        yScale.paddingInner = 0.01;\r\n        yScale.paddingOuter = 0.1;\r\n\r\n        const width = xScale.bandwidth ?? 0;\r\n        const height = yScale.bandwidth ?? 0;\r\n\r\n        this.rects = data.reduce((rects, d: [], index) => {\r\n            rects ??= [];\r\n            const xRects = d.map((_, yIndex) => {\r\n                const rect = new _Scene.Rect();\r\n                rect.x = xScale.convert(index);\r\n                rect.y = yScale.convert(yIndex);\r\n                rect.width = width;\r\n                rect.height = height;\r\n                rect.strokeWidth = 0;\r\n                rect.crisp = true;\r\n\r\n                return rect;\r\n            });\r\n\r\n            rects.push(...xRects);\r\n\r\n            return rects;\r\n        }, [] as Rect[]);\r\n\r\n        this.updateColors(fills, strokes, themeTemplate, isCustomTheme);\r\n\r\n        const rectGroup = new _Scene.Group();\r\n        rectGroup.setClipRect(new _Scene.BBox(padding, padding, size - padding, size - padding));\r\n        rectGroup.append(this.rects);\r\n        this.root.append(rectGroup);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[], themeTemplate?: ThemeTemplateParameters, isCustomTheme?: boolean) {\r\n        const { _Theme, _Util } = this.agChartsExports;\r\n        const defaultColorRange = themeTemplate?.get(_Theme.themeSymbols.DEFAULT_DIVERGING_SERIES_COLOR_RANGE);\r\n        const defaultBackgroundColor = themeTemplate?.get(_Theme.themeSymbols.DEFAULT_BACKGROUND_COLOUR);\r\n        const backgroundFill =\r\n            (Array.isArray(defaultBackgroundColor) ? defaultBackgroundColor[0] : defaultBackgroundColor) ?? 'white';\r\n\r\n        const colorRange = isCustomTheme ? [fills[0], fills[1]] : defaultColorRange;\r\n        const stroke = isCustomTheme ? strokes[0] : backgroundFill;\r\n\r\n        const fillFn = _Util.interpolateColor(colorRange[0], colorRange[1]);\r\n        this.rects.forEach((rect, i) => {\r\n            rect.fill = fillFn(i * 0.2);\r\n            rect.stroke = stroke;\r\n        });\r\n    }\r\n}\r\n", "import type { Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport type { ThemeTemplateParameters } from '../../miniChartsContainer';\r\nimport { accumulateData } from '../miniChartHelpers';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniWaterfall extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'waterfall';\r\n\r\n    private readonly bars: Rect[];\r\n\r\n    private data = [4, 3, -3, 6, -3];\r\n\r\n    constructor(\r\n        container: HTMLElement,\r\n        agChartsExports: AgChartsExports,\r\n        fills: string[],\r\n        strokes: string[],\r\n        themeTemplate: ThemeTemplateParameters,\r\n        isCustomTheme: boolean\r\n    ) {\r\n        super(container, agChartsExports, 'waterfallTooltip');\r\n\r\n        this.bars = this.createWaterfall(this.root, this.data, this.size, this.padding, 'vertical').bars;\r\n        this.updateColors(fills, strokes, themeTemplate, isCustomTheme);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[], themeTemplate?: ThemeTemplateParameters, isCustomTheme?: boolean) {\r\n        const {\r\n            data,\r\n            agChartsExports: {\r\n                _Theme: { themeSymbols },\r\n            },\r\n        } = this;\r\n        const positive = {\r\n            fill: isCustomTheme ? fills[0] : themeTemplate?.get(themeSymbols.PALETTE_ALT_UP_FILL),\r\n            stroke: isCustomTheme ? strokes[0] : themeTemplate?.get(themeSymbols.PALETTE_ALT_UP_STROKE),\r\n        };\r\n        const negative = {\r\n            fill: isCustomTheme ? fills[1] : themeTemplate?.get(themeSymbols.PALETTE_ALT_DOWN_FILL),\r\n            stroke: isCustomTheme ? strokes[1] : themeTemplate?.get(themeSymbols.PALETTE_ALT_DOWN_STROKE),\r\n        };\r\n        this.bars.forEach((bar, i) => {\r\n            const isPositive = data[i] >= 0;\r\n            bar.fill = isPositive ? positive.fill : negative.fill;\r\n            bar.stroke = isPositive ? positive.stroke : negative.stroke;\r\n        });\r\n    }\r\n\r\n    createWaterfall(\r\n        root: any,\r\n        data: number[],\r\n        size: number,\r\n        padding: number,\r\n        direction: 'horizontal' | 'vertical'\r\n    ): { bars: any[] } {\r\n        const scalePadding = 2 * padding;\r\n\r\n        const { processedData, min, max } = accumulateData(data.map((d) => [d]));\r\n        const flatData = processedData.reduce((flat, d) => flat.concat(d), []);\r\n        const { _Scene } = this.agChartsExports;\r\n        const yScale = new _Scene.LinearScale();\r\n        yScale.domain = [Math.min(min, 0), max];\r\n        yScale.range = [size - scalePadding, scalePadding];\r\n\r\n        const xScale = new _Scene.BandScale();\r\n        xScale.domain = data.map((_, index) => index);\r\n        xScale.range = [padding, size - padding];\r\n        xScale.paddingInner = 0.2;\r\n        xScale.paddingOuter = 0.3;\r\n\r\n        const width = xScale.bandwidth;\r\n\r\n        const connectorLine = new _Scene.Path();\r\n        connectorLine.stroke = '#575757';\r\n        connectorLine.strokeWidth = 0;\r\n        const pixelAlignmentOffset = (Math.floor(connectorLine.strokeWidth) % 2) / 2;\r\n\r\n        const connectorPath = connectorLine.path;\r\n        connectorPath.clear();\r\n\r\n        const barAlongX = direction === 'horizontal';\r\n\r\n        const bars = flatData.map((datum, i) => {\r\n            const previousDatum = i > 0 ? flatData[i - 1] : 0;\r\n            const rawValue = data[i];\r\n            const isPositive = rawValue > 0;\r\n\r\n            const currY = Math.round(yScale.convert(datum));\r\n            const trailY = Math.round(yScale.convert(previousDatum));\r\n            const y = (isPositive ? currY : trailY) - pixelAlignmentOffset;\r\n            const bottomY = (isPositive ? trailY : currY) + pixelAlignmentOffset;\r\n            const height = Math.abs(bottomY - y);\r\n\r\n            const x = xScale.convert(i);\r\n\r\n            const rect = new _Scene.Rect();\r\n            rect.x = barAlongX ? y : x;\r\n            rect.y = barAlongX ? x : y;\r\n            rect.width = barAlongX ? height : width;\r\n            rect.height = barAlongX ? width : height;\r\n            rect.strokeWidth = 0;\r\n            rect.crisp = true;\r\n\r\n            const moveTo = currY + pixelAlignmentOffset;\r\n            const lineTo = trailY + pixelAlignmentOffset;\r\n\r\n            if (i > 0) {\r\n                const lineToX = barAlongX ? lineTo : rect.x;\r\n                const lineToY = barAlongX ? rect.y : lineTo;\r\n                connectorPath.lineTo(lineToX, lineToY);\r\n            }\r\n            const moveToX = barAlongX ? moveTo : rect.x;\r\n            const moveToY = barAlongX ? rect.y : moveTo;\r\n            connectorPath.moveTo(moveToX, moveToY);\r\n\r\n            return rect;\r\n        });\r\n\r\n        root.append([connectorLine, ...bars]);\r\n\r\n        return { bars };\r\n    }\r\n}\r\n", "import type { Path, Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { createColumnRects, createLinePaths } from '../miniChartHelpers';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport class MiniColumnLineCombo extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'columnLineCombo';\r\n\r\n    private columns: Rect[];\r\n    private lines: Path[];\r\n\r\n    private columnData = [3, 4];\r\n\r\n    private lineData = [[5, 4, 6, 5, 4]];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'columnLineComboTooltip');\r\n\r\n        const { root, columnData, lineData, size, padding } = this;\r\n\r\n        this.columns = createColumnRects({\r\n            stacked: false,\r\n            root,\r\n            data: columnData,\r\n            size,\r\n            padding,\r\n            xScaleDomain: [0, 1],\r\n            yScaleDomain: [0, 4],\r\n            xScalePadding: 0.5,\r\n            agChartsExports,\r\n        });\r\n\r\n        root.append(this.columns);\r\n\r\n        this.lines = createLinePaths(agChartsExports, root, lineData, size, padding);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.columns.forEach((bar: any, i: number) => {\r\n            bar.fill = fills[i];\r\n            bar.stroke = strokes[i];\r\n        });\r\n\r\n        this.lines.forEach((line: any, i: number) => {\r\n            line.stroke = fills[i + 2];\r\n        });\r\n    }\r\n}\r\n", "import type { Path, Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { createColumnRects } from '../miniChartHelpers';\r\nimport { MiniChartWithAxes } from '../miniChartWithAxes';\r\n\r\nexport interface Coordinate {\r\n    x: number;\r\n    y: number;\r\n}\r\nexport class MiniAreaColumnCombo extends MiniChartWithAxes {\r\n    static chartType: ChartType = 'areaColumnCombo';\r\n\r\n    private columns: Rect[];\r\n    private areas: Path[];\r\n\r\n    private columnData = [3, 4.5];\r\n\r\n    private areaData = [[5, 4, 6, 5, 4]];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'areaColumnComboTooltip');\r\n\r\n        const {\r\n            root,\r\n            columnData,\r\n            areaData,\r\n            size,\r\n            padding,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        this.columns = createColumnRects({\r\n            stacked: false,\r\n            root,\r\n            data: columnData,\r\n            size,\r\n            padding,\r\n            xScaleDomain: [0, 1],\r\n            yScaleDomain: [0, 6],\r\n            xScalePadding: 0.5,\r\n            agChartsExports,\r\n        });\r\n\r\n        // scale for area series\r\n        const xScale = new _Scene.BandScale();\r\n        xScale.range = [padding, size - padding];\r\n        xScale.domain = [0, 1, 2, 3, 4];\r\n        xScale.paddingInner = 1;\r\n        xScale.paddingOuter = 0;\r\n\r\n        const yScale = new _Scene.LinearScale();\r\n        yScale.range = [size - padding, padding];\r\n        yScale.domain = [0, 6];\r\n\r\n        const pathData: Coordinate[][] = [];\r\n        const yZero = yScale.convert(0);\r\n        const firstX = xScale.convert(0);\r\n\r\n        areaData.forEach((series, i) => {\r\n            const points = pathData[i] || (pathData[i] = []);\r\n            series.forEach((data, j) => {\r\n                const yDatum = data;\r\n                const xDatum = j;\r\n\r\n                const x = xScale.convert(xDatum);\r\n                const y = yScale.convert(yDatum);\r\n\r\n                points[j] = { x, y };\r\n            });\r\n\r\n            const lastX = xScale.convert(series.length - 1);\r\n\r\n            pathData[i].push(\r\n                {\r\n                    x: lastX,\r\n                    y: yZero,\r\n                },\r\n                {\r\n                    x: firstX,\r\n                    y: yZero,\r\n                }\r\n            );\r\n        });\r\n\r\n        this.areas = pathData.map((points) => {\r\n            const area = new _Scene.Path();\r\n            area.strokeWidth = 0;\r\n            area.fillOpacity = 0.8;\r\n\r\n            const path = area.path;\r\n            points.forEach((point, i) => path[i > 0 ? 'lineTo' : 'moveTo'](point.x, point.y));\r\n\r\n            return area;\r\n        });\r\n\r\n        const areaGroup = new _Scene.Group();\r\n        areaGroup.setClipRect(new _Scene.BBox(padding, padding, size - padding * 2, size - padding * 2));\r\n\r\n        const columnGroup = new _Scene.Group();\r\n        columnGroup.setClipRect(new _Scene.BBox(padding, padding, size - padding * 2, size - padding * 2));\r\n\r\n        areaGroup.append(this.areas);\r\n        columnGroup.append(this.columns);\r\n\r\n        root.append(areaGroup);\r\n        root.append(columnGroup);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.areas.forEach((area, i) => {\r\n            area.fill = fills[i];\r\n            area.stroke = strokes[i];\r\n        });\r\n\r\n        this.columns.forEach((bar: any, i: number) => {\r\n            bar.fill = fills[i + 1];\r\n            bar.stroke = strokes[i + 1];\r\n        });\r\n    }\r\n}\r\n", "import type { Path, Rect } from 'ag-charts-types/scene';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\n\r\nimport type { AgChartsExports } from '../../../../../agChartsExports';\r\nimport { MiniChart } from '../miniChart';\r\nimport { createColumnRects, createLinePaths } from '../miniChartHelpers';\r\n\r\nexport class MiniCustomCombo extends MiniChart {\r\n    static chartType: ChartType = 'customCombo';\r\n\r\n    private columns: Rect[];\r\n    private lines: Path[];\r\n\r\n    private columnData = [3, 4];\r\n\r\n    private lineData = [[5, 4, 6, 5, 4]];\r\n\r\n    constructor(container: HTMLElement, agChartsExports: AgChartsExports, fills: string[], strokes: string[]) {\r\n        super(container, agChartsExports, 'customComboTooltip');\r\n\r\n        const {\r\n            root,\r\n            columnData,\r\n            lineData,\r\n            size,\r\n            padding,\r\n            agChartsExports: { _Scene },\r\n        } = this;\r\n\r\n        this.columns = createColumnRects({\r\n            stacked: false,\r\n            root,\r\n            data: columnData,\r\n            size,\r\n            padding,\r\n            xScaleDomain: [0, 1],\r\n            yScaleDomain: [0, 4],\r\n            xScalePadding: 0.5,\r\n            agChartsExports,\r\n        });\r\n\r\n        root.append(this.columns);\r\n\r\n        this.lines = createLinePaths(this.agChartsExports, root, lineData, size, padding);\r\n\r\n        const axisStroke = 'grey';\r\n        const axisOvershoot = 3;\r\n\r\n        const leftAxis = new _Scene.Line();\r\n        leftAxis.x1 = padding;\r\n        leftAxis.y1 = padding;\r\n        leftAxis.x2 = padding;\r\n        leftAxis.y2 = size - padding + axisOvershoot;\r\n        leftAxis.stroke = axisStroke;\r\n\r\n        const bottomAxis = new _Scene.Line();\r\n        bottomAxis.x1 = padding - axisOvershoot + 1;\r\n        bottomAxis.y1 = size - padding;\r\n        bottomAxis.x2 = size - padding + 1;\r\n        bottomAxis.y2 = size - padding;\r\n        bottomAxis.stroke = axisStroke;\r\n\r\n        const penIcon = new _Scene.Path();\r\n        this.buildPenIconPath(penIcon);\r\n        penIcon.fill = 'whitesmoke';\r\n        penIcon.stroke = 'darkslategrey';\r\n        penIcon.strokeWidth = 1;\r\n\r\n        root.append([bottomAxis, leftAxis, penIcon]);\r\n\r\n        this.updateColors(fills, strokes);\r\n    }\r\n\r\n    updateColors(fills: string[], strokes: string[]) {\r\n        this.columns.forEach((bar: any, i: number) => {\r\n            bar.fill = fills[i];\r\n            bar.stroke = strokes[i];\r\n        });\r\n\r\n        this.lines.forEach((line: any, i: number) => {\r\n            line.stroke = fills[i + 2];\r\n        });\r\n    }\r\n\r\n    buildPenIconPath(penIcon: any) {\r\n        const { path } = penIcon;\r\n        path.moveTo(25.76, 43.46);\r\n        path.lineTo(31.27, 48.53);\r\n        path.moveTo(49.86, 22);\r\n        path.lineTo(49.86, 22);\r\n        path.cubicCurveTo(49.01994659053345, 21.317514933510974, 47.89593834348529, 21.09645997825817, 46.86, 21.41);\r\n        path.lineTo(46.86, 21.41);\r\n        path.cubicCurveTo(45.55460035985361, 21.77260167850787, 44.38777081121966, 22.517979360321792, 43.51, 23.55);\r\n        path.lineTo(25.51, 43.8);\r\n        path.lineTo(25.43, 43.89);\r\n        path.lineTo(23.01, 51.89);\r\n        path.lineTo(22.83, 52.46);\r\n        path.lineTo(31.02, 48.86);\r\n        path.lineTo(49.02, 28.52);\r\n        path.lineTo(49.02, 28.52);\r\n        path.cubicCurveTo(49.940716461596224, 27.521914221246085, 50.54302631059587, 26.2720342455763, 50.75, 24.93);\r\n        path.lineTo(50.75, 24.93);\r\n        path.cubicCurveTo(50.95363374988308, 23.866379846512814, 50.62080640232334, 22.77066734274871, 49.86, 22.0);\r\n        path.closePath();\r\n        path.moveTo(41.76, 25.5);\r\n        path.lineTo(47.34, 30.5);\r\n        path.moveTo(40.74, 26.65);\r\n        path.lineTo(46.25, 31.71);\r\n    }\r\n}\r\n", "import type {\r\n    AgBaseThemeableChartOptions,\r\n    AgCartesianAxesTheme,\r\n    AgCartesianAxisOptions,\r\n    AgCartesianAxisType,\r\n    AgCartesianChartOptions,\r\n    AgChartOptions,\r\n    AgChartThemeOverrides,\r\n    AgPolarAxesTheme,\r\n    AgPolarAxisType,\r\n} from 'ag-charts-types';\r\n\r\nimport type { ChartType } from 'ag-grid-community';\r\nimport { BeanStub, _error } from 'ag-grid-community';\r\n\r\nimport type { ChartController } from '../chartController';\r\nimport type { AgChartActual, AgChartAxisType } from '../utils/integration';\r\nimport { get, set } from '../utils/object';\r\nimport type { ChartSeriesType, ChartThemeOverridesSeriesType } from '../utils/seriesTypeMapper';\r\nimport { getSeriesType, isCartesian, isSeriesType } from '../utils/seriesTypeMapper';\r\n\r\nexport interface ChartOptionsProxy {\r\n    getValue<T = string>(expression: string, calculated?: boolean): T;\r\n    setValue<T = string>(expression: string, value: T): void;\r\n    setValues<T = string>(properties: { expression: string; value: T }[]): void;\r\n}\r\n\r\ntype ChartAxis = NonNullable<AgChartActual['axes']>[number];\r\ntype SupportedSeries = AgChartActual['series'][number];\r\ntype AgPolarAxisThemeOverrides = NonNullable<AgPolarAxesTheme[keyof AgPolarAxesTheme]>;\r\ntype AgCartesianAxisThemeOverrides = NonNullable<AgCartesianAxesTheme[keyof AgCartesianAxesTheme]>;\r\ntype AgChartAxisThemeOverrides = AgCartesianAxisThemeOverrides | AgPolarAxisThemeOverrides;\r\n\r\ntype AgChartOptionsWithThemeOverrides = AgChartOptions & {\r\n    theme: NonNullable<Extract<AgChartOptions['theme'], object>> & {\r\n        overrides: NonNullable<Extract<AgChartOptions['theme'], object>['overrides']>;\r\n    };\r\n};\r\n\r\nconst CARTESIAN_AXIS_TYPES: AgCartesianAxisType[] = ['number', 'category', 'time', 'grouped-category'];\r\nconst POLAR_AXIS_TYPES: AgPolarAxisType[] = ['angle-category', 'angle-number', 'radius-category', 'radius-number'];\r\n\r\nconst VALID_AXIS_TYPES: (AgCartesianAxisType | AgPolarAxisType)[] = [...CARTESIAN_AXIS_TYPES, ...POLAR_AXIS_TYPES];\r\n\r\nexport class ChartOptionsService extends BeanStub {\r\n    private readonly chartController: ChartController;\r\n\r\n    constructor(chartController: ChartController) {\r\n        super();\r\n        this.chartController = chartController;\r\n    }\r\n\r\n    public getChartThemeOverridesProxy(): ChartOptionsProxy {\r\n        return {\r\n            getValue: (expression) => this.getChartOption(expression),\r\n            setValue: (expression, value) => this.setChartThemeOverrides([{ expression, value }]),\r\n            setValues: (properties) => this.setChartThemeOverrides(properties),\r\n        };\r\n    }\r\n\r\n    public getAxisThemeOverridesProxy(): ChartOptionsProxy {\r\n        return {\r\n            getValue: (expression) => this.getAxisProperty(expression),\r\n            setValue: (expression, value) => this.setAxisThemeOverrides([{ expression, value }]),\r\n            setValues: (properties) => this.setAxisThemeOverrides(properties),\r\n        };\r\n    }\r\n\r\n    public getCartesianAxisOptionsProxy(axisType: 'xAxis' | 'yAxis'): ChartOptionsProxy {\r\n        return {\r\n            getValue: (expression) => this.getCartesianAxisProperty(axisType, expression),\r\n            setValue: (expression, value) => this.setCartesianAxisOptions(axisType, [{ expression, value }]),\r\n            setValues: (properties) => this.setCartesianAxisOptions(axisType, properties),\r\n        };\r\n    }\r\n\r\n    public getCartesianAxisThemeOverridesProxy(axisType: 'xAxis' | 'yAxis'): ChartOptionsProxy {\r\n        return {\r\n            getValue: (expression) => this.getCartesianAxisProperty(axisType, expression),\r\n            setValue: (expression, value) => this.setCartesianAxisThemeOverrides(axisType, [{ expression, value }]),\r\n            setValues: (properties) => this.setCartesianAxisThemeOverrides(axisType, properties),\r\n        };\r\n    }\r\n\r\n    public getCartesianAxisAppliedThemeOverridesProxy(axisType: 'xAxis' | 'yAxis'): ChartOptionsProxy {\r\n        return {\r\n            getValue: (expression) =>\r\n                this.getCartesianAxisThemeOverride(\r\n                    axisType,\r\n                    // Allow the caller to specify a wildcard expression to retrieve the whole set of overrides\r\n                    expression === '*' ? null : expression\r\n                )!,\r\n            setValue: (expression, value) =>\r\n                this.setCartesianAxisThemeOverrides(\r\n                    axisType,\r\n                    // Allow the caller to specify a wildcard expression to set the whole set of overrides\r\n                    [{ expression: expression === '*' ? null : expression, value }]\r\n                ),\r\n            setValues: (properties) => this.setCartesianAxisThemeOverrides(axisType, properties),\r\n        };\r\n    }\r\n\r\n    public getSeriesOptionsProxy(getSelectedSeries: () => ChartSeriesType): ChartOptionsProxy {\r\n        return {\r\n            getValue: (expression, calculated) => this.getSeriesOption(getSelectedSeries(), expression, calculated),\r\n            setValue: (expression, value) => this.setSeriesOptions(getSelectedSeries(), [{ expression, value }]),\r\n            setValues: (properties) => this.setSeriesOptions(getSelectedSeries(), properties),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Determine the set of theme overrides that should be retained when transitioning from one chart type to another.\r\n     */\r\n    public getPersistedChartThemeOverrides(\r\n        existingChartOptions: AgChartOptions,\r\n        existingAxes: ChartAxis[] | undefined,\r\n        existingChartType: ChartType,\r\n        targetChartType: ChartType\r\n    ): AgChartThemeOverrides {\r\n        // Determine the set of theme override keys that should be retained when transitioning from one chart type to another\r\n        const retainedThemeOverrideKeys = this.getRetainedChartThemeOverrideKeys(existingChartType, targetChartType);\r\n        const retainedChartAxisThemeOverrideKeys = this.getRetainedChartAxisThemeOverrideKeys(\r\n            null,\r\n            existingChartType,\r\n            targetChartType\r\n        );\r\n\r\n        // combine the options into a single merged object\r\n        const targetChartOptions = this.createChartOptions();\r\n\r\n        // copy the retained theme overrides from the existing chart options to the target chart options\r\n        for (const expression of retainedThemeOverrideKeys) {\r\n            // Locate the value in the existing chart series theme overrides\r\n            const value = this.retrieveChartOptionsThemeOverride(existingChartOptions, existingChartType, expression);\r\n            if (value !== undefined) {\r\n                // Update the value in the target chart series theme overrides\r\n                this.assignChartOptionsThemeOverride(targetChartOptions, targetChartType, expression, value);\r\n            }\r\n        }\r\n\r\n        // axis theme overrides are copied to all potential target axis types\r\n        // (this is necessary because certain chart types auto-instantiate different axis types given the same data)\r\n        if (existingAxes) {\r\n            this.assignPersistedAxisOverrides({\r\n                existingAxes,\r\n                retainedChartAxisThemeOverrideKeys,\r\n                existingChartOptions,\r\n                targetChartOptions,\r\n                existingChartType,\r\n                targetChartType,\r\n            });\r\n        }\r\n\r\n        return targetChartOptions.theme.overrides;\r\n    }\r\n\r\n    public assignPersistedAxisOverrides(params: {\r\n        existingAxes: ChartAxis[];\r\n        retainedChartAxisThemeOverrideKeys: {\r\n            expression: keyof AgChartAxisThemeOverrides | string;\r\n            targetAxisTypes: AgChartAxisType[];\r\n        }[];\r\n        existingChartOptions: AgChartOptions;\r\n        targetChartOptions: AgChartOptions;\r\n        existingChartType: ChartType;\r\n        targetChartType: ChartType;\r\n    }): void {\r\n        const {\r\n            existingAxes,\r\n            retainedChartAxisThemeOverrideKeys,\r\n            existingChartOptions,\r\n            targetChartOptions,\r\n            existingChartType,\r\n            targetChartType,\r\n        } = params;\r\n        for (const { expression, targetAxisTypes } of retainedChartAxisThemeOverrideKeys) {\r\n            // Locate the value in the existing chart series theme overrides\r\n            for (const existingAxisType of existingAxes.map((axis) => axis.type)) {\r\n                const value = this.retrieveChartOptionsThemeOverride(\r\n                    existingChartOptions,\r\n                    existingChartType,\r\n                    ['axes', existingAxisType, expression].join('.')\r\n                );\r\n                if (value !== undefined) {\r\n                    // Copy the value to all potential target chart axis theme overrides\r\n                    // (axis theme overrides are currently only persisted across cartesian chart types)\r\n                    for (const targetAxisType of targetAxisTypes) {\r\n                        this.assignChartOptionsThemeOverride(\r\n                            targetChartOptions,\r\n                            targetChartType,\r\n                            ['axes', targetAxisType, expression].join('.'),\r\n                            value\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getRetainedChartThemeOverrideKeys(\r\n        existingChartType: ChartType,\r\n        targetChartType: ChartType\r\n    ): (keyof AgBaseThemeableChartOptions | string)[] {\r\n        // these theme overrides are persisted across all chart types\r\n        const UNIVERSAL_PERSISTED_THEME_OVERRIDES: (keyof AgBaseThemeableChartOptions)[] = ['animation'];\r\n\r\n        // these theme overrides are persisted across all cartesian chart types\r\n        const PERSISTED_CARTESIAN_CHART_THEME_OVERRIDES: (keyof AgCartesianChartOptions)[] = ['zoom', 'navigator'];\r\n\r\n        // other chart options will be retained depending on the specifics of the chart type from/to transition\r\n        const chartSpecificThemeOverrideKeys = ((previousChartType, updatedChartType) => {\r\n            const expressions = new Array<string>();\r\n            if (isCartesian(getSeriesType(previousChartType)) && isCartesian(getSeriesType(updatedChartType))) {\r\n                expressions.push(...PERSISTED_CARTESIAN_CHART_THEME_OVERRIDES);\r\n            }\r\n            return expressions;\r\n        })(existingChartType, targetChartType);\r\n\r\n        return [...UNIVERSAL_PERSISTED_THEME_OVERRIDES, ...chartSpecificThemeOverrideKeys];\r\n    }\r\n\r\n    private getRetainedChartAxisThemeOverrideKeys(\r\n        axisType: 'xAxis' | 'yAxis' | null,\r\n        existingChartType: ChartType,\r\n        targetChartType: ChartType\r\n    ): {\r\n        expression: keyof AgChartAxisThemeOverrides | string;\r\n        targetAxisTypes: AgChartAxisType[];\r\n    }[] {\r\n        // different axis types have different theme overrides\r\n        if (isCartesian(getSeriesType(existingChartType)) && isCartesian(getSeriesType(targetChartType))) {\r\n            const retainedKeys = this.getRetainedCartesianAxisThemeOverrideKeys(axisType);\r\n            return retainedKeys.map((expression) => ({ expression, targetAxisTypes: CARTESIAN_AXIS_TYPES }));\r\n        }\r\n        return [];\r\n    }\r\n\r\n    private getRetainedCartesianAxisThemeOverrideKeys(\r\n        axisType: 'xAxis' | 'yAxis' | null\r\n    ): (keyof AgCartesianAxisThemeOverrides | string)[] {\r\n        const axisPositionSuffixes =\r\n            axisType === 'xAxis'\r\n                ? ['', '.top', '.bottom']\r\n                : axisType === 'yAxis'\r\n                  ? ['', '.left', '.right']\r\n                  : ['', '.left', '.right', '.top', '.bottom'];\r\n\r\n        // these axis theme overrides are persisted across all cartesian chart axis types\r\n        const PERSISTED_CARTESIAN_AXIS_THEME_OVERRIDES: (keyof AgCartesianAxisThemeOverrides)[] = ['crosshair'];\r\n\r\n        const expressions = new Array<keyof AgBaseThemeableChartOptions | string>();\r\n        for (const expression of PERSISTED_CARTESIAN_AXIS_THEME_OVERRIDES) {\r\n            for (const axisPositionSuffix of axisPositionSuffixes) {\r\n                expressions.push(`${expression}${axisPositionSuffix}`);\r\n            }\r\n        }\r\n        return expressions;\r\n    }\r\n\r\n    private getChartOption<T = string>(expression: string): T {\r\n        return get(this.getChart(), expression, undefined) as T;\r\n    }\r\n\r\n    private setChartThemeOverrides<T = string>(properties: { expression: string; value: T }[]): void {\r\n        const chartType = this.getChartType();\r\n        // combine the options into a single merged object\r\n        const chartOptions: AgChartOptions = this.createChartOptions();\r\n        for (const { expression, value } of properties) {\r\n            this.assignChartOptionsThemeOverride(chartOptions, chartType, expression, value);\r\n        }\r\n        this.applyChartOptions(chartOptions);\r\n    }\r\n\r\n    private applyChartOptions(chartOptions: AgChartOptions, options?: { silent?: boolean }): void {\r\n        if (Object.keys(chartOptions).length === 0) return;\r\n        this.updateChart(chartOptions);\r\n        const shouldRaiseEvent = !options?.silent;\r\n        if (shouldRaiseEvent) this.raiseChartOptionsChangedEvent();\r\n    }\r\n\r\n    public awaitChartOptionUpdate(func: () => void) {\r\n        const chart = this.chartController.getChartProxy().getChart();\r\n        chart\r\n            .waitForUpdate()\r\n            .then(() => func())\r\n            .catch((e) => _error(108, { e }));\r\n    }\r\n\r\n    private getAxisProperty<T = string>(expression: string): T {\r\n        // Assume the property exists on the first axis\r\n        return get(this.getChart().axes?.[0], expression, undefined);\r\n    }\r\n\r\n    private setAxisThemeOverrides<T = string>(properties: { expression: string; value: T }[]): void {\r\n        const chart = this.getChart();\r\n        const chartType = this.getChartType();\r\n\r\n        // combine the options into a single merged object\r\n        const chartOptions = this.createChartOptions();\r\n        for (const { expression, value } of properties) {\r\n            // Only apply the property to axes that declare the property on their prototype chain\r\n            const relevantAxes = chart.axes?.filter((axis) => {\r\n                const parts = expression.split('.');\r\n                let current: any = axis;\r\n                for (const part of parts) {\r\n                    if (!(part in current)) {\r\n                        return false;\r\n                    }\r\n                    current = current[part];\r\n                }\r\n                return true;\r\n            });\r\n            if (!relevantAxes) continue;\r\n\r\n            for (const axis of relevantAxes) {\r\n                if (!this.isValidAxisType(axis)) continue;\r\n                this.assignChartAxisThemeOverride(chartOptions, chartType, axis.type, null, expression, value);\r\n            }\r\n        }\r\n\r\n        this.applyChartOptions(chartOptions);\r\n    }\r\n\r\n    private getCartesianAxisProperty<T = string | undefined>(axisType: 'xAxis' | 'yAxis', expression: string): T {\r\n        const axes = this.getChartAxes();\r\n        const axis = this.getCartesianAxis(axes, axisType);\r\n        return get(axis, expression, undefined);\r\n    }\r\n\r\n    private getCartesianAxisThemeOverride<T = string>(\r\n        axisType: 'xAxis' | 'yAxis',\r\n        expression: string | null\r\n    ): T | undefined {\r\n        const axes = this.getChartAxes();\r\n        const chartAxis = this.getCartesianAxis(axes, axisType);\r\n        if (!chartAxis || !this.isValidAxisType(chartAxis)) return undefined;\r\n        const chartType = this.getChartType();\r\n        const chartOptions = this.getChart().getOptions();\r\n\r\n        return this.retrieveChartAxisThemeOverride(\r\n            chartOptions,\r\n            chartType,\r\n            chartAxis.type,\r\n            axisType === 'yAxis' ? ['left', 'right'] : ['bottom', 'top'],\r\n            expression\r\n        );\r\n    }\r\n\r\n    private setCartesianAxisThemeOverrides<T = string>(\r\n        axisType: 'xAxis' | 'yAxis',\r\n        properties: Array<{ expression: string | null; value: T }>\r\n    ): void {\r\n        const axes = this.getChartAxes();\r\n        const chartAxis = this.getCartesianAxis(axes, axisType);\r\n        if (!chartAxis || !this.isValidAxisType(chartAxis)) return;\r\n        const chartType = this.getChartType();\r\n\r\n        // combine the axis options into a single merged object\r\n        const chartOptions = this.createChartOptions();\r\n        for (const { expression, value } of properties) {\r\n            this.assignChartAxisThemeOverride(\r\n                chartOptions,\r\n                chartType,\r\n                chartAxis.type,\r\n                axisType === 'yAxis' ? ['left', 'right'] : ['bottom', 'top'],\r\n                expression,\r\n                value\r\n            );\r\n        }\r\n\r\n        this.applyChartOptions(chartOptions);\r\n    }\r\n\r\n    private setCartesianAxisOptions<T = string>(\r\n        axisType: 'xAxis' | 'yAxis',\r\n        properties: Array<{ expression: string; value: T }>\r\n    ): void {\r\n        this.updateCartesianAxisOptions(axisType, (chartOptions, axes, chartAxis) => {\r\n            // assign the provided axis options onto the combined chart options object\r\n            const axisIndex = axes.indexOf(chartAxis);\r\n            for (const { expression, value } of properties) {\r\n                this.assignChartOption(chartOptions, `axes.${axisIndex}.${expression}`, value);\r\n            }\r\n        });\r\n    }\r\n\r\n    private updateCartesianAxisOptions(\r\n        axisType: 'xAxis' | 'yAxis',\r\n        updateFunc: (\r\n            chartOptions: AgChartOptions,\r\n            axes: ChartAxis[],\r\n            chartAxis: ChartAxis,\r\n            existingChartOptions: AgChartOptions\r\n        ) => void\r\n    ): void {\r\n        // get a snapshot of all existing axis options from the chart instance\r\n        const existingChartOptions = this.getChart().getOptions();\r\n        const axisOptions = 'axes' in existingChartOptions ? existingChartOptions.axes : undefined;\r\n        if (!existingChartOptions || !axisOptions) return;\r\n\r\n        const axes = this.getChartAxes();\r\n        const chartAxis = this.getCartesianAxis(axes, axisType);\r\n        if (!chartAxis) return;\r\n\r\n        // combine the axis options into a single merged object\r\n        const chartOptions = this.createChartOptions();\r\n        (chartOptions as Extract<AgChartOptions, { axes?: any }>).axes = axisOptions;\r\n\r\n        updateFunc(chartOptions, axes, chartAxis, existingChartOptions);\r\n\r\n        this.applyChartOptions(chartOptions);\r\n    }\r\n\r\n    public setCartesianCategoryAxisType(axisType: 'xAxis' | 'yAxis', value: AgCartesianAxisOptions['type']): void {\r\n        this.updateCartesianAxisOptions(axisType, (chartOptions, _axes, chartAxis, existingChartOptions) => {\r\n            const chartType = this.getChartType();\r\n            this.assignPersistedAxisOverrides({\r\n                existingAxes: [chartAxis],\r\n                retainedChartAxisThemeOverrideKeys: this.getRetainedChartAxisThemeOverrideKeys(\r\n                    axisType,\r\n                    chartType,\r\n                    chartType\r\n                ),\r\n                existingChartOptions,\r\n                targetChartOptions: chartOptions,\r\n                existingChartType: chartType,\r\n                targetChartType: chartType,\r\n            });\r\n            this.assignChartOption(chartOptions, `axes.0.type`, value);\r\n            this.chartController.setCategoryAxisType(value);\r\n        });\r\n    }\r\n\r\n    private getCartesianAxis(axes: ChartAxis[], axisType: 'xAxis' | 'yAxis'): ChartAxis | undefined {\r\n        if (axes.length < 2) {\r\n            return undefined;\r\n        }\r\n        switch (axisType) {\r\n            case 'xAxis':\r\n                return axes[0].direction === 'x' ? axes[0] : axes[1];\r\n            case 'yAxis':\r\n                return axes[1].direction === 'y' ? axes[1] : axes[0];\r\n        }\r\n    }\r\n\r\n    private getSeriesOption<T = string>(seriesType: ChartSeriesType, expression: string, calculated?: boolean): T {\r\n        // N.B. 'calculated' here refers to the fact that the property exists on the internal series object itself,\r\n        // rather than the properties object. This is due to us needing to reach inside the chart itself to retrieve\r\n        // the value, and will likely be cleaned up in a future release\r\n        const series = this.getChart().series.find((s: any) => isMatchingSeries(seriesType, s));\r\n        return get(calculated ? series : series?.properties.toJson(), expression, undefined) as T;\r\n    }\r\n\r\n    private setSeriesOptions<T = string>(\r\n        seriesType: ChartSeriesType,\r\n        properties: { expression: string; value: T }[]\r\n    ): void {\r\n        // combine the series options into a single merged object\r\n        const chartOptions = this.createChartOptions();\r\n        for (const { expression, value } of properties) {\r\n            this.assignChartOptionsSeriesThemeOverride(chartOptions, seriesType, `series.${expression}`, value);\r\n        }\r\n\r\n        this.applyChartOptions(chartOptions);\r\n    }\r\n\r\n    public getPairedMode(): boolean {\r\n        return this.chartController.getChartProxy().isPaired();\r\n    }\r\n\r\n    public setPairedMode(paired: boolean): void {\r\n        this.chartController.getChartProxy().setPaired(paired);\r\n    }\r\n\r\n    private getChartAxes(): Array<ChartAxis> {\r\n        const chart = this.getChart();\r\n        return chart.axes ?? [];\r\n    }\r\n\r\n    private retrieveChartAxisThemeOverride<T = string>(\r\n        chartOptions: AgChartOptions,\r\n        chartType: ChartType,\r\n        axisType: AgChartAxisType,\r\n        axisPositions: ('left' | 'right' | 'top' | 'bottom')[] | null,\r\n        expression: string | null\r\n    ): T | undefined {\r\n        // Theme overrides can be applied either to all axes simultaneously, or only to axes in a certain orientation\r\n        // (this allows more fine-grained control for e.g. styling horizontal / vertical axes separately)\r\n        if (axisPositions) {\r\n            for (const axisPosition of axisPositions) {\r\n                const value = this.retrieveChartOptionsThemeOverride<T>(\r\n                    chartOptions,\r\n                    chartType,\r\n                    ['axes', axisType, axisPosition, ...(expression ? [expression] : [])].join('.')\r\n                );\r\n                if (value === undefined) continue;\r\n                return value;\r\n            }\r\n        } else {\r\n            return this.retrieveChartOptionsThemeOverride<T>(\r\n                chartOptions,\r\n                chartType,\r\n                ['axes', axisType, ...(expression ? [expression] : [])].join('.')\r\n            );\r\n        }\r\n    }\r\n\r\n    private assignChartAxisThemeOverride<T = string>(\r\n        chartOptions: AgChartOptions,\r\n        chartType: ChartType,\r\n        axisType: AgChartAxisType,\r\n        axisPositions: ('left' | 'right' | 'top' | 'bottom')[] | null,\r\n        expression: string | null,\r\n        value: T\r\n    ): void {\r\n        // Theme overrides can be applied either to all axes simultaneously, or only to axes in a certain orientation\r\n        // (this allows more fine-grained control for e.g. styling horizontal / vertical axes separately)\r\n        if (axisPositions) {\r\n            for (const axisPosition of axisPositions) {\r\n                this.assignChartOptionsThemeOverride(\r\n                    chartOptions,\r\n                    chartType,\r\n                    ['axes', axisType, axisPosition, ...(expression ? [expression] : [])].join('.'),\r\n                    value\r\n                );\r\n            }\r\n        } else {\r\n            this.assignChartOptionsThemeOverride(\r\n                chartOptions,\r\n                chartType,\r\n                ['axes', axisType, ...(expression ? [expression] : [])].join('.'),\r\n                value\r\n            );\r\n        }\r\n    }\r\n\r\n    private isValidAxisType(chartAxis: ChartAxis): boolean {\r\n        return VALID_AXIS_TYPES.includes(chartAxis.type);\r\n    }\r\n\r\n    public getChartType(): ChartType {\r\n        return this.chartController.getChartType();\r\n    }\r\n\r\n    private getChart() {\r\n        return this.chartController.getChartProxy().getChart();\r\n    }\r\n\r\n    private updateChart(chartOptions: AgChartOptions) {\r\n        const chartRef = this.chartController.getChartProxy().getChartRef();\r\n        chartRef.skipAnimations();\r\n        chartRef.updateDelta(chartOptions);\r\n    }\r\n\r\n    private createChartOptions(): AgChartOptionsWithThemeOverrides {\r\n        const chartOptions = {\r\n            theme: {\r\n                overrides: {},\r\n            },\r\n        };\r\n        return chartOptions;\r\n    }\r\n\r\n    private retrieveChartOptionsThemeOverride<T>(\r\n        chartOptions: AgChartOptions,\r\n        chartType: ChartType,\r\n        expression: string | null\r\n    ): T | undefined {\r\n        // Determine the relevant series type theme override series keys for the current chart\r\n        const chartSeriesTypes = this.getChartThemeOverridesSeriesTypeKeys(chartType);\r\n\r\n        // Retrieve the first matching value\r\n        for (const seriesType of chartSeriesTypes) {\r\n            const value = this.retrieveChartOptionsSeriesThemeOverride<T>(chartOptions, seriesType, expression);\r\n            if (value === undefined) continue;\r\n            return value;\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    private assignChartOptionsThemeOverride<T>(\r\n        chartOptions: AgChartOptions,\r\n        chartType: ChartType,\r\n        expression: string | null,\r\n        value: T\r\n    ): void {\r\n        // Determine the relevant series type theme override series keys for the current chart\r\n        const chartSeriesTypes = this.getChartThemeOverridesSeriesTypeKeys(chartType);\r\n\r\n        // assign the relevant theme overrides for each series type\r\n        for (const seriesType of chartSeriesTypes) {\r\n            this.assignChartOptionsSeriesThemeOverride(chartOptions, seriesType, expression, value);\r\n        }\r\n    }\r\n\r\n    private retrieveChartOptionsSeriesThemeOverride<T>(\r\n        chartOptions: AgChartOptions,\r\n        seriesType: ChartThemeOverridesSeriesType,\r\n        expression: string | null\r\n    ): T | undefined {\r\n        return this.retrieveChartOption<T>(\r\n            chartOptions,\r\n            ['theme', 'overrides', seriesType, ...(expression ? [expression] : [])].join('.')\r\n        );\r\n    }\r\n\r\n    private assignChartOptionsSeriesThemeOverride<T>(\r\n        chartOptions: AgChartOptions,\r\n        seriesType: ChartThemeOverridesSeriesType,\r\n        expression: string | null,\r\n        value: T\r\n    ): void {\r\n        this.assignChartOption<T>(\r\n            chartOptions,\r\n            ['theme', 'overrides', seriesType, ...(expression ? [expression] : [])].join('.'),\r\n            value\r\n        );\r\n    }\r\n\r\n    private getChartThemeOverridesSeriesTypeKeys(chartType: ChartType): ChartThemeOverridesSeriesType[] {\r\n        // In the chart options API, theme overrides are categorized according to series type.\r\n        // Depending on the chart type, theme overrides may need to be applied to multiple series types.\r\n        const chartSeriesTypes: ChartThemeOverridesSeriesType[] = this.chartController.getChartSeriesTypes(chartType);\r\n        if (this.chartController.isComboChart()) {\r\n            chartSeriesTypes.push('common');\r\n        }\r\n        return chartSeriesTypes;\r\n    }\r\n\r\n    private retrieveChartOption<T>(chartOptions: AgChartOptions, expression: string): T | undefined {\r\n        return get(chartOptions, expression, undefined);\r\n    }\r\n\r\n    private assignChartOption<T>(chartOptions: AgChartOptions, expression: string, value: T): void {\r\n        set(chartOptions, expression, value);\r\n    }\r\n\r\n    private raiseChartOptionsChangedEvent(): void {\r\n        const chartModel = this.chartController.getChartModel();\r\n\r\n        this.eventSvc.dispatchEvent({\r\n            type: 'chartOptionsChanged',\r\n            chartId: chartModel.chartId,\r\n            chartType: chartModel.chartType,\r\n            chartThemeName: this.chartController.getChartThemeName(),\r\n            chartOptions: chartModel.chartOptions,\r\n        });\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n    }\r\n}\r\n\r\nfunction isMatchingSeries(seriesType: ChartSeriesType, series: SupportedSeries): boolean {\r\n    return isSeriesType(seriesType) && series.type === seriesType;\r\n}\r\n", "import type { AgChartThemeName } from 'ag-charts-types';\r\n\r\nimport { _errMsg } from 'ag-grid-community';\r\nimport type { ChartModel } from 'ag-grid-community';\r\n\r\nimport { VERSION } from '../version';\r\nimport { ALL_AXIS_TYPES, getLegacyAxisType } from './chartComp/utils/axisTypeMapper';\r\nimport { getCanonicalChartType, getSeriesType, isPieChartSeries } from './chartComp/utils/seriesTypeMapper';\r\n\r\nconst DEBUG = false;\r\n\r\nexport function upgradeChartModel(model: ChartModel): ChartModel {\r\n    const originalVersion = model.version;\r\n    if (model.version == null) {\r\n        // Try to guess the version so we can apply the right subset of migrations.\r\n        model.version = heuristicVersionDetection(model);\r\n    }\r\n\r\n    model = migrateIfBefore('23.0.0', model, migrateV23);\r\n    model = migrateIfBefore('24.0.0', model, migrateV24);\r\n    model = migrateIfBefore('25.1.0', model, migrateV25_1);\r\n    model = migrateIfBefore('26.0.0', model, migrateV26);\r\n    model = migrateIfBefore('26.1.0', model, migrateV26_1);\r\n    // Switch from iChartOptions to iAgChartOptions....\r\n    model = migrateIfBefore('26.2.0', model, migrateV26_2);\r\n    model = migrateIfBefore('28.0.0', model, migrateV28);\r\n    model = migrateIfBefore('28.2.0', model, migrateV28_2);\r\n    model = migrateIfBefore('29.0.0', model, migrateV29);\r\n    model = migrateIfBefore('29.1.0', model, migrateV29_1);\r\n    model = migrateIfBefore('29.2.0', model, migrateV29_2);\r\n    model = migrateIfBefore('30.0.0', model, migrateV30);\r\n    model = migrateIfBefore('31.0.0', model, migrateV31);\r\n    model = migrateIfBefore('32.0.0', model, migrateV32);\r\n    model = migrateIfBefore('33.0.0', model, migrateV33);\r\n    model = cleanup(model);\r\n\r\n    // Bump version to latest.\r\n    model = migrateIfBefore(VERSION, model, (m) => m);\r\n\r\n    if (DEBUG && originalVersion !== model.version) {\r\n        // eslint-disable-next-line no-console\r\n        console.log('AG Grid: ChartModel migration complete', { model });\r\n    }\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV23(model: ChartModel) {\r\n    // https://github.com/ag-grid/ag-grid/commit/76c6744ff2b732d298d1ade73c122188854b5bac\r\n    model = jsonRename('chartOptions.legend.item.marker.type', 'shape', model);\r\n    model = jsonRename('chartOptions.seriesDefaults.marker.type', 'shape', model);\r\n\r\n    // https://github.com/ag-grid/ag-grid/commit/7bdf2cfd666acda758a818733a9f9cb35ac1d7a7\r\n    model = jsonRename('chartOptions.legend.padding', 'spacing', model);\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV24(model: ChartModel) {\r\n    // https://github.com/ag-grid/ag-grid/commit/f4e854e3dc459400fa00e6da2873cb8e9cfff6fe#\r\n    model = jsonDelete('chartOptions.seriesDefaults.marker.minSize', model);\r\n\r\n    const {\r\n        chartType,\r\n        chartPalette, // Migrate.\r\n        chartOptions: { xAxis, yAxis, ...chartOptions },\r\n        ...chartModel\r\n    } = model as any;\r\n    const axesTypes = getLegacyAxisType(chartType);\r\n    const axes = axesTypes?.map((type, i) => ({\r\n        type,\r\n        ...(i === 0 ? xAxis : yAxis),\r\n    }));\r\n\r\n    // Precise legacy palette fills/strokes can be found here for future reference:\r\n    // https://github.com/ag-grid/ag-grid/blob/b22.1.0/grid-enterprise-modules/charts/src/charts/chart/palettes.ts\r\n    const LEGACY_PALETTES: Record<string, AgChartThemeName> = {\r\n        borneo: 'ag-default',\r\n        material: 'ag-material',\r\n        bright: 'ag-vivid',\r\n    };\r\n\r\n    return {\r\n        chartType,\r\n        chartThemeName: LEGACY_PALETTES[chartPalette] ?? 'ag-default',\r\n        chartOptions: {\r\n            ...chartOptions,\r\n            axes,\r\n            xAxis,\r\n            yAxis,\r\n        },\r\n        ...chartModel,\r\n    } as ChartModel;\r\n}\r\n\r\nfunction migrateV25_1(model: ChartModel) {\r\n    // https://github.com/ag-grid/ag-grid/commit/61943f9fecbfb5ac1b9a1fd93788f9fdd8687181\r\n    model = jsonRename('chartOptions.seriesDefaults.label.minRequiredAngle', 'minAngle', model);\r\n    return model;\r\n}\r\n\r\nfunction migrateV26(model: ChartModel) {\r\n    // https://github.com/ag-grid/ag-grid/commit/df2445d88e64cb4e831d6163104a0fa60ccde3b5\r\n    const highlightOptUpdate = ({ dimOpacity, ...opts }: any) => ({\r\n        ...opts,\r\n        ...(dimOpacity != null ? { series: { dimOpacity } } : {}),\r\n    });\r\n    model = jsonMutate('chartOptions.seriesDefaults.highlightStyle', model, highlightOptUpdate);\r\n\r\n    // https://github.com/ag-grid/ag-grid/commit/f4e854e3dc459400fa00e6da2873cb8e9cfff6fe#\r\n    model = jsonDelete('chart', model);\r\n    model = jsonDelete('chartOptions.seriesDefaults.tooltipClass', model);\r\n    model = jsonDelete('chartOptions.seriesDefaults.tooltipTracking', model);\r\n\r\n    // Cleanup label.rotation === 0, which was treated as 'use the default' on reload prior to 26.\r\n    model = jsonDeleteDefault('chartOptions.axes[].label.rotation', 0, model);\r\n    model = jsonDeleteDefault('chartOptions.axes[].label.rotation', 335, model);\r\n    return model;\r\n}\r\n\r\nfunction migrateV26_1(model: ChartModel) {\r\n    // https://github.com/ag-grid/ag-grid/commit/df2445d88e64cb4e831d6163104a0fa60ccde3b5\r\n    const highlightOptUpdate = ({ item, series, ...opts }: any) => ({\r\n        item: { ...opts, ...item },\r\n        ...(series ? { series } : {}),\r\n    });\r\n    model = jsonMutate('chartOptions.seriesDefaults.highlightStyle', model, highlightOptUpdate);\r\n    model = jsonMutate('chartOptions.series[].highlightStyle', model, highlightOptUpdate);\r\n    return model;\r\n}\r\n\r\nfunction migrateV26_2(model: ChartModel) {\r\n    // https://github.com/ag-grid/ag-grid/commit/8b2e223cb1a687cb6c1d70b9f75f52fa29d00341\r\n    model = jsonMove('chartOptions.seriesDefaults.fill.opacity', 'chartOptions.seriesDefaults.fillOpacity', model);\r\n    model = jsonMove('chartOptions.seriesDefaults.stroke.opacity', 'chartOptions.seriesDefaults.strokeOpacity', model);\r\n    model = jsonMove('chartOptions.seriesDefaults.stroke.width', 'chartOptions.seriesDefaults.strokeWidth', model);\r\n    model = jsonDelete('chartOptions.seriesDefaults.fill', model);\r\n    model = jsonDelete('chartOptions.seriesDefaults.stroke', model);\r\n    model = jsonDelete('chartOptions.seriesDefaults.callout.colors', model);\r\n    model = jsonDelete('chartOptions.xAxis', model);\r\n    model = jsonDelete('chartOptions.yAxis', model);\r\n    const {\r\n        chartType: providedChartType,\r\n        // disable no-unused-vars because `series` is required here, even though\r\n        // unused, because it serves to take the `series` key out of otherChartOptions\r\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n        chartOptions: { axes, series, seriesDefaults, ...otherChartOptions },\r\n        ...otherModelProps\r\n    } = model as any;\r\n\r\n    // At 26.2.0 combination charts weren't supported, so we can safely assume a single series type.\r\n    // We can't rely on the `series.type` field as it was incorrect (in v25.0.0 line chart has an\r\n    // `area` series).\r\n    // Note that in v31.1.0, the canonical name for the 'doughnut' chart type changed to 'donut'.\r\n    const chartType = getCanonicalChartType(providedChartType);\r\n    const seriesType = getSeriesType(chartType);\r\n    const seriesTypes = [seriesType];\r\n\r\n    const chartTypeMixin: any = {};\r\n    if (!isPieChartSeries(seriesType)) {\r\n        const minimalAxis = { top: {}, bottom: {}, left: {}, right: {} };\r\n        const updatedAxes = axes\r\n            .map(({ type, ...axisProps }: any) => ({\r\n                [type]: { ...minimalAxis, ...axisProps },\r\n            }))\r\n            .reduce(merge, {});\r\n        ALL_AXIS_TYPES.filter((v) => updatedAxes[v] == null).forEach((v) => {\r\n            updatedAxes[v] = { ...minimalAxis };\r\n        });\r\n        chartTypeMixin.axes = updatedAxes;\r\n    }\r\n\r\n    const updatedChartOptions = seriesTypes\r\n        .map((t: string) => ({\r\n            [t]: {\r\n                ...chartTypeMixin,\r\n                series: seriesDefaults,\r\n                ...otherChartOptions,\r\n            },\r\n        }))\r\n        .reduce(merge, {});\r\n\r\n    model = {\r\n        ...otherModelProps,\r\n        chartType,\r\n        chartOptions: updatedChartOptions,\r\n    };\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV28(model: ChartModel) {\r\n    model = jsonDelete('chartOptions.*.title.padding', model);\r\n    model = jsonDelete('chartOptions.*.subtitle.padding', model);\r\n    model = jsonDelete('chartOptions.*.axes.*.title.padding', model);\r\n    model = jsonBackfill('chartOptions.*.axes.*.title.enabled', false, model);\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV28_2(model: ChartModel) {\r\n    model = jsonRename('chartOptions.pie.series.callout', 'calloutLine', model);\r\n    model = jsonRename('chartOptions.pie.series.label', 'calloutLabel', model);\r\n    model = jsonRename('chartOptions.pie.series.labelKey', 'sectorLabelKey', model);\r\n    model = jsonRename('chartOptions.pie.series.labelName', 'sectorLabelName', model);\r\n\r\n    model = jsonRename('chartOptions.donut.series.callout', 'calloutLine', model);\r\n    model = jsonRename('chartOptions.donut.series.label', 'calloutLabel', model);\r\n    model = jsonRename('chartOptions.donut.series.labelKey', 'sectorLabelKey', model);\r\n    model = jsonRename('chartOptions.donut.series.labelName', 'sectorLabelName', model);\r\n\r\n    // series.yKeys => yKey ?\r\n    // series.yNames => yName ?\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV29(model: ChartModel) {\r\n    model = jsonMoveIfMissing('chartOptions.scatter.series.fill', 'chartOptions.scatter.series.marker.fill', model);\r\n    model = jsonMoveIfMissing(\r\n        'chartOptions.scatter.series.fillOpacity',\r\n        'chartOptions.scatter.series.marker.fillOpacity',\r\n        model\r\n    );\r\n    model = jsonMoveIfMissing('chartOptions.scatter.series.stroke', 'chartOptions.scatter.series.marker.stroke', model);\r\n    model = jsonMoveIfMissing(\r\n        'chartOptions.scatter.series.strokeOpacity',\r\n        'chartOptions.scatter.series.marker.strokeOpacity',\r\n        model\r\n    );\r\n    model = jsonMoveIfMissing(\r\n        'chartOptions.scatter.series.strokeWidth',\r\n        'chartOptions.scatter.series.marker.strokeWidth',\r\n        model\r\n    );\r\n    model = jsonMove('chartOptions.scatter.series.paired', 'chartOptions.scatter.paired', model);\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV29_1(model: ChartModel) {\r\n    model = jsonDelete('chartOptions.axes[].tick.count', model);\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV29_2(model: ChartModel) {\r\n    // https://github.com/ag-grid/ag-grid/commit/ce11956492e42e845932edb4e05d7b0b21db5c61\r\n    const tooltipOptUpdate = ({ tracking, ...opts }: any) => {\r\n        const output = { ...opts };\r\n        if (tracking === false) {\r\n            output.position ??= { type: 'pointer' };\r\n            output.range ??= 'nearest';\r\n        } else if (tracking === true) {\r\n            output.position ??= { type: 'node' };\r\n            output.range ??= 'nearest';\r\n        }\r\n        return output;\r\n    };\r\n    model = jsonMutate('chartOptions.*.tooltip', model, tooltipOptUpdate);\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV30(model: ChartModel) {\r\n    // Repeated from migrateV28_2() as they were applied retrospectively for the v30 release.\r\n    model = jsonRename('chartOptions.pie.series.labelKey', 'sectorLabelKey', model);\r\n    model = jsonRename('chartOptions.pie.series.labelName', 'sectorLabelName', model);\r\n    // Late-applied migrations for deprecations in the 29.x.y range.\r\n    model = migrateV29_1(model);\r\n    model = migrateV29_2(model);\r\n\r\n    // Actual v30 changes.\r\n    model = jsonDelete('chartOptions.*.series.flipXY', model);\r\n    model = jsonAdd('chartOptions.common.legend.enabled', true, model);\r\n    model = jsonBackfill('chartOptions.common.legend.position', 'right', model);\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV31(model: ChartModel) {\r\n    const V30_LEGACY_PALETTES: Record<string, AgChartThemeName> = {\r\n        'ag-pastel': 'ag-sheets',\r\n        'ag-solar': 'ag-polychroma',\r\n    };\r\n\r\n    const updatedModel = jsonRename('chartOptions.column', 'bar', model);\r\n\r\n    const chartThemeName = V30_LEGACY_PALETTES[updatedModel.chartThemeName] || updatedModel.chartThemeName;\r\n\r\n    return {\r\n        ...updatedModel,\r\n        chartThemeName,\r\n    };\r\n}\r\n\r\nfunction migrateV32(model: ChartModel) {\r\n    model = jsonMutateProperty('chartOptions.*.autoSize', true, model, (parent, targetProp) => {\r\n        if (parent[targetProp] === true) {\r\n            // autoSize: true was the OOB default, so just use the new OOB default baked-in.\r\n        } else if (parent[targetProp] === false) {\r\n            // Fallback to legacy Charts defaults for autoSize: false.\r\n            parent['minHeight'] = 600;\r\n            parent['minWidth'] = 300;\r\n        }\r\n\r\n        delete parent[targetProp];\r\n    });\r\n\r\n    return model;\r\n}\r\n\r\nfunction migrateV33(model: ChartModel) {\r\n    model = jsonDelete('chartOptions.*.axes.category.label.format', model);\r\n    model = jsonDelete('chartOptions.*.axes.category.crosshair.label.format', model);\r\n    model = jsonDelete('chartOptions.*.axes.angle-category.label.format', model);\r\n    model = jsonDelete('chartOptions.*.axes.radius-category.label.format', model);\r\n    model = jsonRename('chartOptions.*.axes.*.label.padding', 'spacing', model);\r\n    model = jsonRename('chartOptions.*.navigator.miniChart.label.padding', 'spacing', model);\r\n    model = jsonDelete('chartOptions.*.axes.*.crossLines.label.className', model);\r\n    model = jsonMutateProperty('chartOptions.*.axes.*.crossLines.label.position', true, model, (parent, targetProp) => {\r\n        if (typeof parent[targetProp] === 'string') {\r\n            parent[targetProp] = parent[targetProp].replace(/([A-Z])/, '-$1').toLowerCase();\r\n        }\r\n    });\r\n    model = jsonDelete('chartOptions.bullet', model);\r\n    model = jsonRenameEnumValues('chartOptions.bar.series.label.placement', model, {\r\n        inside: 'inside-center',\r\n        outside: 'inside-end',\r\n    });\r\n    model = jsonRenameEnumValues('chartOptions.waterfall.series.item.*.label.placement', model, {\r\n        inside: 'inside-center',\r\n        start: 'outside-start',\r\n        end: 'outside-end',\r\n    });\r\n    model = jsonDelete('chartOptions.*.navigator.min', model);\r\n    model = jsonDelete('chartOptions.*.navigator.max', model);\r\n    model = jsonDelete('chartOptions.*.zoom.ratioX', model);\r\n    model = jsonDelete('chartOptions.*.zoom.ratioY', model);\r\n    model = jsonDelete('chartOptions.*.zoom.rangeX', model);\r\n    model = jsonDelete('chartOptions.*.zoom.rangeY', model);\r\n    return model;\r\n}\r\n\r\nfunction cleanup(model: ChartModel) {\r\n    // Remove fixed width/height - this has never been supported via UI configuration.\r\n    model = jsonDelete('chartOptions.*.width', model);\r\n    model = jsonDelete('chartOptions.*.height', model);\r\n    model = jsonBackfill('chartOptions.*.axes.category.label.autoRotate', true, model);\r\n\r\n    return model;\r\n}\r\n\r\nexport function heuristicVersionDetection(model: ChartModel) {\r\n    const modelAny = model as any;\r\n\r\n    if (model.version != null) {\r\n        return model.version;\r\n    }\r\n\r\n    const hasKey = (obj: any, ...keys: string[]) => {\r\n        return Object.keys(obj || {}).some((k) => keys.includes(k));\r\n    };\r\n\r\n    const chartOptions = modelAny.chartOptions;\r\n    const seriesOptions = hasKey(chartOptions, 'seriesDefaults')\r\n        ? chartOptions?.seriesDefaults\r\n        : chartOptions?.[Object.keys(chartOptions)[0]];\r\n    const hints = {\r\n        '27.0.0': hasKey(modelAny, 'seriesChartTypes'),\r\n        '26.2.0': !hasKey(chartOptions, 'seriesDefaults'),\r\n        '26.1.0': hasKey(seriesOptions?.highlightStyle, 'item'),\r\n        '26.0.0': hasKey(seriesOptions?.highlightStyle, 'series'),\r\n        // '26.0.0': modelAny.chart === undefined,\r\n        '25.1.0': hasKey(seriesOptions?.label, 'minAngle'),\r\n        '25.0.0':\r\n            hasKey(modelAny, 'modelType', 'aggFunc', 'unlinkChart', 'suppressChartRanges') ||\r\n            hasKey(seriesOptions, 'lineDash', 'lineDashOffset'),\r\n        '24.0.0': hasKey(modelAny, 'chartThemeName', 'chart') || hasKey(chartOptions, 'series'),\r\n        '23.2.0': hasKey(chartOptions, 'navigator'),\r\n        '23.0.0': hasKey(chartOptions?.legend?.item?.marker, 'shape'),\r\n        '22.1.0': hasKey(modelAny, 'chartPalette', 'chartType'),\r\n    };\r\n\r\n    // Default to 27.1.0, the last version before we added `version`.\r\n    const defaultVersion = '27.1.0';\r\n    const matchingHints = Object.entries(hints).filter(([_, match]) => match);\r\n\r\n    // eslint-disable-next-line no-console\r\n    if (DEBUG) console.log('AG Grid: ChartModel migration', { heuristicVersionCandidates: matchingHints });\r\n    const [heuristicVersion = defaultVersion] = matchingHints[0];\r\n\r\n    // eslint-disable-next-line no-console\r\n    if (DEBUG) console.log('AG Grid: ChartModel migration', { heuristicVersion });\r\n    return heuristicVersion;\r\n}\r\n\r\nfunction migrateIfBefore(maxVersion: string, model: ChartModel, migration: (m: ChartModel) => ChartModel): ChartModel {\r\n    if (versionNumber(maxVersion) > versionNumber(model.version!)) {\r\n        // eslint-disable-next-line no-console\r\n        if (DEBUG) console.log('AG Grid: ChartModel migration', { migratingTo: maxVersion });\r\n\r\n        const result = migration(model);\r\n        result.version = maxVersion;\r\n\r\n        // eslint-disable-next-line no-console\r\n        if (DEBUG) console.log('AG Grid: ChartModel migration', { migratedTo: maxVersion, result });\r\n        return result;\r\n    }\r\n\r\n    return model;\r\n}\r\n\r\ntype VersionParts = { major: number; minor: number; patch: number };\r\nfunction versionParts(versionRaw: string): VersionParts {\r\n    const version = versionRaw.includes('-beta') ? versionRaw.replace(/-beta.*/, '') : versionRaw;\r\n    const split = typeof version === 'string' ? version.split('.').map((v) => Number(v)) : [];\r\n    if (split.length !== 3 || split.some((v) => isNaN(v))) {\r\n        throw new Error(_errMsg(253, { version }));\r\n    }\r\n\r\n    return {\r\n        major: split[0],\r\n        minor: split[1],\r\n        patch: split[2],\r\n    };\r\n}\r\n\r\nfunction versionNumber(version: string): number {\r\n    const { major, minor, patch } = versionParts(version);\r\n\r\n    // Return a number of the form MMmmPP.\r\n    return major * 10_000 + minor * 100 + patch;\r\n}\r\n\r\nfunction jsonDeleteDefault(path: string | string[], defaultValue: any, json: any): any {\r\n    return jsonMutateProperty(path, true, json, (parent, prop) => {\r\n        if (parent[prop] === defaultValue) {\r\n            delete parent[prop];\r\n        }\r\n    });\r\n}\r\n\r\nfunction jsonBackfill(path: string | string[], defaultValue: any, json: any): any {\r\n    return jsonMutateProperty(path, false, json, (parent, prop) => {\r\n        if (parent[prop] == null) {\r\n            parent[prop] = defaultValue;\r\n        }\r\n    });\r\n}\r\n\r\nfunction jsonAdd(path: string | string[], value: any, json: any): any {\r\n    if (typeof path === 'string') {\r\n        path = path.split('.');\r\n    }\r\n\r\n    const nextPath = path[0];\r\n    if (path.length > 1) {\r\n        json[nextPath] = jsonAdd(path.slice(1), value, json[nextPath] ?? {});\r\n    }\r\n\r\n    const hasProperty = Object.keys(json).includes(nextPath);\r\n    if (!hasProperty) {\r\n        json[nextPath] = value;\r\n    }\r\n\r\n    return json;\r\n}\r\n\r\nfunction jsonMove(from: string, to: string, json: any): any {\r\n    let valueToMove: any = undefined;\r\n    let valueFound = false;\r\n    json = jsonMutateProperty(from, true, json, (parent, prop) => {\r\n        valueFound = true;\r\n        valueToMove = parent[prop];\r\n        delete parent[prop];\r\n    });\r\n\r\n    if (!valueFound) {\r\n        return json;\r\n    }\r\n\r\n    return jsonMutateProperty(to, false, json, (parent, prop) => {\r\n        parent[prop] = valueToMove;\r\n    });\r\n}\r\n\r\nfunction jsonMoveIfMissing(from: string, to: string, json: any): any {\r\n    let valueToMove: any = undefined;\r\n    let valueFound = false;\r\n    json = jsonMutateProperty(from, true, json, (parent, prop) => {\r\n        valueFound = true;\r\n        valueToMove = parent[prop];\r\n        delete parent[prop];\r\n    });\r\n\r\n    if (!valueFound) {\r\n        return json;\r\n    }\r\n\r\n    return jsonMutateProperty(to, false, json, (parent, prop) => {\r\n        if (parent[prop] === undefined) {\r\n            parent[prop] = valueToMove;\r\n        }\r\n    });\r\n}\r\n\r\nfunction jsonRename(path: string | string[], renameTo: string, json: any): any {\r\n    return jsonMutateProperty(path, true, json, (parent, prop) => {\r\n        parent[renameTo] = parent[prop];\r\n        delete parent[prop];\r\n    });\r\n}\r\n\r\nfunction jsonDelete(path: string | string[], json: any): any {\r\n    return jsonMutateProperty(path, true, json, (parent, prop) => delete parent[prop]);\r\n}\r\n\r\nfunction jsonMutateProperty(\r\n    path: string | string[],\r\n    skipMissing: boolean,\r\n    json: any,\r\n    mutator: (parent: any, targetProp: string) => any\r\n) {\r\n    const pathElements = path instanceof Array ? path : path.split('.');\r\n    const parentPathElements = pathElements.slice(0, pathElements.length - 1);\r\n    const targetName = pathElements[pathElements.length - 1];\r\n\r\n    return jsonMutate(parentPathElements, json, (parent) => {\r\n        const hasProperty = Object.keys(parent).includes(targetName);\r\n        if (skipMissing && !hasProperty) {\r\n            return parent;\r\n        }\r\n\r\n        const result = { ...parent };\r\n        mutator(result, targetName);\r\n        return result;\r\n    });\r\n}\r\n\r\nfunction jsonMutate(path: string | string[], json: any, mutator: (v: any) => any): any {\r\n    const pathElements = path instanceof Array ? path : path.split('.');\r\n\r\n    // Clone to avoid mutating original input.\r\n    json = { ...json };\r\n\r\n    if (pathElements.length === 0) {\r\n        return mutator(json);\r\n    } else if (pathElements[0].startsWith('{')) {\r\n        const pathOptions = pathElements[0].substring(1, pathElements[0].lastIndexOf('}')).split(',');\r\n        for (const pathOption of pathOptions) {\r\n            if (json[pathOption] != null) {\r\n                json[pathOption] = jsonMutate(pathElements.slice(1), json[pathOption], mutator);\r\n            }\r\n        }\r\n    } else if (pathElements[0].endsWith('[]')) {\r\n        const arrayName = pathElements[0].substring(0, path[0].indexOf('['));\r\n        if (json[arrayName] instanceof Array) {\r\n            json[arrayName] = json[arrayName].map((v: any) => jsonMutate(pathElements.slice(1), v, mutator));\r\n        }\r\n    } else if (pathElements[0] === '*') {\r\n        for (const jsonProp of Object.keys(json)) {\r\n            json[jsonProp] = jsonMutate(pathElements.slice(1), json[jsonProp], mutator);\r\n        }\r\n    } else if (json[pathElements[0]] != null) {\r\n        json[pathElements[0]] = jsonMutate(pathElements.slice(1), json[pathElements[0]], mutator);\r\n    }\r\n\r\n    return json;\r\n}\r\n\r\nfunction jsonRenameEnumValues(path: string | string[], json: any, values: Record<string, string>) {\r\n    return jsonMutateProperty(path, true, json, (parent, targetProp) => {\r\n        if (typeof parent[targetProp] === 'string') {\r\n            parent[targetProp] = values[targetProp] ?? targetProp;\r\n        }\r\n    });\r\n}\r\n\r\nconst merge = (r: object, n: object) => ({ ...r, ...n });\r\n", "import type {\r\n    BeanCollection,\r\n    ChartDownloadParams,\r\n    ChartModel,\r\n    ChartRef,\r\n    CloseChartToolPanelParams,\r\n    CreateCrossFilterChartParams,\r\n    CreatePivotChartParams,\r\n    CreateRangeChartParams,\r\n    GetChartImageDataUrlParams,\r\n    OpenChartToolPanelParams,\r\n    UpdateChartParams,\r\n} from 'ag-grid-community';\r\n\r\nexport function getChartModels(beans: BeanCollection): ChartModel[] | undefined {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.getChartModels());\r\n}\r\n\r\nexport function getChartRef(beans: BeanCollection, chartId: string): ChartRef | undefined {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.getChartRef(chartId));\r\n}\r\n\r\nexport function getChartImageDataURL(beans: BeanCollection, params: GetChartImageDataUrlParams): string | undefined {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.getChartImageDataURL(params));\r\n}\r\n\r\nexport function downloadChart(beans: BeanCollection, params: ChartDownloadParams) {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.downloadChart(params));\r\n}\r\n\r\nexport function openChartToolPanel(beans: BeanCollection, params: OpenChartToolPanelParams) {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.openChartToolPanel(params));\r\n}\r\n\r\nexport function closeChartToolPanel(beans: BeanCollection, params: CloseChartToolPanelParams) {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.closeChartToolPanel(params.chartId));\r\n}\r\n\r\nexport function createRangeChart(beans: BeanCollection, params: CreateRangeChartParams): ChartRef | undefined {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.createRangeChart(params, true));\r\n}\r\n\r\nexport function createPivotChart(beans: BeanCollection, params: CreatePivotChartParams): ChartRef | undefined {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.createPivotChart(params, true));\r\n}\r\n\r\nexport function createCrossFilterChart(\r\n    beans: BeanCollection,\r\n    params: CreateCrossFilterChartParams\r\n): ChartRef | undefined {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.createCrossFilterChart(params, true));\r\n}\r\n\r\nexport function updateChart(beans: BeanCollection, params: UpdateChartParams): void {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.updateChart(params));\r\n}\r\n\r\nexport function restoreChart(\r\n    beans: BeanCollection,\r\n    chartModel: ChartModel,\r\n    chartContainer?: HTMLElement\r\n): ChartRef | undefined {\r\n    return beans.frameworkOverrides.wrapIncoming(() => beans.chartSvc?.restoreChart(chartModel, chartContainer));\r\n}\r\n", "export const integratedChartsModuleCSS = /*css*/ `.ag-chart{display:flex;height:100%;position:relative;width:100%}.ag-chart-components-wrapper{display:flex}.ag-chart-canvas-wrapper,.ag-chart-components-wrapper{flex:1 1 auto;position:relative}.ag-chart-menu{background:var(--ag-background-color);background-color:color-mix(in srgb,transparent,var(--ag-background-color) 30%);border-radius:var(--ag-border-radius);display:flex;flex-direction:row;gap:20px;padding:4px 2px;position:absolute;top:8px;width:auto;--ag-icon-size:20px}:where(.ag-ltr) .ag-chart-menu{justify-content:right;right:calc(var(--ag-cell-horizontal-padding) + var(--ag-spacing) - 4px)}:where(.ag-rtl) .ag-chart-menu{justify-content:left;left:calc(var(--ag-cell-horizontal-padding) + var(--ag-spacing) - 4px)}:where(.ag-chart) .ag-chart-menu{display:none}:where(.ag-chart-menu-hidden:hover) .ag-chart-menu{display:block}.ag-chart-docked-container{min-width:var(--ag-chart-menu-panel-width);position:relative}:where(.ag-chart-menu-hidden)~.ag-chart-docked-container{display:none}.ag-chart-tabbed-menu{display:flex;flex-direction:column;height:100%;overflow:hidden;width:100%}.ag-chart-tabbed-menu-header{cursor:default;flex:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.ag-chart-tabbed-menu-body{align-items:stretch;display:flex;flex:1 1 auto;overflow:hidden;position:relative;&:after{background:linear-gradient(var(--ag-background-color),transparent);content:\"\";display:block;height:16px;left:0;position:absolute;right:0;top:0}}.ag-chart-tab{overflow:hidden;overflow-y:auto;width:100%}.ag-chart-settings{overflow-x:hidden}.ag-chart-settings-wrapper{display:flex;flex-direction:column;height:100%;overflow:hidden;position:relative;width:100%}.ag-chart-settings-nav-bar{align-items:center;border-top:1px solid var(--ag-border-color);display:flex;height:30px;padding:0 10px;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%}.ag-chart-settings-card-selector{align-items:center;display:flex;flex:1 1 auto;height:100%;justify-content:space-around;padding:0 10px}.ag-chart-settings-card-item{background-color:var(--ag-foreground-color);border-radius:4px;cursor:pointer;height:8px;position:relative;width:8px;&.ag-not-selected{opacity:.2}&:before{background-color:transparent;content:\" \";display:block;height:20px;left:50%;margin-left:-10px;margin-top:-10px;position:absolute;top:50%;width:20px}&.ag-selected{background-color:var(--ag-accent-color)}}.ag-chart-settings-next,.ag-chart-settings-prev{flex:none;position:relative;&:focus-within{border-radius:1px;box-shadow:var(--ag-focus-shadow)}}.ag-chart-settings-next-button,.ag-chart-settings-prev-button{cursor:pointer;height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.ag-chart-settings-mini-charts-container{flex:1 1 auto;overflow:hidden auto;position:relative}.ag-chart-settings-mini-wrapper{display:flex;flex-direction:column;left:0;min-height:100%;overflow:hidden;padding-bottom:var(--ag-widget-container-vertical-padding);position:absolute;top:0;width:100%;&.ag-animating{transition:left .3s;transition-timing-function:ease-in-out}}.ag-chart-mini-thumbnail{border:1px solid var(--ag-border-color);border-radius:5px;cursor:pointer;&.ag-selected{border-color:var(--ag-accent-color);border-width:2px}&:focus-visible{border-color:var(--ag-accent-color);box-shadow:var(--ag-focus-shadow)}}.ag-chart-mini-thumbnail-canvas{display:block}.ag-chart-advanced-settings-wrapper,.ag-chart-data-wrapper,.ag-chart-format-wrapper{display:flex;flex-direction:column;padding-bottom:16px;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none}.ag-chart-advanced-settings-wrapper,.ag-chart-data-wrapper{height:100%;overflow-y:auto}.ag-chart-advanced-settings{background-color:var(--ag-chrome-background-color)}.ag-chart-advanced-settings,.ag-chart-advanced-settings-wrapper{width:100%}.ag-chart-advanced-settings-wrapper{padding-bottom:0}.ag-chart-advanced-settings-section{border-bottom:1px solid var(--ag-border-color);display:flex;margin:0;padding-bottom:var(--ag-widget-container-vertical-padding);padding-top:var(--ag-widget-container-vertical-padding)}.ag-chart-empty-text{align-items:center;background-color:var(--ag-background-color);display:flex;height:100%;justify-content:center;top:0;width:100%}.ag-charts-font-size-color{align-self:stretch;display:flex;justify-content:space-between}.ag-charts-data-group-item{padding-bottom:var(--ag-widget-container-vertical-padding);position:relative}.ag-charts-data-group-item:where(:not(:last-child)){margin-bottom:var(--ag-spacing)}.ag-chart-menu-icon{border-radius:var(--ag-border-radius);cursor:pointer;margin:2px 0;opacity:.8;&:hover{opacity:1}}.ag-chart-menu-toolbar-button{background-color:unset;border:0;border-radius:1px;padding:0 2px}.ag-chart-data-column-drag-handle{margin-left:var(--ag-spacing)}.ag-charts-advanced-settings-top-level-group-title-bar{background-color:unset;position:relative}.ag-charts-data-group-container{padding:calc(var(--ag-widget-container-vertical-padding)*.5) var(--ag-widget-container-horizontal-padding)}.ag-charts-data-group-item:where(:not(.ag-charts-format-sub-level-group,.ag-pill-select,.ag-select)){height:var(--ag-list-item-height)}.ag-charts-data-group-item:where(.ag-picker-field){margin-top:var(--ag-spacing)}.ag-charts-advanced-settings-top-level-group-container,.ag-charts-format-top-level-group-container{margin-left:calc(var(--ag-spacing)*2);padding:var(--ag-spacing)}.ag-charts-advanced-settings-top-level-group-item,.ag-charts-format-top-level-group-item{margin:var(--ag-spacing) 0}.ag-charts-format-sub-level-group-container{display:flex;flex-direction:column;padding:var(--ag-widget-vertical-spacing) 0}.ag-charts-settings-group-container{display:grid;grid-template-columns:60px 1fr 60px 1fr 60px;padding:var(--ag-spacing);row-gap:8px;:where(.ag-chart-mini-thumbnail:nth-child(3n+1)){grid-column:1}:where(.ag-chart-mini-thumbnail:nth-child(3n+2)){grid-column:3}:where(.ag-chart-mini-thumbnail:nth-child(3n+3)){grid-column:5}}.ag-chart-data-section,.ag-chart-format-section{display:flex;margin:0;:where(.ag-label:not(.ag-group-title-bar)){color:var(--ag-chart-menu-label-color)}:where(.ag-label-align-top .ag-label){margin-bottom:var(--ag-widget-vertical-spacing);margin-top:calc(var(--ag-widget-vertical-spacing)*.5)}:where(.ag-slider.ag-label-align-top .ag-label){margin-bottom:0}:where(label){display:inline-block}}.ag-chart-menu-panel{--ag-panel-background-color:var(--ag-chrome-background-color)}:where(.ag-ltr) .ag-chart-menu-panel{border-left:1px solid var(--ag-border-color)}:where(.ag-rtl) .ag-chart-menu-panel{border-right:1px solid var(--ag-border-color)}.ag-charts-data-group-title-bar,.ag-charts-format-top-level-group-title-bar,.ag-charts-settings-group-container,.ag-charts-settings-group-title-bar{border-top:none;font-weight:500;padding:0 calc(var(--ag-spacing)*1.5)}.ag-charts-format-sub-level-group-title-bar{background:none;font-weight:500;padding:var(--ag-widget-vertical-spacing) 0}.ag-chart-data-wrapper,.ag-chart-format-wrapper,.ag-charts-data-group-container,.ag-charts-data-group-title-bar,.ag-charts-format-sub-level-group,.ag-charts-format-sub-level-group-container>*,.ag-charts-format-sub-level-group-item:last-child,.ag-charts-format-top-level-group,.ag-charts-format-top-level-group-item,.ag-charts-format-top-level-group-title-bar,.ag-charts-settings-group-container,.ag-charts-settings-group-title-bar,:where(.ag-charts-format-top-level-group) .ag-charts-format-top-level-group-container{margin:0;padding:0}.ag-charts-data-group-title-bar,.ag-charts-format-top-level-group-title-bar,.ag-charts-settings-group-title-bar{padding:var(--ag-widget-container-vertical-padding) var(--ag-widget-container-horizontal-padding);position:relative}.ag-charts-data-group,.ag-charts-format-top-level-group{border-top:1px solid var(--ag-border-color)}:where(.ag-charts-data-group) .ag-charts-data-group-container,:where(.ag-charts-format-top-level-group) .ag-charts-format-top-level-group-container,:where(.ag-charts-settings-group) .ag-charts-settings-group-container{padding:0 var(--ag-widget-container-horizontal-padding)}.ag-charts-format-sub-level-group-container>*,.ag-charts-format-sub-level-no-header-group-container>*,.ag-charts-format-top-level-group-container>*{margin-bottom:var(--ag-widget-vertical-spacing)}.ag-charts-advanced-settings-top-level-group-container{margin:0}:where(.ag-charts-advanced-settings-top-level-group){.ag-charts-advanced-settings-top-level-group-container,.ag-charts-advanced-settings-top-level-group-title-bar{padding:0 var(--ag-widget-container-horizontal-padding)}}.ag-charts-advanced-settings-top-level-group-item{margin-bottom:0;margin-top:calc(var(--ag-widget-vertical-spacing)*2)}.ag-chart-settings-card-item.ag-not-selected:hover{opacity:.35}.ag-angle-select{align-items:center;display:flex}.ag-angle-select-wrapper{display:flex}.ag-angle-select-parent-circle{background-color:var(--ag-background-color);border:1px solid;border-color:var(--ag-border-color);border-radius:12px;display:block;height:24px;position:relative;width:24px}.ag-angle-select-child-circle{background-color:var(--ag-foreground-color);border-radius:3px;height:6px;left:12px;margin-left:-3px;margin-top:-4px;position:absolute;top:4px;width:6px}.ag-slider-wrapper{display:flex;:where(.ag-input-field){flex:1 1 auto}}.ag-color-panel{display:flex;flex-direction:column;padding:var(--ag-spacing);text-align:center;width:100%}.ag-spectrum-color{cursor:default;flex:1 1 auto;overflow:visible;position:relative}.ag-spectrum-fill{inset:0;position:absolute}.ag-spectrum-val{background-image:linear-gradient(0deg,#000,hsla(20,42%,65%,0));cursor:pointer}.ag-spectrum-dragger{background:#000;border:3px solid #fff;border-radius:18px;box-shadow:0 0 2px 0 rgba(0,0,0,.24);cursor:pointer;height:18px;pointer-events:none;position:absolute;width:18px}.ag-spectrum-alpha,.ag-spectrum-hue{cursor:default}.ag-spectrum-hue-background{background:linear-gradient(270deg,red 3%,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red);height:100%;width:100%}.ag-spectrum-alpha-background{background:linear-gradient(to right,var(--ag-internal-spectrum-alpha-color-from),var(--ag-internal-spectrum-alpha-color-to)),url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"4\" height=\"4\"><rect x=\"0\" y=\"0\" width=\"4\" height=\"4\" fill=\"%23fff\"/><path d=\"M0 0H2V4H4V2H0Z\" fill=\"%23b2b2b2\"/></svg>') 0 0 /4px 4px;height:100%;width:100%}.ag-spectrum-tool{border-radius:2px;cursor:pointer;height:11px;margin-bottom:10px;position:relative}.ag-spectrum-slider{border:2px solid #fff;border-radius:13px;box-shadow:0 1px 4px 0 rgba(0,0,0,.37);height:13px;margin-top:-12px;pointer-events:none;position:absolute;width:13px}:where(.ag-spectrum-alpha) .ag-spectrum-slider{background:linear-gradient(to bottom,var(--ag-internal-spectrum-alpha-color),var(--ag-internal-spectrum-alpha-color)) var(--ag-background-color)}.ag-recent-colors{display:flex;gap:6px;margin-bottom:2px;margin-left:var(--ag-spacing);margin-right:var(--ag-spacing)}.ag-recent-color{border:1px solid var(--ag-border-color);cursor:pointer}.ag-angle-select[disabled]{opacity:.5;pointer-events:none}:where(.ag-ltr) .ag-angle-select-field,:where(.ag-ltr) .ag-slider-field{margin-right:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-angle-select-field,:where(.ag-rtl) .ag-slider-field{margin-left:calc(var(--ag-spacing)*2)}.ag-color-dialog{border-radius:5px}:where(.ag-color-picker){.ag-picker-field-wrapper{padding-left:var(--ag-spacing);padding-right:var(--ag-spacing)}.ag-picker-field-display{align-items:center;display:flex;flex-direction:row;min-height:var(--ag-list-item-height)}}:where(.ag-ltr) .ag-color-picker-color,:where(.ag-ltr) .ag-color-picker-value{margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-color-picker-color,:where(.ag-rtl) .ag-color-picker-value{margin-left:var(--ag-spacing)}.ag-spectrum-tools{padding-bottom:0;padding-left:0;padding-right:0}.ag-spectrum-alpha-background,.ag-spectrum-hue-background{border-radius:2px}.ag-color-input-color,.ag-color-picker-color,.ag-recent-color{border-radius:4px}.ag-spectrum-sat{background-image:linear-gradient(90deg,#fff,hsla(20,42%,65%,0))}.ag-recent-color,.ag-spectrum-color,.ag-spectrum-slider{&:where(:not(:disabled,[readonly])):focus-visible{box-shadow:var(--ag-focus-shadow)}}.ag-color-input-color,.ag-color-picker-color{border:1px solid var(--ag-border-color);border-radius:2px;height:var(--ag-icon-size);width:var(--ag-icon-size)}:where(.ag-color-input){.ag-color-input-color{position:absolute}}:where(.ag-ltr) :where(.ag-color-input){.ag-input-field-input{padding-left:calc(var(--ag-icon-size) + var(--ag-spacing)*2)}.ag-color-input-color{margin-left:var(--ag-spacing)}}:where(.ag-rtl) :where(.ag-color-input){.ag-input-field-input{padding-right:calc(var(--ag-icon-size) + var(--ag-spacing)*2)}.ag-color-input-color{margin-right:var(--ag-spacing)}}.ag-range-field{align-items:center;display:flex;:where(.ag-input-wrapper){height:100%}}.ag-range-field-input{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:none;height:100%;overflow:visible;padding:0;width:100%;&:disabled{opacity:.5}}.ag-range-field-input{&::-webkit-slider-runnable-track{background-color:var(--ag-border-color);border-radius:1.5px;height:3px;margin:0;padding:0;width:100%}&::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background-color:var(--ag-background-color);border:1px solid var(--ag-border-color);border-radius:100%;height:var(--ag-icon-size);margin:0;padding:0;transform:translateY(calc(var(--ag-icon-size)*-.5 + 1.5px));width:var(--ag-icon-size)}&:focus::-webkit-slider-thumb{border-color:var(--ag-accent-color);box-shadow:var(--ag-focus-shadow)}&:active::-webkit-slider-runnable-track{background-color:var(--ag-accent-color)}}.ag-range-field-input{&::-moz-range-track{background-color:var(--ag-border-color);border-radius:1.5px;height:3px;margin:0;padding:0;width:100%}&::-moz-ag-range-thumb{-moz-appearance:none;appearance:none;background-color:var(--ag-background-color);border:1px solid var(--ag-border-color);border-radius:100%;height:var(--ag-icon-size);margin:0;padding:0;transform:translateY(calc(var(--ag-icon-size)*-.5 + 1.5px));width:var(--ag-icon-size)}&:focus::-moz-ag-range-thumb{border-color:var(--ag-accent-color);box-shadow:var(--ag-focus-shadow)}&:active::-moz-ag-range-track{background-color:var(--ag-accent-color)}}`;\n", "import type { ModuleValidationResult } from 'ag-grid-community';\r\n\r\nconst VERSION_CHECKING_FIRST_GRID_MAJOR_VERSION = 28;\r\nconst VERSION_CHECKING_FIRST_CHARTS_MAJOR_VERSION = 6;\r\n\r\nfunction isValidVersion(version: string) {\r\n    return version && version.match(/\\d+\\.\\d+\\.\\d+/);\r\n}\r\n\r\nfunction isValidMajorVersion({\r\n    gridMajorVersion,\r\n    chartsMajorVersion,\r\n}: {\r\n    gridMajorVersion: string;\r\n    chartsMajorVersion: string;\r\n}): boolean {\r\n    const gridMajor = parseInt(gridMajorVersion, 10);\r\n    const chartsMajor = parseInt(chartsMajorVersion, 10);\r\n\r\n    const gridMajorDifference = gridMajor - VERSION_CHECKING_FIRST_GRID_MAJOR_VERSION;\r\n    const chartsMajorDifference = chartsMajor - VERSION_CHECKING_FIRST_CHARTS_MAJOR_VERSION;\r\n    const isFirstOrAfterVersion = gridMajorDifference >= 0;\r\n\r\n    return gridMajorDifference === chartsMajorDifference && isFirstOrAfterVersion;\r\n}\r\n\r\nexport function gridChartVersion(gridVersion: string):\r\n    | {\r\n          gridMajorMinor: string;\r\n          chartsMajorMinor: string;\r\n      }\r\n    | undefined {\r\n    if (!gridVersion || !isValidVersion(gridVersion)) {\r\n        return undefined;\r\n    }\r\n\r\n    const [gridMajor, gridMinor] = gridVersion.split('.') || [];\r\n    const gridMajorMinor = `${gridMajor}.${gridMinor}.x`;\r\n\r\n    const gridMajorNumber = parseInt(gridMajor, 10);\r\n    const chartsMajor =\r\n        gridMajorNumber - VERSION_CHECKING_FIRST_GRID_MAJOR_VERSION + VERSION_CHECKING_FIRST_CHARTS_MAJOR_VERSION;\r\n\r\n    if (chartsMajor < 0) {\r\n        return undefined;\r\n    }\r\n\r\n    const chartsMinor = gridMinor;\r\n    const chartsMajorMinor = `${chartsMajor}.${chartsMinor}.x`;\r\n\r\n    return {\r\n        gridMajorMinor,\r\n        chartsMajorMinor,\r\n    };\r\n}\r\n\r\nexport function validGridChartsVersionErrorMessage({\r\n    type,\r\n    gridVersion,\r\n    chartsVersion,\r\n}: {\r\n    type: 'incompatible' | 'invalidCharts' | 'invalidGrid' | 'invalid';\r\n    gridVersion?: string;\r\n    chartsVersion?: string;\r\n}): string {\r\n    const invalidMessage =\r\n        'AG Grid: AG Grid version is incompatible. Please see https://www.ag-grid.com/javascript-data-grid/modules/ for more information.';\r\n\r\n    if (!gridVersion) {\r\n        return invalidMessage;\r\n    }\r\n\r\n    const version = gridChartVersion(gridVersion);\r\n    if (!version) {\r\n        return invalidMessage;\r\n    }\r\n\r\n    const { gridMajorMinor, chartsMajorMinor } = version;\r\n\r\n    if (type === 'incompatible') {\r\n        return `AG Grid version ${gridVersion} and AG Charts version ${chartsVersion} is not supported. AG Grid version ${gridMajorMinor} should be used with AG Chart ${chartsMajorMinor}. Please see https://www.ag-grid.com/javascript-data-grid/modules/ for more information.`;\r\n    } else if (type === 'invalidCharts') {\r\n        return `AG Grid version ${gridMajorMinor} should be used with AG Chart ${chartsMajorMinor} not ${chartsVersion}. Please see https://www.ag-grid.com/javascript-data-grid/modules/ for more information.`;\r\n    }\r\n\r\n    return invalidMessage;\r\n}\r\n\r\nexport function validGridChartsVersion({\r\n    gridVersion,\r\n    chartsVersion,\r\n}: {\r\n    gridVersion: string;\r\n    chartsVersion: string;\r\n}): ModuleValidationResult {\r\n    if (!isValidVersion(chartsVersion)) {\r\n        return {\r\n            isValid: false,\r\n            message: validGridChartsVersionErrorMessage({ type: 'invalidCharts', gridVersion, chartsVersion }),\r\n        };\r\n    }\r\n    if (!isValidVersion(gridVersion)) {\r\n        return {\r\n            isValid: false,\r\n            message: validGridChartsVersionErrorMessage({ type: 'invalidGrid', gridVersion, chartsVersion }),\r\n        };\r\n    }\r\n\r\n    const [gridMajor, gridMinor] = gridVersion.split('.') || [];\r\n    const [chartsMajor, chartsMinor, chartsPatch] = chartsVersion.split('.') || [];\r\n    const isValidMajor = isValidMajorVersion({\r\n        gridMajorVersion: gridMajor,\r\n        chartsMajorVersion: chartsMajor,\r\n    });\r\n\r\n    if ((isValidMajor && gridMinor === chartsMinor) || chartsPatch.includes('beta')) {\r\n        return {\r\n            isValid: true,\r\n        };\r\n    } else if (!isValidMajor || gridMinor !== chartsMinor) {\r\n        return {\r\n            isValid: false,\r\n            message: validGridChartsVersionErrorMessage({ type: 'incompatible', gridVersion, chartsVersion }),\r\n        };\r\n    }\r\n\r\n    return {\r\n        isValid: false,\r\n        message: validGridChartsVersionErrorMessage({ type: 'invalid', gridVersion, chartsVersion }),\r\n    };\r\n}\r\n", "import type { IntegratedModule } from 'ag-charts-types';\r\n\r\nimport type { ModuleName, _ModuleWithoutApi } from 'ag-grid-community';\r\nimport { AllCommunityModule } from 'ag-grid-community';\r\n\r\nimport { AdvancedFilterModule } from './advancedFilter/advancedFilterModule';\r\nimport { IntegratedChartsModule } from './charts/integratedChartsModule';\r\nimport { ClipboardModule } from './clipboard/clipboardModule';\r\nimport { ColumnsToolPanelModule } from './columnToolPanel/columnsToolPanelModule';\r\nimport { ExcelExportModule } from './excelExport/excelExportModule';\r\nimport { FiltersToolPanelModule } from './filterToolPanel/filtersToolPanelModule';\r\nimport { MasterDetailModule } from './masterDetail/masterDetailModule';\r\nimport { ColumnMenuModule, ContextMenuModule } from './menu/menuModule';\r\nimport { MultiFilterModule } from './multiFilter/multiFilterModule';\r\nimport { PivotModule } from './pivot/pivotModule';\r\nimport { CellSelectionModule } from './rangeSelection/rangeSelectionModule';\r\nimport { RichSelectModule } from './richSelect/richSelectModule';\r\nimport { GroupFilterModule, RowGroupingModule, RowGroupingPanelModule } from './rowGrouping/rowGroupingModule';\r\nimport { ServerSideRowModelApiModule, ServerSideRowModelModule } from './serverSideRowModel/serverSideRowModelModule';\r\nimport { SetFilterModule } from './setFilter/setFilterModule';\r\nimport { SideBarModule } from './sideBar/sideBarModule';\r\nimport { SparklinesModule } from './sparkline/sparklinesModule';\r\nimport { StatusBarModule } from './statusBar/statusBarModule';\r\nimport { TreeDataModule } from './treeData/treeDataModule';\r\nimport { VERSION } from './version';\r\nimport { ViewportRowModelModule } from './viewportRowModel/viewportRowModelModule';\r\n\r\ntype AllEnterpriseModuleType = { with: (params: IntegratedModule) => _ModuleWithoutApi } & _ModuleWithoutApi;\r\n\r\nconst dependsOn = [\r\n    AllCommunityModule,\r\n    ClipboardModule,\r\n    ColumnsToolPanelModule,\r\n    ExcelExportModule,\r\n    FiltersToolPanelModule,\r\n    MasterDetailModule,\r\n    ColumnMenuModule,\r\n    ContextMenuModule,\r\n    CellSelectionModule,\r\n    RichSelectModule,\r\n    RowGroupingModule,\r\n    RowGroupingPanelModule,\r\n    GroupFilterModule,\r\n    ServerSideRowModelModule,\r\n    ServerSideRowModelApiModule,\r\n    SetFilterModule,\r\n    MultiFilterModule,\r\n    AdvancedFilterModule,\r\n    SideBarModule,\r\n    StatusBarModule,\r\n    ViewportRowModelModule,\r\n    PivotModule,\r\n    TreeDataModule,\r\n];\r\nconst moduleName: ModuleName = 'AllEnterprise';\r\n\r\n/**\r\n * @feature All Enterprise and Community features\r\n * Registers all the Grid features: Community and Enterprise.\r\n * If using Integrated Charts or Sparklines then the relevant AG Charts module must be provided.\r\n * @example\r\n * // All Enterprise features\r\n * import { ModuleRegistry } from 'ag-grid-community';\r\n * import { AllEnterpriseModule } from 'ag-grid-enterprise';\r\n *\r\n * ModuleRegistry.registerModules([ AllEnterpriseModule ]);\r\n * @example\r\n * // All Enterprise features including Integrated Charts and Sparklines\r\n * import { ModuleRegistry } from 'ag-grid-community';\r\n * import { AgChartsEnterpriseModule } from 'ag-charts-enterprise';\r\n * import { AllEnterpriseModule } from 'ag-grid-enterprise';\r\n *\r\n * ModuleRegistry.registerModules([ AllEnterpriseModule.with(AgChartsEnterpriseModule) ]);\r\n *\r\n */\r\nexport const AllEnterpriseModule: AllEnterpriseModuleType = {\r\n    with: (params) => ({\r\n        moduleName,\r\n        version: VERSION,\r\n        dependsOn: [...dependsOn, IntegratedChartsModule.with(params), SparklinesModule.with(params)],\r\n    }),\r\n    moduleName,\r\n    version: VERSION,\r\n    dependsOn: dependsOn,\r\n};\r\n"],
  "mappings": "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AY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAChG;AAA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",
  "names": ["import_ag_grid_community", "document", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "type", "borderFactory", "shadow", "import_ag_grid_community", "currentSheet", "shadow", "idx", "shadow", "import_ag_grid_community", "import_ag_grid_community", "currentSheet", "currentSheet", "idx", "currentSheet", "currentSheet", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "displayValue", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "pill", "import_ag_grid_community", "import_ag_grid_community", "value", "getSearchString", "value", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "key", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "value", "eTreeLine", "key", "filterModel", "treeLines", "item", "destinationIndex", "OperatorParser", "model", "expression", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "openToolPanel", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "isPivotMode", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "column", "sourceElement", "source", "import_ag_grid_community", "menuItems", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "values", "eventKey", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "value", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "item", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "getMultipleSheetsAsExcel", "exportMultipleSheetsAsExcel", "getMultipleSheetsAsExcel", "exportMultipleSheetsAsExcel", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "isPivotMode", "params", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "isPivotMode", "cols", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "isString", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "set", "node", "parent", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "params", "value", "column", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "params", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "i", "colDef", "uniqueValues", "key", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "row", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "groupSelectsChildren", "Strategy", "import_ag_grid_community", "import_ag_grid_community", "params", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "storeIndexFromEndIndex", "numberOfRowsToSkip", "lazyNode", "numberOfRowDiff", "nextTop", "lazyNode", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "params", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "isTitleEnabled", "theme", "import_ag_grid_community", "labels", "getItemGroupKey", "hierarchy", "import_ag_grid_community", "import_ag_grid_community", "labels", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "params", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "DEFAULT_THEMES", "params", "params", "params", "opts", "data", "series", "angleKey", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "aggFunc", "import_ag_grid_community", "import_ag_grid_community", "value", "optionsValue", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "value", "import_ag_grid_community", "enabled", "import_ag_grid_community", "import_ag_grid_community", "autoRotate", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "import_ag_grid_community", "xScale", "yScale", "import_ag_grid_community", "innerRadius", "acc", "offset", "length", "pattern", "data", "startAngle", "_", "import_ag_grid_community", "updatedChartType", "DEFAULT_THEMES", "import_ag_grid_community", "chartComp", "moduleName", "import_ag_grid_community", "dependsOn", "moduleName"]
}
